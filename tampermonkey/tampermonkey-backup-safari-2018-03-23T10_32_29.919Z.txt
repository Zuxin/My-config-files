{"created_by":"Tampermonkey","version":"1","scripts":[{"name":"Maximize Video","options":{"check_for_updates":true,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_arrayleft":false,"compat_uW_gmonkey":false,"compat_forvarin":false,"noframes":null,"awareOfChrome":false,"run_at":null,"override":{"use_includes":[],"orig_includes":["*"],"merge_includes":true,"use_matches":[],"orig_matches":[],"merge_matches":true,"use_excludes":[],"orig_excludes":["*www.w3school.com.cn*"],"merge_excludes":true,"use_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-end","orig_noframes":null,"orig_connects":[]}},"storage":{"ts":1521542192651,"data":{}},"enabled":true,"position":1,"file_url":"https://greasyfork.org/scripts/4870-maximize-video/code/Maximize%20Video.user.js","uuid":"d0280a38-497c-421f-a105-4d4d69265fd9","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgIAkJTWF4aW1pemUgVmlkZW8KLy8gQG5hbWU6emgtQ04gIAkJ6KeG6aKR572R6aG15YWo5bGPCi8vIEBuYW1lc3BhY2UgICAJCWh0dHA6Ly93d3cuaWN5Y2F0LmNvbQovLyBAZGVzY3JpcHRpb24gCQlNYXhpbWl6ZSBhbGwgdmlkZW8gcGxheWVycwovLyBAZGVzY3JpcHRpb246emgtQ04gCeiuqeaJgOacieinhumikee9kemhteWFqOWxjwovLyBAYXV0aG9yICAgICAgCQnlhrvnjKsKLy8gQGluY2x1ZGUgICAgIAkJKgovLyBAZXhjbHVkZSAgICAgICAgICAgICAqd3d3Lnczc2Nob29sLmNvbS5jbioKLy8gQHZlcnNpb24gICAgIAkJOS42LjYKLy8gQGdyYW50ICAgICAgIAkJdW5zYWZlV2luZG93Ci8vIEBydW4tYXQgICAgICAJCWRvY3VtZW50LWVuZAovLyA9PS9Vc2VyU2NyaXB0PT0KCihmdW5jdGlvbigpIHsKCiAgICAndXNlIHN0cmljdCc7CgogICAgdmFyIGZ1bGxTdGF0dXMgPSBmYWxzZSwKICAgICAgICBpc0lmcmFtZSA9IGZhbHNlLAogICAgICAgIGlzRnVsbElmcmFtZVBsYXllciA9IGZhbHNlLAogICAgICAgIGlzUmJ0biA9IHRydWUsCiAgICAgICAgcGFyZW50QXJyYXkgPSBuZXcgQXJyYXkoKSwKICAgICAgICBiYWNrU3R5bGUgPSBuZXcgT2JqZWN0KCksCiAgICAgICAgbW91c2UgPSB7CiAgICAgICAgICAgIGxlYXZlOiAnbGlzdGVuZXInLAogICAgICAgICAgICBvdmVyOiAnbGlzdGVuZXInCiAgICAgICAgfSwKICAgICAgICBicm93c2VyLCBidG5UZXh0LCBwbGF5ZXIsIGNvbnRyb2xCdG4sIGxlZnRCdG4sIHJpZ2h0QnRuOwoKICAgIC8vSHRtbDXop4TliJlbb3ZlcmxheXzku45vdmVybGF55YiwcGxheWVy6IqC54K55pWw5oiWcGxheWVy6IqC54K5XSzpgILnlKjkuo7oh6rpgILlupTlpKflsI9IVE1MNeaSreaUvuWZqAogICAgdmFyIGh0bWw1UnVsZXMgPSB7CiAgICAgICAgJ3ZpZG5vZGUubmV0JzogWycjbXlWaWRlbyB2aWRlb3wjbXlWaWRlbyddLAogICAgICAgICdrLXZpZC5uZXQnOiBbJyNteVZpZGVvIHZpZGVvfCNteVZpZGVvJ10sCiAgICAgICAgJ2VnYW1lLnFxLmNvbSc6IFsnI2dpZnRfZGFubWFrdV9jb250YWluZXIgZGl2fCN2aWRlby1jb250YWluZXInLCAnI29ial92Y3BsYXllcl8xIGVtYmVkfCN2aWRlby1jb250YWluZXInXSwKICAgICAgICAnd2VpYm8uY29tJzogWyd2aWRlb3wyJ10sCiAgICAgICAgJ3Bhbi5iYWlkdS5jb20nOiBbJyN2aWRlby1yb290fCN2aWRlby1wbGF5ZXInXSwKICAgICAgICAnd3d3Lm5pY292aWRlby5qcCc6IFsnI1VhZFBsYXllcnwyJ10sCiAgICAgICAgJ3RoZXZpZGVvLm1lJzogWycjdnBsYXllciB2aWRlb3wxJ10sCiAgICAgICAgJ2tpbWNhcnRvb24ubWUnOiBbJyNkaXZDb250ZW50VmlkZW8gdmlkZW98MSddLAogICAgICAgICd3d3cuZGFpbHltb3Rpb24uY29tJzogWycjcGxheWVyIHZpZGVvfDQnLCAnI3BsYXllciAuZG1wX1ZpZGVvVmlld3wyJ10sCiAgICAgICAgJ3YueW91a3UuY29tJzogWycjeWtQbGF5ZXIgLnlrLXRyaWdnZXItbGF5ZXJ8MycsICcjeWtQbGF5ZXIgLnNwdi1sb2dvfDQnXSwKICAgICAgICAnd3d3LmlxaXlpLmNvbSc6IFsnI2ZsYXNoYm94IHZpZGVvfDInXSwKICAgICAgICAnd3d3LnlvdXR1YmUuY29tJzogWycjcGxheWVyLWFwaSB2aWRlb3wzJywgJyNjNC1wbGF5ZXIgdmlkZW98MicsICcjcGxheWVyLWNvbnRhaW5lciB2aWRlb3wzJywgJyNtb3ZpZV9wbGF5ZXJ8MCddLAogICAgICAgICd3d3cudHdpdGNoLnR2JzogWycuanMtY29udHJvbC1mdWxsc2NyZWVuLW92ZXJsYXl8MScsICcucGwtY29udHJvbHMtdG9wfDQnXSwKICAgICAgICAnd3d3Lmh1eWEuY29tJzogWycjZGFubXVkaXYyfCN2aWRlb0NvbnRhaW5lcicsICcjcGxheWVyLXZpZGVvfCN2aWRlb0NvbnRhaW5lciddLAogICAgICAgICd3d3cuaHVvbWFvLmNvbSc6IFsnI215LWdpZnQtc3RhZ2V8I2g1LXBsYXlpbmctYm94J10sCiAgICAgICAgJ2F2Z2xlLmNvbSc6IFsnI3ZpZGVvLXBsYXllcl9odG1sNV9hcGl8MScsICcjdmpzLWxvZ29icmFuZC1pbWFnZXwyJ10sCiAgICAgICAgJ3d3dy5iaWxpYmlsaS5jb20nOiBbJyNiaWxpYmlsaVBsYXllciB2aWRlb3w0JywgJy5iaWxpYmlsaS1wbGF5ZXItaW5mb3wyJ10sCiAgICAgICAgJ3d3dy5wb3JuaHViLmNvbSc6IFsnLm1ocDExMzhfZXZlbnRDYXRjaGVyfDInXSwKICAgICAgICAnd3d3LnJlZHR1YmUuY29tJzogWycubWhwMTEzOF9ldmVudENhdGNoZXJ8MSddLAogICAgICAgICd3d3cueW91cG9ybi5jb20nOiBbJy5taHAxMTM4X2V2ZW50Q2F0Y2hlcnwxJ10sCiAgICAgICAgJ3d3dy5pY291cnNlMTYzLm9yZyc6IFsnLnV4LXZpZGVvLXBsYXllciAuYmJnfDMnXSwKICAgICAgICAnd3d3LnBhbmRhLnR2JzogWycjcm9vbS1wbGF5ZXItdmlkZW8tZGFubXUgZGl2fC5oNXBsYXllci1wbGF5ZXItY29udGFpbmVyJywgJy5yb29tLXRpbWVsaW5lLXJlY29yZC1idG58Lmg1cGxheWVyLXBsYXllci1jb250YWluZXInXSwKICAgICAgICAndmsuY29tJzogWycudmlkZW9wbGF5ZXJfbWVkaWF8MSddLAogICAgICAgICd3d3cuZG91eXUuY29tJzogWycuZGFubXUtd3JhcCB2aWRlb3wyJywgJyNqcy1yb29tLXZpZGVvIGNhbnZhc3wjanMtcm9vbS12aWRlbycsICcjanMtcm9vbS12aWRlbyB2aWRlb3wjanMtcm9vbS12aWRlbyddLAogICAgICAgICdzdG9yZS5zdGVhbXBvd2VyZWQuY29tJzogWycjaGlnaGxpZ2h0X3BsYXllcl9hcmVhIHZpZGVvfDInXSwKICAgICAgICAndmltZW8uY29tJzogWycucGxheWVyIC50YXJnZXR8MScsICcucGxheWVyIC5jYXJkc3wyJ10sCiAgICAgICAgJ2VjY2hpLml3YXJhLnR2JzogWycjdmlkZW8tcGxheWVyIHZpZGVvfDEnXSwKICAgICAgICAnbGl2ZS5iaWxpYmlsaS5jb20nOiBbJy5iaWxpYmlsaS1saXZlLXBsYXllci12aWRlby1kYW5tYWt1fDInLCAnLmJpbGliaWxpLWxpdmUtcGxheWVyLXZpZGVvLWdpZnR8MiddLAogICAgICAgICd2LnFxLmNvbSc6IFsnI3RlbnZpZGVvX3BsYXllciAudHhwX3NoYWRvd3wzJywgJyN2aWRlb19jb250YWluZXJfYm9keSAudHhwX3NoYWRvd3wzJ10KICAgIH07CgogICAgLy9pZnJhbWXmkq3mlL7lmajmmL7npLrmjInpkq7op4TliJkKICAgIC8vaWZyYW1l5YWz6ZSu5a2XaWTjgIFjbGFzc25hbWXjgIFzcmMKICAgIHZhciBpZnJhbWVSdWxlcyA9IC9wbGF5fHlvdXR1YmVcLmNvbVwvZW1iZWR8dmlkZW98bW92aWV8YW5pbWV8Zmx2fG1wNHx2XC55b3VrdVwuY29tfHd3d1wuaXFpeWlcLmNvbXx2XC5xcVwuY29tfHd3d1wubGVcLmNvbS9pOwogICAgLy/nvZHnq5nln5/lkI0KICAgIHZhciBpZnJhbWVVcmxSdWxlcyA9IFsKICAgICAgICAnd3d3LmZyZWVtdnR2LmNvbScsCiAgICAgICAgJ3R3bWVpanUuY29tJywKICAgICAgICAnd3d3MS5mbW92aWVzLnBlJywKICAgICAgICAnd3d3Mi53YXRjaGFzaWFuLmNvJywKICAgICAgICAncHV0bG9ja2VyLm5pbmphJywKICAgICAgICAna2lzc2hlbnRhaS5uZXQnLAogICAgICAgICd3d3cud2F0Y2hzZXJpZXMuYWMnLAogICAgICAgICd3d3cucGFuZGEudHYnLAogICAgICAgICdhbmltZWZsdi5uZXQnLAogICAgICAgICd3d3cudm9kbG9ja2VyLmNpdHknLAogICAgICAgICdwcm9qZWN0d2F0Y2hzZXJpZXMuY29tJywKICAgICAgICAncmV5YW5pbWUuY29tJwogICAgXTsKCiAgICAvL+iHquWKqOe8qeaUvuWGheWxguWGheaSreaUvuWZqOinhOWImQogICAgdmFyIGZ1bGxJZnJhbWVQbGF5ZXJSdWxlcyA9IFsKICAgICAgICAndmlkbm9kZS5uZXQnLAogICAgICAgICdrLXZpZC5uZXQnLAogICAgICAgICd2LnFxLmNvbScsCiAgICAgICAgJ25ld3BsYXllci5qZnJmdC5jb20nLAogICAgICAgICdwbGF5ZXIuMDA1LnR2JywKICAgICAgICAncGxheWVyLnhjbWguY2MnLAogICAgICAgICd3d3cuYXVyb3JhdmlkLnRvJywKICAgICAgICAnd3d3Lm1wNHVwbG9hZC5jb20nLAogICAgICAgICd2b2Rsb2NrZXIuY29tJywKICAgICAgICAnNTJkb25nbS5kdWFwcC5jb20nCiAgICBdOwoKICAgIC8vZmxhc2jmuLjmiI/pobXpnaLvvIzkuI3lnKhmbGFzaOS4iuaYvuekuui/mOWOn+aMiemSrgogICAgdmFyIGV4Y2x1ZGVSYnRuUnVsZXMgPSBbCiAgICAgICAgJ3d3dy5kbW0uY29tJywKICAgICAgICAnd3d3LmRtbS5jby5qcCcsCiAgICAgICAgJ3d3dy40Mzk5LmNvbScsCiAgICAgICAgJ3d3dy4zMzY2LmNvbScsCiAgICAgICAgJ2ZsYXNoLjE3MTczLmNvbScsCiAgICAgICAgJ3d3dy43azdrLmNvbScKICAgIF07CgogICAgaWYgKGV4Y2x1ZGVSYnRuUnVsZXMuaW5kZXhPZihkb2N1bWVudC5sb2NhdGlvbi5ob3N0bmFtZSkgIT0gLTEpIHsKICAgICAgICBpc1JidG4gPSBmYWxzZTsKICAgIH0KCiAgICBpZiAod2luZG93LnRvcCAhPT0gd2luZG93LnNlbGYpIHsKICAgICAgICBpc0lmcmFtZSA9IHRydWU7CiAgICB9CgogICAgaWYgKG5hdmlnYXRvci5sYW5ndWFnZS50b0xvY2FsZUxvd2VyQ2FzZSgpID09ICd6aC1jbicpIHsKICAgICAgICBidG5UZXh0ID0gewogICAgICAgICAgICBvdXQ6ICfnvZHpobXlhajlsY8nLAogICAgICAgICAgICBpbm5lcjogJ+WGheWxguWFqOWxjycsCiAgICAgICAgICAgIHJlc3RvcmU6ICfov5jljp/lpKflsI8nCiAgICAgICAgfTsKICAgIH0gZWxzZSB7CiAgICAgICAgYnRuVGV4dCA9IHsKICAgICAgICAgICAgb3V0OiAnTWF4aW1pemUnLAogICAgICAgICAgICBpbm5lcjogJ008YnIvPkE8YnIvPlgnLAogICAgICAgICAgICByZXN0b3JlOiAnUmVzdG9yZScKICAgICAgICB9OwogICAgfQoKICAgIGlmICgvRmlyZWZveC9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpIHsKICAgICAgICBicm93c2VyID0gJ2ZpcmVmb3gnOwogICAgfSBlbHNlIGlmICgvQ2hyb21lL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSkgewogICAgICAgIGJyb3dzZXIgPSAnY2hyb21lJzsKICAgIH0gZWxzZSB7CiAgICAgICAgYnJvd3NlciA9ICdvdGhlcic7CiAgICB9CgogICAgdmFyIGNyZWF0ZUJ1dHRvbiA9IGZ1bmN0aW9uKGlkKSB7CiAgICAgICAgdmFyIGJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RiZGl2Jyk7CiAgICAgICAgYnRuLmlkID0gaWQ7CiAgICAgICAgYnRuLm9uY2xpY2sgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgbWF4aW1pemUucGxheWVyQ29udHJvbCgpOwogICAgICAgIH07CiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChidG4pOwogICAgICAgIHJldHVybiBidG47CiAgICB9OwoKICAgIHZhciB0b29sID0gewogICAgICAgIGdldFJlY3Q6IGZ1bmN0aW9uKGVsZW1lbnQpIHsKICAgICAgICAgICAgdmFyIHJlY3QgPSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgICAgICAgICB2YXIgc2Nyb2xsID0gdG9vbC5nZXRTY3JvbGwoKTsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHBhZ2VYOiByZWN0LmxlZnQgKyBzY3JvbGwubGVmdCwKICAgICAgICAgICAgICAgIHBhZ2VZOiByZWN0LnRvcCArIHNjcm9sbC50b3AsCiAgICAgICAgICAgICAgICBzY3JlZW5YOiByZWN0LmxlZnQsCiAgICAgICAgICAgICAgICBzY3JlZW5ZOiByZWN0LnRvcAogICAgICAgICAgICB9OwogICAgICAgIH0sCiAgICAgICAgaXNGdWxsQ2xpZW50OiBmdW5jdGlvbihlbGVtZW50KSB7CiAgICAgICAgICAgIHZhciBjbGllbnQgPSB0b29sLmdldENsaWVudCgpOwogICAgICAgICAgICB2YXIgcmVjdCA9IHRvb2wuZ2V0UmVjdChlbGVtZW50KTsKICAgICAgICAgICAgaWYgKE1hdGguYWJzKGNsaWVudC53aWR0aCAtIGVsZW1lbnQub2Zmc2V0V2lkdGgpIDwgMjEgJiYgTWF0aC5hYnMoY2xpZW50LmhlaWdodCAtIGVsZW1lbnQub2Zmc2V0SGVpZ2h0KSA8IDIxICYmIHJlY3Quc2NyZWVuWSA8IDEwICYmIHJlY3Quc2NyZWVuWCA8IDIwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgaXNIdG1sNUZ1bGxDbGllbnQ6IGZ1bmN0aW9uKGVsZW1lbnQpIHsKICAgICAgICAgICAgdmFyIGNsaWVudCA9IHRvb2wuZ2V0Q2xpZW50KCk7CiAgICAgICAgICAgIHZhciByZWN0ID0gdG9vbC5nZXRSZWN0KGVsZW1lbnQpOwogICAgICAgICAgICB2YXIgdyA9IGNsaWVudC53aWR0aCAtIGVsZW1lbnQub2Zmc2V0V2lkdGg7CiAgICAgICAgICAgIHZhciBoID0gY2xpZW50LmhlaWdodCAtIGVsZW1lbnQub2Zmc2V0SGVpZ2h0OwogICAgICAgICAgICBpZiAodyA+PSAwICYmIGggPj0gMCkgewogICAgICAgICAgICAgICAgaWYgKCh3IDwgMjEgJiYgcmVjdC5zY3JlZW5YIDwgMjApIHx8IChoIDwgMjEgJiYgcmVjdC5zY3JlZW5ZIDwgMTApKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICB9LAogICAgICAgIGdldFNjcm9sbDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBsZWZ0OiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsTGVmdCB8fCBkb2N1bWVudC5ib2R5LnNjcm9sbExlZnQsCiAgICAgICAgICAgICAgICB0b3A6IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AgfHwgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AKICAgICAgICAgICAgfTsKICAgICAgICB9LAogICAgICAgIGdldENsaWVudDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB3aWR0aDogZG9jdW1lbnQuY29tcGF0TW9kZSA9PSAnQ1NTMUNvbXBhdCcgPyBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGggOiBkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoLAogICAgICAgICAgICAgICAgaGVpZ2h0OiBkb2N1bWVudC5jb21wYXRNb2RlID09ICdDU1MxQ29tcGF0JyA/IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgOiBkb2N1bWVudC5ib2R5LmNsaWVudEhlaWdodAogICAgICAgICAgICB9OwogICAgICAgIH0sCiAgICAgICAgYWRkU3R5bGU6IGZ1bmN0aW9uKGNzcykgewogICAgICAgICAgICB2YXIgc3R5bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdHlsZScpOwogICAgICAgICAgICBzdHlsZS50eXBlID0gJ3RleHQvY3NzJzsKICAgICAgICAgICAgdmFyIG5vZGUgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShjc3MpOwogICAgICAgICAgICBzdHlsZS5hcHBlbmRDaGlsZChub2RlKTsKICAgICAgICAgICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzdHlsZSk7CiAgICAgICAgICAgIHJldHVybiBzdHlsZTsKICAgICAgICB9CiAgICB9OwoKICAgIHZhciBzZXRCdXR0b24gPSB7CiAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIC8v6Ziy5q2i6aG16Z2i6ISa5pys5bmy5omw77yM6YeN5paw5Yid5aeL5YyW5qC35byPCiAgICAgICAgICAgIGlmICghZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BsYXllckNvbnRyb2xCdG4nKSkgewogICAgICAgICAgICAgICAgaW5pdCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChpc0lmcmFtZSAmJiAhaXNGdWxsSWZyYW1lUGxheWVyICYmIGZ1bGxJZnJhbWVQbGF5ZXJSdWxlcy5pbmRleE9mKGRvY3VtZW50LmxvY2F0aW9uLmhvc3RuYW1lKSAhPSAtMSkgewogICAgICAgICAgICAgICAgaWYgKHBsYXllcikgewogICAgICAgICAgICAgICAgICAgIG1heGltaXplLmNoZWNrUGFyZW50KCk7CiAgICAgICAgICAgICAgICAgICAgbWF4aW1pemUuYWRkQ2xhc3MoKTsKICAgICAgICAgICAgICAgICAgICB0b29sLmFkZFN0eWxlKCcjaHRtbFRvb3RoYnJ1c2ggI2JvZHlUb290aGJydXNoIC5wbGF5ZXJUb290aGJydXNoIHtsZWZ0OjBweCAhaW1wb3J0YW50O3dpZHRoOjEwMHZ3ICFpbXBvcnRhbnQ7fScpOwogICAgICAgICAgICAgICAgICAgIGlzRnVsbElmcmFtZVBsYXllciA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRvb2wuaXNGdWxsQ2xpZW50KHBsYXllcikgfHwgaXNGdWxsSWZyYW1lUGxheWVyKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGlzSWZyYW1lICYmIHBsYXllci5ub2RlTmFtZSA9PSAnVklERU8nICYmIHRvb2wuaXNIdG1sNUZ1bGxDbGllbnQocGxheWVyKSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuc2hvdygpOwogICAgICAgIH0sCiAgICAgICAgc2hvdzogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBwbGF5ZXIuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VsZWF2ZScsIGhhbmRsZS5sZWF2ZVBsYXllciwgZmFsc2UpOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICBtb3VzZS5sZWF2ZSA9IHBsYXllci5vbm1vdXNlbGVhdmU7CiAgICAgICAgICAgICAgICBwbGF5ZXIub25tb3VzZWxlYXZlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgaGFuZGxlLmxlYXZlUGxheWVyKCk7CiAgICAgICAgICAgICAgICAgICAgcGxheWVyLm9ubW91c2VsZWF2ZSA9IG1vdXNlLmxlYXZlOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIWZ1bGxTdGF0dXMpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIGhhbmRsZS5zY3JvbGxGaXgsIGZhbHNlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb250cm9sQnRuLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICBjb250cm9sQnRuLnN0eWxlLnZpc2liaWxpdHkgPSAndmlzaWJsZSc7CiAgICAgICAgICAgIHRoaXMubG9jYXRlKCk7CiAgICAgICAgfSwKICAgICAgICBsb2NhdGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgcGxheWVyUmVjdCA9IHRvb2wuZ2V0UmVjdChwbGF5ZXIpOwogICAgICAgICAgICBpZiAocGxheWVyUmVjdC5wYWdlWSA8IDIwIHx8IGZ1bGxTdGF0dXMpIHsKICAgICAgICAgICAgICAgIGlmIChmdWxsU3RhdHVzKSB7CiAgICAgICAgICAgICAgICAgICAgY29udHJvbEJ0bi5jbGFzc0xpc3QucmVtb3ZlKCdwbGF5ZXJDb250cm9sQnRuQ29sJyk7CiAgICAgICAgICAgICAgICAgICAgcGxheWVyUmVjdC5zY3JlZW5ZID0gcGxheWVyUmVjdC5zY3JlZW5ZICsgNTA7CiAgICAgICAgICAgICAgICAgICAgcGxheWVyUmVjdC5zY3JlZW5YID0gcGxheWVyUmVjdC5zY3JlZW5YIC0gMzA7CiAgICAgICAgICAgICAgICAgICAgY29udHJvbEJ0bi5pbm5lckhUTUwgPSBidG5UZXh0LnJlc3RvcmU7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHBsYXllclJlY3Quc2NyZWVuWSA9IHBsYXllclJlY3Quc2NyZWVuWSArIDIwOwogICAgICAgICAgICAgICAgICAgIGlmIChNYXRoLmFicyh0b29sLmdldENsaWVudCgpLndpZHRoIC0gcGxheWVyLm9mZnNldFdpZHRoKSA8IDIxICYmIE1hdGguYWJzKHRvb2wuZ2V0Q2xpZW50KCkuaGVpZ2h0IC0gcGxheWVyLm9mZnNldEhlaWdodCkgPiAyMSkgewogICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXJSZWN0LnNjcmVlblggPSBwbGF5ZXJSZWN0LnNjcmVlblggKyA0NDsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXJSZWN0LnNjcmVlblggPSBwbGF5ZXJSZWN0LnNjcmVlblggKyA2NDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY29udHJvbEJ0bi5jbGFzc0xpc3QuYWRkKCdwbGF5ZXJDb250cm9sQnRuQ29sJyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzSWZyYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xCdG4uaW5uZXJIVE1MID0gYnRuVGV4dC5pbm5lcjsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sQnRuLmlubmVySFRNTCA9IGJ0blRleHQub3V0OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChicm93c2VyID09ICdmaXJlZm94JyAmJiBmdWxsU3RhdHVzKSB7CiAgICAgICAgICAgICAgICAgICAgY29udHJvbEJ0bi5zdHlsZS5vcGFjaXR5ID0gJzEnOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjb250cm9sQnRuLnN0eWxlLm9wYWNpdHkgPSAnMC41JzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnRyb2xCdG4uY2xhc3NMaXN0LnJlbW92ZSgncGxheWVyQ29udHJvbEJ0bkNvbCcpOwogICAgICAgICAgICAgICAgY29udHJvbEJ0bi5zdHlsZS5vcGFjaXR5ID0gJzAuNSc7CiAgICAgICAgICAgICAgICBjb250cm9sQnRuLmlubmVySFRNTCA9IGJ0blRleHQub3V0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnRyb2xCdG4uc3R5bGUudG9wID0gcGxheWVyUmVjdC5zY3JlZW5ZIC0gMjAgKyAncHgnOwogICAgICAgICAgICBjb250cm9sQnRuLnN0eWxlLmxlZnQgPSBwbGF5ZXJSZWN0LnNjcmVlblggLSA2NCArIHBsYXllci5vZmZzZXRXaWR0aCArICdweCc7CiAgICAgICAgfQogICAgfTsKCiAgICB2YXIgaGFuZGxlID0gewogICAgICAgIGdldFBsYXllcjogZnVuY3Rpb24oZSkgewogICAgICAgICAgICBpZiAoZnVsbFN0YXR1cykgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciB0YXJnZXQgPSBlLnRhcmdldDsKICAgICAgICAgICAgaWYgKGh0bWw1UnVsZXNbZG9jdW1lbnQubG9jYXRpb24uaG9zdG5hbWVdKSB7CiAgICAgICAgICAgICAgICB2YXIgb3ZlcmxheSA9IFtdLAogICAgICAgICAgICAgICAgICAgIHBsYXllck51bSA9IFtdOwogICAgICAgICAgICAgICAgdmFyIG92ZXJsYXlSdWxlcyA9IGh0bWw1UnVsZXNbZG9jdW1lbnQubG9jYXRpb24uaG9zdG5hbWVdOwogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvdmVybGF5UnVsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcnVsZXMgPSBvdmVybGF5UnVsZXNbaV0uc3BsaXQoJ3wnKTsKICAgICAgICAgICAgICAgICAgICBvdmVybGF5W2ldID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChydWxlc1swXSk7CiAgICAgICAgICAgICAgICAgICAgcGxheWVyTnVtW2ldID0gcnVsZXNbMV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG92ZXJsYXkubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG92ZXJsYXlbaV0ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG92ZXJsYXlbaV1bal0gPT0gdGFyZ2V0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaHRtbDVQbGF5ZXIgPSB0YXJnZXQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzTmFOKE51bWJlcihwbGF5ZXJOdW1baV0pKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgcGxheWVyTnVtW2ldOyBrKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaHRtbDVQbGF5ZXIgPSBodG1sNVBsYXllci5wYXJlbnROb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaHRtbDVQbGF5ZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHBsYXllck51bVtpXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyID0gaHRtbDVQbGF5ZXI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRCdXR0b24uaW5pdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3dpdGNoICh0YXJnZXQubm9kZU5hbWUpIHsKICAgICAgICAgICAgICAgIGNhc2UgJ0lGUkFNRSc6CiAgICAgICAgICAgICAgICAgICAgaWYgKCFpZnJhbWVSdWxlcy50ZXN0KHRhcmdldC5jbGFzc05hbWUpICYmICFpZnJhbWVSdWxlcy50ZXN0KHRhcmdldC5zcmMpICYmICFpZnJhbWVSdWxlcy50ZXN0KHRhcmdldC5pZCkgJiYgaWZyYW1lVXJsUnVsZXMuaW5kZXhPZihkb2N1bWVudC5sb2NhdGlvbi5ob3N0bmFtZSkgPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlLmxlYXZlUGxheWVyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhc2UgJ09CSkVDVCc6CiAgICAgICAgICAgICAgICBjYXNlICdFTUJFRCc6CiAgICAgICAgICAgICAgICBjYXNlICdWSURFTyc6CiAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldC5vZmZzZXRXaWR0aCA+IDk5ICYmIHRhcmdldC5vZmZzZXRIZWlnaHQgPiA5OSkgewogICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXIgPSB0YXJnZXQ7CiAgICAgICAgICAgICAgICAgICAgICAgIHNldEJ1dHRvbi5pbml0KCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICBoYW5kbGUubGVhdmVQbGF5ZXIoKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgbGVhdmVQbGF5ZXI6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBpZiAoY29udHJvbEJ0bi5zdHlsZS52aXNpYmlsaXR5ID09ICd2aXNpYmxlJykgewogICAgICAgICAgICAgICAgY29udHJvbEJ0bi5zdHlsZS5vcGFjaXR5ID0gJyc7CiAgICAgICAgICAgICAgICBjb250cm9sQnRuLnN0eWxlLnZpc2liaWxpdHkgPSAnJzsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgcGxheWVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlbGVhdmUnLCBoYW5kbGUubGVhdmVQbGF5ZXIsIGZhbHNlKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICAgICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdzY3JvbGwnLCBoYW5kbGUuc2Nyb2xsRml4LCBmYWxzZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHNjcm9sbEZpeDogZnVuY3Rpb24oZSkgewogICAgICAgICAgICBjbGVhclRpbWVvdXQoYmFja1N0eWxlLnNjcm9sbEZpeFRpbWVyKTsKICAgICAgICAgICAgYmFja1N0eWxlLnNjcm9sbEZpeFRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHNldEJ1dHRvbi5sb2NhdGUoKTsKICAgICAgICAgICAgfSwgMjApOwogICAgICAgIH0sCiAgICAgICAgaG90S2V5OiBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIC8v6buY6K6k6YCA5Ye66ZSu5Li6RVND44CC6ZyA6KaB5L+u5pS55Li65YW25LuW5b+r5o236ZSu55qE6K+35pCc57SiImtleWNvZGUi77yM5L+u5pS55Li65oyJ6ZSu5a+55bqU55qE5pWw5a2X44CCCiAgICAgICAgICAgIGlmIChlLmtleUNvZGUgPT0gMjcpIHsKICAgICAgICAgICAgICAgIG1heGltaXplLnBsYXllckNvbnRyb2woKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgcmVzdG9yZUJ1dHRvbjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGlmIChpc0lmcmFtZSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN3aXRjaCAoYnJvd3NlcikgewogICAgICAgICAgICAgICAgY2FzZSAnY2hyb21lJzoKICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93Lm91dGVyV2lkdGggPCB3aW5kb3cuc2NyZWVuLndpZHRoIC0gMTApIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0QnV0dG9uLnNob3coKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdmaXJlZm94JzoKICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmlubmVyV2lkdGggPCB3aW5kb3cuc2NyZWVuLndpZHRoIC0gMTApIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0QnV0dG9uLnNob3coKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwoKICAgIHZhciBtYXhpbWl6ZSA9IHsKICAgICAgICBwbGF5ZXJDb250cm9sOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgaWYgKCFwbGF5ZXIpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmNoZWNrUGFyZW50KCk7CiAgICAgICAgICAgIGlmICghZnVsbFN0YXR1cykgewogICAgICAgICAgICAgICAgdGhpcy5mdWxsV2luKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLnNtYWxsV2luKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGNoZWNrUGFyZW50OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcGFyZW50QXJyYXkgPSBbXTsKICAgICAgICAgICAgdmFyIGZ1bGwgPSBwbGF5ZXI7CiAgICAgICAgICAgIHdoaWxlIChmdWxsID0gZnVsbC5wYXJlbnROb2RlKSB7CiAgICAgICAgICAgICAgICBpZiAoZnVsbC5ub2RlTmFtZSA9PSAnQk9EWScpIHsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChmdWxsLmdldEF0dHJpYnV0ZSkgewogICAgICAgICAgICAgICAgICAgIHBhcmVudEFycmF5LnB1c2goZnVsbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGZ1bGxXaW46IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBpZiAoIWZ1bGxTdGF0dXMpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlb3ZlcicsIGhhbmRsZS5nZXRQbGF5ZXIsIGZhbHNlKTsKICAgICAgICAgICAgICAgIGlmIChpc1JidG4pIHsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXIuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdmVyJywgaGFuZGxlLnJlc3RvcmVCdXR0b24sIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1vdXNlLm92ZXIgPSBwbGF5ZXIub25tb3VzZW92ZXI7CiAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllci5vbm1vdXNlb3ZlciA9IGhhbmRsZS5yZXN0b3JlQnV0dG9uOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJhY2tTdHlsZSA9IHsKICAgICAgICAgICAgICAgICAgICBodG1sSWQ6IGRvY3VtZW50LmJvZHkucGFyZW50Tm9kZS5pZCwKICAgICAgICAgICAgICAgICAgICBib2R5SWQ6IGRvY3VtZW50LmJvZHkuaWQKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBpZiAoZG9jdW1lbnQubG9jYXRpb24uaG9zdG5hbWUgPT0gJ3d3dy55b3V0dWJlLmNvbScpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcigneXRkLXdhdGNoLnl0ZC1wYWdlLW1hbmFnZXInKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3l0ZC13YXRjaC55dGQtcGFnZS1tYW5hZ2VyJykuaGFzQXR0cmlidXRlKCd0aGVhdGVyLXJlcXVlc3RlZF8nKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnl0cC1zaXplLWJ1dHRvbicpLmNsaWNrKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYWNrU3R5bGUueXRiU3RhZ2VDaGFuZ2UgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICghZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLndhdGNoLXN0YWdlLW1vZGUnKSkgewogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcueXRwLXNpemUtYnV0dG9uJykuY2xpY2soKTsKICAgICAgICAgICAgICAgICAgICAgICAgYmFja1N0eWxlLnl0YlN0YWdlQ2hhbmdlID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoZG9jdW1lbnQubG9jYXRpb24uaG9zdG5hbWUgPT0gJ2xpdmUuYmlsaWJpbGkuY29tJyAmJiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYmlsaWJpbGktbGl2ZS1wbGF5ZXInKSAmJiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYmlsaWJpbGktbGl2ZS1wbGF5ZXInKS5nZXRBdHRyaWJ1dGUoJ2RhdGEtcGxheWVyLXN0YXRlJykgIT0gJ3dlYi1mdWxsc2NyZWVuJykgewogICAgICAgICAgICAgICAgICAgIHVuc2FmZVdpbmRvdy4kKCcuYmlsaWJpbGktbGl2ZS1wbGF5ZXItdmlkZW8tZGFubWFrdScpLmRibGNsaWNrKCk7CiAgICAgICAgICAgICAgICAgICAgYmFja1N0eWxlLmJpbGlQbGF5ZXJDaGFuZ2UgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGRvY3VtZW50LmxvY2F0aW9uLmhvc3RuYW1lID09ICd2LnlvdWt1LmNvbScgJiYgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnZwYWN0aW9udjVfaWZyYW1lX3dyYXAnKSAmJiB0b29sLmdldFJlY3QocGxheWVyKS5wYWdlWSArIHBsYXllci5vZmZzZXRIZWlnaHQgLSB0b29sLmdldFJlY3QoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnZwYWN0aW9udjVfaWZyYW1lX3dyYXAnKSkucGFnZVkgPiAyMCkgewogICAgICAgICAgICAgICAgICAgIHBsYXllci5zdHlsZS5jc3NUZXh0ID0gJ2hlaWdodDogY2FsYygxMDB2aCArIDUwcHgpICFpbXBvcnRhbnQ7JzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChkb2N1bWVudC5sb2NhdGlvbi5ob3N0bmFtZSA9PSAnd3d3LnR1ZG91LmNvbScgJiYgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmFjdGlvbl9idXR0b25zLmZpeCcpICYmIHRvb2wuZ2V0UmVjdChwbGF5ZXIpLnBhZ2VZICsgcGxheWVyLm9mZnNldEhlaWdodCAtIHRvb2wuZ2V0UmVjdChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYWN0aW9uX2J1dHRvbnMuZml4JykpLnBhZ2VZID4gMjApIHsKICAgICAgICAgICAgICAgICAgICBwbGF5ZXIuc3R5bGUuY3NzVGV4dCA9ICdoZWlnaHQ6IGNhbGMoMTAwdmggKyA1NXB4KSAhaW1wb3J0YW50Oyc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoZG9jdW1lbnQubG9jYXRpb24uaG9zdG5hbWUgPT0gJ21wLndlaXhpbi5xcS5jb20nIHx8IGRvY3VtZW50LmxvY2F0aW9uLmhvc3RuYW1lID09ICd3d3cuZG9zZWVpbmcuY29tJykgewogICAgICAgICAgICAgICAgICAgIHBsYXllci5zdHlsZS5jc3NUZXh0ID0gJyc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBsZWZ0QnRuLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICAgICAgcmlnaHRCdG4uc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgICAgICBjb250cm9sQnRuLnN0eWxlLmRpc3BsYXkgPSAnJzsKICAgICAgICAgICAgICAgIHRoaXMuYWRkQ2xhc3MoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdWxsU3RhdHVzID0gdHJ1ZTsKICAgICAgICB9LAogICAgICAgIGFkZENsYXNzOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5wYXJlbnROb2RlLmlkID0gJ2h0bWxUb290aGJydXNoJzsKICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5pZCA9ICdib2R5VG9vdGhicnVzaCc7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGFyZW50QXJyYXkubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHBhcmVudEFycmF5W2ldLmNsYXNzTGlzdC5hZGQoJ3BhcmVudFRvb3RoYnJ1c2gnKTsKICAgICAgICAgICAgICAgIC8v54i25YWD57SgcG9zaXRpb246Zml4ZWTkvJrpgKDmiJDlsYLnuqfplJnkubEKICAgICAgICAgICAgICAgIGlmIChnZXRDb21wdXRlZFN0eWxlKHBhcmVudEFycmF5W2ldKS5wb3NpdGlvbiA9PSAnZml4ZWQnKSB7CiAgICAgICAgICAgICAgICAgICAgcGFyZW50QXJyYXlbaV0uY2xhc3NMaXN0LmFkZCgnYWJzb2x1dGVUb290aGJydXNoJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcGxheWVyLmNsYXNzTGlzdC5hZGQoJ3BsYXllclRvb3RoYnJ1c2gnKTsKICAgICAgICAgICAgaWYgKHBsYXllci5ub2RlTmFtZSA9PSAnVklERU8nKSB7CiAgICAgICAgICAgICAgICBiYWNrU3R5bGUuY29udHJvbHMgPSBwbGF5ZXIuY29udHJvbHM7CiAgICAgICAgICAgICAgICBwbGF5ZXIuY29udHJvbHMgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgncmVzaXplJykpOwogICAgICAgIH0sCiAgICAgICAgc21hbGxXaW46IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBpZiAoaXNSYnRuKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHBsYXllci5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZW92ZXInLCBoYW5kbGUucmVzdG9yZUJ1dHRvbiwgZmFsc2UpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgICAgICAgICAgIGlmIChtb3VzZS5vdmVyICE9ICdsaXN0ZW5lcicpIHsKICAgICAgICAgICAgICAgICAgICBwbGF5ZXIub25tb3VzZW92ZXIgPSBtb3VzZS5vdmVyOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucGFyZW50Tm9kZS5pZCA9IGJhY2tTdHlsZS5odG1sSWQ7CiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuaWQgPSBiYWNrU3R5bGUuYm9keUlkOwogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBhcmVudEFycmF5Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBwYXJlbnRBcnJheVtpXS5jbGFzc0xpc3QucmVtb3ZlKCdwYXJlbnRUb290aGJydXNoJyk7CiAgICAgICAgICAgICAgICBwYXJlbnRBcnJheVtpXS5jbGFzc0xpc3QucmVtb3ZlKCdhYnNvbHV0ZVRvb3RoYnJ1c2gnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBwbGF5ZXIuY2xhc3NMaXN0LnJlbW92ZSgncGxheWVyVG9vdGhicnVzaCcpOwogICAgICAgICAgICBpZiAoZG9jdW1lbnQubG9jYXRpb24uaG9zdG5hbWUgPT0gJ3d3dy55b3V0dWJlLmNvbScgJiYgYmFja1N0eWxlLnl0YlN0YWdlQ2hhbmdlKSB7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcueXRwLXNpemUtYnV0dG9uJykuY2xpY2soKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZG9jdW1lbnQubG9jYXRpb24uaG9zdG5hbWUgPT0gJ2xpdmUuYmlsaWJpbGkuY29tJyAmJiBiYWNrU3R5bGUuYmlsaVBsYXllckNoYW5nZSkgewogICAgICAgICAgICAgICAgdW5zYWZlV2luZG93LiQoJy5iaWxpYmlsaS1saXZlLXBsYXllci12aWRlby1kYW5tYWt1JykuZGJsY2xpY2soKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZG9jdW1lbnQubG9jYXRpb24uaG9zdG5hbWUgPT0gJ3YueW91a3UuY29tJyB8fCBkb2N1bWVudC5sb2NhdGlvbi5ob3N0bmFtZSA9PSAnd3d3LnR1ZG91LmNvbScpIHsKICAgICAgICAgICAgICAgIHBsYXllci5zdHlsZS5jc3NUZXh0ID0gJyc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHBsYXllci5ub2RlTmFtZSA9PSAnVklERU8nKSB7CiAgICAgICAgICAgICAgICBwbGF5ZXIuY29udHJvbHMgPSBiYWNrU3R5bGUuY29udHJvbHM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGVmdEJ0bi5zdHlsZS5kaXNwbGF5ID0gJyc7CiAgICAgICAgICAgIHJpZ2h0QnRuLnN0eWxlLmRpc3BsYXkgPSAnJzsKICAgICAgICAgICAgY29udHJvbEJ0bi5zdHlsZS5kaXNwbGF5ID0gJyc7CiAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlb3ZlcicsIGhhbmRsZS5nZXRQbGF5ZXIsIGZhbHNlKTsKICAgICAgICAgICAgd2luZG93LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCdyZXNpemUnKSk7CiAgICAgICAgICAgIGZ1bGxTdGF0dXMgPSBmYWxzZTsKICAgICAgICB9CiAgICB9OwoKICAgIHZhciBpbml0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgY29udHJvbEJ0biA9IGNyZWF0ZUJ1dHRvbigncGxheWVyQ29udHJvbEJ0bicpOwogICAgICAgIGxlZnRCdG4gPSBjcmVhdGVCdXR0b24oJ2xlZnRGdWxsU3RhY2tCdXR0b24nKTsKICAgICAgICByaWdodEJ0biA9IGNyZWF0ZUJ1dHRvbigncmlnaHRGdWxsU3RhY2tCdXR0b24nKTsKICAgICAgICBpZiAoZ2V0Q29tcHV0ZWRTdHlsZShjb250cm9sQnRuKS5wb3NpdGlvbiAhPSAnZml4ZWQnKSB7CiAgICAgICAgICAgIHRvb2wuYWRkU3R5bGUoWwogICAgICAgICAgICAgICAgJyNodG1sVG9vdGhicnVzaCwgI2JvZHlUb290aGJydXNoIHtvdmVyZmxvdzpoaWRkZW4gIWltcG9ydGFudDt6b29tOjEwMCUgIWltcG9ydGFudH0nLAogICAgICAgICAgICAgICAgJyNodG1sVG9vdGhicnVzaCAjYm9keVRvb3RoYnJ1c2ggLnBhcmVudFRvb3RoYnJ1c2gge292ZXJmbG93OnZpc2libGUgIWltcG9ydGFudDt6LWluZGV4OmF1dG8gIWltcG9ydGFudDt0cmFuc2Zvcm06bm9uZSAhaW1wb3J0YW50Oy13ZWJraXQtdHJhbnNmb3JtLXN0eWxlOmZsYXQgIWltcG9ydGFudDt0cmFuc2l0aW9uOm5vbmUgIWltcG9ydGFudDtjb250YWluOm5vbmUgIWltcG9ydGFudDt9JywKICAgICAgICAgICAgICAgICcjaHRtbFRvb3RoYnJ1c2ggI2JvZHlUb290aGJydXNoIC5hYnNvbHV0ZVRvb3RoYnJ1c2gge3Bvc2l0aW9uOmFic29sdXRlICFpbXBvcnRhbnQ7fScsCiAgICAgICAgICAgICAgICAnI2h0bWxUb290aGJydXNoICNib2R5VG9vdGhicnVzaCAucGxheWVyVG9vdGhicnVzaCB7cG9zaXRpb246Zml4ZWQgIWltcG9ydGFudDt0b3A6MHB4ICFpbXBvcnRhbnQ7bGVmdDoxcHggIWltcG9ydGFudDt3aWR0aDpjYWxjKDEwMHZ3IC0gMnB4KSAhaW1wb3J0YW50O2hlaWdodDoxMDB2aCAhaW1wb3J0YW50O21heC13aWR0aDpub25lICFpbXBvcnRhbnQ7bWF4LWhlaWdodDpub25lICFpbXBvcnRhbnQ7bWluLXdpZHRoOjAgIWltcG9ydGFudDttaW4taGVpZ2h0OjAgIWltcG9ydGFudDttYXJnaW46MCAhaW1wb3J0YW50O3BhZGRpbmc6MCAhaW1wb3J0YW50O3otaW5kZXg6MjE0NzQ4MzY0NSAhaW1wb3J0YW50O2JvcmRlcjpub25lICFpbXBvcnRhbnQ7YmFja2dyb3VuZC1jb2xvcjojMDAwICFpbXBvcnRhbnQ7dHJhbnNmb3JtOm5vbmUgIWltcG9ydGFudDt9JywKICAgICAgICAgICAgICAgICcjaHRtbFRvb3RoYnJ1c2ggI2JvZHlUb290aGJydXNoIC5wbGF5ZXJUb290aGJydXNoIHZpZGVvIHtvYmplY3QtZml0OmNvbnRhaW4gIWltcG9ydGFudDt9JywKICAgICAgICAgICAgICAgICcjcGxheWVyQ29udHJvbEJ0biB7dmlzaWJpbGl0eTpoaWRkZW47b3BhY2l0eTowO2Rpc3BsYXk6bm9uZTt0cmFuc2l0aW9uOiBhbGwgMC41cyBlYXNlO2N1cnNvcjogcG9pbnRlcjtmb250OiAxMnB4ICLlvq7ova/pm4Xpu5EiO21hcmdpbjowO3dpZHRoOjY0cHg7aGVpZ2h0OjIwcHg7bGluZS1oZWlnaHQ6MjBweDtib3JkZXI6bm9uZTt0ZXh0LWFsaWduOiBjZW50ZXI7cG9zaXRpb246IGZpeGVkO3otaW5kZXg6MjE0NzQ4MzY0NjtiYWNrZ3JvdW5kLWNvbG9yOiAjMjdBOUQ4O2NvbG9yOiAjRkZGO30gI3BsYXllckNvbnRyb2xCdG46aG92ZXIge3Zpc2liaWxpdHk6dmlzaWJsZTtvcGFjaXR5OjE7YmFja2dyb3VuZC1jb2xvcjojMjc3NEQ4O30nLAogICAgICAgICAgICAgICAgJyNwbGF5ZXJDb250cm9sQnRuLnBsYXllckNvbnRyb2xCdG5Db2wge3dpZHRoOjIwcHg7aGVpZ2h0OjY0cHg7bGluZS1oZWlnaHQ6MTZweDt9JywKICAgICAgICAgICAgICAgICcjbGVmdEZ1bGxTdGFja0J1dHRvbntkaXNwbGF5Om5vbmU7cG9zaXRpb246Zml4ZWQ7d2lkdGg6MXB4O2hlaWdodDoxMDB2aDt0b3A6MDtsZWZ0OjA7ei1pbmRleDoyMTQ3NDgzNjQ2O2JhY2tncm91bmQ6IzAwMDt9JywKICAgICAgICAgICAgICAgICcjcmlnaHRGdWxsU3RhY2tCdXR0b257ZGlzcGxheTpub25lO3Bvc2l0aW9uOmZpeGVkO3dpZHRoOjFweDtoZWlnaHQ6MTAwdmg7dG9wOjA7cmlnaHQ6MDt6LWluZGV4OjIxNDc0ODM2NDY7YmFja2dyb3VuZDojMDAwO30nCiAgICAgICAgICAgIF0uam9pbignXG4nKSk7CiAgICAgICAgICAgIHRvb2wuYWRkU3R5bGUoWwogICAgICAgICAgICAgICAgLy93ZWlibwogICAgICAgICAgICAgICAgJyNodG1sVG9vdGhicnVzaCAjYm9keVRvb3RoYnJ1c2ggLm5vZGUtdmlkZW8ubm9kZS1mdWxsIHZpZGVvLCNodG1sVG9vdGhicnVzaCAjYm9keVRvb3RoYnJ1c2ggLldCX2g1dmlkZW8gdmlkZW8ge3dpZHRoOiBpbmhlcml0ICFpbXBvcnRhbnQ7aGVpZ2h0OiBpbmhlcml0ICFpbXBvcnRhbnQ7fScsCiAgICAgICAgICAgICAgICAvL2RvdXl1CiAgICAgICAgICAgICAgICAnI2h0bWxUb290aGJydXNoICNib2R5VG9vdGhicnVzaCAjZG91eXVfcm9vbV9ub3JtYWxfZmxhc2hfcHJveHlfYm94IHtwb3NpdGlvbjpmaXhlZCAhaW1wb3J0YW50O3RvcDowcHggIWltcG9ydGFudDtsZWZ0OjFweCAhaW1wb3J0YW50O3dpZHRoOmNhbGMoMTAwdncgLSAycHgpICFpbXBvcnRhbnQ7aGVpZ2h0OjEwMHZoICFpbXBvcnRhbnQ7bWF4LXdpZHRoOm5vbmUgIWltcG9ydGFudDttYXgtaGVpZ2h0Om5vbmUgIWltcG9ydGFudDttaW4td2lkdGg6MCAhaW1wb3J0YW50O21pbi1oZWlnaHQ6MCAhaW1wb3J0YW50O21hcmdpbjowICFpbXBvcnRhbnQ7cGFkZGluZzowICFpbXBvcnRhbnQ7ei1pbmRleDoyMTQ3NDgzNjQ1ICFpbXBvcnRhbnQ7Ym9yZGVyOm5vbmUgIWltcG9ydGFudDtiYWNrZ3JvdW5kLWNvbG9yOiMwMDAgIWltcG9ydGFudDt0cmFuc2Zvcm06bm9uZSAhaW1wb3J0YW50O30nCiAgICAgICAgICAgIF0uam9pbignXG4nKSk7CiAgICAgICAgfQogICAgfTsKCiAgICBpbml0KCk7CgogICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdmVyJywgaGFuZGxlLmdldFBsYXllciwgZmFsc2UpOwogICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGhhbmRsZS5ob3RLZXksIGZhbHNlKTsKCn0pKCk7"},{"name":"YouTube +","options":{"check_for_updates":true,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_arrayleft":false,"compat_uW_gmonkey":false,"compat_forvarin":false,"noframes":null,"awareOfChrome":false,"run_at":null,"override":{"use_includes":[],"orig_includes":[],"merge_includes":true,"use_matches":[],"orig_matches":["*://www.youtube.com/*"],"merge_matches":true,"use_excludes":[],"orig_excludes":["*://www.youtube.com/tv*","*://www.youtube.com/embed/*","*://www.youtube.com/live_chat*"],"merge_excludes":true,"use_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-start","orig_noframes":true,"orig_connects":[]}},"storage":{"ts":1521543167144,"data":{"particleSettings":"s{\"GEN_BTTR_NTF\":true,\"GEN_SUB_LIST\":true,\"GEN_INF_SCRL\":true,\"GEN_BLUE_GLOW\":true,\"GEN_PPOT_ON\":true,\"VID_END_SHRE\":true,\"VID_DFLT_QLTY\":\"auto\",\"VID_PLST_ATPL\":true,\"VID_PLST_RVRS\":true,\"VID_PLR_ATPL\":true,\"VID_PLR_ALVIS\":true,\"VID_PLR_SIZE_MEM\":true,\"VID_PLR_VOL_LDN\":true,\"VID_POST_TIME\":true,\"VID_VID_CNT\":true,\"VID_DESC_SHRT\":true,\"VID_PPOT_SZ\":533,\"VID_PLR_HTML5\":true,\"BLK_ON\":true,\"floaterX\":2000,\"floaterY\":2000,\"firstTime\":false,\"volLev\":50,\"advOpts\":true,\"blacklist\":[],\"extLang\":{\"zh_CN\":{\"YTSETS\":\"YouTube+ 设置\",\"ADV_OPTS\":\"高级选项\",\"SUB_PLST\":\"播放最新上传的内容\",\"PPOT_OPEN\":\"在弹出窗口中打开\",\"BLCK_ADD\":\"添加到黑名单\",\"BLCK_EDIT\":\"编辑\",\"BLCK_SAVE\":\"保存\",\"BLCK_CLSE\":\"关闭\",\"CNSL_AP\":\"自动播放\",\"CNSL_RPT\":\"循环播放\",\"CNSL_SVTH\":\"打开缩略图\",\"CNSL_SS\":\"画面截图\",\"CNSL_SS_CLS\":\"关闭\",\"CNSL_PPOT\":\"弹出播放视频\",\"CNSL_FLBR\":\"网页全屏模式\",\"CNSL_CINM_MD\":\"影院模式\",\"CNSL_YTSC\":\"YouTube 快捷键列表\",\"PLST_AP\":\"自动播放\",\"PLST_RVRS\":\"倒序排列\",\"SHOW_CMTS\":\"显示评论\",\"HIDE_CMTS\":\"隐藏评论\",\"GLB_IMPR\":\"导入/导出设置\",\"GLB_LOCL_LANG\":\"点击修改 YT+ 语言\",\"GLB_LOCL_LANG_CSTM\":\"本地化\",\"GLB_IMPR_SAVE\":\"保存并加载\",\"GLB_RSET\":\"重置\",\"GLB_RSET_CONF\":\"这将重置YT+的所有设置和黑名单。是否要继续？\",\"GLB_SVE\":\"保存\",\"GLB_SVE_SETS\":\"设置已保存\",\"GLB_RMBL\":\"从黑名单中移除\",\"FTR_DESC\":\"详细了解\",\"GEN\":\"常规\",\"VID\":\"视频\",\"CHN\":\"频道\",\"BLK\":\"黑名单\",\"ABT\":\"关于\",\"HLP\":\"帮助\",\"DNT\":\"捐赠\",\"GEN_TTL\":\"通用设置\",\"GEN_GEN\":\"常规\",\"GEN_LYT\":\"布局\",\"GEN_LOCL_LANG\":\"使用自定义的 YT+ 语言包\",\"GEN_PPOT_ON\":\"启用弹出模式\",\"GEN_DSBL_ADS\":\"禁止视频页面以外的广告\",\"GEN_INF_SCRL\":\"在信息源列表启用无限滚动\",\"GEN_YT_LOGO_LINK\":\"YouTube 标志重定向到订阅页\",\"GEN_SUB_LIST\":\"启用订阅播放列表\",\"GEN_REM_APUN\":\"去除自动播放下一个\",\"GEN_SPF_OFF\":\"禁用动态加载\",\"GEN_HIDE_FTR\":\"隐藏页脚\",\"GEN_BLUE_GLOW\":\"去除点击过的按钮周围的蓝色光圈\",\"GEN_HDE_RECM_SDBR\":\"隐藏推荐频道侧边栏\",\"GEN_HDE_SRCH_SDBR\":\"隐藏搜索结果侧边栏\",\"GEN_HDE_CHN_SDBR\":\"隐藏频道侧边栏\",\"GEN_CMPT_TTLS\":\"在信息源中使用缩略标题\",\"GEN_DSB_HVRC\":\"禁用悬停卡片\",\"GEN_BTTR_NTF\":\"改进的蓝色通知框\",\"GEN_GRID_SUBS\":\"在订阅中使用网格布局\",\"GEN_GRID_SRCH\":\"在搜索结果中使用网格布局\",\"VID_TTL\":\"视频设置\",\"VID_PLR\":\"播放器设置\",\"VID_PLR_LYT\":\"播放器布局\",\"VID_DFLT_QLTY\":\"默认视频质量：\",\"VID_DFLT_QLTY_AUTO\":\"自动\",\"VID_DFLT_QLTY_TNY\":\"144p\",\"VID_DFLT_QLTY_SML\":\"240p\",\"VID_DFLT_QLTY_MDM\":\"360p\",\"VID_DFLT_QLTY_LRG\":\"480p\",\"VID_DFLT_QLTY_720\":\"720p\",\"VID_DFLT_QLTY_1080\":\"1080p\",\"VID_DFLT_QLTY_1440\":\"1440p\",\"VID_DFLT_QLTY_2160\":\"2160p (4k)\",\"VID_DFLT_QLTY_2880\":\"2880p (5k)\",\"VID_DFLT_QLTY_ORIG\":\"4320p (8k)\",\"VID_PLR_ALVIS\":\"阅读评论时保持播放器可见\",\"VID_PLR_ALVIS_WDTH\":\"悬浮播放器宽度\",\"VID_PLR_ALVIS_RST\":\"重设位置\",\"VID_PLR_ALVIS_SCRL_TOP\":\"返回顶部\",\"VID_PLR_ATPL\":\"自动播放视频\",\"VID_LAYT\":\"布局\",\"VID_VID_CNT\":\"显示已上传视频数及链接\",\"VID_POST_TIME\":\"显示视频已发布时间\",\"VID_HIDE_DETLS\":\"隐藏视频详细信息\",\"VID_HIDE_COMS\":\"评论区\",\"VID_HIDE_COMS_SHOW\":\"显示\",\"VID_HIDE_COMS_HIDE\":\"隐藏\",\"VID_HIDE_COMS_REM\":\"去除\",\"VID_END_SHRE\":\"禁用视频结束时的分享面板\",\"VID_PLST\":\"播放列表\",\"VID_PLST_ATPL\":\"启用播放列表的自动播放按钮\",\"VID_PLST_RVRS\":\"启用播放列表的倒序排列按钮\",\"VID_PLR_SIZE_MEM\":\"记住播放模式\",\"VID_VOL_WHEEL\":\"使用鼠标滚轮更改音量\",\"VID_PLR_VOL_MEM\":\"记住音量\",\"VID_PLR_VOL_LDN\":\"禁用 YouTube 响度统一化\",\"VID_PLR_ADS\":\"禁用视频页面中的广告\",\"VID_PLR_ALACT\":\"播放器快捷键始终生效\",\"VID_SUB_ADS\":\"仅启用已订阅频道中视频的广告\",\"VID_PLR_ANTS\":\"禁用注释\",\"VID_PLR_HFR\":\"禁用高帧率 (60fps)\",\"VID_PLR_HTML5\":\"可能时使用 HTML 5 播放器\",\"VID_PLR_CC\":\"禁用字幕和隐藏式字幕\",\"VID_PLR_INFO\":\"启用稍后观看按钮\",\"VID_PLR_FIT\":\"为剧场模式适配页面\",\"VID_PLR_FIT_WDTH\":\"适配页面最大宽度:\",\"VID_PLR_DYN_SIZE\":\"默认视图中禁用播放器动态调节尺寸\",\"VID_DESC_SHRT\":\"小巧的视频描述按钮\",\"VID_TTL_CMPT\":\"缩略视频描述标题\",\"VID_PPOT_SZ\":\"弹出播放器的大小\",\"VID_LAYT_AUTO_PNL\":\"自动展开视频描述\",\"GEN_CHN_DFLT_PAGE\":\"默认的频道页面：\",\"GEN_CHN_DFLT_PAGE_DFLT\":\"默认\",\"GEN_CHN_DFLT_PAGE_VID\":\"视频\",\"GEN_CHN_DFLT_PAGE_PL\":\"播放列表\",\"GEN_CHN_DFLT_PAGE_CHN\":\"频道\",\"GEN_CHN_DFLT_PAGE_DISC\":\"讨论\",\"GEN_CHN_DFLT_PAGE_ABT\":\"关于\",\"BLK_TTL\":\"黑名单设置\",\"BLK_BLK\":\"黑名单\",\"BLK_ON\":\"启用黑名单\",\"ABT_TTL\":\"相关信息和实用链接\",\"ABT_THKS\":\"鸣谢：\",\"ABT_THKS_YEPPHA\":\"，他们的成果给此项目带来了灵感，没有他们，今天这些就不会存在。\",\"ABT_THKS_USERSCRIPT\":\" 使开发和发行第三方软件的任务无比简单。\",\"ABT_THKS_STACKOV\":\" 无价的信息对软件开发做出了巨大贡献。\",\"ABT_INFO\":\"官方页面\",\"ABT_LNK_GHB\":\"GitHub\",\"ABT_LNK_GRFK\":\"Greasy Fork\",\"ABT_LNK_OPNU\":\"OpenUserJS\",\"WLCM\":\"感谢您安装 YouTube+\",\"WLCMSTRT\":\"您可以点击上面的按钮来自定义您的设置\",\"WLCMFTRS\":\"点击这里查看所有特性的介绍\",\"LOCALE\":\"中文 (简体)\",\"lastMod\":1516345589000},\"nextCheck\":1522147965749}}"}},"enabled":false,"position":2,"file_url":"https://github.com/ParticleCore/Particle/raw/master/src/Userscript/YouTubePlus.user.js","uuid":"8f4192a0-daa4-48a6-b25b-4b8d95356b18","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQHZlcnNpb24gICAgICAgICAxLjkuNAovLyBAbmFtZSAgICAgICAgICAgIFlvdVR1YmUgKwovLyBAbmFtZXNwYWNlICAgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUKLy8gQGRlc2NyaXB0aW9uICAgICBZb3VUdWJlIHdpdGggbW9yZSBmcmVlZG9tCi8vIEBjb21wYXRpYmxlICAgICAgZmlyZWZveAovLyBAY29tcGF0aWJsZSAgICAgIG9wZXJhCi8vIEBpY29uICAgICAgICAgICAgaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS9naC1wYWdlcy9pbWFnZXMvWVQlMkJpY29uLnBuZwovLyBAbWF0Y2ggICAgICAgICAgICo6Ly93d3cueW91dHViZS5jb20vKgovLyBAZXhjbHVkZSAgICAgICAgICo6Ly93d3cueW91dHViZS5jb20vdHYqCi8vIEBleGNsdWRlICAgICAgICAgKjovL3d3dy55b3V0dWJlLmNvbS9lbWJlZC8qCi8vIEBleGNsdWRlICAgICAgICAgKjovL3d3dy55b3V0dWJlLmNvbS9saXZlX2NoYXQqCi8vIEBydW4tYXQgICAgICAgICAgZG9jdW1lbnQtc3RhcnQKLy8gQGRvd25sb2FkVVJMICAgICBodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3Jhdy9tYXN0ZXIvc3JjL1VzZXJzY3JpcHQvWW91VHViZVBsdXMudXNlci5qcwovLyBAaG9tZXBhZ2VVUkwgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUKLy8gQHN1cHBvcnRVUkwgICAgICBodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kKLy8gQGNvbnRyaWJ1dGlvblVSTCBodHRwczovL3d3dy5wYXlwYWwuY29tL2NnaS1iaW4vd2Vic2NyP2NtZD1fcy14Y2xpY2smaG9zdGVkX2J1dHRvbl9pZD1VTVZRSkpGRzRCRkhXCi8vIEBncmFudCAgICAgICAgICAgR01fZ2V0VmFsdWUKLy8gQGdyYW50ICAgICAgICAgICBHTV9zZXRWYWx1ZQovLyBAbm9mcmFtZXMKLy8gPT0vVXNlclNjcmlwdD09CihmdW5jdGlvbiAoKSB7CiAgICAidXNlIHN0cmljdCI7CiAgICB2YXIgcGFydGljbGUgPSB7CiAgICAgICAgaW5qZWN0OiBmdW5jdGlvbihpc191c2Vyc2NyaXB0KSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIHNldExvY2FsZShjb250ZW50KSB7CiAgICAgICAgICAgICAgICB2YXIgaSwgaiwgbGlzdCwgdGVtcCwgeXRwbGFiZWw7CiAgICAgICAgICAgICAgICB5dHBsYWJlbCA9IGNvbnRlbnQucXVlcnlTZWxlY3RvckFsbCgiW2RhdGEtcF0iKTsKICAgICAgICAgICAgICAgIGkgPSB5dHBsYWJlbC5sZW5ndGg7CiAgICAgICAgICAgICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgICAgICAgICAgICAgbGlzdCA9IHl0cGxhYmVsW2ldLmRhdGFzZXQucC5zcGxpdCgiJiIpOwogICAgICAgICAgICAgICAgICAgIGogPSBsaXN0Lmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoai0tKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXAgPSBsaXN0W2pdLnNwbGl0KCJ8Iik7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ZW1wWzBdID09PSAidG5kIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgeXRwbGFiZWxbaV0uYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUobGFuZyh0ZW1wWzFdKSkpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRlbXBbMF0gPT09ICJ0dGwiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5dHBsYWJlbFtpXS5zZXRBdHRyaWJ1dGUoInRpdGxlIiwgbGFuZyh0ZW1wWzFdKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5dHBsYWJlbFtpXS5kYXRhc2V0LnRvb2x0aXBUZXh0ID0gbGFuZyh0ZW1wWzFdKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBjb250ZW50OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGdldExvY2FsZShkYXRhKSB7CiAgICAgICAgICAgICAgICBsYW5nLmZldGNoaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICBkYXRhID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmRhdGFzZXQuc2V0bG9jYWxlOwogICAgICAgICAgICAgICAgZGF0YSA9IGRhdGEgJiYgSlNPTi5wYXJzZShkYXRhKTsKICAgICAgICAgICAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgdXNlcl9zZXR0aW5ncy5leHRMYW5nW2xhbmcueXRsYW5nXSA9IEpTT04ucGFyc2UoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmRhdGFzZXQuc2V0bG9jYWxlKTsKICAgICAgICAgICAgICAgICAgICB1c2VyX3NldHRpbmdzLmV4dExhbmdbbGFuZy55dGxhbmddLmxhc3RNb2QgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKICAgICAgICAgICAgICAgICAgICB1c2VyX3NldHRpbmdzLmV4dExhbmcubmV4dENoZWNrID0gbmV3IERhdGUoKS5nZXRUaW1lKCkgKyA2MDQ4RTU7CiAgICAgICAgICAgICAgICAgICAgc2V0KCJleHRMYW5nIiwgdXNlcl9zZXR0aW5ncy5leHRMYW5nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxhbmcub2JzZXJ2ZXIuZGlzY29ubmVjdCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGdldExhbmd1YWdlKGRhdGEpIHsKICAgICAgICAgICAgICAgIGxhbmcuZmV0Y2hpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGlmIChkYXRhLnRhcmdldC5yZWFkeVN0YXRlID09PSA0ICYmIGRhdGEudGFyZ2V0LnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgdXNlcl9zZXR0aW5ncy5leHRMYW5nW2xhbmcueXRsYW5nXSA9IEpTT04ucGFyc2UoZGF0YS50YXJnZXQucmVzcG9uc2UpOwogICAgICAgICAgICAgICAgICAgIHVzZXJfc2V0dGluZ3MuZXh0TGFuZ1tsYW5nLnl0bGFuZ10ubGFzdE1vZCA9IG5ldyBEYXRlKGRhdGEudGFyZ2V0LmdldFJlc3BvbnNlSGVhZGVyKCJMYXN0LU1vZGlmaWVkIikpLmdldFRpbWUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHVzZXJfc2V0dGluZ3MuZXh0TGFuZy5uZXh0Q2hlY2sgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSArIDYwNDhFNTsKICAgICAgICAgICAgICAgIHNldCgiZXh0TGFuZyIsIHVzZXJfc2V0dGluZ3MuZXh0TGFuZyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gY2hlY2tNb2RpZmllZChkYXRhKSB7CiAgICAgICAgICAgICAgICBsYW5nLmZldGNoaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICBpZiAoZGF0YS50YXJnZXQucmVhZHlTdGF0ZSA9PT0gNCAmJiBkYXRhLnRhcmdldC5zdGF0dXMgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgIGxhbmcuZmV0Y2hpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGxvY2FsWEhSKCJHRVQiLCBnZXRMYW5ndWFnZSwgbGFuZy51cmxCYXNlICsgbGFuZy55dGxhbmcgKyAiLmpzb24iLCBbIkFjY2VwdCIsICJhcHBsaWNhdGlvbi92bmQuZ2l0aHViLnJhdyJdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBsYW5nKGxhYmVsKSB7CiAgICAgICAgICAgICAgICBsYW5nLnl0bGFuZyA9IHdpbmRvdy55dCAmJiB3aW5kb3cueXQuY29uZmlnXyAmJiB3aW5kb3cueXQuY29uZmlnXy5HQVBJX0xPQ0FMRTsKICAgICAgICAgICAgICAgIGxhbmcudXJsQmFzZSA9ICJodHRwczovL2FwaS5naXRodWIuY29tL3JlcG9zL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS9jb250ZW50cy9Mb2NhbGUvIjsKICAgICAgICAgICAgICAgIGlmICghdXNlcl9zZXR0aW5ncy5leHRMYW5nKSB7CiAgICAgICAgICAgICAgICAgICAgc2V0KCJleHRMYW5nIiwge30pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuR0VOX0xPQ0xfTEFORyAmJiB1c2VyX3NldHRpbmdzLmxvY2FsTGFuZyAmJiB1c2VyX3NldHRpbmdzLmxvY2FsTGFuZ1tsYWJlbF0pIHsKICAgICAgICAgICAgICAgICAgICBpZiAoSlNPTi5zdHJpbmdpZnkodXNlcl9zZXR0aW5ncy5leHRMYW5nKSAhPT0gInt9IikgewogICAgICAgICAgICAgICAgICAgICAgICBzZXQoImV4dExhbmciLCB7fSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiB1c2VyX3NldHRpbmdzLmxvY2FsTGFuZ1tsYWJlbF07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoIXVzZXJfc2V0dGluZ3MuR0VOX0xPQ0xfTEFORyAmJiBsYW5nLnl0bGFuZyAmJiBsYW5nLnl0bGFuZyAhPT0gImVuX1VTIikgewogICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLmV4dExhbmdbbGFuZy55dGxhbmddICYmIHVzZXJfc2V0dGluZ3MuZXh0TGFuZ1tsYW5nLnl0bGFuZ11bbGFiZWxdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghbGFuZy5mZXRjaGluZyAmJiB1c2VyX3NldHRpbmdzLmV4dExhbmcubmV4dENoZWNrICYmIHVzZXJfc2V0dGluZ3MuZXh0TGFuZy5uZXh0Q2hlY2sgPD0gbmV3IERhdGUoKS5nZXRUaW1lKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhbmcuZmV0Y2hpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpc191c2Vyc2NyaXB0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFuZy5vYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKGdldExvY2FsZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFuZy5vYnNlcnZlci5vYnNlcnZlKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVGaWx0ZXI6IFsiZGF0YS1zZXRsb2NhbGUiXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5kYXRhc2V0LmdldGxvY2FsZSA9IGxhbmcueXRsYW5nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFhIUigiSEVBRCIsIGNoZWNrTW9kaWZpZWQsIGxhbmcudXJsQmFzZSArIGxhbmcueXRsYW5nICsgIi5qc29uIiwgWyJJZi1Nb2RpZmllZC1TaW5jZSIsIG5ldyBEYXRlKHVzZXJfc2V0dGluZ3MuZXh0TGFuZ1tsYW5nLnl0bGFuZ10ubGFzdE1vZCkudG9VVENTdHJpbmcoKV0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcl9zZXR0aW5ncy5leHRMYW5nLm5leHRDaGVjayA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgNjA0OEU1OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0KCJleHRMYW5nIiwgdXNlcl9zZXR0aW5ncy5leHRMYW5nKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXNlcl9zZXR0aW5ncy5leHRMYW5nW2xhbmcueXRsYW5nXVtsYWJlbF07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICghdXNlcl9zZXR0aW5ncy5leHRMYW5nW2xhbmcueXRsYW5nXSAmJiAhbGFuZy5mZXRjaGluZyAmJiAoIXVzZXJfc2V0dGluZ3MuZXh0TGFuZy5uZXh0Q2hlY2sgfHwgdXNlcl9zZXR0aW5ncy5leHRMYW5nLm5leHRDaGVjayA8PSBuZXcgRGF0ZSgpLmdldFRpbWUoKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGFuZy5mZXRjaGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaXNfdXNlcnNjcmlwdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFuZy5vYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKGdldExvY2FsZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYW5nLm9ic2VydmVyLm9ic2VydmUoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlczogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVGaWx0ZXI6IFsiZGF0YS1zZXRsb2NhbGUiXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuZGF0YXNldC5nZXRsb2NhbGUgPSBsYW5nLnl0bGFuZzsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsWEhSKCJHRVQiLCBnZXRMYW5ndWFnZSwgbGFuZy51cmxCYXNlICsgbGFuZy55dGxhbmcgKyAiLmpzb24iLCBbIkFjY2VwdCIsICJhcHBsaWNhdGlvbi92bmQuZ2l0aHViLnJhdyJdKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBsYW5ndWFnZVtsYWJlbF07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gZ2V0QmxhY2tsaXN0KGJsaXN0KSB7CiAgICAgICAgICAgICAgICB2YXIgaSwgb2JqLCB0ZW1wLCBsbmssIGxpc3QsIGZyYWdtZW50OwogICAgICAgICAgICAgICAgbGlzdCA9IHVzZXJfc2V0dGluZ3MuYmxhY2tsaXN0OwogICAgICAgICAgICAgICAgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7CiAgICAgICAgICAgICAgICB0ZW1wID0gbGlzdDsKICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB0ZW1wLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgb2JqID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGVtcGxhdGUiKTsKICAgICAgICAgICAgICAgICAgICBvYmouaW5uZXJIVE1MID0gLy8KICAgICAgICAgICAgICAgICAgICAgICAgYDxkaXYgY2xhc3M9J2JsYWNrbGlzdCc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSdjbG9zZScgZGF0YS1wPSd0dGx8R0xCX1JNQkwnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzdmcgdmlld0JveD0nMCAwIDEwIDEwJz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHBvbHlnb24gcG9pbnRzPScxMCwxLjQgOC42LDAgNSwzLjYgMS40LDAgMCwxLjQgMy42LDUgMCw4LjYgMS40LDEwIDUsNi40IDguNiwxMCAxMCw4LjYgNi40LDUnLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3N2Zz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPjxhIHRhcmdldD0nX2JsYW5rJz48L2E+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgICAgICAgICAgICAgb2JqID0gc2V0TG9jYWxlKG9iai5jb250ZW50LmZpcnN0Q2hpbGQpOwogICAgICAgICAgICAgICAgICAgIGxuayA9IG9iai5xdWVyeVNlbGVjdG9yKCJhIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRlbXBbaV0udWNpZCAhPT0gIiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG5rLmhyZWYgPSAiL2NoYW5uZWwvIiArIHRlbXBbaV0udWNpZDsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBsbmsuaHJlZiA9ICIvdXNlci8iICsgdGVtcFtpXS5jYW5vbmljYWw7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGxuay5zZXRBdHRyaWJ1dGUoInRpdGxlIiwgdGVtcFtpXS5uYW1lKTsKICAgICAgICAgICAgICAgICAgICBsbmsudGV4dENvbnRlbnQgPSB0ZW1wW2ldLm5hbWU7CiAgICAgICAgICAgICAgICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQob2JqKTsKICAgICAgICAgICAgICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgiXG4iKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBibGlzdC5hcHBlbmRDaGlsZChmcmFnbWVudCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gZ2V0VmFsdWVzKG1lbnUpIHsKICAgICAgICAgICAgICAgIHZhciBpLCB5dHAsIGxpc3Q7CiAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncykgewogICAgICAgICAgICAgICAgICAgIGxpc3QgPSBtZW51LnF1ZXJ5U2VsZWN0b3IoIiNibGFja2xpc3QiKTsKICAgICAgICAgICAgICAgICAgICBpZiAobGlzdCkgewogICAgICAgICAgICAgICAgICAgICAgICBnZXRCbGFja2xpc3QobGlzdCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHl0cCA9IG1lbnUucXVlcnlTZWxlY3RvckFsbCgiaW5wdXRbaWRdIik7CiAgICAgICAgICAgICAgICAgICAgaSA9IHl0cC5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoeXRwW2ldLnR5cGUgPT09ICJjaGVja2JveCIgJiYgdXNlcl9zZXR0aW5nc1t5dHBbaV0uaWRdID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5dHBbaV0uc2V0QXR0cmlidXRlKCJjaGVja2VkIiwgInRydWUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoeXRwW2ldLnR5cGUgPT09ICJ0ZXh0IiAmJiB0eXBlb2YgdXNlcl9zZXR0aW5nc1t5dHBbaV0uaWRdID09PSAnc3RyaW5nJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgeXRwW2ldLnNldEF0dHJpYnV0ZSgidmFsdWUiLCB1c2VyX3NldHRpbmdzW3l0cFtpXS5pZF0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHl0cCA9IG1lbnUucXVlcnlTZWxlY3RvckFsbCgib3B0aW9uIik7CiAgICAgICAgICAgICAgICAgICAgaSA9IHl0cC5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5nc1t5dHBbaV0ucGFyZW50Tm9kZS5pZF0gPT09IHl0cFtpXS52YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgeXRwW2ldLnNldEF0dHJpYnV0ZSgic2VsZWN0ZWQiLCAidHJ1ZSIpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIG1lbnU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gZ2V0TWVudShzZWN0aW9uKSB7CiAgICAgICAgICAgICAgICB2YXIgaSwgdGVtcCwgc3ZnLCBpbnB1dHM7CiAgICAgICAgICAgICAgICB0ZW1wID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGVtcGxhdGUiKTsKICAgICAgICAgICAgICAgIGlmIChzZWN0aW9uID09PSAiTUVOIikgewogICAgICAgICAgICAgICAgICAgIHRlbXAuaW5uZXJIVE1MID0gLy8KICAgICAgICAgICAgICAgICAgICAgICAgYDxkaXYgaWQ9J1Atc2V0dGluZ3MnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0nUC1jb250YWluZXInPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9J1Atc2lkZWJhcic+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx1bCBpZD0nUC1zaWRlYmFyLWxpc3QnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpIGlkPSdHRU4nIGNsYXNzPSdzZWxlY3RlZCcgZGF0YS1wPSd0bmR8R0VOJz48L2xpPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpIGlkPSdWSUQnIGRhdGEtcD0ndG5kfFZJRCc+PC9saT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsaSBpZD0nQkxLJyBkYXRhLXA9J3RuZHxCTEsnPjwvbGk+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGkgaWQ9J0FCVCcgZGF0YS1wPSd0bmR8QUJUJz48L2xpPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpIGlkPSdITFAnPjxhIHRhcmdldD0nX2JsYW5rJyBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2knIGRhdGEtcD0ndG5kfEhMUCc+PC9hPjwvbGk+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGkgaWQ9J0ROVCc+PGEgdGl0bGU9J1BheVBhbCcgdGFyZ2V0PSdfYmxhbmsnIGhyZWY9J2h0dHBzOi8vd3d3LnBheXBhbC5jb20vY2dpLWJpbi93ZWJzY3I/Y21kPV9zLXhjbGljayZob3N0ZWRfYnV0dG9uX2lkPVVNVlFKSkZHNEJGSFcnIGRhdGEtcD0ndG5kfEROVCc+PC9hPjxzdmcgdmlld0JveD0nMCAwIDE1LjMgMTgnPjxwYXRoIHN0eWxlPSdmaWxsOiMyNzM0NkE7JyBkPSdNMTMsMS40QzEyLjIsMC40LDEwLjYsMCw4LjcsMEgzLjFDMi43LDAsMi40LDAuMywyLjMsMC43TDAsMTUuNEMwLDE1LjcsMC4yLDE2LDAuNSwxNmgzLjUgbDAuOS01LjVsMCwwLjJDNC44LDEwLjMsNS4yLDEwLDUuNiwxMGgxLjZjMy4yLDAsNS43LTEuMyw2LjUtNS4xYzAtMC4xLDAtMC4yLDAuMS0wLjNjLTAuMSwwLTAuMSwwLDAsMEMxNCwzLjIsMTMuNywyLjIsMTMsMS40Jy8+PHBhdGggc3R5bGU9J2ZpbGw6IzI3MzQ2QTsnIGQ9J002LjEsNC4xQzYuMiw0LDYuMyw0LDYuNCw0aDQuNGMwLjUsMCwxLDAsMS40LDAuMWMwLjEsMCwwLjIsMCwwLjQsMC4xYzAuMSwwLDAuMiwwLjEsMC4zLDAuMSBjMC4xLDAsMC4xLDAsMC4yLDAuMWMwLjIsMC4xLDAuNCwwLjIsMC42LDAuM2MwLjItMS40LDAtMi40LTAuOC0zLjJDMTIuMiwwLjQsMTAuNiwwLDguNywwSDMuMUMyLjcsMCwyLjQsMC4zLDIuMywwLjdMMCwxNS40IEMwLDE1LjcsMC4yLDE2LDAuNSwxNmgzLjVMNS43LDQuNkM1LjgsNC40LDUuOSw0LjIsNi4xLDQuMXonLz48cGF0aCBzdHlsZT0nZmlsbDojMjc5MEMzOycgZD0nTTEzLjcsNC45QzEzLDguNywxMC40LDEwLDcuMiwxMEg1LjZjLTAuNCwwLTAuNywwLjMtMC44LDAuN2wtMS4xLDYuOGMwLDAuMywwLjIsMC41LDAuNCwwLjVINyBjMC4zLDAsMC42LTAuMywwLjctMC42bDAtMC4xbDAuNS0zLjVsMC0wLjJDOC40LDEzLjMsOC43LDEzLDksMTNoMC40YzIuOCwwLDUtMS4xLDUuNy00LjVjMC4zLTEuNCwwLjEtMi41LTAuNi0zLjQgYy0wLjItMC4yLTAuNS0wLjQtMC44LTAuNkMxMy43LDQuNywxMy43LDQuOCwxMy43LDQuOUwxMy43LDQuOXonLz48cGF0aCBzdHlsZT0nZmlsbDojMUYyNjRGOycgZD0nTTEzLDQuM2MtMC4xLDAtMC4yLTAuMS0wLjMtMC4xYy0wLjEsMC0wLjIsMC0wLjQtMC4xQzExLjgsNCwxMS4zLDQsMTAuOCw0SDYuNCBDNi4zLDQsNi4yLDQsNi4xLDQuMUM1LjksNC4yLDUuOCw0LjQsNS43LDQuNmwtMC45LDUuOWwwLDAuMkM0LjgsMTAuMyw1LjIsMTAsNS42LDEwaDEuNmMzLjIsMCw1LjctMS4zLDYuNS01LjEgYzAtMC4xLDAtMC4yLDAuMS0wLjNjLTAuMi0wLjEtMC40LTAuMi0wLjYtMC4zQzEzLjEsNC4zLDEzLDQuMywxMyw0LjMnLz48L3N2Zz48L2xpPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3VsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3ZnIHN0eWxlPSdkaXNwbGF5Om5vbmU7Jz48c3ltYm9sIGlkPSd5dHAtc3ZnLWNoZWNrbWFyaycgdmlld0JveD0nMCAwIDEyLjcgOS45Jz48cG9seWdvbiBwb2ludHM9JzEuNCw0LjIgMCw1LjcgNC4yLDkuOSAxMi43LDEuNCAxMS4zLDAgNC4yLDcuMScvPjwvc3ltYm9sPjxzeW1ib2wgaWQ9J3l0cC1zdmctc2F2ZScgdmlld0JveD0nMCAwIDE2IDE2Jz48cGF0aCBkPSdNMTMsMEgwdjE2aDE2VjNMMTMsMHogTTMsMWg5djZIM1YxeiBNMTQsMTVIMlY5aDEyVjE1eicvPjxyZWN0IHg9JzEwJyB5PScyJyB3aWR0aD0nMScgaGVpZ2h0PSc0Jy8+PC9zeW1ib2w+PC9zdmc+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNlY3Rpb24gPT09ICJHRU4iKSB7CiAgICAgICAgICAgICAgICAgICAgdGVtcC5pbm5lckhUTUwgPSAvLwogICAgICAgICAgICAgICAgICAgICAgICBgPGRpdiBpZD0nUC1jb250ZW50Jz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9J1AtaGVhZGVyJz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSdQLXNhdmUnICAgIGRhdGEtcD0ndG5kfEdMQl9TVkUnPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9J1AtcmVzZXQnICAgZGF0YS1wPSd0bmR8R0xCX1JTRVQnPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9J1AtaW1wZXhwJyAgZGF0YS1wPSd0dGx8R0xCX0lNUFInPjxzdmcgY2xhc3M9J3NhdmUnPjx1c2UgeGxpbms6aHJlZj0nI3l0cC1zdmctc2F2ZScvPjwvc3ZnPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9J1AtaW1wbGFuZycgZGF0YS1wPSd0dGx8R0xCX0xPQ0xfTEFORyZ0bmR8TE9DQUxFJz48L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDIgZGF0YS1wPSd0bmR8R0VOX1RUTCc+PC9oMj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGhyIGNsYXNzPSdQLWhvcnonPjwvaHI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDMgZGF0YS1wPSd0bmR8R0VOX0dFTic+PC9oMz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdHRU5fTE9DTF9MQU5HJyAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nR0VOX0xPQ0xfTEFORycgICAgZGF0YS1wPSd0bmR8R0VOX0xPQ0xfTEFORyc+ICAgPC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNjdXN0b21fbGFuZycgICAgIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J0dFTl9EU0JMX0FEUycgICAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdHRU5fRFNCTF9BRFMnICAgICBkYXRhLXA9J3RuZHxHRU5fRFNCTF9BRFMnPiAgICA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI291dHNpZGVfYWRzJyAgICAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nR0VOX1lUX0xPR09fTElOSycgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J0dFTl9ZVF9MT0dPX0xJTksnIGRhdGEtcD0ndG5kfEdFTl9ZVF9MT0dPX0xJTksnPjwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjbG9nb19yZWRpcmVjdCcgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdHRU5fU1VCX0xJU1QnICAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nR0VOX1NVQl9MSVNUJyAgICAgZGF0YS1wPSd0bmR8R0VOX1NVQl9MSVNUJz4gICAgPC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNzdWJfcGxheWxpc3QnICAgIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J0dFTl9JTkZfU0NSTCcgICAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdHRU5fSU5GX1NDUkwnICAgICBkYXRhLXA9J3RuZHxHRU5fSU5GX1NDUkwnPiAgICA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2luZmluaXRlX3Njcm9sbCcgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nR0VOX1BQT1RfT04nICAgICAgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J0dFTl9QUE9UX09OJyAgICAgIGRhdGEtcD0ndG5kfEdFTl9QUE9UX09OJz4gICAgIDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjcG9wb3V0X29uJyAgICAgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdHRU5fUkVNX0FQVU4nICAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nR0VOX1JFTV9BUFVOJyAgICAgZGF0YS1wPSd0bmR8R0VOX1JFTV9BUFVOJz4gICAgPC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNyZW1vdmVfYXV0b3BsYXknIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J0dFTl9TUEZfT0ZGJyAgICAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdHRU5fU1BGX09GRicgICAgICBkYXRhLXA9J3RuZHxHRU5fU1BGX09GRic+ICAgICA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI3NwZl9vZmYnICAgICAgICAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9J0dFTl9DSE5fREZMVF9QQUdFJyBkYXRhLXA9J3RuZHxHRU5fQ0hOX0RGTFRfUEFHRSc+PC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSdQLXNlbGVjdCc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzZWxlY3QgaWQ9J0dFTl9DSE5fREZMVF9QQUdFJz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9J2RlZmF1bHQnICAgIGRhdGEtcD0ndG5kfEdFTl9DSE5fREZMVF9QQUdFX0RGTFQnPjwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0ndmlkZW9zJyAgICAgZGF0YS1wPSd0bmR8R0VOX0NITl9ERkxUX1BBR0VfVklEJz48L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9J3BsYXlsaXN0cycgIGRhdGEtcD0ndG5kfEdFTl9DSE5fREZMVF9QQUdFX1BMJz48L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9J2NoYW5uZWxzJyAgIGRhdGEtcD0ndG5kfEdFTl9DSE5fREZMVF9QQUdFX0NITic+PC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSdkaXNjdXNzaW9uJyBkYXRhLXA9J3RuZHxHRU5fQ0hOX0RGTFRfUEFHRV9ESVNDJz48L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9J2Fib3V0JyAgICAgIGRhdGEtcD0ndG5kfEdFTl9DSE5fREZMVF9QQUdFX0FCVCc+PC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2NoYW5uZWxfcGFnZScgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMyBkYXRhLXA9J3RuZHxHRU5fTFlUJz48L2gzPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J0dFTl9HUklEX1NVQlMnICAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nR0VOX0dSSURfU1VCUycgICAgIGRhdGEtcD0ndG5kfEdFTl9HUklEX1NVQlMnPiAgICA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI3N1Yl9ncmlkJyAgICAgICAgICAgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdHRU5fR1JJRF9TUkNIJyAgICAgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J0dFTl9HUklEX1NSQ0gnICAgICBkYXRhLXA9J3RuZHxHRU5fR1JJRF9TUkNIJz4gICAgPC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNzZWFyY2hfZ3JpZCcgICAgICAgICAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nR0VOX0JUVFJfTlRGJyAgICAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdHRU5fQlRUUl9OVEYnICAgICAgZGF0YS1wPSd0bmR8R0VOX0JUVFJfTlRGJz4gICAgIDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjYmx1ZV9ib3gnICAgICAgICAgICAgIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J0dFTl9EU0JfSFZSQycgICAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nR0VOX0RTQl9IVlJDJyAgICAgIGRhdGEtcD0ndG5kfEdFTl9EU0JfSFZSQyc+ICAgICA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2hvdmVyY2FyZHNfb2ZmJyAgICAgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdHRU5fQ01QVF9UVExTJyAgICAgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J0dFTl9DTVBUX1RUTFMnICAgICBkYXRhLXA9J3RuZHxHRU5fQ01QVF9UVExTJz4gICAgPC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNmZWVkX3RpdGxlcycgICAgICAgICAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nR0VOX0JMVUVfR0xPVycgICAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdHRU5fQkxVRV9HTE9XJyAgICAgZGF0YS1wPSd0bmR8R0VOX0JMVUVfR0xPVyc+ICAgIDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjYmx1ZV9nbG93JyAgICAgICAgICAgIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J0dFTl9ISURFX0ZUUicgICAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nR0VOX0hJREVfRlRSJyAgICAgIGRhdGEtcD0ndG5kfEdFTl9ISURFX0ZUUic+ICAgICA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2hpZGVfZm9vdGVyJyAgICAgICAgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdHRU5fSERFX1JFQ01fU0RCUicgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J0dFTl9IREVfUkVDTV9TREJSJyBkYXRhLXA9J3RuZHxHRU5fSERFX1JFQ01fU0RCUic+PC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNoaWRlX3JlY29tX3NpZGViYXInICAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nR0VOX0hERV9TUkNIX1NEQlInIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdHRU5fSERFX1NSQ0hfU0RCUicgZGF0YS1wPSd0bmR8R0VOX0hERV9TUkNIX1NEQlInPjwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjaGlkZV9zZWFyY2hfc2lkZWJhcicgIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J0dFTl9IREVfQ0hOX1NEQlInICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nR0VOX0hERV9DSE5fU0RCUicgIGRhdGEtcD0ndG5kfEdFTl9IREVfQ0hOX1NEQlInPiA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2hpZGVfY2hhbm5lbF9zaWRlYmFyJyBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5HRU5fTE9DTF9MQU5HICYmIHVzZXJfc2V0dGluZ3MubG9jYWxMYW5nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXAuY29udGVudC5xdWVyeVNlbGVjdG9yKCIuUC1pbXBsYW5nIikuZGF0YXNldC5wID0gIkdMQl9MT0NMX0xBTkdfQ1NUTSI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzZWN0aW9uID09PSAiVklEIikgewogICAgICAgICAgICAgICAgICAgIHRlbXAuaW5uZXJIVE1MID0gLy8KICAgICAgICAgICAgICAgICAgICAgICAgYDxkaXYgaWQ9J1AtY29udGVudCc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSdQLWhlYWRlcic+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0nUC1zYXZlJyAgICBkYXRhLXA9J3RuZHxHTEJfU1ZFJz48L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSdQLXJlc2V0JyAgIGRhdGEtcD0ndG5kfEdMQl9SU0VUJz48L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSdQLWltcGV4cCcgIGRhdGEtcD0ndHRsfEdMQl9JTVBSJz48c3ZnIGNsYXNzPSdzYXZlJz48dXNlIHhsaW5rOmhyZWY9JyN5dHAtc3ZnLXNhdmUnLz48L3N2Zz48L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSdQLWltcGxhbmcnIGRhdGEtcD0ndHRsfEdMQl9MT0NMX0xBTkcmdG5kfExPQ0FMRSc+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGgyIGRhdGEtcD0ndG5kfFZJRF9UVEwnPjwvaDI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxociBjbGFzcz0nUC1ob3J6Jz48L2hyPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGgzIGRhdGEtcD0ndG5kfFZJRF9QTFInPjwvaDM+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX1BMUl9BRFMnICAgICAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nVklEX1BMUl9BRFMnICAgICAgZGF0YS1wPSd0bmR8VklEX1BMUl9BRFMnPiAgICAgPC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyN2aWRlb19hZHMnICAgICAgICAgICAgIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J1ZJRF9TVUJfQURTJyAgICAgICAgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J1ZJRF9TVUJfQURTJyAgICAgIGRhdGEtcD0ndG5kfFZJRF9TVUJfQURTJz4gICAgIDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjc3Vic19hZHNfb24nICAgICAgICAgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfUExSX0FMVklTJyAgICAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdWSURfUExSX0FMVklTJyAgICBkYXRhLXA9J3RuZHxWSURfUExSX0FMVklTJz4gICA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2Zsb2F0aW5nX3BsYXllcicgICAgICAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX1BMUl9BTFZJU19XRFRIJyB0eXBlPSd0ZXh0JyBwbGFjZWhvbGRlcj0nMzUwJyBzaXplPSc2Jz48bGFiZWwgZm9yPSdWSURfUExSX0FMVklTX1dEVEgnIGRhdGEtcD0ndG5kfFZJRF9QTFJfQUxWSVNfV0RUSCc+PC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNmbG9hdGluZ19wbGF5ZXJfd2lkdGgnIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J1ZJRF9QTFJfQVRQTCcgICAgICAgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J1ZJRF9QTFJfQVRQTCcgICAgIGRhdGEtcD0ndG5kfFZJRF9QTFJfQVRQTCc+ICAgIDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjdmlkZW9fYXV0b3BsYXknICAgICAgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfUExSX0NDJyAgICAgICAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdWSURfUExSX0NDJyAgICAgICBkYXRhLXA9J3RuZHxWSURfUExSX0NDJz4gICAgICA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI3N1YnRpdGxlc19vZmYnICAgICAgICAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX1BMUl9BTlRTJyAgICAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nVklEX1BMUl9BTlRTJyAgICAgZGF0YS1wPSd0bmR8VklEX1BMUl9BTlRTJz4gICAgPC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNhbm5vdGF0aW9uc19vZmYnICAgICAgIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J1ZJRF9FTkRfU0hSRScgICAgICAgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J1ZJRF9FTkRfU0hSRScgICAgIGRhdGEtcD0ndG5kfFZJRF9FTkRfU0hSRSc+ICAgIDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjc2hhcmVfcGFuZWxfb2ZmJyAgICAgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfUExSX1ZPTF9NRU0nICAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdWSURfUExSX1ZPTF9NRU0nICBkYXRhLXA9J3RuZHxWSURfUExSX1ZPTF9NRU0nPiA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI3JlbWVtYmVyX3ZvbHVtZScgICAgICAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX1BMUl9WT0xfTEROJyAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nVklEX1BMUl9WT0xfTEROJyAgZGF0YS1wPSd0bmR8VklEX1BMUl9WT0xfTEROJz4gPC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNkaXNhYmxlX25vcm1hbGlzYXRpb24nIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J1ZJRF9QTFJfQUxBQ1QnICAgICAgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J1ZJRF9QTFJfQUxBQ1QnICAgIGRhdGEtcD0ndG5kfFZJRF9QTFJfQUxBQ1QnPiAgIDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjc2hvcnRjdXRzX29uJyAgICAgICAgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfUExSX1NJWkVfTUVNJyAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdWSURfUExSX1NJWkVfTUVNJyBkYXRhLXA9J3RuZHxWSURfUExSX1NJWkVfTUVNJz48L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI3JlbWVtYmVyX21vZGUnICAgICAgICAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX1ZPTF9XSEVFTCcgICAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nVklEX1ZPTF9XSEVFTCcgICAgZGF0YS1wPSd0bmR8VklEX1ZPTF9XSEVFTCc+ICAgPC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyN3aGVlbF92b2x1bWUnICAgICAgICAgIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J1ZJRF9QTFJfSEZSJyAgICAgICAgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J1ZJRF9QTFJfSEZSJyAgICAgIGRhdGEtcD0ndG5kfFZJRF9QTFJfSEZSJz4gICAgIDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjaGZyX29mZicgICAgICAgICAgICAgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfUExSX0hUTUw1JyAgICAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdWSURfUExSX0hUTUw1JyAgICBkYXRhLXA9J3RuZHxWSURfUExSX0hUTUw1Jz4gICA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2ZvcmNlX2h0bWw1JyAgICAgICAgICAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9J1ZJRF9ERkxUX1FMVFknIGRhdGEtcD0ndG5kfFZJRF9ERkxUX1FMVFknPjwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0nUC1zZWxlY3QnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c2VsZWN0IGlkPSdWSURfREZMVF9RTFRZJz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9J2F1dG8nICAgIGRhdGEtcD0ndG5kfFZJRF9ERkxUX1FMVFlfQVVUTyc+PC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSdoaWdocmVzJyBkYXRhLXA9J3RuZHxWSURfREZMVF9RTFRZX09SSUcnPjwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0naGQyODgwJyAgZGF0YS1wPSd0bmR8VklEX0RGTFRfUUxUWV8yODgwJz48L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9J2hkMjE2MCcgIGRhdGEtcD0ndG5kfFZJRF9ERkxUX1FMVFlfMjE2MCc+PC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSdoZDE0NDAnICBkYXRhLXA9J3RuZHxWSURfREZMVF9RTFRZXzE0NDAnPjwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0naGQxMDgwJyAgZGF0YS1wPSd0bmR8VklEX0RGTFRfUUxUWV8xMDgwJz48L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9J2hkNzIwJyAgIGRhdGEtcD0ndG5kfFZJRF9ERkxUX1FMVFlfNzIwJyA+PC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSdsYXJnZScgICBkYXRhLXA9J3RuZHxWSURfREZMVF9RTFRZX0xSRycgPjwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0nbWVkaXVtJyAgZGF0YS1wPSd0bmR8VklEX0RGTFRfUUxUWV9NRE0nID48L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9J3NtYWxsJyAgIGRhdGEtcD0ndG5kfFZJRF9ERkxUX1FMVFlfU01MJyA+PC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSd0aW55JyAgICBkYXRhLXA9J3RuZHxWSURfREZMVF9RTFRZX1ROWScgPjwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3NlbGVjdD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNkZWZhdWx0X3F1YWxpdHknIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDMgZGF0YS1wPSd0bmR8VklEX1BMUl9MWVQnPjwvaDM+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX1BMUl9JTkZPJyAgICAgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J1ZJRF9QTFJfSU5GTycgICAgIGRhdGEtcD0ndG5kfFZJRF9QTFJfSU5GTyc+ICAgIDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjaW5mb19iYXInICAgICAgICAgIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J1ZJRF9QTFJfRFlOX1NJWkUnIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdWSURfUExSX0RZTl9TSVpFJyBkYXRhLXA9J3RuZHxWSURfUExSX0RZTl9TSVpFJz48L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2R5bmFtaWNfc2l6ZV9vZmYnICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfUExSX0ZJVCcgICAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nVklEX1BMUl9GSVQnICAgICAgZGF0YS1wPSd0bmR8VklEX1BMUl9GSVQnPiAgICAgPC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNmaXRfdG9fcGFnZScgICAgICAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX1BMUl9GSVRfV0RUSCcgdHlwZT0ndGV4dCcgcGxhY2Vob2xkZXI9JzEyODBweCcgc2l6ZT0nNic+PGxhYmVsIGZvcj0nVklEX1BMUl9GSVRfV0RUSCcgZGF0YS1wPSd0bmR8VklEX1BMUl9GSVRfV0RUSCc+PC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNmaXRfbWF4X3dpZHRoJyBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMyBkYXRhLXA9J3RuZHxWSURfUExTVCc+PC9oMz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfUExTVF9BVFBMJyAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nVklEX1BMU1RfQVRQTCcgICAgZGF0YS1wPSd0bmR8VklEX1BMU1RfQVRQTCc+ICAgPC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNwbGF5bGlzdF9hdXRvcGxheScgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX1BMU1RfUlZSUycgICAgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J1ZJRF9QTFNUX1JWUlMnICAgIGRhdGEtcD0ndG5kfFZJRF9QTFNUX1JWUlMnPiAgIDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjcGxheWxpc3RfcmV2ZXJzZScgIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGgzIGRhdGEtcD0ndG5kfFZJRF9MQVlUJz48L2gzPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J1ZJRF9QUE9UX1NaJyB0eXBlPSd0ZXh0JyBwbGFjZWhvbGRlcj0nNTMzJyBzaXplPSc2Jz48bGFiZWwgZm9yPSdWSURfUFBPVF9TWicgZGF0YS1wPSd0bmR8VklEX1BQT1RfU1onPjwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjcG9wb3V0X3NpemUnIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSdWSURfSElERV9DT01TJyBkYXRhLXA9J3RuZHxWSURfSElERV9DT01TJz48L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9J1Atc2VsZWN0Jz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNlbGVjdCBpZD0nVklEX0hJREVfQ09NUyc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPScwJyBkYXRhLXA9J3RuZHxWSURfSElERV9DT01TX1NIT1cnPjwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0nMScgZGF0YS1wPSd0bmR8VklEX0hJREVfQ09NU19ISURFJz48L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9JzInIGRhdGEtcD0ndG5kfFZJRF9ISURFX0NPTVNfUkVNJz48L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zZWxlY3Q+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjY29tbWVudHMnIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX1RUTF9DTVBUJyAgICAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdWSURfVFRMX0NNUFQnICAgICAgZGF0YS1wPSd0bmR8VklEX1RUTF9DTVBUJz4gICAgIDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjdmlkZW9fdGl0bGUnICAgICAgICAgIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J1ZJRF9ERVNDX1NIUlQnICAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nVklEX0RFU0NfU0hSVCcgICAgIGRhdGEtcD0ndG5kfFZJRF9ERVNDX1NIUlQnPiAgICA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2xhYmVsbGVzc19idXR0b25zJyAgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfVklEX0NOVCcgICAgICAgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J1ZJRF9WSURfQ05UJyAgICAgICBkYXRhLXA9J3RuZHxWSURfVklEX0NOVCc+ICAgICAgPC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyN1cGxvYWRfY291bnRlcicgICAgICAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX1BPU1RfVElNRScgICAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdWSURfUE9TVF9USU1FJyAgICAgZGF0YS1wPSd0bmR8VklEX1BPU1RfVElNRSc+ICAgIDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjcmVsYXRpdmVfdXBsb2FkX3RpbWUnIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J1ZJRF9ISURFX0RFVExTJyAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nVklEX0hJREVfREVUTFMnICAgIGRhdGEtcD0ndG5kfFZJRF9ISURFX0RFVExTJz4gICA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2hpZGVfdmlkZW9fZGV0YWlscycgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfTEFZVF9BVVRPX1BOTCcgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J1ZJRF9MQVlUX0FVVE9fUE5MJyBkYXRhLXA9J3RuZHxWSURfTEFZVF9BVVRPX1BOTCc+PC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNleHBhbmRfZGVzY3JpcHRpb24nICAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuR0VOX0xPQ0xfTEFORyAmJiB1c2VyX3NldHRpbmdzLmxvY2FsTGFuZykgewogICAgICAgICAgICAgICAgICAgICAgICB0ZW1wLmNvbnRlbnQucXVlcnlTZWxlY3RvcigiLlAtaW1wbGFuZyIpLmRhdGFzZXQucCA9ICJHTEJfTE9DTF9MQU5HX0NTVE0iOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2VjdGlvbiA9PT0gIkJMSyIpIHsKICAgICAgICAgICAgICAgICAgICB0ZW1wLmlubmVySFRNTCA9IC8vCiAgICAgICAgICAgICAgICAgICAgICAgIGA8ZGl2IGlkPSdQLWNvbnRlbnQnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0nUC1oZWFkZXInPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9J1Atc2F2ZScgICAgZGF0YS1wPSd0bmR8R0xCX1NWRSc+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0nUC1yZXNldCcgICBkYXRhLXA9J3RuZHxHTEJfUlNFVCc+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0nUC1pbXBleHAnICBkYXRhLXA9J3R0bHxHTEJfSU1QUic+PHN2ZyBjbGFzcz0nc2F2ZSc+PHVzZSB4bGluazpocmVmPScjeXRwLXN2Zy1zYXZlJy8+PC9zdmc+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0nUC1pbXBsYW5nJyBkYXRhLXA9J3R0bHxHTEJfTE9DTF9MQU5HJnRuZHxMT0NBTEUnPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMiBkYXRhLXA9J3RuZHxCTEtfVFRMJz48L2gyPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aHIgY2xhc3M9J1AtaG9yeicvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGgzIGRhdGEtcD0ndG5kfEJMS19CTEsnPjwvaDM+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nQkxLX09OJyB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nQkxLX09OJyBkYXRhLXA9J3RuZHxCTEtfT04nPjwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjYmxhY2tsaXN0X29uJyBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9J2JsYWNrbGlzdCc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0nYmxhY2tsaXN0LWNvbnRyb2xzJz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0nYmxhY2tsaXN0LWVkaXQnICBjbGFzcz0neXQtdWl4LWJ1dHRvbiB5dC11aXgtc2Vzc2lvbmxpbmsgeXQtdWl4LWJ1dHRvbi1kZWZhdWx0IHl0LXVpeC1idXR0b24tc2l6ZS1kZWZhdWx0Jz48c3BhbiBjbGFzcz0neXQtdWl4LWJ1dHRvbi1jb250ZW50JyBkYXRhLXA9J3RuZHxCTENLX0VESVQnPjwvc3Bhbj48L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0nYmxhY2tsaXN0LXNhdmUnICBjbGFzcz0neXQtdWl4LWJ1dHRvbiB5dC11aXgtc2Vzc2lvbmxpbmsgeXQtdWl4LWJ1dHRvbi1kZWZhdWx0IHl0LXVpeC1idXR0b24tc2l6ZS1kZWZhdWx0Jz48c3BhbiBjbGFzcz0neXQtdWl4LWJ1dHRvbi1jb250ZW50JyBkYXRhLXA9J3RuZHxCTENLX1NBVkUnPjwvc3Bhbj48L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0nYmxhY2tsaXN0LWNsb3NlJyBjbGFzcz0neXQtdWl4LWJ1dHRvbiB5dC11aXgtc2Vzc2lvbmxpbmsgeXQtdWl4LWJ1dHRvbi1kZWZhdWx0IHl0LXVpeC1idXR0b24tc2l6ZS1kZWZhdWx0Jz48c3BhbiBjbGFzcz0neXQtdWl4LWJ1dHRvbi1jb250ZW50JyBkYXRhLXA9J3RuZHxCTENLX0NMU0UnPjwvc3Bhbj48L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGV4dGFyZWEgaWQ9J2JsYWNrbGlzdC1lZGl0LWxpc3QnPjwvdGV4dGFyZWE+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxici8+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuR0VOX0xPQ0xfTEFORyAmJiB1c2VyX3NldHRpbmdzLmxvY2FsTGFuZykgewogICAgICAgICAgICAgICAgICAgICAgICB0ZW1wLmNvbnRlbnQucXVlcnlTZWxlY3RvcigiLlAtaW1wbGFuZyIpLmRhdGFzZXQucCA9ICJ0dGx8R0xCX0xPQ0xfTEFORyZ0bmR8R0xCX0xPQ0xfTEFOR19DU1RNIjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNlY3Rpb24gPT09ICJBQlQiKSB7CiAgICAgICAgICAgICAgICAgICAgdGVtcC5pbm5lckhUTUwgPSAvLwogICAgICAgICAgICAgICAgICAgICAgICBgPGRpdiBpZD0nUC1jb250ZW50Jz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9J1AtaGVhZGVyJz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDIgZGF0YS1wPSd0bmR8QUJUX1RUTCc+PC9oMj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGhyIGNsYXNzPSdQLWhvcnonLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMyBkYXRhLXA9J3RuZHxBQlRfVEhLUyc+PC9oMz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGEgdGFyZ2V0PSdfYmxhbmsnIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9ZZVBwSGEnPkplcHBlIFJ1bmUgTW9ydGVuc2VuPC9hPjxzcGFuIGRhdGEtcD0ndG5kfEFCVF9USEtTX1lFUFBIQSc+PC9zcGFuPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48YSB0YXJnZXQ9J19ibGFuaycgaHJlZj0naHR0cDovL3d3dy5ncmVhc2VzcG90Lm5ldC8nPkdyZWFzZW1vbmtleTwvYT4gKyA8YSBocmVmPSdodHRwOi8vdGFtcGVybW9ua2V5Lm5ldC8nPlRhbXBlcm1vbmtleTwvYT48c3BhbiBkYXRhLXA9J3RuZHxBQlRfVEhLU19VU0VSU0NSSVBUJz48L3NwYW4+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxhIHRhcmdldD0nX2JsYW5rJyBocmVmPSdodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vJz5TdGFjayBPdmVyZmxvdzwvYT48c3BhbiBkYXRhLXA9J3RuZHxBQlRfVEhLU19TVEFDS09WJz48L3NwYW4+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDMgZGF0YS1wPSd0bmR8QUJUX0lORk8nPjwvaDM+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxhIHRhcmdldD0nX2JsYW5rJyBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlLyc+R2l0SHViPC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48YSB0YXJnZXQ9J19ibGFuaycgaHJlZj0naHR0cHM6Ly9ncmVhc3lmb3JrLm9yZy9lbi91c2Vycy84MjIzLXBhcnRpY2xlY29yZSc+R3JlYXN5IEZvcms8L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxhIHRhcmdldD0nX2JsYW5rJyBocmVmPSdodHRwOi8vb3BlbnVzZXJqcy5vcmcvc2NyaXB0cy9QYXJ0aWNsZUNvcmUvJz5PcGVuVXNlckpTPC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaW5wdXRzID0gdGVtcC5jb250ZW50LnF1ZXJ5U2VsZWN0b3JBbGwoImlucHV0W3R5cGU9J2NoZWNrYm94J10gKyBsYWJlbCIpOwogICAgICAgICAgICAgICAgc3ZnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIsICJzdmciKTsKICAgICAgICAgICAgICAgIHN2Zy5pbm5lckhUTUwgPSAiPHVzZSB4bGluazpocmVmPScjeXRwLXN2Zy1jaGVja21hcmsnPiI7CiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgaW5wdXRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXRzW2ldLmFwcGVuZENoaWxkKHN2Zy5jbG9uZU5vZGUodHJ1ZSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHNldExvY2FsZShnZXRWYWx1ZXModGVtcC5jb250ZW50KSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gZXhwb3J0U2V0dGluZ3ModGFyZ2V0KSB7CiAgICAgICAgICAgICAgICB2YXIgZXhwQ29udDsKICAgICAgICAgICAgICAgIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCJQLWltcGV4cCIpIHx8IHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoIlAtaW1wbGFuZyIpKSB7CiAgICAgICAgICAgICAgICAgICAgZXhwQ29udCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJleHAtY29udCIpOwogICAgICAgICAgICAgICAgICAgIGlmIChleHBDb250KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGV4cENvbnQucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZXhwQ29udCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRlbXBsYXRlIik7CiAgICAgICAgICAgICAgICAgICAgZXhwQ29udC5pbm5lckhUTUwgPSAvLwogICAgICAgICAgICAgICAgICAgICAgICBgPGRpdiBpZD0nZXhwLWNvbnQnPgogICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSdpbXBsYW5nLXNhdmUnIGNsYXNzPSd5dC11aXgtYnV0dG9uIHl0LXVpeC1zZXNzaW9ubGluayB5dC11aXgtYnV0dG9uLWRlZmF1bHQgeXQtdWl4LWJ1dHRvbi1zaXplLWRlZmF1bHQnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSd5dC11aXgtYnV0dG9uLWNvbnRlbnQnIGRhdGEtcD0ndG5kfEdMQl9JTVBSX1NBVkUnPjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICA8dGV4dGFyZWEgaWQ9J2ltcGV4cC1saXN0Jz48L3RleHRhcmVhPgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCJQLWltcGV4cCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGV4cENvbnQuY29udGVudC5xdWVyeVNlbGVjdG9yKCIjaW1wbGFuZy1zYXZlIikuaWQgPSAiaW1wZXhwLXNhdmUiOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBleHBDb250ID0gc2V0TG9jYWxlKGV4cENvbnQuY29udGVudCkuZmlyc3RDaGlsZDsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiUC1jb250ZW50IikuYXBwZW5kQ2hpbGQoZXhwQ29udCk7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImltcGV4cC1saXN0IikudmFsdWUgPSBKU09OLnN0cmluZ2lmeSgodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygiUC1pbXBleHAiKSAmJiB1c2VyX3NldHRpbmdzKSB8fCB1c2VyX3NldHRpbmdzLmxvY2FsTGFuZyB8fCBsYW5ndWFnZSwgdW5kZWZpbmVkLCAyKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGFyZ2V0LmlkID09PSAiaW1wZXhwLXNhdmUiIHx8IHRhcmdldC5pZCA9PT0gImltcGxhbmctc2F2ZSIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0LmlkID09PSAiaW1wbGFuZy1zYXZlIikgewogICAgICAgICAgICAgICAgICAgICAgICBzZXQoImxvY2FsTGFuZyIsIEpTT04ucGFyc2UoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImltcGV4cC1saXN0IikudmFsdWUpKTsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNldCgidXNlcl9zZXR0aW5ncyIsIEpTT04ucGFyc2UoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImltcGV4cC1saXN0IikudmFsdWUpKTsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3NNZW51LnNldHRpbmdzQnV0dG9uLmNsaWNrKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzTWVudS5zZXR0aW5nc0J1dHRvbi5jbGljaygpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBzZXRCbGFja0xpc3QodGFyZ2V0KSB7CiAgICAgICAgICAgICAgICBpZiAodGFyZ2V0LmlkID09PSAiYmxhY2tsaXN0LWVkaXQiKSB7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImJsYWNrbGlzdCIpLmNsYXNzTGlzdC5hZGQoImVkaXQiKTsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYmxhY2tsaXN0LWVkaXQtbGlzdCIpLnZhbHVlID0gSlNPTi5zdHJpbmdpZnkodXNlcl9zZXR0aW5ncy5ibGFja2xpc3QsIHVuZGVmaW5lZCwgMik7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRhcmdldC5pZCA9PT0gImJsYWNrbGlzdC1zYXZlIikgewogICAgICAgICAgICAgICAgICAgIHNldCgiYmxhY2tsaXN0IiwgSlNPTi5wYXJzZShkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYmxhY2tsaXN0LWVkaXQtbGlzdCIpLnZhbHVlKSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRhcmdldC5pZCA9PT0gImJsYWNrbGlzdC1jbG9zZSIpIHsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiQkxLIikuY2xpY2soKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBkZWxCbGFja0xpc3QoZXZlbnQpIHsKICAgICAgICAgICAgICAgIHZhciBuZXdLZXkgPSB1c2VyX3NldHRpbmdzLmJsYWNrbGlzdDsKICAgICAgICAgICAgICAgIGRlbGV0ZSBuZXdLZXlbZXZlbnQudGFyZ2V0Lm5leHRTaWJsaW5nLmhyZWYuc3BsaXQoIi9jaGFubmVsLyIpWzFdXTsKICAgICAgICAgICAgICAgIGV2ZW50LnRhcmdldC5wYXJlbnROb2RlLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgc2V0KCJibGFja2xpc3QiLCBuZXdLZXkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGRlbE5vdGlmaWNhdGlvbigpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZSgic2hvdy1ndWlkZS1idXR0b24tbm90aWZpY2F0aW9uIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gc2F2ZVNldHRpbmdzKHNhbHQpIHsKICAgICAgICAgICAgICAgIHZhciBpLCB2YWx1ZSwgbm90aWZpY2F0aW9uLCBuYXZJZCwgdXNlclNldHMsIHNhdmVkU2V0czsKICAgICAgICAgICAgICAgIG5hdklkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnNlbGVjdGVkIikuaWQ7CiAgICAgICAgICAgICAgICB1c2VyU2V0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJQLWNvbnRlbnQiKS5xdWVyeVNlbGVjdG9yQWxsKCJbaWRePSciICsgbmF2SWQgKyAiJ10iKTsKICAgICAgICAgICAgICAgIHNhdmVkU2V0cyA9IHVzZXJfc2V0dGluZ3M7CiAgICAgICAgICAgICAgICBpID0gdXNlclNldHMubGVuZ3RoOwogICAgICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gKHVzZXJTZXRzW2ldLmNoZWNrZWQgJiYgKHVzZXJTZXRzW2ldLnZhbHVlID09PSAib24iIHx8IHVzZXJTZXRzW2ldLnZhbHVlKSkgfHwgKHVzZXJTZXRzW2ldLmxlbmd0aCAmJiB1c2VyU2V0c1tpXS52YWx1ZSkgfHwgKHVzZXJTZXRzW2ldLmdldEF0dHJpYnV0ZSgidHlwZSIpID09PSAidGV4dCIgJiYgdXNlclNldHNbaV0udmFsdWUpOwogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICBzYXZlZFNldHNbdXNlclNldHNbaV0ubmFtZSB8fCB1c2VyU2V0c1tpXS5pZF0gPSB2YWx1ZTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCF2YWx1ZSAmJiB1c2VyU2V0c1tpXS50eXBlICE9PSAicmFkaW8iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVkU2V0c1t1c2VyU2V0c1tpXS5pZF0gPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZXQoInVzZXJfc2V0dGluZ3MiLCBzYXZlZFNldHMpOwogICAgICAgICAgICAgICAgY3VzdG9tU3R5bGVzKCk7CiAgICAgICAgICAgICAgICBpZiAoIXNhbHQpIHsKICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYXBwYmFyLW1haW4tZ3VpZGUtbm90aWZpY2F0aW9uLWNvbnRhaW5lciIpOwogICAgICAgICAgICAgICAgICAgIGlmIChub3RpZmljYXRpb24uY2hpbGROb2Rlcy5sZW5ndGggPCAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbi5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGVtcGxhdGUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uLmlubmVySFRNTCA9IC8vCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBgPGRpdiBpZD0nYXBwYmFyLW1haW4tZ3VpZGUtbm90aWZpY2F0aW9uLWNvbnRhaW5lcic+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0nYXBwYmFyLWd1aWRlLW5vdGlmaWNhdGlvbicgcm9sZT0nYWxlcnQnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0nYXBwYmFyLWd1aWRlLW5vdGlmaWNhdGlvbi1jb250ZW50LXdyYXBwZXIgeXQtdmFsaWduJz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSdhcHBiYXItZ3VpZGUtbm90aWZpY2F0aW9uLWljb24geXQtc3ByaXRlJz48L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0nYXBwYmFyLWd1aWRlLW5vdGlmaWNhdGlvbi10ZXh0LWNvbnRlbnQnPjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uID0gc2V0TG9jYWxlKG5vdGlmaWNhdGlvbi5jb250ZW50KS5maXJzdENoaWxkOwogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIueXQtbWFzdGhlYWQtbG9nby1jb250YWluZXIiKS5hcHBlbmRDaGlsZChub3RpZmljYXRpb24pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIuYXBwYmFyLWd1aWRlLW5vdGlmaWNhdGlvbi10ZXh0LWNvbnRlbnQiKS50ZXh0Q29udGVudCA9IGxhbmcoIkdMQl9TVkVfU0VUUyIpOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZCgic2hvdy1ndWlkZS1idXR0b24tbm90aWZpY2F0aW9uIik7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQoZGVsTm90aWZpY2F0aW9uLCAyMDAwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBuYXZpZ2F0ZVNldHRpbmdzKGV2ZW50KSB7CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygiUC1zYXZlIikpIHsKICAgICAgICAgICAgICAgICAgICBzYXZlU2V0dGluZ3MoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygiUC1yZXNldCIpICYmIHdpbmRvdy5jb25maXJtKGxhbmcoIkdMQl9SU0VUX0NPTkYiKSkpIHsKICAgICAgICAgICAgICAgICAgICBzZXQoInVzZXJfc2V0dGluZ3MiLCBkZWZhdWx0X3NldHRpbmdzKTsKICAgICAgICAgICAgICAgICAgICBzZXR0aW5nc01lbnUuc2V0dGluZ3NCdXR0b24uY2xpY2soKTsKICAgICAgICAgICAgICAgICAgICBzZXR0aW5nc01lbnUuc2V0dGluZ3NCdXR0b24uY2xpY2soKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygiY2xvc2UiKSkgewogICAgICAgICAgICAgICAgICAgIGRlbEJsYWNrTGlzdChldmVudCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoIlAtaW1wZXhwIikgfHwgZXZlbnQudGFyZ2V0LmlkID09PSAiaW1wZXhwLXNhdmUiIHx8IGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoIlAtaW1wbGFuZyIpIHx8IGV2ZW50LnRhcmdldC5pZCA9PT0gImltcGxhbmctc2F2ZSIpIHsKICAgICAgICAgICAgICAgICAgICBleHBvcnRTZXR0aW5ncyhldmVudC50YXJnZXQpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChldmVudC50YXJnZXQuaWQgPT09ICJibGFja2xpc3QtZWRpdCIgfHwgZXZlbnQudGFyZ2V0LmlkID09PSAiYmxhY2tsaXN0LXNhdmUiIHx8IGV2ZW50LnRhcmdldC5pZCA9PT0gImJsYWNrbGlzdC1jbG9zZSIpIHsKICAgICAgICAgICAgICAgICAgICBzZXRCbGFja0xpc3QoZXZlbnQudGFyZ2V0KTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXZlbnQudGFyZ2V0LmlkID09PSAiUC1jb250YWluZXIiIHx8IGV2ZW50LnRhcmdldC5pZCA9PT0gIlAtc2V0dGluZ3MiKSB7CiAgICAgICAgICAgICAgICAgICAgZXZlbnQgPSAoZXZlbnQudGFyZ2V0LmlkID09PSAiUC1zZXR0aW5ncyIpID8gZXZlbnQudGFyZ2V0IDogZXZlbnQudGFyZ2V0LnBhcmVudE5vZGU7CiAgICAgICAgICAgICAgICAgICAgZXZlbnQucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnRbKHdpbmRvdy5jaHJvbWUgJiYgImJvZHkiKSB8fCAiZG9jdW1lbnRFbGVtZW50Il0uc2Nyb2xsVG9wID0gMDsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoInJlc2l6ZSIpKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXZlbnQudGFyZ2V0LmlkICE9PSAiRE5UIiAmJiBldmVudC50YXJnZXQudGFnTmFtZSAhPT0gIkEiICYmIGV2ZW50LnRhcmdldC5wYXJlbnROb2RlLmlkID09PSAiUC1zaWRlYmFyLWxpc3QiKSB7CiAgICAgICAgICAgICAgICAgICAgc2F2ZVNldHRpbmdzKCJuby1ub3RpZmljYXRpb24iKTsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiUC1jb250ZW50IikucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIlAtY29udGFpbmVyIikuYXBwZW5kQ2hpbGQoZ2V0TWVudShldmVudC50YXJnZXQuaWQpKTsKICAgICAgICAgICAgICAgICAgICBldmVudC50YXJnZXQucGFyZW50Tm9kZS5xdWVyeVNlbGVjdG9yKCIuc2VsZWN0ZWQiKS5yZW1vdmVBdHRyaWJ1dGUoImNsYXNzIik7CiAgICAgICAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LmNsYXNzTmFtZSA9ICJzZWxlY3RlZCI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gc2V0dGluZ3NUZW1wbGF0ZShldmVudCkgewogICAgICAgICAgICAgICAgdmFyIHBXcmFwcGVyOwogICAgICAgICAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5pZCA9PT0gIlAiICYmIGV2ZW50LnRhcmdldC50YWdOYW1lICE9PSAiSU5QVVQiKSB7CiAgICAgICAgICAgICAgICAgICAgcFdyYXBwZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiUC1zZXR0aW5ncyIpOwogICAgICAgICAgICAgICAgICAgIGlmIChwV3JhcHBlcikgewogICAgICAgICAgICAgICAgICAgICAgICBwV3JhcHBlci5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygiZmxvYXRlciIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgiZmxvYXRlciIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1vdmllX3BsYXllciIpLnJlbW92ZUF0dHJpYnV0ZSgic3R5bGUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBwV3JhcHBlciA9IGdldE1lbnUoIk1FTiIpOwogICAgICAgICAgICAgICAgICAgICAgICBwV3JhcHBlci5xdWVyeVNlbGVjdG9yKCIjUC1jb250YWluZXIiKS5hcHBlbmRDaGlsZChnZXRNZW51KCJHRU4iKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJib2R5LWNvbnRhaW5lciIpLmluc2VydEJlZm9yZShwV3JhcHBlciwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBhZ2UtY29udGFpbmVyIikpOwogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIG5hdmlnYXRlU2V0dGluZ3MpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBkb2N1bWVudFsod2luZG93LmNocm9tZSAmJiAiYm9keSIpIHx8ICJkb2N1bWVudEVsZW1lbnQiXS5zY3JvbGxUb3AgPSAwOwogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgicmVzaXplIikpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGZpcnN0VGltZShldmVudCkgewogICAgICAgICAgICAgICAgaWYgKGV2ZW50ICYmIGV2ZW50LnRhcmdldCAmJiBldmVudC50YXJnZXQucGFyZW50Tm9kZSAmJiBldmVudC50YXJnZXQucGFyZW50Tm9kZS5jbGFzc05hbWUgPT09ICJwYXJfY2xvc2V3bGNtIikgewogICAgICAgICAgICAgICAgICAgIHNldCgiZmlyc3RUaW1lIiwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZmlyc3RUaW1lKTsKICAgICAgICAgICAgICAgICAgICBzZXR0aW5nc01lbnUud2VsY29tZS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHNldHRpbmdzTWVudSgpIHsKICAgICAgICAgICAgICAgIHZhciBub3RpZl9idXR0b24sIHNldHRpbmdzX2J1dHRvbiwgd2VsY29tZV9tZXNzYWdlOwogICAgICAgICAgICAgICAgaWYgKHNldHRpbmdzTWVudS5zZXR0aW5nc0J1dHRvbikgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG5vdGlmX2J1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiN5dC1tYXN0aGVhZC1ub3RpZmljYXRpb25zLCAubm90aWZpY2F0aW9ucy1jb250YWluZXIiKTsKICAgICAgICAgICAgICAgIHNldHRpbmdzX2J1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiN5dC1tYXN0aGVhZC11c2VyLCAjeXQtbWFzdGhlYWQtc2lnbmluIik7CiAgICAgICAgICAgICAgICBpZiAoc2V0dGluZ3NfYnV0dG9uKSB7CiAgICAgICAgICAgICAgICAgICAgd2VsY29tZV9tZXNzYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGVtcGxhdGUiKTsKICAgICAgICAgICAgICAgICAgICB3ZWxjb21lX21lc3NhZ2UuaW5uZXJIVE1MID0gLy8KICAgICAgICAgICAgICAgICAgICAgICAgYDxkaXYgaWQ9J1BzZXR0aW5ncyc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSdQJyBkYXRhLXA9J3R0bHxZVFNFVFMnIHN0eWxlPSdoZWlnaHQ6MjhweDttYXJnaW4tcmlnaHQ6MTBweDtvcGFjaXR5Oi41NTt2ZXJ0aWNhbC1hbGlnbjptaWRkbGU7d2lkdGg6MThweDsnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzdmcgdmlld0JveD0nMCAwIDE4IDIwJz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHBvbHlnb24gcG9pbnRzPScwLDIwIDE0LDEyIDAsNCcvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cG9seWdvbiBwb2ludHM9JzE1LDMgMTUsMCAxMywwIDEzLDMgMTAsMyAxMCw1IDEzLDUgMTMsOCAxNSw4IDE1LDUgMTgsNSAxOCwzJy8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zdmc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9J3BhcnRfd2VsY29tZScgc3R5bGU9J2Rpc3BsYXk6bm9uZTttYXJnaW4tbGVmdDotMjIwcHg7dG9wOjM4cHg7cmlnaHQ6MCc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gZGF0YS1wPSd0bmR8V0xDTSc+PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxici8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gZGF0YS1wPSd0bmR8V0xDTVNUUlQnPjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnIvPjxici8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGEgZGF0YS1wPSd0bmR8V0xDTUZUUlMnIHN0eWxlPSdjb2xvcjojRkZGOycgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzJyB0YXJnZXQ9J19ibGFuayc+PC9hPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9J3Bhcl9jbG9zZXdsY20nPjxzcGFuPsOXPC9zcGFuPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgICAgICAgICAgICAgd2VsY29tZV9tZXNzYWdlID0gc2V0TG9jYWxlKHdlbGNvbWVfbWVzc2FnZS5jb250ZW50KTsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIHNldHRpbmdzVGVtcGxhdGUpOwogICAgICAgICAgICAgICAgICAgIGlmIChub3RpZl9idXR0b24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3NfYnV0dG9uLmluc2VydEJlZm9yZSh3ZWxjb21lX21lc3NhZ2UsIG5vdGlmX2J1dHRvbik7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3NfYnV0dG9uLmFwcGVuZENoaWxkKHdlbGNvbWVfbWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHNldHRpbmdzTWVudS5zZXR0aW5nc0J1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJQIik7CiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3NNZW51LndlbGNvbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGFydF93ZWxjb21lIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuZmlyc3RUaW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzTWVudS53ZWxjb21lLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZpcnN0VGltZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIG1vZENvbW1lbnQob3JpZ2luYWwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgIHZhciBjb21tZW50cywgaXNfbGl2ZTsKICAgICAgICAgICAgICAgICAgICBjb21tZW50cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ3YXRjaC1kaXNjdXNzaW9uIik7CiAgICAgICAgICAgICAgICAgICAgaXNfbGl2ZSA9IHdpbmRvdy55dHBsYXllciAmJiB3aW5kb3cueXRwbGF5ZXIuY29uZmlnICYmIHdpbmRvdy55dHBsYXllci5jb25maWcuYXJncyAmJiB3aW5kb3cueXRwbGF5ZXIuY29uZmlnLmFyZ3MubGl2ZXN0cmVhbTsKICAgICAgICAgICAgICAgICAgICBpZiAoIXdpbmRvdy5sb2NhdGlvbi5zZWFyY2gubWF0Y2goLyY/KGxjfGdvb2dsZV9jb21tZW50X2lkKT0vKSAmJiBhLnNwbGl0KCJjb21tZW50cyIpLmxlbmd0aCA+IDEgJiYgIWlzX2xpdmUgJiYgY29tbWVudHMgJiYgIWNvbW1lbnRzLmxhenlsb2FkICYmIHVzZXJfc2V0dGluZ3MuVklEX0hJREVfQ09NUyA9PT0gIjEiICYmICFjb21tZW50cy5jbGFzc0xpc3QuY29udGFpbnMoInNob3ciKSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb21tZW50cy5sYXp5bG9hZCA9IGFyZ3VtZW50czsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3JpZ2luYWwuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIG1vZFNldENvbmZpZyhvcmlnaW5hbCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBhID09PSAib2JqZWN0IikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIlNIQVJFX09OX1ZJREVPX0VORCIgaW4gYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5TSEFSRV9PTl9WSURFT19FTkQgPSAhdXNlcl9zZXR0aW5ncy5WSURfRU5EX1NIUkU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCJVTklWRVJTQUxfSE9WRVJDQVJEUyIgaW4gYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5VTklWRVJTQUxfSE9WRVJDQVJEUyA9ICF1c2VyX3NldHRpbmdzLkdFTl9EU0JfSFZSQzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBtb2RFbWJlZChvcmlnaW5hbCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHRlbXAsIHBsYXllcjsKICAgICAgICAgICAgICAgICAgICB0ZW1wID0gYS5pZCB8fCBhOwogICAgICAgICAgICAgICAgICAgIGlmICh0ZW1wICE9PSAicGxheWVyLWFwaSIgJiYgdGVtcCAhPT0gInVwc2VsbC12aWRlbyIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIG1vZEFyZ3MoYik7CiAgICAgICAgICAgICAgICAgICAgdGVtcCA9IG9yaWdpbmFsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgcGxheWVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1vdmllX3BsYXllciIpOwogICAgICAgICAgICAgICAgICAgIGlmIChwbGF5ZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF1c2VyX3NldHRpbmdzLlZJRF9QTFJfQVRQTCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLmN1ZVZpZGVvQnlQbGF5ZXJWYXJzKGIuYXJncyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLnNldFBsYXliYWNrUXVhbGl0eSh1c2VyX3NldHRpbmdzLlZJRF9ERkxUX1FMVFkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGVtcDsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gbW9kQXV0b3BsYXkob3JpZ2luYWwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICAgICAgICAgIGlmICghYiB8fCB1c2VyX3NldHRpbmdzLnBsQXBsIHx8ICghdXNlcl9zZXR0aW5ncy5wbEFwbCAmJiBiLmZlYXR1cmUgJiYgYi5mZWF0dXJlICE9PSAiYXV0b3BsYXkiKSkgewogICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gbW9kQXV0b3BsYXlGdWxsc2NyZWVuKG9yaWdpbmFsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBoYXNfZW5kZWQsIG5leHRfYnV0dG9uLCBuZXh0X2NsaWNrZWQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFkb2N1bWVudC5tb3pGdWxsU2NyZWVuRWxlbWVudCAmJiAhZG9jdW1lbnQud2Via2l0RnVsbHNjcmVlbkVsZW1lbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGhhc19lbmRlZCA9IGFwaSAmJiBhcGkuZ2V0Q3VycmVudFRpbWUgJiYgTWF0aC5yb3VuZChhcGkuZ2V0Q3VycmVudFRpbWUoKSkgPj0gTWF0aC5mbG9vcihhcGkuZ2V0RHVyYXRpb24oKSk7CiAgICAgICAgICAgICAgICAgICAgbmV4dF9jbGlja2VkID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoInl0cC1idXR0b24tbmV4dCIpIHx8IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCJ5dHAtbmV4dC1idXR0b24iKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIXVzZXJfc2V0dGluZ3MucGxBcGwgJiYgIW5leHRfY2xpY2tlZCAmJiBoYXNfZW5kZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmV4dF9idXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIueXRwLW5leHQtYnV0dG9uIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXh0X2J1dHRvbiAmJiBuZXh0X2J1dHRvbi5nZXRBdHRyaWJ1dGUoImFyaWEtZGlzYWJsZWQiKSA9PT0gInRydWUiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXh0X2J1dHRvbi5vbmNsaWNrID0gYXBpLm5leHRWaWRlbzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgYXBpLm5leHRWaWRlbyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXh0X2J1dHRvbi5zZXRBdHRyaWJ1dGUoImFyaWEtZGlzYWJsZWQiLCAiZmFsc2UiKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLnBsQXBsIHx8IG5leHRfY2xpY2tlZCB8fCAhaGFzX2VuZGVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXh0X2NsaWNrZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtb3ZpZV9wbGF5ZXIiKS5mb2N1cygpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvcmlnaW5hbC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gbW9kUGxheWVyQ3JlYXRlKG9yaWdpbmFsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgdGVtcDsKICAgICAgICAgICAgICAgICAgICB0ZW1wID0gYS5pZCB8fCBhOwogICAgICAgICAgICAgICAgICAgIGlmICh0ZW1wICE9PSAicGxheWVyLWFwaSIgJiYgdGVtcCAhPT0gInVwc2VsbC12aWRlbyIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIG1vZEFyZ3MoYik7CiAgICAgICAgICAgICAgICAgICAgaWYgKGEuaWQgPT09ICJ1cHNlbGwtdmlkZW8iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdpbmFsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgYSA9PT0gIm9iamVjdCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyX2luc3RhbmNlID0gb3JpZ2luYWwuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuVklEX1BMUl9GSVQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc2l6ZVBsYXllcigpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBtb2RTZWVrVG8ob3JpZ2luYWwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbih0aW1lKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoImZsb2F0ZXIiKSkgewogICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbC5jYWxsKHRoaXMsIHRpbWUsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gc2NyaXB0RXhpdChldmVudCkgewogICAgICAgICAgICAgICAgdmFyIGksIGosIGtleSwgdGVtcDsKICAgICAgICAgICAgICAgIGlmIChldmVudCAmJiBldmVudC50YXJnZXQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmdldEF0dHJpYnV0ZSgibmFtZSIpID09PSAid3d3L2Jhc2UiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy55dC5zZXRDb25maWcgPSBtb2RTZXRDb25maWcod2luZG93Lnl0LnNldENvbmZpZyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuX3l0X3d3dykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcCA9IE9iamVjdC5rZXlzKHdpbmRvdy5feXRfd3d3KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgPSB0ZW1wLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGogPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleSA9IHRlbXBbaV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cuX3l0X3d3d1trZXldID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChTdHJpbmcod2luZG93Ll95dF93d3dba2V5XSkuc3BsaXQoInBsYXllci1hZGRlZCIpLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5feXRfd3d3W2tleV0gPSBtb2RFbWJlZCh3aW5kb3cuX3l0X3d3d1trZXldKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGorKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChTdHJpbmcod2luZG93Ll95dF93d3dba2V5XSkuc3BsaXQoIndpbmRvdy5zcGYubmF2aWdhdGUiKS5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuX3l0X3d3d1trZXldID0gbW9kQXV0b3BsYXkod2luZG93Ll95dF93d3dba2V5XSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqKys7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoU3RyaW5nKHdpbmRvdy5feXRfd3d3W2tleV0pLnNwbGl0KCIuc2V0KFwiXCIrYSxiLGMsXCIvXCIsZCIpLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy55dHBzZXR3aWRlID0gd2luZG93Ll95dF93d3dba2V5XTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGorKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaiA9PT0gMykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5nZXRBdHRyaWJ1dGUoIm5hbWUiKSA9PT0gInd3dy93YXRjaCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lnl0Lnd3dy53YXRjaC5wbGF5ZXIuc2Vla1RvID0gbW9kU2Vla1RvKHdpbmRvdy55dC53d3cud2F0Y2gucGxheWVyLnNlZWtUbyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChldmVudC50YXJnZXQuZ2V0QXR0cmlidXRlKCJuYW1lIikgPT09ICJzcGYvc3BmIikgewogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc3BmLmxvYWQgPSBtb2RDb21tZW50KHdpbmRvdy5zcGYubG9hZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zcGYucHJlZmV0Y2ggPSBmdW5jdGlvbigpe307CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cubmFtZSA9PT0gInBvcE91dCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zcGYubmF2aWdhdGUgPSBmdW5jdGlvbigpe307CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgKGV2ZW50ICYmIGV2ZW50LnRhcmdldCAmJiBldmVudC50YXJnZXQuZ2V0QXR0cmlidXRlKCJuYW1lIikgPT09ICJwbGF5ZXIvYmFzZSIpIHx8CiAgICAgICAgICAgICAgICAgICAgKCF3aW5kb3cuaHRtbDVQYXRjaGVkICYmIHdpbmRvdy55dCAmJiB3aW5kb3cueXQucGxheWVyICYmIHdpbmRvdy55dC5wbGF5ZXIuQXBwbGljYXRpb24gJiYgd2luZG93Lnl0LnBsYXllci5BcHBsaWNhdGlvbi5jcmVhdGUpCiAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuaHRtbDVQYXRjaGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cueXQucGxheWVyLkFwcGxpY2F0aW9uLmNyZWF0ZSA9IG1vZFBsYXllckNyZWF0ZSh3aW5kb3cueXQucGxheWVyLkFwcGxpY2F0aW9uLmNyZWF0ZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5feXRfcGxheWVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXAgPSBPYmplY3Qua2V5cyh3aW5kb3cuX3l0X3BsYXllcik7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB0ZW1wLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHdpbmRvdy5feXRfcGxheWVyW3RlbXBbaV1dID09PSAiZnVuY3Rpb24iICYmIHdpbmRvdy5feXRfcGxheWVyW3RlbXBbaV1dLnByb3RvdHlwZSAmJiB3aW5kb3cuX3l0X3BsYXllclt0ZW1wW2ldXS5wcm90b3R5cGUuaGFzTmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5feXRfcGxheWVyW3RlbXBbaV1dLnByb3RvdHlwZS5oYXNOZXh0ID0gbW9kQXV0b3BsYXlGdWxsc2NyZWVuKHdpbmRvdy5feXRfcGxheWVyW3RlbXBbaV1dLnByb3RvdHlwZS5oYXNOZXh0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdGVtcC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cuX3l0X3BsYXllclt0ZW1wW2ldXSA9PT0gImZ1bmN0aW9uIiAmJiB3aW5kb3cuX3l0X3BsYXllclt0ZW1wW2ldXS50b1N0cmluZygpLm1hdGNoKC90aGlzXC5hZGFwdGl2ZUZvcm1hdHMvKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleSA9IHRlbXBbaV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gY2hlY2tCb3VuZHMoZWxtLCBYLCBZKSB7CiAgICAgICAgICAgICAgICB2YXIgc25hcFgsIHNuYXBZOwogICAgICAgICAgICAgICAgaWYgKFggPiAtMSAmJiBYICsgZWxtLm9mZnNldFdpZHRoIDwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Lm9mZnNldFdpZHRoKSB7CiAgICAgICAgICAgICAgICAgICAgc25hcFggPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoWCA8IDEpIHsKICAgICAgICAgICAgICAgICAgICBYID0gMDsKICAgICAgICAgICAgICAgICAgICBzbmFwWCA9IC0xOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBYID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Lm9mZnNldFdpZHRoIC0gZWxtLm9mZnNldFdpZHRoOwogICAgICAgICAgICAgICAgICAgIHNuYXBYID0gMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChZID4gNTAgJiYgWSArIGVsbS5vZmZzZXRIZWlnaHQgPCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQub2Zmc2V0SGVpZ2h0KSB7CiAgICAgICAgICAgICAgICAgICAgc25hcFkgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoWSA8IDUxKSB7CiAgICAgICAgICAgICAgICAgICAgWSA9IDUwOwogICAgICAgICAgICAgICAgICAgIHNuYXBZID0gLTE7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIFkgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQub2Zmc2V0SGVpZ2h0IC0gZWxtLm9mZnNldEhlaWdodDsKICAgICAgICAgICAgICAgICAgICBzbmFwWSA9IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4ge1g6IFggKyAicHgiLCBZOiBZICsgInB4Iiwgc25hcFg6IHNuYXBYLCBzbmFwWTogc25hcFl9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVBvcygpIHsKICAgICAgICAgICAgICAgIHZhciB4LCB5LCBoZWlnaHQsIHBsYXllciwgYm91bmRzOwogICAgICAgICAgICAgICAgcGxheWVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1vdmllX3BsYXllciIpOwogICAgICAgICAgICAgICAgaWYgKCFkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCJmbG9hdGVyIikgfHwgd2luZG93LmlubmVyV2lkdGggPCA2NTcpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocGxheWVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllci5yZW1vdmVBdHRyaWJ1dGUoInN0eWxlIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCJmbG9hdGVyIik7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoInJlc2l6ZSIsIHVwZGF0ZVBvcyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaGVpZ2h0ID0gcGFyc2VJbnQodXNlcl9zZXR0aW5ncy5WSURfUExSX0FMVklTX1dEVEgpIHx8IDM1MDsKICAgICAgICAgICAgICAgIHBsYXllciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtb3ZpZV9wbGF5ZXIiKTsKICAgICAgICAgICAgICAgIGJvdW5kcyA9IGNoZWNrQm91bmRzKHBsYXllciwgdXNlcl9zZXR0aW5ncy5mbG9hdGVyWCwgdXNlcl9zZXR0aW5ncy5mbG9hdGVyWSk7CiAgICAgICAgICAgICAgICBoZWlnaHQgPSAoaGVpZ2h0IDwgMzUwID8gMzUwIDogaGVpZ2h0KSAvICgxNiAvIDkpOwogICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuZmxvYXRlclNuYXBYID09PSAtMSkgewogICAgICAgICAgICAgICAgICAgIHggPSAiMHB4IjsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodXNlcl9zZXR0aW5ncy5mbG9hdGVyU25hcFggPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICB4ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Lm9mZnNldFdpZHRoIC0gcGxheWVyLm9mZnNldFdpZHRoICsgInB4IjsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgeCA9IGJvdW5kcy5YOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuZmxvYXRlclNuYXBZID09PSAtMSkgewogICAgICAgICAgICAgICAgICAgIHkgPSAiNTBweCI7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHVzZXJfc2V0dGluZ3MuZmxvYXRlclNuYXBZID09PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgeSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5vZmZzZXRIZWlnaHQgLSBwbGF5ZXIub2Zmc2V0SGVpZ2h0ICsgInB4IjsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgeSA9IGJvdW5kcy5ZOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcGxheWVyLnNldEF0dHJpYnV0ZSgic3R5bGUiLCAid2lkdGg6IiArIChoZWlnaHQgKiAoMTYgLyA5KSkgKyAicHg7aGVpZ2h0OiIgKyBoZWlnaHQgKyAicHg7bGVmdDoiICsgeCArICI7dG9wOiIgKyB5KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBnb1RvVG9wKCkgewogICAgICAgICAgICAgICAgZG9jdW1lbnRbKHdpbmRvdy5jaHJvbWUgJiYgImJvZHkiKSB8fCAiZG9jdW1lbnRFbGVtZW50Il0uc2Nyb2xsVG9wID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBkcmFnRmxvYXRlcihldmVudCkgewogICAgICAgICAgICAgICAgdmFyIGV4Y2x1ZGVkLCBpc0ZTY3JlZW4sIGlzRmxvYXRlciwgYm91bmRzLCBwbGF5ZXI7CiAgICAgICAgICAgICAgICBpc0ZTY3JlZW4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIueXRwLWZ1bGxzY3JlZW4iKTsKICAgICAgICAgICAgICAgIGlzRmxvYXRlciA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoImZsb2F0ZXIiKTsKICAgICAgICAgICAgICAgIGlmIChldmVudCAmJiAhaXNGU2NyZWVuICYmIGlzRmxvYXRlcikgewogICAgICAgICAgICAgICAgICAgIHBsYXllciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtb3ZpZV9wbGF5ZXIiKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQuYnV0dG9ucyA9PT0gMSkgewogICAgICAgICAgICAgICAgICAgICAgICBleGNsdWRlZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi55dHAtY2hyb21lLWJvdHRvbSIpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQudHlwZSA9PT0gIm1vdXNlZG93biIgJiYgcGxheWVyLmNvbnRhaW5zKGV2ZW50LnRhcmdldCkgJiYgKCFleGNsdWRlZCB8fCAhZXhjbHVkZWQuY29udGFpbnMoZXZlbnQudGFyZ2V0KSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlbW92ZSIsIGRyYWdGbG9hdGVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZHJhZ0Zsb2F0ZXIsIHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJhZ0Zsb2F0ZXIub2xkUG9zID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFg6IHBhcnNlSW50KHBsYXllci5zdHlsZS5sZWZ0KSAtIGV2ZW50LmNsaWVudFgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWTogcGFyc2VJbnQocGxheWVyLnN0eWxlLnRvcCkgLSBldmVudC5jbGllbnRZLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yZ1g6IGV2ZW50LmNsaWVudFgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JnWTogZXZlbnQuY2xpZW50WQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnR5cGUgPT09ICJtb3VzZW1vdmUiICYmICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkcmFnRmxvYXRlci5oYXNNb3ZlZCB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGguYWJzKGV2ZW50LmNsaWVudFggLSBkcmFnRmxvYXRlci5vbGRQb3Mub3JnWCkgPiAxMCB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGguYWJzKGV2ZW50LmNsaWVudFkgLSBkcmFnRmxvYXRlci5vbGRQb3Mub3JnWSkgPiAxMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvdW5kcyA9IGNoZWNrQm91bmRzKHBsYXllciwgZXZlbnQuY2xpZW50WCArIGRyYWdGbG9hdGVyLm9sZFBvcy5YLCBldmVudC5jbGllbnRZICsgZHJhZ0Zsb2F0ZXIub2xkUG9zLlkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLnN0eWxlLmxlZnQgPSBib3VuZHMuWDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllci5zdHlsZS50b3AgPSBib3VuZHMuWTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyYWdGbG9hdGVyLmhhc01vdmVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyYWdGbG9hdGVyLnNuYXBYID0gYm91bmRzLnNuYXBYOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJhZ0Zsb2F0ZXIuc25hcFkgPSBib3VuZHMuc25hcFk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LmJ1dHRvbnMgIT09IDEgfHwgZXZlbnQudHlwZSA9PT0gImNsaWNrIikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZHJhZ0Zsb2F0ZXIuaGFzTW92ZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyYWdGbG9hdGVyLm9sZFBvcyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJhZ0Zsb2F0ZXIuaGFzTW92ZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfc2V0dGluZ3MuZmxvYXRlclggPSBwYXJzZUludChwbGF5ZXIuc3R5bGUubGVmdCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyX3NldHRpbmdzLmZsb2F0ZXJZID0gcGFyc2VJbnQocGxheWVyLnN0eWxlLnRvcCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyX3NldHRpbmdzLmZsb2F0ZXJTbmFwWCA9IGRyYWdGbG9hdGVyLnNuYXBYOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcl9zZXR0aW5ncy5mbG9hdGVyU25hcFkgPSBkcmFnRmxvYXRlci5zbmFwWTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldCgidXNlcl9zZXR0aW5ncyIsIHVzZXJfc2V0dGluZ3MpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoIm1vdXNlbW92ZSIsIGRyYWdGbG9hdGVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBkcmFnRmxvYXRlciwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGluaUZsb2F0ZXIoKSB7CiAgICAgICAgICAgICAgICB2YXIgcGxheWVyLCBwbHJBcGksIG91dF9vZl9zaWdodCwgaXNGbG9hdGVyLCBpc0ZTY3JlZW4sIGZsb2F0ZXJVSSwgc2V0dGluZ3Nfb3BlbjsKICAgICAgICAgICAgICAgIHBsYXllciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtb3ZpZV9wbGF5ZXIiKTsKICAgICAgICAgICAgICAgIHBsckFwaSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwbGF5ZXItYXBpIikuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgICAgICAgICAgICBzZXR0aW5nc19vcGVuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIlAtc2V0dGluZ3MiKTsKICAgICAgICAgICAgICAgIGlmIChwbGF5ZXIpIHsKICAgICAgICAgICAgICAgICAgICBvdXRfb2Zfc2lnaHQgPSBwbHJBcGkuYm90dG9tIDwgKChwbHJBcGkuaGVpZ2h0IC8gMikgKyA1MCk7CiAgICAgICAgICAgICAgICAgICAgaXNGbG9hdGVyID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygiZmxvYXRlciIpOwogICAgICAgICAgICAgICAgICAgIGlzRlNjcmVlbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi55dHAtZnVsbHNjcmVlbiIpOwogICAgICAgICAgICAgICAgICAgIGZsb2F0ZXJVSSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwYXJ0X2Zsb2F0ZXJ1aSIpOwogICAgICAgICAgICAgICAgICAgIGlmICghZmxvYXRlclVJICYmICFpc0ZTY3JlZW4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgZmxvYXRlclVJID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGVtcGxhdGUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgZmxvYXRlclVJLmlubmVySFRNTCA9IC8vCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBgPGRpdiBpZD0ncGFydF9mbG9hdGVydWknPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9J3BhcnRfZmxvYXRlcnVpX21vdmUnIGRhdGEtcD0ndHRsfFZJRF9QTFJfQUxWSVNfTU9WRSc+PHN2ZyB2aWV3Qm94PScwIDAgMjAgMjAnPjxwb2x5Z29uIHBvaW50cz0nNi40LDMuNiA3LjIsNC4zIDEwLDEuNSAxMi44LDQuMyAxMy42LDMuNiAxMCwwJy8+PHBvbHlnb24gcG9pbnRzPScxNi40LDYuNCAxNS43LDcuMiAxOC41LDEwIDE1LjcsMTIuOCAxNi40LDEzLjYgMjAsMTAnLz48cG9seWdvbiBwb2ludHM9JzMuNiw2LjQgMCwxMCAzLjYsMTMuNiA0LjMsMTIuOCAxLjUsMTAgNC4zLDcuMicvPjxwb2x5Z29uIHBvaW50cz0nMTAsMTguNSA3LjIsMTUuNyA2LjQsMTYuNCAxMCwyMCAxMy42LDE2LjQgMTIuOCwxNS43Jy8+PGNpcmNsZSBjeD0nMTAnIGN5PScxMCcgcj0nMicvPjwvc3ZnPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9J3BhcnRfZmxvYXRlcnVpX3Njcm9sbHRvcCcgZGF0YS1wPSd0dGx8VklEX1BMUl9BTFZJU19TQ1JMX1RPUCc+PHN2ZyB2aWV3Qm94PScwIDAgMjAgMjAnPjxwb2x5Z29uIHBvaW50cz0nMTAsMC4xIDAsMTAuMSAyLjksMTIuOSAxMCw1LjggMTcuMSwxMi45IDIwLDEwLjEgJy8+PC9zdmc+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgICAgICAgICAgICAgICAgICAgICBmbG9hdGVyVUkgPSBzZXRMb2NhbGUoZmxvYXRlclVJLmNvbnRlbnQpLmZpcnN0Q2hpbGQ7CiAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllci5hcHBlbmRDaGlsZChmbG9hdGVyVUkpOwogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGFydF9mbG9hdGVydWlfbW92ZSIpLmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlZG93biIsIGRyYWdGbG9hdGVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBhcnRfZmxvYXRlcnVpX3Njcm9sbHRvcCIpLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZ29Ub1RvcCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChvdXRfb2Zfc2lnaHQgJiYgIWlzRmxvYXRlciAmJiAhc2V0dGluZ3Nfb3BlbiAmJiB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgPT09ICIvd2F0Y2giKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3QuYWRkKCJmbG9hdGVyIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJyZXNpemUiLCB1cGRhdGVQb3MpOwogICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVQb3MoKTsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCJyZXNpemUiKSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICgoIW91dF9vZl9zaWdodCB8fCBzZXR0aW5nc19vcGVuIHx8IHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSAhPT0gIi93YXRjaCIpICYmIGlzRmxvYXRlcikgewogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgiZmxvYXRlciIpOwogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigicmVzaXplIiwgdXBkYXRlUG9zKTsKICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLnJlbW92ZUF0dHJpYnV0ZSgic3R5bGUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCJyZXNpemUiKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGFsd2F5c1Zpc2libGUoKSB7CiAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5WSURfUExSX0FMVklTKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSA9PT0gIi93YXRjaCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInNjcm9sbCIsIGluaUZsb2F0ZXIpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAod2luZG93LmxvY2F0aW9uLnBhdGhuYW1lICE9PSAiL3dhdGNoIikgewogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigic2Nyb2xsIiwgaW5pRmxvYXRlcik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGFsd2F5c0FjdGl2ZShldmVudCkgewogICAgICAgICAgICAgICAgdmFyIGksIGxpc3QsIGNsZWFyLCBsZW5ndGgsIGV2ZW50Q2xvbmU7CiAgICAgICAgICAgICAgICBjbGVhciA9IHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSA9PSAiL3dhdGNoIiAmJiBhcGkgJiYgYXBpICE9PSBldmVudC50YXJnZXQgJiYgIWFwaS5jb250YWlucyhldmVudC50YXJnZXQpICYmICFldmVudC5jdHJsS2V5ICYmICFldmVudC5zaGlmdEtleSAmJiAhZXZlbnQuYWx0S2V5ICYmICFldmVudC5tZXRhS2V5ICYmICFldmVudC50YXJnZXQuaXNDb250ZW50RWRpdGFibGU7CiAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgY2xlYXIgJiYgKAogICAgICAgICAgICAgICAgICAgICAgICBldmVudC53aGljaCA+IDQ3ICYmIGV2ZW50LndoaWNoIDwgNTggfHwKICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQud2hpY2ggPiA5NSAmJiBldmVudC53aGljaCA8IDEwNiB8fAogICAgICAgICAgICAgICAgICAgICAgICBbMjcsIDMyLCAzNSwgMzYsIDM3LCAzOCwgMzksIDQwLCA2NiwgNjcsIDc5LCA4NywgMTg3LCAxODldLmluZGV4T2YoZXZlbnQud2hpY2gpID4gLTEKICAgICAgICAgICAgICAgICAgICApICYmCiAgICAgICAgICAgICAgICAgICAgWyJFTUJFRCIsICJJTlBVVCIsICJPQkpFQ1QiLCAiVEVYVEFSRUEiLCAiSUZSQU1FIl0uaW5kZXhPZihkb2N1bWVudC5hY3RpdmVFbGVtZW50LnRhZ05hbWUpIDwgMAogICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgZXZlbnRDbG9uZSA9IG5ldyBFdmVudCgia2V5ZG93biIpOwogICAgICAgICAgICAgICAgICAgIGxpc3QgPSBPYmplY3Qua2V5cyhPYmplY3QuZ2V0UHJvdG90eXBlT2YoZXZlbnQpKTsKICAgICAgICAgICAgICAgICAgICBsZW5ndGggPSBsaXN0Lmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRDbG9uZVtsaXN0W2ldXSA9IGV2ZW50W2xpc3RbaV1dOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgIGFwaS5kaXNwYXRjaEV2ZW50KGV2ZW50Q2xvbmUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHBsYXllclN0YXRlKGV2ZW50KSB7CiAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5mdWxsQnJzIHx8IHVzZXJfc2V0dGluZ3MubGlnaHRzT3V0KSB7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsYXNzTGlzdFsoZXZlbnQgPCA1ICYmIGV2ZW50ID4gMCAmJiAiYWRkIikgfHwgInJlbW92ZSJdKCh1c2VyX3NldHRpbmdzLmZ1bGxCcnMgJiYgInBhcnRfZnVsbGJyb3dzZXIiKSB8fCAiMCIsICh1c2VyX3NldHRpbmdzLmxpZ2h0c091dCAmJiAicGFydF9jaW5lbWFfbW9kZSIpIHx8ICIwIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoInJlc2l6ZSIpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBoYW5kbGVDdXN0b21zKGV2ZW50KSB7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGV2ZW50ID09PSAib2JqZWN0IikgewogICAgICAgICAgICAgICAgICAgIHNldCgidm9sTGV2IiwgZXZlbnQudm9sdW1lKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgc2V0KCJ0aGVhdGVyTW9kZSIsIGV2ZW50KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBwbGF5ZXJSZWFkeSgpIHsKICAgICAgICAgICAgICAgIGFwaSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtb3ZpZV9wbGF5ZXIiKTsKICAgICAgICAgICAgICAgIGlmIChhcGkgJiYgIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjNC1wbGF5ZXIiKSkgewogICAgICAgICAgICAgICAgICAgIGFwaS5hZGRFdmVudExpc3RlbmVyKCJvblN0YXRlQ2hhbmdlIiwgcGxheWVyU3RhdGUpOwogICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLlZJRF9QTFJfVk9MX01FTSkgewogICAgICAgICAgICAgICAgICAgICAgICBhcGkuYWRkRXZlbnRMaXN0ZW5lcigib25Wb2x1bWVDaGFuZ2UiLCBoYW5kbGVDdXN0b21zKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuVklEX1BMUl9TSVpFX01FTSkgewogICAgICAgICAgICAgICAgICAgICAgICBhcGkuYWRkRXZlbnRMaXN0ZW5lcigiU0laRV9DTElDS0VEIiwgaGFuZGxlQ3VzdG9tcyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLlZJRF9QTFJfVk9MX01FTSkgewogICAgICAgICAgICAgICAgICAgICAgICBhcGkuc2V0Vm9sdW1lKHVzZXJfc2V0dGluZ3Mudm9sTGV2KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MubG9vcFZpZCkgewogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJ2aWRlbyIpLmxvb3AgPSB1c2VyX3NldHRpbmdzLmxvb3BWaWQ7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLlZJRF9QTFJfQUxBQ1QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigia2V5ZG93biIsIGFsd2F5c0FjdGl2ZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGdldFRodW1iKCkgewogICAgICAgICAgICAgICAgdmFyIHRodW1ibmFpbF91cmw7CiAgICAgICAgICAgICAgICB0aHVtYm5haWxfdXJsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2hyZWYqPSdtYXhyZXNkZWZhdWx0J10iKTsKICAgICAgICAgICAgICAgIHRodW1ibmFpbF91cmwgPSB0aHVtYm5haWxfdXJsICYmIHRodW1ibmFpbF91cmwuZ2V0QXR0cmlidXRlKCJocmVmIik7CiAgICAgICAgICAgICAgICBpZiAodGh1bWJuYWlsX3VybCkgewogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5vcGVuKHRodW1ibmFpbF91cmwpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh3aW5kb3cueXRwbGF5ZXIgJiYgd2luZG93Lnl0cGxheWVyLmNvbmZpZyAmJiB3aW5kb3cueXRwbGF5ZXIuY29uZmlnLmFyZ3MgJiYgd2luZG93Lnl0cGxheWVyLmNvbmZpZy5hcmdzLnRodW1ibmFpbF91cmwpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cub3Blbih3aW5kb3cueXRwbGF5ZXIuY29uZmlnLmFyZ3MudGh1bWJuYWlsX3VybCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gaGlkZVNjcmVlbnNob3QoZXZlbnQpIHsKICAgICAgICAgICAgICAgIGlmIChldmVudC50YXJnZXQuaWQgPT09ICJjbG9zZS1zY3JlZW5zaG90IikgewogICAgICAgICAgICAgICAgICAgIGV2ZW50LnRhcmdldC5wYXJlbnROb2RlLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoImNsaWNrIiwgaGlkZVNjcmVlbnNob3QpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGdldFNjcmVlbnNob3QoKSB7CiAgICAgICAgICAgICAgICB2YXIgd2lkdGgsIGhlaWdodCwgYXNwZWN0UmF0aW8sIHZpZGVvLCBjb250YWluZXIsIGNhbnZhcywgY2xvc2UsIGNvbnRleHQ7CiAgICAgICAgICAgICAgICB2aWRlbyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoInZpZGVvIik7CiAgICAgICAgICAgICAgICBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic2NyZWVuc2hvdC1yZXN1bHQiKSB8fCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgICAgICAgICAgIGNhbnZhcyA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCJjYW52YXMiKSB8fCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJjYW52YXMiKTsKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCgiMmQiKTsKICAgICAgICAgICAgICAgIGFzcGVjdFJhdGlvID0gdmlkZW8udmlkZW9XaWR0aCAvIHZpZGVvLnZpZGVvSGVpZ2h0OwogICAgICAgICAgICAgICAgd2lkdGggPSB2aWRlby52aWRlb1dpZHRoOwogICAgICAgICAgICAgICAgaGVpZ2h0ID0gcGFyc2VJbnQod2lkdGggLyBhc3BlY3RSYXRpbywgMTApOwogICAgICAgICAgICAgICAgY2FudmFzLndpZHRoID0gd2lkdGg7CiAgICAgICAgICAgICAgICBjYW52YXMuaGVpZ2h0ID0gaGVpZ2h0OwogICAgICAgICAgICAgICAgY29udGV4dC5kcmF3SW1hZ2UodmlkZW8sIDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgICAgICAgICAgaWYgKCFjb250YWluZXIuaWQpIHsKICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuaWQgPSAic2NyZWVuc2hvdC1yZXN1bHQiOwogICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChjYW52YXMpOwogICAgICAgICAgICAgICAgICAgIGNsb3NlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgICAgICAgICAgICAgY2xvc2UuaWQgPSAiY2xvc2Utc2NyZWVuc2hvdCI7CiAgICAgICAgICAgICAgICAgICAgY2xvc2UudGV4dENvbnRlbnQgPSBsYW5nKCJDTlNMX1NTX0NMUyIpOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgaGlkZVNjcmVlbnNob3QpOwogICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChjbG9zZSk7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjb250YWluZXIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGV4aXRGdWxsQnJvd3NlcihrZXkpIHsKICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCJwYXJ0X2Z1bGxicm93c2VyIikgJiYgKAogICAgICAgICAgICAgICAgICAgICAgICBrZXkua2V5Q29kZSA9PT0gMjcgfHwKICAgICAgICAgICAgICAgICAgICAgICAga2V5LmtleSA9PT0gIkVzY2FwZSIgfHwgKAogICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5LnRhcmdldC5jbGFzc05hbWUgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleS50YXJnZXQuY2xhc3NOYW1lLnNwbGl0KCJ5dHAtc2l6ZSIpLmxlbmd0aCA+IDEKICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgIHRvZ2dsZUZ1bGxCcm93c2VyKGtleSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGtleS50eXBlID09PSAibW91c2Vkb3duIikgewogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJrZXlkb3duIiwgZXhpdEZ1bGxCcm93c2VyKTsKICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigibW91c2Vkb3duIiwgZXhpdEZ1bGxCcm93c2VyKTsKICAgICAgICAgICAgICAgICAgICAgICAga2V5LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHRvZ2dsZUZ1bGxCcm93c2VyKGV2ZW50KSB7CiAgICAgICAgICAgICAgICB2YXIgcGxyU3RhdGUgPSBhcGkgJiYgYXBpLmdldFBsYXllclN0YXRlICYmIGFwaS5nZXRQbGF5ZXJTdGF0ZSgpOwogICAgICAgICAgICAgICAgcGxyU3RhdGUgPSBwbHJTdGF0ZSA8IDUgJiYgcGxyU3RhdGUgPiAwOwogICAgICAgICAgICAgICAgZG9jdW1lbnRbKHdpbmRvdy5jaHJvbWUgJiYgImJvZHkiKSB8fCAiZG9jdW1lbnRFbGVtZW50Il0uc2Nyb2xsVG9wID0gMDsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImtleWRvd24iLCBleGl0RnVsbEJyb3dzZXIpOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigibW91c2Vkb3duIiwgZXhpdEZ1bGxCcm93c2VyKTsKICAgICAgICAgICAgICAgIHNldCgiZnVsbEJycyIsIGV2ZW50ID8gIXVzZXJfc2V0dGluZ3MuZnVsbEJycyA6IHRydWUpOwogICAgICAgICAgICAgICAgYWR2YW5jZWRPcHRpb25zLmZ1bGxfYnJvd3Nlci5jbGFzc0xpc3RbKHVzZXJfc2V0dGluZ3MuZnVsbEJycyAmJiAiYWRkIikgfHwgInJlbW92ZSJdKCJhY3RpdmUiKTsKICAgICAgICAgICAgICAgIGlmIChldmVudCAmJiAocGxyU3RhdGUgfHwgZXZlbnQua2V5Q29kZSA9PT0gMjcgfHwgZXZlbnQua2V5ID09PSAiRXNjYXBlIikpIHsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0Wyh1c2VyX3NldHRpbmdzLmZ1bGxCcnMgJiYgImFkZCIpIHx8ICJyZW1vdmUiXSgicGFydF9mdWxsYnJvd3NlciIpOwogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgicmVzaXplIikpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHRvZ2dsZUZyYW1lcyhldmVudCkgewogICAgICAgICAgICAgICAgdmFyIGksIHBpLCBmcHMsIHRlbXA7CiAgICAgICAgICAgICAgICBhZHZhbmNlZE9wdGlvbnMuZnJhbWVfc3RlcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJmcmFtZXN0ZXAtYnV0dG9uIik7CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQgJiYgWyJFTUJFRCIsICJJTlBVVCIsICJPQkpFQ1QiLCAiVEVYVEFSRUEiXS5pbmRleE9mKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQudGFnTmFtZSkgPCAwICYmIGV2ZW50LnRhcmdldC50YWdOYW1lICE9PSAiSUZSQU1FIiAmJiAhZXZlbnQudGFyZ2V0LmdldEF0dHJpYnV0ZSgiY29udGVudGVkaXRhYmxlIikpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoKGV2ZW50LmtleUNvZGUgPT09IDM3IHx8IGV2ZW50LmtleUNvZGUgPT09IDM5KSAmJiBldmVudC5zaGlmdEtleSkgewogICAgICAgICAgICAgICAgICAgICAgICBwaSA9IGFwaS5nZXRWaWRlb1N0YXRzKCkuZm10OwogICAgICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93Lnl0cGxheWVyICYmIHdpbmRvdy55dHBsYXllci5jb25maWcgJiYgd2luZG93Lnl0cGxheWVyLmNvbmZpZy5hcmdzICYmIHdpbmRvdy55dHBsYXllci5jb25maWcuYXJncy5hZGFwdGl2ZV9mbXRzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wID0gd2luZG93Lnl0cGxheWVyLmNvbmZpZy5hcmdzLmFkYXB0aXZlX2ZtdHMuc3BsaXQoIiwiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgPSB0ZW1wLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGVtcFtpXS5pbmRleE9mKCJpdGFnPSIgKyBwaSkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkdmFuY2VkT3B0aW9ucy5mcHMgPSBwYXJzZUludCh0ZW1wW2ldLm1hdGNoKC9mcHM9KFtcZF0rKS8pWzFdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghYWR2YW5jZWRPcHRpb25zLmZwcyB8fCBhZHZhbmNlZE9wdGlvbnMuZnBzID09PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZHZhbmNlZE9wdGlvbnMuZnBzID0gMzA7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZnBzID0gKChldmVudC5rZXlDb2RlIDwgMzkgJiYgLTEpIHx8IDEpICogKChhZHZhbmNlZE9wdGlvbnMuZnBzIDwgMiAmJiAzMCkgfHwgYWR2YW5jZWRPcHRpb25zLmZwcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmcHMgJiYgYXBpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoInZpZGVvIikucGF1c2VkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBpLnBhdXNlVmlkZW8oKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwaS5zZWVrQnkoMSAvIGZwcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSAiY2xpY2siICYmIGV2ZW50LnRhcmdldC5pZCA9PT0gImZyYW1lc3RlcC1idXR0b24iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNldCgiZnJhbWVfc3RlcCIsICF1c2VyX3NldHRpbmdzLmZyYW1lX3N0ZXApOwogICAgICAgICAgICAgICAgICAgICAgICBhZHZhbmNlZE9wdGlvbnMuZnJhbWVfc3RlcC5jbGFzc0xpc3RbKHVzZXJfc2V0dGluZ3MuZnJhbWVfc3RlcCAmJiAiYWRkIikgfHwgInJlbW92ZSJdKCJhY3RpdmUiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoYWR2YW5jZWRPcHRpb25zLmZyYW1lX3N0ZXAgJiYgYWR2YW5jZWRPcHRpb25zLmZyYW1lX3N0ZXAuY2xhc3NMaXN0LmNvbnRhaW5zKCJhY3RpdmUiKSkgewogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImtleWRvd24iLCB0b2dnbGVGcmFtZXMsIHRydWUpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICghYWR2YW5jZWRPcHRpb25zLmZyYW1lX3N0ZXAgfHwgIWFkdmFuY2VkT3B0aW9ucy5mcmFtZV9zdGVwLmNsYXNzTGlzdC5jb250YWlucygiYWN0aXZlIikpIHsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJrZXlkb3duIiwgdG9nZ2xlRnJhbWVzLCB0cnVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiB0b2dnbGVTaG9ydGN1dHMoKSB7CiAgICAgICAgICAgICAgICB3aW5kb3cub3BlbigiaHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL1lvdVR1YmUtc2hvcnRjdXRzIiwgIl9ibGFuayIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHRvZ2dsZUNvbnNvbGUoZXZlbnQpIHsKICAgICAgICAgICAgICAgIGlmIChldmVudC50YXJnZXQuaWQgPT09ICJjb25zb2xlLWJ1dHRvbiIpIHsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0LnRvZ2dsZSgicGxheWVyLWNvbnNvbGUiKTsKICAgICAgICAgICAgICAgICAgICBldmVudC50YXJnZXQuY2xhc3NMaXN0W2RvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoInBsYXllci1jb25zb2xlIikgPyAiYWRkIiA6ICJyZW1vdmUiXSgiY2xvc2UiKTsKICAgICAgICAgICAgICAgICAgICBzZXQoImFkdk9wdHMiLCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCJwbGF5ZXItY29uc29sZSIpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiB0b2dnbGVQbGF5KCkgewogICAgICAgICAgICAgICAgc2V0KCJWSURfUExSX0FUUEwiLCAhdXNlcl9zZXR0aW5ncy5WSURfUExSX0FUUEwpOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsYXNzTGlzdFsodXNlcl9zZXR0aW5ncy5WSURfUExSX0FUUEwgJiYgImFkZCIpIHx8ICJyZW1vdmUiXSgicGFydF9hdXRvcGxheW9uIik7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYXV0b3BsYXktYnV0dG9uIikuY2xhc3NMaXN0Wyh1c2VyX3NldHRpbmdzLlZJRF9QTFJfQVRQTCAmJiAiYWRkIikgfHwgInJlbW92ZSJdKCJhY3RpdmUiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiB0b2dnbGVMb29wKGV2ZW50KSB7CiAgICAgICAgICAgICAgICB2YXIgdmlkZW9QbGF5ZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJ2aWRlbyIpOwogICAgICAgICAgICAgICAgaWYgKHZpZGVvUGxheWVyKSB7CiAgICAgICAgICAgICAgICAgICAgdmlkZW9QbGF5ZXIubG9vcCA9IGV2ZW50ID8gIXVzZXJfc2V0dGluZ3MubG9vcFZpZCA6IHVzZXJfc2V0dGluZ3MubG9vcFZpZDsKICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWR2YW5jZWRPcHRpb25zLmxvb3BfYnV0dG9uLmNsYXNzTGlzdFsoIXVzZXJfc2V0dGluZ3MubG9vcFZpZCAmJiAiYWRkIikgfHwgInJlbW92ZSJdKCJhY3RpdmUiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZXQoImxvb3BWaWQiLCBhZHZhbmNlZE9wdGlvbnMubG9vcF9idXR0b24uY2xhc3NMaXN0LmNvbnRhaW5zKCJhY3RpdmUiKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gdG9nZ2xlQ2luZW1hTW9kZShldmVudCkgewogICAgICAgICAgICAgICAgdmFyIHBsclN0YXRlID0gYXBpICYmIGFwaS5nZXRQbGF5ZXJTdGF0ZSAmJiBhcGkuZ2V0UGxheWVyU3RhdGUoKSA8IDUgJiYgYXBpLmdldFBsYXllclN0YXRlKCkgPiAwOwogICAgICAgICAgICAgICAgc2V0KCJsaWdodHNPdXQiLCBldmVudCA/ICF1c2VyX3NldHRpbmdzLmxpZ2h0c091dCA6IHRydWUpOwogICAgICAgICAgICAgICAgYWR2YW5jZWRPcHRpb25zLmNpbmVtYV9tb2RlLmNsYXNzTGlzdFsodXNlcl9zZXR0aW5ncy5saWdodHNPdXQgJiYgImFkZCIpIHx8ICJyZW1vdmUiXSgiYWN0aXZlIik7CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQgJiYgcGxyU3RhdGUpIHsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0Wyh1c2VyX3NldHRpbmdzLmxpZ2h0c091dCAmJiAiYWRkIikgfHwgInJlbW92ZSJdKCJwYXJ0X2NpbmVtYV9tb2RlIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gaGFuZGxlVG9nZ2xlcyhldmVudCkgewogICAgICAgICAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5kYXRhc2V0ICYmIGV2ZW50LnRhcmdldC5kYXRhc2V0LmFjdGlvbiAmJiBhZHZhbmNlZE9wdGlvbnMuYWN0aW9uc1tldmVudC50YXJnZXQuZGF0YXNldC5hY3Rpb25dKSB7CiAgICAgICAgICAgICAgICAgICAgYWR2YW5jZWRPcHRpb25zLmFjdGlvbnNbZXZlbnQudGFyZ2V0LmRhdGFzZXQuYWN0aW9uXShldmVudCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gaG9va0J1dHRvbnMoKSB7CiAgICAgICAgICAgICAgICBhZHZhbmNlZE9wdGlvbnMucG9wUGxheWVyID0gcG9wUGxheWVyOwogICAgICAgICAgICAgICAgYWR2YW5jZWRPcHRpb25zLmZ1bGxfYnJvd3NlciA9IGFkdmFuY2VkT3B0aW9ucy5jb250cm9scy5xdWVyeVNlbGVjdG9yKCIjZnVsbGJyb3dzZXItYnV0dG9uIik7CiAgICAgICAgICAgICAgICBhZHZhbmNlZE9wdGlvbnMuY2luZW1hX21vZGUgPSBhZHZhbmNlZE9wdGlvbnMuY29udHJvbHMucXVlcnlTZWxlY3RvcigiI2NpbmVtYW1vZGUtYnV0dG9uIik7CiAgICAgICAgICAgICAgICBhZHZhbmNlZE9wdGlvbnMubG9vcF9idXR0b24gPSBhZHZhbmNlZE9wdGlvbnMuY29udHJvbHMucXVlcnlTZWxlY3RvcigiI2xvb3AtYnV0dG9uIik7CiAgICAgICAgICAgICAgICBhZHZhbmNlZE9wdGlvbnMuZnJhbWVfc3RlcCA9IGFkdmFuY2VkT3B0aW9ucy5jb250cm9scy5xdWVyeVNlbGVjdG9yKCIjZnJhbWVzdGVwLWJ1dHRvbiIpOwogICAgICAgICAgICAgICAgYWR2YW5jZWRPcHRpb25zLmFjdGlvbnMgPSB7CiAgICAgICAgICAgICAgICAgICAgdG9nZ2xlUGxheTogdG9nZ2xlUGxheSwKICAgICAgICAgICAgICAgICAgICB0b2dnbGVMb29wOiB0b2dnbGVMb29wLAogICAgICAgICAgICAgICAgICAgIGdldFRodW1iOiBnZXRUaHVtYiwKICAgICAgICAgICAgICAgICAgICBnZXRTY3JlZW5zaG90OiBnZXRTY3JlZW5zaG90LAogICAgICAgICAgICAgICAgICAgIHBvcFBsYXllcjogcG9wUGxheWVyLAogICAgICAgICAgICAgICAgICAgIHRvZ2dsZUZ1bGxCcm93c2VyOiB0b2dnbGVGdWxsQnJvd3NlciwKICAgICAgICAgICAgICAgICAgICB0b2dnbGVDaW5lbWFNb2RlOiB0b2dnbGVDaW5lbWFNb2RlLAogICAgICAgICAgICAgICAgICAgIHRvZ2dsZUZyYW1lczogdG9nZ2xlRnJhbWVzLAogICAgICAgICAgICAgICAgICAgIHRvZ2dsZVNob3J0Y3V0czogdG9nZ2xlU2hvcnRjdXRzCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBoYW5kbGVUb2dnbGVzKTsKICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLmxvb3BWaWQgJiYgIWFkdmFuY2VkT3B0aW9ucy5sb29wX2J1dHRvbi5jbGFzc0xpc3QuY29udGFpbnMoImFjdGl2ZSIpKSB7CiAgICAgICAgICAgICAgICAgICAgYWR2YW5jZWRPcHRpb25zLmxvb3BfYnV0dG9uLmNsYXNzTGlzdC5hZGQoImFjdGl2ZSIpOwogICAgICAgICAgICAgICAgICAgIHRvZ2dsZUxvb3AoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLmZ1bGxCcnMgJiYgIWFkdmFuY2VkT3B0aW9ucy5mdWxsX2Jyb3dzZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCJhY3RpdmUiKSkgewogICAgICAgICAgICAgICAgICAgIGFkdmFuY2VkT3B0aW9ucy5mdWxsX2Jyb3dzZXIuY2xhc3NMaXN0LmFkZCgiYWN0aXZlIik7CiAgICAgICAgICAgICAgICAgICAgdG9nZ2xlRnVsbEJyb3dzZXIoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLmxpZ2h0c091dCAmJiAhYWR2YW5jZWRPcHRpb25zLmNpbmVtYV9tb2RlLmNsYXNzTGlzdC5jb250YWlucygiYWN0aXZlIikpIHsKICAgICAgICAgICAgICAgICAgICBhZHZhbmNlZE9wdGlvbnMuY2luZW1hX21vZGUuY2xhc3NMaXN0LmFkZCgiYWN0aXZlIik7CiAgICAgICAgICAgICAgICAgICAgdG9nZ2xlQ2luZW1hTW9kZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuZnJhbWVfc3RlcCAmJiAhYWR2YW5jZWRPcHRpb25zLmZyYW1lX3N0ZXAuY2xhc3NMaXN0LmNvbnRhaW5zKCJhY3RpdmUiKSkgewogICAgICAgICAgICAgICAgICAgIGFkdmFuY2VkT3B0aW9ucy5mcmFtZV9zdGVwLmNsYXNzTGlzdC5hZGQoImFjdGl2ZSIpOwogICAgICAgICAgICAgICAgICAgIHRvZ2dsZUZyYW1lcygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGFkdmFuY2VkT3B0aW9ucygpIHsKICAgICAgICAgICAgICAgIHZhciBoZWFkZXIsIGNuc2xCdG4sIGNuc2xDb250OwogICAgICAgICAgICAgICAgaGVhZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIndhdGNoLWhlYWRlciIpOwogICAgICAgICAgICAgICAgY25zbEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb25zb2xlLWJ1dHRvbiIpOwogICAgICAgICAgICAgICAgYWR2YW5jZWRPcHRpb25zLmNvbnRyb2xzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBsYXllci1jb25zb2xlIik7CiAgICAgICAgICAgICAgICBpZiAod2luZG93LmxvY2F0aW9uLnBhdGhuYW1lID09PSAiL3dhdGNoIiAmJiBoZWFkZXIgJiYgIWNuc2xCdG4pIHsKICAgICAgICAgICAgICAgICAgICBjbnNsQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGVtcGxhdGUiKTsKICAgICAgICAgICAgICAgICAgICBjbnNsQnRuLmlubmVySFRNTCA9IC8vCiAgICAgICAgICAgICAgICAgICAgICAgIGA8YnV0dG9uIGlkPSdjb25zb2xlLWJ1dHRvbicgZGF0YS1wPSd0dGx8QURWX09QVFMnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN2ZyBjbGFzcz0nY2xvc2UnIHZpZXdCb3g9JzAgMCAxMCAxMCc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHBvbHlnb24gcG9pbnRzPScxMCwxLjQgOC42LDAgNSwzLjYgMS40LDAgMCwxLjQgMy42LDUgMCw4LjYgMS40LDEwIDUsNi40IDguNiwxMCAxMCw4LjYgNi40LDUnLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3ZnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN2ZyBjbGFzcz0nb3Blbicgdmlld0JveD0nMCAwIDEyIDEwJz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cmVjdCB3aWR0aD0nMTInIGhlaWdodD0nMicvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxyZWN0IHdpZHRoPScxMicgaGVpZ2h0PScyJyB5PSc0Jy8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHJlY3Qgd2lkdGg9JzEyJyBoZWlnaHQ9JzInIHk9JzgnLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3ZnPgogICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj5gOwogICAgICAgICAgICAgICAgICAgIGNuc2xCdG4gPSBzZXRMb2NhbGUoY25zbEJ0bi5jb250ZW50KS5maXJzdENoaWxkOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgdG9nZ2xlQ29uc29sZSk7CiAgICAgICAgICAgICAgICAgICAgY25zbENvbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZW1wbGF0ZSIpOwogICAgICAgICAgICAgICAgICAgIGNuc2xDb250LmlubmVySFRNTCA9ICI8ZGl2IGlkPSdhZHZhbmNlZC1vcHRpb25zJz48L2Rpdj4iOwogICAgICAgICAgICAgICAgICAgIGNuc2xDb250ID0gY25zbENvbnQuY29udGVudC5maXJzdENoaWxkOwogICAgICAgICAgICAgICAgICAgIGNuc2xDb250LmFwcGVuZENoaWxkKGNuc2xCdG4pOwogICAgICAgICAgICAgICAgICAgIGhlYWRlci5hcHBlbmRDaGlsZChjbnNsQ29udCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGFkdmFuY2VkT3B0aW9ucy5jb250cm9scykgewogICAgICAgICAgICAgICAgICAgICAgICBhZHZhbmNlZE9wdGlvbnMuY29udHJvbHMucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGFkdmFuY2VkT3B0aW9ucy5jb250cm9scyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRlbXBsYXRlIik7CiAgICAgICAgICAgICAgICAgICAgYWR2YW5jZWRPcHRpb25zLmNvbnRyb2xzLmlubmVySFRNTCA9IC8vCiAgICAgICAgICAgICAgICAgICAgICAgIGA8ZGl2IGlkPSdwbGF5ZXItY29uc29sZSc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSdhdXRvcGxheS1idXR0b24nIGNsYXNzPSd5dC11aXgtdG9vbHRpcCcgZGF0YS1wPSd0dHB8Q05TTF9BUCcgZGF0YS1hY3Rpb249J3RvZ2dsZVBsYXknPjxzdmcgdmlld0JveD0nMCAwIDE0IDE2Jz48cG9seWdvbiBwb2ludHM9JzAsMTYgMTQsOCAwLDAnLz48L3N2Zz48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9J2xvb3AtYnV0dG9uJyBjbGFzcz0neXQtdWl4LXRvb2x0aXAnIGRhdGEtcD0ndHRwfENOU0xfUlBUJyBkYXRhLWFjdGlvbj0ndG9nZ2xlTG9vcCc+PHN2ZyB2aWV3Qm94PScwIDAgMjAuNSAxOCc+PHBhdGggZD0nTTExLjUsMEM5LDAsNi44LDEsNS4xLDIuNmwxLjQsMS40QzcuOCwyLjgsOS42LDIsMTEuNSwyYzMuOSwwLDcsMy4xLDcsN2MwLDMuOS0zLjEsNy03LDdzLTctMy4xLTctN0g3TDMuNSw0TDAsOSBoMi41YzAsNSw0LDksOSw5czktNCw5LTlDMjAuNSw0LDE2LjUsMCwxMS41LDB6Jy8+PC9zdmc+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSdzYXZlLXRodW1ibmFpbC1idXR0b24nIGNsYXNzPSd5dC11aXgtdG9vbHRpcCcgZGF0YS1wPSd0dHB8Q05TTF9TVlRIJyBkYXRhLWFjdGlvbj0nZ2V0VGh1bWInPjxzdmcgdmlld0JveD0nMCAwIDI0IDE4Jz48cGF0aCBkPSdNMCwwdjE4aDI0VjBIMHogTTIyLDE2SDJWMmgyMFYxNnonLz48Y2lyY2xlIGN4PSc4JyBjeT0nNicgcj0nMycvPjxwb2x5Z29uIHBvaW50cz0nMywxMiA2LDEwIDksMTIgMTAsMTIgMTYsNiAyMSwxMSAyMSwxNSAzLDE1Jy8+PC9zdmc+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSdzY3JlZW5zaG90LWJ1dHRvbicgY2xhc3M9J3l0LXVpeC10b29sdGlwJyBkYXRhLXA9J3R0cHxDTlNMX1NTJyBkYXRhLWFjdGlvbj0nZ2V0U2NyZWVuc2hvdCc+PHN2ZyB2aWV3Qm94PScwIDAgMjIgMTgnPjxwYXRoIGQ9J00xNy43LDRsLTIuMy00aC05TDQuMSw0SDB2MTRoMjJWNEgxNy43eiBNMTEsMTVjLTIuOCwwLTUtMi4yLTUtNXMyLjItNSw1LTVzNSwyLjIsNSw1UzEzLjgsMTUsMTEsMTV6Jy8+PGNpcmNsZSBjeD0nMTEnIGN5PScxMCcgcj0nNCcvPjwvc3ZnPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0ncG9wb3V0LWJ1dHRvbicgY2xhc3M9J3l0LXVpeC10b29sdGlwJyBkYXRhLXA9J3R0cHxDTlNMX1BQT1QnIGRhdGEtYWN0aW9uPSdwb3BQbGF5ZXInPjxzdmcgdmlld0JveD0nMCAwIDIyIDE2Jz48cGF0aCBkPSdNNiwwdjEyaDE2VjBINnogTTIwLDEwSDhWMmgxMlYxMHonLz48cG9seWdvbiBwb2ludHM9JzE0LDE0IDIsMTQgMiw2IDUsNiA1LDQgMCw0IDAsMTYgMTYsMTYgMTYsMTMgMTQsMTMnLz48L3N2Zz48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9J2Z1bGxicm93c2VyLWJ1dHRvbicgY2xhc3M9J3l0LXVpeC10b29sdGlwJyBkYXRhLXA9J3R0cHxDTlNMX0ZMQlInIGRhdGEtYWN0aW9uPSd0b2dnbGVGdWxsQnJvd3Nlcic+PHN2ZyB2aWV3Qm94PScwIDAgMjAgMTgnPjxwYXRoIGQ9J00wLDB2MThoMjBWMEgweiBNMTgsMTZIMlY0aDE2VjE2eicvPjxwb2x5Z29uIHBvaW50cz0nMyw1IDMsOSA1LDkgNSw3IDcsNyA3LDUnLz48cG9seWdvbiBwb2ludHM9JzE3LDUgMTMsNSAxMyw3IDE1LDcgMTUsOSAxNyw5Jy8+PHBvbHlnb24gcG9pbnRzPScxNywxNSAxNywxMSAxNSwxMSAxNSwxMyAxMywxMyAxMywxNScvPjxwb2x5Z29uIHBvaW50cz0nMywxNSA3LDE1IDcsMTMgNSwxMyA1LDExIDMsMTEnLz48L3N2Zz48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9J2NpbmVtYW1vZGUtYnV0dG9uJyBjbGFzcz0neXQtdWl4LXRvb2x0aXAnIGRhdGEtcD0ndHRwfENOU0xfQ0lOTV9NRCcgZGF0YS1hY3Rpb249J3RvZ2dsZUNpbmVtYU1vZGUnPjxzdmcgdmlld0JveD0nMCAwIDIwIDE4Jz48cGF0aCBkPSdNMTgsMHYyaC0yVjBINHYySDJWMEgwdjE4aDJ2LTJoMnYyaDEydi0yaDJ2MmgyVjBIMTh6IE00LDE0SDJ2LTJoMlYxNHogTTQsMTBIMlY4aDJWMTB6IE00LDZIMlY0aDJWNnogTTE0LDE2IEg2di02aDhWMTZ6IE0xNCw4SDZWMmg4Vjh6IE0xOCwxNGgtMnYtMmgyVjE0eiBNMTgsMTBoLTJWOGgyVjEweiBNMTgsNmgtMlY0aDJWNnonLz48L3N2Zz48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9J2ZyYW1lc3RlcC1idXR0b24nIGNsYXNzPSd5dC11aXgtdG9vbHRpcCcgZGF0YS1wPSd0dHB8Q05TTF9GUk1FJyBkYXRhLWFjdGlvbj0ndG9nZ2xlRnJhbWVzJz48c3ZnIHZpZXdCb3g9JzAgMCAyMCAyMCc+PHBhdGggZD0nTTIwLDloLTIuMWMtMC41LTMuNi0zLjMtNi41LTYuOS02LjlWMEg5djIuMUM1LjQsMi41LDIuNSw1LjQsMi4xLDlIMHYyaDIuMWMwLjUsMy42LDMuMyw2LjUsNi45LDYuOVYyMGgyIHYtMi4xYzMuNi0wLjUsNi41LTMuMyw2LjktNi45SDIwVjl6IE0xMSwxNS45VjE0SDl2MS45Yy0yLjUtMC40LTQuNS0yLjQtNC45LTQuOUg2VjlINC4xQzQuNSw2LjUsNi41LDQuNSw5LDQuMVY2aDJWNC4xIGMyLjUsMC40LDQuNSwyLjQsNC45LDQuOUgxNHYyaDEuOUMxNS41LDEzLjUsMTMuNSwxNS41LDExLDE1Ljl6Jy8+PGNpcmNsZSBjeD0nMTAnIGN5PScxMCcgcj0nMScvPjwvc3ZnPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0nc2hvcnRjdXRzLWJ1dHRvbicgY2xhc3M9J3l0LXVpeC10b29sdGlwJyBkYXRhLXA9J3R0cHxDTlNMX1lUU0MnIGRhdGEtYWN0aW9uPSd0b2dnbGVTaG9ydGN1dHMnPjxzdmcgdmlld0JveD0nMCAwIDE4IDE4Jz48cG9seWdvbiBwb2ludHM9JzcsOCAxMCw4IDEwLDEzIDExLDEzIDExLDE0IDcsMTQgNywxMyA4LDEzIDgsOSA3LDknLz48cmVjdCB4PSc4JyB5PSc0JyB3aWR0aD0nMicgaGVpZ2h0PScyJy8+PHBhdGggZD0nTTksMEM0LDAsMCw0LDAsOWMwLDUsNCw5LDksOXM5LTQsOS05QzE4LDQsMTQsMCw5LDB6IE05LDE2LjFjLTMuOSwwLTcuMS0zLjItNy4xLTcuMVM1LjEsMS45LDksMS45IHM3LjEsMy4yLDcuMSw3LjFTMTIuOSwxNi4xLDksMTYuMXonLz48L3N2Zz48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5WSURfUExSX0FUUEwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWR2YW5jZWRPcHRpb25zLmNvbnRyb2xzLmNvbnRlbnQucXVlcnlTZWxlY3RvcigiI2F1dG9wbGF5LWJ1dHRvbiIpLmNsYXNzTGlzdC5hZGQoImFjdGl2ZSIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBhZHZhbmNlZE9wdGlvbnMuY29udHJvbHMgPSBzZXRMb2NhbGUoYWR2YW5jZWRPcHRpb25zLmNvbnRyb2xzLmNvbnRlbnQpLmZpcnN0Q2hpbGQ7CiAgICAgICAgICAgICAgICAgICAgY25zbENvbnQuYXBwZW5kQ2hpbGQoYWR2YW5jZWRPcHRpb25zLmNvbnRyb2xzKTsKICAgICAgICAgICAgICAgICAgICBob29rQnV0dG9ucygpOwogICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLmFkdk9wdHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsYXNzTGlzdC5hZGQoInBsYXllci1jb25zb2xlIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGNuc2xCdG4uY2xhc3NMaXN0LmFkZCgiY2xvc2UiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gaW5pQWN0aW9uKGV2ZW50KSB7CiAgICAgICAgICAgICAgICB2YXIgb2JzZXJ2ZXIsIGxvYWRfbW9yZSwgY2xpY2tfdGl0bGU7CiAgICAgICAgICAgICAgICBsb2FkX21vcmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjd2F0Y2gtbW9yZS1yZWxhdGVkLCAubG9hZC1tb3JlLWJ1dHRvbiIpOwogICAgICAgICAgICAgICAgY2xpY2tfdGl0bGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIueXQtdWl4LXRpbGUiKTsKICAgICAgICAgICAgICAgIHdoaWxlIChjbGlja190aXRsZSkgewogICAgICAgICAgICAgICAgICAgIGNsaWNrX3RpdGxlLmNsYXNzTGlzdC5yZW1vdmUoInl0LXVpeC10aWxlIik7CiAgICAgICAgICAgICAgICAgICAgY2xpY2tfdGl0bGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIueXQtdWl4LXRpbGUiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChsb2FkX21vcmUgJiYgIWxvYWRfbW9yZS5jbGFzc0xpc3QuY29udGFpbnMoIm1vZFRodW1icyIpKSB7CiAgICAgICAgICAgICAgICAgICAgbG9hZF9tb3JlLmNsYXNzTGlzdC5hZGQoIm1vZFRodW1icyIpOwogICAgICAgICAgICAgICAgICAgIG9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIobW9kVGh1bWJzKTsKICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5vYnNlcnZlKGxvYWRfbW9yZSwgewogICAgICAgICAgICAgICAgICAgICAgICBjaGlsZExpc3Q6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZU9sZFZhbHVlOiB0cnVlCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQgJiYgL3BvcG91dG1vZGV8YmxhY2tsaXN0Ly50ZXN0KGV2ZW50LnRhcmdldC5jbGFzc05hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICBldmVudCA9IGV2ZW50LnRhcmdldDsKICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCJwb3BvdXRtb2RlIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcG9wUGxheWVyKGV2ZW50LmRhdGFzZXQubGluayk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChldmVudC5kYXRhc2V0Lnl0aWQgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghY2hlY2tCbGFja2xpc3RFbnRyeShldmVudC5kYXRhc2V0Lnl0aWQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRUb0JsYWNrbGlzdChldmVudC5kYXRhc2V0Lnl0aWQsIGV2ZW50LmRhdGFzZXQudXNlcik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXQoImJsYWNrbGlzdCIsIHVzZXJfc2V0dGluZ3MuYmxhY2tsaXN0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZFRodW1icygpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHNldEJ1dHRvbnMoKSB7CiAgICAgICAgICAgICAgICB2YXIgaSwgaiwgbGlzdCwgdGVtcCwgdGh1bWIsIGJ1dHRvbjsKICAgICAgICAgICAgICAgIGxpc3QgPSBPYmplY3Qua2V5cyhtb2RUaHVtYnMudGh1bWJzKTsKICAgICAgICAgICAgICAgIGkgPSBsaXN0Lmxlbmd0aDsKICAgICAgICAgICAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICAgICAgICAgICAgICB0ZW1wID0gbW9kVGh1bWJzLnRodW1ic1tsaXN0W2ldXTsKICAgICAgICAgICAgICAgICAgICBqID0gdGVtcC5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGotLSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aHVtYiA9IHRlbXBbal0ucXVlcnlTZWxlY3RvcigiLnl0LWxvY2t1cCAueXQtbG9ja3VwLXRodW1ibmFpbCwgLnRodW1iLXdyYXBwZXIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRodW1iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5HRU5fUFBPVF9PTiAmJiAhdGh1bWIucXVlcnlTZWxlY3RvcigiLnBvcG91dG1vZGUiKSAmJiAhL2NoYW5uZWwvLnRlc3QodGVtcFtqXS5maXJzdENoaWxkLmNsYXNzTmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZW1wbGF0ZSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5pbm5lckhUTUwgPSAvLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgPGRpdiBkYXRhLXA9J3R0bHxQUE9UX09QRU4mdHRwfFBQT1RfT1BFTicgY2xhc3M9J3l0LXVpeC10b29sdGlwIHBvcG91dG1vZGUnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN2ZyB2aWV3Qm94PScwIDAgMTAgMTAnIGNsYXNzPSd0aHVtYi1zdmcnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwb2x5Z29uIHBvaW50cz0nNyw5IDEsOSAxLDQgMyw0IDMsMiAwLDIgMCwxMCA4LDEwIDgsNyA3LDcnLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSdNNCwwdjZoNlYwSDR6IE05LDVINVYyaDRWNXonLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3ZnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5jb250ZW50LmZpcnN0Q2hpbGQuZGF0YXNldC5saW5rID0gdGVtcFtqXS5xdWVyeVNlbGVjdG9yKCJhW2hyZWYqPScvd2F0Y2g/diddIikuaHJlZjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHVtYi5hcHBlbmRDaGlsZChzZXRMb2NhbGUoYnV0dG9uLmNvbnRlbnQpLmZpcnN0Q2hpbGQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuQkxLX09OICYmICF0aHVtYi5xdWVyeVNlbGVjdG9yKCIuYmxhY2tsaXN0IikgJiYgd2luZG93Lnl0LmNvbmZpZ18uUEFHRV9OQU1FICE9PSAiY2hhbm5lbCIgJiYgd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lICE9PSAiL2ZlZWQvc3Vic2NyaXB0aW9ucyIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZW1wbGF0ZSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5pbm5lckhUTUwgPSAvLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgPGRpdiBkYXRhLXA9J3R0bHxCTENLX0FERCZ0dHB8QkxDS19BREQnIGNsYXNzPSd5dC11aXgtdG9vbHRpcCBibGFja2xpc3QnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN2ZyB2aWV3Qm94PScwIDAgMTAgMTAnIGNsYXNzPSd0aHVtYi1zdmcnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwb2x5Z29uIHBvaW50cz0nMTAsMS40IDguNiwwIDUsMy42IDEuNCwwIDAsMS40IDMuNiw1IDAsOC42IDEuNCwxMCA1LDYuNCA4LjYsMTAgMTAsOC42IDYuNCw1Jy8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3N2Zz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBidXR0b24uY29udGVudC5maXJzdENoaWxkLmRhdGFzZXQudXNlciA9IHRlbXBbal0udXNlcm5hbWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uLmNvbnRlbnQuZmlyc3RDaGlsZC5kYXRhc2V0Lnl0aWQgPSBsaXN0W2ldOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRodW1iLmFwcGVuZENoaWxkKHNldExvY2FsZShidXR0b24uY29udGVudCkuZmlyc3RDaGlsZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gZGVsVmlkZW9zKCkgewogICAgICAgICAgICAgICAgdmFyIGksIGosIHRlbXAsIHBhcmVudCwgYmxhY2tsaXN0LCBoYXNfdXBuZXh0OwogICAgICAgICAgICAgICAgaGFzX3VwbmV4dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5hdXRvcGxheS1iYXIiKTsKICAgICAgICAgICAgICAgIGJsYWNrbGlzdCA9IHVzZXJfc2V0dGluZ3MuYmxhY2tsaXN0OwogICAgICAgICAgICAgICAgaSA9IGJsYWNrbGlzdC5sZW5ndGg7CiAgICAgICAgICAgICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgICAgICAgICAgICAgdGVtcCA9IG1vZFRodW1icy50aHVtYnNbImNoYW5uZWwvIiArIGJsYWNrbGlzdFtpXS51Y2lkXSB8fCBtb2RUaHVtYnMudGh1bWJzWyJ1c2VyLyIgKyBibGFja2xpc3RbaV0uY2Fub25pY2FsXTsKICAgICAgICAgICAgICAgICAgICBpZiAodGVtcCkgewogICAgICAgICAgICAgICAgICAgICAgICBqID0gdGVtcC5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChqLS0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoYXNfdXBuZXh0ICYmIGhhc191cG5leHQuY29udGFpbnModGVtcFtqXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNfdXBuZXh0LnBhcmVudE5vZGUucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFzX3VwbmV4dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi53YXRjaC1zaWRlYmFyLXNlcGFyYXRpb24tbGluZSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoYXNfdXBuZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc191cG5leHQucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc191cG5leHQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50ID0gdGVtcFtqXS5wYXJlbnROb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBbal0ucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wLnNwbGljZShqLCAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChwYXJlbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyZW50LmNoaWxkRWxlbWVudENvdW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQgPSBwYXJlbnQucGFyZW50Tm9kZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQuZmlyc3RDaGlsZC5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRlbXAubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgbW9kVGh1bWJzLnRodW1ic1siY2hhbm5lbC8iICsgYmxhY2tsaXN0W2ldLnVjaWRdIHx8IG1vZFRodW1icy50aHVtYnNbInVzZXIvIiArIGJsYWNrbGlzdFtpXS5jYW5vbmljYWxdOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXAgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0ZW1wID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiLmZlZWQtaXRlbS1jb250YWluZXI6bm90KC5zZWFyY2gtaGlzdG9yeS1pdGVtKSIpOwogICAgICAgICAgICAgICAgaSA9IHRlbXAubGVuZ3RoOwogICAgICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgICAgIGlmICh0ZW1wW2ldLnF1ZXJ5U2VsZWN0b3JBbGwoInVsIikubGVuZ3RoIDwgMikgewogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQgPSB0ZW1wW2ldLnBhcmVudE5vZGU7CiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBbaV0ucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChwYXJlbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnQuY2hpbGRFbGVtZW50Q291bnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudCA9IHBhcmVudC5wYXJlbnROb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50LmZpcnN0Q2hpbGQucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gZ2V0VmlkZW9zKCkgewogICAgICAgICAgICAgICAgdmFyIGksIGxpc3QsIHRlbXAsIHZpZGVvX2xpc3QsIGNoYW5uZWxfaWQ7CiAgICAgICAgICAgICAgICBtb2RUaHVtYnMudGh1bWJzID0ge307CiAgICAgICAgICAgICAgICB2aWRlb19saXN0ID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGAKICAgICAgICAgICAgICAgICAgICAueXQtc2hlbGYtZ3JpZC1pdGVtLAogICAgICAgICAgICAgICAgICAgIC52aWRlby1saXN0LWl0ZW0sCiAgICAgICAgICAgICAgICAgICAgI3Jlc3VsdHMgLml0ZW0tc2VjdGlvbiA+IGxpLAogICAgICAgICAgICAgICAgICAgIC5leHBhbmRlZC1zaGVsZi1jb250ZW50LWl0ZW0td3JhcHBlcgogICAgICAgICAgICAgICAgYCkpOwogICAgICAgICAgICAgICAgbGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoYAogICAgICAgICAgICAgICAgICAgIC55dC1sb2NrdXAtYnlsaW5lID4gYSwKICAgICAgICAgICAgICAgICAgICAueXQtbG9ja3VwLWNvbnRlbnQgLmctaG92ZXJjYXJkLAogICAgICAgICAgICAgICAgICAgIC52aWRlby1saXN0LWl0ZW0gLmctaG92ZXJjYXJkLAogICAgICAgICAgICAgICAgICAgIC5jaGFubmVscy1jb250ZW50LWl0ZW0gLnl0LWxvY2t1cC10aXRsZSA+IGEKICAgICAgICAgICAgICAgIGApOwogICAgICAgICAgICAgICAgaSA9IGxpc3QubGVuZ3RoOwogICAgICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgICAgIHRlbXAgPSBsaXN0W2ldOwogICAgICAgICAgICAgICAgICAgIGlmICh0ZW1wLmhyZWYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2hhbm5lbF9pZCA9IHRlbXAuaHJlZi5tYXRjaCgvXC8odXNlclwvW15cL10rfGNoYW5uZWxcL1teXC9dKykoPzpcL3wkKS8pOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2hhbm5lbF9pZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhbm5lbF9pZCA9IGNoYW5uZWxfaWRbMV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAodGVtcCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ZW1wLnRhZ05hbWUgJiYgdGVtcC50YWdOYW1lID09PSAiTEkiICYmIHZpZGVvX2xpc3QuaW5kZXhPZih0ZW1wKSA+IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXAudXNlcm5hbWUgPSBsaXN0W2ldLnRleHRDb250ZW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW1vZFRodW1icy50aHVtYnNbY2hhbm5lbF9pZF0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZFRodW1icy50aHVtYnNbY2hhbm5lbF9pZF0gPSBbdGVtcF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobW9kVGh1bWJzLnRodW1ic1tjaGFubmVsX2lkXS5pbmRleE9mKHRlbXApIDwgMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kVGh1bWJzLnRodW1ic1tjaGFubmVsX2lkXS5wdXNoKHRlbXApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wID0gdGVtcC5wYXJlbnROb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIG1vZFRodW1icygpIHsKICAgICAgICAgICAgICAgIGlmICgodXNlcl9zZXR0aW5ncy5CTEtfT04gfHwgdXNlcl9zZXR0aW5ncy5HRU5fUFBPVF9PTikgJiYgIXdpbmRvdy5vcGVuZXIgJiYgd2luZG93Lnl0ICYmIHdpbmRvdy55dC5jb25maWdfICYmIC93YXRjaHxpbmRleHxmZWVkfGNoYW5uZWx8cmVzdWx0cy8udGVzdCh3aW5kb3cueXQuY29uZmlnXy5QQUdFX05BTUUpKSB7CiAgICAgICAgICAgICAgICAgICAgZ2V0VmlkZW9zKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuQkxLX09OICYmIHdpbmRvdy55dC5jb25maWdfLlBBR0VfTkFNRSAhPT0gImNoYW5uZWwiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlbFZpZGVvcygpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBzZXRCdXR0b25zKCk7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBpbmlBY3Rpb24pOwogICAgICAgICAgICAgICAgICAgIGluaUFjdGlvbigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHNldFZpZGVvQ291bnQoKSB7CiAgICAgICAgICAgICAgICB2YXIgc3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKTsKICAgICAgICAgICAgICAgIHNwYW4udGV4dENvbnRlbnQgPSAiIMK3ICI7CiAgICAgICAgICAgICAgICBlbmhhbmNlZERldGFpbHMudXNlcm5hbWUuYXBwZW5kQ2hpbGQoc3Bhbik7CiAgICAgICAgICAgICAgICBlbmhhbmNlZERldGFpbHMubGluay5ocmVmID0gd2luZG93LmxvY2F0aW9uLm9yaWdpbiArICIvY2hhbm5lbC8iICsgZW5oYW5jZWREZXRhaWxzLnVzZXIgKyAiL3ZpZGVvcyI7CiAgICAgICAgICAgICAgICBlbmhhbmNlZERldGFpbHMudXNlcm5hbWUuYXBwZW5kQ2hpbGQoZW5oYW5jZWREZXRhaWxzLmxpbmspOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVZpZGVvQ291bnQoZGV0YWlscykgewogICAgICAgICAgICAgICAgZGV0YWlscyA9IGRldGFpbHMudGFyZ2V0LnJlc3BvbnNlLnF1ZXJ5U2VsZWN0b3IoIi5wbC1oZWFkZXItZGV0YWlscyBsaTpudGgtY2hpbGQoMikiKTsKICAgICAgICAgICAgICAgIGlmIChkZXRhaWxzKSB7CiAgICAgICAgICAgICAgICAgICAgZW5oYW5jZWREZXRhaWxzLmxpbmsuY2xhc3NOYW1lID0gInNwZi1saW5rIjsKICAgICAgICAgICAgICAgICAgICBlbmhhbmNlZERldGFpbHMubGluay50ZXh0Q29udGVudCA9IGNpZFtlbmhhbmNlZERldGFpbHMudXNlcl0gPSBkZXRhaWxzLnRleHRDb250ZW50OwogICAgICAgICAgICAgICAgICAgIHNldFZpZGVvQ291bnQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBnZXRWaWRlb0NvdW50KCkgewogICAgICAgICAgICAgICAgZW5oYW5jZWREZXRhaWxzLnVzZXJuYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnl0LXVzZXItaW5mbyIpOwogICAgICAgICAgICAgICAgaWYgKCFkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXBsb2FkZWQtdmlkZW9zIikgJiYgZW5oYW5jZWREZXRhaWxzLnVzZXJuYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgZW5oYW5jZWREZXRhaWxzLmxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICAgICAgICAgICAgICAgICAgZW5oYW5jZWREZXRhaWxzLmxpbmsuaWQgPSAidXBsb2FkZWQtdmlkZW9zIjsKICAgICAgICAgICAgICAgICAgICBlbmhhbmNlZERldGFpbHMudXNlcm5hbWUuYXBwZW5kQ2hpbGQoZW5oYW5jZWREZXRhaWxzLmxpbmspOwogICAgICAgICAgICAgICAgICAgIGVuaGFuY2VkRGV0YWlscy51c2VyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2l0ZW1wcm9wPSdjaGFubmVsSWQnXSIpOwogICAgICAgICAgICAgICAgICAgIGVuaGFuY2VkRGV0YWlscy51c2VyID0gZW5oYW5jZWREZXRhaWxzLnVzZXIuZ2V0QXR0cmlidXRlKCJjb250ZW50Iik7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNpZFtlbmhhbmNlZERldGFpbHMudXNlcl0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgZW5oYW5jZWREZXRhaWxzLmxpbmsudGV4dENvbnRlbnQgPSBjaWRbZW5oYW5jZWREZXRhaWxzLnVzZXJdOwogICAgICAgICAgICAgICAgICAgICAgICBzZXRWaWRlb0NvdW50KCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxYSFIoIkdFVCIsIHVwZGF0ZVZpZGVvQ291bnQsICIvcGxheWxpc3Q/bGlzdD0iICsgZW5oYW5jZWREZXRhaWxzLnVzZXIucmVwbGFjZSgiVUMiLCAiVVUiKSwgImRvYyIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBnZXRDaGFubmVsSW5mbyhkZXRhaWxzKSB7CiAgICAgICAgICAgICAgICB2YXIgcmV0cnksIGlzTGl2ZTsKICAgICAgICAgICAgICAgIGlzTGl2ZSA9IGRldGFpbHMudGFyZ2V0LnJlc3BvbnNlLnF1ZXJ5U2VsZWN0b3IoIi55dC1iYWRnZS1saXZlIik7CiAgICAgICAgICAgICAgICBpZiAoIWlzTGl2ZSkgewogICAgICAgICAgICAgICAgICAgIHJldHJ5ID0gZGV0YWlscy50YXJnZXQucmVzcG9uc2VVUkwuc3BsaXQoIi92aWRlb3MiKS5sZW5ndGggPCAyOwogICAgICAgICAgICAgICAgICAgIGRldGFpbHMgPSBkZXRhaWxzLnRhcmdldC5yZXNwb25zZS5xdWVyeVNlbGVjdG9yQWxsKCJbZGF0YS1jb250ZXh0LWl0ZW0taWQ9JyIgKyB3aW5kb3cueXRwbGF5ZXIuY29uZmlnLmFyZ3MudmlkZW9faWQgKyAiJ10gLnl0LWxvY2t1cC1tZXRhLWluZm8gbGkiKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZGV0YWlscyAmJiBkZXRhaWxzLmxlbmd0aCA+IDAgJiYgZW5oYW5jZWREZXRhaWxzLndhdGNoVGltZS50ZXh0Q29udGVudC5zcGxpdCgiwrciKS5sZW5ndGggPCAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuaGFuY2VkRGV0YWlscy53YXRjaFRpbWUudGV4dENvbnRlbnQgKz0gIiDCtyAiICsgZGV0YWlsc1tyZXRyeSA/IDAgOiAxXS50ZXh0Q29udGVudDsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJldHJ5ICYmIHdpbmRvdy55dHBsYXllciAmJiB3aW5kb3cueXRwbGF5ZXIuY29uZmlnICYmIHdpbmRvdy55dHBsYXllci5jb25maWcuYXJncyAmJiB3aW5kb3cueXRwbGF5ZXIuY29uZmlnLmFyZ3MudWNpZCkgewogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFhIUigiR0VUIiwgZ2V0Q2hhbm5lbEluZm8sICIvY2hhbm5lbC8iICsgd2luZG93Lnl0cGxheWVyLmNvbmZpZy5hcmdzLnVjaWQgKyAiL3ZpZGVvcyIsICJkb2MiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gZ2V0UHVibGlzaGVkVGltZSgpIHsKICAgICAgICAgICAgICAgIGVuaGFuY2VkRGV0YWlscy53YXRjaFRpbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIud2F0Y2gtdGltZS10ZXh0Iik7CiAgICAgICAgICAgICAgICBpZiAoZW5oYW5jZWREZXRhaWxzLndhdGNoVGltZSAmJiAhZW5oYW5jZWREZXRhaWxzLndhdGNoVGltZS5mZXRjaGluZyAmJiB3aW5kb3cueXRwbGF5ZXIgJiYgd2luZG93Lnl0cGxheWVyLmNvbmZpZykgewogICAgICAgICAgICAgICAgICAgIGVuaGFuY2VkRGV0YWlscy53YXRjaFRpbWUuZmV0Y2hpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGxvY2FsWEhSKCJHRVQiLCBnZXRDaGFubmVsSW5mbywgIi9jaGFubmVsLyIgKyB3aW5kb3cueXRwbGF5ZXIuY29uZmlnLmFyZ3MudWNpZCArICIvc2VhcmNoP3F1ZXJ5PSUyMiIgKyB3aW5kb3cueXRwbGF5ZXIuY29uZmlnLmFyZ3MudmlkZW9faWQgKyAiJTIyIiwgImRvYyIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGVuaGFuY2VkRGV0YWlscygpIHsKICAgICAgICAgICAgICAgIGlmICh3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgPT09ICIvd2F0Y2giKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuVklEX1ZJRF9DTlQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0VmlkZW9Db3VudCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5WSURfUE9TVF9USU1FKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGdldFB1Ymxpc2hlZFRpbWUoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gcmV2ZXJzZUNvbnRyb2woKSB7CiAgICAgICAgICAgICAgICB2YXIgaSwgdGVtcCwgcHJldiwgbmV4dCwgbGlzdCwgdmlkZW9zOwogICAgICAgICAgICAgICAgcHJldiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5wcmV2LXBsYXlsaXN0LWxpc3QtaXRlbSIpOwogICAgICAgICAgICAgICAgbmV4dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5uZXh0LXBsYXlsaXN0LWxpc3QtaXRlbSIpOwogICAgICAgICAgICAgICAgbGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwbGF5bGlzdC1hdXRvc2Nyb2xsLWxpc3QiKTsKICAgICAgICAgICAgICAgIHZpZGVvcyA9IGxpc3QuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImxpIik7CiAgICAgICAgICAgICAgICBpID0gdmlkZW9zLmxlbmd0aDsKICAgICAgICAgICAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICAgICAgICAgICAgICBsaXN0LmFwcGVuZENoaWxkKHZpZGVvc1tpXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0ZW1wID0gcHJldi5ocmVmOwogICAgICAgICAgICAgICAgcHJldi5ocmVmID0gbmV4dC5ocmVmOwogICAgICAgICAgICAgICAgbmV4dC5ocmVmID0gdGVtcDsKICAgICAgICAgICAgICAgIGxpc3Quc2Nyb2xsVG9wID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLmN1cnJlbnRseS1wbGF5aW5nIikub2Zmc2V0VG9wOwogICAgICAgICAgICAgICAgaWYgKGFwaSkgewogICAgICAgICAgICAgICAgICAgIGFwaS51cGRhdGVQbGF5bGlzdCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHJldmVyc2VCdXR0b24oZXZlbnQpIHsKICAgICAgICAgICAgICAgIGlmIChldmVudC50YXJnZXQuaWQgPT09ICJyZXZlcnNlIikgewogICAgICAgICAgICAgICAgICAgIGV2ZW50LnRhcmdldC5jbGFzc0xpc3QudG9nZ2xlKCJ5dC11aXgtYnV0dG9uLXRvZ2dsZWQiKTsKICAgICAgICAgICAgICAgICAgICBzZXQoInBsUmV2IiwgZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygieXQtdWl4LWJ1dHRvbi10b2dnbGVkIikpOwogICAgICAgICAgICAgICAgICAgIHJldmVyc2VDb250cm9sKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gYXV0b3BsYXlCdXR0b24oZXZlbnQpIHsKICAgICAgICAgICAgICAgIGlmIChldmVudC50YXJnZXQuaWQgPT09ICJhdXRvcGxheSIpIHsKICAgICAgICAgICAgICAgICAgICBldmVudC50YXJnZXQuY2xhc3NMaXN0LnRvZ2dsZSgieXQtdWl4LWJ1dHRvbi10b2dnbGVkIik7CiAgICAgICAgICAgICAgICAgICAgc2V0KCJwbEFwbCIsIGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoInl0LXVpeC1idXR0b24tdG9nZ2xlZCIpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVCdXR0b24odHlwZSwgbGFiZWwsIGJvb2wsIGNhbGwpIHsKICAgICAgICAgICAgICAgIHZhciBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZW1wbGF0ZSIpOwogICAgICAgICAgICAgICAgYnV0dG9uLmlubmVySFRNTCA9IC8vCiAgICAgICAgICAgICAgICAgICAgYDxidXR0b24gY2xhc3M9J3l0LXVpeC1idXR0b24geXQtdWl4LWJ1dHRvbi1wbGF5ZXItY29udHJvbHMgeXQtdWl4LWJ1dHRvbi1vcGFjaXR5IHl0LXVpeC10b29sdGlwJyB0eXBlPSdidXR0b24nPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN2ZyBjbGFzcz0ncGwtYXV0b3BsYXknIHZpZXdCb3g9JzAgMCAxNCAxNic+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHBvbHlnb24gcG9pbnRzPScwLDE2IDE0LDggMCwwJy8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3N2Zz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzdmcgY2xhc3M9J3BsLXJldmVyc2UnIHZpZXdCb3g9JzAgMCAxNiAyMCc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHBvbHlnb24gcG9pbnRzPSc3LDggMyw4IDMsMTQgMCwxNCA1LDIwIDEwLDE0IDcsMTQnLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cG9seWdvbiBwb2ludHM9JzExLDAgNiw2IDksNiA5LDEyIDEzLDEyIDEzLDYgMTYsNicvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zdmc+CiAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+YDsKICAgICAgICAgICAgICAgIGlmIChib29sID09PSB0cnVlIHx8IHdpbmRvdy5sb2NhdGlvbi5ocmVmLnNwbGl0KGJvb2wpLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgICAgICAgICBidXR0b24uY29udGVudC5xdWVyeVNlbGVjdG9yKCJidXR0b24iKS5jbGFzc0xpc3QuYWRkKCJ5dC11aXgtYnV0dG9uLXRvZ2dsZWQiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJ1dHRvbi5jb250ZW50LmZpcnN0Q2hpbGQuaWQgPSB0eXBlOwogICAgICAgICAgICAgICAgYnV0dG9uLmNvbnRlbnQuZmlyc3RDaGlsZC5kYXRhc2V0LnAgPSAidHRwfCIgKyBsYWJlbCArICImdHRsfCIgKyBsYWJlbDsKICAgICAgICAgICAgICAgIGJ1dHRvbi5jb250ZW50LmZpcnN0Q2hpbGQuY2xhc3NMaXN0LmFkZCgieXQtdWl4LWJ1dHRvbi1pY29uLXdhdGNoLWFwcGJhci0iICsgdHlwZSArICItdmlkZW8tbGlzdCIpOwogICAgICAgICAgICAgICAgYnV0dG9uID0gc2V0TG9jYWxlKGJ1dHRvbi5jb250ZW50KS5maXJzdENoaWxkOwogICAgICAgICAgICAgICAgcGxheWxpc3RDb250cm9scy5wbEJhci5jbGFzc05hbWUgPSBwbGF5bGlzdENvbnRyb2xzLnBsQmFyLmNsYXNzTmFtZS5yZXBsYWNlKCJyYWRpby1wbGF5bGlzdCIsICIiKTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgY2FsbCk7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIucGxheWxpc3QtbmF2LWNvbnRyb2xzIikuYXBwZW5kQ2hpbGQoYnV0dG9uKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBwbGF5bGlzdENvbnRyb2xzKCkgewogICAgICAgICAgICAgICAgcGxheWxpc3RDb250cm9scy5wbEJhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ3YXRjaC1hcHBiYXItcGxheWxpc3QiKTsKICAgICAgICAgICAgICAgIGlmIChwbGF5bGlzdENvbnRyb2xzLnBsQmFyKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICJjb21wbGV0ZSIgJiYgdXNlcl9zZXR0aW5ncy5wbFJldikgewogICAgICAgICAgICAgICAgICAgICAgICByZXZlcnNlQ29udHJvbCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5WSURfUExTVF9SVlJTICYmICFkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicmV2ZXJzZSIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZUJ1dHRvbigicmV2ZXJzZSIsICJQTFNUX1JWUlMiLCB1c2VyX3NldHRpbmdzLnBsUmV2LCByZXZlcnNlQnV0dG9uKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuVklEX1BMU1RfQVRQTCAmJiAhZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImF1dG9wbGF5IikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlQnV0dG9uKCJhdXRvcGxheSIsICJQTFNUX0FQIiwgdXNlcl9zZXR0aW5ncy5wbEFwbCwgYXV0b3BsYXlCdXR0b24pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiB4aHJQYXRjaCgpIHsKICAgICAgICAgICAgICAgIHZhciB0ZW1wLCBwbGF5ZXI7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5yZWFkeVN0YXRlID09PSA0KSB7CiAgICAgICAgICAgICAgICAgICAgdGVtcCA9IHthcmdzOiBKU09OLnBhcnNlKAogICAgICAgICAgICAgICAgICAgICAgICAie1wiIiArCiAgICAgICAgICAgICAgICAgICAgICAgIGRlY29kZVVSSUNvbXBvbmVudCh0aGlzLnJlc3BvbnNlVGV4dAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoLyU1Qy9nLCAiJTVDJTVDIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC8lMjIvZywgIiU1QyUyMiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvJi9nLCAiXCIsXCIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL1w9L2csICJcIjpcIiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvXCsvZywgIiUyMCIpCiAgICAgICAgICAgICAgICAgICAgICAgICkgKwogICAgICAgICAgICAgICAgICAgICAgICAiXCJ9IgogICAgICAgICAgICAgICAgICAgICl9OwogICAgICAgICAgICAgICAgICAgIHRlbXAgPSBtb2RBcmdzKHRlbXApOwogICAgICAgICAgICAgICAgICAgIHRlbXAgPSBlbmNvZGVVUklDb21wb25lbnQoSlNPTi5zdHJpbmdpZnkodGVtcC5hcmdzKS5zcGxpdCgvXHsiKFtcd1xXXSo/KSJ9LylbMV0pCiAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC8lNUMlNUMvZywgIiU1QyIpCiAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC8lNUMlMjIvZywgIiUyMiIpCiAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC8lMjIlMkMlMjIvZywgIiYiKQogICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvJTIyJTNBJTIyL2csICI9IikKICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoLyUyMC9nLCAiKyIpOwogICAgICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAicmVzcG9uc2VUZXh0Iiwge3dyaXRhYmxlOiB0cnVlfSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNwb25zZVRleHQgPSB0ZW1wOwogICAgICAgICAgICAgICAgICAgIHBsYXllciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtb3ZpZV9wbGF5ZXIiKTsKICAgICAgICAgICAgICAgICAgICBpZiAocGxheWVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllci5zZXRQbGF5YmFja1F1YWxpdHkodXNlcl9zZXR0aW5ncy5WSURfREZMVF9RTFRZKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gY2hlY2tYSFIob3JpZ2luYWwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihtZXRob2QsIHVybCkgewogICAgICAgICAgICAgICAgICAgIGlmICh1cmwubWF0Y2goImdldF92aWRlb19pbmZvIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRFdmVudExpc3RlbmVyKCJyZWFkeXN0YXRlY2hhbmdlIiwgeGhyUGF0Y2gpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3JpZ2luYWwuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gaGlkZVZvbHVtZSgpIHsKICAgICAgICAgICAgICAgIGlmICh2b2x1bWVXaGVlbC5jQm90dG9tICYmIHZvbHVtZVdoZWVsLmNCb3R0b20uY2xhc3NMaXN0LmNvbnRhaW5zKCJ5dHAtdm9sdW1lLXNsaWRlci1hY3RpdmUiKSkgewogICAgICAgICAgICAgICAgICAgIHZvbHVtZVdoZWVsLmNCb3R0b20uY2xhc3NMaXN0LnJlbW92ZSgieXRwLXZvbHVtZS1zbGlkZXItYWN0aXZlIik7CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHZvbHVtZVdoZWVsLmNCb3R0b20udGltZXI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gdm9sdW1lV2hlZWwoZXZlbnQpIHsKICAgICAgICAgICAgICAgIHZhciBmc1BsLCBwU2V0cywgaXZDYXJkLCBwbGF5ZXIsIGNhblNjcm9sbCwgZGlyZWN0aW9uOwogICAgICAgICAgICAgICAgcGxheWVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigidmlkZW8iKTsKICAgICAgICAgICAgICAgIGZzUGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIueXRwLXBsYXlsaXN0LW1lbnUiKTsKICAgICAgICAgICAgICAgIHBTZXRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnl0cC1zZXR0aW5ncy1tZW51Iik7CiAgICAgICAgICAgICAgICBpdkNhcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIuaXYtZHJhd2VyIik7CiAgICAgICAgICAgICAgICBjYW5TY3JvbGwgPSBldmVudCAmJiAoIWZzUGwgfHwgKGZzUGwgJiYgIWZzUGwuY29udGFpbnMoZXZlbnQudGFyZ2V0KSkpICYmICghaXZDYXJkIHx8IChpdkNhcmQgJiYgIWl2Q2FyZC5jb250YWlucyhldmVudC50YXJnZXQpKSkgJiYgKCFwU2V0cyB8fCAocFNldHMgJiYgIXBTZXRzLmNvbnRhaW5zKGV2ZW50LnRhcmdldCkpKTsKICAgICAgICAgICAgICAgIGlmIChldmVudCAmJiBhcGkgJiYgcGxheWVyICYmIGNhblNjcm9sbCAmJiAoZXZlbnQudGFyZ2V0LmlkID09PSBhcGkgfHwgYXBpLmNvbnRhaW5zKGV2ZW50LnRhcmdldCkpKSB7CiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICB2b2x1bWVXaGVlbC5jQm90dG9tID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnl0cC1jaHJvbWUtYm90dG9tIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKHZvbHVtZVdoZWVsLmNCb3R0b20pIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF2b2x1bWVXaGVlbC5jQm90dG9tLmNsYXNzTGlzdC5jb250YWlucygieXRwLXZvbHVtZS1zbGlkZXItYWN0aXZlIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvbHVtZVdoZWVsLmNCb3R0b20uY2xhc3NMaXN0LmFkZCgieXRwLXZvbHVtZS1zbGlkZXItYWN0aXZlIik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZvbHVtZVdoZWVsLmNCb3R0b20udGltZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jbGVhclRpbWVvdXQodm9sdW1lV2hlZWwuY0JvdHRvbS50aW1lcik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFwaSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBpLmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCJtb3VzZW1vdmUiKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgdm9sdW1lV2hlZWwuY0JvdHRvbS50aW1lciA9IHdpbmRvdy5zZXRUaW1lb3V0KGhpZGVWb2x1bWUsIDQwMDApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb24gPSBldmVudCAmJiAoZXZlbnQuZGVsdGFZIHx8IGV2ZW50LndoZWVsRGVsdGFZKTsKICAgICAgICAgICAgICAgICAgICBhcGkuc2V0Vm9sdW1lKHBsYXllci52b2x1bWUgKiAxMDAgLSAoTWF0aC5zaWduKGRpcmVjdGlvbikgKiA1KSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFldmVudCAmJiB1c2VyX3NldHRpbmdzLlZJRF9WT0xfV0hFRUwpIHsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJ3aGVlbCIsIHZvbHVtZVdoZWVsKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAod2luZG93LmxvY2F0aW9uLnBhdGhuYW1lICE9PSAiL3dhdGNoIikgewogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoIndoZWVsIiwgdm9sdW1lV2hlZWwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGRyYWdQb3BPdXQoZXZlbnQpIHsKICAgICAgICAgICAgICAgIHZhciBleGNsdWRlZCwgaXNGU2NyZWVuOwogICAgICAgICAgICAgICAgZXhjbHVkZWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIueXRwLWNocm9tZS1ib3R0b20iKTsKICAgICAgICAgICAgICAgIGlzRlNjcmVlbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi55dHAtZnVsbHNjcmVlbiIpOwogICAgICAgICAgICAgICAgaWYgKGV2ZW50ICYmICFpc0ZTY3JlZW4gJiYgKCFleGNsdWRlZCB8fCAoZXZlbnQudGFyZ2V0ICE9PSBleGNsdWRlZCAmJiAhZXhjbHVkZWQuY29udGFpbnMoZXZlbnQudGFyZ2V0KSkpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LmJ1dHRvbnMgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LnR5cGUgPT09ICJtb3VzZWRvd24iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJtb3VzZW1vdmUiLCBkcmFnUG9wT3V0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZHJhZ1BvcE91dCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cub2xkUG9zID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFg6IGV2ZW50LmNsaWVudFgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWTogZXZlbnQuY2xpZW50WSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmdYOiBldmVudC5jbGllbnRYLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yZ1k6IGV2ZW50LmNsaWVudFkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC50eXBlID09PSAibW91c2Vtb3ZlIiAmJiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuaGFzTW92ZWQgfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGguYWJzKGV2ZW50LmNsaWVudFggLSB3aW5kb3cub2xkUG9zLm9yZ1gpID4gMTAgfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGguYWJzKGV2ZW50LmNsaWVudFkgLSB3aW5kb3cub2xkUG9zLm9yZ1kpID4gMTApCiAgICAgICAgICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lm1vdmVCeShldmVudC5jbGllbnRYIC0gd2luZG93Lm9sZFBvcy5YLCBldmVudC5jbGllbnRZIC0gd2luZG93Lm9sZFBvcy5ZKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5oYXNNb3ZlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LmJ1dHRvbnMgIT09IDEgfHwgZXZlbnQudHlwZSA9PT0gImNsaWNrIikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93Lmhhc01vdmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgd2luZG93Lm9sZFBvczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB3aW5kb3cuaGFzTW92ZWQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigibW91c2Vtb3ZlIiwgZHJhZ1BvcE91dCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZHJhZ1BvcE91dCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmICghZXZlbnQgJiYgd2luZG93Lm5hbWUgPT09ICJwb3BPdXQiKSB7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigibW91c2Vkb3duIiwgZHJhZ1BvcE91dCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gcmVzdW1lUGxheWJhY2soKSB7CiAgICAgICAgICAgICAgICB2YXIgdGVtcCA9IHRoaXMuZG9jdW1lbnQucXVlcnlTZWxlY3RvcigidmlkZW8iKTsKICAgICAgICAgICAgICAgIGlmICh0ZW1wICYmICFpc05hTih0ZW1wLmR1cmF0aW9uKSAmJiB0ZW1wLmN1cnJlbnRUaW1lIDwgdGVtcC5kdXJhdGlvbikgewogICAgICAgICAgICAgICAgICAgIHRlbXAgPSB0ZW1wLmN1cnJlbnRUaW1lOwogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaGFzaCA9ICJ0PSIgKyB0ZW1wOwogICAgICAgICAgICAgICAgICAgIH0sIDApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHBvcFBsYXllcih1cmwpIHsKICAgICAgICAgICAgICAgIHZhciBwb3BPdXQsIHdpZHRoLCBoZWlnaHQsIHBvcF91cmwsIHZpZGVvOwogICAgICAgICAgICAgICAgd2lkdGggPSBwYXJzZUludCh1c2VyX3NldHRpbmdzLlZJRF9QUE9UX1NaKSB8fCA1MzM7CiAgICAgICAgICAgICAgICBoZWlnaHQgPSBNYXRoLnJvdW5kKHdpZHRoIC8gKDE2IC8gOSkpOwogICAgICAgICAgICAgICAgdmlkZW8gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJ2aWRlbyIpOwogICAgICAgICAgICAgICAgcG9wX3VybCA9ICghdXJsLnRhcmdldCAmJiB1cmwpIHx8IHdpbmRvdy5sb2NhdGlvbi5ocmVmLnNwbGl0KC8mdD1bMC05XSt8I3Q9WzAtOV0rfCZ0aW1lPVswLTldKy8pLmpvaW4oIiIpOwogICAgICAgICAgICAgICAgaWYgKHVybC50YXJnZXQgJiYgdmlkZW8gJiYgdmlkZW8uY3VycmVudFRpbWUgJiYgdmlkZW8uY3VycmVudFRpbWUgPCB2aWRlby5kdXJhdGlvbikgewogICAgICAgICAgICAgICAgICAgIHBvcF91cmwgKz0gIiN0PSIgKyB2aWRlby5jdXJyZW50VGltZTsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cueXRwbGF5ZXIuY29uZmlnLmFyZ3Muc3RhcnQgPSB2aWRlby5jdXJyZW50VGltZTsKICAgICAgICAgICAgICAgICAgICBhcGkuY3VlVmlkZW9CeVBsYXllclZhcnMod2luZG93Lnl0cGxheWVyLmNvbmZpZy5hcmdzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHBvcE91dCA9IHdpbmRvdy5vcGVuKHBvcF91cmwsICJwb3BPdXQiLCAid2lkdGg9IiArIHdpZHRoICsgIixoZWlnaHQ9IiArIGhlaWdodCk7CiAgICAgICAgICAgICAgICBpZiAodXJsLnRhcmdldCkgewogICAgICAgICAgICAgICAgICAgIHBvcE91dC5hZGRFdmVudExpc3RlbmVyKCJiZWZvcmV1bmxvYWQiLCByZXN1bWVQbGF5YmFjayk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBwb3BPdXQuZm9jdXMoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBzZXRTdWJQbGF5bGlzdChldmVudCkgewogICAgICAgICAgICAgICAgdmFyIGksIGxpc3QsIGJ1dHRvbjsKICAgICAgICAgICAgICAgIGxpc3QgPSBbXTsKICAgICAgICAgICAgICAgIGlmIChldmVudC50YXJnZXQgJiYgZXZlbnQudGFyZ2V0LmlkID09PSAic3Vic2NyaXB0aW9uLXBsYXlsaXN0IikgewogICAgICAgICAgICAgICAgICAgIGkgPSBzdWJQbGF5bGlzdC52aWRlb19saXN0Lmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpID4gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3QucHVzaChzdWJQbGF5bGlzdC52aWRlb19saXN0W2ldLmRhdGFzZXQudmlkZW9JZHMpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGxpc3QgPSBsaXN0LnJldmVyc2UoKS5zcGxpY2UoMCwgMjApLmpvaW4oIiUyQyIpOwogICAgICAgICAgICAgICAgICAgIHN1YlBsYXlsaXN0Lmxpc3RfdGl0bGUgPSBzdWJQbGF5bGlzdC5saXN0X3RpdGxlLnRleHRDb250ZW50LnRyaW0oKTsKICAgICAgICAgICAgICAgICAgICBidXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic3Vic2NyaXB0aW9uLXBsYXlsaXN0Iik7CiAgICAgICAgICAgICAgICAgICAgYnV0dG9uLmhyZWYgPSAiL3dhdGNoX3ZpZGVvcz90aXRsZT0iICsgc3ViUGxheWxpc3QubGlzdF90aXRsZSArICImdmlkZW9faWRzPSIgKyBsaXN0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHN1YlBsYXlsaXN0KCkgewogICAgICAgICAgICAgICAgdmFyIGJ1dHRvbiwgYnJvd3NlX2l0ZW1zOwogICAgICAgICAgICAgICAgYnJvd3NlX2l0ZW1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI2Jyb3dzZS1pdGVtcy1wcmltYXJ5Iik7CiAgICAgICAgICAgICAgICBidXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic3Vic2NyaXB0aW9uLXBsYXlsaXN0Iik7CiAgICAgICAgICAgICAgICBzdWJQbGF5bGlzdC5saXN0X3RpdGxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI3N1YnNjcmlwdGlvbnMtZ3VpZGUtaXRlbSBbaHJlZj0nL2ZlZWQvc3Vic2NyaXB0aW9ucyddIik7CiAgICAgICAgICAgICAgICBzdWJQbGF5bGlzdC52aWRlb19saXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgiYWRkdG8td2F0Y2gtbGF0ZXItYnV0dG9uIik7CiAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5HRU5fU1VCX0xJU1QgJiYgYnJvd3NlX2l0ZW1zICYmIHdpbmRvdy5sb2NhdGlvbi5ocmVmLnNwbGl0KCIvZmVlZC9zdWJzY3JpcHRpb25zIikubGVuZ3RoID4gMSAmJiAhYnV0dG9uICYmIHN1YlBsYXlsaXN0Lmxpc3RfdGl0bGUgJiYgc3ViUGxheWxpc3QudmlkZW9fbGlzdCkgewogICAgICAgICAgICAgICAgICAgIGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRlbXBsYXRlIik7CiAgICAgICAgICAgICAgICAgICAgYnV0dG9uLmlubmVySFRNTCA9IC8vCiAgICAgICAgICAgICAgICAgICAgICAgIGA8ZGl2IGlkPSdzdWJzY3JpcHRpb24tcGxheWxpc3QtaWNvbic+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YSBpZD0nc3Vic2NyaXB0aW9uLXBsYXlsaXN0JyBkYXRhLXA9J3R0bHxTVUJfUExTVCZ0bmR8U1VCX1BMU1QnIGNsYXNzPSdzcGYtbGluayc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN2ZyB2aWV3Qm94PScwIDAgMTQgMTYnIHdpZHRoPScxNCcgaGVpZ2h0PScxNic+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwb2x5Z29uIHBvaW50cz0nMCwxNiAxNCw4IDAsMCAnLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3N2Zz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYT4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgICAgICAgICBidXR0b24gPSBzZXRMb2NhbGUoYnV0dG9uLmNvbnRlbnQpLmZpcnN0Q2hpbGQ7CiAgICAgICAgICAgICAgICAgICAgYnJvd3NlX2l0ZW1zLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGJ1dHRvbiwgYnJvd3NlX2l0ZW1zKTsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIHNldFN1YlBsYXlsaXN0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBsb2FkQ29tbWVudHMoZXZlbnQpIHsKICAgICAgICAgICAgICAgIGlmIChldmVudC50YXJnZXQgJiYgZXZlbnQudGFyZ2V0LnBhcmVudE5vZGUgJiYgZXZlbnQudGFyZ2V0LnBhcmVudE5vZGUuaWQgPT09ICJQLXNob3ctY29tbWVudHMiKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG1vZENvbW1lbnRzLmNvbW1lbnRzLmxhenlsb2FkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zcGYubG9hZC5hcHBseShtYWluLCBtb2RDb21tZW50cy5jb21tZW50cy5sYXp5bG9hZCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIG1vZENvbW1lbnRzLmNvbW1lbnRzLmNsYXNzTGlzdC50b2dnbGUoInNob3ciKTsKICAgICAgICAgICAgICAgICAgICBtb2RDb21tZW50cy53cmFwcGVyLnF1ZXJ5U2VsZWN0b3IoImJ1dHRvbiIpLnRleHRDb250ZW50ID0gbGFuZygobW9kQ29tbWVudHMuY29tbWVudHMuY2xhc3NMaXN0LmNvbnRhaW5zKCJzaG93IikgJiYgIkhJREVfQ01UUyIpIHx8ICJTSE9XX0NNVFMiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiByZXNpemVQbGF5ZXIoZXZlbnQpIHsKICAgICAgICAgICAgICAgIHZhciB0ZW1wLCBpc19zbWFsbCwgY29udGVudCwgbWF4X3dpZHRoOwogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZS5pbmRleE9mKCIvd2F0Y2giKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRlbXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGxheWVyLWFwaSIpOwogICAgICAgICAgICAgICAgaWYgKCF0ZW1wKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGVtcCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aDsKICAgICAgICAgICAgICAgIGlzX3NtYWxsID0gd2luZG93LmlubmVyV2lkdGggPCA2NTcgPyAiIiA6ICIud2F0Y2gtc3RhZ2UtbW9kZSAiOwogICAgICAgICAgICAgICAgaWYgKGlzX3NtYWxsICE9PSAiIikgewogICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLlZJRF9QTFJfRklUX1dEVEgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuVklEX1BMUl9GSVRfV0RUSC5tYXRjaCgvJS8pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhfd2lkdGggPSB3aW5kb3cucGFyc2VJbnQodXNlcl9zZXR0aW5ncy5WSURfUExSX0ZJVF9XRFRIKSAvIDEwMCAqIHRlbXA7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhfd2lkdGggPSB3aW5kb3cucGFyc2VJbnQodXNlcl9zZXR0aW5ncy5WSURfUExSX0ZJVF9XRFRIKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBtYXhfd2lkdGggPSB0ZW1wID49IG1heF93aWR0aCA/IG1heF93aWR0aCA6IHRlbXA7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgbWF4X3dpZHRoID0gdGVtcCA+PSAxMjgwID8gMTI4MCA6IHRlbXA7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBtYXhfd2lkdGggPSB0ZW1wOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29udGVudCA9IC8vCiAgICAgICAgICAgICAgICAgICAgYEBtZWRpYSBzY3JlZW4gYW5kIChtYXgtd2lkdGg6IDY1NnB4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICNwbGF5ZXItYXBpLAogICAgICAgICAgICAgICAgICAgICAgICAjcGxheWVyLXVuYXZhaWxhYmxlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogNTFweDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBmaXhlZCAhaW1wb3J0YW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYm94LXNoYWRvdzogMCAwIDEwcHggIzAwMDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAjdGhlYXRlci1iYWNrZ3JvdW5kIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50ICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJHtpc19zbWFsbH0ucGxheWVyLXdpZHRoIHsKICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6ICR7bWF4X3dpZHRofXB4ICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6ICR7bWF4X3dpZHRoIC8gMiAqIC0xfXB4ICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICR7aXNfc21hbGx9LnBsYXllci1oZWlnaHQ6bm90KC53YXRjaC1wbGF5bGlzdCkgewogICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6ICR7bWF4X3dpZHRoIC8gKDE2IC8gOSl9cHggIWltcG9ydGFudDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJHtpc19zbWFsbH0jd2F0Y2gtYXBwYmFyLXBsYXlsaXN0IHsKICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiAke21heF93aWR0aCAvICgxNiAvIDkpIC0gKGlzX3NtYWxsID09PSAiIiA/IDAgOiAzNjApfXB4ICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICAgICAgfWA7CiAgICAgICAgICAgICAgICB0ZW1wID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInl0cC1yZXNpemVyIik7CiAgICAgICAgICAgICAgICBpZiAoIXRlbXApIHsKICAgICAgICAgICAgICAgICAgICB0ZW1wID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3R5bGUiKTsKICAgICAgICAgICAgICAgICAgICB0ZW1wLmlkID0gInl0cC1yZXNpemVyIjsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHRlbXApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGVtcC50ZXh0Q29udGVudCA9IGNvbnRlbnQ7CiAgICAgICAgICAgICAgICBpZiAoIWV2ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCJyZXNpemUiKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gbW9kUGxheWVyU2l6ZSgpIHsKICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLlZJRF9QTFJfRklUKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzaXplUGxheWVyKCk7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInJlc2l6ZSIsIHJlc2l6ZVBsYXllcik7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigic3BmZG9uZSIsIHJlc2l6ZVBsYXllcik7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCJyZXNpemUiLCByZXNpemVQbGF5ZXIpOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoInNwZmRvbmUiLCByZXNpemVQbGF5ZXIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIG1vZENvbW1lbnRzKCkgewogICAgICAgICAgICAgICAgdmFyIGlzX2xpdmUgPSB3aW5kb3cueXRwbGF5ZXIgJiYgd2luZG93Lnl0cGxheWVyLmNvbmZpZyAmJiB3aW5kb3cueXRwbGF5ZXIuY29uZmlnLmFyZ3MgJiYgd2luZG93Lnl0cGxheWVyLmNvbmZpZy5hcmdzLmxpdmVzdHJlYW07CiAgICAgICAgICAgICAgICBtb2RDb21tZW50cy5jb21tZW50cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ3YXRjaC1kaXNjdXNzaW9uIik7CiAgICAgICAgICAgICAgICBpZiAoIWlzX2xpdmUgJiYgbW9kQ29tbWVudHMuY29tbWVudHMgJiYgIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJQLXNob3ctY29tbWVudHMiKSAmJiB1c2VyX3NldHRpbmdzLlZJRF9ISURFX0NPTVMgPT09ICIxIikgewogICAgICAgICAgICAgICAgICAgIG1vZENvbW1lbnRzLndyYXBwZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZW1wbGF0ZSIpOwogICAgICAgICAgICAgICAgICAgIG1vZENvbW1lbnRzLndyYXBwZXIuaW5uZXJIVE1MID0gLy8KICAgICAgICAgICAgICAgICAgICAgICAgYDxkaXYgaWQ9J1Atc2hvdy1jb21tZW50cycgY2xhc3M9J3l0LWNhcmQnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0neXQtdWl4LWJ1dHRvbiB5dC11aXgtYnV0dG9uLWV4cGFuZGVyJyBkYXRhLXA9J3RuZHxTSE9XX0NNVFMnPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgICAgICAgICAgICAgICAgIG1vZENvbW1lbnRzLndyYXBwZXIgPSBzZXRMb2NhbGUobW9kQ29tbWVudHMud3JhcHBlci5jb250ZW50KS5maXJzdENoaWxkOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgbG9hZENvbW1lbnRzKTsKICAgICAgICAgICAgICAgICAgICBtb2RDb21tZW50cy5jb21tZW50cy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShtb2RDb21tZW50cy53cmFwcGVyLCBtb2RDb21tZW50cy5jb21tZW50cyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5zZWFyY2gubWF0Y2goLyY/KGxjfGdvb2dsZV9jb21tZW50X2lkKT0vKSkgewogICAgICAgICAgICAgICAgICAgICAgICBtb2RDb21tZW50cy53cmFwcGVyLnF1ZXJ5U2VsZWN0b3IoImJ1dHRvbiIpLmNsaWNrKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHNldEN1c3RvbVN0eWxlcyhjbHNzKSB7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0W3VzZXJfc2V0dGluZ3NbY2xzc10gPyAiYWRkIiA6ICJyZW1vdmUiXShjdXN0b21TdHlsZXMuY3VzdG9tX3N0eWxlc1tjbHNzXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gY3VzdG9tU3R5bGVzKCkgewogICAgICAgICAgICAgICAgdmFyIGNoaWxkLCB3aWR0aCwgaGVpZ2h0LCBwYXJlbnQsIGNvbW1lbnRzLCBzaWRlYmFyLCB5dEdyaWQsIGFkdmVydHMsIGFkc19saXN0OwogICAgICAgICAgICAgICAgY29tbWVudHMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgid2F0Y2gtZGlzY3Vzc2lvbiIpOwogICAgICAgICAgICAgICAgeXRHcmlkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnl0LXVpeC1tZW51LXRvcC1sZXZlbC1mbG93LWJ1dHRvbjpsYXN0LWNoaWxkIGEiKTsKICAgICAgICAgICAgICAgIGN1c3RvbVN0eWxlcy5jdXN0b21fc3R5bGVzID0gewogICAgICAgICAgICAgICAgICAgIEdFTl9EU0JMX0FEUyAgICA6ICJwYXJ0X25vX2FkcyIsCiAgICAgICAgICAgICAgICAgICAgR0VOX0JMVUVfR0xPVyAgIDogInBhcnRfZHNibF9nbG93IiwKICAgICAgICAgICAgICAgICAgICBHRU5fSElERV9GVFIgICAgOiAicGFydF9oaWRlX2Zvb3RlciIsCiAgICAgICAgICAgICAgICAgICAgR0VOX0JUVFJfTlRGICAgIDogInBhcnRfbm90aWZfYnV0dG9uIiwKICAgICAgICAgICAgICAgICAgICBHRU5fR1JJRF9TVUJTICAgOiAicGFydF9ncmlkX3N1YnMiLAogICAgICAgICAgICAgICAgICAgIEdFTl9HUklEX1NSQ0ggICA6ICJwYXJ0X2dyaWRfc2VhcmNoIiwKICAgICAgICAgICAgICAgICAgICBHRU5fQ01QVF9UVExTICAgOiAicGFydF9jb21wYWN0X3RpdGxlcyIsCiAgICAgICAgICAgICAgICAgICAgVklEX1BMUl9BVFBMICAgIDogInBhcnRfYXV0b3BsYXlvbiIsCiAgICAgICAgICAgICAgICAgICAgVklEX1BMUl9EWU5fU0laRTogInBhcnRfc3RhdGljX3NpemUiLAogICAgICAgICAgICAgICAgICAgIFZJRF9ISURFX0RFVExTICA6ICJwYXJ0X2hpZGVfZGV0YWlscyIsCiAgICAgICAgICAgICAgICAgICAgVklEX1RUTF9DTVBUICAgIDogInBhcnRfY29tcGFjdF90aXRsZSIsCiAgICAgICAgICAgICAgICAgICAgVklEX0RFU0NfU0hSVCAgIDogInBhcnRfbGFiZWxsZXNzX2J1dHRvbnMiCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy55dCAmJiB3aW5kb3cueXQuY29uZmlnXyAmJiB3aW5kb3cueXQuY29uZmlnXy5QQUdFX05BTUUgPT09ICJzaGFyZWRfY29udmVyc2F0aW9uIikgewogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW3JlbD0nc2hvcnRsaW5rJ10iKS5ocmVmOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh3aW5kb3cubmFtZSA9PT0gInBvcE91dCIpIHsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0LmFkZCgicGFydF9wb3BvdXQiKTsKICAgICAgICAgICAgICAgICAgICB3aWR0aCA9IHBhcnNlSW50KHVzZXJfc2V0dGluZ3MuVklEX1BQT1RfU1opIHx8IDUzMzsKICAgICAgICAgICAgICAgICAgICBoZWlnaHQgPSBNYXRoLnJvdW5kKHdpZHRoIC8gKDE2IC8gOSkpOwogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5yZXNpemVUbygKICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGggKyAod2luZG93Lm91dGVyV2lkdGggLSB3aW5kb3cuaW5uZXJXaWR0aCksCiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodCArICh3aW5kb3cub3V0ZXJIZWlnaHQgLSB3aW5kb3cuaW5uZXJIZWlnaHQpCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh5dEdyaWQgJiYgdXNlcl9zZXR0aW5ncy5HRU5fR1JJRF9TVUJTKSB7CiAgICAgICAgICAgICAgICAgICAgeXRHcmlkLmNsaWNrKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHNpZGViYXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIuYnJhbmRlZC1wYWdlLXYyLXNlY29uZGFyeS1jb2wiKTsKICAgICAgICAgICAgICAgICAgICBhZHNfbGlzdCA9IC8vCiAgICAgICAgICAgICAgICAgICAgICAgIGAjbWFzdGhlYWRfY2hpbGQsCiAgICAgICAgICAgICAgICAgICAgICAgICNmZWVkLXB5di1jb250YWluZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICN3YXRjaDctc2lkZWJhci1hZHMsCiAgICAgICAgICAgICAgICAgICAgICAgICN3YXRjaDctc2lkZWJhci1vZmZlciwKICAgICAgICAgICAgICAgICAgICAgICAgLmFkLWRpdiwKICAgICAgICAgICAgICAgICAgICAgICAgLnB5di1hZmMtYWRzLWNvbnRhaW5lciwKICAgICAgICAgICAgICAgICAgICAgICAgLnZpZGVvLWxpc3QtaXRlbTpub3QoLnJlbGF0ZWQtbGlzdC1pdGVtKTpub3QoLmRhc2hib2FyZC13aWRnZXQtaXRlbSlgOwogICAgICAgICAgICAgICAgICAgIGFkdmVydHMgPSB1c2VyX3NldHRpbmdzLkdFTl9EU0JMX0FEUyAmJiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGFkc19saXN0KTsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoYWR2ZXJ0cykgewogICAgICAgICAgICAgICAgICAgICAgICBjaGlsZCA9IGFkdmVydHM7CiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChjaGlsZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50ID0gY2hpbGQucGFyZW50Tm9kZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnQuY2hpbGRFbGVtZW50Q291bnQgPiAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGQucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGlsZCA9IHBhcmVudDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBhZHZlcnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihhZHNfbGlzdCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICAgICAgc2lkZWJhciAmJgogICAgICAgICAgICAgICAgICAgICAgICBzaWRlYmFyLnBhcmVudE5vZGUgJiYgKAogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgPT09ICIvcmVzdWx0cyIgJiYKICAgICAgICAgICAgICAgICAgICAgICAgc2lkZWJhciAmJgogICAgICAgICAgICAgICAgICAgICAgICBzaWRlYmFyLnF1ZXJ5U2VsZWN0b3JBbGwoIioiKS5sZW5ndGggPCAxMCkgfHwgKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2lkZWJhciAmJiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcl9zZXR0aW5ncy5HRU5fSERFX1JFQ01fU0RCUiAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmLnNwbGl0KCIvZmVlZC9zdWJzY3JpcHRpb25zIikubGVuZ3RoID4gMSB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfc2V0dGluZ3MuR0VOX0hERV9TUkNIX1NEQlIgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgPT09ICIvcmVzdWx0cyIgfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyX3NldHRpbmdzLkdFTl9IREVfQ0hOX1NEQlIgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZi5zcGxpdCgvXC8oY2hhbm5lbHx1c2VyfGMpXC8vKS5sZW5ndGggPiAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2lkZWJhci5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCF3aW5kb3cubG9jYXRpb24uc2VhcmNoLm1hdGNoKC8mPyhsY3xnb29nbGVfY29tbWVudF9pZCk9LykgJiYgd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lID09PSAiL3dhdGNoIiAmJiB1c2VyX3NldHRpbmdzLlZJRF9ISURFX0NPTVMgPiAxICYmIGNvbW1lbnRzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1lbnRzLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5WSURfSElERV9DT01TID09PSAiMSIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsYXNzTGlzdC5hZGQoInBhcnRfaGlkZV9jb21tZW50cyIpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodXNlcl9zZXR0aW5ncy5WSURfSElERV9DT01TICE9PSAiMSIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoInBhcnRfaGlkZV9jb21tZW50cyIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5WSURfUExSX0ZJVCkgewogICAgICAgICAgICAgICAgICAgICAgICBtb2RQbGF5ZXJTaXplKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKGN1c3RvbVN0eWxlcy5jdXN0b21fc3R5bGVzKS5mb3JFYWNoKHNldEN1c3RvbVN0eWxlcyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5ocmVmLnNwbGl0KCIvZmVlZC9zdWJzY3JpcHRpb25zIikubGVuZ3RoIDwgMikgewogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgicGFydF9ncmlkX3N1YnMiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gZGVmYXVsdENoYW5uZWxQYWdlKGV2ZW50KSB7CiAgICAgICAgICAgICAgICB2YXIgcGFyZW50Tm9kZTsKICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLkdFTl9DSE5fREZMVF9QQUdFICE9PSAiZGVmYXVsdCIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQgJiYgZXZlbnQudGFyZ2V0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudE5vZGUgPSBldmVudC50YXJnZXQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChldmVudC50YXJnZXQudGFnTmFtZSAhPT0gIkEiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAocGFyZW50Tm9kZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudE5vZGUgPSBwYXJlbnROb2RlLnBhcmVudE5vZGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmVudE5vZGUgJiYgcGFyZW50Tm9kZS50YWdOYW1lID09PSAiQSIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudE5vZGUgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudE5vZGUuaHJlZiAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50Tm9kZS5ocmVmLnNwbGl0KHVzZXJfc2V0dGluZ3MuR0VOX0NITl9ERkxUX1BBR0UpLmxlbmd0aCA8IDIgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnROb2RlLmhyZWYuc3BsaXQoIi9jaGFubmVsLyIpLmxlbmd0aCA+IDEgfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnROb2RlLmhyZWYuc3BsaXQoIi91c2VyLyIpLmxlbmd0aCA+IDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICkgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudE5vZGUuaHJlZi5zcGxpdCgvW2EtejAtOV1cL1thLXowLTldL2kpLmxlbmd0aCA8IDQKICAgICAgICAgICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnROb2RlLmhyZWYgKz0gIi8iICsgdXNlcl9zZXR0aW5ncy5HRU5fQ0hOX0RGTFRfUEFHRTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWV2ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNldXAiLCBkZWZhdWx0Q2hhbm5lbFBhZ2UpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBtb2RBcmdzKGNvbmZpZykgewogICAgICAgICAgICAgICAgdmFyIGksIHRlbXAsIGxpc3QsIGxlbmd0aCwgdmlkZW9zLCBuZXdfbGlzdCwgY2FuX3NoYXJlOwogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5uYW1lID09PSAicG9wT3V0IikgewogICAgICAgICAgICAgICAgICAgIGNhbl9zaGFyZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5wbGF5bGlzdC1oZWFkZXItY29udGVudCIpOwogICAgICAgICAgICAgICAgICAgIGlmIChjYW5fc2hhcmUgJiYgY2FuX3NoYXJlLmRhdGFzZXQuc2hhcmVhYmxlID09PSAiRmFsc2UiICYmICFjb25maWcuYXJncy52aWRlbykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25maWcuYXJncy52aWRlbyA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICB2aWRlb3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJsaVtkYXRhLXZpZGVvLWlkXSIpOwogICAgICAgICAgICAgICAgICAgICAgICBsZW5ndGggPSB2aWRlb3MubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZy5hcmdzLnZpZGVvW2ldID0geyJlbmNyeXB0ZWRfaWQiOiB2aWRlb3NbaV0uZ2V0QXR0cmlidXRlKCJkYXRhLXZpZGVvLWlkIil9OwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LnRpdGxlID0gY29uZmlnLmFyZ3MudGl0bGU7CiAgICAgICAgICAgICAgICAgICAgY29uZmlnLmFyZ3MuZWwgPSAiZW1iZWRkZWQiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGNvbmZpZy5hcmdzLnZxKSB7CiAgICAgICAgICAgICAgICAgICAgY29uZmlnLmFyZ3MudnEgPSB1c2VyX3NldHRpbmdzLlZJRF9ERkxUX1FMVFk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5WSURfREZMVF9RTFRZICE9PSAiYXV0byIpIHsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlWyJ5dC1wbGF5ZXItcXVhbGl0eSJdID0gSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgImRhdGEiOiB1c2VyX3NldHRpbmdzLlZJRF9ERkxUX1FMVFksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZXhwaXJhdGlvbiI6IG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgODY0RTUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiY3JlYXRpb24iOiBuZXcgRGF0ZSgpLmdldFRpbWUoKQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChpZ25vcmUpIHt9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoY29uZmlnLmFyZ3MuY2FwdGlvbl9hdWRpb190cmFja3MgJiYgdXNlcl9zZXR0aW5ncy5WSURfUExSX0NDKSB7CiAgICAgICAgICAgICAgICAgICAgY29uZmlnLmFyZ3MuY2FwdGlvbl9hdWRpb190cmFja3MgPSBjb25maWcuYXJncy5jYXB0aW9uX2F1ZGlvX3RyYWNrcy5zcGxpdCgvJmQ9WzAtOV18ZD1bMC05XSYvKS5qb2luKCIiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLlZJRF9QTFJfVk9MX0xETikgewogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBjb25maWcuYXJncy5sb3VkbmVzczsKICAgICAgICAgICAgICAgICAgICBkZWxldGUgY29uZmlnLmFyZ3MucmVsYXRpdmVfbG91ZG5lc3M7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5WSURfUExSX0hUTUw1KSB7CiAgICAgICAgICAgICAgICAgICAgY29uZmlnLmh0bWw1ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLlZJRF9QTFJfSU5GTykgewogICAgICAgICAgICAgICAgICAgIGNvbmZpZy5hcmdzLnNob3dpbmZvID0gIjEiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5vcGVuZXIgJiYgd2luZG93LmxvY2F0aW9uLmhhc2ggIT09ICIiKSB7CiAgICAgICAgICAgICAgICAgICAgY29uZmlnLmFyZ3MuYXV0b3BsYXkgPSAiMSI7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCF1c2VyX3NldHRpbmdzLlZJRF9QTFJfQVRQTCkgewogICAgICAgICAgICAgICAgICAgIGNvbmZpZy5hcmdzLmF1dG9wbGF5ID0gIjAiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGNvbmZpZy5hcmdzLmZmbGFncykgewogICAgICAgICAgICAgICAgICAgIGNvbmZpZy5hcmdzLmZmbGFncyA9IGNvbmZpZy5hcmdzLmZmbGFncy5yZXBsYWNlKCJsZWdhY3lfYXV0b3BsYXlfZmxhZz10cnVlIiwgImxlZ2FjeV9hdXRvcGxheV9mbGFnPWZhbHNlIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5WSURfUExSX1NJWkVfTUVNKSB7CiAgICAgICAgICAgICAgICAgICAgY29uZmlnLmFyZ3MucGxheWVyX3dpZGUgPSAodXNlcl9zZXR0aW5ncy50aGVhdGVyTW9kZSAmJiAiMSIpIHx8ICIwIjsKICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93Lnl0cHNldHdpZGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lnl0cHNldHdpZGUoIndpZGUiLCBjb25maWcuYXJncy5wbGF5ZXJfd2lkZSwgLTEpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChjb25maWcuYXJncy5pdl9sb2FkX3BvbGljeSAmJiB1c2VyX3NldHRpbmdzLlZJRF9QTFJfQU5UUykgewogICAgICAgICAgICAgICAgICAgIGNvbmZpZy5hcmdzLml2X2xvYWRfcG9saWN5ID0gIjMiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuVklEX1BMUl9BRFMgJiYgKCF1c2VyX3NldHRpbmdzLlZJRF9TVUJfQURTIHx8ICh1c2VyX3NldHRpbmdzLlZJRF9TVUJfQURTICYmICFjb25maWcuYXJncy5zdWJzY3JpYmVkKSkpIHsKICAgICAgICAgICAgICAgICAgICBkZWxldGUgY29uZmlnLmFyZ3MuYWQzX21vZHVsZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChjb25maWcuYXJncy5hZGFwdGl2ZV9mbXRzICYmIHVzZXJfc2V0dGluZ3MuVklEX1BMUl9IRlIpIHsKICAgICAgICAgICAgICAgICAgICBuZXdfbGlzdCA9IFtdOwogICAgICAgICAgICAgICAgICAgIGxpc3QgPSBjb25maWcuYXJncy5hZGFwdGl2ZV9mbXRzLnNwbGl0KCIsIik7CiAgICAgICAgICAgICAgICAgICAgaSA9IGxpc3QubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGVtcCA9IGxpc3RbaV0uc3BsaXQoL2Zwcz0oWzAtOV17Mn0pLylbMV07CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGVtcCB8fCB0ZW1wIDwgMzEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld19saXN0LnB1c2gobGlzdFtpXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY29uZmlnLmFyZ3MuYWRhcHRpdmVfZm10cyA9IG5ld19saXN0LmpvaW4oIiwiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBjb25maWc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gbW9kTWF0Y2hNZWRpYShvcmlnaW5hbCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHRleHQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgdGVtcCA9IG9yaWdpbmFsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRleHQgPT09ICJzY3JlZW4gYW5kIChtYXgtd2lkdGg6IDY1NnB4KSIgJiYgdGVtcC5tYXRjaGVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0ZW1wOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGVtcCwgIm1hdGNoZXMiLCB7d3JpdGFibGU6IHRydWV9KTsKICAgICAgICAgICAgICAgICAgICB0ZW1wLm1hdGNoZXMgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGVtcDsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gY2hlY2tEb21QYXJzZXIob3JpZ2luYWwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgaSwgZnBzLCByZXN1bHQsIHN0cmVhbXM7CiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuVklEX1BMUl9IRlIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gb3JpZ2luYWwuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgICAgICAgICAgc3RyZWFtcyA9IHJlc3VsdC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiUmVwcmVzZW50YXRpb24iKTsKICAgICAgICAgICAgICAgICAgICAgICAgaSA9IHN0cmVhbXMubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcHMgPSBzdHJlYW1zW2ldLmdldEF0dHJpYnV0ZSgiZnJhbWVSYXRlIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZnBzID4gMzApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJlYW1zW2ldLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBvcmlnaW5hbC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBnZW5lcmFsQ2hhbmdlcygpIHsKICAgICAgICAgICAgICAgIHZhciBsb2dvLCBjaGVja2JveCwgYXV0b3BsYXliYXIsIGRlc2NyaXB0aW9uOwogICAgICAgICAgICAgICAgYXV0b3BsYXliYXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIuYXV0b3BsYXktYmFyIik7CiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhY3Rpb24tcGFuZWwtZGV0YWlscyIpOwogICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuR0VOX1lUX0xPR09fTElOSyAmJiB3aW5kb3cueXQgJiYgd2luZG93Lnl0LmNvbmZpZ18gJiYgd2luZG93Lnl0LmNvbmZpZ18uTE9HR0VEX0lOKSB7CiAgICAgICAgICAgICAgICAgICAgbG9nbyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIm1hcFtuYW1lPSdkb29kbGUnXSA+IGFyZWEsIGEjbG9nby1jb250YWluZXIiKTsKICAgICAgICAgICAgICAgICAgICBpZiAobG9nbyAmJiBsb2dvLmhyZWYgPT09IHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4gKyAiLyIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9nby5ocmVmID0gIi9mZWVkL3N1YnNjcmlwdGlvbnMiOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLkdFTl9SRU1fQVBVTiAmJiB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgPT09ICIvd2F0Y2giICYmIGF1dG9wbGF5YmFyKSB7CiAgICAgICAgICAgICAgICAgICAgY2hlY2tib3ggPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIuY2hlY2tib3gtb24tb2ZmIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNoZWNrYm94KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrYm94LnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLlZJRF9MQVlUX0FVVE9fUE5MICYmIHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSA9PT0gIi93YXRjaCIgJiYgZGVzY3JpcHRpb24pIHsKICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbi5jbGFzc0xpc3QucmVtb3ZlKCJ5dC11aXgtZXhwYW5kZXItY29sbGFwc2VkIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5HRU5fU1BGX09GRiAmJiB3aW5kb3cuc3BmICYmIHdpbmRvdy5zcGYuZGlzcG9zZSkgewogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zcGYuZGlzcG9zZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGxvY2FsWEhSKG1ldGhvZCwgY2FsbCwgdXJsLCBoZWFkKSB7CiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwogICAgICAgICAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCJsb2FkIiwgY2FsbCk7CiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9wZW4obWV0aG9kLCB1cmwsIHRydWUpOwogICAgICAgICAgICAgICAgaWYgKGhlYWQgJiYgaGVhZCAhPT0gImRvYyIpIHsKICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnNldFJlcXVlc3RIZWFkZXIoaGVhZFswXSwgaGVhZFsxXSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJlcXVlc3QucmVzcG9uc2VUeXBlID0gImRvY3VtZW50IjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlcXVlc3Quc2VuZCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHBsYXllck1vZGUoKSB7CiAgICAgICAgICAgICAgICB2YXIgcGFnZUVsZW1lbnQsIHBsYXllckVsZW1lbnQ7CiAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5WSURfUExSX1NJWkVfTUVNKSB7CiAgICAgICAgICAgICAgICAgICAgcGFnZUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGFnZSIpOwogICAgICAgICAgICAgICAgICAgIHBsYXllckVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGxheWVyIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy55dHBzZXR3aWRlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy55dHBzZXR3aWRlKCJ3aWRlIiwgKHVzZXJfc2V0dGluZ3MudGhlYXRlck1vZGUgPyAiMSIgOiAiMCIpLCAtMSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChwYWdlRWxlbWVudCAmJiBwbGF5ZXJFbGVtZW50ICYmIHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSA9PT0gIi93YXRjaCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGFnZUVsZW1lbnQuY2xhc3NMaXN0W3VzZXJfc2V0dGluZ3MudGhlYXRlck1vZGUgPyAiYWRkIiA6ICJyZW1vdmUiXSgid2F0Y2gtd2lkZSIpOwogICAgICAgICAgICAgICAgICAgICAgICBwYWdlRWxlbWVudC5jbGFzc05hbWUgPSBwYWdlRWxlbWVudC5jbGFzc05hbWUucmVwbGFjZSh1c2VyX3NldHRpbmdzLnRoZWF0ZXJNb2RlID8gIm5vbi0iIDogIndhdGNoLXN0YWdlIiwgdXNlcl9zZXR0aW5ncy50aGVhdGVyTW9kZSA/ICIiIDogIndhdGNoLW5vbi1zdGFnZSIpOwogICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXJFbGVtZW50LmNsYXNzTmFtZSA9IHVzZXJfc2V0dGluZ3MudGhlYXRlck1vZGUgPyBwbGF5ZXJFbGVtZW50LmNsYXNzTmFtZS5yZXBsYWNlKCJzbWFsbCIsICJsYXJnZSIpIDogcGxheWVyRWxlbWVudC5jbGFzc05hbWUucmVwbGFjZSgibGFyZ2UiLCAic21hbGwiKS5yZXBsYWNlKCJtZWRpdW0iLCAic21hbGwiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gaW5maW5pdGVTY3JvbGwoKSB7CiAgICAgICAgICAgICAgICB2YXIgb2JzZXJ2ZXIsIGxvYWRNb3JlOwogICAgICAgICAgICAgICAgbG9hZE1vcmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIubG9hZC1tb3JlLWJ1dHRvbiIpOwogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSAhPT0gIi93YXRjaCIgJiYgbG9hZE1vcmUgJiYgdXNlcl9zZXR0aW5ncy5HRU5fSU5GX1NDUkwpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIWxvYWRNb3JlLmNsYXNzTGlzdC5jb250YWlucygiaW5maW5pdGVTY3JvbGwiKSkgewogICAgICAgICAgICAgICAgICAgICAgICBsb2FkTW9yZS5jbGFzc0xpc3QuYWRkKCJpbmZpbml0ZVNjcm9sbCIpOwogICAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKGluZmluaXRlU2Nyb2xsKTsKICAgICAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIub2JzZXJ2ZShsb2FkTW9yZSwge2F0dHJpYnV0ZXM6IHRydWV9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCFsb2FkTW9yZS5jbGFzc0xpc3QuY29udGFpbnMoInNjcm9sbGRldGVjdCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRNb3JlLmNsYXNzTGlzdC5hZGQoInNjcm9sbGRldGVjdCIpOwogICAgICAgICAgICAgICAgICAgICAgICBsb2FkTW9yZS5kYXRhc2V0LnNjcm9sbGRldGVjdENhbGxiYWNrID0gImxvYWQtbW9yZS1hdXRvIjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gY2hlY2tOZXdGZWF0dXJlcygpIHsKICAgICAgICAgICAgICAgIHZhciBpLCBrZXlzOwogICAgICAgICAgICAgICAga2V5cyA9IE9iamVjdC5rZXlzKGRlZmF1bHRfc2V0dGluZ3MpOwogICAgICAgICAgICAgICAgaSA9IGtleXMubGVuZ3RoOwogICAgICAgICAgICAgICAgd2hpbGUgKGkpIHsKICAgICAgICAgICAgICAgICAgICBpIC09IDE7CiAgICAgICAgICAgICAgICAgICAgaWYgKCF1c2VyX3NldHRpbmdzLmhhc093blByb3BlcnR5KGtleXNbaV0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNldChrZXlzW2ldLCBkZWZhdWx0X3NldHRpbmdzW2tleXNbaV1dKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gc2hhcmVBcGkob3JpZ2luYWwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgcGxheWVyUmVhZHkoKTsKICAgICAgICAgICAgICAgICAgICBpZiAob3JpZ2luYWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiByZXF1ZXN0KGV2ZW50KSB7CiAgICAgICAgICAgICAgICB2YXIgdmlkZW9fcGxheWVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1vdmllX3BsYXllciIpOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoImZsb2F0ZXIiKTsKICAgICAgICAgICAgICAgIGlmICh2aWRlb19wbGF5ZXIpIHsKICAgICAgICAgICAgICAgICAgICB2aWRlb19wbGF5ZXIucmVtb3ZlQXR0cmlidXRlKCJzdHlsZSIpOwogICAgICAgICAgICAgICAgICAgIGlmICghdXNlcl9zZXR0aW5ncy5WSURfUExSX0FUUEwgfHwgIWV2ZW50LmRldGFpbC51cmwuaW5kZXhPZigiL3dhdGNoIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy55dHBsYXllciAmJiB3aW5kb3cueXRwbGF5ZXIuY29uZmlnICYmIHdpbmRvdy55dHBsYXllci5jb25maWcubG9hZGVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgd2luZG93Lnl0cGxheWVyLmNvbmZpZy5sb2FkZWQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYXBpLmRlc3Ryb3koKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gcGFnZVNjcmlwdE1lc3NhZ2VzKCkgewogICAgICAgICAgICAgICAgdmFyIGtleSwgZ2F0ZSwgc2V0cywgb2JzZXJ2ZXI7CiAgICAgICAgICAgICAgICBrZXkgPSAicGFycmVjZWl2ZSI7CiAgICAgICAgICAgICAgICBnYXRlID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50OwogICAgICAgICAgICAgICAgc2V0cyA9IEpTT04ucGFyc2UoZ2F0ZS5kYXRhc2V0W2tleV0gfHwgbnVsbCk7CiAgICAgICAgICAgICAgICBpZiAoIWdhdGUucGFnZXNjcmlwdCkgewogICAgICAgICAgICAgICAgICAgIGdhdGUucGFnZXNjcmlwdCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihwYWdlU2NyaXB0TWVzc2FnZXMpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBvYnNlcnZlci5vYnNlcnZlKGdhdGUsIHsKICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlczogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlRmlsdGVyOiBbImRhdGEtIiArIGtleV0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChzZXRzKSB7CiAgICAgICAgICAgICAgICAgICAgdXNlcl9zZXR0aW5ncyA9IHNldHM7CiAgICAgICAgICAgICAgICAgICAgZ2F0ZS5kYXRhc2V0W2tleV0gPSBudWxsOwogICAgICAgICAgICAgICAgICAgIGN1c3RvbVN0eWxlcygpOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoImRhdGEtcGFycmVjZWl2ZSIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHNldChzZXR0aW5nLCBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgIGlmIChzZXR0aW5nICE9PSAidXNlcl9zZXR0aW5ncyIpIHsKICAgICAgICAgICAgICAgICAgICB1c2VyX3NldHRpbmdzW3NldHRpbmddID0gbmV3X3ZhbHVlOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB1c2VyX3NldHRpbmdzID0gbmV3X3ZhbHVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmRhdGFzZXQucGFyc2VuZCA9IEpTT04uc3RyaW5naWZ5KHVzZXJfc2V0dGluZ3MpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIG1haW4oKSB7CiAgICAgICAgICAgICAgICBpZiAoaXNNYXRlcmlhbCgpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdXBkYXRlQmxhY2tsaXN0TW9kZWwoKTsKICAgICAgICAgICAgICAgIHBhZ2VTY3JpcHRNZXNzYWdlcygpOwogICAgICAgICAgICAgICAgY3VzdG9tU3R5bGVzKCk7CiAgICAgICAgICAgICAgICBzZXR0aW5nc01lbnUoKTsKICAgICAgICAgICAgICAgIGluZmluaXRlU2Nyb2xsKCk7CiAgICAgICAgICAgICAgICBwbGF5bGlzdENvbnRyb2xzKCk7CiAgICAgICAgICAgICAgICBwbGF5ZXJNb2RlKCk7CiAgICAgICAgICAgICAgICBtb2RQbGF5ZXJTaXplKCk7CiAgICAgICAgICAgICAgICBhZHZhbmNlZE9wdGlvbnMoKTsKICAgICAgICAgICAgICAgIHZvbHVtZVdoZWVsKCk7CiAgICAgICAgICAgICAgICBzdWJQbGF5bGlzdCgpOwogICAgICAgICAgICAgICAgYWx3YXlzVmlzaWJsZSgpOwogICAgICAgICAgICAgICAgbW9kVGh1bWJzKCk7CiAgICAgICAgICAgICAgICBlbmhhbmNlZERldGFpbHMoKTsKICAgICAgICAgICAgICAgIG1vZENvbW1lbnRzKCk7CiAgICAgICAgICAgICAgICBkZWZhdWx0Q2hhbm5lbFBhZ2UoKTsKICAgICAgICAgICAgICAgIGdlbmVyYWxDaGFuZ2VzKCk7CiAgICAgICAgICAgICAgICBkcmFnUG9wT3V0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gaXNNYXRlcmlhbCgpIHsKICAgICAgICAgICAgICAgIHZhciB0ZW1wOwogICAgICAgICAgICAgICAgdGVtcCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoInl0ZC1hcHAsIFtzcmMqPSdwb2x5bWVyJ10iKSB8fCB3aW5kb3cuUG9seW1lcjsKICAgICAgICAgICAgICAgIGlmICh0ZW1wICYmICFkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibWF0ZXJpYWwtbm90aWNlIikpIHsKICAgICAgICAgICAgICAgICAgICB0ZW1wID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGVtcGxhdGUiKTsKICAgICAgICAgICAgICAgICAgICB0ZW1wLmlubmVySFRNTCA9IC8vCiAgICAgICAgICAgICAgICAgICAgICAgIGA8ZGl2IGlkPSdtYXRlcmlhbC1ub3RpY2UnIHN0eWxlPSdib3JkZXItcmFkaXVzOjJweDtjb2xvcjojRkZGO3BhZGRpbmc6MTBweDtiYWNrZ3JvdW5kLWNvbG9yOiMwOUY7Ym94LXNoYWRvdzowIDAgM3B4IHJnYmEoMCwwLDAsLjUpO2ZvbnQtc2l6ZToxMnB4O3Bvc2l0aW9uOmZpeGVkO2JvdHRvbToyMHB4O3JpZ2h0OjUwJTt0cmFuc2Zvcm06dHJhbnNsYXRlWCg1MCUpO3otaW5kZXg6OTk5OTk7Jz4KICAgICAgICAgICAgICAgICAgICAgICAgWW91VHViZSBQbHVzIGlzIG5vdCBjb21wYXRpYmxlIHdpdGggdGhlIFlvdVR1YmUgYmV0YSBNYXRlcmlhbCBMYXlvdXQ8YnI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9SZXN0b3JlLWNsYXNzaWMtWW91VHViZScgdGFyZ2V0PSdfYmxhbmsnIHN0eWxlPSdjb2xvcjojRkZGO2ZvbnQtd2VpZ2h0OmJvbGQ7Jz5DbGljayBoZXJlPC9hPiBmb3IgaW5zdHJ1Y3Rpb25zIHRvIHJlc3RvcmUgY2xhc3NpYyBZb3VUdWJlIGFuZCBjb250aW51ZSB1c2luZyBZVCs8YnI+CiAgICAgICAgICAgICAgICAgICAgICAgIEEgbmV3IHZlcnNpb24gZm9yIHRoZSBuZXcgbGF5b3V0IGlzIGF2YWlsYWJsZSA8YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL2lzc3Vlcy80NDgnIHRhcmdldD0nX2JsYW5rJyBzdHlsZT0nY29sb3I6I0ZGRjtmb250LXdlaWdodDpib2xkOyc+aGVyZTwvYT48YnI+CiAgICAgICAgICAgICAgICAgICAgICAgIFRvIGtlZXAgdXNpbmcgdGhlIGN1cnJlbnQgbGF5b3V0IHdpdGhvdXQgdGhpcyBtZXNzYWdlIHBsZWFzZSBkaXNhYmxlIFlUKwogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5hcHBlbmRDaGlsZCh0ZW1wLmNvbnRlbnQuZmlyc3RDaGlsZCk7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgiZGF0YS11c2VyX3NldHRpbmdzIik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gYWRkVG9CbGFja2xpc3QoZGF0YSwgbmFtZSkgewogICAgICAgICAgICAgICAgdmFyIHVjaWQsIGNhbm9uaWNhbDsKICAgICAgICAgICAgICAgIHVjaWQgPSAiIjsKICAgICAgICAgICAgICAgIGNhbm9uaWNhbCA9ICIiOwogICAgICAgICAgICAgICAgaWYgKGRhdGEgIT09ICIiICYmIG5hbWUgIT09ICIiKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuaW5kZXhPZigidXNlci8iKSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBjYW5vbmljYWwgPSBkYXRhLnJlcGxhY2UoL3VzZXJcLy8sICIiKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRhdGEuaW5kZXhPZigiY2hhbm5lbC8iKSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICB1Y2lkID0gZGF0YS5yZXBsYWNlKC9jaGFubmVsXC8vLCAiIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHVzZXJfc2V0dGluZ3MuYmxhY2tsaXN0LnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICB1Y2lkOiB1Y2lkLAogICAgICAgICAgICAgICAgICAgICAgICBjYW5vbmljYWw6IGNhbm9uaWNhbAogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gY2hlY2tCbGFja2xpc3RFbnRyeShkYXRhKSB7CiAgICAgICAgICAgICAgICB2YXIgaSwgdHlwZSwgdmFsdWU7CiAgICAgICAgICAgICAgICBpZiAoZGF0YS5pbmRleE9mKCJ1c2VyLyIpID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBkYXRhLnJlcGxhY2UoL3VzZXJcLy8sICIiKTsKICAgICAgICAgICAgICAgICAgICB0eXBlID0gImNhbm9uaWNhbCI7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRhdGEuaW5kZXhPZigiY2hhbm5lbC8iKSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gZGF0YS5yZXBsYWNlKC9jaGFubmVsXC8vLCAiIik7CiAgICAgICAgICAgICAgICAgICAgdHlwZSA9ICJ1Y2lkIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB1c2VyX3NldHRpbmdzLmJsYWNrbGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLmJsYWNrbGlzdFtpXVt0eXBlXSAhPT0gIiIgJiYgdmFsdWUgPT09IHVzZXJfc2V0dGluZ3MuYmxhY2tsaXN0W2ldW3R5cGVdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiB1cGRhdGVCbGFja2xpc3RNb2RlbCgpIHsKICAgICAgICAgICAgICAgIHZhciBpLCBuZXdfYmxhY2tsaXN0LCBibGFja2xpc3RfZW50cmllczsKICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLmJsYWNrbGlzdC5jb25zdHJ1Y3Rvci5uYW1lID09PSAiQXJyYXkiKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbmV3X2JsYWNrbGlzdCA9IFtdOwogICAgICAgICAgICAgICAgYmxhY2tsaXN0X2VudHJpZXMgPSBPYmplY3Qua2V5cyh1c2VyX3NldHRpbmdzLmJsYWNrbGlzdCk7CiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYmxhY2tsaXN0X2VudHJpZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBuZXdfYmxhY2tsaXN0LnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiB1c2VyX3NldHRpbmdzLmJsYWNrbGlzdFtibGFja2xpc3RfZW50cmllc1tpXV0sCiAgICAgICAgICAgICAgICAgICAgICAgIHVjaWQ6IGJsYWNrbGlzdF9lbnRyaWVzW2ldLAogICAgICAgICAgICAgICAgICAgICAgICBjYW5vbmljYWw6ICIiCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBuZXdfYmxhY2tsaXN0LnNvcnQoZnVuY3Rpb24oYmVmb3JlLCBhZnRlcikge3JldHVybiBiZWZvcmUubmFtZS5sb2NhbGVDb21wYXJlKGFmdGVyLm5hbWUpO30pOwogICAgICAgICAgICAgICAgdXNlcl9zZXR0aW5ncy5ibGFja2xpc3QgPSBuZXdfYmxhY2tsaXN0OwogICAgICAgICAgICAgICAgc2V0KCJibGFja2xpc3QiLCB1c2VyX3NldHRpbmdzLmJsYWNrbGlzdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGFwaSwgY2lkLCBsYW5ndWFnZSwgdXNlcl9zZXR0aW5ncywgcGxheWVyX2luc3RhbmNlLCBkZWZhdWx0X3NldHRpbmdzOwogICAgICAgICAgICBpZiAoaXNNYXRlcmlhbCgpKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2lkID0ge307CiAgICAgICAgICAgIHVzZXJfc2V0dGluZ3MgPSBKU09OLnBhcnNlKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5kYXRhc2V0LnVzZXJfc2V0dGluZ3MgfHwgbnVsbCk7CiAgICAgICAgICAgIGlmIChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuZGF0YXNldC51c2VyX3NldHRpbmdzKSB7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKCJkYXRhLXVzZXJfc2V0dGluZ3MiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBkZWZhdWx0X3NldHRpbmdzID0gewogICAgICAgICAgICAgICAgR0VOX0JUVFJfTlRGICAgIDogdHJ1ZSwKICAgICAgICAgICAgICAgIEdFTl9TVUJfTElTVCAgICA6IHRydWUsCiAgICAgICAgICAgICAgICBHRU5fSU5GX1NDUkwgICAgOiB0cnVlLAogICAgICAgICAgICAgICAgR0VOX0JMVUVfR0xPVyAgIDogdHJ1ZSwKICAgICAgICAgICAgICAgIEdFTl9QUE9UX09OICAgICA6IHRydWUsCiAgICAgICAgICAgICAgICBWSURfRU5EX1NIUkUgICAgOiB0cnVlLAogICAgICAgICAgICAgICAgVklEX0RGTFRfUUxUWSAgIDogImF1dG8iLAogICAgICAgICAgICAgICAgVklEX1BMU1RfQVRQTCAgIDogdHJ1ZSwKICAgICAgICAgICAgICAgIFZJRF9QTFNUX1JWUlMgICA6IHRydWUsCiAgICAgICAgICAgICAgICBWSURfUExSX0FUUEwgICAgOiB0cnVlLAogICAgICAgICAgICAgICAgVklEX1BMUl9BTFZJUyAgIDogdHJ1ZSwKICAgICAgICAgICAgICAgIFZJRF9QTFJfU0laRV9NRU06IHRydWUsCiAgICAgICAgICAgICAgICBWSURfUExSX1ZPTF9MRE4gOiB0cnVlLAogICAgICAgICAgICAgICAgVklEX1BPU1RfVElNRSAgIDogdHJ1ZSwKICAgICAgICAgICAgICAgIFZJRF9WSURfQ05UICAgICA6IHRydWUsCiAgICAgICAgICAgICAgICBWSURfREVTQ19TSFJUICAgOiB0cnVlLAogICAgICAgICAgICAgICAgVklEX1BQT1RfU1ogICAgIDogNTMzLAogICAgICAgICAgICAgICAgVklEX1BMUl9IVE1MNSAgIDogdHJ1ZSwKICAgICAgICAgICAgICAgIEJMS19PTiAgICAgICAgICA6IHRydWUsCiAgICAgICAgICAgICAgICBmbG9hdGVyWCAgICAgICAgOiAyMDAwLAogICAgICAgICAgICAgICAgZmxvYXRlclkgICAgICAgIDogMjAwMCwKICAgICAgICAgICAgICAgIGZpcnN0VGltZSAgICAgICA6IHRydWUsCiAgICAgICAgICAgICAgICB2b2xMZXYgICAgICAgICAgOiA1MCwKICAgICAgICAgICAgICAgIGFkdk9wdHMgICAgICAgICA6IHRydWUsCiAgICAgICAgICAgICAgICBibGFja2xpc3QgICAgICAgOiB7fQogICAgICAgICAgICB9OwogICAgICAgICAgICBsYW5ndWFnZSA9IHsKICAgICAgICAgICAgICAgIFlUU0VUUyAgICAgICAgICAgICAgICA6ICJZb3VUdWJlKyBzZXR0aW5ncyIsCiAgICAgICAgICAgICAgICBBRFZfT1BUUyAgICAgICAgICAgICAgOiAiQWR2YW5jZWQgb3B0aW9ucyIsCiAgICAgICAgICAgICAgICBTVUJfUExTVCAgICAgICAgICAgICAgOiAiUGxheSByZWNlbnQgdXBsb2FkcyIsCiAgICAgICAgICAgICAgICBQUE9UX09QRU4gICAgICAgICAgICAgOiAiT3BlbiBpbiBwb3Atb3V0IiwKICAgICAgICAgICAgICAgIEJMQ0tfQUREICAgICAgICAgICAgICA6ICJBZGQgdG8gYmxhY2tsaXN0IiwKICAgICAgICAgICAgICAgIEJMQ0tfRURJVCAgICAgICAgICAgICA6ICJFZGl0IiwKICAgICAgICAgICAgICAgIEJMQ0tfU0FWRSAgICAgICAgICAgICA6ICJTYXZlIiwKICAgICAgICAgICAgICAgIEJMQ0tfQ0xTRSAgICAgICAgICAgICA6ICJDbG9zZSIsCiAgICAgICAgICAgICAgICBDTlNMX0FQICAgICAgICAgICAgICAgOiAiQXV0b3BsYXkiLAogICAgICAgICAgICAgICAgQ05TTF9SUFQgICAgICAgICAgICAgIDogIlJlcGVhdCB2aWRlbyIsCiAgICAgICAgICAgICAgICBDTlNMX1NWVEggICAgICAgICAgICAgOiAiT3BlbiB0aHVtYm5haWwiLAogICAgICAgICAgICAgICAgQ05TTF9TUyAgICAgICAgICAgICAgIDogIlRha2Ugc2NyZWVuc2hvdCIsCiAgICAgICAgICAgICAgICBDTlNMX1NTX0NMUyAgICAgICAgICAgOiAiQ0xPU0UiLAogICAgICAgICAgICAgICAgQ05TTF9QUE9UICAgICAgICAgICAgIDogIlBvcC1vdXQgdmlkZW8iLAogICAgICAgICAgICAgICAgQ05TTF9GTEJSICAgICAgICAgICAgIDogIkZ1bGxicm93c2VyIG1vZGUiLAogICAgICAgICAgICAgICAgQ05TTF9DSU5NX01EICAgICAgICAgIDogIkNpbmVtYSBtb2RlIiwKICAgICAgICAgICAgICAgIENOU0xfRlJNRSAgICAgICAgICAgICA6ICJGcmFtZSBieSBmcmFtZSAoU2hpZnQgKyDihpAgb3Ig4oaSKSIsCiAgICAgICAgICAgICAgICBDTlNMX1lUU0MgICAgICAgICAgICAgOiAiWW91VHViZSBzaG9ydGN1dHMgbGlzdCIsCiAgICAgICAgICAgICAgICBQTFNUX0FQICAgICAgICAgICAgICAgOiAiQXV0b3BsYXkiLAogICAgICAgICAgICAgICAgUExTVF9SVlJTICAgICAgICAgICAgIDogIlJldmVyc2UiLAogICAgICAgICAgICAgICAgU0hPV19DTVRTICAgICAgICAgICAgIDogIlNob3cgY29tbWVudHMiLAogICAgICAgICAgICAgICAgSElERV9DTVRTICAgICAgICAgICAgIDogIkhpZGUgY29tbWVudHMiLAogICAgICAgICAgICAgICAgR0xCX0lNUFIgICAgICAgICAgICAgIDogIkltcG9ydC9leHBvcnQgc2V0dGluZ3MiLAogICAgICAgICAgICAgICAgR0xCX0xPQ0xfTEFORyAgICAgICAgIDogIkNsaWNrIHRvIGVkaXQgWVQrIGxhbmd1YWdlIiwKICAgICAgICAgICAgICAgIEdMQl9MT0NMX0xBTkdfQ1NUTSAgICA6ICJMb2NhbCIsCiAgICAgICAgICAgICAgICBHTEJfSU1QUl9TQVZFICAgICAgICAgOiAiU2F2ZSBhbmQgbG9hZCIsCiAgICAgICAgICAgICAgICBHTEJfUlNFVCAgICAgICAgICAgICAgOiAiUmVzZXQiLAogICAgICAgICAgICAgICAgR0xCX1JTRVRfQ09ORiAgICAgICAgIDogIlRoaXMgd2lsbCByZXNldCBZVCsgc2V0dGluZ3MgYW5kIHRoZSBibGFja2xpc3Qgd2lsbCBiZSBlcmFzZWQuIERvIHlvdSB3YW50IHRvIGNvbnRpbnVlPyIsCiAgICAgICAgICAgICAgICBHTEJfU1ZFICAgICAgICAgICAgICAgOiAiU2F2ZSIsCiAgICAgICAgICAgICAgICBHTEJfU1ZFX1NFVFMgICAgICAgICAgOiAiU2V0dGluZ3Mgc2F2ZWQiLAogICAgICAgICAgICAgICAgR0xCX1JNQkwgICAgICAgICAgICAgIDogIlJlbW92ZSBmcm9tIGJsYWNrbGlzdCIsCiAgICAgICAgICAgICAgICBGVFJfREVTQyAgICAgICAgICAgICAgOiAiRmluZCBvdXQgd2hhdCB0aGlzIGRvZXMiLAogICAgICAgICAgICAgICAgR0VOICAgICAgICAgICAgICAgICAgIDogIkdlbmVyYWwiLAogICAgICAgICAgICAgICAgVklEICAgICAgICAgICAgICAgICAgIDogIlZpZGVvIiwKICAgICAgICAgICAgICAgIENITiAgICAgICAgICAgICAgICAgICA6ICJDaGFubmVscyIsCiAgICAgICAgICAgICAgICBCTEsgICAgICAgICAgICAgICAgICAgOiAiQmxhY2tsaXN0IiwKICAgICAgICAgICAgICAgIEFCVCAgICAgICAgICAgICAgICAgICA6ICJBYm91dCIsCiAgICAgICAgICAgICAgICBITFAgICAgICAgICAgICAgICAgICAgOiAiSGVscCIsCiAgICAgICAgICAgICAgICBETlQgICAgICAgICAgICAgICAgICAgOiAiRG9uYXRlIiwKICAgICAgICAgICAgICAgIEdFTl9UVEwgICAgICAgICAgICAgICA6ICJHZW5lcmFsIHNldHRpbmdzIiwKICAgICAgICAgICAgICAgIEdFTl9HRU4gICAgICAgICAgICAgICA6ICJHZW5lcmFsIiwKICAgICAgICAgICAgICAgIEdFTl9MWVQgICAgICAgICAgICAgICA6ICJMYXlvdXQiLAogICAgICAgICAgICAgICAgR0VOX0xPQ0xfTEFORyAgICAgICAgIDogIlVzZSBtb2RpZmllZCBZVCsgbGFuZ3VhZ2UiLAogICAgICAgICAgICAgICAgR0VOX1BQT1RfT04gICAgICAgICAgIDogIkVuYWJsZSBwb3Atb3V0IG1vZGUiLAogICAgICAgICAgICAgICAgR0VOX0RTQkxfQURTICAgICAgICAgIDogIkRpc2FibGUgYWR2ZXJ0aXNlbWVudHMgb3V0c2lkZSB0aGUgdmlkZW8gcGFnZSIsCiAgICAgICAgICAgICAgICBHRU5fSU5GX1NDUkwgICAgICAgICAgOiAiRW5hYmxlIGluZmluaXRlIHNjcm9sbCBpbiBmZWVkcyIsCiAgICAgICAgICAgICAgICBHRU5fWVRfTE9HT19MSU5LICAgICAgOiAiWW91VHViZSBsb2dvIHJlZGlyZWN0cyB0byBzdWJzY3JpcHRpb25zIiwKICAgICAgICAgICAgICAgIEdFTl9TVUJfTElTVCAgICAgICAgICA6ICJFbmFibGUgc3Vic2NyaXB0aW9uIHBsYXlsaXN0IiwKICAgICAgICAgICAgICAgIEdFTl9SRU1fQVBVTiAgICAgICAgICA6ICJSZW1vdmUgYXV0b3BsYXkgdXAgbmV4dCIsCiAgICAgICAgICAgICAgICBHRU5fU1BGX09GRiAgICAgICAgICAgOiAiRGlzYWJsZSBTUEYiLAogICAgICAgICAgICAgICAgR0VOX0hJREVfRlRSICAgICAgICAgIDogIkhpZGUgZm9vdGVyIiwKICAgICAgICAgICAgICAgIEdFTl9CTFVFX0dMT1cgICAgICAgICA6ICJSZW1vdmUgYmx1ZSBnbG93IGFyb3VuZCBjbGlja2VkIGJ1dHRvbnMiLAogICAgICAgICAgICAgICAgR0VOX0hERV9SRUNNX1NEQlIgICAgIDogIkhpZGUgcmVjb21tZW5kZWQgY2hhbm5lbHMgc2lkZWJhciIsCiAgICAgICAgICAgICAgICBHRU5fSERFX1NSQ0hfU0RCUiAgICAgOiAiSGlkZSBzZWFyY2ggcmVzdWx0cyBzaWRlYmFyIiwKICAgICAgICAgICAgICAgIEdFTl9IREVfQ0hOX1NEQlIgICAgICA6ICJIaWRlIGNoYW5uZWwgc2lkZWJhciIsCiAgICAgICAgICAgICAgICBHRU5fQ01QVF9UVExTICAgICAgICAgOiAiQ29tcGFjdCB0aXRsZXMgaW4gZmVlZHMiLAogICAgICAgICAgICAgICAgR0VOX0RTQl9IVlJDICAgICAgICAgIDogIkRpc2FibGUgaG92ZXJjYXJkcyIsCiAgICAgICAgICAgICAgICBHRU5fQlRUUl9OVEYgICAgICAgICAgOiAiSW1wcm92ZWQgYmx1ZSBub3RpZmljYXRpb24gYm94IiwKICAgICAgICAgICAgICAgIEdFTl9HUklEX1NVQlMgICAgICAgICA6ICJHcmlkIGxheW91dCBpbiBzdWJzY3JpcHRpb25zIiwKICAgICAgICAgICAgICAgIEdFTl9HUklEX1NSQ0ggICAgICAgICA6ICJHcmlkIGxheW91dCBpbiBzZWFyY2ggcmVzdWx0cyIsCiAgICAgICAgICAgICAgICBWSURfVFRMICAgICAgICAgICAgICAgOiAiVmlkZW8gc2V0dGluZ3MiLAogICAgICAgICAgICAgICAgVklEX1BMUiAgICAgICAgICAgICAgIDogIlBsYXllciBzZXR0aW5ncyIsCiAgICAgICAgICAgICAgICBWSURfUExSX0xZVCAgICAgICAgICAgOiAiUGxheWVyIGxheW91dCIsCiAgICAgICAgICAgICAgICBWSURfREZMVF9RTFRZICAgICAgICAgOiAiRGVmYXVsdCB2aWRlbyBxdWFsaXR5OiIsCiAgICAgICAgICAgICAgICBWSURfREZMVF9RTFRZX0FVVE8gICAgOiAiQXV0byIsCiAgICAgICAgICAgICAgICBWSURfREZMVF9RTFRZX1ROWSAgICAgOiAiMTQ0cCIsCiAgICAgICAgICAgICAgICBWSURfREZMVF9RTFRZX1NNTCAgICAgOiAiMjQwcCIsCiAgICAgICAgICAgICAgICBWSURfREZMVF9RTFRZX01ETSAgICAgOiAiMzYwcCIsCiAgICAgICAgICAgICAgICBWSURfREZMVF9RTFRZX0xSRyAgICAgOiAiNDgwcCIsCiAgICAgICAgICAgICAgICBWSURfREZMVF9RTFRZXzcyMCAgICAgOiAiNzIwcCIsCiAgICAgICAgICAgICAgICBWSURfREZMVF9RTFRZXzEwODAgICAgOiAiMTA4MHAiLAogICAgICAgICAgICAgICAgVklEX0RGTFRfUUxUWV8xNDQwICAgIDogIjE0NDBwIiwKICAgICAgICAgICAgICAgIFZJRF9ERkxUX1FMVFlfMjE2MCAgICA6ICIyMTYwcCAoNGspIiwKICAgICAgICAgICAgICAgIFZJRF9ERkxUX1FMVFlfMjg4MCAgICA6ICIyODgwcCAoNWspIiwKICAgICAgICAgICAgICAgIFZJRF9ERkxUX1FMVFlfT1JJRyAgICA6ICI0MzIwcCAoOGspIiwKICAgICAgICAgICAgICAgIFZJRF9QTFJfQUxWSVMgICAgICAgICA6ICJQbGF5ZXIgYWx3YXlzIHZpc2libGUgd2hlbiByZWFkaW5nIGNvbW1lbnRzIiwKICAgICAgICAgICAgICAgIFZJRF9QTFJfQUxWSVNfV0RUSCAgICA6ICJGbG9hdGluZyBwbGF5ZXIgd2lkdGgiLAogICAgICAgICAgICAgICAgVklEX1BMUl9BTFZJU19NT1ZFICAgIDogIk1vdmUgcGxheWVyIiwKICAgICAgICAgICAgICAgIFZJRF9QTFJfQUxWSVNfU0NSTF9UT1A6ICJHbyB0byB0b3AiLAogICAgICAgICAgICAgICAgVklEX1BMUl9BVFBMICAgICAgICAgIDogIkF1dG9wbGF5IHZpZGVvcyIsCiAgICAgICAgICAgICAgICBWSURfTEFZVCAgICAgICAgICAgICAgOiAiTGF5b3V0IiwKICAgICAgICAgICAgICAgIFZJRF9WSURfQ05UICAgICAgICAgICA6ICJTaG93IGxpbmsgd2l0aCBudW1iZXIgb2YgdXBsb2FkZWQgdmlkZW9zIiwKICAgICAgICAgICAgICAgIFZJRF9QT1NUX1RJTUUgICAgICAgICA6ICJTaG93IGhvdyBsb25nIHRoZSB2aWRlbyBoYXMgYmVlbiBwdWJsaXNoZWQiLAogICAgICAgICAgICAgICAgVklEX0hJREVfREVUTFMgICAgICAgIDogIkhpZGUgdmlkZW8gZGV0YWlscyIsCiAgICAgICAgICAgICAgICBWSURfSElERV9DT01TICAgICAgICAgOiAiQ29tbWVudCBzZWN0aW9uIiwKICAgICAgICAgICAgICAgIFZJRF9ISURFX0NPTVNfU0hPVyAgICA6ICJTaG93IiwKICAgICAgICAgICAgICAgIFZJRF9ISURFX0NPTVNfSElERSAgICA6ICJIaWRlIiwKICAgICAgICAgICAgICAgIFZJRF9ISURFX0NPTVNfUkVNICAgICA6ICJSZW1vdmUiLAogICAgICAgICAgICAgICAgVklEX0VORF9TSFJFICAgICAgICAgIDogIkRpc2FibGUgc2hhcmUgcGFuZWwgd2hlbiB2aWRlbyBlbmRzIiwKICAgICAgICAgICAgICAgIFZJRF9QTFNUICAgICAgICAgICAgICA6ICJQbGF5bGlzdHMiLAogICAgICAgICAgICAgICAgVklEX1BMU1RfQVRQTCAgICAgICAgIDogIkVuYWJsZSBwbGF5bGlzdCBhdXRvcGxheSBjb250cm9sIiwKICAgICAgICAgICAgICAgIFZJRF9QTFNUX1JWUlMgICAgICAgICA6ICJFbmFibGUgcmV2ZXJzZSBwbGF5bGlzdCBjb250cm9sIiwKICAgICAgICAgICAgICAgIFZJRF9QTFJfU0laRV9NRU0gICAgICA6ICJNZW1vcml6ZSBwbGF5ZXIgbW9kZSIsCiAgICAgICAgICAgICAgICBWSURfVk9MX1dIRUVMICAgICAgICAgOiAiQ2hhbmdlIHZvbHVtZSB3aXRoIG1vdXNlIHdoZWVsIiwKICAgICAgICAgICAgICAgIFZJRF9QTFJfVk9MX01FTSAgICAgICA6ICJNZW1vcml6ZSBhdWRpbyB2b2x1bWUiLAogICAgICAgICAgICAgICAgVklEX1BMUl9WT0xfTEROICAgICAgIDogIkRpc2FibGUgWW91VHViZSBsb3VkbmVzcyBub3JtYWxpc2F0aW9uIiwKICAgICAgICAgICAgICAgIFZJRF9QTFJfQURTICAgICAgICAgICA6ICJEaXNhYmxlIGFkdmVydGlzZW1lbnRzIGluIHRoZSB2aWRlbyBwYWdlIiwKICAgICAgICAgICAgICAgIFZJRF9QTFJfQUxBQ1QgICAgICAgICA6ICJQbGF5ZXIgc2hvcnRjdXRzIGFsd2F5cyBhY3RpdmUiLAogICAgICAgICAgICAgICAgVklEX1NVQl9BRFMgICAgICAgICAgIDogIkVuYWJsZSBhZHZlcnRpc2VtZW50cyBvbmx5IGluIHZpZGVvcyBmcm9tIHN1YnNjcmliZWQgY2hhbm5lbHMiLAogICAgICAgICAgICAgICAgVklEX1BMUl9BTlRTICAgICAgICAgIDogIkRpc2FibGUgYW5ub3RhdGlvbnMiLAogICAgICAgICAgICAgICAgVklEX1BMUl9IRlIgICAgICAgICAgIDogIkRpc2FibGUgSEZSICg2MGZwcykiLAogICAgICAgICAgICAgICAgVklEX1BMUl9IVE1MNSAgICAgICAgIDogIlVzZSB0aGUgSFRNTDUgcGxheWVyIHdoZW4gcG9zc2libGUiLAogICAgICAgICAgICAgICAgVklEX1BMUl9DQyAgICAgICAgICAgIDogIkRpc2FibGUgc3VidGl0bGVzIGFuZCBDQyIsCiAgICAgICAgICAgICAgICBWSURfUExSX0lORk8gICAgICAgICAgOiAiRW5hYmxlIGluZm8gYmFyIHdpdGggd2F0Y2ggbGF0ZXIgYnV0dG9uIiwKICAgICAgICAgICAgICAgIFZJRF9QTFJfRklUICAgICAgICAgICA6ICJGaXQgdG8gcGFnZSBpbiB0aGVhdGVyIG1vZGUiLAogICAgICAgICAgICAgICAgVklEX1BMUl9GSVRfV0RUSCAgICAgIDogIkZpdCB0byBwYWdlIG1heCB3aWR0aDoiLAogICAgICAgICAgICAgICAgVklEX1BMUl9EWU5fU0laRSAgICAgIDogIkRpc2FibGUgZHluYW1pYyBwbGF5ZXIgc2l6ZSBpbiBkZWZhdWx0IHZpZXciLAogICAgICAgICAgICAgICAgVklEX0RFU0NfU0hSVCAgICAgICAgIDogIlNob3J0IHZpZGVvIGRlc2NyaXB0aW9uIGJ1dHRvbnMiLAogICAgICAgICAgICAgICAgVklEX1RUTF9DTVBUICAgICAgICAgIDogIkNvbXBhY3QgdGl0bGUgaW4gdmlkZW8gZGVzY3JpcHRpb24iLAogICAgICAgICAgICAgICAgVklEX1BQT1RfU1ogICAgICAgICAgIDogIlBvcC1vdXQgcGxheWVyIHNpemUiLAogICAgICAgICAgICAgICAgVklEX0xBWVRfQVVUT19QTkwgICAgIDogIkF1dG8gZXhwYW5kIHZpZGVvIGRlc2NyaXB0aW9uIiwKICAgICAgICAgICAgICAgIEdFTl9DSE5fREZMVF9QQUdFICAgICA6ICJEZWZhdWx0IGNoYW5uZWwgcGFnZToiLAogICAgICAgICAgICAgICAgR0VOX0NITl9ERkxUX1BBR0VfREZMVDogIkRlZmF1bHQiLAogICAgICAgICAgICAgICAgR0VOX0NITl9ERkxUX1BBR0VfVklEIDogIlZpZGVvcyIsCiAgICAgICAgICAgICAgICBHRU5fQ0hOX0RGTFRfUEFHRV9QTCAgOiAiUGxheWxpc3RzIiwKICAgICAgICAgICAgICAgIEdFTl9DSE5fREZMVF9QQUdFX0NITiA6ICJDaGFubmVscyIsCiAgICAgICAgICAgICAgICBHRU5fQ0hOX0RGTFRfUEFHRV9ESVNDOiAiRGlzY3Vzc2lvbiIsCiAgICAgICAgICAgICAgICBHRU5fQ0hOX0RGTFRfUEFHRV9BQlQgOiAiQWJvdXQiLAogICAgICAgICAgICAgICAgQkxLX1RUTCAgICAgICAgICAgICAgIDogIkJsYWNrbGlzdCBzZXR0aW5ncyIsCiAgICAgICAgICAgICAgICBCTEtfQkxLICAgICAgICAgICAgICAgOiAiQmxhY2tsaXN0IiwKICAgICAgICAgICAgICAgIEJMS19PTiAgICAgICAgICAgICAgICA6ICJFbmFibGUgYmxhY2tsaXN0IiwKICAgICAgICAgICAgICAgIEFCVF9UVEwgICAgICAgICAgICAgICA6ICJJbmZvcm1hdGlvbiBhbmQgdXNlZnVsIGxpbmtzIiwKICAgICAgICAgICAgICAgIEFCVF9USEtTICAgICAgICAgICAgICA6ICJUaGFua3MgdG86IiwKICAgICAgICAgICAgICAgIEFCVF9USEtTX1lFUFBIQSAgICAgICA6ICIsIHdobydzIHdvcmsgaW5zcGlyZWQgdGhlIGNyZWF0aW9uIG9mIHRoaXMgcHJvamVjdCwgd2l0aG91dCB3aG9tIG5vbmUgb2YgdGhpcyB3b3VsZCBleGlzdCB0b2RheS4iLAogICAgICAgICAgICAgICAgQUJUX1RIS1NfVVNFUlNDUklQVCAgIDogIiBmb3IgbWFraW5nIHRoZSB0YXNrIG9mIGRldmVsb3BpbmcgYW5kIHNoaXBwaW5nIHRoaXJkIHBhcnR5IHNvZnR3YXJlIGluY3JlZGlibHkgZWFzaWVyLiIsCiAgICAgICAgICAgICAgICBBQlRfVEhLU19TVEFDS09WICAgICAgOiAiIGZvciBhbGwgb2YgaXRzIHByaWNlbGVzcyBpbmZvcm1hdGlvbiB3aGljaCBncmVhdGx5IGNvbnRyaWJ1dGVzIGZvciBzb2Z0d2FyZSBkZXZlbG9wbWVudC4iLAogICAgICAgICAgICAgICAgQUJUX0lORk8gICAgICAgICAgICAgIDogIk9mZmljaWFsIHBhZ2VzIiwKICAgICAgICAgICAgICAgIEFCVF9MTktfR0hCICAgICAgICAgICA6ICJHaXRIdWIiLAogICAgICAgICAgICAgICAgQUJUX0xOS19HUkZLICAgICAgICAgIDogIkdyZWFzeSBGb3JrIiwKICAgICAgICAgICAgICAgIEFCVF9MTktfT1BOVSAgICAgICAgICA6ICJPcGVuVXNlckpTIiwKICAgICAgICAgICAgICAgIFdMQ00gICAgICAgICAgICAgICAgICA6ICJUaGFuayB5b3UgZm9yIGluc3RhbGxpbmcgWW91VHViZSsiLAogICAgICAgICAgICAgICAgV0xDTVNUUlQgICAgICAgICAgICAgIDogIllvdSBjYW4gY3VzdG9taXplIHlvdXIgc2V0dGluZ3MgYnkgY2xpY2tpbmcgdGhlIGJ1dHRvbiBhYm92ZSIsCiAgICAgICAgICAgICAgICBXTENNRlRSUyAgICAgICAgICAgICAgOiAiQ2xpY2sgaGVyZSB0byBzZWUgYWxsIHRoZSBmZWF0dXJlcyIsCiAgICAgICAgICAgICAgICBMT0NBTEUgICAgICAgICAgICAgICAgOiAiRW5nbGlzaCAoVVMpIgogICAgICAgICAgICB9OwogICAgICAgICAgICBpZiAoIXVzZXJfc2V0dGluZ3MgfHwgT2JqZWN0LmtleXModXNlcl9zZXR0aW5ncykubGVuZ3RoIDwgMSkgewogICAgICAgICAgICAgICAgdXNlcl9zZXR0aW5ncyA9IGRlZmF1bHRfc2V0dGluZ3M7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjaGVja05ld0ZlYXR1cmVzKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHdpbmRvdy5jaHJvbWUpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCJsb2FkIiwgc2NyaXB0RXhpdCwgdHJ1ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJhZnRlcnNjcmlwdGV4ZWN1dGUiLCBzY3JpcHRFeGl0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJzcGZkb25lIiwgbWFpbik7CiAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoInNwZnJlcXVlc3QiLCByZXF1ZXN0KTsKICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigicmVhZHlzdGF0ZWNoYW5nZSIsIG1haW4sIHRydWUpOwogICAgICAgICAgICBYTUxIdHRwUmVxdWVzdC5wcm90b3R5cGUub3BlbiA9IGNoZWNrWEhSKFhNTEh0dHBSZXF1ZXN0LnByb3RvdHlwZS5vcGVuKTsKICAgICAgICAgICAgRE9NUGFyc2VyLnByb3RvdHlwZS5wYXJzZUZyb21TdHJpbmcgPSBjaGVja0RvbVBhcnNlcihET01QYXJzZXIucHJvdG90eXBlLnBhcnNlRnJvbVN0cmluZyk7CiAgICAgICAgICAgIHdpbmRvdy5vbllvdVR1YmVQbGF5ZXJSZWFkeSA9IHNoYXJlQXBpKHdpbmRvdy5vbllvdVR1YmVQbGF5ZXJSZWFkeSk7CiAgICAgICAgICAgIHdpbmRvdy5tYXRjaE1lZGlhID0gbW9kTWF0Y2hNZWRpYSh3aW5kb3cubWF0Y2hNZWRpYSk7CiAgICAgICAgICAgIG1haW4oKTsKICAgICAgICB9LAogICAgICAgIGNvbnRlbnRTY3JpcHRNZXNzYWdlczogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBrZXkxLCBrZXkyLCBnYXRlLCBzZXRzLCBsb2NzLCBvYnNlcnZlcjsKICAgICAgICAgICAga2V5MSA9ICJwYXJzZW5kIjsKICAgICAgICAgICAga2V5MiA9ICJnZXRsb2NhbGUiOwogICAgICAgICAgICBnYXRlID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50OwogICAgICAgICAgICBzZXRzID0gSlNPTi5wYXJzZShnYXRlLmRhdGFzZXRba2V5MV0gfHwgbnVsbCk7CiAgICAgICAgICAgIGxvY3MgPSBnYXRlLmRhdGFzZXRba2V5Ml0gfHwgbnVsbDsKICAgICAgICAgICAgaWYgKCFnYXRlLmNvbnRlbnRzY3JpcHQpIHsKICAgICAgICAgICAgICAgIGdhdGUuY29udGVudHNjcmlwdCA9IHRydWU7CiAgICAgICAgICAgICAgICBvYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKHBhcnRpY2xlLmNvbnRlbnRTY3JpcHRNZXNzYWdlcyk7CiAgICAgICAgICAgICAgICByZXR1cm4gb2JzZXJ2ZXIub2JzZXJ2ZShnYXRlLCB7CiAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlczogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVGaWx0ZXI6IFsiZGF0YS0iICsga2V5MSwgImRhdGEtIiArIGtleTJdCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc2V0cykgewogICAgICAgICAgICAgICAgaWYgKHBhcnRpY2xlLmlzX3VzZXJzY3JpcHQpIHsKICAgICAgICAgICAgICAgICAgICBwYXJ0aWNsZS5HTV9zZXRWYWx1ZShwYXJ0aWNsZS5pZCwgSlNPTi5zdHJpbmdpZnkoc2V0cykpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjaHJvbWUuc3RvcmFnZS5sb2NhbC5zZXQoe3BhcnRpY2xlU2V0dGluZ3M6IHNldHN9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoImRhdGEtcGFyc2VuZCIpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGxvY3MpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5kYXRhc2V0LnNldGxvY2FsZSA9IGNocm9tZS5pMThuLmdldE1lc3NhZ2UobG9jcyk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGZpbHRlckNocm9tZUtleXM6IGZ1bmN0aW9uKGtleXMpIHsKICAgICAgICAgICAgaWYgKGtleXNbcGFydGljbGUuaWRdICYmIGtleXNbcGFydGljbGUuaWRdLm5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmRhdGFzZXQucGFycmVjZWl2ZSA9IEpTT04uc3RyaW5naWZ5KAogICAgICAgICAgICAgICAgICAgIChrZXlzW3BhcnRpY2xlLmlkXS5uZXdfdmFsdWUgJiYga2V5c1twYXJ0aWNsZS5pZF0ubmV3X3ZhbHVlW3BhcnRpY2xlLmlkXSkgfHwga2V5c1twYXJ0aWNsZS5pZF0ubmV3X3ZhbHVlIHx8IHt9CiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBtYWluOiBmdW5jdGlvbihldmVudCkgewogICAgICAgICAgICB2YXIgaG9sZGVyOwogICAgICAgICAgICBpZiAoIWV2ZW50ICYmIHBhcnRpY2xlLmlzX3VzZXJzY3JpcHQpIHsKICAgICAgICAgICAgICAgIGV2ZW50ID0gSlNPTi5wYXJzZShwYXJ0aWNsZS5HTV9nZXRWYWx1ZShwYXJ0aWNsZS5pZCwgInt9IikpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChldmVudCkgewogICAgICAgICAgICAgICAgZXZlbnQgPSBKU09OLnN0cmluZ2lmeShldmVudFtwYXJ0aWNsZS5pZF0gfHwgZXZlbnQpOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmRhdGFzZXQudXNlcl9zZXR0aW5ncyA9IGV2ZW50OwogICAgICAgICAgICAgICAgaWYgKHBhcnRpY2xlLmlzX3VzZXJzY3JpcHQpIHsKICAgICAgICAgICAgICAgICAgICBob2xkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJsaW5rIik7CiAgICAgICAgICAgICAgICAgICAgaG9sZGVyLnJlbCA9ICJzdHlsZXNoZWV0IjsKICAgICAgICAgICAgICAgICAgICBob2xkZXIudHlwZSA9ICJ0ZXh0L2NzcyI7CiAgICAgICAgICAgICAgICAgICAgaG9sZGVyLmhyZWYgPSAiaHR0cHM6Ly9wYXJ0aWNsZWNvcmUuZ2l0aHViLmlvL1BhcnRpY2xlL3N0eWxlc2hlZXRzL1lvdVR1YmVQbHVzLmNzcz92PTEuOS40IjsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuYXBwZW5kQ2hpbGQoaG9sZGVyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGhvbGRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpOwogICAgICAgICAgICAgICAgaG9sZGVyLnRleHRDb250ZW50ID0gIigiICsgcGFydGljbGUuaW5qZWN0ICsgIigiICsgcGFydGljbGUuaXNfdXNlcnNjcmlwdCArICIpKSI7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuYXBwZW5kQ2hpbGQoaG9sZGVyKTsKICAgICAgICAgICAgICAgIGlmICghcGFydGljbGUuaXNfdXNlcnNjcmlwdCkgewogICAgICAgICAgICAgICAgICAgIGNocm9tZS5zdG9yYWdlLm9uQ2hhbmdlZC5hZGRMaXN0ZW5lcihwYXJ0aWNsZS5maWx0ZXJDaHJvbWVLZXlzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgaW5pOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcGFydGljbGUuaWQgPSAicGFydGljbGVTZXR0aW5ncyI7CiAgICAgICAgICAgIHBhcnRpY2xlLmlzX3VzZXJzY3JpcHQgPSB0eXBlb2YgR01faW5mbyA9PT0gIm9iamVjdCI7CiAgICAgICAgICAgIGlmIChwYXJ0aWNsZS5pc191c2Vyc2NyaXB0KSB7CiAgICAgICAgICAgICAgICBwYXJ0aWNsZS5HTV9nZXRWYWx1ZSA9IEdNX2dldFZhbHVlOwogICAgICAgICAgICAgICAgcGFydGljbGUuR01fc2V0VmFsdWUgPSBHTV9zZXRWYWx1ZTsKICAgICAgICAgICAgICAgIHBhcnRpY2xlLm1haW4oKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNocm9tZS5zdG9yYWdlLmxvY2FsLmdldChwYXJ0aWNsZS5pZCwgcGFydGljbGUubWFpbik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcGFydGljbGUuY29udGVudFNjcmlwdE1lc3NhZ2VzKCk7CiAgICAgICAgfQogICAgfTsKICAgIHBhcnRpY2xlLmluaSgpOwp9KCkpOw=="},{"name":"Youtube Best Video Downloader 2","options":{"check_for_updates":true,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_arrayleft":false,"compat_uW_gmonkey":false,"compat_forvarin":false,"noframes":null,"awareOfChrome":false,"run_at":null,"override":{"use_includes":[],"orig_includes":[],"merge_includes":true,"use_matches":[],"orig_matches":["https://www.youtube.com/*"],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null,"orig_connects":[]}},"storage":{"ts":1521543202766,"data":{}},"enabled":true,"position":3,"file_url":"https://greasyfork.org/scripts/19592-youtube-best-video-downloader-2/code/Youtube%20Best%20Video%20Downloader%202.user.js","uuid":"4f9e2c7f-87cf-46e7-86d5-9f6af936ba76","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgWW91dHViZSBCZXN0IFZpZGVvIERvd25sb2FkZXIgMgovLyBAZGVzY3JpcHRpb24gRG93bmxvYWQgZXZlcnkgWW91VHViZSB2aWRlbyB5b3Ugd2FudCBhbmQgeW91IGNhbiBkb3dubG9hZCB0aGVtIGFzIEZ1bGwtSEQgTVA0LCBGTFYsIDNHUCwgTVAzIDE5MmticHMsIE00QSBhbmQgQUFDIGZvcm1hdHMuIEFsc28gdGh1bWJuYWlscyBhbmQgc3VidGl0bGVzIGNhbiBiZSBkb3dubG9hZGVkISBFYXN5ICYgRmFzdCEKLy8gQGhvbWVwYWdlVVJMIGh0dHBzOi8vYnZkMi5ubC8KLy8gQGF1dGhvciBCVkQyCi8vIEB2ZXJzaW9uIDguMDIKLy8gQGRhdGUgMDUtMTAtMjAxNwovLyBAbmFtZXNwYWNlIEJWRDIKLy8gQG1hdGNoIGh0dHBzOi8vd3d3LnlvdXR1YmUuY29tLyoKLy8gQHJlcXVpcmUgaHR0cDovL2NvZGUuanF1ZXJ5LmNvbS9qcXVlcnktMS4xMi40Lm1pbi5qcwovLyBAZ3JhbnQgbm9uZQovLyBAbGljZW5zZSBNSVQgTGljZW5zZQovLyBAaWNvbiBodHRwczovL2J2ZDIubmwvaW1hZ2VzL2ljb242NC5wbmcKLy8gPT0vVXNlclNjcmlwdD09CmZ1bmN0aW9uIGdvKCkgewogICAgc3RhcnQoKTsKICAgIHJlbW92ZWZyYW1lKCk7Cn0KCndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdzcGZkb25lJywgZ28sIGZhbHNlKTsKd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBnbywgZmFsc2UpOwp3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigneXQtbmF2aWdhdGUtZmluaXNoJywgZ28sIGZhbHNlKTsKCmZ1bmN0aW9uIHN0YXJ0KCkgewogICAgZnVuY3Rpb24gaXNNYXRlcmlhbCgpIHsKICAgICAgICB2YXIgdGVtcDsKICAgICAgICB0ZW1wID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigieXRkLWFwcCwgW3NyYyo9J3BvbHltZXInXSxsaW5rW2hyZWYqPSdwb2x5bWVyJ10iKTsKICAgICAgICBpZiAoIXRlbXApIHsgLy8gb2xkIFVJCiAgICAgICAgICAgIHRlbXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZW1wbGF0ZSIpOwogICAgICAgICAgICB0ZW1wLmlubmVySFRNTCA9IC8vCiAgICAgICAgICAgICAgICBgPGRpdiBpZD0nbWF0ZXJpYWwtbm90aWNlJyBzdHlsZT0nYm9yZGVyLXJhZGl1czoycHg7Y29sb3I6I0ZGRjtwYWRkaW5nOjEwcHg7YmFja2dyb3VuZC1jb2xvcjojZmYwMDAwO2JveC1zaGFkb3c6MCAwIDNweCByZ2JhKDAsMCwwLC41KTtmb250LXNpemU6MThweDtwb3NpdGlvbjpmaXhlZDtib3R0b206MjBweDtyaWdodDo1MHB4O3otaW5kZXg6OTk5OTknPgoJCQkJPHN0cm9uZz48aW5zPldBUk5JTkcgOiA8L2lucz48L3N0cm9uZz5CZXN0IFZpZGVvIERvd25sb2FkZXIgMiBpcyA8Qj5Pbmx5IGNvbXBhdGlibGUgd2l0aCB0aGUgbmV3IFlvdVR1YmUgTWF0ZXJpYWwgTGF5b3V0PC9CPjxicj4KCQkJCTxhIGhyZWY9J2h0dHBzOi8veW91dHViZS5jb20vbmV3JyB0YXJnZXQ9J19ibGFuaycgc3R5bGU9J2ZvbnQtd2VpZ2h0OmJvbGQ7Jz5DbGljayBoZXJlPC9hPiB0byBhY3RpdmF0ZSB0aGUgbmV3IFlvdVR1YmUgTWF0ZXJpYWwgTGF5b3V0Ljxicj4KCQkJCTxici8+PGJyLz4KCQkJCTxzcGFuIGlkPSdjbG9zZScgb25jbGljaz0nZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1hdGVyaWFsLW5vdGljZSIpLnJlbW92ZSgpOyByZXR1cm4gZmFsc2U7JyBhbGlnbj0nY2VudGVyJyBTVFlMRT0nZGlzcGxheTpibG9jazt3aWR0aDoxMDBweDtoZWlnaHQ6IDEwMCU7bWFyZ2luOiAwIGF1dG87Jz48c3Ryb25nPjxpbnM+PGEgaHJlZj0iIj4gW1hdIENMT1NFIDwvYT48L2lucz48L3N0cm9uZz48L3NwYW4+CgkJCQk8L2Rpdj5gOwogICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuYXBwZW5kQ2hpbGQodGVtcC5jb250ZW50LmZpcnN0Q2hpbGQpOwogICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKCJkYXRhLXVzZXJfc2V0dGluZ3MiKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgfQogICAgaXNNYXRlcmlhbCgpOwogICAgdmFyIGxhc3R1cmwgPSAiIjsKCiAgICBmdW5jdGlvbiBjaGVjaygpIHsKICAgICAgICBpZiAobG9jYXRpb24uaHJlZiA9PSBsYXN0dXJsKSByZXR1cm47CiAgICAgICAgbGFzdHVybCA9IGxvY2F0aW9uLmhyZWY7CiAgICAgICAgaWYgKGxhc3R1cmwuaW5kZXhPZigid2F0Y2g/dj0iKSkgcmVtb3ZlZnJhbWUoKTsKICAgIH0KICAgIHNldEludGVydmFsKGNoZWNrLCAxMDAwKTsKCiAgICBmdW5jdGlvbiByZW1vdmVmcmFtZSgpIHsKICAgICAgICB2YXIgZnJtX2RpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdFWFRfRElWJyk7CiAgICAgICAgaWYgKGZybV9kaXYpIHsKICAgICAgICAgICAgZnJtX2Rpdi5wYXJlbnRFbGVtZW50LnJlbW92ZUNoaWxkKGZybV9kaXYpOwogICAgICAgIH0KICAgIH0KCiAgICBidmQyX2J0bl9vbmNsaWNrID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmOwogICAgICAgIHZhciB2aWRlb191cmwgPSAnaHR0cHM6Ly9idmQyLm5sLzgvZG93bmxvYWQvP3VybD0nICsgdXJsOwogICAgICAgIGFkZGlmcmFtZSh2aWRlb191cmwsICcyNTAnKTsKICAgIH07CgogICAgZ2V0U3BhbiA9IGZ1bmN0aW9uKHRleHQsIGNsYXNzTmFtZSkgewogICAgICAgIHZhciBfdG4gPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0ZXh0KTsKICAgICAgICB2YXIgc3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKTsKICAgICAgICBzcGFuLmNsYXNzTmFtZSA9IGNsYXNzTmFtZTsKICAgICAgICBzcGFuLmFwcGVuZENoaWxkKF90bik7CiAgICAgICAgcmV0dXJuIHNwYW47CiAgICB9OwoKICAgIGNyZWF0ZUJ1dHRvbiA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBvYmogPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjdG9wLXJvdz4jc3Vic2NyaWJlLWJ1dHRvbicpOwogICAgICAgIGlmIChvYmogIT09IG51bGwpIHsKICAgICAgICAgICAgLy8gY2hlY2sgaWYgdGhlIGJ1dHRvbiBoYXMgYWxyZWFkeSBiZWVuIGNyZWF0ZWQKICAgICAgICAgICAgdmFyIGJ0blJvdyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiZXN0dmQyJyk7CiAgICAgICAgICAgIGlmIChidG5Sb3cgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgIHZhciBiZXN0dmQyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgICAgICAgICBiZXN0dmQyLmlkID0gImJlc3R2ZDIiOwogICAgICAgICAgICAgICAgYmVzdHZkMi5jbGFzc05hbWUgPSAic3R5bGUtc2NvcGUiOwoKICAgICAgICAgICAgICAgIHZhciBidmQyX2J0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgICAgICAgICAgYnZkMl9idG4uY2xhc3NOYW1lID0gInN0eWxlLXNjb3BlIGJ2ZDJfYnRuIjsKCiAgICAgICAgICAgICAgICBidmQyX2J0bi5zdHlsZSA9ICJiYWNrZ3JvdW5kLWNvbG9yOiBncmVlbjsgYm9yZGVyOiBzb2xpZCAycHggZ3JlZW47IGJvcmRlci1yYWRpdXM6IDJweDsgY29sb3I6IHdoaXRlOyBwYWRkaW5nOiAwcHggMTVweDsgZm9udC1zaXplOiAxNHB4OyBjdXJzb3I6cG9pbnRlcjsgaGVpZ2h0OjMzcHg7bWFyZ2luLXJpZ2h0OiA3cHg7bWFyZ2luLXRvcDogN3B4O2xpbmUtaGVpZ2h0OiAzM3B4O2ZvbnQtd2VpZ2h0OiA1MDA7IGRpc3BsYXk6aW5saW5lLWJsb2NrOyI7CgogICAgICAgICAgICAgICAgYnZkMl9idG4uYXBwZW5kQ2hpbGQoZ2V0U3BhbigiRG93bmxvYWQiLCAiIikpOwogICAgICAgICAgICAgICAgYnZkMl9idG4ub25jbGljayA9IGJ2ZDJfYnRuX29uY2xpY2s7CgogICAgICAgICAgICAgICAgb2JqLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGJlc3R2ZDIsIG9iaik7CiAgICAgICAgICAgICAgICBiZXN0dmQyLmFwcGVuZENoaWxkKGJ2ZDJfYnRuKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CgogICAgZnVuY3Rpb24gYWRkaWZyYW1lKHNyYywgaGVpZ2h0KSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdmFyIHBlZ1BsYWNlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dhdGNoLWRlc2NyaXB0aW9uJyk7CiAgICAgICAgICAgIGlmIChwZWdQbGFjZSA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgcGVnUGxhY2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGxheW5hdi12aWRlby1kZXRhaWxzJyk7CiAgICAgICAgICAgICAgICBpZiAocGVnUGxhY2UgPT09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgcGVnUGxhY2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2F0Y2g3LWFjdGlvbi1wYW5lbHMnKTsKICAgICAgICAgICAgICAgIGlmIChwZWdQbGFjZSA9PT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBwZWdQbGFjZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3YXRjaDgtc2Vjb25kYXJ5LWFjdGlvbnMnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgaWZyYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ0VYVF9GUkFNRScpOwogICAgICAgICAgICBpZiAoaWZyYW1lID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICBkaXYgPSBDcmVhdGVJZnJhbWVEaXYoaGVpZ2h0KTsKICAgICAgICAgICAgICAgIGlmcmFtZSA9IENyZWF0ZUlmcmFtZShoZWlnaHQpOwogICAgICAgICAgICAgICAgZGl2LmFwcGVuZENoaWxkKGlmcmFtZSk7CiAgICAgICAgICAgICAgICBlbGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbWFpbj4jaW5mbycpOwogICAgICAgICAgICAgICAgZWxlLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGRpdiwgZWxlLm5leHRTaWJsaW5nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzcmMgKz0gJyZ0eXBlPURvd25sb2FkJzsKICAgICAgICAgICAgc3JjICs9ICcnOwogICAgICAgICAgICBpZnJhbWUuc2V0QXR0cmlidXRlKCJzcmMiLCBzcmMpOwogICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBDcmVhdGVJZnJhbWUoaGVpZ2h0KSB7CiAgICAgICAgaWZyYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaWZyYW1lJyk7CiAgICAgICAgaWZyYW1lLnNldEF0dHJpYnV0ZSgiaWQiLCAiRVhUX0ZSQU1FIik7CiAgICAgICAgaWZyYW1lLnNldEF0dHJpYnV0ZSgid2lkdGgiLCAiNjQwcHgiKTsKICAgICAgICBpZnJhbWUuc2V0QXR0cmlidXRlKCJoZWlnaHQiLCBoZWlnaHQpOwogICAgICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoImJvcmRlciIsICIwIik7CiAgICAgICAgaWZyYW1lLnNldEF0dHJpYnV0ZSgic2Nyb2xsaW5nIiwgIm5vIik7CiAgICAgICAgaWZyYW1lLnNldEF0dHJpYnV0ZSgic3R5bGUiLCAiYm9yZGVyOiAwIG5vbmU7Iik7CiAgICAgICAgaWZyYW1lLnNldEF0dHJpYnV0ZSgic2FuZGJveCIsICJhbGxvdy1zY3JpcHRzIGFsbG93LXBvcHVwcyBhbGxvdy1zYW1lLW9yaWdpbiIpOwogICAgICAgIHJldHVybiBpZnJhbWU7CiAgICB9CgogICAgZnVuY3Rpb24gQ3JlYXRlSWZyYW1lRGl2KGhlaWdodCkgewogICAgICAgIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICBkaXYuc2V0QXR0cmlidXRlKCJpZCIsICJFWFRfRElWIik7CiAgICAgICAgZGl2LnN0eWxlLndpZHRoID0gJzY0MHB4JzsKICAgICAgICBkaXYuc3R5bGUubWFyZ2luID0gJzVweCAwcHggNXB4IDBweCc7CiAgICAgICAgZGl2LnN0eWxlLnBhZGRpbmcgPSAnMHB4JzsKICAgICAgICBkaXYuc3R5bGUuaGVpZ2h0ID0gJzkwcHgnOwogICAgICAgIGRpdi5zdHlsZS5vdmVyZmxvdyA9ICd2aXNpYmxlJzsKICAgICAgICByZXR1cm4gZGl2OwogICAgfQogICAgdmFyIGludGVydmFsQ2hlY2sgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHsKICAgICAgICBjcmVhdGVCdXR0b24oKTsKICAgIH0sIDI1MCk7Cn0="},{"name":"视频站启用html5播放器","options":{"check_for_updates":true,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_arrayleft":false,"compat_uW_gmonkey":false,"compat_forvarin":false,"noframes":null,"awareOfChrome":false,"run_at":null,"override":{"use_includes":[],"orig_includes":["*://pan.baidu.com/*","*://v.qq.com/*","*://v.sports.qq.com/*","*://film.qq.com/*","*://view.inews.qq.com/*","*://news.qq.com/*","*://v.youku.com/v_show/id_*","*://*.tudou.com/v/*","*://v.163.com/*.html*","*://ent.163.com/*.html*","*://news.163.com/*.html*","*://news.163.com/special/*","*://study.163.com/course/*.htm?courseId=*","*://news.sina.com.cn/*","*://video.sina.com.cn/*","*://video.sina.cn/*","*://weibo.com/*","*://*.weibo.com/*","*://*.le.com/*.html*","*://*.lesports.com/*.html*","*://tv.sohu.com/*.shtml*","*://*.tv.sohu.com/*.shtml*","*://film.sohu.com/album/*","*://www.fun.tv/vplay/*","*://m.fun.tv/*","*://www.yy.com/*","*://www.huya.com/*","https://*.douyu.com/*","https://www.panda.tv/*","*://star.longzhu.com/*"],"merge_includes":true,"use_matches":[],"orig_matches":[],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-start","orig_noframes":null,"orig_connects":[]}},"storage":{"ts":1521543244424,"data":{}},"enabled":true,"position":4,"file_url":"https://greasyfork.org/scripts/30545-%E8%A7%86%E9%A2%91%E7%AB%99%E5%90%AF%E7%94%A8html5%E6%92%AD%E6%94%BE%E5%99%A8/code/%E8%A7%86%E9%A2%91%E7%AB%99%E5%90%AF%E7%94%A8html5%E6%92%AD%E6%94%BE%E5%99%A8.user.js","uuid":"7c5a0a33-c9de-44b9-9247-6f76e2c17cb9","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICAgICAg6KeG6aKR56uZ5ZCv55SoaHRtbDXmkq3mlL7lmagKLy8gQGRlc2NyaXB0aW9uICAgICAgaHRtbDXlt6XlhbfnrrEtLTPlpKflip/og70g44CC5ZCv55SoaHRtbDXmkq3mlL7lmajvvJvkuIfog73nvZHpobXlhajlsY/vvJvmt7vliqDlv6vmjbfplK7vvJrlv6vov5vjgIHlv6vpgIDjgIHmmoLlgZwv5pKt5pS+44CB6Z+z6YeP44CB5LiL5LiA6ZuG44CB5YiH5o2iKOe9kemhtSnlhajlsY/jgIHkuIrkuIvluKfjgIHmkq3mlL7pgJ/luqbjgILmlK/mjIHop4bpopHnq5nngrnvvJrkvJgu5Zyf44CBUVHjgIHmlrDmtarjgIHlvq7ljZrjgIHnvZHmmJPop4bpopFb5aix5LmQ44CB5LqR6K++5aCC44CB5paw6Ze7XeOAgeaQnOeLkOOAgeS5kOinhuOAgemjjuihjOOAgeeZvuW6puS6keinhumikeetie+8m+ebtOaSre+8muaWl+mxvOOAgeeGiueMq+OAgVlZ44CB6JmO54mZ44CB6b6Z54+g44CC5Y+v6Ieq5a6a5LmJ56uZ54K5Ci8vIEB2ZXJzaW9uICAgICAgICAgIDAuNzIKLy8gQGhvbWVwYWdlICAgICAgICAgaHR0cDovL2Jicy5rYWZhbi5jbi90aHJlYWQtMjA5MzAxNC0xLTEuaHRtbAovLyBAaW5jbHVkZSAgICAgICAgICAqOi8vcGFuLmJhaWR1LmNvbS8qCi8vIEBpbmNsdWRlICAgICAgICAgICo6Ly92LnFxLmNvbS8qCi8vIEBpbmNsdWRlICAgICAgICAgICo6Ly92LnNwb3J0cy5xcS5jb20vKgovLyBAaW5jbHVkZSAgICAgICAgICAqOi8vZmlsbS5xcS5jb20vKgovLyBAaW5jbHVkZSAgICAgICAgICAqOi8vdmlldy5pbmV3cy5xcS5jb20vKgovLyBAaW5jbHVkZSAgICAgICAgICAqOi8vbmV3cy5xcS5jb20vKgovLyBAaW5jbHVkZSAgICAgICAgICAqOi8vdi55b3VrdS5jb20vdl9zaG93L2lkXyoKLy8gQGluY2x1ZGUgICAgICAgICAgKjovLyoudHVkb3UuY29tL3YvKgovLyBAaW5jbHVkZSAgICAgICAgICAqOi8vdi4xNjMuY29tLyouaHRtbCoKLy8gQGluY2x1ZGUgICAgICAgICAgKjovL2VudC4xNjMuY29tLyouaHRtbCoKLy8gQGluY2x1ZGUgICAgICAgICAgKjovL25ld3MuMTYzLmNvbS8qLmh0bWwqCi8vIEBpbmNsdWRlICAgICAgICAgICo6Ly9uZXdzLjE2My5jb20vc3BlY2lhbC8qCi8vIEBpbmNsdWRlICAgICAgICAgICo6Ly9zdHVkeS4xNjMuY29tL2NvdXJzZS8qLmh0bT9jb3Vyc2VJZD0qCi8vIEBpbmNsdWRlICAgICAgICAgICo6Ly9uZXdzLnNpbmEuY29tLmNuLyoKLy8gQGluY2x1ZGUgICAgICAgICAgKjovL3ZpZGVvLnNpbmEuY29tLmNuLyoKLy8gQGluY2x1ZGUgICAgICAgICAgKjovL3ZpZGVvLnNpbmEuY24vKgovLyBAaW5jbHVkZSAgICAgICAgICAqOi8vd2VpYm8uY29tLyoKLy8gQGluY2x1ZGUgICAgICAgICAgKjovLyoud2VpYm8uY29tLyoKLy8gQGluY2x1ZGUgICAgICAgICAgKjovLyoubGUuY29tLyouaHRtbCoKLy8gQGluY2x1ZGUgICAgICAgICAgKjovLyoubGVzcG9ydHMuY29tLyouaHRtbCoKLy8gQGluY2x1ZGUgICAgICAgICAgKjovL3R2LnNvaHUuY29tLyouc2h0bWwqCi8vIEBpbmNsdWRlICAgICAgICAgICo6Ly8qLnR2LnNvaHUuY29tLyouc2h0bWwqCi8vIEBpbmNsdWRlICAgICAgICAgICo6Ly9maWxtLnNvaHUuY29tL2FsYnVtLyoKLy8gQGluY2x1ZGUgICAgICAgICAgKjovL3d3dy5mdW4udHYvdnBsYXkvKgovLyBAaW5jbHVkZSAgICAgICAgICAqOi8vbS5mdW4udHYvKgovLyBAaW5jbHVkZSAgICAgICAgICAqOi8vd3d3Lnl5LmNvbS8qCi8vIEBpbmNsdWRlICAgICAgICAgICo6Ly93d3cuaHV5YS5jb20vKgovLyBAaW5jbHVkZSAgICAgICAgICBodHRwczovLyouZG91eXUuY29tLyoKLy8gQGluY2x1ZGUgICAgICAgICAgaHR0cHM6Ly93d3cucGFuZGEudHYvKgovLyBAaW5jbHVkZSAgICAgICAgICAqOi8vc3Rhci5sb25nemh1LmNvbS8qCi8vIEBncmFudCAgICAgICAgICAgIHVuc2FmZVdpbmRvdwovLyBAZ3JhbnQgICAgICAgICAgICBHTV9hZGRTdHlsZQovLyBAcnVuLWF0ICAgICAgICAgICBkb2N1bWVudC1zdGFydAovLyBAbmFtZXNwYWNlICBodHRwczovL2dyZWFzeWZvcmsub3JnL3VzZXJzLzcwMzYKLy8gPT0vVXNlclNjcmlwdD09Cid1c2Ugc3RyaWN0JzsKaWYgKHRvcCAhPT0gc2VsZikgcmV0dXJuOwppZiAod2luZG93LmNocm9tZSkKCU5vZGVMaXN0LnByb3RvdHlwZVtTeW1ib2wuaXRlcmF0b3JdID0gSFRNTENvbGxlY3Rpb24ucHJvdG90eXBlW1N5bWJvbC5pdGVyYXRvcl0gPSBBcnJheS5wcm90b3R5cGVbU3ltYm9sLml0ZXJhdG9yXTsKCmNvbnN0IHEgPSBjc3MgPT4gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjc3MpLApkb0NsaWNrID0gZSA9PiB7CglpZiAoZSkgeyBlLmNsaWNrID8gZS5jbGljaygpIDogZS5kaXNwYXRjaEV2ZW50KG5ldyBNb3VzZUV2ZW50KCdjbGljaycpKSB9Owp9LApyMSA9IChyZWdwLCBzKSA9PiByZWdwLnRlc3QocykgJiYgUmVnRXhwLiQxLApmYWtlVUEgPSB1YSA9PiBPYmplY3QuZGVmaW5lUHJvcGVydHkobmF2aWdhdG9yLCAndXNlckFnZW50JywgewoJdmFsdWU6IHVhLAoJd3JpdGFibGU6IGZhbHNlLAoJY29uZmlndXJhYmxlOiBmYWxzZSwKCWVudW1lcmFibGU6IHRydWUKfSksCi8v5Yik5pat5piv5ZCm5Li6RmlyZWZveO+8jOS4lOS9juS6jumHj+WtkOeJiAp1bmRlckZpcmVmb3g1NyA9ICgoKSA9PiB7Cgljb25zdCB4ID0gcjEoL0ZpcmVmb3hcLyhcZCspLywgbmF2aWdhdG9yLnVzZXJBZ2VudCk7CglyZXR1cm4geCAmJiB4IDwgNTc7Cn0pKCksCmdldE1haW5Eb21haW4gPSBob3N0ID0+IHsKCWxldCBhID0gaG9zdC5zcGxpdCgnLicpLAoJaSA9IGEubGVuZ3RoIC0yOwoJaWYgKFsnY29tJywndHYnLCduZXQnLCdvcmcnLCdnb3YnLCdlZHUnXS5pbmNsdWRlcyhhW2ldKSkgaS0tOwoJcmV0dXJuIGFbaV07Cn0sCnVhX3NhbXN1bmcgPSAnTW96aWxsYS81LjAgKExpbnV4OyBVOyBBbmRyb2lkIDQuMC40OyBHVC1JOTMwMCBCdWlsZC9JTU03NkQpIEFwcGxlV2ViS2l0LzUzNC4zMCBWZXJzaW9uLzQuMCBNb2JpbGUgU2FmYXJpLzUzNC4zMCcsCnVhX2Nocm9tZSA9ICdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXT1c2NClBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvNjIuMC4zMjAyLjknLAp1YV9pcGFkMiA9ICdNb3ppbGxhLzUuMCAoaVBhZDsgQ1BVIE9TIDVfMCBsaWtlIE1hYyBPUyBYKSBBcHBsZVdlYktpdC81MzQuNDYgKEtIVE1MLCBsaWtlIEdlY2tvKSBWZXJzaW9uLzUuMSBNb2JpbGUvOUEzMzQgU2FmYXJpLzc1MzQuNDguMyc7CgpjbGFzcyBGdWxsU2NyZWVuIHsKCWNvbnN0cnVjdG9yKHZpZGVvKSB7CgkJdGhpcy5fdmlkZW8gPSB2aWRlbzsKCQljb25zdCBkID0gZG9jdW1lbnQ7CgkJdGhpcy5fZXhpdEZuID0gZC5leGl0RnVsbHNjcmVlbiB8fCBkLndlYmtpdEV4aXRGdWxsc2NyZWVuIHx8IGQubW96Q2FuY2VsRnVsbFNjcmVlbiB8fCBkLm1zRXhpdEZ1bGxzY3JlZW47CgoJCWNvbnN0IGUgPSB2aWRlbzsKCQl0aGlzLl9lbnRlckZuID0gZS5yZXF1ZXN0RnVsbHNjcmVlbiB8fCBlLndlYmtpdFJlcXVlc3RGdWxsU2NyZWVuIHx8IGUubW96UmVxdWVzdEZ1bGxTY3JlZW4gfHwgZS5tc1JlcXVlc3RGdWxsU2NyZWVuOwoJfQoKCXN0YXRpYyBpc0Z1bGwoKSB7CgkJY29uc3QgZCA9IGRvY3VtZW50OwoJCXJldHVybiAhIShkLmZ1bGxzY3JlZW4gfHwgZC53ZWJraXRJc0Z1bGxTY3JlZW4gfHwgZC5tb3pGdWxsU2NyZWVuIHx8CgkJZC5mdWxsc2NyZWVuRWxlbWVudCB8fCBkLndlYmtpdEZ1bGxzY3JlZW5FbGVtZW50IHx8IGQubW96RnVsbFNjcmVlbkVsZW1lbnQpOwoJfQoKCWVudGVyKCkgewoJCXRoaXMuX2VudGVyRm4gJiYgdGhpcy5fZW50ZXJGbi5jYWxsKHRoaXMuX3ZpZGVvKTsKCX0KCglleGl0KCkgewoJCXRoaXMuX2V4aXRGbiAmJiB0aGlzLl9leGl0Rm4uY2FsbChkb2N1bWVudCk7Cgl9CgoJdG9nZ2xlKCkgewoJCUZ1bGxTY3JlZW4uaXNGdWxsKCkgPyB0aGlzLmV4aXQoKSA6IHRoaXMuZW50ZXIoKTsKCX0KfQoKLy/kuIfog73nvZHpobXlhajlsY8s5Luj56CB5Y+C6ICD5LqG77yaaHR0cHM6Ly9naXRodWIuY29tL2dvb3lpZS95a2g1cApjbGFzcyBGdWxsUGFnZSB7Cgljb25zdHJ1Y3Rvcih2aWRlbykgewoJCXRoaXMuX3ZpZGVvID0gdmlkZW87CgkJdGhpcy5fY2hlY2tDb250YWluZXIoKTsKCQlHTV9hZGRTdHlsZShgCgkJCS56LXRvcCB7CgkJCQlwb3NpdGlvbjogcmVsYXRpdmUgIWltcG9ydGFudDsKCQkJCXotaW5kZXg6IDIzMzMzMzMzICFpbXBvcnRhbnQ7CgkJCX0KCQkJLndlYmZ1bGxzY3JlZW4gewoJCQkJZGlzcGxheTogYmxvY2sgIWltcG9ydGFudDsKCQkJCXBvc2l0aW9uOiBmaXhlZCAhaW1wb3J0YW50OwoJCQkJd2lkdGg6IDEwMCUgIWltcG9ydGFudDsKCQkJCWhlaWdodDogMTAwJSAhaW1wb3J0YW50OwoJCQkJdG9wOiAwICFpbXBvcnRhbnQ7CgkJCQlsZWZ0OiAwICFpbXBvcnRhbnQ7CgkJCQliYWNrZ3JvdW5kOiAjMDAwICFpbXBvcnRhbnQ7CgkJCQl6LWluZGV4OiAyMzMzMzMzMyAhaW1wb3J0YW50OwoJCQl9CgkJYCk7Cgl9CgoJX2NoZWNrQ29udGFpbmVyKCkgewoJCWNvbnN0IGUgPSB0aGlzLl92aWRlbzsKCQlpZiAoIXRoaXMuX2NvbnRhaW5lciB8fCB0aGlzLl9jb250YWluZXIgPT09IGUpCgkJCXRoaXMuX2NvbnRhaW5lciA9IEZ1bGxQYWdlLmdldFBsYXllckNvbnRhaW5lcihlKTsKCX0KCglnZXQgY29udGFpbmVyKCkgewoJCXRoaXMuX2NoZWNrQ29udGFpbmVyKCk7CgkJcmV0dXJuIHRoaXMuX2NvbnRhaW5lcjsKCX0KCglzdGF0aWMgZ2V0UGxheWVyQ29udGFpbmVyKHZpZGVvKSB7CgkJbGV0IGQgPSBkb2N1bWVudC5ib2R5LAoJCWUgPSB2aWRlbywKCQlwID0gZS5wYXJlbnROb2RlOwoJCWlmIChwID09PSBkKSByZXR1cm4gZTsKCQljb25zdCB3ID0gcC5jbGllbnRXaWR0aCwKCQloID0gcC5jbGllbnRIZWlnaHQ7CgkJZG8gewoJCQllID0gcDsKCQkJcCA9IGUucGFyZW50Tm9kZTsKCQl9IHdoaWxlIChwICE9PSBkICYmIHAuY2xpZW50V2lkdGggLSB3IDwgNSAmJiBwLmNsaWVudEhlaWdodCAtIGggPCA1KTsKCQkvL2NvbnNvbGUuZGlyeG1sKGUpOwoJCXJldHVybiBlOwoJfQoKCWZpeFZpZXcoKSB7CgkJbGV0IGUgPSB0aGlzLl92aWRlbywgYyA9IHRoaXMuX2NvbnRhaW5lcjsKCQlpZiAoZSA9PT0gYykgcmV0dXJuOwoJCWlmIChlLmNsaWVudFdpZHRoIDwgYy5jbGllbnRXaWR0aCB8fCBlLmNsaWVudEhlaWdodCA8IGMuY2xpZW50SGVpZ2h0KSB7CgkJCWxldCBhID0gW107CgkJCXdoaWxlIChlICE9PSBjKSB7CgkJCQlhLnB1c2goZSk7CgkJCQllID0gZS5wYXJlbnROb2RlOwoJCQl9CgkJCXdoaWxlIChlID0gYS5wb3AoKSkgZS5zdHlsZS53aWR0aCA9IGUuc3R5bGUuaGVpZ2h0ID0gJzEwMCUnOwoJCX0KCX0KCglzdGF0aWMgaXNGdWxsKHZpZGVvKSB7CgkJcmV0dXJuIHdpbmRvdy5pbm5lcldpZHRoIC12aWRlby5jbGllbnRXaWR0aCA8IDUgJiYgd2luZG93LmlubmVySGVpZ2h0IC0gdmlkZW8uY2xpZW50SGVpZ2h0IDwgNTsKCX0KCgl0b2dnbGUoKSB7CgkJY29uc3QgZCA9IGRvY3VtZW50LmJvZHksCgkJc3RhdGUgPSBGdWxsUGFnZS5pc0Z1bGwodGhpcy5jb250YWluZXIpOwoJCWQuc3R5bGUub3ZlcmZsb3cgPSBzdGF0ZSA/ICcnIDogJ2hpZGRlbic7CgkJdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnd2ViZnVsbHNjcmVlbicpOwoKCQlsZXQgcCA9IHRoaXMuY29udGFpbmVyLnBhcmVudE5vZGU7CgkJd2hpbGUgKHAgIT09IGQpIHsKCQkJcC5jbGFzc0xpc3QudG9nZ2xlKCd6LXRvcCcpOwoJCQlwID0gcC5wYXJlbnROb2RlOwoJCX0KCgkJIXN0YXRlICYmIHNldFRpbWVvdXQodGhpcy5maXhWaWV3LmJpbmQodGhpcyksIDkpOwoJfQp9CgpsZXQgX2ZwLCBfZnM7Cgpjb25zdCB7IGhvc3QsIHBhdGhuYW1lOiBwYXRoIH0gPSBsb2NhdGlvbiwKdSA9IGdldE1haW5Eb21haW4oaG9zdCksLy/kuLvln5/lkI0KLy/lrrnlmajvvIznmbvorrDkuovku7blpITnkIbmlrnms5XkuK3nmoTlm57osIMKZXZlbnRzID0gewoJb24obmFtZSwgZm4pIHsKCQl0aGlzW25hbWVdID0gZm47Cgl9Cn0sCmFwcCA9IHsKCWVsOiBudWxsLC8vdmlkZW8KCWlzTGl2ZTogITEsCgl2TGlzdDogbnVsbCwKCWdldFZpZGVvcygpIHsKCQl0aGlzLnZMaXN0ID0gdGhpcy52TGlzdCB8fCBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgndmlkZW8nKTsKCQlpZiAodGhpcy5lbC5vZmZzZXRXaWR0aD4xKSByZXR1cm47CgkJZm9yIChsZXQgZSBvZiB0aGlzLnZMaXN0KSBpZiAoZS5vZmZzZXRXaWR0aD4xKSB7CgkJCWUucGxheWJhY2tSYXRlID0gdGhpcy5lbC5wbGF5YmFja1JhdGU7CgkJCWUudm9sdW1lID0gdGhpcy5lbC52b2x1bWU7CgkJCXRoaXMuZWwgPSBlOwoJCQlicmVhazsKCQl9Cgl9LAoJX2NvbnZlcnRWaWV3KGJ0bikgewoJCWNvbnN0IHMgPSBidG4uc3R5bGUuZGlzcGxheSB8fCBnZXRDb21wdXRlZFN0eWxlKGJ0biwgJycpLmdldFByb3BlcnR5VmFsdWUoJ2Rpc3BsYXknKTsKCQlzID09PSAnbm9uZScgPyBkb0NsaWNrKGJ0bi5uZXh0RWxlbWVudFNpYmxpbmcpIDogZG9DbGljayhidG4pOwoJfSwKCW9uQ2FucGxheShlKSB7CgkJdGhpcy5lbC5vbmNhbnBsYXkgPSBudWxsOwoJCWNvbnNvbGUubG9nKCfohJrmnKxb5ZCv55SoaHRtbDXmkq3mlL7lmahd77yM5LqL5Lu2b25jYW5wbGF5Jyk7CgkJZXZlbnRzLmNhbnBsYXkgJiYgZXZlbnRzLmNhbnBsYXkoKTsKCQl0aGlzLm9sZENhbnBsYXkgJiYgdGhpcy5vbGRDYW5wbGF5KGUpOwoJfSwKCWhvdEtleShlKSB7CgkJLy/liKTmlq1jdHJsLGFsdCxzaGlmdOS4iemUrueKtuaAge+8jOmYsuatoua1j+iniOWZqOW/q+aNt+mUruiiq+WNoOeUqAoJCWlmIChlLmN0cmxLZXkgfHwgZS5hbHRLZXkgfHwgL0lOUFVUfFRFWFRBUkVBLy50ZXN0KGUudGFyZ2V0Lm5vZGVOYW1lKSkKCQkJcmV0dXJuOwoJCWlmIChlLnNoaWZ0S2V5ICYmICFbMTMsMzcsMzldLmluY2x1ZGVzKGUua2V5Q29kZSkpCgkJCXJldHVybjsKCQlpZiAodGhpcy5pc0xpdmUgJiYgWzM3LDM5LDc4LDg4LDY3LDkwXS5pbmNsdWRlcyhlLmtleUNvZGUpKQoJCQlyZXR1cm47CgkJdGhpcy5nZXRWaWRlb3MoKTsKCQl0aGlzLmNoZWNrVUkoKTsKCQljb25zdCB2ID0gdGhpcy5lbDsKCQlsZXQgbjsKCQlzd2l0Y2ggKGUua2V5Q29kZSkgewoJCWNhc2UgMzI6IC8vc3BhY2UKCQkJaWYgKHRoaXMuZGlzYWJsZVNwYWNlKSByZXR1cm47CgkJCXYucGF1c2VkID8gdi5wbGF5KCkgOiB2LnBhdXNlKCk7CgkJCWUucHJldmVudERlZmF1bHQoKTsKCQkJZS5zdG9wUHJvcGFnYXRpb24oKTsKCQkJYnJlYWs7CgkJY2FzZSAzNzogLy9sZWZ0CgkJCW4gPSBlLnNoaWZ0S2V5ID8gLTI3IDogLTU7IC8v5b+r6YCANeenkixzaGlmdOWKoOmAnwoJCWNhc2UgMzk6IC8vcmlnaHQKCQkJbiA9IG4gfHwgKGUuc2hpZnRLZXkgPyAyNyA6IDUpOyAvL+W/q+i/mzXnp5Isc2hpZnTliqDpgJ8KCQkJdi5jdXJyZW50VGltZSArPSBuOwoJCQlicmVhazsKCQljYXNlIDc4OiAvLyBOIOS4i+S4gOmmlgoJCQlkb0NsaWNrKHRoaXMuYnRuTmV4dCk7CgkJCWJyZWFrOwoJCS8vY2FzZSA4MDogLy8gUCDkuIrkuIDpppYKCQljYXNlIDM4OiAvL+WKoOmfs+mHjwoJCQluID0gMC4xOwoJCWNhc2UgNDA6IC8v6ZmN6Z+z6YePCgkJCW4gPSBuIHx8IC0wLjE7CgkJCW4gKz0gdi52b2x1bWU7CgkJCWlmICgwIDw9IG4gJiYgbiA8PSAxKSB2LnZvbHVtZSA9IG47CgkJCWUucHJldmVudERlZmF1bHQoKTsKCQkJYnJlYWs7CgkJY2FzZSAxMzogLy/lhajlsY8KCQkJaWYgKGUuc2hpZnRLZXkpIHsKCQkJCV9mcCA/IF9mcC50b2dnbGUoKSA6IHRoaXMuZnVsbFBhZ2UoKTsKCQkJfSBlbHNlIHsKCQkJCV9mcyA/IF9mcy50b2dnbGUoKSA6IHRoaXMuZnVsbFNjcmVlbigpOwoJCQl9CgkJCWJyZWFrOwoJCWNhc2UgMjc6IC8vZXNjCgkJCWlmIChGdWxsU2NyZWVuLmlzRnVsbCgpKSB7CgkJCQlfZnMgPyBfZnMuZXhpdCgpIDogdGhpcy5mdWxsU2NyZWVuKCk7CgkJCX0gZWxzZSBpZiAoRnVsbFBhZ2UuaXNGdWxsKHYpKSB7CgkJCQlfZnAgPyBfZnAudG9nZ2xlKCkgOiB0aGlzLmZ1bGxQYWdlKCk7CgkJCX0KCQkJYnJlYWs7CgkJY2FzZSA2NzogLy/mjInplK5D77ya5Yqg6YCf5pKt5pS+ICswLjEKCQkJbiA9IDAuMTsKCQljYXNlIDg4OiAvL+aMiemUrljvvJrlh4/pgJ/mkq3mlL4gLTAuMQoJCQluID0gbiB8fCAtMC4xOwoJCQluICs9IHYucGxheWJhY2tSYXRlOwoJCQlpZiAoMCA8IG4gJiYgbiA8PSAxNikgdi5wbGF5YmFja1JhdGUgPSBuOwoJCQlicmVhazsKCQljYXNlIDkwOiAvL+aMiemUrlrvvJrmraPluLjpgJ/luqbmkq3mlL4KCQkJdi5wbGF5YmFja1JhdGUgPSAxOwoJCQlicmVhazsKCQljYXNlIDcwOiAvL+aMiemUrkbvvJrkuIvkuIDluKcKCQkJbiA9IDAuMDM7CgkJY2FzZSA2ODogLy/mjInplK5E77ya5LiK5LiA5binCgkJCW4gPSBuIHx8IC0wLjAzOwoJCQlpZiAoIXYucGF1c2VkKSB2LnBhdXNlKCk7CgkJCXYuY3VycmVudFRpbWUgKz0gbjsKCQl9Cgl9LAoJY2hlY2tVSSgpIHsKCQlpZiAoIXRoaXMud2ViZnVsbENTUykgewoJCQlfZnAgPSBfZnAgfHwgbmV3IEZ1bGxQYWdlKHRoaXMuZWwpOwoJCX0gZWxzZSBpZiAoIXRoaXMuYnRuV0ZTKSB7CgkJCXRoaXMuYnRuV0ZTID0gcSh0aGlzLndlYmZ1bGxDU1MpOwoJCQl0aGlzLmZ1bGxQYWdlID0gKCkgPT4gdGhpcy5fY29udmVydFZpZXcodGhpcy5idG5XRlMpOwoJCX0KCQlpZiAodGhpcy5uZXh0Q1NTICYmICF0aGlzLmJ0bk5leHQpIHRoaXMuYnRuTmV4dCA9IHEodGhpcy5uZXh0Q1NTKTsKCQlpZiAoIXRoaXMuZnVsbENTUykgewoJCQlfZnMgPSBfZnMgfHwgIG5ldyBGdWxsU2NyZWVuKHRoaXMuZWwpOwoJCX0gZWxzZSBpZiAoIXRoaXMuYnRuRlMpIHsKCQkJdGhpcy5idG5GUyA9IHEodGhpcy5mdWxsQ1NTKTsKCQkJdGhpcy5mdWxsU2NyZWVuID0gKCkgPT4gdGhpcy5fY29udmVydFZpZXcodGhpcy5idG5GUyk7CgkJfQoJfSwKCWluaXQoKSB7CgkJY29uc3QgdCA9IHNldEludGVydmFsKCgpID0+IHsKCQkJaWYgKGV2ZW50cy5sb29wKSB7CgkJCQlpZiAoZXZlbnRzLmxvb3AoKSkgZGVsZXRlIGV2ZW50cy5sb29wOwoJCQkJcmV0dXJuOwoJCQl9CgkJCWNvbnN0IHYgPSBxKCd2aWRlbycpOwoJCQlpZiAoIXYpIHJldHVybjsKCQkJY2xlYXJJbnRlcnZhbCh0KTsKCQkJdGhpcy5lbCA9IHY7CgkJCWlmICh2LnJlYWR5U3RhdGUgPCA0KSB7CgkJCQl0aGlzLm9sZENhbnBsYXkgPSB2Lm9uY2FucGxheTsKCQkJCXYub25jYW5wbGF5ID0gdGhpcy5vbkNhbnBsYXkuYmluZCh0aGlzKTsKCQkJfSBlbHNlIHsKCQkJCXRoaXMub25DYW5wbGF5KCk7CgkJCX0KCgkJCWRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLmhvdEtleS5iaW5kKHRoaXMpLCAhMSk7CgkJCXRoaXMuY2hlY2tVSSgpOwoJCQlzZXRUaW1lb3V0KCgpID0+IHsKCQkJCXYuZm9jdXMoKTsKCQkJfSwgMzAwKTsKCQkJZXZlbnRzLmluaXQgJiYgZXZlbnRzLmluaXQoKTsKCQl9LCAzMDApOwoJfQp9OwoKbGV0IHJvdXRlciA9IHsKCXFxKCkgewoJCU9iamVjdC5hc3NpZ24oYXBwLCB7CgkJCWRpc2FibGVTcGFjZTogdHJ1ZSwKCQkJbmV4dENTUzogJy50eHBfYnRuX25leHQnLAoJCQl3ZWJmdWxsQ1NTOiAnLnR4cF9idG5fZmFrZScsCgkJCWZ1bGxDU1M6ICcudHhwX2J0bl9mdWxsc2NyZWVuJywKCQl9KTsKCQlldmVudHMub24oJ2NhbnBsYXknLCBhcHAuZ2V0VmlkZW9zKTsKCQlmYWtlVUEoJ01vemlsbGEvNS4wIChNYWNpbnRvc2g7IEludGVsIE1hYyBPUyBYIDEwXzEwOyBydjo0OC4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzQ4LjAnKTsKCX0sCgl5b3VrdSgpIHsKCQlldmVudHMub24oJ2NhbnBsYXknLCAoKSA9PiB7CgkJCXEoJy55b3VrdS1sYXllci1sb2dvJykucmVtb3ZlKCk7CgkJCWlmIChhcHAuZWwuc3JjLnN0YXJ0c1dpdGgoJ2h0dHAnKSkgYXBwLmdldFZpZGVvcygpOy8v5Yid5aeL5YyWdkxpc3TvvIzml6fniYjnlKhmbHYuanN+5Zyw5Z2A5LulYmxvYjrlvIDlpLQKCQkJLy/kv67mraPkuIvkuIDkuKrmjInpkq7ml6DmlYggeWstdHJpZ2dlci1sYXllcgoJCQljb25zdCBidG4gPSBxKCdidXR0b24uY29udHJvbC1uZXh0LXZpZGVvJyk7CgkJCWlmIChidG4gJiYgYnRuLm9mZnNldFdpZHRoPjEpIHsKCQkJCWxldCBlID0gcSgnLnByb2dyYW0uY3VycmVudCcpOwoJCQkJZSA9IGUgJiYgZS5jbG9zZXN0KCcuaXRlbScpIHx8IHEoJy5pdGVtLmN1cnJlbnQnKTsKCQkJCWUgPSBlLm5leHRTaWJsaW5nOwoJCQkJaWYgKCFlKSByZXR1cm47CgkJCQllID0gZS5xdWVyeVNlbGVjdG9yKCdhJyk7Ly/kuIvkuIDkuKrop4bpopHpk77mjqUKCQkJCWJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGV2ID0+IGUuY2xpY2soKSk7CgkJCQlhcHAuYnRuTmV4dCA9IGU7CgkJCX0KCQl9KTsKCQlhcHAuZnVsbENTUyA9ICcuY29udHJvbC1mdWxsc2NyZWVuLWljb24nOwoJfSwKCXNpbmEoKSB7CgkJZmFrZVVBKHVhX2lwYWQyKTsKCX0sCglsZSgpIHsKCQkvL2ZpcmVmb3ggNTbku6XkuIsg6buR5bGPCgkJLy9pZiAodW5kZXJGaXJlZm94NTcpIHJldHVybiB0cnVlOwoJCWZha2VVQSgnTW96aWxsYS81LjAgKE1hY2ludG9zaDsgSW50ZWwgTWFjIE9TIFggMTBfOV8zKSBBcHBsZVdlYktpdC81MzcuNzUuMTQgVmVyc2lvbi83LjAuMyBTYWZhcmkvNzA0NkExOTRBJyk7CgkJT2JqZWN0LmFzc2lnbihhcHAsIHsKCQkJbmV4dENTUzogJ2Rpdi5odl9pY29fbmV4dCcsCgkJCXdlYmZ1bGxDU1M6ICdzcGFuLmh2X2ljb193ZWJmdWxsc2NyZWVuJywKCQkJZnVsbENTUzogJ3NwYW4uaHZfaWNvX3NjcmVlbicKCQl9KTsKCX0sCglzb2h1KCkgewoJCWZha2VVQSh1YV9zYW1zdW5nKTsKCQlhcHAubmV4dENTUyA9ICdsaS5vbltkYXRhLXZpZF0rbGkgYSc7CgkJYXBwLmZ1bGxDU1MgPSAnZGl2LngtZnMtYnRuJzsKCX0sCglmdW4oKSB7CgkJaWYgKGhvc3Quc3RhcnRzV2l0aCgnbS4nKSkgewoJCQlpZiAoIXBhdGguaW5jbHVkZXMoJ3BsYXknKSkgcmV0dXJuIHRydWU7Ly/pnZ7mkq3mlL7pobXvvIzkuI3miafooYxpbml0KCkKCQkJL15cL1ttdl0vLnRlc3QocGF0aCkgJiYgbG9jYXRpb24uYXNzaWduKHBhdGgucmVwbGFjZSgnLycsICcvaScpICsgbG9jYXRpb24uc2VhcmNoKTsKCQkJYXBwLm5leHRDU1MgPSAnYS5idG4ubmV4dC1idG4nOwoJCQlhcHAuZnVsbENTUyA9ICdhLmJ0bi5mdWxsLWJ0bic7CgkJCUdNX2FkZFN0eWxlKCdkaXYucC1pcC13cmFwe292ZXJmbG93LXk6IGF1dG8gIWltcG9ydGFudDt9Jyk7CgkJCXJldHVybjsKCQl9CgkJbGV0IHZpZCA9IHIxKC9cYnYtKFxkKykvLCBwYXRoKTsKCQlsZXQgbWlkID0gcjEoL1xiZy0oXGQrKS8sIHBhdGgpOwoJCS8v5Ymn6ZuGcGF0aDogL2ltcGxheS/vvIzljZXop4bpopFwYXRoOiAvaXZwbGF5LwoJCWlmICh2aWQpIHsKCQkJbWlkICYmIGxvY2F0aW9uLmFzc2lnbihgLy9tLmZ1bi50di9pbXBsYXkvP21pZD0ke21pZH0mdmlkPSR7dmlkfWApOwoJCQlsb2NhdGlvbi5hc3NpZ24oJy8vbS5mdW4udHYvaXZwbGF5Lz92aWQ9Jyt2aWQpOwoJCX0KCQltaWQgJiYgc2V0VGltZW91dCgoKSA9PiB7CgkJCXZpZCA9IHVuc2FmZVdpbmRvdy52cGxheS52aWRlb2lkOwoJCQl2aWQgJiYgbG9jYXRpb24uYXNzaWduKGAvL20uZnVuLnR2L2ltcGxheS8/bWlkPSR7bWlkfSZ2aWQ9JHt2aWR9YCk7CgkJfSwgOTkpOwoJCXJldHVybiB0cnVlOwoJfQp9Owpyb3V0ZXIubGVzcG9ydHMgPSByb3V0ZXIubGU7CnJvdXRlclsnMTYzJ10gPSByb3V0ZXIuc2luYTsKCmlmICghcm91dGVyW3VdKSB7IC8v55u05pKt56uZ54K5Cglyb3V0ZXIgPSB7CgkJZG91eXUoKSB7CgkJCWV2ZW50cy5vbignbG9vcCcsICgpID0+IHsKCQkJCWNvbnN0IHAgPSB1bnNhZmVXaW5kb3cuX19wbGF5ZXI7CgkJCQlpZiAocCAmJiBwLnN3aXRjaFBsYXllcikgewoJCQkJCXAuc3dpdGNoUGxheWVyKCdoNScpOwoJCQkJCXJldHVybiB0cnVlOwoJCQkJfQoJCQl9KTsKCQkJYXBwLndlYmZ1bGxDU1MgPSAnZGl2W3RpdGxlPSLnvZHpobXlhajlsY8iXSc7CgkJCWFwcC5mdWxsQ1NTID0gJ2Rpdlt0aXRsZT0i56qX5Y+j5YWo5bGPIl0nOwoJCX0sCgkJcGFuZGEoKSB7CgkJCWxvY2FsU3RvcmFnZS5zZXRJdGVtKCdwYW5kYS50di91c2VyL3BsYXllcicsICd7InVzZUg1cGxheWVyIjogdHJ1ZX0nKTsKCQkJYXBwLndlYmZ1bGxDU1MgPSAnLmg1cGxheWVyLWNvbnRyb2wtYmFyLWZ1bGxzY3JlZW4nOwoJCQlhcHAuZnVsbENTUyA9ICcuaDVwbGF5ZXItY29udHJvbC1iYXItYWxsZnVsbHNjcmVlbic7CgkJfSwKCQl5eSgpIHsKCQkJaWYgKCF3aW5kb3cuY2hyb21lKSBmYWtlVUEodWFfY2hyb21lKTsKCQkJYXBwLmZ1bGxDU1MgPSAnLmxpdmVwbGF5ZXJUb29sQmFyLWZ1bGxTY3JlZW5CdG4nOwoJCX0sCgkJaHV5YSgpIHsKCQkJaWYgKCF3aW5kb3cuY2hyb21lKSBmYWtlVUEodWFfY2hyb21lKTsKCQkJYXBwLndlYmZ1bGxDU1MgPSAnLnBsYXllci1mdWxscGFnZS1idG4nOwoJCQlhcHAuZnVsbENTUyA9ICcucGxheWVyLWZ1bGxzY3JlZW4tYnRuJzsKCQl9LAoJCWxvbmd6aHUoKSB7CgkJCWlmICghd2luZG93LmNocm9tZSkgZmFrZVVBKHVhX2Nocm9tZSk7CgkJCWFwcC5mdWxsQ1NTID0gJyNzY3JlZW5fdmsnOwoJCX0KCX07CgoJaWYgKHJvdXRlclt1XSkgYXBwLmlzTGl2ZSA9IHRydWU7Cn0KCnJvdXRlci5iYWlkdSA9IHJvdXRlci53ZWlibyA9ICgpPT57fTsKcm91dGVyW3VdICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShuYXZpZ2F0b3IsICdwbHVnaW5zJywgewoJZ2V0KCkgewoJCXJldHVybiB7IGxlbmd0aDogMCB9OwoJfQp9KTsKaWYgKCFyb3V0ZXJbdV0gfHwgIXJvdXRlclt1XS5jYWxsKG51bGwpKSBhcHAuaW5pdCgpOw=="},{"name":"Resize Image On \"Open image in new tab\"","options":{"check_for_updates":true,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_arrayleft":false,"compat_uW_gmonkey":false,"compat_forvarin":false,"noframes":null,"awareOfChrome":false,"run_at":null,"override":{"use_includes":[],"orig_includes":[],"merge_includes":true,"use_matches":[],"orig_matches":["http://*.googleusercontent.com/*","https://*.googleusercontent.com/*","http://*.media.tumblr.com/*","https://*.media.tumblr.com/*","http://secure.static.tumblr.com/*","https://secure.static.tumblr.com/*","http://*.bp.blogspot.com/*","https://*.bp.blogspot.com/*","http://*.sinaimg.cn/*","https://*.sinaimg.cn/*","http://*.sinaimg.com/*","https://*.sinaimg.com/*","http://*.twimg.com/*","https://*.twimg.com/*","http://*.zhimg.com/*","https://*.zhimg.com/*","http://*.douban.com/view/*","https://*.douban.com/view/*","http://*.doubanio.com/view/*","https://*.doubanio.com/view/*","http://imgsrc.baidu.com/*","https://imgsrc.baidu.com/*","http://imgsrc.bdimg.com/*","https://imgsrc.bdimg.com/*","http://*.hiphotos.baidu.com/*","https://*.hiphotos.baidu.com/*","http://*.hiphotos.bdimg.com/*","https://*.hiphotos.bdimg.com/*","http://imgsa.baidu.com/*","https://imgsa.baidu.com/*","http://imgsa.bdimg.com/*","https://imgsa.bdimg.com/*","http://images.akamai.steamusercontent.com/*","https://images.akamai.steamusercontent.com/*","http://steamuserimages-a.akamaihd.net/*","https://steamuserimages-a.akamaihd.net/*","http://*.artstation.com/*","https://*.artstation.com/*","http://i.ytimg.com/*","https://i.ytimg.com/*","http://*.ggpht.com/*","https://*.ggpht.com/*","http://*.pinimg.com/*","https://*.pinimg.com/*","http://*.hdslb.com/*","https://*.hdslb.com/*"],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-start","orig_noframes":null,"orig_connects":[]}},"storage":{"ts":1521543448312,"data":{}},"enabled":true,"position":5,"file_url":"https://greasyfork.org/scripts/2312-resize-image-on-open-image-in-new-tab/code/Resize%20Image%20On%20%22Open%20image%20in%20new%20tab%22.user.js","uuid":"8f956833-d163-41ed-b831-34ce65d11f97","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgUmVzaXplIEltYWdlIE9uICJPcGVuIGltYWdlIGluIG5ldyB0YWIiCi8vIEBuYW1lOnpoLWNuIOWPs+mUruWcqOaWsOagh+etvuS4reaJk+W8gOWbvueJh+aXtuaYvuekuuacgOS8mOWMluWbvuWDj+i0qOmHjwovLyBAdmVyc2lvbiAgICAwLjUuMzAKLy8gQGRlc2NyaXB0aW9uICBTdXBwb3J0OiBHb29nbGUoRysgYmxvZ3Nwb3QgWW91VHViZSlcVHVtYmxyXFR3aXR0ZXJcU3RlYW0oT25seSB1c2VyIGNvbnRlbnQpXHdlaWJvLmNvbSAoQW5kIG1vcmUuLi4KLy8gQGRlc2NyaXB0aW9uOnpoLWNuIOaUr+aMge+8muiwt+atjChHKyBibG9nc3BvdCBZb3VUdWJlKeOAgVR1bWJscuOAgeaOqOeJueOAgVN0ZWFt44CB5paw5rWq5b6u5Y2a44CB55+l5LmO44CB6LGG55Oj44CB55m+5bqm6LS05ZCnCi8vIEBydW4tYXQgICAgIGRvY3VtZW50LXN0YXJ0Ci8vIEBncmFudCAgICAgIEdNX3htbGh0dHBSZXF1ZXN0Ci8vIEBncmFudCAgICAgIEdNX2Rvd25sb2FkCi8vIEBtYXRjaCAgICAgIGh0dHA6Ly8qLmdvb2dsZXVzZXJjb250ZW50LmNvbS8qCi8vIEBtYXRjaCAgICAgIGh0dHBzOi8vKi5nb29nbGV1c2VyY29udGVudC5jb20vKgovLyBAbWF0Y2ggICAgICBodHRwOi8vKi5tZWRpYS50dW1ibHIuY29tLyoKLy8gQG1hdGNoICAgICAgaHR0cHM6Ly8qLm1lZGlhLnR1bWJsci5jb20vKgovLyBAbWF0Y2ggICAgICBodHRwOi8vc2VjdXJlLnN0YXRpYy50dW1ibHIuY29tLyoKLy8gQG1hdGNoICAgICAgaHR0cHM6Ly9zZWN1cmUuc3RhdGljLnR1bWJsci5jb20vKgovLyBAbWF0Y2ggICAgICBodHRwOi8vKi5icC5ibG9nc3BvdC5jb20vKgovLyBAbWF0Y2ggICAgICBodHRwczovLyouYnAuYmxvZ3Nwb3QuY29tLyoKLy8gQG1hdGNoICAgICAgaHR0cDovLyouc2luYWltZy5jbi8qCi8vIEBtYXRjaCAgICAgIGh0dHBzOi8vKi5zaW5haW1nLmNuLyoKLy8gQG1hdGNoICAgICAgaHR0cDovLyouc2luYWltZy5jb20vKgovLyBAbWF0Y2ggICAgICBodHRwczovLyouc2luYWltZy5jb20vKgovLyBAbWF0Y2ggICAgICBodHRwOi8vKi50d2ltZy5jb20vKgovLyBAbWF0Y2ggICAgICBodHRwczovLyoudHdpbWcuY29tLyoKLy8gQG1hdGNoICAgICAgaHR0cDovLyouemhpbWcuY29tLyoKLy8gQG1hdGNoICAgICAgaHR0cHM6Ly8qLnpoaW1nLmNvbS8qCi8vIEBtYXRjaCAgICAgIGh0dHA6Ly8qLmRvdWJhbi5jb20vdmlldy8qCi8vIEBtYXRjaCAgICAgIGh0dHBzOi8vKi5kb3ViYW4uY29tL3ZpZXcvKgovLyBAbWF0Y2ggICAgICBodHRwOi8vKi5kb3ViYW5pby5jb20vdmlldy8qCi8vIEBtYXRjaCAgICAgIGh0dHBzOi8vKi5kb3ViYW5pby5jb20vdmlldy8qCi8vIEBtYXRjaCAgICAgIGh0dHA6Ly9pbWdzcmMuYmFpZHUuY29tLyoKLy8gQG1hdGNoICAgICAgaHR0cHM6Ly9pbWdzcmMuYmFpZHUuY29tLyoKLy8gQG1hdGNoICAgICAgaHR0cDovL2ltZ3NyYy5iZGltZy5jb20vKgovLyBAbWF0Y2ggICAgICBodHRwczovL2ltZ3NyYy5iZGltZy5jb20vKgovLyBAbWF0Y2ggICAgICBodHRwOi8vKi5oaXBob3Rvcy5iYWlkdS5jb20vKgovLyBAbWF0Y2ggICAgICBodHRwczovLyouaGlwaG90b3MuYmFpZHUuY29tLyoKLy8gQG1hdGNoICAgICAgaHR0cDovLyouaGlwaG90b3MuYmRpbWcuY29tLyoKLy8gQG1hdGNoICAgICAgaHR0cHM6Ly8qLmhpcGhvdG9zLmJkaW1nLmNvbS8qCi8vIEBtYXRjaCAgICAgIGh0dHA6Ly9pbWdzYS5iYWlkdS5jb20vKgovLyBAbWF0Y2ggICAgICBodHRwczovL2ltZ3NhLmJhaWR1LmNvbS8qCi8vIEBtYXRjaCAgICAgIGh0dHA6Ly9pbWdzYS5iZGltZy5jb20vKgovLyBAbWF0Y2ggICAgICBodHRwczovL2ltZ3NhLmJkaW1nLmNvbS8qCi8vIEBtYXRjaCAgICAgIGh0dHA6Ly9pbWFnZXMuYWthbWFpLnN0ZWFtdXNlcmNvbnRlbnQuY29tLyoKLy8gQG1hdGNoICAgICAgaHR0cHM6Ly9pbWFnZXMuYWthbWFpLnN0ZWFtdXNlcmNvbnRlbnQuY29tLyoKLy8gQG1hdGNoICAgICAgaHR0cDovL3N0ZWFtdXNlcmltYWdlcy1hLmFrYW1haWhkLm5ldC8qCi8vIEBtYXRjaCAgICAgIGh0dHBzOi8vc3RlYW11c2VyaW1hZ2VzLWEuYWthbWFpaGQubmV0LyoKLy8gQG1hdGNoICAgICAgaHR0cDovLyouYXJ0c3RhdGlvbi5jb20vKgovLyBAbWF0Y2ggICAgICBodHRwczovLyouYXJ0c3RhdGlvbi5jb20vKgovLyBAbWF0Y2ggICAgICBodHRwOi8vaS55dGltZy5jb20vKgovLyBAbWF0Y2ggICAgICBodHRwczovL2kueXRpbWcuY29tLyoKLy8gQG1hdGNoICAgICAgaHR0cDovLyouZ2dwaHQuY29tLyoKLy8gQG1hdGNoICAgICAgaHR0cHM6Ly8qLmdncGh0LmNvbS8qCi8vIEBtYXRjaCAgICAgIGh0dHA6Ly8qLnBpbmltZy5jb20vKgovLyBAbWF0Y2ggICAgICBodHRwczovLyoucGluaW1nLmNvbS8qCi8vIEBtYXRjaCAgICAgIGh0dHA6Ly8qLmhkc2xiLmNvbS8qCi8vIEBtYXRjaCAgICAgIGh0dHBzOi8vKi5oZHNsYi5jb20vKgovLyBAbmFtZXNwYWNlIGh0dHBzOi8vZ3JlYXN5Zm9yay5vcmcvdXNlcnMvMjY0NgovLyBAY29udHJpYnV0aW9uVVJMIGh0dHA6Ly9jbHNvLnRrL2RvbmF0ZS8KLy8gQGNvbnRyaWJ1dGlvbkFtb3VudCA2LjY2Ci8vIEBjb3B5cmlnaHQgIDIwMTQtMjAxNywgQ0xFCi8vID09L1VzZXJTY3JpcHQ9PQoKdmFyIHVybCA9IGRvY3VtZW50LmxvY2F0aW9uLnRvU3RyaW5nKCk7CnZhciBtID0gbnVsbDsKCmZ1bmN0aW9uIGdldFF1ZXJ5UGFyYW1zKHFzKSB7CiAgICAvL2J5IGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9hLzEwOTk2NzAKICAgIHFzID0gcXMuc3BsaXQoJysnKS5qb2luKCcgJyk7CiAgICB2YXIgcGFyYW1zID0ge30sCiAgICAgICAgdG9rZW5zLAogICAgICAgIHJlID0gL1s/Jl0/KFtePV0rKT0oW14mXSopL2c7CiAgICB3aGlsZSAoKHRva2VucyA9IHJlLmV4ZWMocXMpKSkgewogICAgICAgIHBhcmFtc1tkZWNvZGVVUklDb21wb25lbnQodG9rZW5zWzFdKV0gPSBkZWNvZGVVUklDb21wb25lbnQodG9rZW5zWzJdKTsKICAgIH0KICAgIHJldHVybiBwYXJhbXM7Cn0KCi8vZ29vZ2xlCmlmKCAobSA9IHVybC5tYXRjaCgvXihodHRwcz86XC9cL2xoXGQrXC5nb29nbGV1c2VyY29udGVudFwuY29tXC8uK1wvKShbXlwvXSspKFwvW15cL10rKFwuKGpwZ3xqcGVnfGdpZnxwbmd8Ym1wfHdlYnApKT8pKD86XD8uKyk/JC9pKSkgKSB7CglpZihtWzJdICE9ICJzMCIpIHsKCQlkb2N1bWVudC5sb2NhdGlvbiA9IG1bMV0gKyAiczAiICsgbVszXTsKCX0KfQplbHNlIGlmKCAobSA9IHVybC5tYXRjaCgvXihodHRwcz86XC9cL2xoXGQrXC5nb29nbGV1c2VyY29udGVudFwuY29tXC8uKz0pKC4rKSg/Olw/LispPyQvaSkpICkgewoJaWYobVsyXSAhPSAiczAiKSB7CgkJZG9jdW1lbnQubG9jYXRpb24gPSBtWzFdICsgInMwIjsKCX0KfQplbHNlIGlmKCAobSA9IHVybC5tYXRjaCgvXihodHRwcz86XC9cL1x3K1wuZ2dwaHRcLmNvbVwvLitcLykoW15cL10rKShcL1teXC9dKyhcLihqcGd8anBlZ3xnaWZ8cG5nfGJtcHx3ZWJwKSk/KSg/Olw/LispPyQvaSkpICkgewoJaWYobVsyXSAhPSAiczAiKSB7CgkJZG9jdW1lbnQubG9jYXRpb24gPSBtWzFdICsgInMwIiArIG1bM107Cgl9Cn0KCi8vYmxvZ3Nwb3QKZWxzZSBpZiggKG0gPSB1cmwubWF0Y2goL14oaHR0cHM/OlwvXC9cdytcLmJwXC5ibG9nc3BvdFwuY29tXC8uK1wvKShbXlwvXSspKFwvW15cL10rKFwuKGpwZ3xqcGVnfGdpZnxwbmd8Ym1wfHdlYnApKT8pKD86XD8uKyk/JC9pKSkgKSB7CglpZihtWzJdICE9ICJzMCIpIHsKCQlkb2N1bWVudC5sb2NhdGlvbiA9IG1bMV0gKyAiczAiICsgbVszXTsKCX0KfQoKLy95b3V0dWJlCmVsc2UgaWYoIChtID0gdXJsLm1hdGNoKC9eaHR0cHM/OlwvXC9pXC55dGltZy5jb21cL2FuX3dlYnBcLyhbXlwvXSspXC9cdytcLihqcGd8anBlZ3xnaWZ8cG5nfGJtcHx3ZWJwKShcPy4rKT8kL2kpKSApIHsKCXZhciBhamF4ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CglhamF4Lm9ucmVhZHlzdGF0ZWNoYW5nZT1mdW5jdGlvbigpIHsKCQlpZihhamF4LnN0YXR1cz09MjAwKSB7CgkJCWRvY3VtZW50LmxvY2F0aW9uID0gImh0dHBzOi8vaS55dGltZy5jb20vdmkvIiArIG1bMV0gKyAiL21heHJlc2RlZmF1bHQuanBnIjsKCQl9ZWxzZSBpZihhamF4LnN0YXR1cz09NDA0KSB7CgkJCWRvY3VtZW50LmxvY2F0aW9uID0gImh0dHBzOi8vaS55dGltZy5jb20vdmkvIiArIG1bMV0gKyAiL2hxZGVmYXVsdC5qcGciOwoJCX0KCX07CglhamF4Lm9wZW4oIkhFQUQiLCAiaHR0cHM6Ly9pLnl0aW1nLmNvbS92aS8iICsgbVsxXSArICIvbWF4cmVzZGVmYXVsdC5qcGciLCB0cnVlKTsKCWFqYXguc2VuZCgpOwp9CmVsc2UgaWYoIChtID0gdXJsLm1hdGNoKC9eKGh0dHBzPzpcL1wvaVwueXRpbWcuY29tXC92aVwvW15cL10rXC8pKFx3KykoXC4oanBnfGpwZWd8Z2lmfHBuZ3xibXB8d2VicCkpKFw/LispPyQvaSkpICkgewoJaWYobVsyXSAhPSAibWF4cmVzZGVmYXVsdCIpIHsKCQl2YXIgYWpheCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwoJCWFqYXgub25yZWFkeXN0YXRlY2hhbmdlPWZ1bmN0aW9uKCkgewoJCQlpZihhamF4LnN0YXR1cz09MjAwKSB7CgkJCQlkb2N1bWVudC5sb2NhdGlvbiA9IG1bMV0gKyAibWF4cmVzZGVmYXVsdCIgKyBtWzNdOwoJCQl9ZWxzZSBpZihhamF4LnN0YXR1cz09NDA0KSB7CgkJCQlpZihtWzVdIHx8IG1bMl0gPT09ICJtcWRlZmF1bHQiKQoJCQkJCWRvY3VtZW50LmxvY2F0aW9uID0gbVsxXSArICJocWRlZmF1bHQiICsgbVszXTsKCQkJfQoJCX07CgkJYWpheC5vcGVuKCJIRUFEIiwgbVsxXSArICJtYXhyZXNkZWZhdWx0IiArIG1bM10sIHRydWUpOwoJCWFqYXguc2VuZCgpOwoJfQp9CmVsc2UgaWYoIChtID0gdXJsLm1hdGNoKC9eKGh0dHBzPzpcL1wvXHcrXC5nZ3BodFwuY29tXC8uKyk9KD86W3N8d3xoXSkoXGQrKSguKyk/JC9pKSkgKSB7CglpZiggbVsyXSE9IjAiICl7CgkJZG9jdW1lbnQubG9jYXRpb24gPSBtWzFdICsgIj1zMCI7Cgl9Cn0KCi8vdHVtYmxyCmVsc2UgaWYoIChtID0gdXJsLm1hdGNoKC9eKGh0dHBzPzpcL1wvLitcLnR1bWJsclwuY29tXC9bXlwvXStfKShcZCspKCg/Ol92XGQrKT9cLihqcGd8anBlZ3xnaWZ8cG5nfGJtcHx3ZWJwKSkoPzpcPy4rKT8vaSkpICkgewoJaWYobVsyXTwxMjgwKSB7CgkJdmFyIGFqYXggPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKCQlhamF4Lm9ucmVhZHlzdGF0ZWNoYW5nZT1mdW5jdGlvbigpIHsKCQkJaWYoYWpheC5zdGF0dXM9PTIwMCkgewoJCQkJZG9jdW1lbnQubG9jYXRpb24gPSBtWzFdICsgIjEyODAiICsgbVszXTsKCQkJfQoJCX07CgkJYWpheC5vcGVuKCJIRUFEIiwgbVsxXSsiMTI4MCIrbVszXSwgdHJ1ZSk7CgkJYWpheC5zZW5kKCk7Cgl9Cn0KZWxzZSBpZiggKG0gPSB1cmwubWF0Y2goL14oaHR0cHM/KTpcL1wvLitcLnR1bWJsclwuY29tXC8oLitfKShcdyspKCg/Ol92XGQrKT9cLihqcGd8anBlZ3xnaWZ8cG5nfGJtcHx3ZWJwKSkoPzpcPy4rKT8vaSkpICkgewoJaWYobVszXSE9InJhdyIgKXsKCQkvKgoJCS8vdmFyIHVybHJhdyA9ICJodHRwOi8vZGF0YS50dW1ibHIuY29tLyIgKyBtWzJdICsgInJhdyIgKyBtWzRdOwoJCXZhciB1cmxyYXcgPSBtWzFdICsgIjovL2RhdGEudHVtYmxyLmNvbS8iICsgbVsyXSArICJyYXciICsgbVs0XTsKCQlkb2N1bWVudC5sb2NhdGlvbiA9IHVybHJhdzsKCQkKCQl2YXIgYWpheCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwoJCWFqYXgub25yZWFkeXN0YXRlY2hhbmdlPWZ1bmN0aW9uKCkgewoJCQlpZihhamF4LnN0YXR1cz09MjAwKQoJCQkJZG9jdW1lbnQubG9jYXRpb24gPSB1cmxyYXc7CgkJfTsKCQlhamF4Lm9wZW4oIkhFQUQiLCB1cmxyYXcsIHRydWUpOwoJCWFqYXguc2VuZCgpOwoJCSovCgkJCgkJLy8gTkVFRCBURVNUIChjcm9zcy1kb21haW4gcmVxdWVzdCkKCQl2YXIgdXJscmF3ID0gImh0dHBzOi8vczMuYW1hem9uYXdzLmNvbS9kYXRhLnR1bWJsci5jb20vIiArIG1bMl0gKyAicmF3IiArIG1bNF07CgkJLy9kb2N1bWVudC5sb2NhdGlvbiA9IHVybHJhdzsKCQlHTV94bWxodHRwUmVxdWVzdCh7CgkJCW1ldGhvZDogIkhFQUQiLAoJCQl1cmw6IHVybHJhdywKCQkJb25sb2FkOiBmdW5jdGlvbihyZXMpIHsKCQkJCWlmIChyZXMuc3RhdHVzID09IDIwMCkgewoJCQkJCWRvY3VtZW50LmxvY2F0aW9uID0gdXJscmF3OwoJCQkJfQoJCQl9CgkJfSk7CgkJCgl9Cn0KCi8vdHdpdHRlcgovL2Vsc2UgaWYoIChtID0gdXJsLm1hdGNoKC9eKGh0dHBzPzpcL1wvXHcrXC50d2ltZ1wuY29tXC9tZWRpYVwvKD86W15cLzpdK1wuKD86anBnfGpwZWd8Z2lmfHBuZ3xibXB8d2VicCkpKSg6XHcrKT8oPzpcPy4rKT8kL2kpKSApIHsKLy8JaWYgKCBtWzJdPT09bnVsbCB8fCBtWzJdICE9ICI6b3JpZyIgKQovLwkJZG9jdW1lbnQubG9jYXRpb24gPSBtWzFdICsgIjpvcmlnIjsKLy99CmVsc2UgaWYoIChtID0gdXJsLm1hdGNoKC9eKGh0dHBzPzpcL1wvXHcrXC50d2ltZ1wuY29tXC9tZWRpYVwvW15cLzpdKylcLihqcGd8anBlZ3xnaWZ8cG5nfGJtcHx3ZWJwKSg6XHcrKT8kL2kpKSApIHsKCXZhciBmb3JtYXQgPSBtWzJdOyBpZihtWzJdPT0ianBlZyIpIGZvcm1hdCA9ICJqcGciOwoJZG9jdW1lbnQubG9jYXRpb24gPSBtWzFdICsgIj9mb3JtYXQ9IiArIGZvcm1hdCArICImbmFtZT1vcmlnIjsKfQplbHNlIGlmKCAobSA9IHVybC5tYXRjaCgvXihodHRwcz86XC9cL1x3K1wudHdpbWdcLmNvbVwvLispKFw/LispJC9pKSkgKSB7Cgl2YXIgcGFycyA9IGdldFF1ZXJ5UGFyYW1zKGRvY3VtZW50LmxvY2F0aW9uLnNlYXJjaCk7CglpZighcGFycy5mb3JtYXQgfHwgIXBhcnMubmFtZSkgcmV0dXJuOwoJaWYocGFycy5uYW1lID09ICJvcmlnIikgcmV0dXJuOwoJZG9jdW1lbnQubG9jYXRpb24gPSBtWzFdICsgIj9mb3JtYXQ9IiArIHBhcnMuZm9ybWF0ICsgIiZuYW1lPW9yaWciOwp9CgovL1N0ZWFtIChPbmx5IHVzZXIgY29udGVudCkKZWxzZSBpZiggKG0gPSB1cmwubWF0Y2goL14oaHR0cHM/OlwvXC8oaW1hZ2VzXC5ha2FtYWlcLnN0ZWFtdXNlcmNvbnRlbnRcLmNvbXxzdGVhbXVzZXJpbWFnZXMtYVwuYWthbWFpaGRcLm5ldClcL1teXD9dKylcPy4rJC9pKSkgKXsKCWRvY3VtZW50LmxvY2F0aW9uID0gbVsxXTsKfQoKLy/mgKfmtarlvq7ljZoKZWxzZSBpZiggKG0gPSB1cmwubWF0Y2goL14oaHR0cHM/OlwvXC8oPzooPzp3d3x3eHx3c3x0dmF4fHR2YSlcZCt8d3h0KVwuc2luYWltZ1wuKD86Y258Y29tKVwvKShbXHdcLl0rKShcLy4rKSg/Olw/LispPyQvaSkpICkgewoJaWYobVsyXSAhPSAibGFyZ2UiKSB7CgkJZG9jdW1lbnQubG9jYXRpb24gPSBtWzFdICsgImxhcmdlIiArIG1bM107Cgl9Cn0KCi8vemhpaHUKZWxzZSBpZiggKG0gPSB1cmwubWF0Y2goL14oaHR0cHM/OlwvXC8uK1wuemhpbWdcLmNvbVwvW1x3XC1dK18pKFx3KykoXC4oanBnfGpwZWd8Z2lmfHBuZ3xibXB8d2VicCkpKD86XD8uKyk/JC9pKSkgKXsKCWlmKG1bMl0hPSJyIikgewoJCWRvY3VtZW50LmxvY2F0aW9uID0gbVsxXSArICJyIiArIG1bM107Cgl9Cn0KCi8vZG91YmFuCmVsc2UgaWYoIChtID0gdXJsLm1hdGNoKC9eKGh0dHBzPzpcL1wvXHcrXC5kb3ViYW4oPzppbyk/XC5jb21cL3ZpZXdcLyg/OnBob3RvfGNvbW1vZGl0eV9zdG9yeSlcLykoXHcrKShcL3B1YmxpY1wvLitcLihqcGd8anBlZ3xnaWZ8cG5nfGJtcHx3ZWJwKSkoPzpcPy4rKT8kL2kpKSApewoJaWYobVsyXSAhPSAicmF3Iil7CgkJdmFyIGFqYXggPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKCQlhamF4Lm9ucmVhZHlzdGF0ZWNoYW5nZT1mdW5jdGlvbigpIHsKCQkJaWYoYWpheC5zdGF0dXM9PTIwMCkgewoJCQkJZG9jdW1lbnQubG9jYXRpb24gPSBtWzFdICsgInJhdyIgKyBtWzNdOwoJCQl9ZWxzZSBpZihhamF4LnN0YXR1cz09NDA0KSB7CgkJCQlpZihtWzJdICE9ICJwaG90byIpewoJCQkJCWRvY3VtZW50LmxvY2F0aW9uID0gbVsxXSArICJwaG90byIgKyBtWzNdOwoJCQkJfQoJCQl9CgkJfTsKCQlhamF4Lm9wZW4oIkhFQUQiLCBtWzFdKyJyYXciK21bM10sIHRydWUpOwoJCWFqYXguc2VuZCgpOwoJfQp9CgovL2FydHN0YXRpb24KZWxzZSBpZiggKG0gPSB1cmwubWF0Y2goL14oaHR0cHM/OlwvXC9jZG5cdytcLmFydHN0YXRpb25cLmNvbVwvLitcLykoXGR7NCx9XC8pKFx3KykoXC9bXlwvXSspJC9pKSkgKXsKCWlmKG1bM10gIT0gIm9yaWdpbmFsIil7CgkJdmFyIGFqYXggPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKCQlhamF4Lm9ucmVhZHlzdGF0ZWNoYW5nZT1mdW5jdGlvbigpIHsKCQkJaWYoYWpheC5zdGF0dXM9PTIwMCkgewoJCQkJZG9jdW1lbnQubG9jYXRpb24gPSBtWzFdICsgIm9yaWdpbmFsIiArIG1bNF07CgkJCX1lbHNlIGlmKGFqYXguc3RhdHVzPT00MDQpIHsKCQkJCWlmKG1bM10gIT0gImxhcmdlIil7CgkJCQkJZG9jdW1lbnQubG9jYXRpb24gPSBtWzFdICsgImxhcmdlIiArIG1bNF07CgkJCQl9CgkJCX0KCQl9OwoJCWFqYXgub3BlbigiSEVBRCIsIG1bMV0rIm9yaWdpbmFsIittWzNdLCB0cnVlKTsKCQlhamF4LnNlbmQoKTsKCX0KfQplbHNlIGlmKCAobSA9IHVybC5tYXRjaCgvXihodHRwcz86XC9cL2Nkblx3K1wuYXJ0c3RhdGlvblwuY29tXC8uK1wvKShcdyspKFwvW15cL10rKSQvaSkpICl7CgkvL2lmKG1bMl0gIT0gIm9yaWdpbmFsIikgewoJLy8JZG9jdW1lbnQubG9jYXRpb24gPSBtWzFdICsgIm9yaWdpbmFsIiArIG1bM107CgkvL30KCWlmKG1bMl0gIT0gIm9yaWdpbmFsIil7CgkJdmFyIGFqYXggPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKCQlhamF4Lm9ucmVhZHlzdGF0ZWNoYW5nZT1mdW5jdGlvbigpIHsKCQkJaWYoYWpheC5zdGF0dXM9PTIwMCkgewoJCQkJZG9jdW1lbnQubG9jYXRpb24gPSBtWzFdICsgIm9yaWdpbmFsIiArIG1bM107CgkJCX1lbHNlIGlmKGFqYXguc3RhdHVzPT00MDQpIHsKCQkJCWlmKG1bMl0gIT0gImxhcmdlIil7CgkJCQkJZG9jdW1lbnQubG9jYXRpb24gPSBtWzFdICsgImxhcmdlIiArIG1bM107CgkJCQl9CgkJCX0KCQl9OwoJCWFqYXgub3BlbigiSEVBRCIsIG1bMV0rIm9yaWdpbmFsIittWzNdLCB0cnVlKTsKCQlhamF4LnNlbmQoKTsKCX0KfQoKLy9waW5pbWcKZWxzZSBpZiggKG0gPSB1cmwubWF0Y2goL14oaHR0cHM/OlwvXC9pXC5waW5pbWdcLmNvbVwvKShcdyspKFwvLispJC9pKSkgKXsKCWlmKG1bMl0gIT0gIm9yaWdpbmFscyIpIHsKCQlkb2N1bWVudC5sb2NhdGlvbiA9IG1bMV0gKyAib3JpZ2luYWxzIiArIG1bM107Cgl9Cn0KZWxzZSBpZiggKG0gPSB1cmwubWF0Y2goL14oaHR0cHM/OlwvXC9zLW1lZGlhW1x3LV0rXC5waW5pbWdcLmNvbVwvKShcdyspKFwvLispJC9pKSkgKXsgLy9uZWVkIGRlbGV0ZT8KCWlmKG1bMl0gIT0gIm9yaWdpbmFscyIpIHsKCQlkb2N1bWVudC5sb2NhdGlvbiA9IG1bMV0gKyAib3JpZ2luYWxzIiArIG1bM107Cgl9Cn0KCi8vYmlsaWJpbGkKZWxzZSBpZiggKG0gPSB1cmwubWF0Y2goL14oaHR0cHM/OlwvXC9cdytcLmhkc2xiXC5jb21cLy4rXC4oanBnfGpwZWd8Z2lmfHBuZ3xibXB8d2VicCkpKEB8XykuKyQvaSkpICkgewoJZG9jdW1lbnQubG9jYXRpb24gPSBtWzFdOwp9CgovL+eZvuW6pui0tOWQp++8iOeEtuiAjOWvueS6jueUu+i0qOaPkOWNh+S7gOS5iOeahOW5tuayoeacieS7gOS5iOWNteeUqC4uLu+8iQplbHNlIGlmKCAhKG0gPSB1cmwubWF0Y2goL15odHRwcz86XC9cL2ltZ3NyY1wuYmFpZHVcLmNvbVwvZm9ydW1cL3BpY1wvaXRlbVwvLisvaSkpICl7CglpZiggKG0gPSB1cmwubWF0Y2goL14oaHR0cHM/KTpcL1wvKD86aW1nc3JjfGltZ3NhfFx3K1wuaGlwaG90b3MpXC4oPzpiZGltZ3xiYWlkdSlcLmNvbVwvKD86Zm9ydW18YWxidW0pXC8uK1wvKFx3K1wuKD86anBnfGpwZWd8Z2lmfHBuZ3xibXB8d2VicCkpKD86XD8uKyk/JC9pKSkgKXsKCQlkb2N1bWVudC5sb2NhdGlvbiA9IG1bMV0gKyAiOi8vaW1nc3JjLmJhaWR1LmNvbS9mb3J1bS9waWMvaXRlbS8iICsgbVsyXTsKCX0KfQo="},{"name":"DownAlbum","options":{"check_for_updates":true,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_arrayleft":false,"compat_uW_gmonkey":false,"compat_forvarin":false,"noframes":null,"awareOfChrome":false,"run_at":null,"override":{"use_includes":[],"orig_includes":["htt*://*.facebook.com/*","htt*://*.facebook.com/*/*","htt*://instagram.com/*","htt*://*.instagram.com/*","htt*://twitter.com/*","htt*://weibo.com/*","htt*://www.pinterest.com/*","htt*://www.pinterest.*/*","htt*://ask.fm/*"],"merge_includes":true,"use_matches":[],"orig_matches":[],"merge_matches":true,"use_excludes":[],"orig_excludes":["htt*://*static*.facebook.com*","htt*://*channel*.facebook.com*","htt*://developers.facebook.com/*","htt*://upload.facebook.com/*","htt*://*onnect.facebook.com/*","htt*://*acebook.com/connect*","htt*://*.facebook.com/plugins/*","htt*://*.facebook.com/l.php*","htt*://*.facebook.com/ai.php*","htt*://*.facebook.com/extern/*","htt*://*.facebook.com/pagelet/*","htt*://api.facebook.com/static/*","htt*://*.facebook.com/contact_importer/*","htt*://*.facebook.com/ajax/*","htt*://www.facebook.com/places/map*_iframe.php*","https://www.facebook.com/xti.php","https://*.ak.facebook.com/*","https://www.facebook.com/ajax/pagelet/generic.php/*","https://www.facebook.com/*/plugins/*","https://www.facebook.com/xti.php*"],"merge_excludes":true,"use_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null,"orig_connects":[]}},"storage":{"ts":1521543485674,"data":{}},"enabled":true,"position":6,"file_url":"https://raw.githubusercontent.com/inDream/DownAlbum/master/DownAlbum.user.js","uuid":"91dc4d9c-9432-43b7-b09e-7fa7e41984cd","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICAgRG93bkFsYnVtCi8vIEBhdXRob3IgICAgICAgIGluZHJlYW0KLy8gQHZlcnNpb24gICAgICAgMC4xOC4zLjEKLy8gQGRlc2NyaXB0aW9uICAgRG93bmxvYWQgRmFjZWJvb2sgKEFsYnVtICYgVmlkZW8pLCBJbnN0YWdyYW0sIFBpbnRlcmVzdCwgVHdpdHRlciwgQXNrLmZtLCBXZWlibyBBbGJ1bS4KLy8gQG5hbWVzcGFjZSAgICAgRG93bkFsYnVtCi8vIEB1cGRhdGVVUkwgICAgIGh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9pbkRyZWFtL0Rvd25BbGJ1bS9tYXN0ZXIvRG93bkFsYnVtLm1ldGEuanMKLy8gQGRvd25sb2FkVVJMICAgaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2luRHJlYW0vRG93bkFsYnVtL21hc3Rlci9Eb3duQWxidW0udXNlci5qcwovLyBAZ3JhbnQgICAgICAgICB1bnNhZmVXaW5kb3cKLy8gQGdyYW50ICAgICAgICAgR01feG1saHR0cFJlcXVlc3QKLy8gQGluY2x1ZGUgICAgICAgaHR0KjovLyouZmFjZWJvb2suY29tLyoKLy8gQGluY2x1ZGUgICAgICAgaHR0KjovLyouZmFjZWJvb2suY29tLyovKgovLyBAaW5jbHVkZSAgICAgICBodHQqOi8vaW5zdGFncmFtLmNvbS8qCi8vIEBpbmNsdWRlICAgICAgIGh0dCo6Ly8qLmluc3RhZ3JhbS5jb20vKgovLyBAaW5jbHVkZSAgICAgICBodHQqOi8vdHdpdHRlci5jb20vKgovLyBAaW5jbHVkZSAgICAgICBodHQqOi8vd2VpYm8uY29tLyoKLy8gQGluY2x1ZGUgICAgICAgaHR0KjovL3d3dy5waW50ZXJlc3QuY29tLyoKLy8gQGluY2x1ZGUgICAgICAgaHR0KjovL3d3dy5waW50ZXJlc3QuKi8qCi8vIEBpbmNsdWRlICAgICAgIGh0dCo6Ly9hc2suZm0vKgovLyBAZXhjbHVkZSAgICAgICBodHQqOi8vKnN0YXRpYyouZmFjZWJvb2suY29tKgovLyBAZXhjbHVkZSAgICAgICBodHQqOi8vKmNoYW5uZWwqLmZhY2Vib29rLmNvbSoKLy8gQGV4Y2x1ZGUgICAgICAgaHR0KjovL2RldmVsb3BlcnMuZmFjZWJvb2suY29tLyoKLy8gQGV4Y2x1ZGUgICAgICAgaHR0KjovL3VwbG9hZC5mYWNlYm9vay5jb20vKgovLyBAZXhjbHVkZSAgICAgICBodHQqOi8vKm9ubmVjdC5mYWNlYm9vay5jb20vKgovLyBAZXhjbHVkZSAgICAgICBodHQqOi8vKmFjZWJvb2suY29tL2Nvbm5lY3QqCi8vIEBleGNsdWRlICAgICAgIGh0dCo6Ly8qLmZhY2Vib29rLmNvbS9wbHVnaW5zLyoKLy8gQGV4Y2x1ZGUgICAgICAgaHR0KjovLyouZmFjZWJvb2suY29tL2wucGhwKgovLyBAZXhjbHVkZSAgICAgICBodHQqOi8vKi5mYWNlYm9vay5jb20vYWkucGhwKgovLyBAZXhjbHVkZSAgICAgICBodHQqOi8vKi5mYWNlYm9vay5jb20vZXh0ZXJuLyoKLy8gQGV4Y2x1ZGUgICAgICAgaHR0KjovLyouZmFjZWJvb2suY29tL3BhZ2VsZXQvKgovLyBAZXhjbHVkZSAgICAgICBodHQqOi8vYXBpLmZhY2Vib29rLmNvbS9zdGF0aWMvKgovLyBAZXhjbHVkZSAgICAgICBodHQqOi8vKi5mYWNlYm9vay5jb20vY29udGFjdF9pbXBvcnRlci8qCi8vIEBleGNsdWRlICAgICAgIGh0dCo6Ly8qLmZhY2Vib29rLmNvbS9hamF4LyoKLy8gQGV4Y2x1ZGUgICAgICAgaHR0KjovL3d3dy5mYWNlYm9vay5jb20vcGxhY2VzL21hcCpfaWZyYW1lLnBocCoKLy8gQGV4Y2x1ZGUgICAgICAgaHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3h0aS5waHAKLy8gQGV4Y2x1ZGUgICAgICAgaHR0cHM6Ly8qLmFrLmZhY2Vib29rLmNvbS8qCi8vIEBleGNsdWRlICAgICAgIGh0dHBzOi8vd3d3LmZhY2Vib29rLmNvbS9hamF4L3BhZ2VsZXQvZ2VuZXJpYy5waHAvKgovLyBAZXhjbHVkZSAgICAgICBodHRwczovL3d3dy5mYWNlYm9vay5jb20vKi9wbHVnaW5zLyoKLy8gQGV4Y2x1ZGUgICAgICAgaHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3h0aS5waHAqCi8vIEByZXF1aXJlICAgICAgIGh0dHA6Ly9hamF4Lmdvb2dsZWFwaXMuY29tL2FqYXgvbGlicy9qcXVlcnkvMS9qcXVlcnkubWluLmpzCi8vID09L1VzZXJTY3JpcHQ9PQoKdmFyIEhFTFBFUl9MT0FESU5HID0gZmFsc2U7Cgp2YXIgbG9nID0gZnVuY3Rpb24ocykgewogIHRyeSB7CiAgICBjb25zb2xlLmxvZyhzKTsKICB9IGNhdGNoKGUpIHsKICAgIEdNX2xvZyhzKTsKICB9Cn07Cgp2YXIgZEZBaW5pdCA9IGZ1bmN0aW9uKCl7CiAgdmFyIGhyZWYgPSBsb2NhdGlvbi5ocmVmOwogIHZhciBzaXRlID0gaHJlZi5tYXRjaCgvKGZhY2Vib29rfGluc3RhZ3JhbXx0d2l0dGVyfHBpbnRlcmVzdHx3ZWlibylcLmNvbXxhc2tcLmZtLyk7CiAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNkRkEnKSB8fCAhc2l0ZSkgewogICAgcmV0dXJuOwogIH0KICB2YXIgaywgazIsIGtsYXNzOwogIGlmIChzaXRlWzBdID09ICdpbnN0YWdyYW0uY29tJykgewogICAga2xhc3MgPSBxUygnaGVhZGVyIHNlY3Rpb24gZGl2IHNwYW4gYnV0dG9uJykKICAgIGlmICgha2xhc3MpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAga2xhc3MgPSBrbGFzcy5wYXJlbnROb2RlOwogICAgayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgay5jbGFzc05hbWUgPSBrbGFzcyA/IGtsYXNzLmNsYXNzTmFtZSA6ICcnOwogIH0gZWxzZSB7CiAgICBrID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTsKICB9CiAgazIgPSBrLmNsb25lTm9kZSgpOwogIGsuaW5uZXJIVE1MID0gJzxhIGlkPSJkRkEiIGNsYXNzPSJuYXZTdWJtZW51Ij5Eb3duQWxidW08L2E+JzsKICBrMi5pbm5lckhUTUwgPSAnPGEgaWQ9ImRGQXNldHVwIiBjbGFzcz0ibmF2U3VibWVudSI+RG93bkFsYnVtKFNldHVwKTwvYT4nOwogIHZhciB0ID0gcVMoJy51aUNvbnRleHR1YWxMYXllclBvc2l0aW9uZXJGaXhlZCB1bCcpIHx8IHFTKCcuRHJvcGRvd24gdWwnKSB8fAogICAgcVMoJy5nbl90b3BtZW51bGlzdC5nbl90b3BtZW51bGlzdF9zZXQgdWwnKSB8fCBxUygnLnVpQ29udGV4dHVhbExheWVyIFtyb2xlPSJtZW51Il0nKSB8fAogICAgcVMoJy5tZS5kcm9wZG93biAuZHJvcGRvd24tbWVudScpIHx8IHFTKCdoZWFkZXIgc2VjdGlvbiBkaXYnKTsKICBpZih0KXsKICAgIHQuYXBwZW5kQ2hpbGQoayk7IHQuYXBwZW5kQ2hpbGQoazIpOwogICAgay5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZ1bmN0aW9uKCl7CiAgICAgIGRGQWNvcmUoKTsKICAgIH0pOwogICAgazIuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBmdW5jdGlvbigpewogICAgICBkRkFjb3JlKHRydWUpOwogICAgfSk7CiAgfQogIGlmKGhyZWYuaW5kZXhPZignZmFjZWJvb2suY29tJykgPiAwKXsKICAgIGlmICh0KSB7CiAgICAgIHZhciBwQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTsKICAgICAgcEJ0bi5pbm5lckhUTUwgPSAnPGEgaWQ9InBob3Rvc09mIiBjbGFzcz0ibmF2U3VibWVudSI+W0ZCXSBPcGVuICJQaG90b3Mgb2YiPC9hPic7CiAgICAgIHQuYXBwZW5kQ2hpbGQocEJ0bik7CiAgICAgIHBCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBwaG90b3NPZkhlbHBlcik7CiAgICB9CiAgICBpZighdCAmJiBxUygnI3VzZXJOYXZpZ2F0aW9uLCAjbG9nb3V0TWVudScpKXsKICAgICAgLy8gSGFuZGxlIGFzeW5jIG1lbnUKICAgICAgJCgnI3BhZ2VMb2dpbkFuY2hvciwgI2xvZ291dE1lbnUnKS5vbignY2xpY2suZGZhaW5pdCcsIGZ1bmN0aW9uKCl7CiAgICAgICAgc2V0VGltZW91dChkRkFpbml0LCA1MDApOwogICAgICB9KTsKICAgIH0KICB9ZWxzZSBpZihocmVmLmluZGV4T2YoJ3BpbnRlcmVzdCcpID4gMCl7CiAgICBpZighcVMoJyNkZmFCdXR0b24nKSl7CiAgICAgIHZhciB0ID0gcVMoJy5pbmZvQmFyIC5wdWxsLXJpZ2h0LCAuaGVhZGVyQ29udGFpbmVyLCAuY2VudGVyZWRXaXRoaW5XcmFwcGVyJyk7CiAgICAgIGtsYXNzID0gJ0J1dHRvbiBib2FyZEZvbGxvd1VuZm9sbG93QnV0dG9uJzsKICAgICAgdC5pbm5lckhUTUwgKz0gJzxidXR0b24gaWQ9ImRmYUJ1dHRvbiIgY2xhc3M9IicgKyBrbGFzcyArICciPjxzcGFuIGNsYXNzPSJidXR0b25UZXh0Ij5Eb3duQWxidW08L3NwYW4+PC9idXR0b24+PGJ1dHRvbiBpZD0iZGZhU2V0QnV0dG9uIiBjbGFzcz0iJyArIGtsYXNzICsgJyI+PHNwYW4gY2xhc3M9ImJ1dHRvblRleHQiPkRvd25BbGJ1bShTZXR1cCk8L3NwYW4+PC9idXR0b24+JzsKICAgICAgcVMoJyNkZmFCdXR0b24nKS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZ1bmN0aW9uKCl7CiAgICAgICAgZEZBY29yZSgpOwogICAgICB9KTsKICAgICAgcVMoJyNkZmFTZXRCdXR0b24nKS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZ1bmN0aW9uKCl7CiAgICAgICAgZEZBY29yZSh0cnVlKTsKICAgICAgfSk7CiAgICB9CiAgfWVsc2UgaWYoaHJlZi5pbmRleE9mKCdhc2suZm0nKSA+IDApewogICAgayA9IHFTKCcucHJvZmlsZUJ1dHRvbicpLnBhcmVudE5vZGU7CiAgICBpZiAoaykgewogICAgICBrLmlubmVySFRNTCArPSAnPGEgY2xhc3M9ImxpbmstZ3JlZW4iIG9uQ2xpY2s9ImRGQWNvcmUoKTsiPkRvd25BbGJ1bTwvYT4nICsgCiAgICAgICAgJzxhIGNsYXNzPSJsaW5rLWdyZWVuIiBvbkNsaWNrPSJkRkFjb3JlKHRydWUpOyI+RG93bkFsYnVtKFNldHVwKTwvYT4nOwogICAgfSBlbHNlIHsKICAgICAgc2V0VGltZW91dChkRkFpbml0LCAzMDApOwogICAgfQogIH0KICBpZiAobG9jYXRpb24uaG9zdC5tYXRjaCgvaW5zdGFncmFtLmNvbXxmYWNlYm9vay5jb20vKSkgewogICAgdmFyIG8gPSB3aW5kb3cuV2ViS2l0TXV0YXRpb25PYnNlcnZlciB8fCB3aW5kb3cuTXV0YXRpb25PYnNlcnZlcjsKICAgIGlmIChvICYmICF3aW5kb3cuYWRkZWRPYnNlcnZlcikgewogICAgICB3aW5kb3cuYWRkZWRPYnNlcnZlciA9IHRydWU7CiAgICAgIHZhciBvYnNlcnZlciA9IG5ldyBvKHJ1bkxhdGVyKTsKICAgICAgb2JzZXJ2ZXIub2JzZXJ2ZShkb2N1bWVudC5ib2R5LCB7c3VidHJlZTogdHJ1ZSwgY2hpbGRMaXN0OiB0cnVlfSk7CiAgICAgIHJ1bkxhdGVyKCk7CiAgICB9CiAgfQp9OwpmdW5jdGlvbiBydW5MYXRlcigpIHsKICBpZiAoSEVMUEVSX0xPQURJTkcpIHsKICAgIHJldHVybjsKICB9CiAgY2xlYXJUaW1lb3V0KHdpbmRvdy5hZGRMaW5rVGltZXIpOwogIHdpbmRvdy5hZGRMaW5rVGltZXIgPSBzZXRUaW1lb3V0KGFkZExpbmssIDMwMCk7Cn0KZnVuY3Rpb24gYWRkTGluaygpIHsKICBkRkFpbml0KCk7CiAgaWYgKGxvY2F0aW9uLmhvc3QubWF0Y2goL2luc3RhZ3JhbS5jb20vKSkgewogICAgdmFyIGsgPSBxU0EoJ2FydGljbGU+ZGl2Om50aC1vZi10eXBlKDEpLCBoZWFkZXI+ZGl2Om50aC1vZi10eXBlKDEpJyk7CiAgICBmb3IodmFyIGkgPSAwOyBpPGsubGVuZ3RoOyBpKyspewogICAgICBpZiAoa1tpXS5uZXh0RWxlbWVudFNpYmxpbmcpIHsKICAgICAgICBfYWRkTGluayhrW2ldLCBrW2ldLm5leHRFbGVtZW50U2libGluZyk7CiAgICAgIH0KICAgIH0KICAgIHZhciBrID0gcVNBKCdoZWFkZXInKTsKICAgIGZvcih2YXIgaSA9IDA7IGk8ay5sZW5ndGg7IGkrKyl7CiAgICAgIF9hZGRMaW5rKGtbaV0sIGtbaV0pOwogICAgfQogIH0gZWxzZSBpZiAobG9jYXRpb24uaG9zdC5tYXRjaCgvZmFjZWJvb2suY29tLykpIHsKICAgIGFkZFZpZGVvTGluaygpOwogIH0KfQoKZnVuY3Rpb24gX2FkZExpbmsoaywgdGFyZ2V0LCBhbGJ1bSkgewogIHZhciBpc1Byb2ZpbGUgPSAoay50YWdOYW1lID09ICdIRUFERVInIHx8IGsucGFyZW50Tm9kZS50YWdOYW1lID09ICdIRUFERVInKTsKICB2YXIgdFBhcmVudCA9IHRhcmdldC5wYXJlbnROb2RlOwogIGlmICh0UGFyZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2ltZycpLmxlbmd0aCA+IDIpIHsKICAgIHJldHVybjsKICB9CiAgdmFyIHQgPSBrLnF1ZXJ5U2VsZWN0b3IoJ2ltZywgdmlkZW8nKTsKICBpZiAodCkgewogICAgdmFyIHNyYyA9IHQuZ2V0QXR0cmlidXRlKCdzcmMnKTsKICAgIGlmICghc3JjKSB7CiAgICAgIHJldHVybiBzZXRUaW1lb3V0KGFkZExpbmssIDMwMCk7CiAgICB9CiAgICBzcmMgPSBwYXJzZUZiU3JjKHNyYyk7CiAgICBpZiAocVMoJy5kTGluayBbaHJlZj0iJyArIHNyYyArICciXScpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHZhciBuZXh0ID0gaXNQcm9maWxlID8gdGFyZ2V0LnF1ZXJ5U2VsZWN0b3IoJy5kTGluaycpIDogCiAgICAgIHRhcmdldC5uZXh0RWxlbWVudFNpYmxpbmc7CiAgICBpZiAobmV4dCAmJiAhYWxidW0pIHsKICAgICAgaWYgKG5leHQuY2hpbGROb2Rlc1swXSAmJgogICAgICAgIG5leHQuY2hpbGROb2Rlc1swXS5nZXRBdHRyaWJ1dGUoJ2hyZWYnKSA9PSBzcmMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0gZWxzZSB7CiAgICAgICAgKGlzUHJvZmlsZSA/IHRhcmdldCA6IHRQYXJlbnQpLnJlbW92ZUNoaWxkKG5leHQpOwogICAgICB9CiAgICB9CiAgfQogIHZhciBhbGJ1bUJ0biA9IGxvY2F0aW9uLnBhdGhuYW1lLmluZGV4T2YoJy9wJykgPT09IDAgPwogICAgay5xdWVyeVNlbGVjdG9yKCcuY29yZVNwcml0ZVJpZ2h0Q2hldnJvbicpIDogZmFsc2U7CiAgaWYgKHQgJiYgc3JjKSB7CiAgICB2YXIgbGluayA9IGFsYnVtID8gYWxidW0gOiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIGxpbmsuY2xhc3NOYW1lID0gJ2RMaW5rJzsKICAgIGxpbmsuc3R5bGUubWF4V2lkdGggPSAnMjAwcHgnOwogICAgdmFyIHRpdGxlID0gJyhwcm92aWRlZCBieSBEb3duQWxidW0pJzsKICAgIHZhciBodG1sID0gJzxhIGhyZWY9IicgKyBzcmMgKyAnIiBkb3dubG9hZCB0aXRsZT0iJyArIHRpdGxlICsgJyI+RG93bmxvYWQnOwogICAgdmFyIG51bSA9ICcnOwogICAgaWYgKGFsYnVtIHx8IGFsYnVtQnRuKSB7CiAgICAgIG51bSA9IGxpbmsuaW5uZXJIVE1MLm1hdGNoKC9cLmpwZy9nKTsKICAgICAgbnVtID0gJyAjJyArIChudW0gPyBudW0ubGVuZ3RoICsgMSA6IDEpOwogICAgfQogICAgaWYgKHNyYy5tYXRjaCgnbXA0JykpIHsKICAgICAgdmFyIHBvc3RlciA9IHQuZ2V0QXR0cmlidXRlKCdwb3N0ZXInKTsKICAgICAgaHRtbCArPSAnIFZpZGVvJyArIG51bSArICc8L2E+PGEgaHJlZj0iJyArIHBvc3RlciArCiAgICAgICAgJyIgZG93bmxvYWQgdGl0bGU9IicgKyB0aXRsZSArICciPkRvd25sb2FkIFBob3RvJyArIG51bSArICc8L2E+JzsKICAgIH0gZWxzZSB7CiAgICAgIGh0bWwgKz0gbnVtICsgJzwvYT4nOwogICAgfQogICAgaWYgKGFsYnVtKSB7CiAgICAgIGxpbmsuaW5uZXJIVE1MICs9IGh0bWw7CiAgICB9IGVsc2UgewogICAgICBsaW5rLmlubmVySFRNTCA9IGh0bWw7CiAgICAgIGlmIChpc1Byb2ZpbGUpIHsKICAgICAgICBrLmFwcGVuZENoaWxkKGxpbmspOwogICAgICB9IGVsc2UgaWYgKHRhcmdldC5pbnNlcnRBZGphY2VudEVsZW1lbnQpIHsKICAgICAgICB0YXJnZXQuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdhZnRlckVuZCcsIGxpbmspOwogICAgICB9IGVsc2UgewogICAgICAgIGlmICh0YXJnZXQubmV4dFNpYmxpbmcpIHsKICAgICAgICAgIHRQYXJlbnQuaW5zZXJ0QmVmb3JlKGxpbmssIHRhcmdldC5uZXh0U2libGluZyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRQYXJlbnQuYXBwZW5kQ2hpbGQobGluayk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQogIGlmIChhbGJ1bUJ0bikgewogICAgSEVMUEVSX0xPQURJTkcgPSB0cnVlOwogICAgYWxidW1CdG4uY2xpY2soKTsKICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgIF9hZGRMaW5rKGssIHRhcmdldCwgbGluayk7CiAgICB9LCAzMDApOwogIH0gZWxzZSBpZiAoIWFsYnVtQnRuICYmIGFsYnVtKSB7CiAgICB3aGlsZSAoYWxidW1CdG4gPSBrLnF1ZXJ5U2VsZWN0b3IoJy5jb3JlU3ByaXRlTGVmdENoZXZyb24nKSkgewogICAgICBhbGJ1bUJ0bi5jbGljaygpOwogICAgfQogICAgSEVMUEVSX0xPQURJTkcgPSBmYWxzZTsKICB9Cn0KZnVuY3Rpb24gYWRkVmlkZW9MaW5rKCkgewogIHZhciBvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnYVtocmVmJD0ibXA0Il0nICsKICAgICdbdGl0bGU9Iihwcm92aWRlZCBieSBEb3duQWxidW0pIl0nKTsKICBmb3IgKHZhciBpID0gMDsgaSA8IG8ubGVuZ3RoOyBpKyspIHsKICAgIG9baV0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChvW2ldKTsKICB9CiAgdmFyIGsgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcjc3RyZWFtX3BhZ2VsZXQgYVtocmVmKj0iL3ZpZGVvcy8iXSwgJyArCiAgICAnI2ZiUGhvdG9Tbm93bGlmdFRpbWVzdGFtcCBhW2hyZWYqPSIvdmlkZW9zLyJdJyk7CiAgZm9yICh2YXIgaSA9IDA7IGkgPCBrLmxlbmd0aDsgaSsrKSB7CiAgICBpZiAoa1tpXS5kYXRhc2V0LmxvYWRlZCkgewogICAgICBjb250aW51ZTsKICAgIH0KICAgIGtbaV0uZGF0YXNldC5sb2FkZWQgPSAxOwogICAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwogICAgeGhyLm9ubG9hZCA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2FbaHJlZio9IicgKwogICAgICAgIHRoaXMucmVzcG9uc2VVUkwucmVwbGFjZShsb2NhdGlvbi5vcmlnaW4sICcnKSArICciXVtkYXRhLWxvYWRlZF0nKTsKICAgICAgdmFyIHIgPSB0aGlzLnJlc3BvbnNlOwogICAgICB2YXIgbSA9IHIubWF0Y2goLyhoZHxzZClfc3JjOiIoXHdbXiJdKykiL2ltZyk7CiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbS5sZW5ndGg7IGorKykgewogICAgICAgIHZhciBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgICAgIGEuaHJlZiA9IG1bal0uc2xpY2UoOCwgLTEpOwogICAgICAgIGEuZG93bmxvYWQgPSAnJzsKICAgICAgICBhLnRhcmdldCA9ICdfYmxhbmsnOwogICAgICAgIGEuc3R5bGUucGFkZGluZyA9ICc1cHgnOwogICAgICAgIGEudGl0bGUgPSAnKHByb3ZpZGVkIGJ5IERvd25BbGJ1bSknOwogICAgICAgIGEuaW5uZXJIVE1MID0gbVtqXS5zbGljZSgwLCAyKS50b1VwcGVyQ2FzZSgpICsgJ+KGkyc7CiAgICAgICAgZS5wYXJlbnROb2RlLmFwcGVuZENoaWxkKGEpOwogICAgICB9CiAgICB9CiAgICB4aHIub3BlbignR0VUJywga1tpXS5ocmVmKTsKICAgIHhoci5zZW5kKCk7CiAgfQp9CmZ1bmN0aW9uIHBob3Rvc09mSGVscGVyKCkgewogIHZhciB1c2VySWQ7CiAgdmFyIHRpbWVsaW5lID0gcVMoJyNwYWdlbGV0X3RpbWVsaW5lX21haW5fY29sdW1uJyk7CiAgdHJ5IHsKICAgIGlmICh0aW1lbGluZSkgewogICAgICB1c2VySWQgPSBKU09OLnBhcnNlKHRpbWVsaW5lLmdldEF0dHJpYnV0ZSgnZGF0YS1ndCcpKS5wcm9maWxlX293bmVyOwogICAgfQogIH0gY2F0Y2goZSkge30KCiAgdmFyIGNvdmVyID0gcVMoJy5jb3ZlcldyYXAnKSB8fCBxUygnLmNvdmVySW1hZ2UnKTsKICB0cnkgewogICAgaWYgKGNvdmVyICYmICF1c2VySWQpIHsKICAgICAgdXNlcklkID0gY292ZXIuaHJlZi5tYXRjaCgvc2V0PShbXHdcZFwuXSspLylbMV0uc3BsaXQoJy4nKVszXTsKICAgIH0KICB9IGNhdGNoKGUpIHt9CgogIGlmICh1c2VySWQpIHsKICAgIGxvY2F0aW9uLmhyZWYgPSAnL3NlYXJjaC8nICsgdXNlcklkICsgJy9waG90b3Mtb2YvaW50ZXJzZWN0JzsKICB9Cn0KdmFyIGcgPSB7fTsKZnVuY3Rpb24gZ2V0UGFyZW50KGNoaWxkLCBzZWxlY3Rvcil7CiAgdmFyIHRhcmdldCA9IGNoaWxkOwogIHdoaWxlKHRhcmdldCAmJiAhdGFyZ2V0LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpKXsKICAgIGlmICh0YXJnZXQucGFyZW50Tm9kZSAmJiB0YXJnZXQucGFyZW50Tm9kZS50YWdOYW1lID09ICdCT0RZJykgewogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgaWYgKHRhcmdldC5wYXJlbnROb2RlICYmIHRhcmdldC5wYXJlbnROb2RlLnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpKSB7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9IGVsc2UgewogICAgICB0YXJnZXQgPSB0YXJnZXQucGFyZW50Tm9kZTsKICAgIH0KICB9CiAgcmV0dXJuIG51bGw7Cn0KZnVuY3Rpb24gZ2V0VGV4dChzLCBodG1sLCBwYXJlbnQpewogIHZhciBxID0gcGFyZW50ID8gcGFyZW50LnF1ZXJ5U2VsZWN0b3IocykgOiBxUyhzKTsKICB2YXIgdCA9ICd0ZXh0Q29udGVudCc7CiAgaWYocSAmJiBxLnF1ZXJ5U2VsZWN0b3JBbGwoJ2JyJykubGVuZ3RoKXt0ID0gJ2lubmVySFRNTCc7fQogIGlmKHEgJiYgaHRtbCAmJiBxLnF1ZXJ5U2VsZWN0b3JBbGwoJ2EnKS5sZW5ndGgpe3QgPSAnaW5uZXJIVE1MJzt9CiAgcmV0dXJuIHEgPyBxW3RdIDogIiI7Cn0KZnVuY3Rpb24gZ2V0RE9NKGh0bWwpewogIHZhciBkb2M7CiAgaWYoZG9jdW1lbnQuaW1wbGVtZW50YXRpb24pewogICAgZG9jID0gZG9jdW1lbnQuaW1wbGVtZW50YXRpb24uY3JlYXRlSFRNTERvY3VtZW50KCcnKTsKICAgIGRvYy5kb2N1bWVudEVsZW1lbnQuaW5uZXJIVE1MID0gaHRtbDsKICB9ZWxzZSBpZihET01QYXJzZXIpewogICAgZG9jID0gKG5ldyBET01QYXJzZXIpLnBhcnNlRnJvbVN0cmluZyhodG1sLCAndGV4dC9odG1sJyk7CiAgfWVsc2V7CiAgICBkb2MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIGRvYy5pbm5lckhUTUwgPSBodG1sOwogIH0KICByZXR1cm4gZG9jOwp9CmZ1bmN0aW9uIHF1aWNrU2VsZWN0KHMpewogIHZhciBtZXRob2QgPSBmYWxzZTsKICBzd2l0Y2gocyl7CiAgICBjYXNlIC8jXHcrJC8udGVzdChzKToKICAgICAgbWV0aG9kID0gJ2dldEVsZW1lbnRCeUlkJzsgYnJlYWs7CiAgICBjYXNlIC9cLlx3KyQvLnRlc3Qocyk6CiAgICAgIG1ldGhvZCA9ICdnZXRFbGVtZW50c0J5Q2xhc3NOYW1lJzsgYnJlYWs7CiAgfQogIHJldHVybiBtZXRob2Q7Cn0KZnVuY3Rpb24gcVMocyl7dmFyIGsgPSBkb2N1bWVudFtxdWlja1NlbGVjdChzKSB8fCAncXVlcnlTZWxlY3RvciddKHMpO3JldHVybiBrJiZrLmxlbmd0aCA/IGtbMF0gOiBrO30KZnVuY3Rpb24gcVNBKHMpe3JldHVybiBkb2N1bWVudFtxdWlja1NlbGVjdChzKSB8fCAncXVlcnlTZWxlY3RvckFsbCddKHMpO30KZnVuY3Rpb24gcGFkWmVybyhzdHIsIGxlbikgewogIHN0ciA9IHN0ci50b1N0cmluZygpOwogIHdoaWxlIChzdHIubGVuZ3RoIDwgbGVuKSB7CiAgICBzdHIgPSAnMCcgKyBzdHI7CiAgfQogIHJldHVybiBzdHI7Cn0KZnVuY3Rpb24gcGFyc2VUaW1lKHQpewogIHZhciBkID0gbmV3IERhdGUodCAqIDEwMDApOwogIHJldHVybiBkLmdldEZ1bGxZZWFyKCkgKyAnLScgKyBwYWRaZXJvKGQuZ2V0TW9udGgoKSArIDEsIDIpICsgJy0nICsKICAgIHBhZFplcm8oZC5nZXREYXRlKCksIDIpICsgJyAnICsgcGFkWmVybyhkLmdldEhvdXJzKCksIDIpICsgJzonICsKICAgIHBhZFplcm8oZC5nZXRNaW51dGVzKCksIDIpICsgJzonICsgcGFkWmVybyhkLmdldFNlY29uZHMoKSwgMik7Cn0KZnVuY3Rpb24gcGFyc2VRdWVyeShzKXsKICB2YXIgZGF0YSA9IHt9OwogIHZhciBuID0gcy5zcGxpdCgiJiIpOwogIGZvcih2YXIgaT0wOyBpPG4ubGVuZ3RoOyBpKyspewogICAgdmFyIHQgPSBuW2ldLnNwbGl0KCI9Iik7CiAgICBkYXRhW3RbMF1dID0gdFsxXTsKICB9CiAgcmV0dXJuIGRhdGE7Cn0KZnVuY3Rpb24gcGFyc2VGYlNyYyhzLCBmYikgewogIGlmIChmYikgewogICAgcmV0dXJuIHMucmVwbGFjZSgvc1xkezMsNH14XGR7Myw0fVwvL2csICcnKTsKICB9IGVsc2UgewogICAgaWYgKHMuaW5kZXhPZignbXA0JykgPT09IC0xKSB7CiAgICAgIHMgPSBzLnJlcGxhY2UoJy92cC8nLCAnLycpOwogICAgfQogICAgcmV0dXJuIHMucmVwbGFjZSgvY1xkK1wuXGQrXC5cZCtcLlxkK1wvLywgJycpCiAgICAgIC5yZXBsYWNlKC9cd1xkezMsNH14XGR7Myw0fVwvL2csIHMubWF0Y2goL1wvZVxkezJ9XC8vKSA/ICcnIDogJ2UxNS8nKTsKICB9Cn0KZnVuY3Rpb24gcGFyc2VQb3MobikgewogIHJldHVybiArKChuICogMTAwKS50b0ZpeGVkKDMpKTsKfQpmdW5jdGlvbiBnZXRGYmlkKHMpewogIGlmICghcyB8fCAhcy5sZW5ndGgpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgdmFyIGZiaWQgPSBzLm1hdGNoKC9mYmlkPShcZCspLyk7CiAgaWYoIWZiaWQpewogICAgaWYocy5tYXRjaCgnb3BhcXVlQ3Vyc29yJykpewogICAgICB2YXIgaW5kZXggPSBzLmluZGV4T2YoJy9waG90b3MvJyk7CiAgICAgIGlmKGluZGV4ICE9IC0xKXsKICAgICAgICBmYmlkID0gZ2V0RmJpZChzLnNsaWNlKGluZGV4ICsgOCkpOwogICAgICAgIGlmKGZiaWQpewogICAgICAgICAgcmV0dXJuIGZiaWQ7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmKCFmYmlkKXsKICAgICAgICBmYmlkID0gcy5tYXRjaCgvXC8oWzAtOV0rKVwvLyk7CiAgICAgICAgaWYoIWZiaWQpewogICAgICAgICAgZmJpZCA9IHMubWF0Y2goLyhbMC05XXs1LH0pLyk7CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgaWYgKHMubWF0Y2goJyYnKSAmJiAhcy5tYXRjaCgvcGhvdG9zfHZpZGVvcy8pKSB7CiAgICAgIHRyeXsKICAgICAgICBmYmlkID0gcy5zbGljZShzLmluZGV4T2YoJz0nKSArIDEsIHMuaW5kZXhPZignJicpKTsKICAgICAgfWNhdGNoKGUpe30KICAgICAgcmV0dXJuIGZiaWQgPyBmYmlkIDogZmFsc2U7CiAgICB9IGVsc2UgewogICAgICAvLyBpZCBmb3IgcGFnZSdzIHBob3RvcyAvIHZpZGVvIGFsYnVtCiAgICAgIGZiaWQgPSBzLm1hdGNoKC9cLyg/OnBob3Rvc3x2aWRlb3MpKD86XC9bXHdcZFwuLV0rKSpcLyhcZCspLyk7CiAgICB9CiAgfQogIHJldHVybiBmYmlkICYmIGZiaWQubGVuZ3RoID8gZmJpZFsxXSA6IGZhbHNlOwp9CmZ1bmN0aW9uIGV4dHJhY3RKU09OKHN0cikgewogIC8vIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTA1NzQ1MjAvCiAgdmFyIGZpcnN0T3BlbiwgZmlyc3RDbG9zZSwgY2FuZGlkYXRlOwogIGZpcnN0T3BlbiA9IHN0ci5pbmRleE9mKCd7JywgZmlyc3RPcGVuICsgMSk7CiAgdmFyIGNvdW50T3BlbiA9IDAsIGNvdW50Q2xvc2UgPSAwOwogIGRvIHsKICAgIGNvdW50T3BlbisrOwogICAgZmlyc3RDbG9zZSA9IHN0ci5sYXN0SW5kZXhPZignfScpOwogICAgaWYgKGZpcnN0Q2xvc2UgPD0gZmlyc3RPcGVuKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY291bnRDbG9zZSA9IDA7CiAgICBkbyB7CiAgICAgIGNvdW50Q2xvc2UrKzsKICAgICAgY2FuZGlkYXRlID0gc3RyLnN1YnN0cmluZyhmaXJzdE9wZW4sIGZpcnN0Q2xvc2UgKyAxKTsKICAgICAgdmFyIHJlczsKICAgICAgdHJ5IHsKICAgICAgICByZXMgPSBKU09OLnBhcnNlKGNhbmRpZGF0ZSk7CiAgICAgICAgcmV0dXJuIHJlczsKICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgdHJ5IHsKICAgICAgICByZXMgPSBldmFsKCIoIiArIGNhbmRpZGF0ZSArICIpIik7CiAgICAgICAgcmV0dXJuIHJlczsKICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgZmlyc3RDbG9zZSA9IHN0ci5zdWJzdHIoMCwgZmlyc3RDbG9zZSkubGFzdEluZGV4T2YoJ30nKTsKICAgIH0gd2hpbGUgKGZpcnN0Q2xvc2UgPiBmaXJzdE9wZW4gJiYgY291bnRDbG9zZSA8IDIwKTsKICAgIGZpcnN0T3BlbiA9IHN0ci5pbmRleE9mKCd7JywgZmlyc3RPcGVuICsgMSk7CiAgfSB3aGlsZSAoZmlyc3RPcGVuICE9IC0xICYmIGNvdW50T3BlbiA8IDIwKTsKfQpmdW5jdGlvbiBjcmVhdGVEaWFsb2coKSB7CiAgaWYgKHFTKCcjZGFDb250YWluZXInKSkgewogICAgcVMoJyNkYUNvbnRhaW5lcicpLnN0eWxlID0gJyc7CiAgICBxUygnI3N0b3BBamF4Q2tiJykuY2hlY2tlZCA9IGZhbHNlOwogICAgcmV0dXJuOwogIH0KICB2YXIgZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogIHZhciBzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTsKICBzLnRleHRDb250ZW50ID0gJyNkYUNvbnRhaW5lciB7cG9zaXRpb246IGZpeGVkOyB3aWR0aDogMzYwcHg7IFwKICAgIHRvcDogMjAlOyBsZWZ0OiA1MCU7IG1hcmdpbi1sZWZ0OiAtMTgwcHg7IGJhY2tncm91bmQ6ICNGRkY7IFwKICAgIHBhZGRpbmc6IDFlbTsgYm9yZGVyLXJhZGl1czogMC41ZW07IGxpbmUtaGVpZ2h0OiAyZW07IHotaW5kZXg6IDk5OTk7XAogICAgYm94LXNoYWRvdzogMXB4IDNweCAzcHggMCByZ2JhKDAsMCwwLC4yKSwxcHggM3B4IDE1cHggMnB4IHJnYmEoMCwwLDAsLjIpO31cCiAgICAjZGFIZWFkZXIge2ZvbnQtc2l6ZTogMS41cmVtOyBmb250LXdlaWdodDogNzAwOyBiYWNrZ3JvdW5kOiAjRkZGOyBcCiAgICBwYWRkaW5nOiAxcmVtIDAuNXJlbTsgY29sb3I6IHJnYmEoMCwwLDAsLjg1KTsgXAogICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkIHJnYmEoMzQsMzYsMzgsLjE1KTt9IFwKICAgICNkYUNvbnRlbnQge2ZvbnQtc2l6ZTogMS4yZW07IGxpbmUtaGVpZ2h0OiAxLjQ7IHBhZGRpbmc6IC41cmVtO30gXAogICAgI2RhQ29udGFpbmVyIGEge2N1cnNvcjogcG9pbnRlcjtib3JkZXI6IDFweCBzb2xpZCBibGFjaztwYWRkaW5nOiAxMHB4OyBcCiAgICAgIGRpc3BsYXk6IGJsb2NrO30gXAogICAgI3N0b3BBamF4Q2tiIHtkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IC13ZWJraXQtYXBwZWFyYW5jZTogY2hlY2tib3g7IFwKICAgIHdpZHRoOiBhdXRvO30nOwogIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQocyk7CiAgZC5pZCA9ICdkYUNvbnRhaW5lcic7CiAgZC5pbm5lckhUTUwgPSAnPGRpdiBpZD0iZGFIZWFkZXIiPkRvd25BbGJ1bTwvZGl2PjxkaXYgaWQ9ImRhQ29udGVudCI+JyArCiAgICAnU3RhdHVzOiA8c3BhbiBjbGFzcz0iZGFDb3VudGVyIj48L3NwYW4+PGJyPicgKwogICAgJzxsYWJlbD5TdG9wIDxpbnB1dCBpZD0ic3RvcEFqYXhDa2IiIHR5cGU9ImNoZWNrYm94Ij48L2xhYmVsPicgKwogICAgJzxkaXYgY2xhc3M9ImRhRXh0cmEiPjwvZGl2PicgKwogICAgJzxhIGNsYXNzPSJkYU91dHB1dCI+T3V0cHV0PC9hPjxhIGNsYXNzPSJkYUNsb3NlIj5DbG9zZTwvYT48L2Rpdj4nOwogIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZCk7CiAgcVMoJy5kYUNsb3NlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoaWRlRGlhbG9nKTsKICBxUygnLmRhT3V0cHV0JykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvdXRwdXQpOwp9CmZ1bmN0aW9uIGhpZGVEaWFsb2coKSB7CiAgcVMoJyNkYUNvbnRhaW5lcicpLnN0eWxlID0gJ2Rpc3BsYXk6IG5vbmU7JzsKfQpmdW5jdGlvbiBjbG9zZURpYWxvZygpIHsKICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHFTKCcjZGFDb250YWluZXInKSk7Cn0KZnVuY3Rpb24gb3V0cHV0KCl7CiAgZy5waG90b2RhdGEuZFRpbWUgPSAobmV3IERhdGUoKSkudG9Mb2NhbGVTdHJpbmcoKTsKICBpZihsb2NhdGlvbi5ocmVmLm1hdGNoKC8uKmZhY2Vib29rLmNvbS8pKXsKICAgIGRvY3VtZW50LnRpdGxlID0gZG9jdW1lbnQudGl0bGUubWF0Y2goLyg/Oi4qXHxcfCkqKC4qKS8pWzFdOwogIH0KICBkb2N1bWVudC50aXRsZT1nLnBob3RvZGF0YS5hTmFtZTsKICBpZihnLnBob3RvZGF0YS5waG90b3MubGVuZ3RoPjEwMDAgJiYgIWcubGFyZ2VBbGJ1bSl7CiAgICBpZihjb25maXJtKCdMYXJnZSBhbW91bnQgb2YgcGhvdG9zIG1heSBjcmFzaCB0aGUgYnJvd3Nlcjpcbk9LLT5Vc2UgTGFyZ2UgQWxidW0gT3B0aW1pemUgQ2FuY2VsLT5Db250aW51ZScpKWcucGhvdG9kYXRhLmxhcmdlQWxidW0gPSB0cnVlOwogIH0KICBzZW5kUmVxdWVzdCh7dHlwZTonZXhwb3J0JyxkYXRhOmcucGhvdG9kYXRhfSk7Cn0KZnVuY3Rpb24gaW5pdERhdGFMb2FkZWQoZmJpZCkgewogIGlmIChnLmRhdGFMb2FkZWRbZmJpZF0gPT09IHVuZGVmaW5lZCkgewogICAgZy5kYXRhTG9hZGVkW2ZiaWRdID0ge307CiAgfQp9CmZ1bmN0aW9uIGhhbmRsZUZiQWpheChmYmlkKSB7CiAgdmFyIGQgPSBnLmRhdGFMb2FkZWRbZmJpZF07CiAgaWYgKGQgIT09IHVuZGVmaW5lZCkgewogICAgdmFyIHBob3RvcyA9IGcucGhvdG9kYXRhLnBob3RvczsKICAgIHZhciBpID0gZy5hamF4TG9hZGVkOwogICAgaWYgKCFwaG90b3NbaV0pIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBpZiAoZy51cmxMb2FkZWRbZmJpZF0pIHsKICAgICAgcGhvdG9zW2ldLnVybCA9IGcudXJsTG9hZGVkW2ZiaWRdOwogICAgICBkZWxldGUgZy51cmxMb2FkZWRbZmJpZF07CiAgICB9CiAgICBpZiAoZy5jb21tZW50c0xpc3RbZmJpZF0pIHsKICAgICAgcGhvdG9zW2ldLmNvbW1lbnRzID0gZy5jb21tZW50c0xpc3RbZmJpZF07CiAgICAgIGRlbGV0ZSBnLmNvbW1lbnRzTGlzdFtmYmlkXTsKICAgIH0KICAgIHBob3Rvc1tpXS50aXRsZSA9IGQudGl0bGU7CiAgICBwaG90b3NbaV0udGFnID0gZC50YWc7CiAgICBwaG90b3NbaV0uZGF0ZSA9IGQuZGF0ZTsKICAgIGlmIChkLnZpZGVvKSB7CiAgICAgIGcucGhvdG9kYXRhLnZpZGVvcy5wdXNoKHsKICAgICAgICB1cmw6IGQudmlkZW8KICAgICAgfSk7CiAgICB9CiAgICBkZWxldGUgZy5kYXRhTG9hZGVkW2ZiaWRdOwogICAgZGVsZXRlIHBob3Rvc1tpXS5hamF4OwogICAgaWYgKGcuYWpheExvYWRlZCArIDEgPCBwaG90b3MubGVuZ3RoKSB7CiAgICAgIGcuYWpheExvYWRlZCsrOwogICAgICBnLmFqYXhSZXRyeSA9IDA7CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgcmV0dXJuIGZhbHNlOwp9CmZ1bmN0aW9uIGhhbmRsZUZiQWpheFByb2ZpbGVzKGRhdGEpIHsKICB2YXIgcHJvZmlsZXMgPSBPYmplY3Qua2V5cyhkYXRhLnByb2ZpbGVzKTsKICBmb3IgKHZhciBqID0gMDsgaiA8IHByb2ZpbGVzLmxlbmd0aDsgaisrKSB7CiAgICB0cnkgewogICAgICB2YXIgcCA9IGRhdGEucHJvZmlsZXNbcHJvZmlsZXNbal1dOwogICAgICBnLnByb2ZpbGVzTGlzdFtwLmlkXSA9IHtuYW1lOiBwLm5hbWUsIHVybDogcC51cml9OwogICAgfSBjYXRjaChlKSB7fQogIH0KfQpmdW5jdGlvbiBoYW5kbGVGYkFqYXhDb21tZW50KGRhdGEpIHsKICB0cnkgewogICAgdmFyIGNvbW1lbnRzID0gZGF0YS5jb21tZW50czsKICAgIHZhciBjb21tZW50c0xpc3QgPSBbZGF0YS5mZWVkYmFja3RhcmdldC5jb21tZW50Y291bnRdOwogICAgdmFyIGZiaWQgPSBjb21tZW50c1swXS5mdGVudGlkZW50aWZpZXI7CiAgICB2YXIgdGltZUZpeCA9IG5ldyBEYXRlKHBhcnNlVGltZShkYXRhLnNlcnZlcnRpbWUpKSAtIG5ldyBEYXRlKCk7CiAgfSBjYXRjaChlKSB7CiAgICBjb25zb2xlLmxvZygnQ2Fubm90IHBhcnNlIGNvbW1lbnQnKTsKICAgIHJldHVybjsKICB9CiAgZm9yIChqID0gMDsgaiA8IGNvbW1lbnRzLmxlbmd0aDsgaisrKXsKICAgIHRyeSB7CiAgICAgIHZhciBjID0gY29tbWVudHNbal07CiAgICAgIHAgPSBnLnByb2ZpbGVzTGlzdFtjLmF1dGhvcl07CiAgICAgIGNvbW1lbnRzTGlzdC5wdXNoKHsKICAgICAgICBmYmlkOiBmYmlkLAogICAgICAgIGlkOiBjLmxlZ2FjeWlkLAogICAgICAgIG5hbWU6IHAubmFtZSwKICAgICAgICB1cmw6IHAudXJsLAogICAgICAgIHRleHQ6IGMuYm9keS50ZXh0LAogICAgICAgIGRhdGU6IHBhcnNlVGltZShjLnRpbWVzdGFtcC50aW1lKQogICAgICB9KTsKICAgIH0gY2F0Y2goZSkge30KICB9CiAgZy5jb21tZW50c0xpc3RbZmJpZF0gPSBjb21tZW50c0xpc3Q7CiAgZy5jb21tZW50c0xpc3QuY291bnQrKzsKfQpmdW5jdGlvbiBmYkFqYXgoKXsKICB2YXIgbGVuPWcucGhvdG9kYXRhLnBob3Rvcy5sZW5ndGgsaT1nLmFqYXhMb2FkZWQ7CiAgdmFyIHNyYzsKICB0cnl7CiAgICBzcmMgPSBnZXRGYmlkKGcucGhvdG9kYXRhLnBob3Rvc1tpXS5ocmVmKTsKICB9Y2F0Y2goZSl7CiAgICBpZihpICsgMSA8IGxlbil7Zy5hamF4TG9hZGVkKys7IGZiQWpheCgpO31lbHNle291dHB1dCgpO30KICAgIHJldHVybjsKICB9CiAgaWYgKGhhbmRsZUZiQWpheChzcmMpKSB7CiAgICBpZihsZW48NTB8fGklMTU9PTApbG9nKCdMb2FkZWQgJysoaSsxKSsnIG9mICcrbGVuKycuIChjYWNoZWQpJyk7CiAgICBnLnN0YXR1c0VsZS50ZXh0Q29udGVudD0nTG9hZGluZyAnKyhpKzEpKycgb2YgJytsZW4rJy4nOwogICAgaWYoaSsxIT1sZW4pe2RvY3VtZW50LnRpdGxlPSIoIisoaSsxKSsiLyIrKGxlbikrIikgfHwiK2cucGhvdG9kYXRhLmFOYW1lO2ZiQWpheCgpOwogICAgfWVsc2V7b3V0cHV0KCk7fQogIH1lbHNlIGlmKCFxUygnI3N0b3BBamF4Q2tiJyl8fCFxUygnI3N0b3BBamF4Q2tiJykuY2hlY2tlZCl7CiAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwogIHhoci5vbmxvYWQgPSBmdW5jdGlvbigpIHsKICAgIGNsZWFyVGltZW91dChnLnRpbWVvdXQpOwogICAgdmFyIHI9dGhpcy5yZXNwb25zZSxodG1sQmFzZT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdodG1sJyk7CiAgICB2YXIgdGFyZ2V0SlMgPSBbXSwgbGlzdCA9IFtzcmNdOwogICAgaWYgKGcuaXNQYWdlVmlkZW8pIHsKICAgICAgciA9IEpTT04ucGFyc2Uoci5zbGljZSg5KSk7CiAgICAgIHZhciBrID0gci5qc21vZHMuaW5zdGFuY2VzOwogICAgICBmb3IgKHZhciBpaSA9IDA7IGlpIDwgay5sZW5ndGg7IGlpKyspIHsKICAgICAgICBpZiAoIWtbaWldIHx8ICFrW2lpXS5sZW5ndGggfHwgIWtbaWldWzFdIHx8ICFrW2lpXVsxXS5sZW5ndGgpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAoa1tpaV1bMV1bMF0gPT09ICdWaWRlb0NvbmZpZycpIHsKICAgICAgICAgIHZhciBpbnN0ID0ga1tpaV1bMl1bMF0udmlkZW9EYXRhWzBdOwogICAgICAgICAgaW5pdERhdGFMb2FkZWQoaW5zdC52aWRlb19pZCk7CiAgICAgICAgICBnLmRhdGFMb2FkZWRbaW5zdC52aWRlb19pZF0udmlkZW8gPSBpbnN0LmhkX3NyYyB8fCBpbnN0LnNkX3NyYzsKICAgICAgICB9CiAgICAgIH0KICAgICAgZy5jdXJzb3IgPSByLnBheWxvYWQuY3Vyc29yOwogICAgfSBlbHNlIHsKICAgICAgaHRtbEJhc2UuaW5uZXJIVE1MID0gci5zbGljZSg2LC03KTsKICAgICAgdGFyZ2V0SlMgPSBodG1sQmFzZS5xdWVyeVNlbGVjdG9yQWxsKCdzY3JpcHQnKTsKICAgIH0KICAgIGZvcih2YXIgaz0wO2s8dGFyZ2V0SlMubGVuZ3RoO2srKyl7CiAgICAgIHZhciB0PXRhcmdldEpTW2tdLnRleHRDb250ZW50LGNvbnRlbnQ9dC5zbGljZSh0LmluZGV4T2YoJygyLCB7JykrNCx0LmluZGV4T2YoJ30sIHRydWUpO30nKSsxKTsKICAgICAgaWYoIWNvbnRlbnQubGVuZ3RofHx0LmluZGV4T2YoJ0pTT05QVHJhbnNwb3J0Jyk8MCl7Y29udGludWU7fQogICAgICBjb250ZW50PUpTT04ucGFyc2UoY29udGVudCk7CiAgICAgIGlmICghY29udGVudC5wYXlsb2FkIHx8ICFjb250ZW50LnBheWxvYWQuanNtb2RzIHx8IAogICAgICAgICFjb250ZW50LnBheWxvYWQuanNtb2RzLnJlcXVpcmUpIHsKICAgICAgICBhbGVydCgnQXV0b2xvYWQgZmFpbGVkLCBnbyB0byBwaG90byB0YWIgYW5kIHRyeSBhZ2Fpbi4nKTsKICAgICAgICByZXR1cm4gb3V0cHV0KCk7CiAgICAgIH0KICAgICAgdmFyIHJlcXVpcmU9Y29udGVudC5wYXlsb2FkLmpzbW9kcy5yZXF1aXJlOwogICAgICBpZihyZXF1aXJlJiYoY29udGVudC5pZD09J3BhZ2VsZXRfcGhvdG9fdmlld2VyJ3x8cmVxdWlyZVswXVsxXT09J2FkZFBob3RvRmJpZHMnKSl7bGlzdD1yZXF1aXJlWzBdWzNdWzBdO30KICAgICAgZm9yICh2YXIgaWkgPSAwOyBpaSA8IHJlcXVpcmUubGVuZ3RoOyBpaSsrKSB7CiAgICAgICAgaWYgKCFyZXF1aXJlW2lpXSB8fCAhcmVxdWlyZVtpaV0ubGVuZ3RoKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKHJlcXVpcmVbaWldLmxlbmd0aCA+IDIgJiYgcmVxdWlyZVtpaV1bMF0gPT0gJ1VGSUNvbnRyb2xsZXInKSB7CiAgICAgICAgICB2YXIgaW5zdCA9IHJlcXVpcmVbaWldWzNdOwogICAgICAgICAgaWYgKGluc3QubGVuZ3RoICYmIGluc3RbMl0pIHsKICAgICAgICAgICAgaGFuZGxlRmJBamF4UHJvZmlsZXMoaW5zdFsyXSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGZvciAodmFyIGlpID0gMDsgaWkgPCByZXF1aXJlLmxlbmd0aDsgaWkrKykgewogICAgICAgIGlmICghcmVxdWlyZVtpaV0gfHwgIXJlcXVpcmVbaWldLmxlbmd0aCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGlmIChyZXF1aXJlW2lpXS5sZW5ndGggPiAyICYmIHJlcXVpcmVbaWldWzBdID09ICdVRklDb250cm9sbGVyJykgewogICAgICAgICAgdmFyIGluc3QgPSByZXF1aXJlW2lpXVszXTsKICAgICAgICAgIGlmIChpbnN0Lmxlbmd0aCAmJiBpbnN0WzJdLmNvbW1lbnRzICYmIGluc3RbMl0uY29tbWVudHMubGVuZ3RoKSB7CiAgICAgICAgICAgIGhhbmRsZUZiQWpheENvbW1lbnQoaW5zdFsyXSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChyZXF1aXJlW2lpXVsxXSA9PSAnc3RvcmVGcm9tRGF0YScpIHsKICAgICAgICAgIHZhciBpbWFnZSA9IHJlcXVpcmVbaWldWzNdWzBdLmltYWdlOwogICAgICAgICAgaWYgKGltYWdlKSB7CiAgICAgICAgICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMoaW1hZ2UpOwogICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGtleXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICB2YXIgcGlkID0ga2V5c1tqXTsKICAgICAgICAgICAgICBpZiAoaW1hZ2VbcGlkXS51cmwpIHsKICAgICAgICAgICAgICAgIGcudXJsTG9hZGVkW3BpZF0gPSBpbWFnZVtwaWRdLnVybDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHQuaW5kZXhPZignZmJQaG90b3NQaG90b1RhZ2JveEJhc2UnKSA+IDAgfHwKICAgICAgICB0LmluZGV4T2YoJ2ZiUGhvdG9zUGhvdG9DYXB0aW9uJykgPiAwIHx8CiAgICAgICAgdC5pbmRleE9mKCd1aUNvbnRleHR1YWxMYXllclBhcmVudCcpID4gMCkgewogICAgICAgIHZhciBtYXJrdXAgPSBjb250ZW50LnBheWxvYWQuanNtb2RzLm1hcmt1cDsKICAgICAgICBmb3IgKHZhciBpaSA9IDA7IGlpIDwgbWFya3VwLmxlbmd0aDsgaWkrKykgewogICAgICAgICAgdmFyIHRlc3QgPSBtYXJrdXBbaWldWzFdLl9faHRtbDsKICAgICAgICAgIHZhciBoID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICBoLmlubmVySFRNTCA9IHVuZXNjYXBlKHRlc3QpOwogICAgICAgICAgdmFyIGJveCA9IGgucXVlcnlTZWxlY3RvckFsbCgnLnNub3dsaWZ0UGF5bG9hZFJvb3QnKTsKICAgICAgICAgIGlmIChib3gubGVuZ3RoKSB7CiAgICAgICAgICAgIGZvciAodmFyIGtrID0gMDsga2sgPCBib3gubGVuZ3RoOyBraysrKSB7CiAgICAgICAgICAgICAgdmFyIGMgPSBib3hba2tdLnF1ZXJ5U2VsZWN0b3IoJy5mYlBob3Rvc1Bob3RvQ2FwdGlvbicpOwogICAgICAgICAgICAgIHZhciBiID0gYm94W2trXS5xdWVyeVNlbGVjdG9yKCcuZmJQaG90b3NQaG90b1RhZ2JveGVzJyk7CiAgICAgICAgICAgICAgdmFyIGEgPSBib3hba2tdLnF1ZXJ5U2VsZWN0b3IoJ2FiYnInKTsKICAgICAgICAgICAgICBpZiAoIWEpIHtjb250aW51ZTt9CgogICAgICAgICAgICAgIHZhciBzID0gYy5xdWVyeVNlbGVjdG9yKCcuaGFzQ2FwdGlvbicpOwogICAgICAgICAgICAgIHMgPSAhcyA/ICcnIDogcy5pbm5lckhUTUwubWF0Y2goLzxicj58PHdicj4vKSA/CiAgICAgICAgICAgICAgICBzLm91dGVySFRNTC5yZXBsYWNlKC8nL2csJyZxdW90OycpIDogcy50ZXh0Q29udGVudDsKICAgICAgICAgICAgICB2YXIgdGFnID0gYi5xdWVyeVNlbGVjdG9yKCcudGFnQm94Jyk7CiAgICAgICAgICAgICAgcGlkID0gZ2V0RmJpZChhLnBhcmVudE5vZGUuaHJlZik7CiAgICAgICAgICAgICAgaW5pdERhdGFMb2FkZWQocGlkKTsKICAgICAgICAgICAgICBnLmRhdGFMb2FkZWRbcGlkXS50YWcgPSAhdGFnID8gJycgOiBiLm91dGVySFRNTDsKICAgICAgICAgICAgICBnLmRhdGFMb2FkZWRbcGlkXS50aXRsZSA9IHM7CiAgICAgICAgICAgICAgZy5kYXRhTG9hZGVkW3BpZF0uZGF0ZSA9IGEgPyBwYXJzZVRpbWUoYS5kYXRhc2V0LnV0aW1lKSA6ICcnOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAvLyBIYW5kbGUgcHJvZmlsZSAvIGdyb3VwIHZpZGVvIGNvdmVyCiAgICAgICAgICBib3ggPSBoLnF1ZXJ5U2VsZWN0b3IoJy5pbWcnKTsKICAgICAgICAgIGlmIChoLnF1ZXJ5U2VsZWN0b3IoJ3ZpZGVvJykgJiYgYm94KSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgdmFyIGJnID0gYm94LnN0eWxlLmJhY2tncm91bmRJbWFnZS5zbGljZSg1LCAtMik7CiAgICAgICAgICAgICAgdmFyIGZpbGUgPSBiZy5tYXRjaCgvXC8oXHcrXC5qcGcpLylbMV07CiAgICAgICAgICAgICAgZm9yICh2YXIga2sgPSBnLmFqYXhMb2FkZWQ7IGtrIDwgbGVuOyBraysrKSB7CiAgICAgICAgICAgICAgICB2YXIgYSA9IGcucGhvdG9kYXRhLnBob3Rvc1tra107CiAgICAgICAgICAgICAgICBpZiAoYS51cmwuaW5kZXhPZihmaWxlKSA+IDApIHsKICAgICAgICAgICAgICAgICAgYS51cmwgPSBiZzsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChlKSB7fQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICAvLyBGYWxsYmFjayB0byBvbGQgY29tbWVudAogICAgICB2YXIgaW5zdGFuY2VzID0gY29udGVudC5wYXlsb2FkLmpzbW9kcy5pbnN0YW5jZXM7CiAgICAgIGZvcihpaSA9IDA7IGluc3RhbmNlcyAmJiBpaTxpbnN0YW5jZXMubGVuZ3RoOyBpaSsrKXsKICAgICAgICBpZiAoIWluc3RhbmNlc1tpaV0gfHwgIWluc3RhbmNlc1tpaV0ubGVuZ3RoIHx8CiAgICAgICAgICAhaW5zdGFuY2VzW2lpXVsxXSB8fCAhaW5zdGFuY2VzW2lpXVsxXS5sZW5ndGgpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAoaW5zdGFuY2VzW2lpXVsxXVswXSA9PT0gJ1VGSUNvbnRyb2xsZXInKSB7CiAgICAgICAgICBpbnN0ID0gaW5zdGFuY2VzW2lpXVsyXTsKICAgICAgICAgIGlmIChpbnN0Lmxlbmd0aCAmJiBpbnN0WzJdLmNvbW1lbnRzICYmIGluc3RbMl0uY29tbWVudHMubGVuZ3RoKSB7CiAgICAgICAgICAgIGhhbmRsZUZiQWpheFByb2ZpbGVzKGluc3RbMl0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBmb3IoaWkgPSAwOyBpbnN0YW5jZXMgJiYgaWk8aW5zdGFuY2VzLmxlbmd0aDsgaWkrKyl7CiAgICAgICAgaWYgKCFpbnN0YW5jZXNbaWldIHx8ICFpbnN0YW5jZXNbaWldLmxlbmd0aCB8fAogICAgICAgICAgIWluc3RhbmNlc1tpaV1bMV0gfHwgIWluc3RhbmNlc1tpaV1bMV0ubGVuZ3RoKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGluc3RhbmNlc1tpaV1bMV1bMF0gPT09ICdVRklDb250cm9sbGVyJykgewogICAgICAgICAgaW5zdCA9IGluc3RhbmNlc1tpaV1bMl07CiAgICAgICAgICBpZiAoaW5zdC5sZW5ndGggJiYgaW5zdFsyXS5jb21tZW50cyAmJiBpbnN0WzJdLmNvbW1lbnRzLmxlbmd0aCkgewogICAgICAgICAgICBoYW5kbGVGYkFqYXhDb21tZW50KGluc3RbMl0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoaW5zdGFuY2VzW2lpXVsxXVswXSA9PT0gJ1ZpZGVvQ29uZmlnJykgewogICAgICAgICAgaW5zdCA9IGluc3RhbmNlc1tpaV1bMl1bMF0udmlkZW9EYXRhWzBdOwogICAgICAgICAgaW5pdERhdGFMb2FkZWQoaW5zdC52aWRlb19pZCk7CiAgICAgICAgICBnLmRhdGFMb2FkZWRbaW5zdC52aWRlb19pZF0udmlkZW8gPSBpbnN0LmhkX3NyYyB8fCBpbnN0LnNkX3NyYzsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGhhbmRsZUZiQWpheChzcmMpOwogICAgaWYobGVuPDUwfHxpJTE1PT0wKWxvZygnTG9hZGVkICcrKGkrMSkrJyBvZiAnK2xlbisnLicpOwogICAgZy5zdGF0dXNFbGUudGV4dENvbnRlbnQgPSAnTG9hZGVkICcgKyAoaSsxKSArICcgb2YgJyArIGxlbjsKICAgIGlmKGkrMT49bGVuKXsKICAgICAgb3V0cHV0KCk7CiAgICB9ZWxzZXsKICAgICAgaWYgKGkgPT09IGcuYWpheExvYWRlZCkgewogICAgICAgIGcuYWpheFJldHJ5Kys7CiAgICAgICAgaWYgKGcuaXNQYWdlVmlkZW8pIHsKICAgICAgICAgIGcucGhvdG9kYXRhLnBob3Rvc1tpXS5hamF4ID0gbG9jYXRpb24ub3JpZ2luICsKICAgICAgICAgICAgJy92aWRlby9jaGFubmVsL3ZpZXcvc3RvcnkvYXN5bmMvJyArIHNyYyArICcvP3ZpZGVvX2lkc1swXT0nICsgc3JjOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoZy5hamF4UmV0cnkgPiA1KSB7CiAgICAgICAgaWYgKGcuYWpheEF1dG9OZXh0KSB7CiAgICAgICAgICBnLmFqYXhSZXRyeSA9IDA7CiAgICAgICAgICBnLmFqYXhMb2FkZWQrKzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIHJldHJ5UmVwbHkgPSBwcm9tcHQoJ1JldHJpZWQgNSB0aW1lcy5cblRyeSBhZ2Fpbi0+T0tcbicgKwogICAgICAgICAgICAnVHJ5IG5leHQgcGhvdG8tPlR5cGUgMVxuQWx3YXlzIHRyeSBuZXh0LT5UeXBlIDJcbicgKwogICAgICAgICAgICAnT3V0cHV0IGxvYWRlZCBwaG90b3MtPkNhbmNlbCcpOwogICAgICAgICAgaWYgKHJldHJ5UmVwbHkgIT09IG51bGwpIHsKICAgICAgICAgICAgZy5hamF4UmV0cnkgPSAwOwogICAgICAgICAgICBpZiAoK3JldHJ5UmVwbHkgPT09IDIpewogICAgICAgICAgICAgIGcuYWpheEF1dG9OZXh0ID0gdHJ1ZTsKICAgICAgICAgICAgICBnLmFqYXhMb2FkZWQrKzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBnLmFqYXhMb2FkZWQrKzsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgb3V0cHV0KCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgZG9jdW1lbnQudGl0bGU9IigiKyhpKzEpKyIvIisobGVuKSsiKSB8fCIrZy5waG90b2RhdGEuYU5hbWU7ZmJBamF4KCk7CiAgICB9CiAgfTsKICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7CiAgICBpZiAoeGhyLnJlYWR5U3RhdGUgPT0gMiAmJiB4aHIuc3RhdHVzICE9IDIwMCkgewogICAgICBjbGVhclRpbWVvdXQoZy50aW1lb3V0KTsKICAgICAgZy5hamF4TG9hZGVkKys7CiAgICAgIGZiQWpheCgpOwogICAgfQogIH07CiAgaWYgKGcuaXNQYWdlVmlkZW8pIHsKICAgIHhoci5vcGVuKCdQT1NUJywgZy5waG90b2RhdGEucGhvdG9zW2ldLmFqYXggKwogICAgICAoZy5jdXJzb3IgPyAnJmN1cnNvcj0nICsgZy5jdXJzb3IgOiAnJykpOwogIH0gZWxzZSB7CiAgICB4aHIub3BlbignR0VUJywgZy5waG90b2RhdGEucGhvdG9zW2ldLmFqYXgpOwogIH0KICBnLnRpbWVvdXQ9c2V0VGltZW91dChmdW5jdGlvbigpewogICAgeGhyLmFib3J0KCk7CiAgICBnLmFqYXhSZXRyeSsrOwogICAgaWYoZy5hamF4UmV0cnk+NSl7aWYoY29uZmlybSgnVGltZW91dCByZWFjaGVkLlxuVHJ5IGFnYWluLT5PS1xuT3V0cHV0IGxvYWRlZCBwaG90b3MtPkNhbmNlbCcpKXtnLmFqYXhSZXRyeT0wO2ZiQWpheCgpO31lbHNle291dHB1dCgpO319CiAgfSwxMDAwMCk7CiAgdmFyIGRhdGEgPSBudWxsOwogIGlmIChnLmlzUGFnZVZpZGVvKSB7CiAgICBpZiAoIWcuZmJfZHRzZykgewogICAgICBnZXRGYkR0c2coKTsKICAgIH0KICAgIGRhdGEgPSAnX191c2VyPScgKyBnLkVudi51c2VyICsgJyZfX2E9MSZmYl9kdHNnPScgKyBnLmZiX2R0c2c7CiAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC10eXBlJywgJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcpOwogIH0KICB4aHIuc2VuZChkYXRhKTt9ZWxzZXtvdXRwdXQoKTt9Cn0KZnVuY3Rpb24gZ2V0UGhvdG9zKCl7CiAgaWYoZy5zdGFydCE9Mnx8Zy5zdGFydD09Myl7cmV0dXJuO30KICB2YXIgc2Nyb2xsRWxlID0gISEocVMoJyNmYlRpbWVsaW5lUGhvdG9zU2Nyb2xsZXIgKiwgJyArCiAgICAnLnVpU2ltcGxlU2Nyb2xsaW5nTG9hZGluZ0luZGljYXRvciwgLmZiU3RhckdyaWR+aW1nLCAnICsKICAgICcuZmJTdGFyR3JpZFdyYXBwZXJ+aW1nLCAjYnJvd3NlX3Jlc3VsdF9iZWxvd19mb2xkLCAnICsKICAgICcjY29udGVudF9jb250YWluZXIgZGl2ID4gc3BhblthcmlhLWJ1c3k9InRydWUiXSwgJyArCiAgICAnI3BhZ2VzX3ZpZGVvX2h1Yl9hbGxfdmlkZW9zX3BhZ2VsZXQgLnVpTW9yZVBhZ2VyTG9hZGVyJykgfHwKICAgICghcVMoJyNicm93c2VfZW5kX29mX3Jlc3VsdHNfZm9vdGVyJykgJiYgcVMoJyNjb250ZW50QXJlYSBkaXYuaGlkZGVuX2VsZW0nKQogICAgJiYgbG9jYXRpb24uaHJlZi5tYXRjaCgnc2VhcmNoJykpKTsKICBpZihnLmFqYXhGYWlsZWQmJmcubW9kZSE9MiYmc2Nyb2xsRWxlKXtzY3JvbGxUbygwLCBkb2N1bWVudC5ib2R5LmNsaWVudEhlaWdodCk7c2V0VGltZW91dChnZXRQaG90b3MsMjAwMCk7cmV0dXJuO30vL2cuc3RhcnQ9MzsKICB2YXIgaSwgcGhvdG9kYXRhID0gZy5waG90b2RhdGEsIHRlc3ROZWVkZWQgPSAwLCBhamF4TmVlZGVkID0gMDsKICB2YXIgZWxtcyA9IGcuZWxtcyB8fCBxUygnI2FsYnVtX3Bob3Rvc19wYWdlbGV0JykgfHwgcVMoJyNhbGJ1bV9wYWdlbGV0JykgfHwgcVMoJyNzdGF0aWNfc2V0X3BhZ2VsZXQnKSB8fCBxUygnI3BhZ2VsZXRfcGhvdG9zX3N0cmVhbScpIHx8IHFTKCcjZ3JvdXBfcGhvdG9zZXQnKSB8fCBxUygnI2luaXRpYWxfYnJvd3NlX3Jlc3VsdCcpIHx8IHFTKCcjY29udGVudEFyZWEnKTsKICB2YXIgZ3JpZCA9IHFTQSgnI2ZiVGltZWxpbmVQaG90b3NGbGV4Z3JpZCwgLmZiU3RhckdyaWQsICcgKwogICAgJyNwYWdlc192aWRlb19odWJfYWxsX3ZpZGVvc19wYWdlbGV0Jyk7CiAgdmFyIHNlbGVjdG9yID0gJ2FbcmVsPSJ0aGVhdGVyIl0nOwogIHZhciB0bXAgPSBbXSwgdG1wRSwgZUxlbjsKICBpZihnLmVsbXMpe2FqYXhOZWVkZWQ9MTt9CiAgZWxzZSBpZihncmlkLmxlbmd0aCl7CiAgICBpZihncmlkLmxlbmd0aD4xKXsKICAgICAgZm9yKGVMZW4gPSAwOyBlTGVuPGdyaWQubGVuZ3RoOyBlTGVuKyspewogICAgICAgIHRtcEUgPSBncmlkW2VMZW5dLnF1ZXJ5U2VsZWN0b3JBbGwoZy50aHVtYlNlbGVjdG9yKTsKICAgICAgICBmb3IodmFyIHRtcExlbiA9IDA7IHRtcExlbjx0bXBFLmxlbmd0aDsgdG1wTGVuKyspewogICAgICAgICAgdG1wLnB1c2godG1wRVt0bXBMZW5dKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZWxtcyA9IHRtcDsgYWpheE5lZWRlZD0xOwogICAgfWVsc2V7ZWxtcz1ncmlkWzBdLnF1ZXJ5U2VsZWN0b3JBbGwoZy50aHVtYlNlbGVjdG9yKTthamF4TmVlZGVkPTE7fQogIH1lbHNlIGlmKGVsbXMpewogICAgdmFyIHRlbXAgPSBlbG1zLnF1ZXJ5U2VsZWN0b3JBbGwoZy50aHVtYlNlbGVjdG9yKTthamF4TmVlZGVkPTE7CiAgICBpZighdGVtcC5sZW5ndGgpewogICAgICB0ZXN0TmVlZGVkID0gMTsKICAgICAgdG1wRSA9IGVsbXMucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7CiAgICAgIGZvcihlTGVuID0gMDsgZUxlbiA8IHRtcEUubGVuZ3RoOyBlTGVuKyspewogICAgICAgIGlmICh0bXBFW2VMZW5dLnF1ZXJ5U2VsZWN0b3IoJ2ltZycpKSB7CiAgICAgICAgICB0bXAucHVzaCh0bXBFW2VMZW5dKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZWxtcyA9IHRtcDsKICAgIH1lbHNlewogICAgICBlbG1zID0gdGVtcDsKICAgIH0KICB9CiAgZWxzZXtlbG1zPXFTQShzZWxlY3Rvcik7dGVzdE5lZWRlZD0xO30KICBpZihxU0EoJy5mYlBob3RvU3RhckdyaWRFbGVtZW50Jykpe2FqYXhOZWVkZWQ9MTt9CgogIGlmIChnLmlzUGFnZSkgewogICAgaWYgKHFTKCdpbnB1dFt0eXBlPSJmaWxlIl1bYWNjZXB0PSJpbWFnZS8qIl0nKSkgewogICAgICBnLnBhZ2VUeXBlID0gJ290aGVyJzsKICAgIH0gZWxzZSB7CiAgICAgIGcucGFnZVR5cGUgPSAncG9zdGVkJzsKICAgIH0KICB9CgogIGlmKGcubW9kZSE9MiYmIWcubGFzdExvYWRlZCYmc2Nyb2xsRWxlJiYoIXFTKCcjc3RvcEFqYXhDa2InKXx8IXFTKCcjc3RvcEFqYXhDa2InKS5jaGVja2VkKSl7CiAgICBmYkF1dG9Mb2FkKGcuaXNQYWdlICYmICFnLmlzVmlkZW8gPyBbXSA6IGVsbXMpO3JldHVybjsKICB9CiAgZm9yIChpID0gMDtpPGVsbXMubGVuZ3RoO2krKykgewogICAgaWYgKHRlc3ROZWVkZWQpIHsKICAgICAgdmFyIHRlc3QxID0gKGdldFBhcmVudChlbG1zW2ldLCcubWFpbldyYXBwZXInKSYmZ2V0UGFyZW50KGVsbXNbaV0sJy5tYWluV3JhcHBlcicpLnF1ZXJ5U2VsZWN0b3IoJy5zaGFyZVN1YnRleHQnKSYmZWxtc1tpXS5jaGlsZE5vZGVzWzBdJiZlbG1zW2ldLmNoaWxkTm9kZXNbMF0udGFnTmFtZT09J0lNRycpOwogICAgICB2YXIgdGVzdDIgPSAoZ2V0UGFyZW50KGVsbXNbaV0sJy50aW1lbGluZVVuaXRDb250YWluZXInKSYmZ2V0UGFyZW50KGVsbXNbaV0sJy50aW1lbGluZVVuaXRDb250YWluZXInKS5xdWVyeVNlbGVjdG9yKCcuc2hhcmVVbml0JykpOwogICAgICB2YXIgdGVzdDMgPSAoZWxtc1tpXS5xdWVyeVNlbGVjdG9yKCdpbWcnKSYmIWVsbXNbaV0ucXVlcnlTZWxlY3RvcignaW1nJykuc2Nyb2xsSGVpZ2h0KTsKICAgICAgaWYgKHRlc3QxIHx8IHRlc3QyIHx8IHRlc3QzKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgIH0KICAgIHRyeXsKICAgIHZhciBhamF4aWZ5ID0gdW5lc2NhcGUoZWxtc1tpXS5nZXRBdHRyaWJ1dGUoJ2FqYXhpZnknKSkgfHwgJyc7CiAgICB2YXIgaHJlZiA9IGFqYXhpZnkuaW5kZXhPZignZmJpZD0nKSA+IC0xID8gYWpheGlmeSA6IGVsbXNbaV0uaHJlZjsKICAgIHZhciBpc1ZpZGVvID0gKGhyZWYuaW5kZXhPZignL3ZpZGVvcy8nKSA+IC0xIHx8IGcuaXNWaWRlbyk7CiAgICB2YXIgcGFyZW50U3JjID0gZWxtc1tpXS5wYXJlbnROb2RlID8gCiAgICAgIGVsbXNbaV0ucGFyZW50Tm9kZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtc3RhcnJlZC1zcmMnKSA6ICcnOwogICAgdmFyIGJnID0gIWlzVmlkZW8gPyBlbG1zW2ldLmNoaWxkTm9kZXNbMF0gOgogICAgICBlbG1zW2ldLnF1ZXJ5U2VsZWN0b3IoZy5pc1BhZ2UgPyAnaW1nJyA6ICdkaXZbc3R5bGVdLCAudWlWaWRlb0xpbmtJbWcnKTsKICAgIHZhciBzcmMgPSBiZyA/IGJnLmdldEF0dHJpYnV0ZSgnc3JjJykgOiAnJzsKICAgIGlmIChzcmMpIHsKICAgICAgaWYgKHNyYy5pbmRleE9mKCdyc3JjLnBocCcpID4gMCkgewogICAgICAgIHNyYyA9ICcnOwogICAgICB9IGVsc2UgaWYgKHNyYyAmJiBzcmMuaW5kZXhPZignPycpID09PSAtMSkgewogICAgICAgIHNyYyA9IHBhcnNlRmJTcmMoc3JjKTsKICAgICAgfQogICAgfQogICAgYmcgPSBiZyAmJiBiZy5zdHlsZSA/IChiZy5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgfHwgJycpLnNsaWNlKDUsIC0yKSA6ICcnOwogICAgdmFyIHVybCA9IHNyYyB8fCBwYXJlbnRTcmMgfHwgYmc7CiAgICB2YXIgb2hyZWYgPSBocmVmICsgJyc7CiAgICB2YXIgZmJpZCA9IGdldEZiaWQoaHJlZik7CiAgICBpZihocmVmLm1hdGNoKCdvcGFxdWVDdXJzb3InKSl7CiAgICAgIGlmKGZiaWQpewogICAgICAgIGhyZWYgPSBsb2NhdGlvbi5vcmlnaW4gKyAnL3Bob3RvLnBocD9mYmlkPScgKyBmYmlkOwogICAgICB9ZWxzZXsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgfWVsc2UgaWYoaHJlZi5tYXRjaCgnJicpKXsKICAgICAgaHJlZj1ocmVmLnNsaWNlKDAsIGhyZWYuaW5kZXhPZignJicpKTsKICAgIH0KICAgIGlmKCFnLmRvd25sb2FkZWRbZmJpZF0pe2cuZG93bmxvYWRlZFtmYmlkXT0xO31lbHNle2NvbnRpbnVlO30KICAgIHZhciBhamF4ID0gJyc7CiAgICBpZiAoIWcubm90TG9hZENtICYmICFpc1ZpZGVvKSB7CiAgICAgIHZhciBxID0ge307CiAgICAgIGlmICh1cmwuaW5kZXhPZignJnNyYycpICE9IC0xKSB7CiAgICAgICAgYWpheCA9IHVybC5zbGljZSh1cmwuaW5kZXhPZigiPyIpKzEsdXJsLmluZGV4T2YoIiZzcmMiKSkuc3BsaXQoIiYiKTsKICAgICAgICB1cmwgPSBwYXJzZUZiU3JjKHVybC5tYXRjaCgvJnNyYy4oLiopLylbMV0pLnJlcGxhY2UoLyZzbWFsbHNyYz0uKlw/LywgJz8nLCB0cnVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBhamF4ID0gb2hyZWYuc2xpY2Uob2hyZWYuaW5kZXhPZignPycpICsgMSkuc3BsaXQoJyYnKTsKICAgICAgICB2YXIgcHNldCA9IG9ocmVmLm1hdGNoKC9cL3Bob3Rvc1wvKFtcLlxkXHctXSspXC8vKTsKICAgICAgICBpZiAocHNldCkgewogICAgICAgICAgcSA9IHtzZXQ6IHBzZXRbMV19OwogICAgICAgIH0KICAgICAgfQogICAgICBmb3IodmFyIGo9MDtqPGFqYXgubGVuZ3RoO2orKyl7dmFyIGQ9YWpheFtqXS5zcGxpdCgiPSIpO3FbZFswXV09ZFsxXTt9CiAgICAgIGlmKCFxLmZiaWQgJiYgZmJpZCl7CiAgICAgICAgcS5mYmlkID0gZmJpZDsKICAgICAgfQogICAgICBhamF4ID0gbG9jYXRpb24ub3JpZ2luICsgJy9hamF4L3BhZ2VsZXQvZ2VuZXJpYy5waHAvJyArCiAgICAgICAgJ1Bob3RvVmlld2VySW5pdFBhZ2VsZXQ/YWpheHBpcGU9MSZhamF4cGlwZV90b2tlbj0nICsKICAgICAgICBnLkVudi5hamF4cGlwZV90b2tlbiArICcmbm9fc2NyaXB0X3BhdGg9MSZkYXRhPScgKyBKU09OLnN0cmluZ2lmeShxKSsKICAgICAgICAnJl9fdXNlcj0nICsgZy5FbnYudXNlciArICcmX19hPTEmX19hZHQ9Mic7CiAgICB9IGVsc2UgaWYgKCFnLm5vdExvYWRDbSAmJiBpc1ZpZGVvKSB7CiAgICAgIGlmIChnLmlzUGFnZSkgewogICAgICAgIGlmIChpID09PSAwKSB7CiAgICAgICAgICBhamF4ID0gbG9jYXRpb24ub3JpZ2luICsgJy92aWRlby9jaGFubmVsL3ZpZXcvc3RvcnkvYXN5bmMvJyArIGZiaWQgKwogICAgICAgICAgICAnLz92aWRlb19pZHNbMF09JyArIGZiaWQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFqYXggPSBsb2NhdGlvbi5vcmlnaW4gKyAnL3ZpZGVvL2NoYW5uZWwvdmlldy9hc3luYy8nICsgZy5wYWdlSWQgKwogICAgICAgICAgICAnLz9zdG9yeV9jb3VudD0yMCZvcmlnaW5hbF92aWRlb19pZD0nICsKICAgICAgICAgICAgZ2V0RmJpZChwaG90b2RhdGEucGhvdG9zW3Bob3RvZGF0YS5waG90b3MubGVuZ3RoIC0gMV0uaHJlZik7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHZhciBpZCA9IGhyZWYubWF0Y2goL1wvdmlkZW9zXC8oW1x3K1xkXC4tXSspXC8oXGQrKS8pOwogICAgICAgIHZhciBxID0gewogICAgICAgICAgdHlwZTogMywKICAgICAgICAgIHY6IGlkWzJdLAogICAgICAgICAgc2V0OiBpZFsxXQogICAgICAgIH07CiAgICAgICAgYWpheCA9IGxvY2F0aW9uLm9yaWdpbiArICcvYWpheC9wYWdlbGV0L2dlbmVyaWMucGhwLycgKwogICAgICAgICAgJ1Bob3RvVmlld2VySW5pdFBhZ2VsZXQ/YWpheHBpcGU9MSZhamF4cGlwZV90b2tlbj0nICsKICAgICAgICAgIGcuRW52LmFqYXhwaXBlX3Rva2VuICsgJyZub19zY3JpcHRfcGF0aD0xJmRhdGE9JyArIEpTT04uc3RyaW5naWZ5KHEpICsKICAgICAgICAgICcmX191c2VyPScgKyBnLkVudi51c2VyICsgJyZfX2E9MSZfX2FkdD0yJzsKICAgICAgfQogICAgfQogICAgaWYodXJsLm1hdGNoKC9cPy8pKXsKICAgICAgdmFyIGI9dXJsLnNwbGl0KCc/JyksIHQ9JycsIGE9YlsxXS5zcGxpdCgnJicpOwogICAgICBmb3IodmFyIGlpPTA7aWk8YS5sZW5ndGg7aWkrKyl7CiAgICAgICAgaWYoYVtpaV0ubWF0Y2goL29ofG9lfF9fZ2RhX18vKSl0Kz1hW2lpXSsnJic7CiAgICAgIH0KICAgICAgdXJsID0gYlswXSArICh0Lmxlbmd0aD8oJz8nK3Quc2xpY2UoMCwgLTEpKTonJyk7CiAgICB9IGVsc2UgaWYgKHVybC5pbmRleE9mKCcmJykgPiAwKSB7CiAgICAgIHVybCA9IHVybC5zbGljZSgwLCB1cmwuaW5kZXhPZignJicpKTsKICAgIH0KICAgIHZhciB0aXRsZSA9IGVsbXNbaV0uZ2V0QXR0cmlidXRlKCd0aXRsZScpIHx8IChlbG1zW2ldLnF1ZXJ5U2VsZWN0b3IoJ2ltZycpID8KICAgICAgZWxtc1tpXS5xdWVyeVNlbGVjdG9yKCdpbWcnKS5nZXRBdHRyaWJ1dGUoJ2FsdCcpIDogJycpIHx8ICcnOwogICAgdGl0bGU9dGl0bGUuaW5kZXhPZignICcpPjA/dGl0bGU6Jyc7CiAgICB0aXRsZT10aXRsZS5pbmRleE9mKCc6ICcpPjB8fHRpdGxlLmluZGV4T2YoJ++8miAnKT4wP3RpdGxlLnNsaWNlKHRpdGxlLmluZGV4T2YoJyAnKSsxKTp0aXRsZTsKICAgIGlmKCF0aXRsZSl7CiAgICB0PWdldFBhcmVudChlbG1zW2ldLCcudGltZWxpbmVVbml0Q29udGFpbmVyJyl8fGdldFBhcmVudChlbG1zW2ldLCcubWFpbldyYXBwZXInKTsKICAgIGlmKHQpe3ZhciB0YXJnZXQxPXQucXVlcnlTZWxlY3RvckFsbCgnLmZ3YicpLmxlbmd0aD4xPycnOnQucXVlcnlTZWxlY3RvcignLnVzZXJDb250ZW50Jyk7fQogICAgdmFyIHRhcmdldDI9ZWxtc1tpXS5nZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnKXx8Jyc7CiAgICBpZih0YXJnZXQyKXt0aXRsZT10YXJnZXQyO30KICAgIGlmKHRpdGxlPT09JycmJnRhcmdldDEpe3RpdGxlPXRhcmdldDEuaW5uZXJIVE1MLm1hdGNoKC88YnI+fDx3YnI+Lyk/dGFyZ2V0MS5vdXRlckhUTUwucmVwbGFjZSgvJy9nLCcmcXVvdDsnKTp0YXJnZXQxLnRleHRDb250ZW50O30KICAgIH0KICAgIHZhciBuZXdQaG90bz17dXJsOiB1cmwsIGhyZWY6IGhyZWZ9OwogICAgbmV3UGhvdG8udGl0bGU9dGl0bGU7CiAgICBpZiAoZWxtc1tpXS5kYXRhc2V0LmRhdGUpIHsKICAgICAgbmV3UGhvdG8uZGF0ZSA9IHBhcnNlVGltZShlbG1zW2ldLmRhdGFzZXQuZGF0ZSk7CiAgICB9CiAgICBpZighZy5ub3RMb2FkQ20pbmV3UGhvdG8uYWpheD1hamF4OwogICAgcGhvdG9kYXRhLnBob3Rvcy5wdXNoKG5ld1Bob3RvKTsKICAgIH1jYXRjaChlKXtsb2coZSk7fQogIH0KICBpZihxUygnI3N0b3BBamF4Q2tiJykmJnFTKCcjc3RvcEFqYXhDa2InKS5jaGVja2VkKXtxUygnI3N0b3BBamF4Q2tiJykuY2hlY2tlZD1mYWxzZTt9CiAgbG9nKCdleHBvcnQgJytwaG90b2RhdGEucGhvdG9zLmxlbmd0aCsnIHBob3Rvcy4nKTsKICBpZighZy5ub3RMb2FkQ20pewogICAgaWYgKGFqYXhOZWVkZWQgJiYgKGcubG9hZENtIHx8IGNvbmZpcm0oIlRyeSB0byBsb2FkIHBob3RvJ3MgY2FwdGlvbj8iKSkpIHsKICAgICAgZy5lbG1zID0gbnVsbDsKICAgICAgZmJBamF4KCk7CiAgICB9IGVsc2Uge291dHB1dCgpO30KICB9ZWxzZXtvdXRwdXQoKTt9Cn0KZnVuY3Rpb24gZ2V0RmJNZXNzYWdlc1Bob3RvcygpIHsKICBpZiAoIWcub2Zmc2V0KSB7CiAgICBnLmFqYXhSZXRyeSA9IHt9OwogICAgZy5vZmZzZXQgPSAwOwogICAgZy5waG90b2RhdGEuYU5hbWUgPSBnZXRUZXh0KCcuZmJfY29udGVudCBbcm9sZT0ibWFpbiJdIGgyJyk7CiAgICBnLnBob3RvZGF0YS5hRGVzID0gJyc7CiAgICBnZXRGYkR0c2coKTsKICAgIHZhciBoZWFkZXJzID0gcVNBKCdbcm9sZT0iZ3JpZGNlbGwiXSwgW2lkXj0icm93X2hlYWRlcl9pZF91c2VyOiJdJyk7CiAgICB2YXIgcm93cyA9IFtdOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBoZWFkZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHJvd3MucHVzaCh7ZTogaGVhZGVyc1tpXSwgbGVuOiBoZWFkZXJzW2ldLnBhcmVudE5vZGUuY2xhc3NOYW1lLmxlbmd0aH0pOwogICAgfQogICAgcm93cy5zb3J0KGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgcmV0dXJuIGEubGVuID4gYi5sZW4gPyAtMSA6IGEubGVuID09PSBiLmxlbiA/IDAgOiAxOwogICAgfSk7CiAgICBnLnRocmVhZElkID0gcm93c1swXS5lLmlkLnNwbGl0KCc6JylbMV07CiAgfQogIHZhciB1cmwgPSBsb2NhdGlvbi5vcmlnaW4gKyAnL2FqYXgvbWVzc2FnaW5nL2F0dGFjaG1lbnRzL3NoYXJlZHBob3Rvcy5waHAnOwogIHZhciBkYXRhID0gJ3RocmVhZF9pZD0nK2cudGhyZWFkSWQrJyZvZmZzZXQ9JytnLm9mZnNldCsnJmxpbWl0PTMwJl9fdXNlcj0nK2cuRW52LnVzZXIrJyZfX2E9MSZfX3JlcT03JmZiX2R0c2c9JytnLmZiX2R0c2c7CiAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwogIHhoci5vbmxvYWQgPSBmdW5jdGlvbigpewogICAgdmFyIGVsbXMgPSBnLmVsbXMubGVuZ3RoID8gZy5lbG1zIDogW107CiAgICB2YXIgcGF5bG9hZCA9IEpTT04ucGFyc2UodGhpcy5yZXNwb25zZS5zbGljZSg5KSkucGF5bG9hZDsKICAgIGlmKHBheWxvYWQuaW1hZ2VzRGF0YSl7CiAgICAgIGVsbXMgPSBlbG1zLmNvbmNhdChwYXlsb2FkLmltYWdlc0RhdGEpOwogICAgICBpZihlbG1zLmxlbmd0aCl7CiAgICAgICAgZy5lbG1zID0gZWxtczsKICAgICAgICBpZihwYXlsb2FkLm1vcmVJbWFnZXNUb0xvYWQpewogICAgICAgICAgZy5vZmZzZXQgKz0gMzA7CiAgICAgICAgICBnZXRGYk1lc3NhZ2VzUGhvdG9zKCk7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICBmYkFqYXhBdHRhY2htZW50KCk7CiAgICAgICAgfQogICAgICB9ZWxzZXsKICAgICAgICBhbGVydCgnTm8gcGhvdG8gYXR0YWNobWVudHMgZm91bmQuJyk7CiAgICAgIH0KICAgIH0KICB9OwogIHhoci5vcGVuKCdQT1NUJywgdXJsKTsKICB4aHIuc2V0UmVxdWVzdEhlYWRlcigiQ29udGVudC10eXBlIiwgImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCIpOwogIHhoci5zZW5kKGRhdGEpOwp9CmZ1bmN0aW9uIGZiQWpheEF0dGFjaG1lbnQoKXsKICB2YXIgbGVuID0gZy5lbG1zLmxlbmd0aCwgaSA9IGcuYWpheExvYWRlZDsKICBpZihsZW4gJiYgbGVuID4gZy5waG90b2RhdGEucGhvdG9zLmxlbmd0aCl7CiAgICB2YXIgZWxtcyA9IGcuZWxtc1tpXTsKICAgIHZhciBmYmlkID0gZWxtcy5mYmlkOwogICAgaWYoIWcuYWpheFJldHJ5W2ZiaWRdKXsKICAgICAgZy5hamF4UmV0cnlbZmJpZF0gPSAwOwogICAgfQogICAgaWYoIWcuZGF0YUxvYWRlZFtmYmlkXSAmJiBnLmFqYXhSZXRyeVtmYmlkXTwzKXsKICAgICAgZy5hamF4UmV0cnlbZmJpZF0rKzsKICAgICAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwogICAgICB4aHIub25sb2FkID0gZnVuY3Rpb24oKXsKICAgICAgICB2YXIgb3V0cHV0ID0gSlNPTi5wYXJzZShKU09OLnBhcnNlKHRoaXMucmVzcG9uc2Uuc2xpY2UoOSkpLnBheWxvYWQub3V0cHV0KTsKICAgICAgICB2YXIgaW1hZ2VzID0gb3V0cHV0W2cudGhyZWFkSWRdLm1lc3NhZ2VfaW1hZ2VzLmVkZ2VzCiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGltYWdlcy5sZW5ndGg7IGkrKyl7CiAgICAgICAgICBnLmRhdGFMb2FkZWRbaW1hZ2VzW2ldLm5vZGUuaWRdID0gMTsKICAgICAgICAgIGcucGhvdG9kYXRhLnBob3Rvcy5wdXNoKHsKICAgICAgICAgICAgaHJlZjogJycsCiAgICAgICAgICAgIHVybDogaW1hZ2VzW2ldLm5vZGUuaW1hZ2UyLnVyaQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGcuYWpheExvYWRlZCsrOwogICAgICAgIGZiQWpheEF0dGFjaG1lbnQoKTsKICAgICAgfTsKICAgICAgeGhyLm9wZW4oJ1BPU1QnLCBsb2NhdGlvbi5vcmlnaW4gKyAnL2FqYXgvZ3JhcGhxbC9xdWVyeS8nKTsKICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoIkNvbnRlbnQtdHlwZSIsICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiKTsKICAgICAgdmFyIGFmdGVyID0gaSA+IDAgPyAoJyZwYXJhbXNbYWZ0ZXJdPScgKyBnLmVsbXNbaSAtIDFdLmZiaWQpIDogJyc7CiAgICAgIHZhciBkYXRhID0gJ3F1ZXJ5TmFtZT1NRVNTQUdFX1RIUkVBRF9JTUFHRVNfRklSU1QnK2FmdGVyKycmcGFyYW1zW2ZpcnN0XT0xOSZwYXJhbXNbdGhyZWFkX2lkXT0nK2cudGhyZWFkSWQrJyZfX3VzZXI9JytnLkVudi51c2VyKycmX19hPTEmX19yZXE9NyZmYl9kdHNnPScrZy5mYl9kdHNnOwogICAgICB4aHIuc2VuZChkYXRhKTsKICAgIH1lbHNlewogICAgICBpZihnLmFqYXhSZXRyeVtmYmlkXSA+IDMpewogICAgICAgIGcucGhvdG9kYXRhLnBob3Rvcy5wdXNoKHsKICAgICAgICAgIGhyZWY6ICcnLAogICAgICAgICAgdXJsOiBlbG1zLnVybAogICAgICAgIH0pOwogICAgICB9CiAgICAgIGcuYWpheExvYWRlZCsrOwogICAgICBmYkFqYXhBdHRhY2htZW50KCk7CiAgICB9CiAgfWVsc2UgaWYoZy5waG90b2RhdGEucGhvdG9zLmxlbmd0aCl7CiAgICBvdXRwdXQoKTsKICB9Cn0KZnVuY3Rpb24gZ2V0UUwodHlwZSwgdGFyZ2V0LCBrZXkpIHsKICBpZiAoZy5wYWdlVHlwZSA9PT0gJ2FsYnVtJykgewogICAgaWYgKCFnLmVsbXMubGVuZ3RoICYmICFnLmFqYXhTdGFydEZyb20pIHsKICAgICAgcmV0dXJuICdRdWVyeSBQaG90b0FsYnVtUm91dGUge25vZGUoJyArIGcucGFnZUFsYnVtSWQgKwogICAgICAgICcpIHtpZCxfX3R5cGVuYW1lLEBGOH19IFF1ZXJ5RnJhZ21lbnQgRjAgOiBQaG90byB7YWxidW0geycgKwogICAgICAgICdhbGJ1bV90eXBlLGlkfSxjYW5fdmlld2VyX2VkaXQsaWQsb3duZXIge2lkLF9fdHlwZW5hbWV9fSAnICsKICAgICAgICAnUXVlcnlGcmFnbWVudCBGMSA6IFBob3RvIHtjYW5fdmlld2VyX2RlbGV0ZSxpZH0gUXVlcnlGcmFnbWVudCBGMiA6ICcgKwogICAgICAgICdGZWVkYmFjayB7ZG9lc192aWV3ZXJfbGlrZSxpZH0gUXVlcnlGcmFnbWVudCBGMyA6IFBob3RvIHtpZCxhbGJ1bSB7JyArCiAgICAgICAgJ2lkLG5hbWV9LGZlZWRiYWNrIHtpZCxjYW5fdmlld2VyX2NvbW1lbnQsY2FuX3ZpZXdlcl9saWtlLGxpa2VycyB7JyArCiAgICAgICAgJ2NvdW50fSxjb21tZW50cyB7Y291bnR9LEBGMn19IFF1ZXJ5RnJhZ21lbnQgRjQgOiBQaG90byB7JyArCiAgICAgICAgJ2Nhbl92aWV3ZXJfZWRpdCxpZCxpbWFnZSBhcyBfaW1hZ2UxTFAwcmQge3VyaX0sdXJsLG1vZGlmaWVkX3RpbWUsJyArCiAgICAgICAgJ21lc3NhZ2Uge3RleHR9LEBGMCxARjEsQEYzfSBRdWVyeUZyYWdtZW50IEY1IDogTm9kZSB7aWQsX190eXBlbmFtZX0nICsKICAgICAgICAnIFF1ZXJ5RnJhZ21lbnQgRjYgOiBBbGJ1bSB7Y2FuX3VwbG9hZCxpZH0gUXVlcnlGcmFnbWVudCBGNyA6IEFsYnVtJyArCiAgICAgICAgJyB7aWQsbWVkaWEuZmlyc3QoMjgpIGFzICcgKyBrZXkgKyAnIHtlZGdlcyB7bm9kZSB7X190eXBlbmFtZSxARjQsJyArCiAgICAgICAgJ0BGNX0sY3Vyc29yfSxwYWdlX2luZm8ge2hhc19uZXh0X3BhZ2UsaGFzX3ByZXZpb3VzX3BhZ2V9fSxvd25lciB7JyArCiAgICAgICAgJ2lkLF9fdHlwZW5hbWV9LEBGNn0gUXVlcnlGcmFnbWVudCBGOCA6IEFsYnVtIHtjYW5fZWRpdF9jYXB0aW9uLCcgKwogICAgICAgICdjYW5fdXBsb2FkLGlkLG1lZGlhLmZpcnN0KDI4KSBhcyAnICsga2V5ICsgJyB7ZWRnZXMge25vZGUgeycgKwogICAgICAgICdfX3R5cGVuYW1lLEBGNCxARjV9LGN1cnNvcn0scGFnZV9pbmZvIHtoYXNfbmV4dF9wYWdlLCcgKwogICAgICAgICdoYXNfcHJldmlvdXNfcGFnZX19LG1lc3NhZ2Uge3RleHR9LG1vZGlmaWVkX3RpbWUsb3duZXIgeycgKwogICAgICAgICdpZCxuYW1lLF9fdHlwZW5hbWV9LEBGNixARjd9JzsKICAgIH0KICAgIHJldHVybiAnUXVlcnkgJyArIHR5cGUgKyAnIHtub2RlKCcrIGcucGFnZUFsYnVtSWQgKwogICAgICAnKSB7QEY2fX0gUXVlcnlGcmFnbWVudCBGMCA6IFBob3RvIHthbGJ1bSB7YWxidW1fdHlwZSxpZH0sJyArCiAgICAgICdjYW5fdmlld2VyX2VkaXQsaWQsb3duZXIge2lkLF9fdHlwZW5hbWV9fSBRdWVyeUZyYWdtZW50IEYxIDogJyArCiAgICAgICdQaG90byB7Y2FuX3ZpZXdlcl9kZWxldGUsaWR9IFF1ZXJ5RnJhZ21lbnQgRjIgOiBGZWVkYmFjayAnICsKICAgICAgJ3tkb2VzX3ZpZXdlcl9saWtlLGlkfSBRdWVyeUZyYWdtZW50IEYzIDogUGhvdG8ge2lkLGFsYnVtIHtpZCxuYW1lfSwnICsKICAgICAgJ2ZlZWRiYWNrIHtpZCxjYW5fdmlld2VyX2NvbW1lbnQsY2FuX3ZpZXdlcl9saWtlLGxpa2VycyB7Y291bnR9LCcgKwogICAgICAnY29tbWVudHMge2NvdW50fSxARjJ9fSBRdWVyeUZyYWdtZW50IEY0IDogUGhvdG8ge2Nhbl92aWV3ZXJfZWRpdCxpZCwnICsKICAgICAgJ2ltYWdlIGFzIF9pbWFnZTFMUDByZCB7dXJpfSx1cmwsbW9kaWZpZWRfdGltZSxtZXNzYWdlIHt0ZXh0fSwnICsKICAgICAgJ0BGMCxARjEsQEYzfSBRdWVyeUZyYWdtZW50IEY1IDogTm9kZSAnICsKICAgICAgJ3tpZCxfX3R5cGVuYW1lfSBRdWVyeUZyYWdtZW50IEY2IDogJyArIHRhcmdldCArCiAgICAgICcuZmlyc3QoMjgpIGFzICcgKyBrZXkgKycge2VkZ2VzIHtub2RlIHtfX3R5cGVuYW1lLEBGNCxARjV9LGN1cnNvcn0sJyArCiAgICAgICdwYWdlX2luZm8ge2hhc19uZXh0X3BhZ2UsaGFzX3ByZXZpb3VzX3BhZ2V9fX0nOwogIH0gZWxzZSB7CiAgICBpZiAoZy5wYWdlVHlwZSA9PT0gJ290aGVyJyAmJiAhZy5lbG1zLmxlbmd0aCAmJiAhZy5hamF4U3RhcnRGcm9tKSB7CiAgICAgIHJldHVybiAnUXVlcnkgTWVkaWFQYWdlUm91dGUge25vZGUoJyArIGcucGFnZUlkICsgJykge2lkLF9fdHlwZW5hbWUsJyArCiAgICAgICAgJ0BGNX19IFF1ZXJ5RnJhZ21lbnQgRjAgOiBQaG90byB7YWxidW0ge2FsYnVtX3R5cGUsaWR9LCcgKwogICAgICAgICdjYW5fdmlld2VyX2VkaXQsaWQsb3duZXIge2lkLF9fdHlwZW5hbWV9fSBRdWVyeUZyYWdtZW50IEYxIDogJyArCiAgICAgICAgJ1Bob3RvIHtjYW5fdmlld2VyX2RlbGV0ZSxpZH0gUXVlcnlGcmFnbWVudCBGMiA6IEZlZWRiYWNrIHsnICsKICAgICAgICAnZG9lc192aWV3ZXJfbGlrZSxpZH0gUXVlcnlGcmFnbWVudCBGMyA6IFBob3RvIHtpZCxhbGJ1bSB7aWQsbmFtZX0nICsKICAgICAgICAnLGZlZWRiYWNrIHtpZCxjYW5fdmlld2VyX2NvbW1lbnQsY2FuX3ZpZXdlcl9saWtlLGxpa2VycyB7Y291bnR9LCcgKwogICAgICAgICdjb21tZW50cyB7Y291bnR9LEBGMn19IFF1ZXJ5RnJhZ21lbnQgRjQgOiBQaG90byB7Y2FuX3ZpZXdlcl9lZGl0LCcgKwogICAgICAgICdpZCxpbWFnZSBhcyBfaW1hZ2UxTFAwcmQge3VyaX0sdXJsLG1vZGlmaWVkX3RpbWUsbWVzc2FnZSB7dGV4dH0sJyArCiAgICAgICAgJ0BGMCxARjEsQEYzfSBRdWVyeUZyYWdtZW50IEY1IDogUGFnZSB7aWQscGhvdG9zX2J5X290aGVycy5maXJzdCgyOCknICsKICAgICAgICAnIGFzIF9waG90b3NfYnlfb3RoZXJzNHZ0ZFZUIHtjb3VudCxlZGdlcyB7bm9kZSB7aWQsQEY0fSxjdXJzb3J9LCAnICsKICAgICAgICAncGFnZV9pbmZvIHtoYXNfbmV4dF9wYWdlLGhhc19wcmV2aW91c19wYWdlfX19JzsKICAgIH0KICAgIHJldHVybiAnUXVlcnkgJyArIHR5cGUgKyAnIHtub2RlKCcgKyBnLnBhZ2VJZCArCiAgICAgICcpIHtARjN9fSBRdWVyeUZyYWdtZW50IEYwIDogRmVlZGJhY2sge2RvZXNfdmlld2VyX2xpa2UsaWR9ICcgKwogICAgICAnUXVlcnlGcmFnbWVudCBGMSA6IFBob3RvIHtpZCxhbGJ1bSB7aWQsbmFtZX0sZmVlZGJhY2sgJyArCiAgICAgICd7aWQsY2FuX3ZpZXdlcl9jb21tZW50LGNhbl92aWV3ZXJfbGlrZSxsaWtlcnMge2NvdW50fSwnICsKICAgICAgJ2NvbW1lbnRzIHtjb3VudH0sQEYwfX0gUXVlcnlGcmFnbWVudCBGMiA6IFBob3RvIHtpbWFnZScgKwogICAgICAnIGFzIF9pbWFnZTFMUDByZCB7dXJpfSx1cmwsaWQsbW9kaWZpZWRfdGltZSxtZXNzYWdlIHt0ZXh0fSxARjF9ICcgKwogICAgICAnUXVlcnlGcmFnbWVudCBGMyA6ICcgKyB0YXJnZXQgKyAnLmZpcnN0KDI4KSBhcyAnICsga2V5ICsgJyB7ZWRnZXMgeycgKwogICAgICAnbm9kZSB7aWQsQEYyfSxjdXJzb3J9LHBhZ2VfaW5mbyB7aGFzX25leHRfcGFnZSxoYXNfcHJldmlvdXNfcGFnZX19fSc7CiAgfQp9CmZ1bmN0aW9uIGZiTG9hZFBhZ2UoKSB7CiAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwogIHZhciBrZXksIHR5cGUsIHRhcmdldDsKICBzd2l0Y2ggKGcucGFnZVR5cGUpIHsKICAgIGNhc2UgJ2FsYnVtJzoKICAgICAga2V5ID0gJ19tZWRpYTF4WTR2dSc7CiAgICAgIHR5cGUgPSAnUGFnZVBob3Rvc1RhYkFsYnVtUGhvdG9zR3JpZF9yZWFjdF9BbGJ1bVJlbGF5UUwnOwogICAgICB0YXJnZXQgPSAnQWxidW0ge2lkLG1lZGlhJyArIChnLmVsbXMubGVuZ3RoIHx8IGcubGFzdF9mYmlkID8KICAgICAgICAoJy5hZnRlcignICsgZy5sYXN0X2ZiaWQgKyAnKScpIDogJycpOwogICAgICBicmVhazsKICAgIGNhc2UgJ290aGVyJzoKICAgICAga2V5ID0gJ19waG90b3NfYnlfb3RoZXJzNHZ0ZFZUJzsKICAgICAgdHlwZSA9ICdQYWdlUGhvdG9zVGFiUG9zdEJ5T3RoZXJzUGhvdG9Hcmlkc19yZWFjdF9QYWdlUmVsYXlRTCc7CiAgICAgIHRhcmdldCA9ICdQYWdlIHtpZCxwaG90b3NfYnlfb3RoZXJzJyArIChnLmVsbXMubGVuZ3RoIHx8IGcubGFzdF9mYmlkID8KICAgICAgICAoJy5hZnRlcignICsgZy5sYXN0X2ZiaWQgKyAnKScpIDogJycpOwogICAgICBicmVhazsKICAgIGNhc2UgJ3Bvc3RlZCc6CiAgICBkZWZhdWx0OgogICAgICBrZXkgPSAnX3Bvc3RlZF9waG90b3MxQjI1R0cnOwogICAgICB0eXBlID0gJ1BhZ2VQaG90b3NUYWJBbGxQaG90b3NHcmlkX3JlYWN0X1BhZ2VSZWxheVFMJzsKICAgICAgdGFyZ2V0ID0gJ1BhZ2Uge2lkLHBvc3RlZF9waG90b3MnICsgKGcuZWxtcy5sZW5ndGggfHwgZy5sYXN0X2ZiaWQgPwogICAgICAgICgnLmFmdGVyKCcgKyBnLmxhc3RfZmJpZCArICcpJykgOiAnJyk7CiAgfQogIHhoci5vbmxvYWQgPSBmdW5jdGlvbigpIHsKICAgIHZhciByID0gZXh0cmFjdEpTT04odGhpcy5yZXNwb25zZVRleHQpOwogICAgdmFyIGQgPSByLnEwLnJlc3BvbnNlW2cucGFnZUFsYnVtSWQgfHwgZy5wYWdlSWRdW2tleV07CiAgICB2YXIgaW1hZ2VzID0gZC5lZGdlcywgaW1nLCBlID0gW107CiAgICB2YXIgZG9jID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGltYWdlcy5sZW5ndGg7IGkrKykgewogICAgICBpbWcgPSBpbWFnZXNbaV0ubm9kZTsKICAgICAgZG9jLmlubmVySFRNTCA9ICc8YSBocmVmPSInICsgaW1nLnVybCArICciIHJlbD0idGhlYXRlciIgZGF0YS1kYXRlPSInICsKICAgICAgICBpbWcubW9kaWZpZWRfdGltZSArICciPjxpbWcgc3JjPSInICsgaW1nLl9pbWFnZTFMUDByZC51cmkgKyAnIiBhbHQ9IicgKwogICAgICAgIChpbWcubWVzc2FnZSA/IGltZy5tZXNzYWdlLnRleHQgOiAnJykgKyAnIj48L2E+JzsKICAgICAgZS5wdXNoKGRvYy5jaGlsZE5vZGVzWzBdLmNsb25lTm9kZSh0cnVlKSk7CiAgICAgIGcubGFzdF9mYmlkID0gaW1hZ2VzW2ldLmN1cnNvciB8fCBpbWcuaWQ7CiAgICB9CiAgICBnLmVsbXMgPSBnLmVsbXMuY29uY2F0KGUpOwogICAgaWYgKGcucGFnZVR5cGUgPT09ICdhbGJ1bScgJiYgaW1hZ2VzLmxlbmd0aCkgewogICAgICBnLnBob3RvZGF0YS5hTmFtZSA9IGltYWdlc1swXS5ub2RlLmFsYnVtLm5hbWU7CiAgICB9CgogICAgZy5zdGF0dXNFbGUudGV4dENvbnRlbnQgPSAnTG9hZGluZyBhbGJ1bS4uLiAoJyArIGcuZWxtcy5sZW5ndGggKyAnKSc7CiAgICBkb2N1bWVudC50aXRsZSA9ICcoJyArIGcuZWxtcy5sZW5ndGggKyAnKSB8fCcgKyBnLnBob3RvZGF0YS5hTmFtZTsKCiAgICBpZiAoZC5wYWdlX2luZm8gJiYgZC5wYWdlX2luZm8uaGFzX25leHRfcGFnZSAmJiAhcVMoJyNzdG9wQWpheENrYicpLmNoZWNrZWQpIHsKICAgICAgc2V0VGltZW91dChmYkxvYWRQYWdlLCAxMDAwKTsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnNvbGUubG9nKCdMb2FkZWQgJyArIGcuZWxtcy5sZW5ndGggKyAnIHBob3Rvcy4nKTsKICAgICAgZy5sYXN0TG9hZGVkID0gMTsKICAgICAgc2V0VGltZW91dChnZXRQaG90b3MsIDEwMDApOwogICAgfQogIH0KICB4aHIub3BlbignUE9TVCcsIGxvY2F0aW9uLm9yaWdpbiArICcvYXBpL2dyYXBocWxiYXRjaC8nKTsKICB4aHIuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC10eXBlJywgJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcpOwogIHZhciBxID0gSlNPTi5zdHJpbmdpZnkoe3EwIDogewogICAgcHJpb3JpdHk6IDAsCiAgICBxOiBnZXRRTCh0eXBlLCB0YXJnZXQsIGtleSksCiAgICBxdWVyeV9wYXJhbXM6IHt9CiAgfX0pOwogIHZhciBkYXRhID0gJ19fdXNlcj0nICsgZy5FbnYudXNlciArICcmbWV0aG9kPUdFVCZyZXNwb25zZV9mb3JtYXQ9anNvbicgKwogICAgJyZmYl9kdHNnPScgKyBnLmZiX2R0c2cgKyAnJmJhdGNoX25hbWU9JyArIHR5cGUgKyAnJnF1ZXJpZXM9JyArIHE7CiAgeGhyLnNlbmQoZGF0YSk7Cn0KZnVuY3Rpb24gZ2V0RmJEdHNnKCkgewogIHZhciBzID0gcVNBKCdzY3JpcHQnKTsKICBmb3IgKHZhciBpID0gMDsgaSA8IHMubGVuZ3RoOyBpKyspIHsKICAgIGlmIChzW2ldLnRleHRDb250ZW50LmluZGV4T2YoJ0RUU0dJbml0aWFsRGF0YScpID4gMCkgewogICAgICBzID0gc1tpXS50ZXh0Q29udGVudDsKICAgICAgYnJlYWs7CiAgICB9CiAgfQogIHMgPSBzLnNsaWNlKHMuaW5kZXhPZignRFRTR0luaXRpYWxEYXRhJykpOwogIHMgPSBzLnNsaWNlKDAsIHMuaW5kZXhPZignfScpKS5zcGxpdCgnIicpOwogIGlmICghcy5sZW5ndGggfHwgIXNbNF0pIHsKICAgIGZiQXV0b0xvYWRGYWlsZWQoKTsKICAgIHJldHVybjsKICB9CiAgZy5mYl9kdHNnID0gc1s0XTsKfQpmdW5jdGlvbiBmYkF1dG9Mb2FkRmFpbGVkKCl7CiAgaWYoY29uZmlybSgnQ2Fubm90IGxvYWQgcmVxdWlyZWQgdmFyaWFibGUsIHJlZnJlc2ggcGFnZSB0byByZXRyeT8nKSl7CiAgICBsb2NhdGlvbi5yZWxvYWQoKTsKICB9ZWxzZXsKICAgIGcubGFzdExvYWRlZD0xO2dldFBob3RvcygpOwogIH0KfQpmdW5jdGlvbiBmYkF1dG9Mb2FkKGVsbXMpewogIHZhciBsOyBpZihnLmFqYXhTdGFydEZyb20pewogICAgZWxtcyA9IFtdOwogICAgZy5lbG1zID0gW107CiAgICBsID0gZy5hamF4U3RhcnRGcm9tOwogIH0gZWxzZSBpZiAoZWxtcy5sZW5ndGgpIHsKICAgIGZvciAodmFyIGkgPSBlbG1zLmxlbmd0aCAtIDE7IGkgPiBlbG1zLmxlbmd0aCAtIDUgJiYgIWw7IGktLSkgewogICAgICBsID0gZ2V0RmJpZChlbG1zW2ldLmdldEF0dHJpYnV0ZSgnYWpheGlmeScpKSB8fCBnZXRGYmlkKGVsbXNbaV0uaHJlZik7CiAgICB9CiAgICBpZighbCl7CiAgICAgIGFsZXJ0KCJBdXRvbG9hZCBmYWlsZWQhIik7Zy5sYXN0TG9hZGVkPTE7Z2V0UGhvdG9zKCk7CiAgICAgIHJldHVybjsKICAgIH0KICB9CiAgdmFyIGFqYXhBbGJ1bSA9ICcnLCB0YXJnZXRVUkwsIHRhYiwgcFR5cGU7CiAgaWYoIWcubGFzdF9mYmlkKXsKICAgIGcubGFzdF9mYmlkID0gbDsKICB9ZWxzZSBpZihnLmxhc3RfZmJpZD09bCl7CiAgICBpZihnLmFqYXhSZXRyeTw1ICYmIGVsbXMubGVuZ3RoID4gMil7bD1lbG1zW2VsbXMubGVuZ3RoLTJdLmhyZWY7bD1sLnNsaWNlKGwuaW5kZXhPZignPScpKzEsbC5pbmRleE9mKCcmJykpO2cuYWpheFJldHJ5Kys7fQogICAgZWxzZSBpZihjb25maXJtKCdSZWFjaGVzIGVuZCBvZiBhbGJ1bSAvIFRpbWVvdXRlZC5cblRyeSBhZ2Fpbi0+T0tcbk91dHB1dCBsb2FkZWQgcGhvdG9zLT5DYW5jZWwnKSl7Zy5hamF4UmV0cnk9MDt9ZWxzZXtnLmxhc3RMb2FkZWQ9MTtnZXRQaG90b3MoKTtyZXR1cm47fQogIH1lbHNlewogICAgZy5sYXN0X2ZiaWQ9bDsKICB9CiAgdmFyIHAgPSBsb2NhdGlvbi5ocmVmICsgJyYnOwogIHZhciBpc0FsID0gcC5tYXRjaCgvbWVkaWFcL3NldHxtZWRpYXxzZXQ9YS8pCiAgdmFyIGFJbmZvID0ge307CiAgdmFyIGlzUFMgPSBwLm1hdGNoKC9waG90b3Nfc3RyZWFtLyk7CiAgdmFyIGlzR3AgPSBwLm1hdGNoKC9ncm91cC8pOwogIHZhciBpc0dyYXBoID0gcC5tYXRjaCgvc2VhcmNoLyk7CiAgaWYgKGcuaXNQYWdlICYmICFnLmlzVmlkZW8pIHsKICAgIGlmICghZy5wYWdlSWQpewogICAgICBmYkF1dG9Mb2FkRmFpbGVkKCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChwLm1hdGNoKC9hbGJ1bV9pZD0vKSkgewogICAgICBwID0gcVMoJy51aU1lZGlhVGh1bWIsIFtkYXRhLXRva2VuXSBhJyk7CiAgICAgIGlmICghcCkgewogICAgICAgIHJldHVybiBmYkF1dG9Mb2FkRmFpbGVkKCk7CiAgICAgIH0KICAgICAgcCA9IHAuZ2V0QXR0cmlidXRlKCdocmVmJykubWF0Y2goL2FcLltcLlxkXSsvZyk7CiAgICAgIGcucGFnZVR5cGUgPSAnYWxidW0nOwogICAgICBnLnBhZ2VBbGJ1bUlkID0gcFtwLmxlbmd0aCAtIDFdLnNwbGl0KCcuJylbMV07CiAgICB9CiAgICBnZXRGYkR0c2coKTsKICAgIGcuZWxtcyA9IFtdOwogICAgcmV0dXJuIGZiTG9hZFBhZ2UoKTsKICB9CiAgaWYgKGcuaXNQYWdlKSB7CiAgICBpZiAoIWcuY3Vyc29yKSB7CiAgICAgIHZhciBzID0gcVNBKCdzY3JpcHQnKTsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHNbaV0udGV4dENvbnRlbnQuaW5kZXhPZignY3Vyc29yJykgPiAwKSB7CiAgICAgICAgICBzID0gc1tpXS50ZXh0Q29udGVudDsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICB2YXIgY3Vyc29yID0gbnVsbDsKICAgICAgdHJ5IHsKICAgICAgICBjdXJzb3IgPSBleHRyYWN0SlNPTihzKTsKICAgICAgICB2YXIgaWR4ID0gY3Vyc29yLmpzY2NfbWFwLmluZGV4T2YoJ1BhZ2VsZXQnKTsKICAgICAgICBnLmN1cnNvciA9IGV4dHJhY3RKU09OKGN1cnNvci5qc2NjX21hcC5zbGljZShpZHgpKTsKICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgaWYgKCFjdXJzb3IpIHsKICAgICAgICByZXR1cm4gZmJBdXRvTG9hZEZhaWxlZCgpOwogICAgICB9CiAgICB9CiAgfSBlbHNlIGlmIChpc0dwKSB7CiAgICBwID0gZWxtc1swXS5ocmVmLm1hdGNoKC9nXC4oXGQrKS8pWzFdOwogICAgYUluZm8gPSB7CiAgICAgIHNjcm9sbF9sb2FkOiB0cnVlLAogICAgICBsYXN0X2ZiaWQ6IGwsCiAgICAgIGZldGNoX3NpemU6IDEyMCwKICAgICAgZ3JvdXBfaWQ6IHAsCiAgICAgIGZpbHRlcjogZy5pc1ZpZGVvID8gJ3ZpZGVvcycgOiAncGhvdG9zJwogICAgfTsKICB9ZWxzZSBpZiAoaXNBbCl7CiAgICBpZiAoIWcuaXNQYWdlKSB7CiAgICAgIHAgPSBwLm1hdGNoKC9zZXQ9KFtcdytcLlxkXSopJi8pIHx8IHA7CiAgICAgIHAgPSBwLmxlbmd0aCA/IHBbMV0gOiBwLnNsaWNlKHAuaW5kZXhPZignPScpKzEscC5pbmRleE9mKCcmJykpOwogICAgICBhSW5mbz17InNjcm9sbF9sb2FkIjp0cnVlLCJsYXN0X2ZiaWQiOmwsImZldGNoX3NpemUiOjMyLCJwcm9maWxlX2lkIjorcC5zbGljZShwLmxhc3RJbmRleE9mKCcuJykrMSksInZpZXdtb2RlIjpudWxsLCJzZXQiOnAsInR5cGUiOiIxIn07CiAgICB9CgogICAgdmFyIHRva2VuID0gcVMoImRpdlthcmlhLXJvbGU9J3RhYnBhbmVsJ10iKTsKICAgIGlmICh0b2tlbiAmJiB0b2tlbi5pZCkgewogICAgICB0b2tlbiA9IHRva2VuLmlkLnNwbGl0KCJfIilbNF07CiAgICAgIHZhciB1c2VyID0gdG9rZW4uc3BsaXQoJzonKVswXTsKICAgICAgdmFyIHRuZXh0ID0gcVMoJy5mYlBob3RvQWxidW1UaXRsZScpLm5leHRTaWJsaW5nOwogICAgICB2YXIgaXNDb2xsYWIgPSB0bmV4dCAmJiB0bmV4dC5jbGFzc05hbWUgIT0gJ2ZiUGhvdG9BbGJ1bUFjdGlvbnMnICYmCiAgICAgICAgdG5leHQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtaG92ZXJjYXJkXScpLmxlbmd0aCA+IDE7CiAgICAgIAogICAgICBpZiAobG9jYXRpb24uaHJlZi5tYXRjaCgvY29sbGVjdGlvbl90b2tlbi8pIHx8IGlzQ29sbGFiIHx8IGcuaXNWaWRlbykgewogICAgICAgIGFJbmZvLmNvbGxlY3Rpb25fdG9rZW4gPSB0b2tlbjsKICAgICAgICBhSW5mby5wcm9maWxlX2lkID0gdXNlcjsKICAgICAgfQogICAgfQogICAgaWYgKGcuaXNWaWRlbykgewogICAgICBwID0gcVMoJyNwYWdlbGV0X3RpbWVsaW5lX21lZGxleV9waG90b3MgYVthcmlhLXNlbGVjdGVkPSJ0cnVlIl0nKTsKICAgICAgdmFyIGxzdCA9IHBhcnNlUXVlcnkodW5lc2NhcGUocC5nZXRBdHRyaWJ1dGUoJ2hyZWYnKSkuc3BsaXQoJz8nKVsxXSk7CiAgICAgIGFJbmZvLmN1cnNvciA9ICcwJzsKICAgICAgYUluZm8udGFiX2tleSA9ICdtZWRpYV9zZXQnOwogICAgICBhSW5mby50eXBlID0gJzInOwogICAgICBhSW5mby5sc3QgPSBsc3QubHN0OwogICAgfQogIH1lbHNlIGlmKGlzR3JhcGgpewogICAgdmFyIHF1ZXJ5ID0ge307CiAgICBpZighZy5xdWVyeSl7CiAgICAgIHZhciBzPXFTQSgic2NyaXB0IiksIHRlbXA9W107CiAgICAgIGZvcih2YXIgaT0wO2k8cy5sZW5ndGg7aSsrKXsKICAgICAgICBpZiAoc1tpXS50ZXh0Q29udGVudC5pbmRleE9mKCdlbmNvZGVkX3F1ZXJ5JykgPiAwKSB7CiAgICAgICAgICB0ZW1wWzBdID0gc1tpXS50ZXh0Q29udGVudDsKICAgICAgICB9CiAgICAgICAgaWYoc1tpXS50ZXh0Q29udGVudC5pbmRleE9mKCdjdXJzb3I6IicpID4gMCkgewogICAgICAgICAgdGVtcFsxXSA9IHNbaV0udGV4dENvbnRlbnQ7CiAgICAgICAgfQogICAgICB9CiAgICAgIHF1ZXJ5ID0gdGVtcFswXTsKICAgICAgdmFyIGN1cnNvciA9IHRlbXBbMV07CiAgICAgIHF1ZXJ5ID0gZXh0cmFjdEpTT04ocXVlcnkpOwogICAgICBjdXJzb3IgPSBleHRyYWN0SlNPTihjdXJzb3IpOwogICAgICBpZiAoIXF1ZXJ5IHx8ICFjdXJzb3IpIHsKICAgICAgICBmYkF1dG9Mb2FkRmFpbGVkKCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHZhciBycSA9IHF1ZXJ5LmpzbW9kcy5yZXF1aXJlOwogICAgICBmb3IoaT0wOyBpPHJxLmxlbmd0aDsgaSsrKXsKICAgICAgICBpZihycVtpXVswXSA9PSAiQnJvd3NlU2Nyb2xsaW5nUGFnZXIiKXsKICAgICAgICAgIHF1ZXJ5ID0gcnFbaV1bM11bMV07CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgcnEgPSBjdXJzb3IuanNtb2RzLnJlcXVpcmU7CiAgICAgIGZvcihpPTA7IGk8cnEubGVuZ3RoOyBpKyspewogICAgICAgIGlmKHJxW2ldWzBdID09ICJCcm93c2VTY3JvbGxpbmdQYWdlciIpewogICAgICAgICAgY3Vyc29yID0gcnFbaV1bM11bMF0uY3Vyc29yOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIHF1ZXJ5LmN1cnNvciA9IGN1cnNvcjsKICAgICAgcXVlcnkuYWRzX2F0X2VuZCA9IGZhbHNlOwogICAgICBnLnF1ZXJ5ID0gcXVlcnk7CiAgICB9ZWxzZXsKICAgICAgcXVlcnkgPSBnLnF1ZXJ5OwogICAgICBxdWVyeS5jdXJzb3IgPSBnLmN1cnNvcjsKICAgIH0KICAgIGFJbmZvID0gcXVlcnk7CiAgfWVsc2UgaWYoIWcubmV3TCl7CiAgICB2YXIgZWxlID0gcVMoJyNwYWdlbGV0X3RpbWVsaW5lX21haW5fY29sdW1uJyk7CiAgICBpZiAoZWxlKSB7CiAgICAgIHAgPSBKU09OLnBhcnNlKGVsZS5kYXRhc2V0Lmd0KS5wcm9maWxlX293bmVyOwogICAgfSBlbHNlIGlmIChlbGUgPSBxUygnI3BhZ2VzSGVhZGVyTGlrZUJ1dHRvbiBbZGF0YS1wcm9maWxlaWRdJykpIHsKICAgICAgcCA9IGVsZS5kYXRhc2V0LnByb2ZpbGVpZDsKICAgIH0gZWxzZSB7CiAgICAgIGFsZXJ0KCdDYW5ub3QgZ2V0IHByb2ZpbGUgaWQhJyk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGFJbmZvPXsic2Nyb2xsX2xvYWQiOnRydWUsImxhc3RfZmJpZCI6bCwiZmV0Y2hfc2l6ZSI6MzIsInByb2ZpbGVfaWQiOitwLCJ0YWJfa2V5IjoicGhvdG9zIisoaXNQUz8nX3N0cmVhbSc6JycpLCJzayI6InBob3RvcyIrKGlzUFM/J19zdHJlYW0nOicnKX07CiAgfSBlbHNlIGlmICghYWpheEFsYnVtKSB7CiAgICBwID0gcVMoJyNwYWdlbGV0X3RpbWVsaW5lX21lZGxleV9waG90b3MgYVthcmlhLXNlbGVjdGVkPSJ0cnVlIl0nKTsKICAgIGlmICghcCkgewogICAgICByZXR1cm4gYWxlcnQoJ1BsZWFzZSBnbyB0byBwaG90b3MgdGFiIG9yIGFsYnVtLicpOwogICAgfQogICAgdmFyIGxzdCA9IHVuZXNjYXBlKHAuZ2V0QXR0cmlidXRlKCdocmVmJykpLnNwbGl0KCc/JylbMV07CiAgICBpZiAoIWxzdCkgewogICAgICByZXR1cm4gZmJBdXRvTG9hZEZhaWxlZCgpOwogICAgfQogICAgbHN0ID0gcGFyc2VRdWVyeShsc3QpOwogICAgcCA9IHAuZ2V0QXR0cmlidXRlKCdhcmlhLWNvbnRyb2xzJykubWF0Y2goLy4qXyguKikvKVsxXTsKICAgIHZhciB1c2VySWQgPSBwLm1hdGNoKC8oXGQqKTouKi8pWzFdOwogICAgdGFiID0gK3Auc3BsaXQoJzonKVsyXTsKICAgIGlmKHFTKCcuaGlkZGVuX2VsZW0gLmZiU3RhckdyaWQnKSl7CiAgICAgIHZhciB0PXFTKCcuaGlkZGVuX2VsZW0gLmZiU3RhckdyaWQnKTt0LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodCk7Z2V0UGhvdG9zKCk7cmV0dXJuOwogICAgfQogICAgaWYgKCFnLmN1cnNvcikgewogICAgICB2YXIgcyA9IHFTQSgnc2NyaXB0Jyk7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHNbaV0udGV4dENvbnRlbnQuaW5kZXhPZignTWVkbGV5UGFnZWxldFJlcXVlc3REYXRhJykgPiAwKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBycSA9IGV4dHJhY3RKU09OKHNbaV0udGV4dENvbnRlbnQpLmpzbW9kcy5yZXF1aXJlOwogICAgICAgICAgICBycS5mb3JFYWNoKGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICBpZiAoZSAmJiBlWzBdID09PSAnTWVkbGV5UGFnZWxldFJlcXVlc3REYXRhJykgewogICAgICAgICAgICAgICAgZy5wYWdlbGV0VG9rZW4gPSBlWzNdWzBdLnBhZ2VsZXRfdG9rZW47CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgICB9IGVsc2UgaWYgKHNbaV0udGV4dENvbnRlbnQuaW5kZXhPZignZW5hYmxlQ29udGVudExvYWRlcicpID4gMCkgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcnEgPSBleHRyYWN0SlNPTihzW2ldLnRleHRDb250ZW50KS5qc21vZHMucmVxdWlyZTsKICAgICAgICAgICAgcnEuZm9yRWFjaChmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgaWYgKGUgJiYgZVsxXSA9PT0gJ2VuYWJsZUNvbnRlbnRMb2FkZXInKSB7CiAgICAgICAgICAgICAgICBnLmN1cnNvciA9IGVbM11bMl07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICghZy5jdXJzb3IgfHwgIWcucGFnZWxldFRva2VuKSB7CiAgICAgICAgYWxlcnQoJ0Nhbm5vdCBnZXQgY3Vyc29yIGZvciBhdXRvIGxvYWQhJyk7CiAgICAgIH0KICAgIH0KICAgIGFJbmZvID0gewogICAgICBjb2xsZWN0aW9uX3Rva2VuOiBwLAogICAgICBjdXJzb3I6IGcuY3Vyc29yLCAKICAgICAgZGlzYWJsZXBhZ2VyOiBmYWxzZSwgb3ZlcnZpZXc6IGZhbHNlLAogICAgICBwcm9maWxlX2lkOiB1c2VySWQsCiAgICAgIHBhZ2VsZXRfdG9rZW46IGcucGFnZWxldFRva2VuLAogICAgICB0YWJfa2V5OiB0YWIgPT09IDUgPyAncGhvdG9zJyA6ICdwaG90b3Nfb2YnLAogICAgICBsc3Q6IGxzdC5sc3QsCiAgICAgIGZ0aWQ6IG51bGwsIG9yZGVyOiBudWxsLCBzazogJ3Bob3RvcycsIGltcG9ydGVyX3N0YXRlOiBudWxsCiAgICB9OwogIH0KICBpZiAoZy5pc1BhZ2UpIHsKICAgIGFqYXhBbGJ1bSA9IGxvY2F0aW9uLm9yaWdpbiArICcvYWpheC9wYWdlbGV0L2dlbmVyaWMucGhwLycgKwogICAgICAnUGFnZXNWaWRlb0h1YlZpZGVvQ29udGFpbmVyUGFnZWxldD9kYXRhPScgKwogICAgICBlc2NhcGUoSlNPTi5zdHJpbmdpZnkoZy5jdXJzb3IpKSArICcmX191c2VyPScgKyBnLkVudi51c2VyICsgJyZfX2E9MSc7CiAgfSBlbHNlIGlmIChpc0dyYXBoKSB7CiAgICBhamF4QWxidW0gPSBsb2NhdGlvbi5vcmlnaW4gKyAnL2FqYXgvcGFnZWxldC9nZW5lcmljLnBocC8nICsKICAgICAgJ0Jyb3dzZVNjcm9sbGluZ1NldFBhZ2VsZXQ/ZGF0YT0nICsgZXNjYXBlKEpTT04uc3RyaW5naWZ5KGFJbmZvKSkgKwogICAgICAnJl9fdXNlcj0nICsgZy5FbnYudXNlciArICcmX19hPTEnOwogIH1lbHNlIGlmKCFnLm5ld0wgfHwgaXNHcCB8fCBpc0FsKXsKICAgIHRhcmdldFVSTCA9IGlzR3AgPyAnR3JvdXBQaG90b3NldCcgOiAoZy5pc1ZpZGVvID8gJ1RpbWVsaW5lUGhvdG9TZXQnIDoKICAgICAgJ1RpbWVsaW5lUGhvdG9zJyArIChpc0FsID8gJ0FsYnVtJyA6IChpc1BTID8gJ1N0cmVhbScgOiAnJykpKTsKICAgIGFqYXhBbGJ1bSA9IGxvY2F0aW9uLm9yaWdpbiArICcvYWpheC9wYWdlbGV0L2dlbmVyaWMucGhwLycgKyB0YXJnZXRVUkwgKwogICAgICAnUGFnZWxldD9hamF4cGlwZT0xJmFqYXhwaXBlX3Rva2VuPScgKyBnLkVudi5hamF4cGlwZV90b2tlbiArCiAgICAgICcmbm9fc2NyaXB0X3BhdGg9MSZkYXRhPScgKyBKU09OLnN0cmluZ2lmeShhSW5mbykgKyAnJl9fdXNlcj0nICsgCiAgICAgIGcuRW52LnVzZXIgKyAnJl9fYT0xJl9fYWR0PTInOwogIH1lbHNlewogICAgdmFyIHJlcSA9IDUrKHFTQSgnLmZiU3RhckdyaWQ+ZGl2JykubGVuZ3RoLTgpLzgqMgogICAgdGFiPXFTQSgnI3BhZ2VsZXRfdGltZWxpbmVfbWVkbGV5X3Bob3RvcyBhW3JvbGU9InRhYiJdJyk7CiAgICBwVHlwZSA9ICtwLnNwbGl0KCc6JylbMl07CiAgICB0YXJnZXRVUkwgPSAiIjsKICAgIHN3aXRjaChwVHlwZSl7CiAgICAgIGNhc2UgNDogdGFyZ2V0VVJMID0gJ1RhZ2dlZFBob3Rvc0FwcENvbGxlY3Rpb24nOyBicmVhazsKICAgICAgY2FzZSA1OiB0YXJnZXRVUkwgPSAnQWxsUGhvdG9zQXBwQ29sbGVjdGlvbic7IGJyZWFrOwogICAgICBjYXNlIDcwOiB0YXJnZXRVUkwgPSAiVW50YWdnZWRQaG90b3NBcHBDb2xsZWN0aW9uIjsKICAgICAgY3Vyc29yID0gYnRvYSgnMDpub3Rfc3RydWN0dXJlZDonK2wpOwogICAgICBhSW5mbyA9IHsiY29sbGVjdGlvbl90b2tlbiI6IHAsICJjdXJzb3IiOiBjdXJzb3IsICJ0YWJfa2V5IjogInBob3Rvc191bnRhZ2dlZCIsInByb2ZpbGVfaWQiOiArdXNlcklkLCJvdmVydmlldyI6ZmFsc2UsImZ0aWQiOm51bGwsInNrIjoicGhvdG9zIn07IGJyZWFrOwogICAgfQogICAgYWpheEFsYnVtID0gbG9jYXRpb24ub3JpZ2luICsgJy9hamF4L3BhZ2VsZXQvZ2VuZXJpYy5waHAvJyArIHRhcmdldFVSTCsKICAgICAgJ1BhZ2VsZXQ/ZGF0YT0nICsgZXNjYXBlKEpTT04uc3RyaW5naWZ5KGFJbmZvKSkgKyAnJl9fdXNlcj0nICsKICAgICAgZy5FbnYudXNlcisnJl9fYT0xJzsKICB9CiAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwogIHhoci5vbmxvYWQgPSBmdW5jdGlvbigpewogICAgY2xlYXJUaW1lb3V0KCBnLnRpbWVvdXQgKTsKICAgIGlmKHRoaXMuc3RhdHVzIT0yMDApewogICAgICBpZighY29uZmlybSgnQXV0b2xvYWQgZmFpbGVkLlxuVHJ5IGFnYWluLT5PS1xuT3V0cHV0IGxvYWRlZCBwaG90b3MtPkNhbmNlbCcpKXtnLmxhc3RMb2FkZWQ9MTt9Z2V0UGhvdG9zKCk7cmV0dXJuOwogICAgfQogICAgdmFyIHI9dGhpcy5yZXNwb25zZSxodG1sQmFzZT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdodG1sJyk7CiAgICB2YXIgbmV3TCA9IHIuaW5kZXhPZignZm9yJyk9PTA7CgogICAgdmFyIGVDb3VudCA9IDAsIGUsIG9sZDsKICAgIGlmKCFuZXdMKXsKICAgICAgaHRtbEJhc2UuaW5uZXJIVE1MPXIuc2xpY2UoNiwtNyk7CiAgICAgIHZhciB0YXJnZXRKUz1odG1sQmFzZS5xdWVyeVNlbGVjdG9yQWxsKCdzY3JpcHQnKTsKICAgICAgZm9yKHZhciBrPTA7IW5ld0wgJiYgazx0YXJnZXRKUy5sZW5ndGg7aysrKXsKICAgICAgICB2YXIgdD10YXJnZXRKU1trXS50ZXh0Q29udGVudCxjb250ZW50PXQuc2xpY2UodC5pbmRleE9mKCcsIHsnKSsyLHQuaW5kZXhPZignfSwgdHJ1ZSk7fScpKzEpOwogICAgICAgIGlmKCFjb250ZW50Lmxlbmd0aHx8dC5pbmRleE9mKCdKU09OUFRyYW5zcG9ydCcpPDApe2NvbnRpbnVlO30KICAgICAgICBjb250ZW50PUpTT04ucGFyc2UoY29udGVudCk7CiAgICAgICAgdmFyIGQ9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgZC5pbm5lckhUTUw9Y29udGVudC5wYXlsb2FkLmNvbnRlbnQuY29udGVudDsKICAgICAgICBlPWQucXVlcnlTZWxlY3RvckFsbChnLnRodW1iU2VsZWN0b3IpOwogICAgICAgIGlmKCFlfHwhZS5sZW5ndGgpY29udGludWU7CiAgICAgICAgZUNvdW50Kz1lLmxlbmd0aDsKICAgICAgICBvbGQ9ZWxtcz9BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChlbG1zLDApOicnOwogICAgICAgIGcuZWxtcz1vbGQ/b2xkLmNvbmNhdChBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChlLDApKTplOwogICAgICB9CiAgICB9ZWxzZXsKICAgICAgciA9IEpTT04ucGFyc2Uoci5zbGljZSg5KSk7CiAgICAgIGh0bWxCYXNlLmlubmVySFRNTCA9IHIucGF5bG9hZDsKICAgICAgdmFyIGUgPSBbXSwgdGVtcCA9IFtdOwogICAgICBpZihnLnF1ZXJ5KXsKICAgICAgICB0ZW1wID0gaHRtbEJhc2UucXVlcnlTZWxlY3RvckFsbCgnYVtyZWw9InRoZWF0ZXIiXScpOwogICAgICAgIGZvcihrID0gMDsgayA8IHRlbXAubGVuZ3RoOyBrKyspewogICAgICAgICAgaWYgKHRlbXBba10ucXVlcnlTZWxlY3RvcignaW1nJykpIHsKICAgICAgICAgICAgZS5wdXNoKHRlbXBba10pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0ZW1wID0gW107CiAgICAgICAgaWYoZS5sZW5ndGgpZy5jdXJzb3IgPSBwYXJzZVF1ZXJ5KGVbZS5sZW5ndGgtMV0uaHJlZikub3BhcXVlQ3Vyc29yOwogICAgICB9ZWxzZXsKICAgICAgICBlID0gaHRtbEJhc2UucXVlcnlTZWxlY3RvckFsbChnLnRodW1iU2VsZWN0b3IpOwogICAgICAgIGlmIChnLnBhZ2VsZXRUb2tlbikgewogICAgICAgICAgZy5jdXJzb3IgPSAnJzsKICAgICAgICAgIHIuanNtb2RzLnJlcXVpcmUuZm9yRWFjaChmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIGlmIChlICYmIGVbMV0gPT09ICdlbmFibGVDb250ZW50TG9hZGVyJykgewogICAgICAgICAgICAgIGcuY3Vyc29yID0gZVszXVsyXTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgICBpZiAoIWcuY3Vyc29yKSB7CiAgICAgICAgICAgIGcubGFzdExvYWRlZCA9IDE7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHZhciBtYXAgPSB7fTsKICAgICAgZm9yIChrID0gMDsgayA8IGUubGVuZ3RoOyBrKyspIHsKICAgICAgICB2YXIgaHJlZiA9IHVuZXNjYXBlKGVba10uZ2V0QXR0cmlidXRlKCdhamF4aWZ5JykpIHx8IGVba10uaHJlZjsKICAgICAgICBpZiAoIW1hcFtocmVmXSkgewogICAgICAgICAgbWFwW2hyZWZdID0gMTsKICAgICAgICAgIHRlbXAucHVzaChlW2tdKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZSA9IHRlbXA7CiAgICAgIGVDb3VudCs9ZS5sZW5ndGg7CiAgICAgIG9sZD1lbG1zP0FycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGVsbXMsMCk6Jyc7CiAgICAgIGcuZWxtcz1vbGQ/b2xkLmNvbmNhdChBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChlLDApKTplOwogICAgfQogICAgaWYgKGcuaXNQYWdlKSB7CiAgICAgIGlmIChyLmpzY2NfbWFwKSB7CiAgICAgICAgZy5jdXJzb3IgPSBleHRyYWN0SlNPTihyLmpzY2NfbWFwLnNsaWNlKHIuanNjY19tYXAuaW5kZXhPZignUGFnZWxldCcpKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZy5sYXN0TG9hZGVkID0gMTsKICAgICAgICBnLmN1cnNvciA9ICcnOwogICAgICB9CiAgICB9CiAgICBnLnN0YXR1c0VsZS50ZXh0Q29udGVudCA9ICdMb2FkaW5nIGFsYnVtLi4uICgnICsgZy5lbG1zLmxlbmd0aCArICcpJzsKICAgIGRvY3VtZW50LnRpdGxlPScoJytnLmVsbXMubGVuZ3RoKycpIHx8JytnLnBob3RvZGF0YS5hTmFtZTsKCiAgICBpZighZUNvdW50KXtjb25zb2xlLmxvZygnTG9hZGVkICcrZy5lbG1zLmxlbmd0aCsnIHBob3Rvcy4nKTtnLmxhc3RMb2FkZWQ9MTt9CiAgICBpZiAoZy5hamF4U3RhcnRGcm9tKSB7CiAgICAgIGcuYWpheFN0YXJ0RnJvbSA9IGZhbHNlOwogICAgfQogICAgc2V0VGltZW91dChnZXRQaG90b3MsMTAwMCk7CiAgfTsKICB4aHIub3BlbigiR0VUIiwgYWpheEFsYnVtKTsKICBnLnRpbWVvdXQ9c2V0VGltZW91dChmdW5jdGlvbigpewogICAgeGhyLmFib3J0KCk7CiAgICBpZihnLmFqYXhSZXRyeT41KXtpZihjb25maXJtKCdUaW1lb3V0IHJlYWNoZWQuXG5UcnkgYWdhaW4tPk9LXG5PdXRwdXQgbG9hZGVkIHBob3Rvcy0+Q2FuY2VsJykpe2cuYWpheFJldHJ5PTA7fWVsc2V7Zy5sYXN0TG9hZGVkPTE7fX1nZXRQaG90b3MoKTsKICB9LDEwMDAwKTsKICB4aHIuc2VuZCgpOwp9CmZ1bmN0aW9uIGluc3RhQWpheCgpewogIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICB4aHIub25sb2FkID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgdG90YWw9Zy50b3RhbCwgcGhvdG9kYXRhPWcucGhvdG9kYXRhLAogICAgcmVzPUpTT04ucGFyc2UodGhpcy5yZXNwb25zZSksZWxtcz1yZXMuaXRlbXM7CiAgICBpZihlbG1zWzBdLmlkLmluZGV4T2YoJ18nKTwwKWVsbXM9ZWxtc1szXTsKICAgIGcuYWpheD1yZXMubW9yZV9hdmFpbGFibGU/ZWxtc1tlbG1zLmxlbmd0aC0xXS5pZDpudWxsOwogICAgZm9yKHZhciBpPTA7aTxlbG1zLmxlbmd0aDtpKyspewogICAgICB2YXIgdXJsID0gcGFyc2VGYlNyYyhlbG1zW2ldLmltYWdlcy5zdGFuZGFyZF9yZXNvbHV0aW9uLnVybCk7CiAgICAgIHZhciBjID0gZWxtc1tpXS5jb21tZW50cywgY0xpc3QgPSBbYy5jb3VudF07CiAgICAgIGZvcih2YXIgaz0wOyBrPGMuZGF0YS5sZW5ndGg7IGsrKyl7CiAgICAgICAgdmFyIHAgPSBjLmRhdGFba107aWYocCl7CiAgICAgICAgY0xpc3QucHVzaCh7bmFtZTogcC5mcm9tLmZ1bGxfbmFtZSB8fCBwLmZyb20udXNlcm5hbWUsIHVybDogJ2h0dHA6Ly9pbnN0YWdyYW0uY29tLycrcC5mcm9tLnVzZXJuYW1lLCB0ZXh0OiBwLnRleHQsIGRhdGU6IHBhcnNlVGltZShwLmNyZWF0ZWRfdGltZSksIGlkOiBlbG1zW2ldLmxpbmt9KTt9CiAgICAgIH0KICAgICAgaWYoZWxtc1tpXS52aWRlb3MpewogICAgICAgIHBob3RvZGF0YS52aWRlb3MucHVzaCh7CiAgICAgICAgICB1cmw6IGVsbXNbaV0udmlkZW9zLnN0YW5kYXJkX3Jlc29sdXRpb24udXJsLAogICAgICAgICAgdGh1bWI6IHVybAogICAgICAgIH0pOwogICAgICB9CiAgICAgIHBob3RvZGF0YS5waG90b3MucHVzaCh7CiAgICAgICAgdGl0bGU6IGVsbXNbaV0uY2FwdGlvbj9lbG1zW2ldLmNhcHRpb24udGV4dDonJywKICAgICAgICB1cmw6IHVybCwKICAgICAgICBocmVmOiBlbG1zW2ldLmxpbmssCiAgICAgICAgZGF0ZTogZWxtc1tpXS5jcmVhdGVkX3RpbWU/cGFyc2VUaW1lKGVsbXNbaV0uY3JlYXRlZF90aW1lKTonJywKICAgICAgICBjb21tZW50czogYy5jb3VudD9jTGlzdDonJwogICAgICB9KTsKICAgIH0KICAgIGxvZygnTG9hZGVkICcrcGhvdG9kYXRhLnBob3Rvcy5sZW5ndGgrJyBvZiAnK3RvdGFsKycgcGhvdG9zLicpOwogICAgZy5zdGF0dXNFbGUudGV4dENvbnRlbnQ9J0xvYWRlZCAnK2cucGhvdG9kYXRhLnBob3Rvcy5sZW5ndGgrJyAvICcrdG90YWw7CiAgICBkb2N1bWVudC50aXRsZT0iKCIrZy5waG90b2RhdGEucGhvdG9zLmxlbmd0aCsiLyIrdG90YWwrIikgfHwiK2cucGhvdG9kYXRhLmFOYW1lOwogICAgaWYocVMoJyNzdG9wQWpheENrYicpJiZxUygnI3N0b3BBamF4Q2tiJykuY2hlY2tlZCl7b3V0cHV0KCk7fQogICAgZWxzZSBpZih0b3RhbD5waG90b2RhdGEucGhvdG9zLmxlbmd0aCYmZy5hamF4KXtpbnN0YUFqYXgoKTt9ZWxzZXtvdXRwdXQoKTt9CiAgfTsKICB4aHIub3BlbigiR0VUIiwgJ2h0dHBzOi8vd3d3Lmluc3RhZ3JhbS5jb20vJytnLkVudi51c2VyLnVzZXJuYW1lKycvbWVkaWEvP21heF9pZD0nK2cuYWpheCk7CiAgeGhyLnNlbmQoKTsKfQpmdW5jdGlvbiBfaW5zdGFRdWVyeUFkZChlbG1zKSB7CiAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbG1zLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgZmVlZCA9IGVsbXNbaV07CiAgICBpZiAoIWVsbXMgfHwgZy5kb3dubG9hZGVkW2ZlZWQuaWRdKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfSBlbHNlIHsKICAgICAgZy5kb3dubG9hZGVkW2ZlZWQuaWRdID0gMTsKICAgIH0KICAgIHZhciBjID0gZmVlZC5lZGdlX21lZGlhX3RvX2NvbW1lbnQgfHwge2NvdW50OiAwfTsKICAgIHZhciBjTGlzdCA9IFtjLmNvdW50XTsKICAgIGZvciAodmFyIGsgPSAwOyBjLmVkZ2VzICYmIGsgPCBjLmVkZ2VzLmxlbmd0aDsgaysrKSB7CiAgICAgIHZhciBwID0gYy5lZGdlc1trXS5ub2RlOwogICAgICBjTGlzdC5wdXNoKHsKICAgICAgICBuYW1lOiBwLm93bmVyLnVzZXJuYW1lLAogICAgICAgIHVybDogJ2h0dHA6Ly9pbnN0YWdyYW0uY29tLycgKyBwLm93bmVyLnVzZXJuYW1lLAogICAgICAgIHRleHQ6IHAudGV4dCwKICAgICAgICBkYXRlOiBwYXJzZVRpbWUocC5jcmVhdGVkX2F0KQogICAgICB9KTsKICAgIH0KICAgIHZhciB1cmw7CiAgICB2YXIgaXNBbGJ1bSA9IGZlZWQuX190eXBlbmFtZSA9PT0gJ0dyYXBoU2lkZWNhcic7CiAgICB2YXIgZWRnZXMgPSAhaXNBbGJ1bSA/IFtmZWVkXSA6IGZlZWQuZWRnZV9zaWRlY2FyX3RvX2NoaWxkcmVuLmVkZ2VzOwogICAgZm9yICh2YXIgaiA9IDA7IGogPCBlZGdlcy5sZW5ndGg7IGorKykgewogICAgICB2YXIgbiA9ICFpc0FsYnVtID8gZWRnZXNbal0gOiBlZGdlc1tqXS5ub2RlOwogICAgICB1cmwgPSBwYXJzZUZiU3JjKG4uZGlzcGxheV91cmwgfHwgbi5kaXNwbGF5X3NyYyk7CiAgICAgIGlmIChuLmlzX3ZpZGVvKSB7CiAgICAgICAgZy5waG90b2RhdGEudmlkZW9zLnB1c2goewogICAgICAgICAgdXJsOiBuLnZpZGVvX3VybCwKICAgICAgICAgIHRodW1iOiB1cmwKICAgICAgICB9KTsKICAgICAgfQogICAgICB2YXIgY2FwdGlvbiA9IGZlZWQuZWRnZV9tZWRpYV90b19jYXB0aW9uOwogICAgICBpZiAoY2FwdGlvbikgewogICAgICAgIGNhcHRpb24gPSBjYXB0aW9uLmVkZ2VzLmxlbmd0aCA/IGNhcHRpb24uZWRnZXNbMF0ubm9kZS50ZXh0IDogJyc7CiAgICAgIH0KICAgICAgdmFyIHRhZ3MgPSBuLmVkZ2VfbWVkaWFfdG9fdGFnZ2VkX3VzZXI7CiAgICAgIHZhciB0YWdIdG1sID0gJyc7CiAgICAgIGlmICh0YWdzICYmIHRhZ3MuZWRnZXMgJiYgdGFncy5lZGdlcy5sZW5ndGgpIHsKICAgICAgICB0YWdIdG1sID0gJzxkaXYgY2xhc3M9ImZiUGhvdG9zUGhvdG9UYWdib3hlcyI+PGRpdiBjbGFzcz0idGFnc1dyYXBwZXIiPic7CiAgICAgICAgZm9yIChrID0gMDsgayA8IHRhZ3MuZWRnZXMubGVuZ3RoOyBrKyspIHsKICAgICAgICAgIHZhciBub2RlID0gdGFncy5lZGdlc1trXS5ub2RlOwogICAgICAgICAgdmFyIHVzZXJuYW1lID0gbm9kZS51c2VyLnVzZXJuYW1lOwogICAgICAgICAgdGFnSHRtbCArPSAnPGEgdGFyZ2V0PSJfYmxhbmsiIGhyZWY9Imh0dHBzOi8vaW5zdGFncmFtLmNvbS8nICsgdXNlcm5hbWUgKwogICAgICAgICAgICAnIj48ZGl2IGNsYXNzPSJmYlBob3Rvc1Bob3RvVGFnYm94QmFzZSB0YWdCb3ggaWdUYWciIHN0eWxlPSJsZWZ0OicgKwogICAgICAgICAgICBwYXJzZVBvcyhub2RlLngpICsnJTt0b3A6JyArIHBhcnNlUG9zKG5vZGUueSkgKwogICAgICAgICAgICAnJSI+PGRpdiBjbGFzcz0idGFnIj48ZGl2IGNsYXNzPSJ0YWdQb2ludGVyIj4nICsKICAgICAgICAgICAgJzxpIGNsYXNzPSJ0YWdBcnJvdyAiPjwvaT48ZGl2IGNsYXNzPSJ0YWdOYW1lIj48c3Bhbj4nICsgdXNlcm5hbWUgKwogICAgICAgICAgICAnPC9zcGFuPjwvZGl2PjwvZGl2PjwvZGl2PjwvZGl2PjwvYT4nOwogICAgICAgIH0KICAgICAgICB0YWdIdG1sICs9ICc8L2Rpdj48L2Rpdj4nOwogICAgICB9CiAgICAgIHZhciBkYXRlID0gZmVlZC5kYXRlIHx8IGZlZWQudGFrZW5fYXRfdGltZXN0YW1wOwogICAgICBnLnBob3RvZGF0YS5waG90b3MucHVzaCh7CiAgICAgICAgdGl0bGU6IGogPT09IDAgJiYgY2FwdGlvbiA/IGNhcHRpb24gOiAoZmVlZC5jYXB0aW9uIHx8ICcnKSwKICAgICAgICB1cmw6IHVybCwKICAgICAgICBocmVmOiAnaHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS9wLycgKyAobi5zaG9ydGNvZGUgfHwgbi5jb2RlKSArICcvJywKICAgICAgICBkYXRlOiBkYXRlID8gcGFyc2VUaW1lKGRhdGUpIDogJycsCiAgICAgICAgY29tbWVudHM6IGMuY291bnQgJiYgaiA9PT0gMCAmJiBjTGlzdC5sZW5ndGggPiAxID8gY0xpc3QgOiAnJywKICAgICAgICB0YWc6IHRhZ0h0bWwKICAgICAgfSk7CiAgICB9CiAgfQp9CmZ1bmN0aW9uIF9pbnN0YVF1ZXJ5UHJvY2VzcyhlbG1zKSB7CiAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbG1zLmxlbmd0aDsgaSsrKSB7CiAgICBpZiAoZWxtc1tpXS5ub2RlKSB7CiAgICAgIGVsbXNbaV0gPSBlbG1zW2ldLm5vZGU7CiAgICB9CiAgICB2YXIgZmVlZCA9IGVsbXNbaV07CiAgICBpZiAoIWVsbXNbaV0gfHwgKGcuZG93bmxvYWRlZCAmJiBnLmRvd25sb2FkZWRbZmVlZC5pZF0pKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgaWYgKGZlZWQuX190eXBlbmFtZSA9PT0gJ0dyYXBoU2lkZWNhcicgfHwgZmVlZC5fX3R5cGVuYW1lID09PSAnR3JhcGhWaWRlbycpIHsKICAgICAgaWYgKGcuc2tpcEFsYnVtKSB7CiAgICAgICAgZWxtc1tpXSA9IG51bGw7CiAgICAgICAgY29udGludWU7CiAgICAgIH0gZWxzZSBpZiAoIWZlZWQuZWRnZV9zaWRlY2FyX3RvX2NoaWxkcmVuICYmICFmZWVkLnZpZGVvX3VybCkgewogICAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgICAgICB4aHIub25sb2FkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICB2YXIgcmVzID0gSlNPTi5wYXJzZSh0aGlzLnJlc3BvbnNlKTsKICAgICAgICAgICAgZWxtc1tpXSA9IHJlcy5ncmFwaHFsLnNob3J0Y29kZV9tZWRpYTsKICAgICAgICAgIH0gY2F0Y2goZSkgewogICAgICAgICAgICB2YXIgaHRtbEJhc2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdodG1sJyk7CiAgICAgICAgICAgIGh0bWxCYXNlLmlubmVySFRNTCA9IHRoaXMucmVzcG9uc2U7CiAgICAgICAgICAgIHZhciB0YXJnZXRKUyA9IGh0bWxCYXNlLnF1ZXJ5U2VsZWN0b3JBbGwoJ3NjcmlwdCcpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgdGFyZ2V0SlMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgIGlmICh0YXJnZXRKU1tqXS50ZXh0Q29udGVudC5pbmRleE9mKCdfc2hhcmVkRGF0YScpID4gLTEpIHsKICAgICAgICAgICAgICAgICAgZWxtc1tpXSA9IGV4dHJhY3RKU09OKHRhcmdldEpTW2pdLnRleHRDb250ZW50KTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGVsbXNbaV0gPSBlbG1zW2ldLmVudHJ5X2RhdGEuUG9zdFBhZ2VbMF0uZ3JhcGhxbC5zaG9ydGNvZGVfbWVkaWE7CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICBlbG1zW2ldID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgX2luc3RhUXVlcnlQcm9jZXNzKGVsbXMpOwogICAgICAgICAgfSwgNTAwKTsKICAgICAgICB9OwogICAgICAgIHZhciBjb2RlID0gZmVlZC5zaG9ydGNvZGUgfHwgZmVlZC5jb2RlOwogICAgICAgIHhoci5vcGVuKCdHRVQnLCAnaHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS9wLycgKyBjb2RlICsgJy8/X19hPTEnKTsKICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignWC1SZXF1ZXN0ZWQtV2l0aCcsICdYTUxIdHRwUmVxdWVzdCcpOwogICAgICAgIHhoci5zZW5kKCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9CiAgfQogIF9pbnN0YVF1ZXJ5QWRkKGVsbXMpOwogIHZhciB0b3RhbCA9IGcudG90YWw7CiAgdmFyIHBob3RvZGF0YSA9IGcucGhvdG9kYXRhOwogIGNvbnNvbGUubG9nKCdMb2FkZWQgJytwaG90b2RhdGEucGhvdG9zLmxlbmd0aCsnIG9mICcrdG90YWwrJyBwaG90b3MuJyk7CiAgZy5zdGF0dXNFbGUudGV4dENvbnRlbnQgPSAnTG9hZGVkICcgKyBwaG90b2RhdGEucGhvdG9zLmxlbmd0aCArICcgLyAnKyB0b3RhbDsKICBkb2N1bWVudC50aXRsZT0iKCIrcGhvdG9kYXRhLnBob3Rvcy5sZW5ndGgrIi8iK3RvdGFsKyIpIHx8IitwaG90b2RhdGEuYU5hbWU7CiAgaWYgKHFTKCcjc3RvcEFqYXhDa2InKSAmJiBxUygnI3N0b3BBamF4Q2tiJykuY2hlY2tlZCkgewogICAgb3V0cHV0KCk7CiAgfSBlbHNlIGlmIChnLmFqYXggJiYgK2cubW9kZSAhPT0gMikgewogICAgc2V0VGltZW91dChpbnN0YVF1ZXJ5LCAxMDAwKTsKICB9IGVsc2UgewogICAgb3V0cHV0KCk7CiAgfQp9CmZ1bmN0aW9uIGluc3RhUXVlcnkoKSB7CiAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwogIHhoci5vbmxvYWQgPSBmdW5jdGlvbigpIHsKICAgIGlmICh4aHIuc3RhdHVzID09PSA0MjkpIHsKICAgICAgYWxlcnQoJ1RvbyBtYW55IHJlcXVlc3QsIFBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIuJyk7CiAgICAgIGlmICghcVMoJy5kYUV4dHJhJykuaW5uZXJIVE1MKSB7CiAgICAgICAgcVMoJy5kYUV4dHJhJykuaW5uZXJIVE1MID0gJzxhIGNsYXNzPSJkYUNvbnRpbnVlIj5Db250aW51ZTwvYT4nOwogICAgICAgIHFTKCcuZGFDb250aW51ZScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaW5zdGFRdWVyeSk7CiAgICAgIH0KICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHRoaXMucmVzcG9uc2VbMF0gPT0gJzwnKSB7CiAgICAgIGlmIChjb25maXJtKCdDYW5ub3QgbG9hZCBjb21tZW50cywgY29udGludWU/JykpIHsKICAgICAgICBnLmxvYWRDbSA9IGZhbHNlOwogICAgICAgIGluc3RhUXVlcnkoKTsKICAgICAgfQogICAgICByZXR1cm47CiAgICB9CiAgICB2YXIgcmVzID0gSlNPTi5wYXJzZSh0aGlzLnJlc3BvbnNlKS5kYXRhLnVzZXIuZWRnZV9vd25lcl90b190aW1lbGluZV9tZWRpYTsKICAgIGcuYWpheCA9IHJlcy5wYWdlX2luZm8uaGFzX25leHRfcGFnZSA/IHJlcy5wYWdlX2luZm8uZW5kX2N1cnNvciA6IG51bGw7CiAgICBfaW5zdGFRdWVyeVByb2Nlc3MocmVzLmVkZ2VzKTsKICB9OwogIGlmIChnLnF1ZXJ5SGFzaCkgewogICAgeGhyLm9wZW4oJ0dFVCcsICdodHRwczovL3d3dy5pbnN0YWdyYW0uY29tL2dyYXBocWwvcXVlcnkvPycgKwogICAgICAncXVlcnlfaGFzaD0nICsgZy5xdWVyeUhhc2ggKyAnJnZhcmlhYmxlcz0nICsKICAgICAgSlNPTi5zdHJpbmdpZnkoeyBpZDogZy5FbnYudXNlci5pZCwgZmlyc3Q6IDMwLCBhZnRlcjogZy5hamF4IH0pKTsKICB9IGVsc2UgewogICAgeGhyLm9wZW4oJ0dFVCcsICdodHRwczovL3d3dy5pbnN0YWdyYW0uY29tL2dyYXBocWwvcXVlcnkvPycgKwogICAgICAncXVlcnlfaWQ9JyArIGcucXVlcnlJZCArICcmaWQ9JyArIGcuRW52LnVzZXIuaWQgKyAnJmZpcnN0PTMwJmFmdGVyPScgKwogICAgICBnLmFqYXgpOwogIH0KICB4aHIuc2V0UmVxdWVzdEhlYWRlcignWC1SZXF1ZXN0ZWQtV2l0aCcsICdYTUxIdHRwUmVxdWVzdCcpOwogIHhoci5zZW5kKCk7Cn0KZnVuY3Rpb24gZ2V0SW5zdGFncmFtUXVlcnlJZCgpIHsKICB2YXIgcyA9IHFTKCdzY3JpcHRbc3JjKj0iUHJvZmlsZVBhZ2VDb250YWluZXIiXSwgc2NyaXB0W3NyYyo9IkNvbW1vbnMiXScpOwogIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICB4aHIub25sb2FkID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgaWQgPSB0aGlzLnJlc3BvbnNlLm1hdGNoKC9wcm9maWxlUG9zdHNcUytxdWVyeUlkOiIoXFMrKSIvKTsKICAgIGlmICghaWQpIHsKICAgICAgaWQgPSB0aGlzLnJlc3BvbnNlLm1hdGNoKC9wcm9maWxlUG9zdHNcUytxdWVyeUlkOiIoXGQrKSIvKTsKICAgICAgaWYgKCFpZCkgewogICAgICAgIGlkID0gdGhpcy5yZXNwb25zZS5tYXRjaCgvYnlVc2VySWRcLmdldFxTK3F1ZXJ5SWQ6IihcZCspIi8pOwogICAgICB9CiAgICAgIGlmIChpZCkgewogICAgICAgIGcucXVlcnlJZCA9IGlkWzFdOwogICAgICB9IGVsc2UgewogICAgICAgIGFsZXJ0KCdDYW5ub3QgZ2V0IHF1ZXJ5IGlkLCB1c2luZyBmYWxsYmFjayBpbnN0ZWFkJyk7CiAgICAgICAgZy5xdWVyeUhhc2ggPSAnNDcyZjI1N2E0MGM2NTNjNjRjNjY2Y2U4NzdkNTlkMmInOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBnLnF1ZXJ5SGFzaCA9IGlkWzFdOwogICAgfQogICAgZ2V0SW5zdGFncmFtKCk7CiAgfTsKICB4aHIub3BlbignR0VUJywgcy5zcmMpOwogIHhoci5zZW5kKCk7Cn0KZnVuY3Rpb24gZ2V0SW5zdGFncmFtKCkgewogIGlmIChnLnN0YXJ0ICE9IDIgfHwgZy5zdGFydCA9PSAzKSB7CiAgICByZXR1cm47CiAgfQogIGcuc3RhcnQgPSAzOwogIGlmIChnLkVudi51c2VyLmJpb2dyYXBoeSAhPT0gdW5kZWZpbmVkKSB7CiAgICBpZiAoIWcuRW52Lm1lZGlhKSB7CiAgICAgIGNsb3NlRGlhbG9nKCk7CiAgICAgIHJldHVybiBhbGVydCgnQ2Fubm90IGRvd25sb2FkIHByaXZhdGUgYWNjb3VudC4nKTsKICAgIH0KICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgIHhoci5vbmxvYWQgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIHJlcyA9IEpTT04ucGFyc2UodGhpcy5yZXNwb25zZSkuZ3JhcGhxbC51c2VyLmVkZ2Vfb3duZXJfdG9fdGltZWxpbmVfbWVkaWE7CiAgICAgIGcuYWpheCA9IHJlcy5wYWdlX2luZm8uaGFzX25leHRfcGFnZSA/IHJlcy5wYWdlX2luZm8uZW5kX2N1cnNvciA6IG51bGw7CiAgICAgIF9pbnN0YVF1ZXJ5UHJvY2VzcyhyZXMuZWRnZXMpOwogICAgfTsKICAgIHhoci5vcGVuKCdHRVQnLCBsb2NhdGlvbi5vcmlnaW4gKyBsb2NhdGlvbi5wYXRobmFtZSArICc/X19hPTEnKTsKICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCdYLVJlcXVlc3RlZC1XaXRoJywgJ1hNTEh0dHBSZXF1ZXN0Jyk7CiAgICB4aHIuc2VuZCgpOwogIH0KfQpmdW5jdGlvbiBnZXRUd2l0dGVyKCl7CiAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwogIHhoci5vbmxvYWQgPSBmdW5jdGlvbigpIHsKICAgIHZhciByID0gSlNPTi5wYXJzZSh0aGlzLnJlc3BvbnNlVGV4dCk7CiAgICBnLmFqYXggPSByLm1pbl9wb3NpdGlvbiB8fCAnJzsKICAgIHZhciBkb2MgPSBnZXRET00oci5pdGVtc19odG1sKTsKICAgIHZhciBlbG1zID0gZG9jLnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb250ZW50Jyk7CiAgICB2YXIgcGhvdG9kYXRhID0gZy5waG90b2RhdGE7CiAgICB2YXIgaSwgaiwgbGluaywgdXJsLCB0aXRsZSwgZGF0ZTsKICAgIGZvcihpID0gMDsgaSA8IGVsbXMubGVuZ3RoOyBpKyspewogICAgICBsaW5rID0gZWxtc1tpXS5xdWVyeVNlbGVjdG9yQWxsKCcuanMtYWRhcHRpdmUtcGhvdG8sIFtkYXRhLWltYWdlLXVybF0nKTsKICAgICAgaWYgKCFsaW5rLmxlbmd0aCkgewogICAgICAgIGxpbmsgPSBlbG1zW2ldLnF1ZXJ5U2VsZWN0b3JBbGwoJ2ltZ1tzcmMqPW1lZGlhXScpOwogICAgICB9CiAgICAgIGZvcihqID0gMDsgaiA8IGxpbmsubGVuZ3RoOyBqKyspewogICAgICAgIHVybCA9IGxpbmtbal0uZ2V0QXR0cmlidXRlKCdkYXRhLWltYWdlLXVybCcpIHx8IGxpbmtbal0uc3JjOwogICAgICAgIGlmICghdXJsKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgdGl0bGUgPSBlbG1zW2ldLnF1ZXJ5U2VsZWN0b3IoJy50d2VldC10ZXh0JykuaW5uZXJIVE1MIHx8ICcnOwogICAgICAgIHRpdGxlID0gdGl0bGUucmVwbGFjZSgvaHJlZj0iXC8vZywgJ2hyZWY9Imh0dHBzOi8vdHdpdHRlci5jb20vJyk7CiAgICAgICAgZGF0ZSA9IGVsbXNbaV0ucXVlcnlTZWxlY3RvcignLl90aW1lc3RhbXAsIC5qcy1zaG9ydC10aW1lc3RhbXAnKTsKICAgICAgICBwaG90b2RhdGEucGhvdG9zLnB1c2goewogICAgICAgICAgdGl0bGU6IHRpdGxlLAogICAgICAgICAgdXJsOiB1cmwucmVwbGFjZSgnOmxhcmdlJywgJycpICsgJzpvcmlnJywKICAgICAgICAgIGhyZWY6ICdodHRwczovL3R3aXR0ZXIuY29tJyArIGRhdGUucGFyZW50Tm9kZS5nZXRBdHRyaWJ1dGUoJ2hyZWYnKSwKICAgICAgICAgIGRhdGU6IGRhdGUgPyBwYXJzZVRpbWUoK2RhdGUuZ2V0QXR0cmlidXRlKCdkYXRhLXRpbWUnKSkgOiAnJyAKICAgICAgICB9KTsKICAgICAgICBpZiAoIXIubWluX3Bvc2l0aW9uKSB7CiAgICAgICAgICB2YXIgbWF4X2lkID0gKGRhdGUucGFyZW50Tm9kZS5nZXRBdHRyaWJ1dGUoJ2hyZWYnKSB8fCAnJykKICAgICAgICAgICAgLm1hdGNoKC9zdGF0dXNcLyhcZCspLyk7CiAgICAgICAgICBpZihtYXhfaWQpewogICAgICAgICAgICBnLmFqYXggPSBtYXhfaWRbMV07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBsb2coIkxvYWRlZCIsIHBob3RvZGF0YS5waG90b3MubGVuZ3RoKTsKICAgIGRvY3VtZW50LnRpdGxlID0gcGhvdG9kYXRhLnBob3Rvcy5sZW5ndGggKyBnLnRvdGFsICsgJyB8fCAnICsgZy5waG90b2RhdGEuYU5hbWU7CiAgICBnLnN0YXR1c0VsZS50ZXh0Q29udGVudCA9IGcucGhvdG9kYXRhLnBob3Rvcy5sZW5ndGggKyBnLnRvdGFsOwogICAgaWYgKHFTKCcjc3RvcEFqYXhDa2InKSAmJiBxUygnI3N0b3BBamF4Q2tiJykuY2hlY2tlZCkgewogICAgICBvdXRwdXQoKTsKICAgIH0gZWxzZSBpZiAoci5oYXNfbW9yZV9pdGVtcyAmJiBnLmFqYXggJiYgIWcuYWpheFN0b3ApIHsKICAgICAgc2V0VGltZW91dChnZXRUd2l0dGVyLCAxMDAwKTsKICAgIH0gZWxzZSB7CiAgICAgIG91dHB1dCgpOwogICAgfQogIH07CiAgdmFyIHVybCA9ICdodHRwczovL3R3aXR0ZXIuY29tL2kvcHJvZmlsZXMvc2hvdy8nK2cucGhvdG9kYXRhLmFOYW1lKycvbWVkaWFfdGltZWxpbmU/aW5jbHVkZV9hdmFpbGFibGVfZmVhdHVyZXM9MSZpbmNsdWRlX2VudGl0aWVzPTEnICsgKGcuYWpheCA/ICgnJm1heF9wb3NpdGlvbj0nK2cuYWpheCkgOiAnJyk7CiAgeGhyLm9wZW4oJ0dFVCcsIHVybCk7CiAgeGhyLnNlbmQoKTsKfQpmdW5jdGlvbiBnZXRXZWlibygpewogIGlmKCFHTV94bWxodHRwUmVxdWVzdCl7YWxlcnQoIlRoaXMgc2NyaXB0IHJlcXVpcmVkIEdyZWFzZW1vbmtleS9UYW1wZXJtb25rZXkhIik7cmV0dXJuO30KICBHTV94bWxodHRwUmVxdWVzdCh7CiAgICBtZXRob2Q6ICJHRVQiLAogICAgdXJsOiAiaHR0cHM6Ly9waG90by53ZWliby5jb20vcGFnZS93YXRlcmZhbGw/ZmlsdGVyPXdicGhvdG8mcGFnZT0iK2cuYWpheFBhZ2UrIiZjb3VudD0yMCZtb2R1bGVfaWQ9cHJvZmlsZV9waG90byZvaWQ9IitnLm9JZCsiJnVpZD0mbGFzdE1pZD0iK2cuYWpheCsiJmxhbmc9emgtdHciLAogICAgb25sb2FkOiBmdW5jdGlvbigpIHsKICAgIGcuYWpheFBhZ2UrKzsKICAgIHZhciByID0gdGhpcy5yZXNwb25zZTsKICAgIHZhciBzID0gci5zbGljZSggci5pbmRleE9mKCJ7Iiksci5sYXN0SW5kZXhPZigifSIpKzEgKTsKICAgIHZhciByZXMgPSBuZXcgRnVuY3Rpb24oInJldHVybiAiICsgcykoKS5kYXRhOwogICAgdmFyIGVsbXMgPSByZXMuaHRtbDsKICAgIHZhciBwaG90b2RhdGE9Zy5waG90b2RhdGE7CiAgICB2YXIgaHRtbDsKICAgIGcuYWpheD1yZXMubGFzdE1pZCB8fCBudWxsOwogICAgZm9yKHZhciBpPTA7ZWxtcyYmaTxlbG1zLmxlbmd0aDtpKyspewogICAgICBodG1sID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgIGh0bWwuaW5uZXJIVE1MID0gZWxtc1tpXTsKICAgICAgdmFyIGxpbmtzID0gaHRtbC5xdWVyeVNlbGVjdG9yQWxsKCJhLnBoX2FyX2JveCIpOwogICAgICB2YXIgaW1nID0gaHRtbC5xdWVyeVNlbGVjdG9yQWxsKCJpbWcucGhvdG9fcGljIik7CiAgICAgIHZhciB0aXRsZSA9IGh0bWwucXVlcnlTZWxlY3RvcigiLmRlc2NyaWJlIHNwYW4iKS50aXRsZSB8fCAnJzsKICAgICAgdmFyIHBob3RvVGltZSA9IGh0bWwucXVlcnlTZWxlY3RvcigiLnBob3RvX3RpbWUiKS50ZXh0Q29udGVudCB8fCAnJzsKICAgICAgZm9yKHZhciBpbWdDb3VudCA9IDA7IGltZ0NvdW50IDwgaW1nLmxlbmd0aDsgaW1nQ291bnQrKyl7CiAgICAgICAgdmFyIGRhdGEgPSB7fTsKICAgICAgICB2YXIgbGluayA9IGxpbmtzW2ltZ0NvdW50XS5nZXRBdHRyaWJ1dGUoImFjdGlvbi1kYXRhIikuc3BsaXQoIiYiKTsKICAgICAgICBmb3IodmFyIGo9MDsgajxsaW5rLmxlbmd0aDsgaisrKXsKICAgICAgICAgIHZhciB0ID0gbGlua1tqXS5zcGxpdCgiPSIpOwogICAgICAgICAgZGF0YVt0WzBdXSA9IHRbMV07CiAgICAgICAgfQogICAgICAgIHZhciB1cmwgPSBpbWdbaW1nQ291bnRdLnNyYy5tYXRjaCgvOlwvXC8oW1x3XC5dKylcLy8pOwogICAgICAgIHVybCA9ICdodHRwOi8vJyArIHVybFsxXSArICcvbGFyZ2UvJyArIGRhdGEucGlkICsgJy5qcGcnOwogICAgICAgIGlmKCFnLmRvd25sb2FkZWRbdXJsXSl7Zy5kb3dubG9hZGVkW3VybF09MTt9ZWxzZXtjb250aW51ZTt9CiAgICAgICAgcGhvdG9kYXRhLnBob3Rvcy5wdXNoKHsKICAgICAgICAgIHRpdGxlOiB0aXRsZSwKICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgaHJlZjogJ2h0dHA6Ly9waG90by53ZWliby5jb20vJytnLnVJZCsnL3RhbGJ1bS9kZXRhaWwvcGhvdG9faWQvJytkYXRhLm1pZCwKICAgICAgICAgIGRhdGU6IHBob3RvVGltZQogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgICBsb2coJ0xvYWRlZCAnK3Bob3RvZGF0YS5waG90b3MubGVuZ3RoKycgcGhvdG9zLicpOwogICAgZG9jdW1lbnQudGl0bGU9IigiK2cucGhvdG9kYXRhLnBob3Rvcy5sZW5ndGgrIikgfHwiK2cucGhvdG9kYXRhLmFOYW1lOwogICAgZy5zdGF0dXNFbGUudGV4dENvbnRlbnQgPSAnTG9hZGVkICcgKyBnLnBob3RvZGF0YS5waG90b3MubGVuZ3RoOwogICAgaWYocVMoJyNzdG9wQWpheENrYicpJiZxUygnI3N0b3BBamF4Q2tiJykuY2hlY2tlZCl7b3V0cHV0KCk7fQogICAgZWxzZSBpZihnLmFqYXgpe3NldFRpbWVvdXQoZ2V0V2VpYm8sIDIwMDApO31lbHNle291dHB1dCgpO30KICB9CiAgfSk7Cn0KZnVuY3Rpb24gcGFyc2VQaW50ZXJlc3QobGlzdCl7CiAgdmFyIHBob3RvZGF0YSA9IGcucGhvdG9kYXRhOwogIGZvcih2YXIgaiA9IDA7IGogPCBsaXN0Lmxlbmd0aDsgaisrKXsKICAgIGlmIChsaXN0W2pdLm5hbWUgfHwgIWxpc3Rbal0uaW1hZ2VzKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgcGhvdG9kYXRhLnBob3Rvcy5wdXNoKHsKICAgICAgdGl0bGU6IGxpc3Rbal0uZGVzY3JpcHRpb24gKyAnPGJyPjxhIHRhZ2V0PSJfYmxhbmsiIGhyZWY9IicgKyAKICAgICAgICBsaXN0W2pdLmxpbmsgKyAnIj5QaW5uZWQgZnJvbSAnICsgbGlzdFtqXS5kb21haW4gKyAnPC9hPicsCiAgICAgIHVybDogKGxpc3Rbal0uaW1hZ2VzLm9yaWcgfHwgbGlzdFtqXS5pbWFnZXNbJzczNngnXSkudXJsLAogICAgICBocmVmOiAnaHR0cHM6Ly93d3cucGludGVyZXN0LmNvbS9waW4vJyArIGxpc3Rbal0uaWQgKyAnLycsCiAgICAgIGRhdGU6IGxpc3Rbal0uY3JlYXRlZF9hdCA/IG5ldyBEYXRlKGxpc3Rbal0uY3JlYXRlZF9hdCkudG9Mb2NhbGVTdHJpbmcoKSA6IGZhbHNlCiAgICB9KTsKICB9CiAgbG9nKCdMb2FkZWQgJyArIHBob3RvZGF0YS5waG90b3MubGVuZ3RoICsgJyBwaG90b3MuJyk7Cn0KZnVuY3Rpb24gZ2V0UGludGVyZXN0KCl7CiAgdmFyIGJvYXJkID0gbG9jYXRpb24ucGF0aG5hbWUubWF0Y2goLyhbXlwvXSspL2cpOwogIGlmIChib2FyZCAmJiBib2FyZFswXSA9PT0gJ3BpbicpIHsKICAgIGNsb3NlRGlhbG9nKCk7CiAgICB2YXIgaW1nID0gcVMoJy5waW5JbWFnZSwgLmltYWdlTGluayBpbWcnKTsKICAgIGlmIChpbWcpIHsKICAgICAgdmFyIGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgICAgIGxpbmsuaHJlZiA9IGltZy5nZXRBdHRyaWJ1dGUoJ3NyYycpOwogICAgICBsaW5rLmRvd25sb2FkID0gJyc7CiAgICAgIGxpbmsuY2xpY2soKTsKICAgIH0KICAgIHJldHVybjsKICB9CiAgZy5zb3VyY2UgPSBib2FyZCA/IGVuY29kZVVSSUNvbXBvbmVudChsb2NhdGlvbi5wYXRobmFtZSkgOiAnLyc7CiAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwogIHhoci5vbmxvYWQgPSBmdW5jdGlvbigpIHsKICAgIHZhciBodG1sID0gdGhpcy5yZXNwb25zZTsKICAgIHZhciBkb2MgPSBnZXRET00oaHRtbCk7CiAgICB2YXIgcyA9IEpTT04ucGFyc2UoZG9jLnF1ZXJ5U2VsZWN0b3IoJyNpbml0aWFsLXN0YXRlJykudGV4dENvbnRlbnQpOwogICAgdmFyIHR5cGUgPSBzLnVpLm1haW5Db21wb25lbnQuY3VycmVudDsKICAgIHZhciByZXNvdXJjZXMgPSBzLnJlc291cmNlcy5kYXRhOwogICAgd2hpbGUgKHJlc291cmNlcyAmJiAhcmVzb3VyY2VzLmRhdGEpIHsKICAgICAgcmVzb3VyY2VzID0gcmVzb3VyY2VzW09iamVjdC5rZXlzKHJlc291cmNlcylbMF1dOwogICAgfQogICAgdmFyIHIgPSByZXNvdXJjZXMgJiYgcmVzb3VyY2VzLmRhdGEgPyByZXNvdXJjZXMuZGF0YSA6IG51bGw7CiAgICBnLnJlc291cmNlID0gdHlwZS5yZXBsYWNlKC9GZWVkfFBhZ2UvZywgJycpICsgJ0ZlZWRSZXNvdXJjZSc7CiAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgY2FzZSAnSG9tZVBhZ2UnOgogICAgICAgIHBhcnNlUGludGVyZXN0KHIpOwogICAgICAgIGcuYm9va21hcmtzID0gewogICAgICAgICAgYm9va21hcmtzOiBbcmVzb3VyY2VzLm5leHRCb29rbWFya10sCiAgICAgICAgICBwcmVwZW5kUGFydG5lcjogZmFsc2UsCiAgICAgICAgICBwcmVwZW5kVXNlck5ld3M6IGZhbHNlLAogICAgICAgICAgcHJlcGVuZEV4cGxvcmVSZXA6IG51bGwsCiAgICAgICAgICBmaWVsZF9zZXRfa2V5OiAnZ3JpZF9pdGVtX3dpdGhfcmVjJwogICAgICAgIH07CiAgICAgICAgZy5yZXNvdXJjZSA9ICdVc2VySG9tZWZlZWRSZXNvdXJjZSc7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ0JvYXJkUGFnZSc6CiAgICAgICAgZy5ib29rbWFya3MgPSB7CiAgICAgICAgICBib2FyZF9pZDogci5pZCwKICAgICAgICAgIGJvYXJkX3VybDogci51cmwsCiAgICAgICAgICBmaWVsZF9zZXRfa2V5OiAncmVhY3RfZ3JpZF9waW4nLAogICAgICAgICAgbGF5b3V0OiAnZGVmYXVsdCcsCiAgICAgICAgICBwYWdlX3NpemU6IDI1CiAgICAgICAgfTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnQm9hcmRTZWN0aW9uUGFnZSc6CiAgICAgICAgZy5ib29rbWFya3MgPSB7CiAgICAgICAgICBzZWN0aW9uX2lkOiByLmlkLAogICAgICAgICAgcGFnZV9zaXplOiAyNQogICAgICAgIH07CiAgICAgICAgZy5yZXNvdXJjZSA9ICdCb2FyZFNlY3Rpb25QaW5zUmVzb3VyY2UnOwogICAgICAgIGcucGhvdG9kYXRhLmFOYW1lICs9ICcgLSAnICsgci50aXRsZTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnRG9tYWluRmVlZFBhZ2UnOgogICAgICAgIGcuYm9va21hcmtzID0ge2RvbWFpbjogYm9hcmRbMl19OwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdQcm9maWxlUGFnZSc6CiAgICAgICAgc3dpdGNoIChib2FyZFsyXSkgewogICAgICAgICAgY2FzZSAncGlucyc6IAogICAgICAgICAgICBnLmJvb2ttYXJrcyA9IHt1c2VybmFtZTogYm9hcmRbMV0sIGZpZWxkX3NldF9rZXk6ICdncmlkX2l0ZW0nfTsKICAgICAgICAgICAgZy5yZXNvdXJjZSA9ICdVc2VyUGluc1Jlc291cmNlJzsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICdsaWtlcyc6CiAgICAgICAgICAgIGcuYm9va21hcmtzID0ge3VzZXJuYW1lOiBib2FyZFsxXSwgcGFnZV9zaXplOiAyNX07CiAgICAgICAgICAgIGcucmVzb3VyY2UgPSAnVXNlckxpa2VzUmVzb3VyY2UnOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ1NlYXJjaFBhZ2UnOgogICAgICAgIHZhciBxdWVyeSA9IGxvY2F0aW9uLnNlYXJjaC5zbGljZSgxKS5yZXBsYWNlKC8mL2csICc9Jykuc3BsaXQoJz0nKTsKICAgICAgICBxdWVyeSA9IHF1ZXJ5W3F1ZXJ5LmluZGV4T2YoJ3EnKSArIDFdOwogICAgICAgIGcuYm9va21hcmtzID0ge3F1ZXJ5OiBxdWVyeSwgc2NvcGU6IGJvYXJkWzJdfTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnVG9waWNGZWVkUGFnZSc6CiAgICAgICAgZy5ib29rbWFya3MgPSB7aW50ZXJlc3Q6IGJvYXJkWzJdfTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnSW50ZXJlc3RGZWVkUGFnZSc6CiAgICAgICAgZy5ib29rbWFya3MgPSB7cXVlcnk6IGJvYXJkWzJdfTsKICAgICAgICBicmVhazsKICAgIH0KICAgIGlmICh0eXBlID09PSAnU2VhcmNoUGFnZScgfHwgdHlwZSA9PT0gJ0ludGVyZXN0RmVlZFBhZ2UnKSB7ICAgCiAgICAgIGlmIChyLnJlc3VsdHMpIHsKICAgICAgICBwYXJzZVBpbnRlcmVzdChyLnJlc3VsdHMpOwogICAgICB9CiAgICAgIGlmIChyZXNvdXJjZXMubmV4dEJvb2ttYXJrKSB7CiAgICAgICAgZy5ib29rbWFya3MuYm9va21hcmtzID0gW3Jlc291cmNlcy5uZXh0Qm9va21hcmtdOwogICAgICB9CiAgICAgIGcucmVzb3VyY2UgPSAnU2VhcmNoUmVzb3VyY2UnOwogICAgfQogICAgZ2V0UGludGVyZXN0X3N1YigpOwogIH07CiAgeGhyLm9wZW4oJ0dFVCcsIGxvY2F0aW9uLmhyZWYpOwogIHhoci5zZW5kKCk7Cn0KZnVuY3Rpb24gZ2V0UGludGVyZXN0X3N1YigpewogIHZhciBwaG90b2RhdGEgPSBnLnBob3RvZGF0YTsKICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgeGhyLm9ubG9hZCA9IGZ1bmN0aW9uKCkgewogICAgdmFyIHIgPSBKU09OLnBhcnNlKHRoaXMucmVzcG9uc2VUZXh0KTsKICAgIHBhcnNlUGludGVyZXN0KHIucmVzb3VyY2VfcmVzcG9uc2UuZGF0YSk7CiAgICBnLmJvb2ttYXJrcyA9IHIucmVzb3VyY2Uub3B0aW9uczsKCiAgICBkb2N1bWVudC50aXRsZT0iKCIrZy5waG90b2RhdGEucGhvdG9zLmxlbmd0aCsiKSB8fCIrZy5waG90b2RhdGEuYU5hbWU7CiAgICBnLnN0YXR1c0VsZS50ZXh0Q29udGVudCA9IGcucGhvdG9kYXRhLnBob3Rvcy5sZW5ndGggKyAnLycgKyBnLnRvdGFsOwogICAgaWYocVMoJyNzdG9wQWpheENrYicpJiZxUygnI3N0b3BBamF4Q2tiJykuY2hlY2tlZCl7b3V0cHV0KCk7fQogICAgZWxzZSBpZihnLmJvb2ttYXJrcy5ib29rbWFya3NbMF0gIT0gJy1lbmQtJyl7CiAgICAgIHNldFRpbWVvdXQoZ2V0UGludGVyZXN0X3N1YiwgMTAwMCk7CiAgICB9ZWxzZXsKICAgICAgb3V0cHV0KCk7CiAgICB9CiAgfTsKICB2YXIgZGF0YSA9IHsKICAgICJvcHRpb25zIiA6IGcuYm9va21hcmtzLAogICAgImNvbnRleHQiOiB7fQogIH07CiAgdmFyIHVybCA9IGxvY2F0aW9uLm9yaWdpbiArICcvcmVzb3VyY2UvJyArIGcucmVzb3VyY2UgKyAnL2dldC8nOwogIHZhciBkYXRhID0gJ3NvdXJjZV91cmw9JyArIGcuc291cmNlICsgJyZkYXRhPScgKwogICAgZXNjYXBlKEpTT04uc3RyaW5naWZ5KGRhdGEpKSArICcmXz0nICsgKCtuZXcgRGF0ZSgpKTsKICB4aHIub3BlbignUE9TVCcsIHVybCk7CiAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ0FjY2VwdCcsICdhcHBsaWNhdGlvbi9qc29uLCB0ZXh0L2phdmFzY3JpcHQsICovKjsgcT0wLjAxJyk7CiAgeGhyLnNldFJlcXVlc3RIZWFkZXIoIkNvbnRlbnQtdHlwZSIsICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiKTsKICB2YXIgdG9rZW4gPSBnLnRva2VuIHx8IGRvY3VtZW50LmNvb2tpZS5tYXRjaCgvY3NyZnRva2VuPShcUyspOy8pCiAgaWYodG9rZW4pewogICAgaWYoIWcudG9rZW4pewogICAgICB0b2tlbiA9IHRva2VuWzFdOwogICAgICBnLnRva2VuID0gdG9rZW47CiAgICB9CiAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignWC1DU1JGVG9rZW4nLCB0b2tlbik7CiAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignWC1ORVctQVBQJywgMSk7CiAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignWC1SZXF1ZXN0ZWQtV2l0aCcsICdYTUxIdHRwUmVxdWVzdCcpOwogICAgeGhyLnNlbmQoZGF0YSk7CiAgfWVsc2V7CiAgICBhbGVydCgnTWlzc2luZyB0b2tlbiEnKTsKICB9Cn0KZnVuY3Rpb24gZ2V0QXNrRk0oKSB7CiAgdmFyIHVybCA9IGcucGFnZSB8fCAobG9jYXRpb24ucHJvdG9jb2wgKyAnLy9hc2suZm0vJyArIGcudXNlcm5hbWUgKyAKICAgICc/bm9fcHJldl9saW5rPXRydWUnKTsKICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgeGhyLm9ubG9hZCA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGh0bWwgPSBnZXRET00odGhpcy5yZXNwb25zZSk7CiAgICB2YXIgaGFzTW9yZSA9IGh0bWwucXVlcnlTZWxlY3RvcignLml0ZW0tcGFnZS1uZXh0Jyk7CiAgICB2YXIgZWxtcyA9IGh0bWwucXVlcnlTZWxlY3RvckFsbCgnLnN0cmVhbUl0ZW1fdmlzdWFsJyk7CiAgICB2YXIgaSwgYm94LCBsaW5rLCB0aXRsZSwgdXJsLCB2aWRlbzsKICAgIHZhciBwaG90b2RhdGEgPSBnLnBob3RvZGF0YTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWxtcy5sZW5ndGg7IGkrKykgewogICAgICBib3ggPSBnZXRQYXJlbnQoZWxtc1tpXSwgJy5pdGVtJyk7CiAgICAgIHZhciBpbWcgPSBlbG1zW2ldLnF1ZXJ5U2VsZWN0b3IoJ2ltZycpOwogICAgICBpZiAoIWltZykgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIHZpZGVvID0gYm94LnF1ZXJ5U2VsZWN0b3IoJy5wbGF5SWNvbicpOwogICAgICBpZiAodmlkZW8pIHsKICAgICAgICB1cmwgPSBpbWcuZ2V0QXR0cmlidXRlKCdzcmMnKTsKICAgICAgICBwaG90b2RhdGEudmlkZW9zLnB1c2goewogICAgICAgICAgdXJsOiBpbWcucGFyZW50Tm9kZS5nZXRBdHRyaWJ1dGUoJ2hyZWYnKSwKICAgICAgICAgIHRodW1iOiB1cmwKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB1cmwgPSBpbWcucGFyZW50Tm9kZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtdXJsJykgfHwKICAgICAgICAgIGltZy5nZXRBdHRyaWJ1dGUoJ3NyYycpOwogICAgICB9CiAgICAgIGxpbmsgPSBib3gucXVlcnlTZWxlY3RvcignLnN0cmVhbUl0ZW1fbWV0YScpOwogICAgICB2YXIgY29udGVudCA9IGJveC5xdWVyeVNlbGVjdG9yKCcuc3RyZWFtSXRlbV9jb250ZW50Jyk7CiAgICAgIGlmIChjb250ZW50KSB7CiAgICAgICAgY29udGVudC5yZW1vdmVDaGlsZChib3gucXVlcnlTZWxlY3RvcignLnJlYWRNb3JlJykpOwogICAgICB9CiAgICAgIHRpdGxlID0gJ1E6ICcgKyAgCiAgICAgICAgZ2V0VGV4dCgnLnN0cmVhbUl0ZW1faGVhZGVyJywgMCwgYm94KSArCiAgICAgICAgJyA8YnI+JyArICdBOiAnICsgZ2V0VGV4dCgnLnN0cmVhbUl0ZW1fY29udGVudCcsIDAsIGJveCk7CiAgICAgIHBob3RvZGF0YS5waG90b3MucHVzaCh7CiAgICAgICAgdGl0bGU6IHRpdGxlLAogICAgICAgIHVybDogdXJsLAogICAgICAgIGhyZWY6ICdodHRwczovL2Fzay5mbScgKyBsaW5rLmdldEF0dHJpYnV0ZSgnaHJlZicpLAogICAgICAgIGRhdGU6IGxpbmsuZ2V0QXR0cmlidXRlKCd0aXRsZScpCiAgICAgIH0pOwogICAgfQogICAgY29uc29sZS5sb2coJ0xvYWRlZCAnICsgcGhvdG9kYXRhLnBob3Rvcy5sZW5ndGggKyAnIHBob3Rvcy4nKTsKICAgIGcuY291bnQgKz0gaHRtbC5xdWVyeVNlbGVjdG9yQWxsKCcuaXRlbScpLmxlbmd0aDsKICAgIGcuc3RhdHVzRWxlLnRleHRDb250ZW50ID0gZy5jb3VudCArICcvJyArIGcudG90YWw7CiAgICBkb2N1bWVudC50aXRsZSA9IGcuc3RhdHVzRWxlLnRleHRDb250ZW50ICsgJyB8fCcgKyBnLnRpdGxlOwogICAgaWYgKGcuY291bnQgPCBnLnRvdGFsICYmIGhhc01vcmUgJiYgIXFTKCcjc3RvcEFqYXhDa2InKS5jaGVja2VkKSB7CiAgICAgIGcucGFnZSA9IGhhc01vcmUuZ2V0QXR0cmlidXRlKCdocmVmJyk7CiAgICAgIHNldFRpbWVvdXQoZ2V0QXNrRk0sIDUwMCk7CiAgICB9IGVsc2UgewogICAgICBpZiAocGhvdG9kYXRhLnBob3Rvcy5sZW5ndGgpIHsKICAgICAgICBvdXRwdXQoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBhbGVydCgnTm8gcGhvdG9zIGxvYWRlZC4nKTsKICAgICAgfQogICAgfQogIH07CiAgeGhyLm9wZW4oJ0dFVCcsIHVybCk7CiAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ1gtUmVxdWVzdGVkLVdpdGgnLCAnWE1MSHR0cFJlcXVlc3QnKTsKICB4aHIuc2VuZCgpOwp9Cgp2YXIgZEZBY29yZSA9IGZ1bmN0aW9uKHNldHVwLCBieXBhc3MpIHsKICBnLnN0YXJ0PTE7Zy5zZXR0aW5ncz17fTsKICBpZighc2V0dXAmJmxvY2FsU3RvcmFnZVsnZEZBU2V0dGluZyddKXsKICAgIGcuc2V0dGluZ3M9bG9jYWxTdG9yYWdlWydkRkFTZXR0aW5nJ10/SlNPTi5wYXJzZShsb2NhbFN0b3JhZ2VbJ2RGQVNldHRpbmcnXSk6e307CiAgfQogIGcubW9kZT1nLnNldHRpbmdzLm1vZGV8fHdpbmRvdy5wcm9tcHQoJ1BsZWFzZSB0eXBlIHlvdXIgY2hvaWNlOlxuTm9ybWFsOiAxL3ByZXNzIEVudGVyXG5Eb3dubG9hZCB3aXRob3V0IGF1dG8gbG9hZDogMlxuQXV0b2xvYWQgc3RhcnQgZnJvbSBzcGVjaWZpYyBpZDogM1xuT3B0aW1pemF0aW9uIGZvciBsYXJnZSBhbGJ1bTogNCcpfHwxOwogIGlmKGcubW9kZT09bnVsbCl7cmV0dXJuO30KICBpZihnLm1vZGU9PTMpe2cuYWpheFN0YXJ0RnJvbT13aW5kb3cucHJvbXB0KCdQbGVhc2UgZW50ZXIgdGhlIGZiaWQ6XG5pLmUuIDEyMzQ1NiBpZiBwaG90byBsaW5rIGlzOlxuZmFjZWJvb2suY29tL3Bob3RvLnBocD9mYmlkPTEyMzQ1NicpO2lmKCFnLmFqYXhTdGFydEZyb20pe3JldHVybjt9fQogIGlmKGcubW9kZT09NCl7Zy5sYXJnZUFsYnVtPXRydWU7Zy5tb2RlPXdpbmRvdy5wcm9tcHQoJ1BsZWFzZSB0eXBlIHlvdXIgY2hvaWNlOlxuTm9ybWFsOiAxL3ByZXNzIEVudGVyXG5Eb3dubG9hZCB3aXRob3V0IGF1dG8gbG9hZDogMlxuQXV0b2xvYWQgc3RhcnQgZnJvbSBzcGVjaWZpYyBpZDogMycpO30KICBnLmxvYWRDbT1nLnNldHRpbmdzLm5vdExvYWRDbT8wOihnLnNldHRpbmdzLmxvYWRDbXx8Y29uZmlybSgiVHJ5IHRvIGxvYWQgcGhvdG8ncyBjYXB0aW9uPyIpKTsKICBnLm5vdExvYWRDbT1nLnNldHRpbmdzLm5vdExvYWRDbXx8IWcubG9hZENtOwogIGcubGFyZ2VBbGJ1bT1nLnNldHRpbmdzLmxhcmdlQWxidW18fGcubGFyZ2VBbGJ1bTsKICBnLnNldHRpbmdzPXttb2RlOmcubW9kZSxsb2FkQ206Zy5sb2FkQ20sbGFyZ2VBbGJ1bTpnLmxhcmdlQWxidW0sbm90TG9hZENtOmcubm90TG9hZENtfTsKICBsb2NhbFN0b3JhZ2VbJ2RGQVNldHRpbmcnXT1KU09OLnN0cmluZ2lmeShnLnNldHRpbmdzKTsKICB2YXIgYU5hbWU9ZG9jdW1lbnQudGl0bGUsYUF1dGg9IiIsYURlcz0iIixhVGltZT0iIjtnLnN0YXJ0PTI7CiAgZy50aW1lT2Zmc2V0PW5ldyBEYXRlKCkuZ2V0VGltZXpvbmVPZmZzZXQoKS82MCotMzYwMDAwMDsKICBjcmVhdGVEaWFsb2coKTsKICBnLnN0YXR1c0VsZSA9IHFTKCcuZGFDb3VudGVyJyk7CiAgaWYobG9jYXRpb24uaG9zdC5tYXRjaCgvLipmYWNlYm9vay5jb20vKSl7CiAgICBpZihxUygnLmZiUGhvdG9BbGJ1bVRpdGxlJyl8fHFTKCcuZmJ4UGhvdG9TZXRQYWdlSGVhZGVyJykpewogICAgYU5hbWU9Z2V0VGV4dCgnLmZiUGhvdG9BbGJ1bVRpdGxlJyl8fGdldFRleHQoImgyIil8fGRvY3VtZW50LnRpdGxlOwogICAgYUF1dGg9Z2V0VGV4dCgnI2ZiLXRpbWVsaW5lLWNvdmVyLW5hbWUnKXx8Z2V0VGV4dCgiaDIiKXx8Z2V0VGV4dCgnLmZiU3RpY2t5SGVhZGVyQnJlYWRjcnVtYiAudWlCdXR0b25UZXh0Jyl8fGdldFRleHQoIi5mYnhQaG90b1NldFBhZ2VIZWFkZXJCeWxpbmUgYSIpOwogICAgaWYoIWFBdXRoKXthTmFtZT1nZXRUZXh0KCcuZmJQaG90b0FsYnVtVGl0bGUnKTsgYUF1dGg9Z2V0VGV4dCgnaDInKTt9CiAgICBhRGVzPWdldFRleHQoJy5mYlBob3RvQ2FwdGlvblRleHQnLDEpOwogICAgdHJ5e2FUaW1lPXFTKCcjZ2xvYmFsQ29udGFpbmVyIGFiYnInKS50aXRsZTsKICAgIHZhciBhTG9jPXFTKCcuZmJQaG90b0FsYnVtQWN0aW9uTGlzdCcpLmxhc3RDaGlsZDsKICAgIGlmKCghYUxvYy50YWdOYW1lfHxhTG9jLnRhZ05hbWUhPSdTUEFOJykmJighYUxvYy5jaGlsZE5vZGVzLmxlbmd0aHx8KGFMb2MuY2hpbGROb2Rlcy5sZW5ndGgmJmFMb2MuY2hpbGROb2Rlc1swXS50YWdOYW1lIT0nSU1HJykpKXthTG9jPWFMb2Mub3V0ZXJIVE1MPyIgQCAiK2FMb2Mub3V0ZXJIVE1MOmFMb2MudGV4dENvbnRlbnQ7YVRpbWU9YVRpbWUrYUxvYzt9fWNhdGNoKGUpe307CiAgICB9CiAgICBpZihsb2NhdGlvbi5ocmVmLm1hdGNoKCcvc2VhcmNoLycpKXsKICAgICAgdmFyIHF1ZXJ5ID0gcVMoJ2lucHV0W25hbWU9InEiXVt2YWx1ZV0nKTsKICAgICAgYU5hbWUgPSBxdWVyeSA/IHF1ZXJ5LnZhbHVlIDogZG9jdW1lbnQudGl0bGU7CiAgICB9CiAgICBzID0gcVNBKCJzY3JpcHQiKTsKICAgIHRyeXsKICAgICAgZm9yKGk9MCx0LCBsZW4gPSBzLmxlbmd0aDsgdD1zW2ldLnRleHRDb250ZW50LCBpPGxlbjsgaSsrKXsKICAgICAgICBpZih0Lm1hdGNoKC9lbnZGbHVzaFwoey8pKXsKICAgICAgICAgIGcuRW52PUpTT04ucGFyc2UodC5zbGljZSh0Lmxhc3RJbmRleE9mKCJlbnZGbHVzaCh7IikrOSwtMikpOyBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH1jYXRjaChlKXthbGVydCgnQ2Fubm90IGxvYWQgcmVxdWlyZWQgdmFyaWFibGUnKTt9CiAgICB0cnl7CiAgICAgIGZvcihpPTA7IHQ9c1tpXS50ZXh0Q29udGVudCwgaTxsZW47IGkrKyl7CiAgICAgICAgdmFyIG0gPSB0Lm1hdGNoKC8iVVNFUl9JRCI6IihcZCspIi8pOwogICAgICAgIGlmKG0pewogICAgICAgICAgZy5FbnYudXNlciA9IG1bMV07IGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfWNhdGNoKGUpe2NvbnNvbGUud2FybihlKTthbGVydCgnQ2Fubm90IGxvYWQgcmVxdWlyZWQgdmFyaWFibGUnKTt9CiAgICBpZiAoIWcubG9hZENtKSB7CiAgICAgIGcubG9hZENtID0gY29uZmlybSgnTG9hZCBjYXB0aW9uIHRvIGNvcnJlY3QgcGhvdG9zIHVybD9cbicgKwogICAgICAgICcoTm90IHJlcXVpcmVkIGZvciBwYWdlKScpOwogICAgICBnLm5vdExvYWRDbSA9ICFnLmxvYWRDbTsKICAgIH0KICAgIGcuYWpheExvYWRlZD0wO2cuZGF0YUxvYWRlZD17fTtnLmFqYXhSZXRyeT0wO2cuZWxtcz0nJztnLmxhc3RMb2FkZWQ9MDtnLnVybExvYWRlZD17fTsKICAgIGcudGh1bWJTZWxlY3RvciA9ICdhLnVpTWVkaWFUaHVtYlthamF4aWZ5XSwgYVtkYXRhLXZpZGVvLWlkXSwgJyArCiAgICAgICdhLnVpTWVkaWFUaHVtYltyZWw9InRoZWF0ZXIiXSwgYS51aU1lZGlhVGh1bWJNZWRpdW0sICcgKwogICAgICAnLmZiUGhvdG9DdXJhdGlvbkNvbnRyb2xXcmFwcGVyIGFbYWpheGlmeV1bcmVsPSJ0aGVhdGVyIl0sICcgKwogICAgICAnYS51aVZpZGVvTGlua1thamF4aWZ5XSwgI2ZiVGltZWxpbmVQaG90b3NGbGV4Z3JpZCBhW2FqYXhpZnldJzsKICAgIGcuZG93bmxvYWRlZD17fTtnLnByb2ZpbGVzTGlzdD17fTtnLmNvbW1lbnRzTGlzdD17Y291bnQ6MH07CiAgICBnLnBob3RvZGF0YSA9IHsKICAgICAgYU5hbWU6YU5hbWUucmVwbGFjZSgvJ3wiL2csJ1wiJyksCiAgICAgIGFBdXRoOmFBdXRoLnJlcGxhY2UoLyd8Ii9nLCdcIicpLAogICAgICBhTGluazp3aW5kb3cubG9jYXRpb24uaHJlZiwKICAgICAgYVRpbWU6YVRpbWUsCiAgICAgIHBob3RvczogW10sCiAgICAgIHZpZGVvczogW10sCiAgICAgIGFEZXM6YURlcywKICAgICAgbGFyZ2VBbGJ1bTpnLmxhcmdlQWxidW0KICAgIH07CiAgICBnLm5ld0wgPSAhIShxU0EoJyNwYWdlbGV0X3RpbWVsaW5lX21lZGxleV9waG90b3MgYVtyb2xlPSJ0YWIiXScpLmxlbmd0aCk7CiAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgICB4aHIub25sb2FkID0gZnVuY3Rpb24oKXsKICAgICAgdmFyIGh0bWwgPSB0aGlzLnJlc3BvbnNlOwogICAgICB2YXIgZG9jID0gZ2V0RE9NKGh0bWwpOwogICAgICB2YXIgcGFnZUlkID0gZG9jLnF1ZXJ5U2VsZWN0b3IoJ1twcm9wZXJ0eT0iYWw6aW9zOnVybCJdJyk7CiAgICAgIGlmIChwYWdlSWQgJiYgcGFnZUlkLmdldEF0dHJpYnV0ZSgnY29udGVudCcpLmluZGV4T2YoJ3BhZ2UnKSA+IDApIHsKICAgICAgICBnLmlzUGFnZSA9IHRydWU7CiAgICAgICAgZy5wYWdlSWQgPSBwYWdlSWQuZ2V0QXR0cmlidXRlKCdjb250ZW50JykubWF0Y2goL1xkKy8pWzBdOwogICAgICB9CiAgICAgIGcuaXNWaWRlbyA9IGxvY2F0aW9uLmhyZWYubWF0Y2goL1wvdmlkZW9zXC98c2V0PXYvKTsKICAgICAgZy5pc1BhZ2VWaWRlbyA9IGcuaXNQYWdlICYmIGcuaXNWaWRlbzsKICAgICAgaWYgKGxvY2F0aW9uLmhyZWYubWF0Y2goJ21lc3NhZ2VzJykpIHsKICAgICAgICBnZXRGYk1lc3NhZ2VzUGhvdG9zKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZ2V0UGhvdG9zKCk7CiAgICAgIH0KICAgIH07CiAgICB4aHIub3BlbignR0VUJywgbG9jYXRpb24uaHJlZik7CiAgICB4aHIuc2VuZCgpOwogIH1lbHNlIGlmKGxvY2F0aW9uLmhvc3QubWF0Y2goLy4qaW5zdGFncmFtLmNvbS8pKXsKICAgIGlmIChsb2NhdGlvbi5wYXRobmFtZSA9PT0gJy8nKSB7CiAgICAgIHJldHVybiBhbGVydCgnUGxlYXNlIGdvIHRvIHByb2ZpbGUgcGFnZS4nKTsKICAgIH0KICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgIHhoci5vbmxvYWQgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGh0bWwgPSB0aGlzLnJlc3BvbnNlOwogICAgICB2YXIgZG9jID0gZ2V0RE9NKGh0bWwpOwogICAgICB0cnkgewogICAgICAgIHMgPSBkb2MucXVlcnlTZWxlY3RvckFsbCgnc2NyaXB0Jyk7CiAgICAgICAgZm9yIChpPTA7IGk8cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgaWYgKCFzW2ldLnNyYyAmJiBzW2ldLnRleHRDb250ZW50LmluZGV4T2YoJ19zaGFyZWREYXRhJykgPiAwKSB7CiAgICAgICAgICAgIHMgPSBzW2ldLnRleHRDb250ZW50OwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZy5FbnYgPSBKU09OLnBhcnNlKHMubWF0Y2goLyh7Ii4qfSkvKVsxXSk7CiAgICAgICAgZy50b2tlbiA9IGcuRW52LmNvbmZpZy5jc3JmX3Rva2VuOwogICAgICAgIHZhciBkYXRhID0gZy5FbnYuZW50cnlfZGF0YTsKICAgICAgICBpZiAoZGF0YS5Qcm9maWxlUGFnZSkgewogICAgICAgICAgZy5FbnYgPSBkYXRhLlByb2ZpbGVQYWdlWzBdLmdyYXBocWw7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFsZXJ0KCdOZWVkIHRvIHJlbG9hZCBmb3IgcmVxdWlyZWQgdmFyaWFibGUuJyk7CiAgICAgICAgICByZXR1cm4gbG9jYXRpb24ucmVsb2FkKCk7CiAgICAgICAgfQogICAgICB9IGNhdGNoKGUpIHthbGVydCgnQ2Fubm90IGxvYWQgcmVxdWlyZWQgdmFyaWFibGUhJyk7fSAKICAgICAgZy5FbnYubWVkaWEgPSBnLkVudi51c2VyLmVkZ2Vfb3duZXJfdG9fdGltZWxpbmVfbWVkaWE7CiAgICAgIGcudG90YWwgPSBnLkVudi5tZWRpYS5jb3VudDsKICAgICAgYU5hbWUgPSBnLkVudi51c2VyLmZ1bGxfbmFtZSB8fCAnSW5zdGFncmFtJzsKICAgICAgYUF1dGggPSBnLkVudi51c2VyLnVzZXJuYW1lOwogICAgICBhTGluayA9IGcuRW52LnVzZXIuZXh0ZXJuYWxfdXJsIHx8ICgnaHR0cDovL2luc3RhZ3JhbS5jb20vJysgIGFBdXRoKTsKICAgICAgdmFyIGFUaW1lID0gZy5FbnYubWVkaWEgJiYgZy5FbnYubWVkaWEubGVuZ3RoID8gCiAgICAgICAgZy5FbnYubWVkaWFbMF0uZGF0ZSA6IDA7CiAgICAgIGcucGhvdG9kYXRhID0gewogICAgICAgIGFOYW1lOiBhTmFtZS5yZXBsYWNlKC8nfCIvZywnXCInKSwKICAgICAgICBhQXV0aDogYUF1dGgsCiAgICAgICAgYUxpbms6IGFMaW5rLAogICAgICAgIGFUaW1lOiBhVGltZSA/ICdMYXN0IFVwZGF0ZTogJyArIHBhcnNlVGltZShhVGltZSkgOiAnJywKICAgICAgICBwaG90b3M6IFtdLAogICAgICAgIHZpZGVvczogW10sCiAgICAgICAgYURlczogKGcuRW52LnVzZXIuYmlvIHx8IGcuRW52LnVzZXIuYmlvZ3JhcGh5IHx8ICcnKS5yZXBsYWNlKC8nfCIvZywnXCInKQogICAgICB9OwogICAgICBnLmRvd25sb2FkZWQgPSB7fTsKICAgICAgZ2V0SW5zdGFncmFtUXVlcnlJZCgpOwogICAgfTsKICAgIHhoci5vcGVuKCdHRVQnLCBsb2NhdGlvbi5ocmVmKTsKICAgIHhoci5zZW5kKCk7CiAgfWVsc2UgaWYobG9jYXRpb24uaG9zdC5tYXRjaCgvdHdpdHRlci5jb20vKSl7CiAgICBnLmlkID0gcVMoJy5Qcm9maWxlQXZhdGFyIGltZycpLmdldEF0dHJpYnV0ZSgnc3JjJykubWF0Y2goL1xkKy8pOwogICAgZy5hamF4ID0gJyc7CiAgICB2YXIgbmFtZSA9IHFTKCdoMSBhJyk7CiAgICB2YXIgYVRpbWUgPSBxUygnLnR3ZWV0LXRpbWVzdGFtcCcpOwogICAgdmFyIHRvdGFsID0gZ2V0VGV4dCgnLlBob3RvUmFpbC1oZWFkaW5nV2l0aENvdW50JykucmVwbGFjZSgnLCcsICcnKS5tYXRjaCgvXGQrLyk7CiAgICBnLnRvdGFsID0gdG90YWwgPyAoJy8nICsgdG90YWxbMF0pIDogJyc7CiAgICBnLnBob3RvZGF0YSA9IHsKICAgICAgYU5hbWU6IG5hbWUuZ2V0QXR0cmlidXRlKCdocmVmJykuc2xpY2UoMSksCiAgICAgIGFBdXRoOiBuYW1lLnRleHRDb250ZW50LAogICAgICBhTGluazogbG9jYXRpb24uaHJlZiwKICAgICAgYVRpbWU6IGFUaW1lID8gYVRpbWUuZ2V0QXR0cmlidXRlKCdkYXRhLW9yaWdpbmFsLXRpdGxlJykgOiAiIiwKICAgICAgcGhvdG9zOiBbXSwKICAgICAgYURlczogZ2V0VGV4dCgnLlByb2ZpbGVIZWFkZXJDYXJkLWJpbycsIHRydWUpCiAgICB9OwogICAgZ2V0VHdpdHRlcigpOwogIH1lbHNlIGlmKGxvY2F0aW9uLmhvc3QubWF0Y2goL3dlaWJvLmNvbS8pKXsKICAgIHRyeXsKICAgICAgYU5hbWU9J+W+ruWNmumFjeWclic7CiAgICAgIGFBdXRoPWdldFRleHQoJy51c2VybmFtZScpIHx8IHFTKCcucGZfcGhvdG8gaW1nJykgPyBxUygnLnBmX3Bob3RvIGltZycpLmFsdCA6ICcnOwogICAgfWNhdGNoKGUpe30KICAgIGcuZG93bmxvYWRlZCA9IHt9OwogICAgdmFyIGsgPSBxU0EoJ3NjcmlwdCcpLCBpZCA9ICcnOwogICAgZm9yKHZhciBpPTA7IGk8ay5sZW5ndGggJiYgIWlkLmxlbmd0aDsgaSsrKXsKICAgICAgdmFyIHQgPSBrW2ldLnRleHRDb250ZW50Lm1hdGNoKC9cJENPTkZJR1xbJ29pZCdcXS8pOwogICAgICBpZih0KWlkID0ga1tpXS50ZXh0Q29udGVudDsKICAgIH0KICAgIGV2YWwoaWQpOwogICAgaWYoISRDT05GSUcpe2FsZXJ0KCLnmbznlJ/pjK/oqqTvvIzoq4voga/ntaHkvZzogIUiKTtyZXR1cm47fQogICAgZy5vSWQgPSAkQ09ORklHLnBhZ2VfaWQgfHwgJENPTkZJRy5vaWQ7CiAgICB2YXIgdUlkID0gcVMoJ1thY3Rpb24tdHlwZT0iY29weV9jb3ZlciJdJykgfHwgcVMoJ1thY3Rpb24tdHlwZT0id2ViaW0uY29udmVyc2F0aW9uIl0nKTsKICAgIGlmKHVJZCl7CiAgICAgIHVJZCA9IHVJZC5nZXRBdHRyaWJ1dGUoJ2FjdGlvbi1kYXRhJykubWF0Y2goL3VpZD0oXGQrKS8pOwogICAgICBpZih1SWQpewogICAgICAgIGcudUlkID0gdUlkWzFdOwogICAgICB9CiAgICB9CiAgICBnLmFqYXhQYWdlID0gMTsKICAgIGcuYWpheCA9ICIiCiAgICBnLnBob3RvZGF0YSA9IHsKICAgICAgYU5hbWU6YU5hbWUsCiAgICAgIGFBdXRoOmFBdXRoLAogICAgICBhTGluazpsb2NhdGlvbi5ocmVmLAogICAgICBhVGltZTphVGltZSwKICAgICAgcGhvdG9zOiBbXSwKICAgICAgYURlczoiIgogICAgfTsKICAgIGdldFdlaWJvKCk7CiAgfWVsc2UgaWYobG9jYXRpb24uaG9zdC5tYXRjaCgvcGludGVyZXN0LykpewogICAgZy5waG90b2RhdGEgPSB7CiAgICAgIGFOYW1lOiBnZXRUZXh0KCdoMycpIHx8ICdQaW50ZXJlc3QnLAogICAgICBhQXV0aDogcVMoJy5wcm9maWxlU291cmNlIGltZycpID8gcVMoJy5wcm9maWxlU291cmNlIGltZycpLmFsdCA6ICcnLAogICAgICBhTGluazogbG9jYXRpb24uaHJlZiwKICAgICAgYVRpbWU6IGFUaW1lLAogICAgICBwaG90b3M6IFtdLAogICAgICBhRGVzOiBhRGVzCiAgICB9OwogICAgZy50b3RhbCA9IGdldFRleHQoJy5iZWxvd0JvYXJkTmFtZUNvbnRhaW5lciBzcGFuJykgfHwgZ2V0VGV4dCgnLnZhbHVlJykgfHwKICAgICAgZ2V0VGV4dCgnLmZpeGVkSGVhZGVyK2RpdiBzcGFuJyk7CiAgICBnZXRQaW50ZXJlc3QoKTsKICB9ZWxzZSBpZihsb2NhdGlvbi5ob3N0Lm1hdGNoKC9hc2suZm0vKSl7CiAgICBnLmNvdW50ID0gMDsKICAgIGcucGFnZSA9IDA7CiAgICBnLnRvdGFsID0gK2dldFRleHQoJy5wcm9maWxlVGFiQW5zd2VyQ291bnQnKTsKICAgIGcudGl0bGUgPSBkb2N1bWVudC50aXRsZTsKICAgIGcudXNlcm5hbWUgPSBnZXRUZXh0KCcucHJvZmlsZS1uYW1lIHNwYW46bnRoLW9mLXR5cGUoMiknKS5zbGljZSgxKTsKICAgIGlmICghZy51c2VybmFtZSkgewogICAgICBnLnVzZXJuYW1lID0gbG9jYXRpb24uaHJlZi5zcGxpdCgnLycpWzNdOwogICAgfQogICAgZy5waG90b2RhdGEgPSB7CiAgICAgIGFOYW1lOiBnZXRUZXh0KCcucHJvZmlsZS1uYW1lIHNwYW46bnRoLW9mLXR5cGUoMSknKSwKICAgICAgYUF1dGg6IGcudXNlcm5hbWUsCiAgICAgIGFMaW5rOiBsb2NhdGlvbi5ocmVmLAogICAgICBhVGltZTogYVRpbWUsCiAgICAgIHBob3RvczogW10sCiAgICAgIHZpZGVvczogW10sCiAgICAgIGFEZXM6IGdldFRleHQoJyNzaWRlYmFyQmlvJywgMSkKICAgIH07CiAgICBnZXRBc2tGTSgpOwogIH0KfTsKZnVuY3Rpb24gc2VuZFJlcXVlc3QocmVxdWVzdCwgc2VuZGVyLCBzZW5kUmVzcG9uc2UpIHsKc3dpdGNoKHJlcXVlc3QudHlwZSl7CiAgY2FzZSAnc3RvcmUnOgogICAgbG9jYWxTdG9yYWdlWyJkb3duQWxidW0iXT1yZXF1ZXN0LmRhdGE7CiAgICBsb2cocmVxdWVzdC5ubysnIHBob3RvcyBkYXRhIHNhdmVkLicpOyBicmVhazsKICBjYXNlICdnZXQnOgogICAgZy5waG90b2RhdGE9SlNPTi5wYXJzZShsb2NhbFN0b3JhZ2VbImRvd25BbGJ1bSJdKTsKICAgIGcuc3RhcnQ9MjsKICAgIGxvZyhnLnBob3RvZGF0YS5waG90b3MubGVuZ3RoKycgcGhvdG9zIGdvdC4nKTsKICAgIGdldFBob3RvcygpOwogICAgYnJlYWs7CiAgY2FzZSAnZXhwb3J0JzoKICAgIGlmKCFyZXF1ZXN0LmRhdGEpe3JlcXVlc3QuZGF0YT1KU09OLnBhcnNlKGxvY2FsU3RvcmFnZVsiZG93bkFsYnVtIl0pO30KICAgIGxvZygnRXhwb3J0ZWQgJytyZXF1ZXN0LmRhdGEucGhvdG9zLmxlbmd0aCsnIHBob3Rvcy4nKTsKICAgIHZhciBhLGI9W10sYz1yZXF1ZXN0LmRhdGE7CiAgICBjLmFOYW1lPShjLmFOYW1lKT9jLmFOYW1lOiJGYWNlYm9vayI7CiAgICB2YXIgZCA9IGMucGhvdG9zLHRvdGFsQ291bnQgPSBkLmxlbmd0aDsKICAgIGZvciAodmFyIGk9MDtpPHRvdGFsQ291bnQ7aSsrKSB7CiAgICAgIGlmKGRbaV0pewogICAgICB2YXIgaHJlZj1kW2ldLmhyZWY/ZFtpXS5ocmVmOicnLHRpdGxlPWRbaV0udGl0bGV8fCcnLHRhZz1kW2ldLnRhZ3x8JycsY29tbWVudHM9ZFtpXS5jb21tZW50c3x8JycsdGFnSW5kaT0nJyxkYXRlSW5kPScnLGNvbW1lbnRJbmQ9Jyc7CiAgICAgIGhyZWY9aHJlZj8nIGhyZWY9IicraHJlZisnIiB0YXJnZXQ9Il9ibGFuayInOicnOwogICAgICBpZiAodGFnKSB7CiAgICAgICAgaWYgKGMuYUxpbmsuaW5kZXhPZignZmFjZWJvb2suY29tJykgPiAtMSkgewogICAgICAgICAgdGFnID0gdGFnLnJlcGxhY2UoL2hyZWY9Ii9nLCAndGFyZ2V0PSJfYmxhbmsiIGhyZWY9Imh0dHBzOi8vd3d3LmZhY2Vib29rLmNvbScpOwogICAgICAgIH0KICAgICAgICB0YWc9JzxkaXYgY2xhc3M9ImxvYWRlZFRhZyI+Jyt0YWcrJzwvZGl2Pic7CiAgICAgICAgdGFnSW5kaT0nPGkgY2xhc3M9InRhZ0Fycm93IHRhZ0luZCI+PC9pPic7CiAgICAgIH0KICAgICAgaWYoY29tbWVudHMpewogICAgICAgIHZhciBjbyA9JzxkaXYgY2xhc3M9ImxvYWRlZENvbW1lbnQiPic7CiAgICAgICAgdHJ5ewogICAgICAgICAgaWYoY29tbWVudHNbMF0+Y29tbWVudHMubGVuZ3RoLTEpewogICAgICAgICAgICB2YXIgY0xpbmsgPSBjb21tZW50c1sxXS5mYmlkID8gKCJodHRwczovL3d3dy5mYWNlYm9vay5jb20vcGhvdG8ucGhwP2ZiaWQ9Iitjb21tZW50c1sxXS5mYmlkKSA6IGNvbW1lbnRzWzFdLmlkOwogICAgICAgICAgICBjbyArPSAnPHAgYWxpZ249ImNlbnRlciI+PGEgaHJlZj0iJytjTGluaysnIiB0YXJnZXQ9Il9ibGFuayI+VmlldyBhbGwgJytjb21tZW50c1swXSsnIGNvbW1lbnRzPC9hPjwvcD4nOwogICAgICAgICAgfQogICAgICAgIH1jYXRjaChlKXt9CiAgICAgICAgZm9yKHZhciBpaT0xOyBpaTxjb21tZW50cy5sZW5ndGg7IGlpKyspewogICAgICAgICAgdmFyIHAgPSBjb21tZW50c1tpaV07CiAgICAgICAgICBjbyArPSAnPGJsb2NrcXVvdGU+PHA+JytwLnRleHQrJzwvcD48c21hbGw+PGEgaHJlZj0iJytwLnVybCsnIiB0YXJnZXQ9Il9ibGFuayI+JytwLm5hbWUrJzwvYT4gJysocC5mYmlkPygnPGEgaHJlZj0iaHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3Bob3RvLnBocD9mYmlkPScrcC5mYmlkKycmY29tbWVudF9pZD0nK3AuaWQrJyIgdGFyZ2V0PSJfYmxhbmsiPicpOicnKStwLmRhdGUrKHAuZmJpZD8nPC9hPic6JycpKyc8L3NtYWxsPjwvYmxvY2txdW90ZT4nOwogICAgICAgIH0KICAgICAgICBjb21tZW50cyA9IGNvICsgJzwvZGl2Pic7CiAgICAgICAgY29tbWVudEluZD0nPGEgdGl0bGU9IkNsaWNrIHRvIHZpZXcgY29tbWVudHMiIHJlbD0iY29tbWVudHMiPjxpIGNsYXNzPSJ0YWdBcnJvdyBjb21tZW50SW5kIj48L2k+PC9hPic7CiAgICAgIH0KICAgICAgaWYoZFtpXS5kYXRlKXtkYXRlSW5kPSc8ZGl2IGNsYXNzPSJkYXRlSW5kIj48c3Bhbj4nK2RbaV0uZGF0ZSsnPC9zcGFuPiA8aSBjbGFzcz0idGFnQXJyb3cgZGF0ZUluZCI+PC9pPjwvZGl2Pic7fQogICAgICB2YXIgJHQgPSBbXTsKICAgICAgdmFyIHRlc3QgPSBmYWxzZTsKICAgICAgdmFyIHRlc3QyID0gZmFsc2U7CiAgICAgIHRyeXtpZih0aXRsZS5tYXRjaCgvPC4qPi8pKSR0ID0gJCh0aXRsZSk7fWNhdGNoKGUpe30KICAgICAgdHJ5e3Rlc3QgPSB0aXRsZS5tYXRjaCgvaGFzQ2FwdGlvbi8pICYmICR0Lmxlbmd0aDt9Y2F0Y2goZSl7fQogICAgICB0cnl7dGVzdDIgPSB0aXRsZS5tYXRjaCgvZGl2LykgJiYgdGl0bGUubWF0Y2goL3NwYW4vKX1jYXRjaChlKXt9CiAgICAgIHRyeXsKICAgICAgICBpZih0ZXN0KXsKICAgICAgICAgIHZhciB0PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgdC5pbm5lckhUTUw9dGl0bGU7CiAgICAgICAgICB2YXIganVuaz10LnF1ZXJ5U2VsZWN0b3IoJy50ZXh0X2V4cG9zZWRfaGlkZScpOwogICAgICAgICAgaWYoanVuayYmanVuay5sZW5ndGgpdC5yZW1vdmVDaGlsZChqdW5rKTsKICAgICAgICAgIHRpdGxlID0gJHQuaHRtbCgpOwogICAgICAgICAgaWYodGl0bGUuaW5kZXhPZigiPGJyPiIpID09IDApdGl0bGUgPSB0aXRsZS5zbGljZSg0KTsKICAgICAgICB9ZWxzZSBpZih0ZXN0Mil7CiAgICAgICAgICB0aXRsZSA9IHRpdGxlLnJlcGxhY2UoLyYoPyFcdysoWztcc118JCkpL2csICImYW1wOyIpLnJlcGxhY2UoLzwvZywgIiZsdDsiKS5yZXBsYWNlKC8+L2csICImZ3Q7Iik7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYoJHQubGVuZ3RoKXsKICAgICAgICAgIHRyeXsKICAgICAgICAgICAgJHQuZmluZCgnLnRleHRfZXhwb3NlZF9oaWRlJykucmVtb3ZlKCkuZW5kKCkKICAgICAgICAgICAgLmZpbmQoJ2RpdiAqJykudW53cmFwKCkuZW5kKCkKICAgICAgICAgICAgLmZpbmQoJy50ZXh0X2V4cG9zZWRfc2hvdycpLnVud3JhcCgpLmVuZCgpCiAgICAgICAgICAgIC5maW5kKCdzcGFuJykuZWFjaChmdW5jdGlvbigpIHskKHRoaXMpLnJlcGxhY2VXaXRoKHRoaXMuY2hpbGROb2Rlcyk7fSk7CiAgICAgICAgICAgIHRpdGxlPSR0Lmh0bWwoKTsKICAgICAgICAgIH1jYXRjaChlKXt9CiAgICAgICAgfQogICAgICB9Y2F0Y2goZSl7fQogICAgICB0aXRsZT10aXRsZT8nPGRpdiBjbGFzcz0iY2FwdGlvbnMiPjxhIGNsYXNzPSJjYXB0aW9ucyIgcmVsPSJjYXB0aW9ucyI+PC9hPicrdGl0bGUrJzwvZGl2Pic6JzxkaXYgY2xhc3M9ImNhcHRpb25zIj48L2Rpdj4nOwogICAgICB2YXIgYSA9ICc8ZGl2IHJlbD0iZ2FsbGVyeSIgY2xhc3M9Iml0ZW0nKyhjLmxhcmdlQWxidW0/JyBsYXJnZUFsYnVtJzonJykrJyIgaWQ9Iml0ZW0nK2krJyI+PGEnK2hyZWYrJz4nKyhpKjErMSkrJzwvYT4nK2NvbW1lbnRJbmQrdGFnSW5kaStkYXRlSW5kKyc8YSBjbGFzcz0iZmFuY3lib3giIHJlbD0iZmFuY3lib3giIGhyZWY9IicrZFtpXS51cmwrJyIgdGFyZ2V0PSJfYmxhbmsiPjxkaXYgY2xhc3M9ImNyb3AiPjxkaXYgc3R5bGU9ImJhY2tncm91bmQtaW1hZ2U6IHVybCgnK2RbaV0udXJsKycpOyIgY2xhc3M9ImltZyI+PGltZyBzcmM9IicrZFtpXS51cmwrJyI+PC9kaXY+PC9kaXY+PC9hPicrdGl0bGUrdGFnK2NvbW1lbnRzKyc8L2Rpdj4nOwogICAgICBiLnB1c2goYSl9CiAgICB9CiAgICB2YXIgdEhUTUw9JzwhRE9DVFlQRSBodG1sPjxodG1sPjxib2R5IGNsYXNzPSJpbmRleCI+JysnPHNjcmlwdD5kb2N1bWVudC50aXRsZT1cJycrYy5hQXV0aCsoYy5hQXV0aD8iLSI6IiIpK2MuYU5hbWUrJ1wnOzwvc2NyaXB0Pic7CiAgICB0SFRNTD10SFRNTCsnPHN0eWxlPmJvZHl7bGluZS1oZWlnaHQ6MTtiYWNrZ3JvdW5kOiNmNWYyZjI7Zm9udC1zaXplOjEzcHg7Y29sb3I6IzQ0NDtwYWRkaW5nLXRvcDo3MHB4O30uY3JvcHt3aWR0aDoxOTJweDtoZWlnaHQ6MTkycHg7b3ZlcmZsb3c6aGlkZGVuO30uY3JvcCBpbWd7ZGlzcGxheTpub25lO31kaXYuaW1ne3dpZHRoOjE5MnB4O2hlaWdodDoxOTJweDtiYWNrZ3JvdW5kLXNpemU6Y292ZXI7YmFja2dyb3VuZC1wb3NpdGlvbjo1MCUgMjUlO2JvcmRlcjpub25lO2ltYWdlLXJlbmRlcmluZzpvcHRpbWl6ZVNwZWVkO31AbWVkaWEgc2NyZWVuIGFuZCAoLXdlYmtpdC1taW4tZGV2aWNlLXBpeGVsLXJhdGlvOjApe2Rpdi5pbWd7aW1hZ2UtcmVuZGVyaW5nOiAtd2Via2l0LW9wdGltaXplLWNvbnRyYXN0O319aGVhZGVye2Rpc3BsYXk6YmxvY2t9LndyYXBwZXJ7d2lkdGg6OTYwcHg7bWFyZ2luOjAgYXV0bztwb3NpdGlvbjpyZWxhdGl2ZX0jaGR7YmFja2dyb3VuZDojZmFmN2Y3O3Bvc2l0aW9uOmZpeGVkO3otaW5kZXg6MTAwO3RvcDowO2xlZnQ6MDt3aWR0aDoxMDAlO30jaGQgLmxvZ297cGFkZGluZzo3cHggMDtib3JkZXItYm90dG9tOjFweCBzb2xpZCByZ2JhKDAsMCwwLDAuMil9I2NvbnRhaW5lcnt3aWR0aDo5NDhweDtwb3NpdGlvbjpyZWxhdGl2ZTttYXJnaW46MCBhdXRvfS5pdGVte3dpZHRoOjE5MnB4O2Zsb2F0OmxlZnQ7cGFkZGluZzo1cHggMTVweCAwO21hcmdpbjowIDdweCAxNXB4O2ZvbnQtc2l6ZToxMnB4O2JhY2tncm91bmQ6d2hpdGU7bGluZS1oZWlnaHQ6MS41fS5pdGVtIC5jYXB0aW9uc3tjb2xvcjojOGM3ZTdlO3BhZGRpbmctYm90dG9tOjE1cHg7b3ZlcmZsb3c6aGlkZGVuO2hlaWdodDo4cHg7cG9zaXRpb246cmVsYXRpdmU7fS5pdGVtIC5jYXB0aW9uczpmaXJzdC1jaGlsZHtwb3NpdGlvbjphYnNvbHV0ZTt3aWR0aDoxMDAlO2hlaWdodDoxMDAlO3RvcDowO2xlZnQ6MDt6LWluZGV4OjE7fSNsb2dve2JhY2tncm91bmQtY29sb3I6IzNCNTk5ODtjb2xvcjojRkZGfSNoZCAubG9nbyBoMXtiYWNrZ3JvdW5kLWNvbG9yOiMzQjU5OTg7bGVmdDowO3Bvc2l0aW9uOnJlbGF0aXZlO3dpZHRoOjEwMCU7ZGlzcGxheTpibG9jazttYXJnaW46MDtjb2xvcjojRkZGO2hlaWdodDoxMDAlO2ZvbnQtc2l6ZToyMHB4fSNsb2dvIGF7Y29sb3I6I0ZGRn0jbG9nbyBhOmhvdmVye2NvbG9yOiNGRjl9cHJvZ3Jlc3N7d2lkdGg6MTAwJX0jYURlc3tsaW5lLWhlaWdodDoxLjQ7fS5sYXJnZUFsYnVtPmF7dmlzaWJpbGl0eTp2aXNpYmxlO30ubGFyZ2VBbGJ1bSAuZmFuY3lib3h7dmlzaWJpbGl0eTpoaWRkZW47ZGlzcGxheTpub25lO30ub0ltZ3tiYWNrZ3JvdW5kLWNvbG9yOiNGRkN9XAogICAgICAudHdpdHRlci1lbW9qaSwgLnR3aXR0ZXItaGFzaGZsYWcge2hlaWdodDogMS4yNWVtOyB3aWR0aDogMS4yNWVtOyBwYWRkaW5nOiAwIC4wNWVtIDAgLjFlbTsgdmVydGljYWwtYWxpZ246IC0wLjJlbTt9XAogICAgICAvKiBkcmFnICovICNvdXRwdXR7ZGlzcGxheTpub25lO2JhY2tncm91bmQ6Z3JleTttaW4taGVpZ2h0OjIwMHB4O21hcmdpbjoyMHB4O3BhZGRpbmc6MTBweDtib3JkZXI6MnB4IGRvdHRlZCNmZmY7dGV4dC1hbGlnbjpjZW50ZXI7cG9zaXRpb246cmVsYXRpdmU7LW1vei1ib3JkZXItcmFkaXVzOjE1cHg7LXdlYmtpdC1ib3JkZXItcmFkaXVzOjE1cHg7Ym9yZGVyLXJhZGl1czoxNXB4O30jb3V0cHV0OmJlZm9yZXtjb250ZW50OiJEcmFnIGFuZCBEcm9wIGltYWdlcy4iO2NvbG9yOiNmZmY7Zm9udC1zaXplOjUwcHg7Zm9udC13ZWlnaHQ6Ym9sZDtvcGFjaXR5OjAuNTt0ZXh0LXNoYWRvdzoxcHggMXB4IzAwMDtwb3NpdGlvbjphYnNvbHV0ZTt3aWR0aDoxMDAlO2xlZnQ6MDt0b3A6NTAlO21hcmdpbjotNTBweCAwIDA7ei1pbmRleDoxO30jb3V0cHV0IGltZ3tkaXNwbGF5OmlubGluZS1ibG9jazttYXJnaW46MCAxMHB4IDEwcHggMDt9IGJ1dHRvbntkaXNwbGF5OmlubGluZS1ibG9jazt2ZXJ0aWNhbC1hbGlnbjpiYXNlbGluZTtvdXRsaW5lOm5vbmU7Y3Vyc29yOnBvaW50ZXI7dGV4dC1hbGlnbjpjZW50ZXI7dGV4dC1kZWNvcmF0aW9uOm5vbmU7Zm9udDo3MDAgMTRweC8xMDAlIEFyaWFsLCBIZWx2ZXRpY2EsIHNhbnMtc2VyaWY7dGV4dC1zaGFkb3c6MCAxcHggMXB4IHJnYmEoMCwwLDAsLjMpO2NvbG9yOiNkOWVlZjc7Ym9yZGVyOnNvbGlkIDFweCAjMDA3NmEzOy13ZWJraXQtYm9yZGVyLXJhZGl1czouNWVtOy1tb3otYm9yZGVyLXJhZGl1czouNWVtO2JhY2tncm91bmQtY29sb3I6IzU5Rjtib3JkZXItcmFkaXVzOi41ZW07bWFyZ2luOjAgMnB4IDEycHg7cGFkZGluZzouNWVtIDFlbSAuNTVlbTt9LmNOYW1le2Rpc3BsYXk6bm9uZTt9I2ZzQ291bnR7cG9zaXRpb246IGFic29sdXRlO3RvcDogMjA7cmlnaHQ6IDIwO2ZvbnQtc2l6ZTogM2VtO31cCiAgICAgIC8qISBmYW5jeUJveCB2Mi4xLjMgZmFuY3lhcHBzLmNvbSB8IGZhbmN5YXBwcy5jb20vZmFuY3lib3gvI2xpY2Vuc2UgKi9cCiAgICAgIC5mYW5jeWJveC13cmFwLC5mYW5jeWJveC1za2luLC5mYW5jeWJveC1vdXRlciwuZmFuY3lib3gtaW5uZXIsLmZhbmN5Ym94LWltYWdlLC5mYW5jeWJveC13cmFwIGlmcmFtZSwuZmFuY3lib3gtd3JhcCBvYmplY3QsLmZhbmN5Ym94LW5hdiwuZmFuY3lib3gtbmF2IHNwYW4sLmZhbmN5Ym94LXRtcHtib3JkZXI6MDtvdXRsaW5lOm5vbmU7dmVydGljYWwtYWxpZ246dG9wO21hcmdpbjowO3BhZGRpbmc6MDt9LmZhbmN5Ym94LXdyYXB7cG9zaXRpb246YWJzb2x1dGU7dG9wOjA7bGVmdDowO3otaW5kZXg6ODAyMDt9LmZhbmN5Ym94LXNraW57cG9zaXRpb246cmVsYXRpdmU7YmFja2dyb3VuZDojZjlmOWY5O2NvbG9yOiM0NDQ7dGV4dC1zaGFkb3c6bm9uZTstd2Via2l0LWJvcmRlci1yYWRpdXM6NHB4Oy1tb3otYm9yZGVyLXJhZGl1czo0cHg7Ym9yZGVyLXJhZGl1czo0cHg7fS5mYW5jeWJveC1vcGVuZWR7ei1pbmRleDo4MDMwO30uZmFuY3lib3gtb3V0ZXIsLmZhbmN5Ym94LWlubmVye3Bvc2l0aW9uOnJlbGF0aXZlO30uZmFuY3lib3gtdHlwZS1pZnJhbWUgLmZhbmN5Ym94LWlubmVyey13ZWJraXQtb3ZlcmZsb3ctc2Nyb2xsaW5nOnRvdWNoO30uZmFuY3lib3gtZXJyb3J7Y29sb3I6IzQ0NDtmb250OjE0cHgvMjBweCAiSGVsdmV0aWNhIE5ldWUiLEhlbHZldGljYSxBcmlhbCxzYW5zLXNlcmlmO3doaXRlLXNwYWNlOm5vd3JhcDttYXJnaW46MDtwYWRkaW5nOjE1cHg7fS5mYW5jeWJveC1pbWFnZSwuZmFuY3lib3gtaWZyYW1le2Rpc3BsYXk6YmxvY2s7d2lkdGg6MTAwJTtoZWlnaHQ6MTAwJTt9LmZhbmN5Ym94LWltYWdle21heC13aWR0aDoxMDAlO21heC1oZWlnaHQ6MTAwJTt9I2ZhbmN5Ym94LWxvYWRpbmcsLmZhbmN5Ym94LWNsb3NlLC5mYW5jeWJveC1wcmV2IHNwYW4sLmZhbmN5Ym94LW5leHQgc3BhbntiYWNrZ3JvdW5kLWltYWdlOnVybChkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQUN3QUFBQ1lCQU1BQUFCdDhSWlJBQUFBTUZCTVZFVUFBQUFCQVFFaUlpSWpJeU00T0RoTVRFeG1abWFDZ29LQWdJQ2ZuNSs1dWJuVzF0YnQ3ZTMvLy8vKy92NFBEdyswSWNIc0FBQUFFSFJTVGxQLy8vLy8vLy8vLy8vLy8vLy8vLzhBNENOZEdRQUFBQWx3U0ZsekFBQUxFd0FBQ3hNQkFKcWNHQUFBQXBoSlJFRlVTTWZ0bEUxb0UwRVVnTmVDSUNydTBZdW5hVk5OU2oza2JpbTVTcVVFQ2g3TXhaTVV2UFFnS0JRUGdnclNTeTlTZEZWQzhROFh3Yk5McFdoQnlSSlFFNXZzdmltSUZqeHNzMTRLbW5Uai9HUitOcnM5V0g5T2VaZGxQOTYrblhuenZqRzZxV0hzRGIrc1ZKSzRBelNxZmJnTjc2N1BYSGltT01mdTJ6eENhUGd1anVHb1dVQTBSdXlXanQweTRwSERHbTQza1FpN3F2REYxeEtmM2xEWVdaVDRPSlo0MjZOZmwxR08xbklrL3RFZ3I5QkVGcENuVlJXNFhTZXY4N0FFbjhpekpISG5JeTFLOWo1SG5sTXRnWTk4UUN5ZEpxUHhqVGkyZ1A0Q25aVDRNQzJTSlVYb09rL0pJb2RxTEhtSnBhdGZIcVJGQ1dNTG5GK0piY2RhUkZtYWJjdnRmSGZQeTgyUHFzMkhWbG5pbktkYWRVdzExdElhdXorWTY5RVQrakdFQ3lMZGF1aUhkaUI0eU9nc3ZxL2o4Qnc4S3FDUks3QVdINGg5OXdBcUFOLzZwMnBvMWdYL2NYSUdRd09aZno3SS94QnZiVzFWRXpoaWpyVDZjQVROU3pObjcyaWM0WURiY0F2SGNPUVZlKzMyZEJ3c2k4T0I1d3BIWGtFYzVZS20xTTVYZGZDK3dvRnlaTmk1S3JHZlo0T3p5WDY2SW5DSEgzdUpUcUNZZW9yclRPQ0FqZmRZWGVDSWpqZWFZTk5OeGxOaUprUEFTeW04ODU2NkFhdGMxMGFzU0FiNnN6dlVFWFFHWHJEOXJBdmNYdWNyOGRoS2FnTC81SjlQQU8xTTZaWGFQRy9yR3J0UEhranNLRWN5ZUZJMXRxNDYyRERWeFlHTDhrNWFWYmhydjVFMzJLUitoUUZYS21Odkd2ckoyOTQxUnYxcFU4ZmJydi9rNW1VSGw0MzRWQjExeUZENXk0WVp4K0hRamFlM3B4V1ZvMm1RTUFmdS9EZDN1RG9KZDhhaG1PWk9GcjZrdVlNc25FOXhCK1hnYzlJZEVpNU91a096YXludUlBY1hVdHdaNjYya3o1MHB0cENFTzZOYzE0RTdmeEViaWFEWVNJbXVFYVpoY3pjOGlFRU1ZbS94ZTZidG9tdTYzTDhBMzR6T3lzUjJEL1FBQUFBQVNVVk9SSzVDWUlJPSk7fSNmYW5jeWJveC1sb2FkaW5ne3Bvc2l0aW9uOmZpeGVkO3RvcDo1MCU7bGVmdDo1MCU7bWFyZ2luLXRvcDotMjJweDttYXJnaW4tbGVmdDotMjJweDtiYWNrZ3JvdW5kLXBvc2l0aW9uOjAgLTEwOHB4O29wYWNpdHk6MC44O2N1cnNvcjpwb2ludGVyO3otaW5kZXg6ODA2MDt9I2ZhbmN5Ym94LWxvYWRpbmcgZGl2e3dpZHRoOjQ0cHg7aGVpZ2h0OjQ0cHg7fS5mYW5jeWJveC1jbG9zZXtwb3NpdGlvbjphYnNvbHV0ZTt0b3A6LTE4cHg7cmlnaHQ6LTE4cHg7d2lkdGg6MzZweDtoZWlnaHQ6MzZweDtjdXJzb3I6cG9pbnRlcjt6LWluZGV4OjgwNDA7fS5mYW5jeWJveC1uYXZ7cG9zaXRpb246YWJzb2x1dGU7dG9wOjA7d2lkdGg6NDAlO2hlaWdodDoxMDAlO2N1cnNvcjpwb2ludGVyO3RleHQtZGVjb3JhdGlvbjpub25lO2JhY2tncm91bmQ6dHJhbnNwYXJlbnQgdXJsKGRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxSMGxHT0RsaEFRQUJBSUFBQVAvLy93QUFBQ0g1QkFFQUFBQUFMQUFBQUFBQkFBRUFBQUlDUkFFQU93PT0pOy13ZWJraXQtdGFwLWhpZ2hsaWdodC1jb2xvcjpyZ2JhKDAsMCwwLDApO3otaW5kZXg6ODA0MDt9LmZhbmN5Ym94LXByZXZ7bGVmdDotMzAlO30uZmFuY3lib3gtbmV4dHtyaWdodDotMzAlO30uZmFuY3lib3gtbmF2IHNwYW57cG9zaXRpb246YWJzb2x1dGU7dG9wOjUwJTt3aWR0aDozNnB4O2hlaWdodDozNHB4O21hcmdpbi10b3A6LTE4cHg7Y3Vyc29yOnBvaW50ZXI7ei1pbmRleDo4MDQwO3Zpc2liaWxpdHk6aGlkZGVuO30uZmFuY3lib3gtcHJldiBzcGFue2xlZnQ6MTBweDtiYWNrZ3JvdW5kLXBvc2l0aW9uOjAgLTM2cHg7fS5mYW5jeWJveC1uZXh0IHNwYW57cmlnaHQ6MTBweDtiYWNrZ3JvdW5kLXBvc2l0aW9uOjAgLTcycHg7fS5mYW5jeWJveC10bXB7cG9zaXRpb246YWJzb2x1dGU7dG9wOi05OTk5OXB4O2xlZnQ6LTk5OTk5cHg7dmlzaWJpbGl0eTpoaWRkZW47bWF4LXdpZHRoOjk5OTk5cHg7bWF4LWhlaWdodDo5OTk5OXB4O292ZXJmbG93OnZpc2libGUhaW1wb3J0YW50O30uZmFuY3lib3gtb3ZlcmxheXtwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MDtsZWZ0OjA7b3ZlcmZsb3c6aGlkZGVuO2Rpc3BsYXk6bm9uZTt6LWluZGV4OjgwMTA7YmFja2dyb3VuZC1pbWFnZTp1cmwoZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFBRUFBQUFCQ0FZQUFBQWZGY1NKQUFBQUdYUkZXSFJUYjJaMGQyRnlaUUJCWkc5aVpTQkpiV0ZuWlZKbFlXUjVjY2xsUEFBQUF5SnBWRmgwV0UxTU9tTnZiUzVoWkc5aVpTNTRiWEFBQUFBQUFEdy9lSEJoWTJ0bGRDQmlaV2RwYmowaTc3dS9JaUJwWkQwaVZ6Vk5NRTF3UTJWb2FVaDZjbVZUZWs1VVkzcHJZemxrSWo4K0lEeDRPbmh0Y0cxbGRHRWdlRzFzYm5NNmVEMGlZV1J2WW1VNmJuTTZiV1YwWVM4aUlIZzZlRzF3ZEdzOUlrRmtiMkpsSUZoTlVDQkRiM0psSURVdU15MWpNREV4SURZMkxqRTBOVFkyTVN3Z01qQXhNaTh3TWk4d05pMHhORG8xTmpveU55QWdJQ0FnSUNBZ0lqNGdQSEprWmpwU1JFWWdlRzFzYm5NNmNtUm1QU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh4T1RrNUx6QXlMekl5TFhKa1ppMXplVzUwWVhndGJuTWpJajRnUEhKa1pqcEVaWE5qY21sd2RHbHZiaUJ5WkdZNllXSnZkWFE5SWlJZ2VHMXNibk02ZUcxd1BTSm9kSFJ3T2k4dmJuTXVZV1J2WW1VdVkyOXRMM2hoY0M4eExqQXZJaUI0Yld4dWN6cDRiWEJOVFQwaWFIUjBjRG92TDI1ekxtRmtiMkpsTG1OdmJTOTRZWEF2TVM0d0wyMXRMeUlnZUcxc2JuTTZjM1JTWldZOUltaDBkSEE2THk5dWN5NWhaRzlpWlM1amIyMHZlR0Z3THpFdU1DOXpWSGx3WlM5U1pYTnZkWEpqWlZKbFppTWlJSGh0Y0RwRGNtVmhkRzl5Vkc5dmJEMGlRV1J2WW1VZ1VHaHZkRzl6YUc5d0lFTlROaUFvVjJsdVpHOTNjeWtpSUhodGNFMU5Pa2x1YzNSaGJtTmxTVVE5SW5odGNDNXBhV1E2UWpZM05qTTBPVUpGTkRjMU1URkZNVGsyUkVORVJVTTVSakk1TlRJd01FUWlJSGh0Y0UxTk9rUnZZM1Z0Wlc1MFNVUTlJbmh0Y0M1a2FXUTZRalkzTmpNME9VTkZORGMxTVRGRk1UazJSRU5FUlVNNVJqSTVOVEl3TUVRaVBpQThlRzF3VFUwNlJHVnlhWFpsWkVaeWIyMGdjM1JTWldZNmFXNXpkR0Z1WTJWSlJEMGllRzF3TG1scFpEcENOamMyTXpRNU9VVTBOelV4TVVVeE9UWkVRMFJGUXpsR01qazFNakF3UkNJZ2MzUlNaV1k2Wkc5amRXMWxiblJKUkQwaWVHMXdMbVJwWkRwQ05qYzJNelE1UVVVME56VXhNVVV4T1RaRVEwUkZRemxHTWprMU1qQXdSQ0l2UGlBOEwzSmtaanBFWlhOamNtbHdkR2x2Ymo0Z1BDOXlaR1k2VWtSR1BpQThMM2c2ZUcxd2JXVjBZVDRnUEQ5NGNHRmphMlYwSUdWdVpEMGljaUkvUGdiWHRWa0FBQUFQU1VSQlZIamFZaERnNGRrQUVHQUFBVEVBMmFsQ2ZDSUFBQUFBU1VWT1JLNUNZSUk9KTt9LmZhbmN5Ym94LW92ZXJsYXktZml4ZWR7cG9zaXRpb246Zml4ZWQ7Ym90dG9tOjA7cmlnaHQ6MDt9LmZhbmN5Ym94LWxvY2sgLmZhbmN5Ym94LW92ZXJsYXl7b3ZlcmZsb3c6YXV0bztvdmVyZmxvdy15OnNjcm9sbDt9LmZhbmN5Ym94LXRpdGxle3Zpc2liaWxpdHk6aGlkZGVuO2ZvbnQ6bm9ybWFsIDEzcHgvMjBweCAiSGVsdmV0aWNhIE5ldWUiLEhlbHZldGljYSxBcmlhbCxzYW5zLXNlcmlmO3Bvc2l0aW9uOnJlbGF0aXZlO3RleHQtc2hhZG93Om5vbmU7ei1pbmRleDo4MDUwO30uZmFuY3lib3gtdGl0bGUtZmxvYXQtd3JhcHtwb3NpdGlvbjphYnNvbHV0ZTtib3R0b206MDtyaWdodDo1MCU7bWFyZ2luLWJvdHRvbTotMzVweDt6LWluZGV4OjgwNTA7dGV4dC1hbGlnbjpjZW50ZXI7fS5mYW5jeWJveC10aXRsZS1mbG9hdC13cmFwIC5jaGlsZHtkaXNwbGF5OmlubGluZS1ibG9jazttYXJnaW4tcmlnaHQ6LTEwMCU7YmFja2dyb3VuZDpyZ2JhKDAsMCwwLDAuOCk7LXdlYmtpdC1ib3JkZXItcmFkaXVzOjE1cHg7LW1vei1ib3JkZXItcmFkaXVzOjE1cHg7Ym9yZGVyLXJhZGl1czoxNXB4O3RleHQtc2hhZG93OjAgMXB4IDJweCAjMjIyO2NvbG9yOiNGRkY7Zm9udC13ZWlnaHQ6NzAwO2xpbmUtaGVpZ2h0OjI0cHg7d2hpdGUtc3BhY2U6bm93cmFwO3BhZGRpbmc6MnB4IDIwcHg7fS5mYW5jeWJveC10aXRsZS1vdXRzaWRlLXdyYXB7cG9zaXRpb246cmVsYXRpdmU7bWFyZ2luLXRvcDoxMHB4O2NvbG9yOiNmZmY7fS5mYW5jeWJveC10aXRsZS1pbnNpZGUtd3JhcHtwYWRkaW5nLXRvcDoxMHB4O30uZmFuY3lib3gtdGl0bGUtb3Zlci13cmFwe3Bvc2l0aW9uOmFic29sdXRlO2JvdHRvbTowO2xlZnQ6MDtjb2xvcjojZmZmO2JhY2tncm91bmQ6cmdiYSgwLDAsMCwuOCk7cGFkZGluZzoxMHB4O30uZmFuY3lib3gtaW5uZXIsLmZhbmN5Ym94LWxvY2t7b3ZlcmZsb3c6aGlkZGVuO30uZmFuY3lib3gtbmF2OmhvdmVyIHNwYW4sLmZhbmN5Ym94LW9wZW5lZCAuZmFuY3lib3gtdGl0bGV7dmlzaWJpbGl0eTp2aXNpYmxlO31cCiAgICAgICNmYW5jeWJveC1idXR0b25ze3Bvc2l0aW9uOmZpeGVkO2xlZnQ6MDt3aWR0aDoxMDAlO3otaW5kZXg6ODA1MDt9I2ZhbmN5Ym94LWJ1dHRvbnMudG9we3RvcDoxMHB4O30jZmFuY3lib3gtYnV0dG9ucy5ib3R0b217Ym90dG9tOjEwcHg7fSNmYW5jeWJveC1idXR0b25zIHVse2Rpc3BsYXk6YmxvY2s7d2lkdGg6NDAwcHg7aGVpZ2h0OjMwcHg7bGlzdC1zdHlsZTpub25lO21hcmdpbjowIGF1dG87cGFkZGluZzowO30jZmFuY3lib3gtYnV0dG9ucyB1bCBsaXtmbG9hdDpsZWZ0O21hcmdpbjowO3BhZGRpbmc6MDt9I2ZhbmN5Ym94LWJ1dHRvbnMgYXtkaXNwbGF5OmJsb2NrO3dpZHRoOjMwcHg7aGVpZ2h0OjMwcHg7dGV4dC1pbmRlbnQ6LTk5OTlweDtiYWNrZ3JvdW5kLWltYWdlOnVybChkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQUZvQUFBQmFCQU1BQUFES2hsd3hBQUFBTUZCTVZFVUFBQUFBQUFBZUhoNHVMaTVGUlVWWFYxZGlZbUozZDNlTGk0dTh2THpoNGVIejgvUDI5dmIvLy8vKy92NFBEdzlYd3IwcUFBQUFFSFJTVGxQLy8vLy8vLy8vLy8vLy8vLy8vLzhBNENOZEdRQUFBQWx3U0ZsekFBQUxFd0FBQ3hNQkFKcWNHQUFBQWJWSlJFRlVXTVB0bGt0dWd6QVFoblBObnFMblNSdUpYYVJHVkZtM05tRmRQTUMrWUhxQThOaVdCSEJkbFBneEVUUklWYXRXaklRMEhuLzhETDlseXdzeEpSWXovVDEwaCt1eGtlZnlpVXc2eFBST3B3MzN4WkhIbW00eVREOVdLZzJMUkhoWnF1bXd1TkRXNzd0UWtBd0NSVGVweDJWVTV5L0xTRU1sWGtQRWMzQVVIVEpDQ0VTbitTNEZPYVphL0Y3T1BxbS9iREx5R1hDbW9SOGE0bkxrS0xydXB5bWl3VC9UaHozWmJiV0RLOVpQbnp4dW9NZVo2c1NUZEtMcEd0aFNoblA2OEVhR0lYM01HS0dGcngxY0FYYlFEYlIweXBZMFREUmRYOUpLV3REOFJhd2lacXo4Q3RNYm5SNmsxelZzRGZvZDA0NlJQOGpuYnQ2WE0vMW42V29TelgycnlMbG8rZHNnWGFSV3NTeEZWMWFEZEY0a1pqR1A1QkUwVEFQajV2RU9JSStnZUpnbTFHejlTNXA0NlJTYUdLMWZRVU13Z2FiUGt6cHhycWNaV1YvdllBNVBFMWFuREc0bnJEdzRWcEZSMFpEaFR0YnpMcDdwLzAzTFc2QjVxbmFYVjF0TDI3WDJWdXNYOFJqZFduVEg5NlBhcGJYTHV6SWU3WnZkeEJiOU9rYlh2dGdhOWNhNEVQNmMzOGhiNUR5bXNiZHVXWTFwSTIvYmNScDVXOEk0YlhtTG5NYzA4aFk1UCsvTDM2TS9BUFlyZXU3cnBVNS9BQUFBQUVsRlRrU3VRbUNDKTtiYWNrZ3JvdW5kLXJlcGVhdDpuby1yZXBlYXQ7b3V0bGluZTpub25lO29wYWNpdHk6MC44O30jZmFuY3lib3gtYnV0dG9ucyBhOmhvdmVye29wYWNpdHk6MTt9I2ZhbmN5Ym94LWJ1dHRvbnMgYS5idG5QcmV2e2JhY2tncm91bmQtcG9zaXRpb246NXB4IDA7fSNmYW5jeWJveC1idXR0b25zIGEuYnRuTmV4dHtiYWNrZ3JvdW5kLXBvc2l0aW9uOi0zM3B4IDA7Ym9yZGVyLXJpZ2h0OjFweCBzb2xpZCAjM2UzZTNlO30jZmFuY3lib3gtYnV0dG9ucyBhLmJ0blBsYXl7YmFja2dyb3VuZC1wb3NpdGlvbjowIC0zMHB4O30jZmFuY3lib3gtYnV0dG9ucyBhLmJ0blBsYXlPbntiYWNrZ3JvdW5kLXBvc2l0aW9uOi0zMHB4IC0zMHB4O30jZmFuY3lib3gtYnV0dG9ucyBhLmJ0blRvZ2dsZXtiYWNrZ3JvdW5kLXBvc2l0aW9uOjNweCAtNjBweDtib3JkZXItbGVmdDoxcHggc29saWQgIzExMTtib3JkZXItcmlnaHQ6MXB4IHNvbGlkICMzZTNlM2U7d2lkdGg6MzVweDt9I2ZhbmN5Ym94LWJ1dHRvbnMgYS5idG5Ub2dnbGVPbntiYWNrZ3JvdW5kLXBvc2l0aW9uOi0yN3B4IC02MHB4O30jZmFuY3lib3gtYnV0dG9ucyBhLmJ0bkNsb3Nle2JvcmRlci1sZWZ0OjFweCBzb2xpZCAjMTExO3dpZHRoOjM1cHg7YmFja2dyb3VuZC1wb3NpdGlvbjotNTZweCAwO30jZmFuY3lib3gtYnV0dG9ucyBhLmJ0bkRpc2FibGVke29wYWNpdHk6MC40O2N1cnNvcjpkZWZhdWx0O31cCiAgICAgIC5sb2FkZWRUYWcsIC5sb2FkZWRDb21tZW50e2Rpc3BsYXk6bm9uZX0uZmJwaG90b3NwaG90b3RhZ2JveGVze3otaW5kZXg6OTk5N30uZmFuY3lib3gtbmF2e3dpZHRoOjEwJTt9LmlnVGFne3BhZGRpbmc6IDEuNWVtO30udGFnQXJyb3d7YmFja2dyb3VuZC1pbWFnZTogdXJsKGRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQmtBQUFCZ0NBTUFBQURmR2lsWUFBQUJRVkJNVkVVQUFBQlhWMWRYVjFkWFYxZFhWMWRrWkdSa1pHUUFBQUJYVjFkWFYxZmo0K05YVjFjQUFBQUFBQUJYVjFkWFYxY0FBQUJYVjFkWFYxY2RIUjFYVjFjaUlpTGk0dUpYVjFjbkp5Zmw1ZVZYVjFkWFYxZmYzOTlYVjFkWFYxZFhWMWRYVjFkWFYxZFhWMWNYRnhjQUFBQlhWMWRYVjFkWFYxY0FBQUEzTnpkWFYxZFhWMWRYVjFjQUFBQUFBQUJYVjFkWFYxZFhWMWRYVjFjQUFBRCsvdjc0K1BoWFYxZFhWMWYyOXZZZUhoNHRMUzBBQUFBeU1qSlhWMWY1K2ZsWFYxZjcrL3YvLy85WFYxZHRmcTl1Z0xDU244UE8wK05yZnFxOXhkcUttTC94OGZoMWg3Q09uTDV1Z0svTzFlS1RvY0drcjg3TzFPVE4wK0duc2M3TDBlSDQrUHVSbjhDcnQ4NXRnSy9jNE95b3M4K3F0YzF1Z2F5dHVOSHg4dm5YMitqeDh2aXF0ZEZ6aGJPdHQ5QnloTEhYM09pcXRkQzl4dHVLbDcvVDJlYlMyT2JTcEtJRkFBQUFRWFJTVGxNQUZDenJnV1pBZk5ObzVma3dMaVk4TW5MemhXQ0g0OW1KNXlwNjR4NUNEbzB5dzRNRzdYejdDbzBHMVQ1a1Ntd0NrLzFnL2Zjd09QZUZpV0tMWnZuMyt6MHFlUXNBQUFKN1NVUkJWSGhlbmRMWGN0c3dFQVhRSlNWYlZyZGtXNDU3cjNGTjdXVUJrdXJGdmFiMy9QOEhaQUdhdENJc1o2emNKMmlPTHJnWUFLQmNycmRiclhhOVhBWkFwQVg5UkFRZ2FhTk9XOGxaV2VkTVMxMUJtYWdPY0tnQWlZNlZOQUpwMERxUWhwSldJQzJBNjBDdWZWSExVQkJEYWFCT3VKdE9JNXdBL1FtT0F6azJwcjd5NFFvQmdwT2UzcHowa0U1NmVvaGFvaU5scFlhMWlwU3E4djViODh2WG9DRTlWUEdVdU9kU3lxWjdJeDFxcUZZSHdIT2N5cWVLSXc5ODhXcFlrUldzZVFBZEtXdjR3WEU2b1ZCSHl3LzF6WitPL0J6dVJ0RzdmYWZQTkoybS9PaUxQTkJ5b0Nhb0VqbXlHc3hXMVZJbElYWkl2RUNvcENva3lpVlZRcW5xaXBhTGMwZGUzSXE4eENQcEMxNDJqN0JMWE04TjVPVFhpWkk3Wm1BZ0NnWUhpVmhBSk9KQkVRK2FlTkJrQUVjYU9OTEFrUWFlQ0F5Q3U4WEtSVUF5Tmg2UEFOdTZIK2NCd0JxSzgyQXI0bUMycUZzbWpLYkYvQUtSM1FXV2dxZUNraTdZTWF0TDdDRUxkT2VCRU1Va2RDZXVhV3ZGV2hWck04RFFwQjNiRjd2QWtCMUxib29DbUVRQWN5SVBCbzBUUUg0UnpPUXM4aWtiK096bElEcjhibnhvZ3RjOERGbFBhRGdWL3FRczJKcTRSbkhXSkp0Z1lWNmtSdzJpbXl1a0JTV3Z5T3FtWkZHSXQ3clRjOXN3c3laV3JaVXRNRi9JcnRpUDJaTU1RRUZzUnJ6RXZKZ0RJZ01vaTNrZzRwNjFQVVZzVGJKWHNBZi9rZXpEaE1xT0FjdEwwNmlTWURwTDA0OTRnY3lyeDZZc0t4aEw0Yk5leVQ3UFFtWWtoYVVYcFI1NVdScFJqZFJJZG14aSt4OUpZR3FqUkpDQjRYdkRQWUp2TURXV29lVTY5QXErMi9EL2JRcE8wRWE4RUswYnNwTlEyV1k2MGFsTGlzdUo5TU1LL0dhSjVJL0x0NlFLUzI0b2JtU3BuK2tnQUo0Z0lpNzBrNzl2b2NCVXhtZmNoZ0FBQUFCSlJVNUVya0pnZ2c9PSk7YmFja2dyb3VuZC1zaXplOiBhdXRvO2JhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7ZGlzcGxheTogaW5saW5lLWJsb2NrO2hlaWdodDogMTFweDt3aWR0aDogMjBweDtiYWNrZ3JvdW5kLXBvc2l0aW9uOiAwIC0yNHB4O21hcmdpbi10b3A6M3B4O30udGFnSW5ke2JhY2tncm91bmQtcG9zaXRpb246IDAgLTgzcHg7ZmxvYXQ6cmlnaHQ7fS5kYXRlSW5ke2JhY2tncm91bmQtcG9zaXRpb246LTEycHggMXB4O3RleHQtaW5kZW50Oi0xMDAlO3RleHQtYWxpZ246cmlnaHQ7ZmxvYXQ6cmlnaHQ7fS5kYXRlSW5kIHNwYW57cGFkZGluZy1yaWdodDozcHg7dmlzaWJpbGl0eTpoaWRkZW47fS5kYXRlSW5kOmhvdmVyIHNwYW57dmlzaWJpbGl0eTp2aXNpYmxlO30udmlze3Zpc2liaWxpdHk6dmlzaWJsZSAhaW1wb3J0YW50O30uY29tbWVudEluZHtiYWNrZ3JvdW5kLWltYWdlOiB1cmwoZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFBMEFBQUFOQ0FZQUFBQnk2K1I4QUFBQUFYTlNSMElBcnM0YzZRQUFBQVJuUVUxQkFBQ3hqd3Y4WVFVQUFBQUpjRWhaY3dBQURzTUFBQTdEQWNkdnFHUUFBQUFhZEVWWWRGTnZablIzWVhKbEFGQmhhVzUwTGs1RlZDQjJNeTQxTGpFd01QUnlvUUFBQUdKSlJFRlVLRk5qZ0lHSmk0Nys5MDVmUUJDRDFFRzFNRENBQklnQklIVlFMU1JxbXJQMnduOFFIbzZhZXVZZEF3dWdZeGlBOGNGQkR0TUUwNGlPWVJwQk5EU2dHVkEwWWNNd2pTaWFZQUJaSVZRSUJXUTNic1N0Q2NvbERoQ3ZnWUVCQURkMW9ONlp2TGJQQUFBQUFFbEZUa1N1UW1DQyk7YmFja2dyb3VuZC1wb3NpdGlvbjowIDA7ZmxvYXQ6cmlnaHQ7Y3Vyc29yOnBvaW50ZXI7fWJsb2NrcXVvdGUge3BhZGRpbmc6IDAgMCAwIDE1cHg7bWFyZ2luOiAwIDAgMjBweDtib3JkZXItbGVmdDogNXB4IHNvbGlkICNlZWVlZWU7fWJsb2NrcXVvdGUgcCB7bWFyZ2luLWJvdHRvbTogMDtsaW5lLWhlaWdodDogMS4yNTt9YmxvY2txdW90ZSBzbWFsbCB7ZGlzcGxheTogYmxvY2s7bGluZS1oZWlnaHQ6IDIwcHg7Y29sb3I6ICM5OTk5OTk7Zm9udC1zaXplOiA4NSU7fWJsb2NrcXVvdGUgc21hbGw6YmVmb3JlIHtjb250ZW50OiAi4oCUICI7fVwKICAgICAgLyogLmJvcmRlclRhZ0JveCAmIC5pbm5lclRhZ0JveCAqL1wKICAgICAgLmZiUGhvdG9zUGhvdG9UYWdib3hlc3toZWlnaHQ6MTAwJTtsZWZ0OjA7cG9zaXRpb246YWJzb2x1dGU7dG9wOjA7d2lkdGg6MTAwJTsvKnBvaW50ZXItZXZlbnRzOm5vbmUqL30uZmJQaG90b3NQaG90b1RhZ2JveGVzIC50YWdzV3JhcHBlcntkaXNwbGF5OmlubGluZS1ibG9jaztoZWlnaHQ6MTAwJTt3aWR0aDoxMDAlO3Bvc2l0aW9uOnJlbGF0aXZlO3ZlcnRpY2FsLWFsaWduOm1pZGRsZX0uZmJQaG90b3NQaG90b1RhZ2JveEJhc2V7bGluZS1oZWlnaHQ6bm9ybWFsO3Bvc2l0aW9uOmFic29sdXRlfS5pbWFnZUxvYWRpbmcgLmZiUGhvdG9zUGhvdG9UYWdib3hCYXNle2Rpc3BsYXk6bm9uZX0vKi5mYlBob3Rvc1Bob3RvVGFnYm94QmFzZSAuYm9yZGVyVGFnQm94LCAuZmJQaG90b3NQaG90b1RhZ2JveEJhc2UgLmlubmVyVGFnQm94ey13ZWJraXQtYm94LXNpemluZzpib3JkZXItYm94O2hlaWdodDoxMDAlO3dpZHRoOjEwMCV9LmllQ29udGVudEZpeHtkaXNwbGF5Om5vbmU7Zm9udC1zaXplOjIwMHB4O2hlaWdodDoxMDAlO292ZXJmbG93OmhpZGRlbjt3aWR0aDoxMDAlfS5mYlBob3Rvc1Bob3RvVGFnYm94QmFzZSAuaW5uZXJUYWdCb3h7Ym9yZGVyOjRweCBzb2xpZCAjZmZmO2JvcmRlci1jb2xvcjpyZ2JhKDI1NSwgMjU1LCAyNTUsIC44KX0qLy5mYlBob3Rvc1Bob3RvVGFnYm94QmFzZSAudGFne2JvdHRvbTowO2xlZnQ6NTAlO3Bvc2l0aW9uOmFic29sdXRlfS5mYlBob3Rvc1Bob3RvVGFnYm94QmFzZSAudGFnUG9pbnRlcntsZWZ0Oi01MCU7cG9zaXRpb246cmVsYXRpdmV9LmZiUGhvdG9zUGhvdG9UYWdib3hCYXNlIC50YWdBcnJvd3tsZWZ0OjUwJTttYXJnaW4tbGVmdDotMTBweDtwb3NpdGlvbjphYnNvbHV0ZTt0b3A6LTEwcHh9LmZiUGhvdG9zUGhvdG9UYWdib3hCYXNlIC50YWdOYW1le2JhY2tncm91bmQ6I2ZmZjtjb2xvcjojNDA0MDQwO2N1cnNvcjpkZWZhdWx0O2ZvbnQtd2VpZ2h0Om5vcm1hbDtwYWRkaW5nOjJweCA2cHggM3B4O3RvcDozcHg7d2hpdGUtc3BhY2U6bm93cmFwfS5mYW5jeWJveC1pbm5lcjpob3ZlciAuZmJQaG90b3NQaG90b1RhZ2JveGVze29wYWNpdHk6MTt6LWluZGV4Ojk5OTg7fS5mYlBob3Rvc1Bob3RvVGFnYm94ZXMgLnRhZ0JveCAudGFne3RvcDo4NSU7ei1pbmRleDo5OTk5fS5mYlBob3Rvc1Bob3RvVGFnYm94ZXMgLnRhZywgLmZiUGhvdG9zUGhvdG9UYWdib3hlcyAuaW5uZXJUYWdCb3gsIC5mYlBob3Rvc1Bob3RvVGFnYm94ZXMgLmJvcmRlclRhZ0JveHt2aXNpYmlsaXR5OmhpZGRlbn0udGFnQm94OmhvdmVyIC50YWcvKiwgLnRhZ0JveDpob3ZlciAuaW5uZXJUYWdCb3gqL3tvcGFjaXR5OjE7Lyotd2Via2l0LXRyYW5zaXRpb246b3BhY2l0eSAuMnMgbGluZWFyOyovdmlzaWJpbGl0eTp2aXNpYmxlfTwvc3R5bGU+JzsKICAgIHRIVE1MPXRIVE1MKyc8aGVhZGVyIGlkPSJoZCI+PGRpdiBjbGFzcz0ibG9nbyIgaWQ9ImxvZ28iPjxkaXYgY2xhc3M9IndyYXBwZXIiPjxoMT48YSBpZD0iYU5hbWUiIGhyZWY9JytjLmFMaW5rKyc+JytjLmFOYW1lKyc8L2E+ICcrKChjLmFBdXRoKT8nLSAnK2MuYUF1dGg6IiIpKycgPGJ1dHRvbiBvbkNsaWNrPSJjbGVhbnVwKCkiPlJlU3R5bGU8L2J1dHRvbj48L2gxPjxoMT5QcmVzcyBDdHJsK1MgLyBbTWFjXUNvbW1hbmQrUyAod2l0aCBDb21wbGV0ZSBvcHRpb24pIHRvIHNhdmUgYWxsIHBob3Rvcy4gW1Bob3RvcyBhcmUgbG9jYXRlZCBpbiBfZmlsZXMgZm9sZGVyXTwvaDE+PC9kaXY+PC9kaXY+PC9oZWFkZXI+JzsKICAgIHRIVE1MPXRIVE1MKyc8Y2VudGVyIGlkPSJhVGltZSI+JytjLmFUaW1lKyc8L2NlbnRlcj48YnI+PGNlbnRlciBpZD0iYURlcyI+JytjLmFEZXMrJzwvY2VudGVyPjxjZW50ZXI+RG93bmxvYWQgYXQ6ICcrYy5kVGltZSsnPC9jZW50ZXI+PGJyPjxkaXYgaWQ9Im91dHB1dCIgY2xhc3M9ImNOYW1lIj48L2Rpdj48ZGl2IGNsYXNzPSJ3cmFwcGVyIj48ZGl2IGlkPSJiZCI+PGRpdiBpZD0iY29udGFpbmVyIiBjbGFzcz0ibWFzb25yeSI+JzsKICAgIHRIVE1MPXRIVE1MK2Iuam9pbigiIikrJzwvZGl2PjwvZGl2PjwvZGl2PjxzY3JpcHQgc3JjPSJodHRwczovL3Jhd2dpdC5jb20vaW5EcmVhbS9Eb3duQWxidW0vbWFzdGVyL2Fzc2V0cy9qcXVlcnkubWluLmpzIj48L3NjcmlwdD48L2JvZHk+PC9odG1sPic7CiAgICB2YXIgZmlsZSA9IG5ldyBGaWxlKFt0SFRNTF0sICdwaG90b3MuaHRtbCcsIHt0eXBlOiAndGV4dC9odG1sO2NoYXJzZXQ9dXRmLTgnfSk7CiAgICB3aW5kb3cub3Blbih3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChmaWxlKSwgJ19ibGFuaycpOwogICAgYnJlYWs7CiAgICB9Cn07CgppZiAodW5zYWZlV2luZG93ICE9PSB1bmRlZmluZWQpIHsKICBjb25zb2xlID0gdW5zYWZlV2luZG93LmNvbnNvbGU7CiAgdHJ5IHsKICAgIHZhciBleHBHID0gZXhwb3J0RnVuY3Rpb24oZywgdW5zYWZlV2luZG93LCB7ZGVmaW5lQXM6ICJnIn0pOwogICAgdW5zYWZlV2luZG93LmcgPSBleHBHOwogICAgdmFyIGV4cENvcmUgPSBleHBvcnRGdW5jdGlvbihkRkFjb3JlLCB1bnNhZmVXaW5kb3csIHtkZWZpbmVBczogImRGQWNvcmUifSk7CiAgICB1bnNhZmVXaW5kb3cuZEZBY29yZSA9IGV4cENvcmU7CiAgfSBjYXRjaCAoZSkgewogICAgdW5zYWZlV2luZG93LmRGQWNvcmUgPSBkRkFjb3JlOwogICAgdW5zYWZlV2luZG93LmcgPSBnOwogIH0KICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIiwgZEZBaW5pdCwgZmFsc2UpOwogIHNldFRpbWVvdXQoZEZBaW5pdCwgMjAwMCk7Cn0gZWxzZSB7CiAgYWxlcnQoIkNhbm5vdCBpbml0IHNjcmlwdC4gUGxlYXNlIHRyeSBHcmVhc2Vtb25rZXkvU2NyaXB0aXNoLiIpOwp9Cg=="},{"name":"惠惠购物助手","options":{"check_for_updates":true,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_arrayleft":false,"compat_uW_gmonkey":false,"compat_forvarin":false,"noframes":null,"awareOfChrome":false,"run_at":null,"override":{"use_includes":[],"orig_includes":["http://*.jd.com/*","http://*.taobao.com/*","http://*.tmall.com/*","https://*.jd.com/*","https://*.taobao.com/*","https://*.tmall.com/*","https://*.amazon.com/*","http://*.001town.com/*","http://*.01goo.com/*","http://*.03l.cn/*","http://*.133china.com/*","http://*.139shop.com/*","http://yxp.163.com/*","http://*.168dg.com/*","http://*.186mall.com/*","http://*.18to82.com/*","http://*.1j.cn/*","http://*.22shop.com/*","http://*.24dq.com/*","http://*.24quan.com/*","http://*.258sd.com/*","http://*.2688.com/*","http://*.360buy.com/*","http://*.360hqb.com/*","http://*.360kxr.com/*","http://*.360mart.com/*","http://*.365goba.com/*","http://*.38hzt.com/*","http://*.39ty.com/*","http://*.4inlook.com/*","http://*.5188bag.com/*","http://*.51buy.com/*","http://51buy.com/","http://*.51dg.com/*","http://*.51eng.com/*","http://*.51sheyuan.com/*","http://*.51youpin.com/*","http://*.520eye.com/*","http://*.52shehua.com/*","http://*.5366.com/*","http://t.58.com/*","http://*.58hua.com/*","http://*.5lux.com/*","http://*.5yth.com/*","http://*.6919.com/*","http://*.6sbuy.com/*","http://*.77toy.com/*","http://*.7caihua.com/*","http://*.7cv.com/*","http://*.7sev.com/*","http://*.80ebus.com/*","http://*.8801.net/*","http://*.919it.com/*","http://*.929.cn/*","http://*.942radio.com/*","http://b2c.958shop.com/*","http://*.96128.com/*","http://*.99pto.com/*","http://*.99read.com/*","http://*.9dadao.com/*","http://*.9you.com/*","http://*.afffff.com/*","http://*.ai356.com/*","http://*.aibang.com/*","http://*.aidai.com/*","http://*.aiju.com/*","http://*.aim36.com/*","http://*.aimer.com.cn/*","http://*.aiyingshi.com/*","http://*.aizhigu.com.cn/*","http://*.amazon.cn/*","http://*.anni.com/*","http://*.apabi.com/*","http://*.augshow.com/*","http://*.autosup.com/*","http://*.baiyjk.com/*","http://*.bbesports.com/*","http://*.bookuu.com/*","http://*.bearbuy.com.cn/*","http://*.beautyplus.cn/*","http://*.beifabook.com/*","http://*.benq.com.cn/*","http://*.best1.com/*","http://*.biaoshang.hk/*","http://*.binggo.com/*","http://*.bloves.com/*","http://*.bobomobi.com/*","http://*.bookschina.com/*","http://*.boqii.com/*","http://*.buding.com/*","http://*.buy007.com/*","http://*.buy361.cn/*","http://*.buyfine.net/*","http://*.buynow.com.cn/*","http://*.caistv.com/*","http://*.caomeipai.com/*","http://*.car339.com.cn/*","http://*.car6688.com/*","http://*.carrefour.com.cn/*","http://*.cdream.com/*","http://*.ceetop.com/*","http://*.chashu.cn/*","http://*.chedangjia.com/*","http://*.chengdecs.com/*","http://*.china-gift.com/*","http://*.china-pub.com/*","http://emall.chinapay.com/*","http://*.chinayrs.com/*","http://*.chris-tina.com/*","http://*.clady.com/*","http://*.clinique.com.cn/*","http://*.cncard.com/*","http://*.cnfse.com/*","http://*.colebuy.com/*","http://*.conslive.com/*","http://*.coo8.com/*","http://*.cosize.com/*","http://*.cosme-de.com/*","http://*.ctrip.com/*","http://*.cw100.com/*","http://*.d1.com.cn/*","http://*.daisonghua.com/*","http://*.dangdang.com/*","http://*.daoyao.com/*","http://*.woyo.com/*","http://*.dazhe.cn/*","http://*.dazhongdianqi.com.cn/*","http://*.dianpu.com/*","http://*.didatuan.com/*","http://*.disiqu.cn/*","http://*.dixintong.com/*","http://*.doulaimai.com/*","http://*.dsgoo.com/*","http://*.dtoto.com/*","http://*.duhub.com/*","http://*.duoding.com/*","http://*.e-giordano.com/*","http://*.e-lining.com/*","http://*.e-my.com.cn/*","http://*.easy361.com/*","http://*.ebaimi.com/*","http://*.eboxbuy.com/*","http://*.ebtea.com/*","http://*.ecosme.cn/*","http://*.efeihu.com/*","http://*.ehaier.com/*","http://*.ejia.com/*","http://*.enet.com.cn/*","http://*.enjoyeye.com/*","http://*.epetbar.com/*","http://*.et5155.com/*","http://*.f508.com/*","http://*.fclub.cn/*","http://*.flowerby.com/*","http://*.flowercn.com/*","http://*.gap.cn/*","http://*.godida.com/*","http://*.gome.com.cn/*","http://*.goocctv.cn/*","http://*.goodjd.com/*","http://*.goodnourish.cn/*","http://*.gou3618.com/*","http://*.gouduo.com/*","http://*.gouwulian.com/*","http://*.gouxie.com/*","http://*.goyahome.com/*","http://*.guobuy.com/*","http://*.guopi.com/*","http://*.guuoo.com/*","http://*.hany.cn/*","http://*.happigo.com/*","http://*.hit168.com.cn/*","http://*.hitao.com/*","http://*.homeold.cn/*","http://*.homevv.com/*","http://*.hongkouzi.com/*","http://*.hopebook.net/*","http://*.huachu.com.cn/*","http://*.huimeifang.cn/*","http://*.hw2008.cn/*","http://*.icaifeng.com/*","http://*.icson.com/*","http://*.ideemall.com/*","http://*.ihush.com/*","http://*.iloveyou.com.cn/*","http://*.ilovezuan.com/*","http://*.imeelee.com/*","http://*.inoble.com.cn/*","http://*.inshion.com/*","http://*.ishop.cn/*","http://*.it88.com.cn/*","http://*.itzm.com/*","http://*.iyuyou.com/*","http://*.jiajiajk.com/*","http://*.jiaju.com/*","http://*.jiatx.com/*","http://*.jiayougo.com/*","http://*.jinbaidu.com/*","http://*.jmeishop.com/*","http://*.joyran.com/*","http://*.jsbcmall.com/*","http://*.jtlhome.com/*","http://*.jumei.com/*","http://*.junph.com/*","http://*.justonline.cn/*","http://*.jxdyf.com/*","http://*.k121.com/*","http://*.kadang.com/*","http://*.keede.com.cn/*","http://*.kela.cn/*","http://*.kuaishubao.com/*","http://*.kxtkx.com/*","http://*.ladypk.com/*","http://*.laeibelle.com/*","http://*.lafaso.com/*","http://*.lamiu.com/*","http://*.lancome.com.cn/*","http://*.lashou.com/*","http://*.ledaojia.com/*","http://*.leftlady.com/*","http://*.lenovo.com.cn/*","http://*.lens2005.com/*","http://*.letao.com/*","http://*.leyou.com/*","http://*.leyou.com.cn/*","http://*.lijiababy.com.cn/*","http://*.lijigou.com/*","http://*.likebuy.com/*","http://*.likeface.com/*","http://*.lingshi.com/*","http://*.liqunshop.com/*","http://*.liyi99.com/*","http://*.locknlock.com.cn/*","http://*.lovo.cn/*","http://*.luckigo.com/*","http://*.lusen.com/*","http://*.lyceem.com/*","http://*.m18.com/*","http://*.maichawang.com/*","http://*.maimaike.cn/*","http://*.mamabb.com/*","http://*.mamahao.cn/*","http://*.mangocity.com/*","http://*.manzuo.com/*","http://*.masamaso.com/*","http://*.maxfunbuy.com/*","http://*.maywon.com/*","http://*.mbaobao.com/*","http://*.meici.com/*","http://*.meilele.com/*","http://*.meilieasy.com/*","http://*.meituan.com/*","http://*.menglu.com/*","http://*.mengmai.com/*","http://*.minibuy.com/*","http://*.mmgw.cn/*","http://*.mmuses.com/*","http://*.mobi001.com/*","http://*.mokamall.com/*","http://*.momoyoyo.com/*","http://*.montrosechina.com/*","http://*.mooiee.com/*","http://*.moonbasa.com/*","http://*.motostore.com.cn/*","http://*.mpshow.com.cn/*","http://*.naccoo.com/*","http://*.naguu.com/*","http://*.nayao.com/*","http://*.newegg.com.cn/*","http://*.newgo5.com/*","http://*.nmlch.com/*","http://*.no5.com.cn/*","http://*.nokia.com.cn/*","http://*.nonmin88.com/*","http://*.obuy.cn/*","http://*.ofcard.com/*","http://*.ogage.cn/*","http://*.okbig.com/*","http://*.okbuy.com/*","http://*.okddy.com/*","http://*.okgolf.cn/*","http://*.olomo.com/*","http://*.olympus.com.cn/*","http://*.olymsports.com/*","http://*.ono.com.cn/*","http://*.orange3c.com/*","http://*.ouku.com/*","http://*.ourtasty.com/*","http://*.outice.com/*","http://*.oyego.com/*","http://*.paixie.net/*","http://*.palcent.com/*","http://*.ocj.com.cn/*","http://*.pb89.com/*","http://*.pcarm.com/*","http://*.petyoo.com/*","http://*.pgbao.com/*","http://*.piaoliang100.com/*","http://*.pirateship.com.cn/*","http://*.popyj.com/*","http://*.pupai.cn/*","http://*.purcotton.com/*","http://*.qianxun.com/*","http://*.qingci.com/*","http://*.qinqinbaby.com/*","http://*.qmango.com/*","http://*.qumei.com/*","http://*.quwan.com/*","http://*.qxian.com/*","http://*.rayi.cn/*","http://*.redbaby.com.cn/*","http://*.robam.com/*","http://*.salala.com.cn/*","http://*.samsclub.cn/*","http://*.sanfo.com/*","http://*.sapo.com.hk/*","http://*.sasa.com/*","http://*.sasacity.com/*","http://*.sawbuy.com/*","http://*.shanghai-sports.com/*","http://*.shentop.com/*","http://*.shishangqiyi.com/*","http://*.shjdq.com/*","http://*.shnn.com/*","http://*.shopin.net/*","http://*.shoubiao.com.cn/*","http://*.sigo.cn/*","http://mall.sina.com.cn/*","http://*.sinobuy.cn/*","http://*.skcoo.com/*","http://*.skomart.com/*","http://*.snyun.com/*","http://*.sonmai.cn/*","http://*.sport2008.com.cn/*","http://*.strawberrynet.com/*","http://*.suning.com/*","http://*.sz-esun.com/*","http://*.tao3c.com/*","http://*.taoxie.cn/*","http://*.the365.com/*","http://*.thinkshop.cn/*","http://*.tian10.com/*","http://*.tiantian.com/*","http://*.junph.com/*","http://*.tieyou.com/*","http://*.togj.com/*","http://*.tooogooo.com/*","http://*.toy90.com/*","http://*.toys365.com/*","http://*.tpy100.com/*","http://*.tuniu.com/*","http://*.tztart.com/*","http://*.ugou.cn/*","http://*.uipmall.com/*","http://*.uiyi.cn/*","http://*.ushan.cn/*","http://*.uushouji.com/*","http://*.uya100.com/*","http://*.vaakav.com/*","http://*.vafox.com/*","http://*.vancl.com/*","http://*.vcotton.com/*","http://*.veedl.com/*","http://*.vegoos.com/*","http://*.venusveil.com/*","http://*.veryok.cn/*","http://*.viccol.com/*","http://*.vipshop.com/*","http://*.vipstore.com/*","http://*.vivian.cn/*","http://*.vjia.com/*","http://*.vnasi.com/*","http://*.voipyeah.com/*","http://*.w1.cn/*","http://*.waipowang.com/*","http://*.wangshanghai.com/*","http://*.wg365.com/*","http://*.winenice.com/*","http://*.wl.cn/*","http://*.womai.com/*","http://*.woye.com/*","http://*.wtaotao.com/*","http://*.wumeiwang.com/*","http://*.x-playboy.com/*","http://*.xiaokang.com/*","http://*.xiaozhuren.com/*","http://*.xinbaigo.com/*","http://*.xindou.com/*","http://*.xing800.com/*","http://*.xinhuabookstore.com/*","http://*.xiu.com/*","http://*.xtpo.cn/*","http://*.xzuan.com/*","http://*.yaja.com.cn/*","http://*.yaofang.cn/*","http://*.yasai.cn/*","http://*.yeecare.com/*","http://buy.yesky.com/*","http://*.yesmytea.com/*","http://*.yesmywine.com/*","http://*.yide.com/*","http://*.yifu.com/*","http://*.yihaodian.com/*","http://*.yintai.com/*","http://*.yinyuehe.net/*","http://*.yjcs.cn/*","http://*.yobrand.com/*","http://*.yoger.com.cn/*","http://*.yoho.cn/*","http://*.yongle.com.cn/*","http://*.yougou.com/*","http://*.youjk.com/*","http://*.yoyo18.com/*","http://*.yumaoclub.com/*","http://*.yyosso.com/*","http://*.zbird.com/*","http://*.zgcbb.com/*","http://*.zm7.cn/*","http://*.zopo.com/*","http://*.ibuying.com/*","http://*.33go.com.cn/*","http://*.xijie.com/*","http://*.nop.cn/*","http://*.asyp.com/*","http://*.sparty.cn/*","http://*.yizhedian.com/*","http://*.lvhezi.com/*","http://*.aishangbaobao.com/*","http://*.sportica.cn/*","http://*.jstsilk.cn/*","http://*.camel.com.cn/*","http://*.cottonpop.net/*","http://*.hyj.com/*","http://*.myxiequ.com/*","http://*.mfplaza.com/*","http://*.do93.com/*","http://*.3guo.cn/*","http://*.yaqifushi.com/*","http://*.trura.com/*","http://*.lbaobao.cn/*","http://*.xiutuan.com/*","http://*.usashopcn.com/*","http://*.ihaveu.com/*","http://*.vipku.com/*","http://*.vipchina.com/*","http://*.fanrry.cn/*","http://*.lesunvip.com/*","http://*.nala.com.cn/*","http://*.miqi.cn/*","http://*.meiribuy.com/*","http://*.pufung.com/*","http://*.xiaoye.com/*","http://*.hmeili.com/*","http://*.oulybuy.com/*","http://*.meifenzi.com/*","http://*.caomeishop.com/*","http://*.meifu360.com/*","http://*.bapashop.com/*","http://*.bulangxiongdi.com/*","http://*.gusubuy.com/*","http://*.opearl.net/*","http://*.ruci.cn/*","http://*.rax.cn/*","http://*.jiuxian.com/*","http://*.maimaicha.com/*","http://*.pinwine.cn/*","http://*.meiweidao.com/*","http://*.okliang.com/*","http://*.365wine.com/*","http://*.jjlg.com.cn/*","http://*.bianlishe.com/*","http://*.epkmall.com/*","http://*.gdcct.com/*","http://*.500ccc.com/*","http://*.me361.com/*","http://*.malatamobile.com/*","http://*.trioo.com/*","http://*.oohdear.com/*","http://*.yaahe.cn/*","http://*.easeeyes.com/*","http://*.dbox.cn/*","http://*.haotehui.com/*","http://*.m6go.com/*","http://*.bianyigo.com/*","http://*.okjee.com/*","http://*.mygeek.cn/*","http://*.tbb.cn/*","http://*.ushare360.com/*","http://*.gqt168.com/*","http://*.konjoy.com/*","http://*.aoliz.com/*","http://*.jianianle.com/*","http://*.akajia.com/*","http://*.miqi.com.cn/*","http://*.lehuimai.com/*","http://*.lifevc.com/*","http://*www.ouku.com/","http://nuomi.com/*"],"merge_includes":true,"use_matches":[],"orig_matches":[],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null,"orig_connects":[]}},"storage":{"ts":1521543498798,"data":{}},"enabled":true,"position":7,"file_url":"https://greasyfork.org/scripts/26606-%E6%83%A0%E6%83%A0%E8%B4%AD%E7%89%A9%E5%8A%A9%E6%89%8B/code/%E6%83%A0%E6%83%A0%E8%B4%AD%E7%89%A9%E5%8A%A9%E6%89%8B.user.js","uuid":"86a5aa69-146e-4684-b4cb-6f6df06de1ec","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgIOaDoOaDoOi0reeJqeWKqeaJiwovLyBAbmFtZXNwYWNlICAgbGh5ZG1yCi8vIEBkZXNjcmlwdGlvbiDlnKjmgqjnvZHotK3mtY/op4jllYblk4HnmoTlkIzml7bvvIzoh6rliqjlr7nmr5Tlhbbku5bkvJjotKjnlLXllYblkIzmrL7llYblk4Hku7fmoLzvvIzlubbmj5DkvpvllYblk4Hku7fmoLzljoblj7LvvIzluK7mgqjovbvmnb7mioTlupXvvIzogarmmI7nvZHotK3kuI3lkIPkuo/vvIEKLy8gQGF1dGhvciAgICAgIOi9ruWbnuecvOeahOm4o+S6ugovLyBAdmVyc2lvbiAgICAgMi40Ci8vIEBncmFudCAgICAgICBub25lCi8vIEBpY29uICAgICAgICBodHRwOi8vYi5oaXBob3Rvcy5iYWlkdS5jb20vaW1hZ2UvcGljL2l0ZW0vNmQ4MTgwMGExOWQ4YmMzZTg4YTY1ODg5OGI4YmE2MWVhOWQzNDVjMi5qcGcKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmpkLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi50YW9iYW8uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnRtYWxsLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwczovLyouamQuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHBzOi8vKi50YW9iYW8uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHBzOi8vKi50bWFsbC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cHM6Ly8qLmFtYXpvbi5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouMDAxdG93bi5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouMDFnb28uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjAzbC5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi4xMzNjaGluYS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouMTM5c2hvcC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovL3l4cC4xNjMuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjE2OGRnLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi4xODZtYWxsLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi4xOHRvODIuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjFqLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjIyc2hvcC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouMjRkcS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouMjRxdWFuLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi4yNThzZC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouMjY4OC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouMzYwYnV5LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi4zNjBocWIuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjM2MGt4ci5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouMzYwbWFydC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouMzY1Z29iYS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouMzhoenQuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjM5dHkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjRpbmxvb2suY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjUxODhiYWcuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjUxYnV5LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vNTFidXkuY29tLwovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouNTFkZy5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouNTFlbmcuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjUxc2hleXVhbi5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouNTF5b3VwaW4uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjUyMGV5ZS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouNTJzaGVodWEuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjUzNjYuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly90LjU4LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi41OGh1YS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouNWx1eC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouNXl0aC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouNjkxOS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouNnNidXkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjc3dG95LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi43Y2FpaHVhLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi43Y3YuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjdzZXYuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjgwZWJ1cy5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouODgwMS5uZXQvKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouOTE5aXQuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjkyOS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi45NDJyYWRpby5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovL2IyYy45NThzaG9wLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi45NjEyOC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouOTlwdG8uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjk5cmVhZC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouOWRhZGFvLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi45eW91LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5hZmZmZmYuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmFpMzU2LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5haWJhbmcuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmFpZGFpLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5haWp1LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5haW0zNi5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouYWltZXIuY29tLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmFpeWluZ3NoaS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouYWl6aGlndS5jb20uY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouYW1hem9uLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmFubmkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmFwYWJpLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5hdWdzaG93LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5hdXRvc3VwLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5iYWl5amsuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmJiZXNwb3J0cy5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouYm9va3V1LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5iZWFyYnV5LmNvbS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5iZWF1dHlwbHVzLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmJlaWZhYm9vay5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouYmVucS5jb20uY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouYmVzdDEuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmJpYW9zaGFuZy5oay8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5iaW5nZ28uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmJsb3Zlcy5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouYm9ib21vYmkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmJvb2tzY2hpbmEuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmJvcWlpLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5idWRpbmcuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmJ1eTAwNy5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouYnV5MzYxLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmJ1eWZpbmUubmV0LyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmJ1eW5vdy5jb20uY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouY2Fpc3R2LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5jYW9tZWlwYWkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmNhcjMzOS5jb20uY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouY2FyNjY4OC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouY2FycmVmb3VyLmNvbS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5jZHJlYW0uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmNlZXRvcC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouY2hhc2h1LmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmNoZWRhbmdqaWEuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmNoZW5nZGVjcy5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouY2hpbmEtZ2lmdC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouY2hpbmEtcHViLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vZW1hbGwuY2hpbmFwYXkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmNoaW5heXJzLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5jaHJpcy10aW5hLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5jbGFkeS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouY2xpbmlxdWUuY29tLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmNuY2FyZC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouY25mc2UuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmNvbGVidXkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmNvbnNsaXZlLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5jb284LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5jb3NpemUuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmNvc21lLWRlLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5jdHJpcC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouY3cxMDAuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmQxLmNvbS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5kYWlzb25naHVhLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5kYW5nZGFuZy5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouZGFveWFvLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi53b3lvLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5kYXpoZS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5kYXpob25nZGlhbnFpLmNvbS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5kaWFucHUuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmRpZGF0dWFuLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5kaXNpcXUuY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouZGl4aW50b25nLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5kb3VsYWltYWkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmRzZ29vLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5kdG90by5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouZHVodWIuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmR1b2RpbmcuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmUtZ2lvcmRhbm8uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmUtbGluaW5nLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5lLW15LmNvbS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5lYXN5MzYxLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5lYmFpbWkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmVib3hidXkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmVidGVhLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5lY29zbWUuY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouZWZlaWh1LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5laGFpZXIuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmVqaWEuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmVuZXQuY29tLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmVuam95ZXllLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5lcGV0YmFyLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5ldDUxNTUuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmY1MDguY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmZjbHViLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmZsb3dlcmJ5LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5mbG93ZXJjbi5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouZ2FwLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmdvZGlkYS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouZ29tZS5jb20uY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouZ29vY2N0di5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5nb29kamQuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmdvb2Rub3VyaXNoLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmdvdTM2MTguY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmdvdWR1by5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouZ291d3VsaWFuLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5nb3V4aWUuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmdveWFob21lLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5ndW9idXkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmd1b3BpLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5ndXVvby5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouaGFueS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5oYXBwaWdvLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5oaXQxNjguY29tLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmhpdGFvLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5ob21lb2xkLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmhvbWV2di5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouaG9uZ2tvdXppLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5ob3BlYm9vay5uZXQvKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouaHVhY2h1LmNvbS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5odWltZWlmYW5nLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmh3MjAwOC5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5pY2FpZmVuZy5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouaWNzb24uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmlkZWVtYWxsLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5paHVzaC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouaWxvdmV5b3UuY29tLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmlsb3ZlenVhbi5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouaW1lZWxlZS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouaW5vYmxlLmNvbS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5pbnNoaW9uLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5pc2hvcC5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5pdDg4LmNvbS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5pdHptLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5peXV5b3UuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmppYWppYWprLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5qaWFqdS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouamlhdHguY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmppYXlvdWdvLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5qaW5iYWlkdS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouam1laXNob3AuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmpveXJhbi5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouanNiY21hbGwuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmp0bGhvbWUuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmp1bWVpLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5qdW5waC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouanVzdG9ubGluZS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5qeGR5Zi5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouazEyMS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoua2FkYW5nLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5rZWVkZS5jb20uY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoua2VsYS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5rdWFpc2h1YmFvLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5reHRreC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubGFkeXBrLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5sYWVpYmVsbGUuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmxhZmFzby5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubGFtaXUuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmxhbmNvbWUuY29tLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmxhc2hvdS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubGVkYW9qaWEuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmxlZnRsYWR5LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5sZW5vdm8uY29tLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmxlbnMyMDA1LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5sZXRhby5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubGV5b3UuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmxleW91LmNvbS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5saWppYWJhYnkuY29tLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmxpamlnb3UuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmxpa2VidXkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmxpa2VmYWNlLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5saW5nc2hpLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5saXF1bnNob3AuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmxpeWk5OS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubG9ja25sb2NrLmNvbS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5sb3ZvLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmx1Y2tpZ28uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmx1c2VuLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5seWNlZW0uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm0xOC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubWFpY2hhd2FuZy5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubWFpbWFpa2UuY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubWFtYWJiLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5tYW1haGFvLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm1hbmdvY2l0eS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubWFuenVvLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5tYXNhbWFzby5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubWF4ZnVuYnV5LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5tYXl3b24uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm1iYW9iYW8uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm1laWNpLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5tZWlsZWxlLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5tZWlsaWVhc3kuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm1laXR1YW4uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm1lbmdsdS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubWVuZ21haS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubWluaWJ1eS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubW1ndy5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5tbXVzZXMuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm1vYmkwMDEuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm1va2FtYWxsLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5tb21veW95by5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubW9udHJvc2VjaGluYS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubW9vaWVlLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5tb29uYmFzYS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubW90b3N0b3JlLmNvbS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5tcHNob3cuY29tLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm5hY2Nvby5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubmFndXUuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm5heWFvLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5uZXdlZ2cuY29tLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm5ld2dvNS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubm1sY2guY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm5vNS5jb20uY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubm9raWEuY29tLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm5vbm1pbjg4LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5vYnV5LmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm9mY2FyZC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoub2dhZ2UuY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoub2tiaWcuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm9rYnV5LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5va2RkeS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoub2tnb2xmLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm9sb21vLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5vbHltcHVzLmNvbS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5vbHltc3BvcnRzLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5vbm8uY29tLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm9yYW5nZTNjLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5vdWt1LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5vdXJ0YXN0eS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoub3V0aWNlLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5veWVnby5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoucGFpeGllLm5ldC8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5wYWxjZW50LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5vY2ouY29tLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnBiODkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnBjYXJtLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5wZXR5b28uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnBnYmFvLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5waWFvbGlhbmcxMDAuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnBpcmF0ZXNoaXAuY29tLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnBvcHlqLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5wdXBhaS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5wdXJjb3R0b24uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnFpYW54dW4uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnFpbmdjaS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoucWlucWluYmFieS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoucW1hbmdvLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5xdW1laS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoucXV3YW4uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnF4aWFuLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5yYXlpLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnJlZGJhYnkuY29tLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnJvYmFtLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5zYWxhbGEuY29tLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnNhbXNjbHViLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnNhbmZvLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5zYXBvLmNvbS5oay8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5zYXNhLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5zYXNhY2l0eS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouc2F3YnV5LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5zaGFuZ2hhaS1zcG9ydHMuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnNoZW50b3AuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnNoaXNoYW5ncWl5aS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouc2hqZHEuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnNobm4uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnNob3Bpbi5uZXQvKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouc2hvdWJpYW8uY29tLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnNpZ28uY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovL21hbGwuc2luYS5jb20uY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouc2lub2J1eS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5za2Nvby5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouc2tvbWFydC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouc255dW4uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnNvbm1haS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5zcG9ydDIwMDguY29tLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnN0cmF3YmVycnluZXQuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnN1bmluZy5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouc3otZXN1bi5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoudGFvM2MuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnRhb3hpZS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi50aGUzNjUuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnRoaW5rc2hvcC5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi50aWFuMTAuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnRpYW50aWFuLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5qdW5waC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoudGlleW91LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi50b2dqLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi50b29vZ29vby5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoudG95OTAuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnRveXMzNjUuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnRweTEwMC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoudHVuaXUuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnR6dGFydC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoudWdvdS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi51aXBtYWxsLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi51aXlpLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnVzaGFuLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnV1c2hvdWppLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi51eWExMDAuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnZhYWthdi5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoudmFmb3guY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnZhbmNsLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi52Y290dG9uLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi52ZWVkbC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoudmVnb29zLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi52ZW51c3ZlaWwuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnZlcnlvay5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi52aWNjb2wuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnZpcHNob3AuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnZpcHN0b3JlLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi52aXZpYW4uY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoudmppYS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoudm5hc2kuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnZvaXB5ZWFoLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi53MS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi53YWlwb3dhbmcuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLndhbmdzaGFuZ2hhaS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoud2czNjUuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLndpbmVuaWNlLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi53bC5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi53b21haS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoud295ZS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoud3Rhb3Rhby5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoud3VtZWl3YW5nLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi54LXBsYXlib3kuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnhpYW9rYW5nLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi54aWFvemh1cmVuLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi54aW5iYWlnby5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoueGluZG91LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi54aW5nODAwLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi54aW5odWFib29rc3RvcmUuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnhpdS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoueHRwby5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi54enVhbi5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoueWFqYS5jb20uY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoueWFvZmFuZy5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi55YXNhaS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi55ZWVjYXJlLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vYnV5Lnllc2t5LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi55ZXNteXRlYS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoueWVzbXl3aW5lLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi55aWRlLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi55aWZ1LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi55aWhhb2RpYW4uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnlpbnRhaS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoueWlueXVlaGUubmV0LyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnlqY3MuY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoueW9icmFuZC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoueW9nZXIuY29tLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnlvaG8uY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoueW9uZ2xlLmNvbS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi55b3Vnb3UuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnlvdWprLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi55b3lvMTguY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnl1bWFvY2x1Yi5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoueXlvc3NvLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi56YmlyZC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouemdjYmIuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnptNy5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi56b3BvLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5pYnV5aW5nLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi4zM2dvLmNvbS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi54aWppZS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubm9wLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmFzeXAuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnNwYXJ0eS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi55aXpoZWRpYW4uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmx2aGV6aS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouYWlzaGFuZ2Jhb2Jhby5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouc3BvcnRpY2EuY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouanN0c2lsay5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5jYW1lbC5jb20uY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouY290dG9ucG9wLm5ldC8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5oeWouY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm15eGllcXUuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm1mcGxhemEuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmRvOTMuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjNndW8uY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoueWFxaWZ1c2hpLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi50cnVyYS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubGJhb2Jhby5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi54aXV0dWFuLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi51c2FzaG9wY24uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmloYXZldS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoudmlwa3UuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnZpcGNoaW5hLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5mYW5ycnkuY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubGVzdW52aXAuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm5hbGEuY29tLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm1pcWkuY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubWVpcmlidXkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnB1ZnVuZy5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoueGlhb3llLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5obWVpbGkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm91bHlidXkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm1laWZlbnppLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5jYW9tZWlzaG9wLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5tZWlmdTM2MC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouYmFwYXNob3AuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmJ1bGFuZ3hpb25nZGkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmd1c3VidXkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm9wZWFybC5uZXQvKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoucnVjaS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5yYXguY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouaml1eGlhbi5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubWFpbWFpY2hhLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5waW53aW5lLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm1laXdlaWRhby5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoub2tsaWFuZy5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouMzY1d2luZS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouampsZy5jb20uY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouYmlhbmxpc2hlLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5lcGttYWxsLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5nZGNjdC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouNTAwY2NjLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5tZTM2MS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubWFsYXRhbW9iaWxlLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi50cmlvby5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoub29oZGVhci5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoueWFhaGUuY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouZWFzZWV5ZXMuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmRib3guY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouaGFvdGVodWkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm02Z28uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmJpYW55aWdvLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5va2plZS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubXlnZWVrLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnRiYi5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi51c2hhcmUzNjAuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmdxdDE2OC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoua29uam95LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5hb2xpei5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouamlhbmlhbmxlLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5ha2FqaWEuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm1pcWkuY29tLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmxlaHVpbWFpLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5saWZldmMuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qd3d3Lm91a3UuY29tLwovLyBAaW5jbHVkZSAgICAgaHR0cDovL251b21pLmNvbS8qCi8vID09L1VzZXJTY3JpcHQ9PQooZnVuY3Rpb24oKXsKICAgIHZhciBzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7CiAgICBzLnNldEF0dHJpYnV0ZSgnc3JjJywnaHR0cHM6Ly9zaGFyZWQtaHR0cHMueWRzdGF0aWMuY29tL2dvdXd1ZXgvZXh0L3NjcmlwdC9leHRlbnNpb25fM18xLmpzP3ZlbmRvcj15b3VkYW8mYnJvd3Nlcj1maXJlZm94Jyk7CiAgICBzLnNldEF0dHJpYnV0ZSgnY2hhcnNldCcsJ3V0Zi04Jyk7CiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHMpOwp9KSgpOwoKd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2JlZm9yZXNjcmlwdGV4ZWN1dGUnLGZ1bmN0aW9uKGUpewogIHZhciBzcmMgPSBlLnRhcmdldC5zcmM7CiAgaWYoc3JjLmluZGV4T2YoJ2cuYWxpY2RuLmNvbS9hbGlsb2cvbWxvZy9hcGx1c192Mi5qcyd8fCdnLmFsaWNkbi5jb20vc2VjZGV2L2FkYmxrL2luZGV4LmpzJykgIT09IC0xKXsKICAgIGUucHJldmVudERlZmF1bHQoKTsKICB9Cn0sZmFsc2UpOwo="},{"name":"gwdang","options":{"check_for_updates":true,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_arrayleft":false,"compat_uW_gmonkey":false,"compat_forvarin":false,"noframes":null,"awareOfChrome":false,"run_at":null,"override":{"use_includes":[],"orig_includes":["http://*.jd.com/*","https://*.jd.com/*","http://*.jd.hk/*","https://*.jd.hk/*","http://*.taobao.com/*","https://*.taobao.com/*","http://*.tmall.com/*","https://*.tmall.com/*","https://*.tmall.hk/*","http://*.yixun.com/*","http://*.51buy.com/*","http://*.yhd.com/*","http://*.suning.com/*","https://*.suning.com/*","http://*.dangdang.com/*","http://*.gome.com.cn/*","http://*.newegg.cn/*","http://*.paipai.com/*","https://*.amazon.com/*","https://*.amazon.cn/*","https://*.amazon.*/*","http://www.kjt.com/*","http://www.kaola.com/*","https://www.kaola.com/*","http://www.kaola.com.hk/*","https://www.kaola.com.hk/*","http://www.tcl.com/*","http://shop.hisense.com/*","http://*.oppo.com/*","http://shop.vivo.com.cn/*","http://www.ebay.com/*","http://t.dianping.com/*","http://*.nuomi.com/*","http://*.meituan.com/*","https://yao.95095.com/*","http://*.feiniu.com/*","http://*.meilishuo.com/*","http://*.mogujie.com/*","http://shop.coolpad.cn/*","http://*.sephora.cn/*","http://*.yesmywine.com/*","http://*.yiguo.com/*","http://*.wanggou.com/*","http://mall.jia.com/*","http://weigou.baidu.com/*","http://*.mi.com/*","http://shop.letv.com/*","http://*.handu.com/*","http://*.taoshu.com/*","http://*.1688.com/*","http://*.muyingzhijia.com/*","http://*.vmall.com/*","http://*.xiji.com/*","http://*.xijie.com/*","http://www.yougou.com/*","http://www.okbuy.com/*","http://*.001town.com/*","http://*.01goo.com/*","http://*.03l.cn/*","http://*.133china.com/*","http://*.139shop.com/*","http://yxp.163.com/*","http://*.168dg.com/*","http://*.186mall.com/*","http://*.18to82.com/*","http://*.1j.cn/*","http://*.22shop.com/*","http://*.24dq.com/*","http://*.24quan.com/*","http://*.258sd.com/*","http://*.2688.com/*","http://*.360buy.com/*","http://*.360hqb.com/*","http://*.360kxr.com/*","http://*.360mart.com/*","http://*.365goba.com/*","http://*.38hzt.com/*","http://*.39ty.com/*","http://*.4inlook.com/*","http://*.5188bag.com/*","http://*.51buy.com/*","http://51buy.com/","http://*.51dg.com/*","http://*.51eng.com/*","http://*.51sheyuan.com/*","http://*.51youpin.com/*","http://*.520eye.com/*","http://*.52shehua.com/*","http://*.5366.com/*","http://t.58.com/*","http://*.58hua.com/*","http://*.5lux.com/*","http://*.5yth.com/*","http://*.6919.com/*","http://*.6sbuy.com/*","http://*.77toy.com/*","http://*.7caihua.com/*","http://*.7cv.com/*","http://*.7sev.com/*","http://*.80ebus.com/*","http://*.8801.net/*","http://*.919it.com/*","http://*.929.cn/*","http://*.942radio.com/*","http://b2c.958shop.com/*","http://*.96128.com/*","http://*.99pto.com/*","http://*.99read.com/*","http://*.9dadao.com/*","http://*.9you.com/*","http://*.afffff.com/*","http://*.ai356.com/*","http://*.aibang.com/*","http://*.aidai.com/*","http://*.aiju.com/*","http://*.aim36.com/*","http://*.aimer.com.cn/*","http://*.aiyingshi.com/*","http://*.aizhigu.com.cn/*","http://*.amazon.cn/*","http://*.anni.com/*","http://*.apabi.com/*","http://*.augshow.com/*","http://*.autosup.com/*","http://*.baiyjk.com/*","http://*.bbesports.com/*","http://*.bookuu.com/*","http://*.bearbuy.com.cn/*","http://*.beautyplus.cn/*","http://*.beifabook.com/*","http://*.benq.com.cn/*","http://*.best1.com/*","http://*.biaoshang.hk/*","http://*.binggo.com/*","http://*.bloves.com/*","http://*.bobomobi.com/*","http://*.bookschina.com/*","http://*.boqii.com/*","http://*.buding.com/*","http://*.buy007.com/*","http://*.buy361.cn/*","http://*.buyfine.net/*","http://*.buynow.com.cn/*","http://*.caistv.com/*","http://*.caomeipai.com/*","http://*.car339.com.cn/*","http://*.car6688.com/*","http://*.carrefour.com.cn/*","http://*.cdream.com/*","http://*.ceetop.com/*","http://*.chashu.cn/*","http://*.chedangjia.com/*","http://*.chengdecs.com/*","http://*.china-gift.com/*","http://*.china-pub.com/*","http://emall.chinapay.com/*","http://*.chinayrs.com/*","http://*.chris-tina.com/*","http://*.clady.com/*","http://*.clinique.com.cn/*","http://*.cncard.com/*","http://*.cnfse.com/*","http://*.colebuy.com/*","http://*.conslive.com/*","http://*.coo8.com/*","http://*.cosize.com/*","http://*.cosme-de.com/*","http://*.ctrip.com/*","http://*.cw100.com/*","http://*.d1.com.cn/*","http://*.daisonghua.com/*","http://*.dangdang.com/*","http://*.daoyao.com/*","http://*.woyo.com/*","http://*.dazhe.cn/*","http://*.dazhongdianqi.com.cn/*","http://*.dianpu.com/*","http://*.didatuan.com/*","http://*.disiqu.cn/*","http://*.dixintong.com/*","http://*.doulaimai.com/*","http://*.dsgoo.com/*","http://*.dtoto.com/*","http://*.duhub.com/*","http://*.duoding.com/*","http://*.e-giordano.com/*","http://*.e-lining.com/*","http://*.e-my.com.cn/*","http://*.easy361.com/*","http://*.ebaimi.com/*","http://*.eboxbuy.com/*","http://*.ebtea.com/*","http://*.ecosme.cn/*","http://*.efeihu.com/*","http://*.ehaier.com/*","http://*.ejia.com/*","http://*.enet.com.cn/*","http://*.enjoyeye.com/*","http://*.epetbar.com/*","http://*.et5155.com/*","http://*.f508.com/*","http://*.fclub.cn/*","http://*.flowerby.com/*","http://*.flowercn.com/*","http://*.gap.cn/*","http://*.godida.com/*","http://*.gome.com.cn/*","http://*.goocctv.cn/*","http://*.goodjd.com/*","http://*.goodnourish.cn/*","http://*.gou3618.com/*","http://*.gouduo.com/*","http://*.gouwulian.com/*","http://*.gouxie.com/*","http://*.goyahome.com/*","http://*.guobuy.com/*","http://*.guopi.com/*","http://*.guuoo.com/*","http://*.hany.cn/*","http://*.happigo.com/*","http://*.hit168.com.cn/*","http://*.hitao.com/*","http://*.homeold.cn/*","http://*.homevv.com/*","http://*.hongkouzi.com/*","http://*.hopebook.net/*","http://*.huachu.com.cn/*","http://*.huimeifang.cn/*","http://*.hw2008.cn/*","http://*.icaifeng.com/*","http://*.icson.com/*","http://*.ideemall.com/*","http://*.ihush.com/*","http://*.iloveyou.com.cn/*","http://*.ilovezuan.com/*","http://*.imeelee.com/*","http://*.inoble.com.cn/*","http://*.inshion.com/*","http://*.ishop.cn/*","http://*.it88.com.cn/*","http://*.itzm.com/*","http://*.iyuyou.com/*","http://*.jiajiajk.com/*","http://*.jiaju.com/*","http://*.jiatx.com/*","http://*.jiayougo.com/*","http://*.jinbaidu.com/*","http://*.jmeishop.com/*","http://*.joyran.com/*","http://*.jsbcmall.com/*","http://*.jtlhome.com/*","http://*.jumei.com/*","http://*.junph.com/*","http://*.justonline.cn/*","http://*.jxdyf.com/*","http://*.k121.com/*","http://*.kadang.com/*","http://*.keede.com.cn/*","http://*.kela.cn/*","http://*.kuaishubao.com/*","http://*.kxtkx.com/*","http://*.ladypk.com/*","http://*.laeibelle.com/*","http://*.lafaso.com/*","http://*.lamiu.com/*","http://*.lancome.com.cn/*","http://*.lashou.com/*","http://*.ledaojia.com/*","http://*.leftlady.com/*","http://*.lenovo.com.cn/*","http://*.lens2005.com/*","http://*.letao.com/*","http://*.leyou.com/*","http://*.leyou.com.cn/*","http://*.lijiababy.com.cn/*","http://*.lijigou.com/*","http://*.likebuy.com/*","http://*.likeface.com/*","http://*.lingshi.com/*","http://*.liqunshop.com/*","http://*.liyi99.com/*","http://*.locknlock.com.cn/*","http://*.lovo.cn/*","http://*.luckigo.com/*","http://*.lusen.com/*","http://*.lyceem.com/*","http://*.m18.com/*","http://*.maichawang.com/*","http://*.maimaike.cn/*","http://*.mamabb.com/*","http://*.mamahao.cn/*","http://*.mangocity.com/*","http://*.manzuo.com/*","http://*.masamaso.com/*","http://*.maxfunbuy.com/*","http://*.maywon.com/*","http://*.mbaobao.com/*","http://*.meici.com/*","http://*.meilele.com/*","http://*.meilieasy.com/*","http://*.meituan.com/*","http://*.menglu.com/*","http://*.mengmai.com/*","http://*.minibuy.com/*","http://*.mmgw.cn/*","http://*.mmuses.com/*","http://*.mobi001.com/*","http://*.mokamall.com/*","http://*.momoyoyo.com/*","http://*.montrosechina.com/*","http://*.mooiee.com/*","http://*.moonbasa.com/*","http://*.motostore.com.cn/*","http://*.mpshow.com.cn/*","http://*.naccoo.com/*","http://*.naguu.com/*","http://*.nayao.com/*","http://*.newegg.com.cn/*","http://*.newgo5.com/*","http://*.nmlch.com/*","http://*.no5.com.cn/*","http://*.nokia.com.cn/*","http://*.nonmin88.com/*","http://*.obuy.cn/*","http://*.ofcard.com/*","http://*.ogage.cn/*","http://*.okbig.com/*","http://*.okbuy.com/*","http://*.okddy.com/*","http://*.okgolf.cn/*","http://*.olomo.com/*","http://*.olympus.com.cn/*","http://*.olymsports.com/*","http://*.ono.com.cn/*","http://*.orange3c.com/*","http://*.ouku.com/*","http://*.ourtasty.com/*","http://*.outice.com/*","http://*.oyego.com/*","http://*.paixie.net/*","http://*.palcent.com/*","http://*.ocj.com.cn/*","http://*.pb89.com/*","http://*.pcarm.com/*","http://*.petyoo.com/*","http://*.pgbao.com/*","http://*.piaoliang100.com/*","http://*.pirateship.com.cn/*","http://*.popyj.com/*","http://*.pupai.cn/*","http://*.purcotton.com/*","http://*.qianxun.com/*","http://*.qingci.com/*","http://*.qinqinbaby.com/*","http://*.qmango.com/*","http://*.qumei.com/*","http://*.quwan.com/*","http://*.qxian.com/*","http://*.rayi.cn/*","http://*.redbaby.com.cn/*","http://*.robam.com/*","http://*.salala.com.cn/*","http://*.samsclub.cn/*","http://*.sanfo.com/*","http://*.sapo.com.hk/*","http://*.sasa.com/*","http://*.sasacity.com/*","http://*.sawbuy.com/*","http://*.shanghai-sports.com/*","http://*.shentop.com/*","http://*.shishangqiyi.com/*","http://*.shjdq.com/*","http://*.shnn.com/*","http://*.shopin.net/*","http://*.shoubiao.com.cn/*","http://*.sigo.cn/*","http://mall.sina.com.cn/*","http://*.sinobuy.cn/*","http://*.skcoo.com/*","http://*.skomart.com/*","http://*.snyun.com/*","http://*.sonmai.cn/*","http://*.sport2008.com.cn/*","http://*.strawberrynet.com/*","http://*.suning.com/*","http://*.sz-esun.com/*","http://*.tao3c.com/*","http://item.taobao.com/*","http://*.taoxie.cn/*","http://*.the365.com/*","http://*.thinkshop.cn/*","http://*.tian10.com/*","http://*.tiantian.com/*","http://*.junph.com/*","http://*.tieyou.com/*","http://detail.tmall.com/*","http://*.togj.com/*","http://*.tooogooo.com/*","http://*.toy90.com/*","http://*.toys365.com/*","http://*.tpy100.com/*","http://*.tuniu.com/*","http://*.tztart.com/*","http://*.ugou.cn/*","http://*.uipmall.com/*","http://*.uiyi.cn/*","http://*.ushan.cn/*","http://*.uushouji.com/*","http://*.uya100.com/*","http://*.vaakav.com/*","http://*.vafox.com/*","http://*.vancl.com/*","http://*.vcotton.com/*","http://*.veedl.com/*","http://*.vegoos.com/*","http://*.venusveil.com/*","http://*.veryok.cn/*","http://*.viccol.com/*","http://*.vipshop.com/*","http://*.vipstore.com/*","http://*.vivian.cn/*","http://*.vjia.com/*","http://*.vnasi.com/*","http://*.voipyeah.com/*","http://*.w1.cn/*","http://*.waipowang.com/*","http://*.wangshanghai.com/*","http://*.wg365.com/*","http://*.winenice.com/*","http://*.wl.cn/*","http://*.womai.com/*","http://*.woye.com/*","http://*.wtaotao.com/*","http://*.wumeiwang.com/*","http://*.x-playboy.com/*","http://*.xiaokang.com/*","http://*.xiaozhuren.com/*","http://*.xinbaigo.com/*","http://*.xindou.com/*","http://*.xing800.com/*","http://*.xinhuabookstore.com/*","http://*.xiu.com/*","http://*.xtpo.cn/*","http://*.xzuan.com/*","http://*.yaja.com.cn/*","http://*.yaofang.cn/*","http://*.yasai.cn/*","http://*.yeecare.com/*","http://buy.yesky.com/*","http://*.yesmytea.com/*","http://*.yesmywine.com/*","http://*.yide.com/*","http://*.yifu.com/*","http://*.yihaodian.com/*","http://*.yintai.com/*","http://*.yinyuehe.net/*","http://*.yjcs.cn/*","http://*.yobrand.com/*","http://*.yoger.com.cn/*","http://*.yoho.cn/*","http://*.yongle.com.cn/*","http://*.yougou.com/*","http://*.youjk.com/*","http://*.yoyo18.com/*","http://*.yumaoclub.com/*","http://*.yyosso.com/*","http://*.zbird.com/*","http://*.zgcbb.com/*","http://*.zm7.cn/*","http://*.zopo.com/*","http://*.ibuying.com/*","http://*.33go.com.cn/*","http://*.xijie.com/*","http://*.nop.cn/*","http://*.asyp.com/*","http://*.sparty.cn/*","http://*.yizhedian.com/*","http://*.lvhezi.com/*","http://*.aishangbaobao.com/*","http://*.sportica.cn/*","http://*.jstsilk.cn/*","http://*.camel.com.cn/*","http://*.cottonpop.net/*","http://*.hyj.com/*","http://*.myxiequ.com/*","http://*.mfplaza.com/*","http://*.do93.com/*","http://*.3guo.cn/*","http://*.yaqifushi.com/*","http://*.trura.com/*","http://*.lbaobao.cn/*","http://*.xiutuan.com/*","http://*.usashopcn.com/*","http://*.ihaveu.com/*","http://*.vipku.com/*","http://*.vipchina.com/*","http://*.fanrry.cn/*","http://*.lesunvip.com/*","http://*.nala.com.cn/*","http://*.miqi.cn/*","http://*.meiribuy.com/*","http://*.pufung.com/*","http://*.xiaoye.com/*","http://*.hmeili.com/*","http://*.oulybuy.com/*","http://*.meifenzi.com/*","http://*.caomeishop.com/*","http://*.meifu360.com/*","http://*.bapashop.com/*","http://*.bulangxiongdi.com/*","http://*.gusubuy.com/*","http://*.opearl.net/*","http://*.ruci.cn/*","http://*.rax.cn/*","http://*.jiuxian.com/*","http://*.maimaicha.com/*","http://*.pinwine.cn/*","http://*.meiweidao.com/*","http://*.okliang.com/*","http://*.365wine.com/*","http://*.jjlg.com.cn/*","http://*.bianlishe.com/*","http://*.epkmall.com/*","http://*.gdcct.com/*","http://*.500ccc.com/*","http://*.me361.com/*","http://*.malatamobile.com/*","http://*.trioo.com/*","http://*.oohdear.com/*","http://*.yaahe.cn/*","http://*.easeeyes.com/*","http://*.dbox.cn/*","http://*.haotehui.com/*","http://*.m6go.com/*","http://*.bianyigo.com/*","http://*.okjee.com/*","http://*.mygeek.cn/*","http://*.tbb.cn/*","http://*.ushare360.com/*","http://*.gqt168.com/*","http://*.konjoy.com/*","http://*.aoliz.com/*","http://*.jianianle.com/*","http://*.akajia.com/*","http://*.miqi.com.cn/*","http://*.lehuimai.com/*","http://*.lifevc.com/*","http://*www.ouku.com/","http://nuomi.com/*"],"merge_includes":true,"use_matches":[],"orig_matches":[],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null,"orig_connects":[]}},"storage":{"ts":1521544028701,"data":{}},"enabled":false,"position":8,"file_url":"https://greasyfork.org/scripts/14466-%E8%B4%AD%E7%89%A9%E5%85%9A%E6%AF%94%E4%BB%B7%E5%B7%A5%E5%85%B7/code/%E8%B4%AD%E7%89%A9%E5%85%9A%E6%AF%94%E4%BB%B7%E5%B7%A5%E5%85%B7.user.js","uuid":"1741e58d-bd6d-4614-bcc5-833d727e7636","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgIGd3ZGFuZwovLyBAbmFtZTp6aC1DTiAgIOi0reeJqeWFmuavlOS7t+W3peWFtwovLyBAbmFtZXNwYWNlICAgbm8KLy8gQGRlc2NyaXB0aW9uIOa1j+iniOWVhuWTgemhtemdouaXtu+8jOiHquWKqOavlOi+g+WQjOasvuWVhuWTgeWcqOa3mOWunS/kuqzkuJwv5Lqa6ams6YCKL+W9k+W9ky/oi4/lroEv562J55m+5a625ZWG5Z+O55qE5pyA5L2O5Lu377yM5o+Q5L6b5Lu35qC85Y6G5Y+y44CB5Y+j56KR6K+E5YiG562J5p+l6K+i44CC5pSv5oyB5ZWG5ZOB5L+D6ZSA5rS75Yqo77yM5ZWG5Z+O5LyY5oOg5L+h5oGv5p+l6K+i77yM5ZWG5ZOB5Y+v5YWo572R5pS26JeP77yM6ZmN5Lu35o+Q6YaS44CC5pSv5oyB6ZO+5a6244CB5oiR54ix5oiR5a6244CB5Lit5Y6f5Zyw5Lqn562J5Li75rWB5oi/5Lqn572R56uZ5oi/5rqQ5Lu35qC86LWw5Yq/5p+l6K+i77yM5Li65Lmw5oi/5Lq65aOr5o+Q5L6b5Yaz562W5Y+C6ICD44CCCi8vIEBkZXNjcmlwdGlvbjp6aC1DTiDmtY/op4jllYblk4HpobXpnaLml7bvvIzoh6rliqjmr5TovoPlkIzmrL7llYblk4HlnKjmt5jlrp0v5Lqs5LicL+S6mumprOmAii/lvZPlvZMv6IuP5a6BL+etieeZvuWutuWVhuWfjueahOacgOS9juS7t++8jOaPkOS+m+S7t+agvOWOhuWPsuOAgeWPo+eikeivhOWIhuetieafpeivouOAguaUr+aMgeWVhuWTgeS/g+mUgOa0u+WKqO+8jOWVhuWfjuS8mOaDoOS/oeaBr+afpeivou+8jOWVhuWTgeWPr+WFqOe9keaUtuiXj++8jOmZjeS7t+aPkOmGkuOAguaUr+aMgemTvuWutuOAgeaIkeeIseaIkeWutuOAgeS4reWOn+WcsOS6p+etieS4u+a1geaIv+S6p+e9keermeaIv+a6kOS7t+agvOi1sOWKv+afpeivou+8jOS4uuS5sOaIv+S6uuWjq+aPkOS+m+WGs+etluWPguiAg+OAggovLyBAcnVuLWF0ICAgICAgZG9jdW1lbnQtaWRsZQovLyBAdmVyc2lvbiAgICAgMy4wCi8vIEByZXF1aXJlICAgICBodHRwczovL2Jyb3dzZXIuZ3dkYW5nLmNvbS9nZXQuanM/Zj0vanMvZ3dkYW5nX2V4dGVuc2lvbi5qcwovLyBAZ3JhbnQgCSAgIG5vbmUKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmpkLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwczovLyouamQuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmpkLmhrLyoKLy8gQGluY2x1ZGUgICAgIGh0dHBzOi8vKi5qZC5oay8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi50YW9iYW8uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHBzOi8vKi50YW9iYW8uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnRtYWxsLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwczovLyoudG1hbGwuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHBzOi8vKi50bWFsbC5oay8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi55aXh1bi5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouNTFidXkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnloZC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouc3VuaW5nLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwczovLyouc3VuaW5nLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5kYW5nZGFuZy5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouZ29tZS5jb20uY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubmV3ZWdnLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnBhaXBhaS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cHM6Ly8qLmFtYXpvbi5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cHM6Ly8qLmFtYXpvbi5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwczovLyouYW1hem9uLiovKgovLyBAaW5jbHVkZSAgICAgaHR0cDovL3d3dy5ranQuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly93d3cua2FvbGEuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHBzOi8vd3d3Lmthb2xhLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vd3d3Lmthb2xhLmNvbS5oay8qCi8vIEBpbmNsdWRlICAgICBodHRwczovL3d3dy5rYW9sYS5jb20uaGsvKgovLyBAaW5jbHVkZSAgICAgaHR0cDovL3d3dy50Y2wuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly9zaG9wLmhpc2Vuc2UuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm9wcG8uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly9zaG9wLnZpdm8uY29tLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly93d3cuZWJheS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovL3QuZGlhbnBpbmcuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm51b21pLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5tZWl0dWFuLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwczovL3lhby45NTA5NS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouZmVpbml1LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5tZWlsaXNodW8uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm1vZ3VqaWUuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly9zaG9wLmNvb2xwYWQuY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouc2VwaG9yYS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi55ZXNteXdpbmUuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnlpZ3VvLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi53YW5nZ291LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vbWFsbC5qaWEuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly93ZWlnb3UuYmFpZHUuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm1pLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vc2hvcC5sZXR2LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5oYW5kdS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoudGFvc2h1LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi4xNjg4LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5tdXlpbmd6aGlqaWEuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnZtYWxsLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi54aWppLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi54aWppZS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovL3d3dy55b3Vnb3UuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly93d3cub2tidXkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjAwMXRvd24uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjAxZ29vLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi4wM2wuY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouMTMzY2hpbmEuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjEzOXNob3AuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly95eHAuMTYzLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi4xNjhkZy5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouMTg2bWFsbC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouMTh0bzgyLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi4xai5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi4yMnNob3AuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjI0ZHEuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjI0cXVhbi5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouMjU4c2QuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjI2ODguY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjM2MGJ1eS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouMzYwaHFiLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi4zNjBreHIuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjM2MG1hcnQuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjM2NWdvYmEuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjM4aHp0LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi4zOXR5LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi40aW5sb29rLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi41MTg4YmFnLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi41MWJ1eS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLzUxYnV5LmNvbS8KLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjUxZGcuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjUxZW5nLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi41MXNoZXl1YW4uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjUxeW91cGluLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi41MjBleWUuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjUyc2hlaHVhLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi41MzY2LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vdC41OC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouNThodWEuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjVsdXguY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjV5dGguY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjY5MTkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjZzYnV5LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi43N3RveS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouN2NhaWh1YS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouN2N2LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi43c2V2LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi44MGVidXMuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjg4MDEubmV0LyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjkxOWl0LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi45MjkuY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouOTQycmFkaW8uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly9iMmMuOTU4c2hvcC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouOTYxMjguY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjk5cHRvLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi45OXJlYWQuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjlkYWRhby5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouOXlvdS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouYWZmZmZmLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5haTM1Ni5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouYWliYW5nLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5haWRhaS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouYWlqdS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouYWltMzYuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmFpbWVyLmNvbS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5haXlpbmdzaGkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmFpemhpZ3UuY29tLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmFtYXpvbi5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5hbm5pLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5hcGFiaS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouYXVnc2hvdy5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouYXV0b3N1cC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouYmFpeWprLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5iYmVzcG9ydHMuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmJvb2t1dS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouYmVhcmJ1eS5jb20uY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouYmVhdXR5cGx1cy5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5iZWlmYWJvb2suY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmJlbnEuY29tLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmJlc3QxLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5iaWFvc2hhbmcuaGsvKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouYmluZ2dvLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5ibG92ZXMuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmJvYm9tb2JpLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5ib29rc2NoaW5hLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5ib3FpaS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouYnVkaW5nLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5idXkwMDcuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmJ1eTM2MS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5idXlmaW5lLm5ldC8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5idXlub3cuY29tLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmNhaXN0di5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouY2FvbWVpcGFpLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5jYXIzMzkuY29tLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmNhcjY2ODguY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmNhcnJlZm91ci5jb20uY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouY2RyZWFtLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5jZWV0b3AuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmNoYXNodS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5jaGVkYW5namlhLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5jaGVuZ2RlY3MuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmNoaW5hLWdpZnQuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmNoaW5hLXB1Yi5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovL2VtYWxsLmNoaW5hcGF5LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5jaGluYXlycy5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouY2hyaXMtdGluYS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouY2xhZHkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmNsaW5pcXVlLmNvbS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5jbmNhcmQuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmNuZnNlLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5jb2xlYnV5LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5jb25zbGl2ZS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouY29vOC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouY29zaXplLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5jb3NtZS1kZS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouY3RyaXAuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmN3MTAwLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5kMS5jb20uY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouZGFpc29uZ2h1YS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouZGFuZ2RhbmcuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmRhb3lhby5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoud295by5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouZGF6aGUuY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouZGF6aG9uZ2RpYW5xaS5jb20uY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouZGlhbnB1LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5kaWRhdHVhbi5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouZGlzaXF1LmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmRpeGludG9uZy5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouZG91bGFpbWFpLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5kc2dvby5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouZHRvdG8uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmR1aHViLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5kdW9kaW5nLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5lLWdpb3JkYW5vLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5lLWxpbmluZy5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouZS1teS5jb20uY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouZWFzeTM2MS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouZWJhaW1pLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5lYm94YnV5LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5lYnRlYS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouZWNvc21lLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmVmZWlodS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouZWhhaWVyLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5lamlhLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5lbmV0LmNvbS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5lbmpveWV5ZS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouZXBldGJhci5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouZXQ1MTU1LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5mNTA4LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5mY2x1Yi5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5mbG93ZXJieS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouZmxvd2VyY24uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmdhcC5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5nb2RpZGEuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmdvbWUuY29tLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmdvb2NjdHYuY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouZ29vZGpkLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5nb29kbm91cmlzaC5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5nb3UzNjE4LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5nb3VkdW8uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmdvdXd1bGlhbi5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouZ291eGllLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5nb3lhaG9tZS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouZ3VvYnV5LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5ndW9waS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouZ3V1b28uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmhhbnkuY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouaGFwcGlnby5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouaGl0MTY4LmNvbS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5oaXRhby5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouaG9tZW9sZC5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5ob21ldnYuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmhvbmdrb3V6aS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouaG9wZWJvb2submV0LyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmh1YWNodS5jb20uY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouaHVpbWVpZmFuZy5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5odzIwMDguY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouaWNhaWZlbmcuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmljc29uLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5pZGVlbWFsbC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouaWh1c2guY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmlsb3ZleW91LmNvbS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5pbG92ZXp1YW4uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmltZWVsZWUuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmlub2JsZS5jb20uY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouaW5zaGlvbi5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouaXNob3AuY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouaXQ4OC5jb20uY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouaXR6bS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouaXl1eW91LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5qaWFqaWFqay5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouamlhanUuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmppYXR4LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5qaWF5b3Vnby5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouamluYmFpZHUuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmptZWlzaG9wLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5qb3lyYW4uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmpzYmNtYWxsLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5qdGxob21lLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5qdW1laS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouanVucGguY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmp1c3RvbmxpbmUuY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouanhkeWYuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmsxMjEuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmthZGFuZy5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoua2VlZGUuY29tLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmtlbGEuY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoua3VhaXNodWJhby5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoua3h0a3guY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmxhZHlway5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubGFlaWJlbGxlLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5sYWZhc28uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmxhbWl1LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5sYW5jb21lLmNvbS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5sYXNob3UuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmxlZGFvamlhLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5sZWZ0bGFkeS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubGVub3ZvLmNvbS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5sZW5zMjAwNS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubGV0YW8uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmxleW91LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5sZXlvdS5jb20uY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubGlqaWFiYWJ5LmNvbS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5saWppZ291LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5saWtlYnV5LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5saWtlZmFjZS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubGluZ3NoaS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubGlxdW5zaG9wLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5saXlpOTkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmxvY2tubG9jay5jb20uY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubG92by5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5sdWNraWdvLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5sdXNlbi5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubHljZWVtLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5tMTguY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm1haWNoYXdhbmcuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm1haW1haWtlLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm1hbWFiYi5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubWFtYWhhby5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5tYW5nb2NpdHkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm1hbnp1by5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubWFzYW1hc28uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm1heGZ1bmJ1eS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubWF5d29uLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5tYmFvYmFvLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5tZWljaS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubWVpbGVsZS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubWVpbGllYXN5LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5tZWl0dWFuLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5tZW5nbHUuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm1lbmdtYWkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm1pbmlidXkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm1tZ3cuY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubW11c2VzLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5tb2JpMDAxLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5tb2thbWFsbC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubW9tb3lveW8uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm1vbnRyb3NlY2hpbmEuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm1vb2llZS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubW9vbmJhc2EuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm1vdG9zdG9yZS5jb20uY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubXBzaG93LmNvbS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5uYWNjb28uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm5hZ3V1LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5uYXlhby5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubmV3ZWdnLmNvbS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5uZXdnbzUuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm5tbGNoLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5ubzUuY29tLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm5va2lhLmNvbS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5ub25taW44OC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoub2J1eS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5vZmNhcmQuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm9nYWdlLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm9rYmlnLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5va2J1eS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoub2tkZHkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm9rZ29sZi5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5vbG9tby5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoub2x5bXB1cy5jb20uY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoub2x5bXNwb3J0cy5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoub25vLmNvbS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5vcmFuZ2UzYy5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoub3VrdS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoub3VydGFzdHkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm91dGljZS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoub3llZ28uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnBhaXhpZS5uZXQvKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoucGFsY2VudC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoub2NqLmNvbS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5wYjg5LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5wY2FybS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoucGV0eW9vLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5wZ2Jhby5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoucGlhb2xpYW5nMTAwLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5waXJhdGVzaGlwLmNvbS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5wb3B5ai5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoucHVwYWkuY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoucHVyY290dG9uLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5xaWFueHVuLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5xaW5nY2kuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnFpbnFpbmJhYnkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnFtYW5nby5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoucXVtZWkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnF1d2FuLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5xeGlhbi5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoucmF5aS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5yZWRiYWJ5LmNvbS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5yb2JhbS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouc2FsYWxhLmNvbS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5zYW1zY2x1Yi5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5zYW5mby5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouc2Fwby5jb20uaGsvKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouc2FzYS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouc2FzYWNpdHkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnNhd2J1eS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouc2hhbmdoYWktc3BvcnRzLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5zaGVudG9wLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5zaGlzaGFuZ3FpeWkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnNoamRxLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5zaG5uLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5zaG9waW4ubmV0LyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnNob3ViaWFvLmNvbS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5zaWdvLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly9tYWxsLnNpbmEuY29tLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnNpbm9idXkuY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouc2tjb28uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnNrb21hcnQuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnNueXVuLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5zb25tYWkuY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouc3BvcnQyMDA4LmNvbS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5zdHJhd2JlcnJ5bmV0LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5zdW5pbmcuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnN6LWVzdW4uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnRhbzNjLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vaXRlbS50YW9iYW8uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnRhb3hpZS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi50aGUzNjUuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnRoaW5rc2hvcC5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi50aWFuMTAuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnRpYW50aWFuLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5qdW5waC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoudGlleW91LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vZGV0YWlsLnRtYWxsLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi50b2dqLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi50b29vZ29vby5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoudG95OTAuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnRveXMzNjUuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnRweTEwMC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoudHVuaXUuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnR6dGFydC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoudWdvdS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi51aXBtYWxsLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi51aXlpLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnVzaGFuLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnV1c2hvdWppLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi51eWExMDAuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnZhYWthdi5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoudmFmb3guY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnZhbmNsLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi52Y290dG9uLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi52ZWVkbC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoudmVnb29zLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi52ZW51c3ZlaWwuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnZlcnlvay5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi52aWNjb2wuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnZpcHNob3AuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnZpcHN0b3JlLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi52aXZpYW4uY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoudmppYS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoudm5hc2kuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnZvaXB5ZWFoLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi53MS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi53YWlwb3dhbmcuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLndhbmdzaGFuZ2hhaS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoud2czNjUuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLndpbmVuaWNlLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi53bC5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi53b21haS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoud295ZS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoud3Rhb3Rhby5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoud3VtZWl3YW5nLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi54LXBsYXlib3kuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnhpYW9rYW5nLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi54aWFvemh1cmVuLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi54aW5iYWlnby5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoueGluZG91LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi54aW5nODAwLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi54aW5odWFib29rc3RvcmUuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnhpdS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoueHRwby5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi54enVhbi5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoueWFqYS5jb20uY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoueWFvZmFuZy5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi55YXNhaS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi55ZWVjYXJlLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vYnV5Lnllc2t5LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi55ZXNteXRlYS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoueWVzbXl3aW5lLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi55aWRlLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi55aWZ1LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi55aWhhb2RpYW4uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnlpbnRhaS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoueWlueXVlaGUubmV0LyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnlqY3MuY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoueW9icmFuZC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoueW9nZXIuY29tLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnlvaG8uY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoueW9uZ2xlLmNvbS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi55b3Vnb3UuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnlvdWprLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi55b3lvMTguY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnl1bWFvY2x1Yi5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoueXlvc3NvLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi56YmlyZC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouemdjYmIuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnptNy5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi56b3BvLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5pYnV5aW5nLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi4zM2dvLmNvbS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi54aWppZS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubm9wLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmFzeXAuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnNwYXJ0eS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi55aXpoZWRpYW4uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmx2aGV6aS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouYWlzaGFuZ2Jhb2Jhby5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouc3BvcnRpY2EuY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouanN0c2lsay5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5jYW1lbC5jb20uY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouY290dG9ucG9wLm5ldC8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5oeWouY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm15eGllcXUuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm1mcGxhemEuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmRvOTMuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjNndW8uY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoueWFxaWZ1c2hpLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi50cnVyYS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubGJhb2Jhby5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi54aXV0dWFuLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi51c2FzaG9wY24uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmloYXZldS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoudmlwa3UuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnZpcGNoaW5hLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5mYW5ycnkuY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubGVzdW52aXAuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm5hbGEuY29tLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm1pcWkuY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubWVpcmlidXkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnB1ZnVuZy5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoueGlhb3llLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5obWVpbGkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm91bHlidXkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm1laWZlbnppLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5jYW9tZWlzaG9wLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5tZWlmdTM2MC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouYmFwYXNob3AuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmJ1bGFuZ3hpb25nZGkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmd1c3VidXkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm9wZWFybC5uZXQvKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoucnVjaS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5yYXguY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouaml1eGlhbi5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubWFpbWFpY2hhLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5waW53aW5lLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm1laXdlaWRhby5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoub2tsaWFuZy5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouMzY1d2luZS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouampsZy5jb20uY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouYmlhbmxpc2hlLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5lcGttYWxsLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5nZGNjdC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouNTAwY2NjLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5tZTM2MS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubWFsYXRhbW9iaWxlLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi50cmlvby5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoub29oZGVhci5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoueWFhaGUuY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouZWFzZWV5ZXMuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmRib3guY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouaGFvdGVodWkuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm02Z28uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmJpYW55aWdvLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5va2plZS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoubXlnZWVrLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnRiYi5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi51c2hhcmUzNjAuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmdxdDE2OC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoua29uam95LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5hb2xpei5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyouamlhbmlhbmxlLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5ha2FqaWEuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLm1pcWkuY29tLmNuLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmxlaHVpbWFpLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5saWZldmMuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qd3d3Lm91a3UuY29tLwovLyBAaW5jbHVkZSAgICAgaHR0cDovL251b21pLmNvbS8qCi8vID09L1VzZXJTY3JpcHQ9PQooZnVuY3Rpb24oKSB7Cgl2YXIgcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOwoJcy5zZXRBdHRyaWJ1dGUoJ3NyYycsICdAcmVxdWlyZScpOwoJZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChzKTsKfSkoKQ=="},{"name":"自动京东配送","options":{"check_for_updates":true,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_arrayleft":false,"compat_uW_gmonkey":false,"compat_forvarin":false,"noframes":null,"awareOfChrome":false,"run_at":null,"override":{"use_includes":[],"orig_includes":["*//search.jd.com/*","*//www.jd.com/pinpai/*","*//list.jd.com/list.html?*"],"merge_includes":true,"use_matches":[],"orig_matches":[],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-start","orig_noframes":null,"orig_connects":[]}},"storage":{"ts":1521545687748,"data":{}},"enabled":true,"position":9,"file_url":"https://greasyfork.org/scripts/18190-%E8%87%AA%E5%8A%A8%E4%BA%AC%E4%B8%9C%E9%85%8D%E9%80%81/code/%E8%87%AA%E5%8A%A8%E4%BA%AC%E4%B8%9C%E9%85%8D%E9%80%81.user.js","uuid":"c0d91cbb-bb59-41b8-85ef-911936b6b356","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICAgICAgICAg6Ieq5Yqo5Lqs5Lic6YWN6YCBCi8vIEBuYW1lOnpoLUNOICAgICAgICAgIOiHquWKqOS6rOS4nOmFjemAgQovLyBAbmFtZTp6aC1UVyAgICAgICAgICDoh6rli5XkuqzmnbHphY3pgIEKLy8gQGRlc2NyaXB0aW9uICAgICAgICAg5Zyo5Lqs5Lic5rWP6KeI5ZWG5ZOB5pe277yM5Y+v6YCJ5oup6Ieq5Yqo5Li65L2g5Yu+6YCJIFvkuqzkuJzphY3pgIFd44CBW+S7heaYvuekuuaciei0p13jgIFb6ZSA6YeP5o6S5bqPXeOAguaWueS+v+WunueUqO+8gQovLyBAZGVzY3JpcHRpb246emgtQ04gICDlnKjkuqzkuJzmtY/op4jllYblk4Hml7bvvIzlj6/pgInmi6noh6rliqjkuLrkvaDli77pgIkgW+S6rOS4nOmFjemAgV3jgIFb5LuF5pi+56S65pyJ6LSnXeOAgVvplIDph4/mjpLluo9d44CC5pa55L6/5a6e55So77yBCi8vIEBkZXNjcmlwdGlvbjp6aC1UVyAgIOWcqOS6rOadseeAj+imveWVhuWTgeaZgu+8jOWPr+mBuOaTh+iHquWLleeCuuS9oOWLvumBuCBb5Lqs5p2x6YWN6YCBXeOAgVvlg4Xpoa/npLrmnInosqhd44CBW+mKt+mHj+aOkuW6j13jgILmlrnkvr/lr6bnlKjvvIEKCi8vIEBhdXRob3IgICAgICAgICAgICAgIE1vc2hlbAovLyBAbmFtZXNwYWNlICAgICAgICAgICBodHRwczovL2h6eS5wdwovLyBAaG9tZXBhZ2VVUkwgICAgICAgICBodHRwczovL2h6eS5wdy9wLzEzNDkKLy8gQHN1cHBvcnRVUkwgICAgICAgICAgaHR0cHM6Ly9naXRodWIuY29tL2gyeS9saW5rLWZpeAovLyBAaWNvbiAgICAgICAgICAgICAgICBodHRwczovL2h6eS5wdy93cC1jb250ZW50L3VwbG9hZHMvMjAxNS8wNC9pLmpwZWcKLy8gQGxpY2Vuc2UgICAgICAgICAgICAgR1BMLTMuMAoKLy8gQGluY2x1ZGUgICAgICAgICAgICAgKi8vc2VhcmNoLmpkLmNvbS8qCi8vIEBpbmNsdWRlICAgICAgICAgICAgICovL3d3dy5qZC5jb20vcGlucGFpLyoKLy8gQGluY2x1ZGUgICAgICAgICAgICAgKi8vbGlzdC5qZC5jb20vbGlzdC5odG1sPyoKLy8gQGdyYW50ICAgICAgICAgICAgICAgbm9uZQovLyBAcnVuLWF0ICAgICAgICAgICAgICBkb2N1bWVudC1zdGFydAoKLy8gQHZlcnNpb24gICAgICAgICAgICAgMi40LjAKLy8gQG1vZGlmaWVkICAgICAgICAgICAgMDIvMDcvMjAxOAovLyA9PS9Vc2VyU2NyaXB0PT0KCgohIGZ1bmN0aW9uKCkgewoKICAgIC8vIGdldCBHRVQgYXR0cmlidXRlcwogICAgY29uc3QgJF9HRVQgPSAoZnVuY3Rpb24oKXsKICAgICAgICBsZXQgdXJsID0gbG9jYXRpb24uc2VhcmNoOwogICAgICAgIGxldCB1ID0gdXJsLnNwbGl0KCI/IiwgMik7CiAgICAgICAgaWYodHlwZW9mKHVbMV0pID09PSAic3RyaW5nIil7CiAgICAgICAgICAgIHUgPSB1WzFdLnNwbGl0KCImIik7CiAgICAgICAgICAgIGxldCBnZXQgPSB7fTsKICAgICAgICAgICAgZm9yKGxldCBpPTA7IGk8dS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgbGV0IGogPSB1W2ldLnNwbGl0KCI9Iik7CiAgICAgICAgICAgICAgICBnZXRbalswXV0gPSBqWzFdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBnZXQ7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIHt9OwogICAgfSkoKTsKCgogICAgbGV0IGhyZWYgPSBsb2NhdGlvbi5zZWFyY2g7CgoKICAgIC8v5pCc57Si6Ieq6JClCiAgICBpZiAoJF9HRVQua2V5d29yZCAmJgogICAgICAgIGRlY29kZVVSSUNvbXBvbmVudCgkX0dFVC5rZXl3b3JkKS5pbmRleE9mKCfoh6rokKUnKTwwICYmCiAgICAgICAgIXdpbmRvdy5zZXNzaW9uU3RvcmFnZVsnYXV0b19qZF9jaGFuZ2VkX2tleXdvcmQnXSApCiAgICB7CiAgICAgICAgaHJlZiA9IGhyZWYucmVwbGFjZSgkX0dFVC5rZXl3b3JkLCAkX0dFVC5rZXl3b3JkICsgJyDoh6rokKUnICk7CiAgICAgICAgd2luZG93LnNlc3Npb25TdG9yYWdlWydhdXRvX2pkX2NoYW5nZWRfa2V5d29yZCddID0gdHJ1ZTsKICAgIH0KCgogICAgLy8g5pyJ6LSnCiAgICBpZiAoISRfR0VULnN0b2NrKQogICAgICAgIGhyZWYgKz0gIiZzdG9jaz0xIjsKICAgIC8vIOS6rOS4nOmFjemAgQogICAgaWYgKCEkX0dFVC53dHlwZSkKICAgICAgICBocmVmICs9ICImd3R5cGU9MSI7CiAgICAvLyDplIDph4/mjpLluo8KICAgIGlmICghJF9HRVQucHNvcnQpCiAgICAgICAgaHJlZiArPSAiJnBzb3J0PTMiOwogICAgLyrmn5DkupvliIbnsbvpobXpnaIqLwogICAgaWYoISRfR0VULnNvcnQpCiAgICAgICAgaHJlZiArPSAiJnNvcnQ9c29ydF90b3RhbHNhbGVzMTVfZGVzYyI7CgoKICAgIGlmKGxvY2F0aW9uLnNlYXJjaCAhPSBocmVmKQogICAgICAgIGxvY2F0aW9uLnNlYXJjaCA9IGhyZWY7Cgp9KCk7Cg=="},{"name":"Popup Blocker Script","options":{"check_for_updates":true,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_arrayleft":false,"compat_uW_gmonkey":false,"compat_forvarin":false,"noframes":null,"awareOfChrome":false,"run_at":null,"override":{"use_includes":[],"orig_includes":[],"merge_includes":true,"use_matches":[],"orig_matches":["https://*/*","http://*/*"],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null,"orig_connects":["re.popupblockerscript.com","self","*"]}},"storage":{"ts":1521801129115,"data":{"dprm":"n1521546217523","sdc_data":"s{\"uid\":null,\"pid\":\"a8363e117138a28f49d8e7e2a7de7ea\",\"lastFocusedUrl\":null,\"q\":\"https://www.baidu.com/s?wd=%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%20%E8%8B%B1%E6%96%87&rsv_spt=1&rsv_iqid=0xc120da8600033643&issp=1&f=8&rsv_bp=0&rsv_idx=2&ie=utf-8&tn=baiduhome_pg&rsv_enter=1&rsv_sug3=25&rsv_sug1=23&rsv_sug7=101&rsv_t=f6eeifyefZw3OvDmGDksaL0zAJ7Ygn4%2BTczxjS%2Bt%2Fu1TviW0lBofeGe7FdGYL4s1cHOp\",\"hreferer\":\"\",\"_active\":\"https://www.baidu.com/s?wd=%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%20%E8%8B%B1%E6%96%87&rsv_spt=1&rsv_iqid=0xc120da8600033643&issp=1&f=8&rsv_bp=0&rsv_idx=2&ie=utf-8&tn=baiduhome_pg&rsv_enter=1&rsv_sug3=25&rsv_sug1=23&rsv_sug7=101&rsv_t=f6eeifyefZw3OvDmGDksaL0zAJ7Ygn4%2BTczxjS%2Bt%2Fu1TviW0lBofeGe7FdGYL4s1cHOp\",\"prev\":\"https://www.baidu.com/\"}"}},"enabled":true,"position":10,"file_url":"https://greasyfork.org/scripts/37654-popup-blocker-script/code/Popup%20Blocker%20Script.user.js","uuid":"87e6cb60-e17b-475e-9f19-2591f291a103","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBQb3B1cCBCbG9ja2VyIFNjcmlwdAovLyBAbmFtZTp6aC1DTiAgIOW8ueeql+mYu+atoueoi+W6j+iEmuacrAovLyBAbmFtZXNwYWNlICAgIGh0dHBzOi8vcG9wdXBibG9ja2Vyc2NyaXB0LmNvbS8KLy8gQHZlcnNpb24gICAgICAwLjIKLy8gQGRlc2NyaXB0aW9uICBUaGUgbW9zdCBlZmZpY2llbnQgdXNlciBzY3JpcHQgZm9yIGJsb2NraW5nIHBvcHVwcyBvZiBhbGwgdHlwZXMuIERlc2lnbmVkIHRvIGZpZ2h0IHRoZSBzbmVha2llc3QgcG9wdXBzIGluY2x1ZGluZyB0aGUgb25lcyBvbiBhZHVsdCBhbmQgc3RyZWFtaW5nIHdlYnNpdGVzLgovLyBAZGVzY3JpcHRpb246emgtQ04g55So5LqO6Zi75q2i5omA5pyJ57G75Z6L5by556qX55qE5pyA5pyJ5pWI55So5oi36ISa5pys44CC5Li66Ziy6IyD5pyA54uh54y+55qE5by556qX6ICM6K6+6K6h77yM5YyF5ous5oiQ5Lq65ZKM5rWB5aqS5L2T572R56uZ5LiK55qE5by556qX44CCCi8vIEBhdXRob3IgICAgICAgTWlrZSBLeXNoZW5rbwovLyBAbWF0Y2ggICAgICAgIGh0dHBzOi8vKi8qCi8vIEBtYXRjaCAgICAgICAgaHR0cDovLyovKgovLyBAZ3JhbnQgR01fbGlzdFZhbHVlcwovLyBAZ3JhbnQgR01fZGVsZXRlVmFsdWUKLy8gQGdyYW50IEdNX3NldFZhbHVlCi8vIEBncmFudCBHTV9nZXRWYWx1ZQovLyBAZ3JhbnQgR01fZ2V0UmVzb3VyY2VVUkwKLy8gQGdyYW50IEdNX2dldFJlc291cmNlVGV4dAovLyBAZ3JhbnQgR01fYWRkU3R5bGUKLy8gQGdyYW50IEdNX3htbGh0dHBSZXF1ZXN0Ci8vIEBjb25uZWN0ICAgICByZS5wb3B1cGJsb2NrZXJzY3JpcHQuY29tCi8vIEBjb25uZWN0ICAgICBzZWxmCi8vIEBjb25uZWN0ICAgICAqCi8vIEByZXF1aXJlIGh0dHBzOi8vYWpheC5nb29nbGVhcGlzLmNvbS9hamF4L2xpYnMvanF1ZXJ5LzMuMi4xL2pxdWVyeS5taW4uanMKLy8gPT0vVXNlclNjcmlwdD09CmNvbnN0IExBTkcgPSB7CiAgICBFTjogewogICAgICAgICJub3RpZmljYXRpb25NZXNzYWdlIjogewogICAgICAgICAgICAibWVzc2FnZSI6ICJQb3B1cCBCbG9ja2VkIgogICAgICAgIH0sCiAgICAgICAgIm92ZXJsYXlXYXNCbG9ja2VkIjogewogICAgICAgICAgICAibWVzc2FnZSI6ICJPdmVybGF5IEJsb2NrZWQiCiAgICAgICAgfSwKICAgICAgICAiYWxsb3dPbmNlIjogewogICAgICAgICAgICAibWVzc2FnZSI6ICJTaG93IHBvcHVwIG9uY2UiCiAgICAgICAgfSwKICAgICAgICAiYWxsb3dBbHdheXMiOiB7CiAgICAgICAgICAgICJtZXNzYWdlIjogIldoaXRlbGlzdCB0aGlzIHNpdGUiCiAgICAgICAgfSwKICAgICAgICAiTlRGX2FsbG93T3ZlcmxheU9uY2UiOiB7CiAgICAgICAgICAgICJtZXNzYWdlIjogIkFsbG93IG92ZXJsYXkgb25jZSIKICAgICAgICB9CiAgICB9LAogIAogICAgIkNOIjp7CiAgICAgICAgIm5vdGlmaWNhdGlvbk1lc3NhZ2UiOiB7CiAgICAgICAgICAgICJtZXNzYWdlIjogIuW8ueeql+iiq+mYu+atoiIKICAgICAgICB9LAogICAgICAgICJvdmVybGF5V2FzQmxvY2tlZCI6IHsKICAgICAgICAgICAgIm1lc3NhZ2UiOiAi5Y+g5Yqg5by556qX6KKr6Zi75q2iIgogICAgICAgIH0sCiAgICAgICAgImFsbG93T25jZSI6IHsKICAgICAgICAgICAgIm1lc3NhZ2UiOiAi5pi+56S65LiA5qyh5by556qXIgogICAgICAgIH0sCiAgICAgICAgImFsbG93QWx3YXlzIjogewogICAgICAgICAgICAibWVzc2FnZSI6ICLlhYHorrjmraTnvZHnq5nkuIrnmoTlvLnnqpciCiAgICAgICAgfSwKICAgICAgICAiTlRGX2FsbG93T3ZlcmxheU9uY2UiOiB7CiAgICAgICAgICAgICJtZXNzYWdlIjogIuaYvuekuuS4gOasoeW8ueeqlyIKICAgICAgICB9CiAgICB9CiAgfTsKICAvKioqKioqLyAoZnVuY3Rpb24obW9kdWxlcykgeyAvLyB3ZWJwYWNrQm9vdHN0cmFwCi8qKioqKiovIAkvLyBUaGUgbW9kdWxlIGNhY2hlCi8qKioqKiovIAl2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9OwoKLyoqKioqKi8gCS8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uCi8qKioqKiovIAlmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7CgovKioqKioqLyAJCS8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZQovKioqKioqLyAJCWlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKQovKioqKioqLyAJCQlyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0czsKCi8qKioqKiovIAkJLy8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSkKLyoqKioqKi8gCQl2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7Ci8qKioqKiovIAkJCWV4cG9ydHM6IHt9LAovKioqKioqLyAJCQlpZDogbW9kdWxlSWQsCi8qKioqKiovIAkJCWxvYWRlZDogZmFsc2UKLyoqKioqKi8gCQl9OwoKLyoqKioqKi8gCQkvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb24KLyoqKioqKi8gCQltb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTsKCi8qKioqKiovIAkJLy8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZAovKioqKioqLyAJCW1vZHVsZS5sb2FkZWQgPSB0cnVlOwoKLyoqKioqKi8gCQkvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZQovKioqKioqLyAJCXJldHVybiBtb2R1bGUuZXhwb3J0czsKLyoqKioqKi8gCX0KCgovKioqKioqLyAJLy8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXykKLyoqKioqKi8gCV9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7CgovKioqKioqLyAJLy8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGUKLyoqKioqKi8gCV9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7CgovKioqKioqLyAJLy8gX193ZWJwYWNrX3B1YmxpY19wYXRoX18KLyoqKioqKi8gCV9fd2VicGFja19yZXF1aXJlX18ucCA9ICIiOwoKLyoqKioqKi8gCS8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0cwovKioqKioqLyAJcmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oMCk7Ci8qKioqKiovIH0pCi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCi8qKioqKiovIChbCi8qIDAgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKCSd1c2Ugc3RyaWN0JzsKCglfX3dlYnBhY2tfcmVxdWlyZV9fKDEpOwoKLyoqKi8gfSksCi8qIDEgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKCSJ1c2Ugc3RyaWN0IjsKCgl2YXIgX292ZXJsYXlLaWxsZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIpOwoKCXZhciBfb3ZlcmxheUtpbGxlcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9vdmVybGF5S2lsbGVyKTsKCgl2YXIgX2luamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNSk7CgoJdmFyIF9udGZTaG93TWFuYWdlciA9IF9fd2VicGFja19yZXF1aXJlX18oNik7CgoJdmFyIF9udGZTaG93TWFuYWdlcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9udGZTaG93TWFuYWdlcik7CgoJdmFyIF9ub3RpZmljYXRpb24gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDcpOwoKCXZhciBfbm90aWZpY2F0aW9uMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX25vdGlmaWNhdGlvbik7CgoJdmFyIF9zdG9yYWdlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0KTsKCgl2YXIgX3N0b3JhZ2UyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfc3RvcmFnZSk7CgoJdmFyIF9jb25zdCA9IF9fd2VicGFja19yZXF1aXJlX18oOSk7CgoJdmFyIF9jb25zdDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9jb25zdCk7CgoJdmFyIF9hdHRyYWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMCk7CgoJdmFyIF9hdHRyYWN0MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2F0dHJhY3QpOwoKCXZhciBfdXRpbHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDgpOwoKCWZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9CgoJKGZ1bmN0aW9uICgkKSB7CgkgIEdNX2FkZFN0eWxlKCIucGItdG9hc3QtbWFpbiB7XHJcbiAgei1pbmRleDogMjE0NzQ4MzYzOSAhaW1wb3J0YW50O1xyXG4gIHBvc2l0aW9uOiBmaXhlZCAhaW1wb3J0YW50O1xyXG4gIHRvcDogLTUwcHggIWltcG9ydGFudDtcclxuICBsZWZ0OiAwcHggIWltcG9ydGFudDtcclxuICB3aWR0aDogMTAwJSAhaW1wb3J0YW50O1xyXG4gIGhlaWdodDogNDRweCAhaW1wb3J0YW50O1xyXG4gIGJvcmRlcjogbm9uZSAhaW1wb3J0YW50O1xyXG4gIGJveC1zaGFkb3c6IDAgMXB4IDAgMCAjYjZiNGI2ICFpbXBvcnRhbnQ7XHJcbiAgdHJhbnNpdGlvbjogdG9wIDAuM3M7XHJcbn1cclxuXHJcbi5wYi10b2FzdC1tYWluLW1vdmUge1xyXG4gIHRvcDogMHB4ICFpbXBvcnRhbnQ7XHJcbn1cclxuXHJcbi5wYi10b2FzdC1tYWluLXNob3cge1xyXG4gIHRyYW5zaXRpb246IG5vbmU7XHJcbiAgdG9wOiAwcHggIWltcG9ydGFudDtcclxufVxyXG5cclxuXHJcblxyXG4jcGJfanFfdGlwc1dyYXBwZXIge1xyXG4gIHBvc2l0aW9uOiBmaXhlZCAhaW1wb3J0YW50O1xyXG4gIHdpZHRoOiAyMzBweCAhaW1wb3J0YW50O1xyXG4gIGJhY2tncm91bmQtY29sb3I6IHJnYmEoMCwgMCwgMCwgMC44KTtcclxuICBib3gtc2hhZG93OiAwIDhweCAyMHB4IDAgcmdiYSgwLCAwLCAwLCAwLjIpO1xyXG4gIGZvbnQtZmFtaWx5OiBcIkx1Y2lkYSBHcmFuZGVcIiwgdGFob21hLCB2ZXJkYW5hLCBhcmlhbCwgc2Fucy1zZXJpZiAhaW1wb3J0YW50O1xyXG4gIGJvcmRlci1yYWRpdXM6IDVweCAhaW1wb3J0YW50O1xyXG4gIGNvbG9yOiAjZmZmZmZmICFpbXBvcnRhbnQ7XHJcbiAgei1pbmRleDogMjE0NzQ4MzY0MSAhaW1wb3J0YW50O1xyXG4gIHBhZGRpbmc6IDE1cHggIWltcG9ydGFudDtcclxuICBmb250LXNpemU6IDE0cHggIWltcG9ydGFudDtcclxufVxyXG5cclxuI3BiX2pxX3RpcHNXcmFwcGVyOmJlZm9yZSB7XHJcbiAgcG9zaXRpb246IGFic29sdXRlICFpbXBvcnRhbnQ7XHJcbiAgdG9wOiAtMTBweCAhaW1wb3J0YW50O1xyXG4gIHJpZ2h0OiA2MHB4ICFpbXBvcnRhbnQ7XHJcbiAgZGlzcGxheTogaW5saW5lLWJsb2NrICFpbXBvcnRhbnQ7XHJcbiAgYm9yZGVyLXJpZ2h0OiAxMHB4IHNvbGlkIHRyYW5zcGFyZW50ICFpbXBvcnRhbnQ7XHJcbiAgYm9yZGVyLWJvdHRvbTogMTBweCBzb2xpZCAjMDAwICFpbXBvcnRhbnQ7XHJcbiAgYm9yZGVyLWxlZnQ6IDEwcHggc29saWQgdHJhbnNwYXJlbnQgIWltcG9ydGFudDtcclxuICBib3JkZXItYm90dG9tLWNvbG9yOiByZ2JhKDAsIDAsIDAsIDAuMikgIWltcG9ydGFudDtcclxuICBjb250ZW50OiBcJ1wnICFpbXBvcnRhbnQ7XHJcbn1cclxuXHJcbiNwYl9qcV90aXBzV3JhcHBlcjphZnRlciB7XHJcbiAgcG9zaXRpb246IGFic29sdXRlICFpbXBvcnRhbnQ7XHJcbiAgdG9wOiAtOXB4ICFpbXBvcnRhbnQ7XHJcbiAgcmlnaHQ6IDYwcHggIWltcG9ydGFudDtcclxuICBkaXNwbGF5OiBpbmxpbmUtYmxvY2sgIWltcG9ydGFudDtcclxuICBib3JkZXItcmlnaHQ6IDlweCBzb2xpZCB0cmFuc3BhcmVudCAhaW1wb3J0YW50O1xyXG4gIGJvcmRlci1ib3R0b206IDlweCBzb2xpZCAjMDAwICFpbXBvcnRhbnQ7XHJcbiAgYm9yZGVyLWxlZnQ6IDlweCBzb2xpZCB0cmFuc3BhcmVudCAhaW1wb3J0YW50O1xyXG4gIGNvbnRlbnQ6IFwnXCcgIWltcG9ydGFudDtcclxufVxyXG5cclxuI3BiLWxpbmstY29waWVkLW1lc3NhZ2Uge1xyXG4gIGRpc3BsYXk6IG5vbmU7XHJcbiAgcG9zaXRpb246IGZpeGVkO1xyXG4gIHdpZHRoOiA5MHB4O1xyXG4gIGhlaWdodDogMjlweDtcclxuICBvcGFjaXR5OiAwO1xyXG4gIGJvcmRlci1yYWRpdXM6IDEwMHB4O1xyXG4gIGJhY2tncm91bmQtY29sb3I6IHJnYmEoMCwgMCwgMCwgMC43KTtcclxuICB6LWluZGV4OiAyMTQ3NDgzNjQxO1xyXG4gIGZvbnQtZmFtaWx5OiBcIkx1Y2lkYSBHcmFuZGVcIiwgdGFob21hLCB2ZXJkYW5hLCBhcmlhbCwgc2Fucy1zZXJpZiAhaW1wb3J0YW50O1xyXG4gIGZvbnQtc2l6ZTogMTNweDtcclxuICBsaW5lLWhlaWdodDogMjlweDtcclxuICB0ZXh0LWFsaWduOiBjZW50ZXI7XHJcbiAgY29sb3I6ICNmZmZmZmY7XHJcbn0iKTsKCgkgIHZhciBwYk1lc3NhZ2UgPSAoMCwgX3V0aWxzLnJhbmRJZCkoKTsKCgkgIHZhciBudGZTaG93TWFuYWdlciA9IG5ldyBfbnRmU2hvd01hbmFnZXIyLmRlZmF1bHQoKTsKCgkgIHZhciBub3RpZmljYXRpb24gPSBuZXcgX25vdGlmaWNhdGlvbjIuZGVmYXVsdCh7CgkgICAgb25EaXNwbGF5OiBmdW5jdGlvbiBvbkRpc3BsYXkoX3JlZikgewoJICAgICAgdmFyIHNvdXJjZSA9IF9yZWYuc291cmNlOwoKCSAgICAgIHN3aXRjaCAoc291cmNlKSB7CgkgICAgICAgIGNhc2UgJ3BvcHVwLWJsb2NrZWQnOgoJICAgICAgICAgIC8vc2VuZEdvb2dsZUFuYWx5dGljc0V2ZW50KHtjYXRlZ29yeTogJ05vdGlmaWNhdGlvbl9iYXInLCBhY3Rpb246ICdTaG93bid9KTsKCSAgICAgICAgICBicmVhazsKCgkgICAgICAgIGNhc2UgJ3JlY2lwZS1ibG9ja2VkJzoKCSAgICAgICAgICAvL3NlbmRHb29nbGVBbmFseXRpY3NFdmVudCh7Y2F0ZWdvcnk6ICdOb3RpZmljYXRpb25fYmFyX292ZXJsYXknLCBhY3Rpb246ICdTaG93bid9KTsKCSAgICAgICAgICBicmVhazsKCSAgICAgIH0KCSAgICB9LAoJICAgIG9uQ2xvc2VDbGljazogZnVuY3Rpb24gb25DbG9zZUNsaWNrKF9yZWYyKSB7CgkgICAgICB2YXIgc291cmNlID0gX3JlZjIuc291cmNlOwoKCSAgICAgIHN3aXRjaCAoc291cmNlKSB7CgkgICAgICAgIGNhc2UgJ3BvcHVwLWJsb2NrZWQnOgoJICAgICAgICAgIC8vc2VuZEdvb2dsZUFuYWx5dGljc0V2ZW50KHtjYXRlZ29yeTogJ05vdGlmaWNhdGlvbl9iYXInLCBhY3Rpb246ICdDbGljaycsIGxhYmVsOiAnQ2xvc2UnLCBkb21haW46IGRvY3VtZW50LmRvbWFpbiB9KTsKCSAgICAgICAgICBicmVhazsKCgkgICAgICAgIGNhc2UgJ3JlY2lwZS1ibG9ja2VkJzoKCSAgICAgICAgICAvL3NlbmRHb29nbGVBbmFseXRpY3NFdmVudCh7Y2F0ZWdvcnk6ICdOb3RpZmljYXRpb25fYmFyX292ZXJsYXknLCBhY3Rpb246ICdDbGljaycsIGxhYmVsOiAnQ2xvc2UnfSk7CgkgICAgICAgICAgYnJlYWs7CgkgICAgICB9CgkgICAgfSwKCSAgICBvbkJ1dHRvbkNsaWNrOiBmdW5jdGlvbiBvbkJ1dHRvbkNsaWNrKF9yZWYzKSB7CgkgICAgICB2YXIgc291cmNlID0gX3JlZjMuc291cmNlLAoJICAgICAgICAgIGlkID0gX3JlZjMuaWQ7CgoJICAgICAgc3dpdGNoIChzb3VyY2UpIHsKCSAgICAgICAgY2FzZSAncG9wdXAtYmxvY2tlZCc6CgkgICAgICAgICAgc3dpdGNoIChpZCkgewoJICAgICAgICAgICAgY2FzZSAnYWxsb3dPbmNlJzoKCSAgICAgICAgICAgICAgLy9zZW5kR29vZ2xlQW5hbHl0aWNzRXZlbnQoe2NhdGVnb3J5OiAnTm90aWZpY2F0aW9uX2JhcicsIGFjdGlvbjogJ0NsaWNrJywgbGFiZWw6ICdBbGxvdyBvbmNlJ30pOwoJICAgICAgICAgICAgICBicmVhazsKCgkgICAgICAgICAgICBjYXNlICdhbGxvd0Fsd2F5cyc6CgkgICAgICAgICAgICAgIC8vc2VuZEdvb2dsZUFuYWx5dGljc0V2ZW50KHtjYXRlZ29yeTogJ05vdGlmaWNhdGlvbl9iYXInLCBhY3Rpb246ICdDbGljaycsIGxhYmVsOiAnQWxsb3cgYWx3YXlzJ30pOwoJICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICB9CgkgICAgICAgICAgYnJlYWs7CgoJICAgICAgICBjYXNlICdyZWNpcGUtYmxvY2tlZCc6CgkgICAgICAgICAgc3dpdGNoIChpZCkgewoJICAgICAgICAgICAgY2FzZSAnTlRGX2FsbG93T3ZlcmxheU9uY2UnOgoJICAgICAgICAgICAgICAvL3NlbmRHb29nbGVBbmFseXRpY3NFdmVudCh7Y2F0ZWdvcnk6ICdOb3RpZmljYXRpb25fYmFyX292ZXJsYXknLCBhY3Rpb246ICdDbGljaycsIGxhYmVsOiAnQWxsb3cgb25jZSd9KTsKCSAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgfQoJICAgICAgICAgIGJyZWFrOwoJICAgICAgfQoJICAgIH0KCSAgfSk7CgoJICB2YXIgb3ZlcmxheUtpbGxlciA9IG5ldyBfb3ZlcmxheUtpbGxlcjIuZGVmYXVsdCh7CgkgICAgb25SZWNpcGVGb3VuZDogZnVuY3Rpb24gb25SZWNpcGVGb3VuZChfcmVmNCkgewoJICAgICAgdmFyIGZvdW5kID0gX3JlZjQuZm91bmQ7CgoJICAgICAgbnRmU2hvd01hbmFnZXIuaXNTaG93KHsgZG9tYWluOiBkb2N1bWVudC5kb21haW4sIHR5cGU6ICdvdmVybGF5JyB9KS50aGVuKGZ1bmN0aW9uICgpIHsKCSAgICAgICAgc2hvd1JlY2lwZU92ZXJsYXlOb3J0aWZpY2F0aW9uKCk7CgkgICAgICB9KTsKCSAgICB9CgkgIH0pOwoKCSAgdmFyIHJlY2VpdmVkUmVjaXBlcyA9IGZ1bmN0aW9uIHJlY2VpdmVkUmVjaXBlcyhkYXRhKSB7CgkgICAgdmFyIHJlY2VwaWVzID0gKGRhdGEgfHwge30pLnJlY2lwZXMgfHwgW107CgoJICAgIGlmIChyZWNlcGllcy5sZW5ndGgpIHsKCSAgICAgIG92ZXJsYXlLaWxsZXIuY3JlYXRlQmxvY2tMaXN0RnJvbVJlY2VwaWVzKHJlY2VwaWVzKTsKCSAgICB9CgkgIH07CgoJICBwYXJzZVBlbmRpbmdOb3RpZmljYXRpb25QYXJhbXMoKTsKCgkgIGZ1bmN0aW9uIG1vbml0b3JCbG9ja3MoKSB7CgkgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCBmdW5jdGlvbiByZWNlaXZlTWVzc2FnZShldmVudCkgewoJICAgICAgaWYgKGV2ZW50LmRhdGEudHlwZSAmJiBldmVudC5kYXRhLnR5cGUgPT0gImJsb2NrZWRXaW5kb3ciKSB7CgkgICAgICAgIGlmIChzZWxmICE9PSB0b3ApIHsKCSAgICAgICAgICAvL3Bhc3MgdGhlIG1lc3NhZ2UgdG8gcGFyZW50CgkgICAgICAgICAgdmFyIHBhcmVudE9yaWdpbiA9IHdpbmRvdy5sb2NhdGlvbiAhPSB3aW5kb3cucGFyZW50LmxvY2F0aW9uID8gZG9jdW1lbnQucmVmZXJyZXIgOiBkb2N1bWVudC5sb2NhdGlvbjsKCSAgICAgICAgICBwYXJlbnQucG9zdE1lc3NhZ2UoeyB0eXBlOiAiYmxvY2tlZFdpbmRvdyIsIGFyZ3M6IGV2ZW50LmRhdGEuYXJncyB9LCBwYXJlbnRPcmlnaW4pOwoJICAgICAgICAgIHJldHVybjsKCSAgICAgICAgfQoKCSAgICAgICAgdmFyIGFyZ3MgPSBKU09OLnBhcnNlKGV2ZW50LmRhdGEuYXJncyk7CgoJICAgICAgICBudGZTaG93TWFuYWdlci5pc1Nob3coeyBkb21haW46IGRvY3VtZW50LmRvbWFpbiB9KS50aGVuKGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICBzaG93UG9wdXBCbG9ja2VkTm90aWZpY2F0aW9uKGFyZ3MsIHsgZG9tYWluOiBkb2N1bWVudC5kb21haW4gfSk7CgkgICAgICAgIH0pOwoKCSAgICAgICAgaWYgKG50ZlNob3dNYW5hZ2VyLmlzQWN0aXZlKSB7CgkgICAgICAgICAgc2V0UGVuZGluZ05vdGlmaWNhdGlvblBhcmFtcyhhcmdzKTsKCSAgICAgICAgfQoKCSAgICAgICAgLy9zZW5kR29vZ2xlQW5hbHl0aWNzRXZlbnQoe2NhdGVnb3J5OiAiR2VuZXJhbCIsIGFjdGlvbjogIkJsb2NrZWRfcG9wdXBzIiwgbGFiZWw6IGRvY3VtZW50LmRvbWFpbn0pOwoJICAgICAgfQoJICAgIH0sIGZhbHNlKTsKCSAgfQoKCSAgLy9zaG93IG5vdGlmY2F0aW9uIGFmdGVyIGEgZm9yY2UgcmVkaXJlY3Qgb2YgYSBzaXRlCgkgIC8vZXZlcnkgdGltZSBhIHBvcHVwIGlzIGJlaW5nIGJsb2NrIHRoaXMgZnVuY3Rpb24gcnVucwoJICAvL2FyZ3MgPSBwb3B1cCBkZXRhaWxzICh1cmwsIG5hbWUsIHByb3BzKQoJICBmdW5jdGlvbiBzZXRQZW5kaW5nTm90aWZpY2F0aW9uUGFyYW1zKGFyZ3MpIHsKCSAgICB2YXIgcG9wID0gKGFyZ3NbMF0gfHwgJycpICsgInwiICsgKGFyZ3NbMV0gfHwgJycpICsgInwiICsgKGFyZ3NbMl0gfHwgJycpOwoJICAgIHZhciByZWxhdGVkTGluayA9IGFyZ3NbM10gfHwgJyc7CgkgICAgdmFyIGN1cnJlbnRIb3N0ID0gbG9jYXRpb24uaG9zdDsKCSAgICB2YXIgcG9wSG9zdCA9IG5ldyBVUkwoKDAsIF91dGlscy5nZXRBYnNvbHV0ZVVSTCkoYXJnc1swXSkpLmhvc3Q7CgkgICAgLy9jaGVjayBpZiB0aGUgcG9wdXAgaXMgdGhlIHNhbWUgaG9zdCB0aGF0IHRoZSBjdXJyZW50IGRvbWFpbgoJICAgIC8vdGhpcyBmbGFncyB0aGlzIGFzIGEgcG90ZW50aWFsIHBhdHRlcm4gb2Y6IG9wZW4gdGhlIHNpdGUncyBwYWdlIGFzIGEgcG9wdXAgYW5kIHJlZGlyZWN0IHRvIGFuIGFkCgkgICAgdmFyIGlzU2FtZUhvc3RQb3B1cCA9IHBvcEhvc3QgPT0gY3VycmVudEhvc3Q7CgkgICAgLy9jaGVjayBpZiBhZCBibG9jayBmb3VuZCAtIHRoaXMgbWFrZXMgc2l0ZXMgdG8gYmUgbW9yZSBhZ3JlZXNpdmUgd2l0aCBwb3B1cHMKCSAgICB2YXIgYWJkID0gYXJnc1snYWJkJ10gPyAxIDogMDsKCSAgICB2YXIgZGF0YSA9IHsKCSAgICAgIHBvcDogcG9wLAoJICAgICAgcmVsYXRlZExpbms6IHJlbGF0ZWRMaW5rLAoJICAgICAgaG9zdDogY3VycmVudEhvc3QsCgkgICAgICBpc1NhbWVIb3N0UG9wdXA6IGlzU2FtZUhvc3RQb3B1cCwKCSAgICAgIGFiZDogYWJkLAoJICAgICAgdGltZTogRGF0ZS5ub3coKQoJICAgIH07CgoJICAgIC8vc3RvcmUgaXQgYWxsIGluIHdpbmRvdy5uYW1lLCB0aGlzIHdpbGwgcmVtYWluIGV2ZW4gaWYgdGhlIHNpdGUgaXMgcmVkaXJlY3RlZAoJICAgIHdpbmRvdy5uYW1lID0gInBwX3BlbmRpbmdfbnRmOiIgKyBidG9hKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKCgkgICAgLy90byBwcmV2ZW50IGEgZmFsc2UgcG9zaXRpdmUKCSAgICAvL2lmIHNhbWUgdXJsIHBvcHVwIGlzIGRldGVjdGVkIGFuZCB0aGUgdXNlciBjcmVhdGVzIGEgInJlZGlyZWN0IgoJICAgIC8vYnkgY2xpY2tpbmcgYSBsaW5rLCB0aGlzIHNob3VsZCBwcmV2ZW50IHRvIHNlbmQgdGhlIHVzZXIgYmFjayB0byB0aGUgb3JpZ2luIHNpdGUKCSAgICBpZiAoZGF0YS5pc1NhbWVIb3N0UG9wdXApIHsKCSAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7CgkgICAgICAgIGlmIChlLnRhcmdldC5ub2RlTmFtZSA9PSAnQScpIHsKCSAgICAgICAgICByZW1vdmVQZW5kaW5nTm90aWZpY2F0aW9uUGFyYW1zKCk7CgkgICAgICAgIH0KCSAgICAgIH0pOwoJICAgIH0KCSAgfQoKCSAgLy90aGlzIHJ1bnMgb24gZXZlcnkgcGFnZSBsb2FkIAoJICBmdW5jdGlvbiBwYXJzZVBlbmRpbmdOb3RpZmljYXRpb25QYXJhbXMoKSB7CgkgICAgaWYgKHdpbmRvdy5uYW1lICYmIHdpbmRvdy5uYW1lLmluZGV4T2YoJ3BwX3BlbmRpbmdfbnRmOicpID09IDApIHsKCSAgICAgIHZhciBkYXRhID0gSlNPTi5wYXJzZShhdG9iKG5hbWUuc3BsaXQoJzonKVsxXSkpOwoJICAgICAgdmFyIGZuUmVtb3ZlID0gZnVuY3Rpb24gZm5SZW1vdmUoKSB7CgkgICAgICAgIHJlbW92ZVBlbmRpbmdOb3RpZmljYXRpb25QYXJhbXMoKTsKCgkgICAgICAgICQoZG9jdW1lbnQpLm9mZignY2xpY2snLCBmblJlbW92ZSk7CgkgICAgICB9OwoKCSAgICAgIC8vbWF4IDUwMDAgbXMgYmV0d2VlbiBwb3B1cCBibG9jayBhbmQgcGFnZSBsb2FkCgkgICAgICBpZiAoZGF0YS50aW1lICsgNTAwMCA+PSBEYXRlLm5vdygpKSB7CgkgICAgICAgIC8vZm9yY2UgZGlzcGxheSB0aGUgbm90aWZpY2F0aW9uCgkgICAgICAgIGlmIChkYXRhLmRpc3BsYXkpIHsKCSAgICAgICAgICBudGZTaG93TWFuYWdlci5pc1Nob3coeyBkb21haW46IGRvY3VtZW50LmRvbWFpbiB9KS50aGVuKGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgIHNob3dQb3B1cEJsb2NrZWROb3RpZmljYXRpb24oZGF0YS5wb3Auc3BsaXQoJ3wnKSwgeyBwcmV2ZW50RGlzcGxheUV2ZW50OiB0cnVlLCBxdWlja09wZW46IHRydWUsIGRvbWFpbjogZG9jdW1lbnQuZG9tYWluIH0pOwoJICAgICAgICAgIH0pOwoKCSAgICAgICAgICByZW1vdmVQZW5kaW5nTm90aWZpY2F0aW9uUGFyYW1zKCk7CgkgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgdmFyIGlzRXh0ZXJuYWxTaXRlID0gZmFsc2U7CgoJICAgICAgICAgIGlmIChkYXRhLmhvc3QgIT0gbG9jYXRpb24uaG9zdCkgewoJICAgICAgICAgICAgaXNFeHRlcm5hbFNpdGUgPSB0cnVlOwoJICAgICAgICAgIH0KCgkgICAgICAgICAgLy9zZWxmIHBvcHVwICsgcmVkaXJlY3QgcGF0dGVybiAtIHJldHVybiB1c2VyIHRvIHRoZSBwb3B1cCB1cmwgYW5kIGJsb2NrIHRoZSByZWRpcmVjdGVkIHNpdGUKCSAgICAgICAgICBpZiAoaXNFeHRlcm5hbFNpdGUgJiYgZGF0YS5hYmQpIHsKCSAgICAgICAgICAgIHZhciB1cmwgPSBkYXRhLnBvcC5zcGxpdCgnfCcpWzBdOwoKCSAgICAgICAgICAgIGlmIChkYXRhLmlzU2FtZUhvc3RQb3B1cCkgewoJICAgICAgICAgICAgICBzZXRTaW5nbGVEaXNwbGF5Tm90aWZpY2F0aW9uUGFyYW1zKCk7CgoJICAgICAgICAgICAgICBsb2NhdGlvbi5ocmVmID0gdXJsOwoJICAgICAgICAgICAgfSBlbHNlIGlmICgvXmFib3V0OmJsYW5rL2kudGVzdCh1cmwpICYmIGRhdGEucmVsYXRlZExpbmspIHsKCSAgICAgICAgICAgICAgc2V0U2luZ2xlRGlzcGxheU5vdGlmaWNhdGlvblBhcmFtcygpOwoKCSAgICAgICAgICAgICAgbG9jYXRpb24uaHJlZiA9IGRhdGEucmVsYXRlZExpbms7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgIG50ZlNob3dNYW5hZ2VyLmlzU2hvdyh7IGRvbWFpbjogaXNFeHRlcm5hbFNpdGUgPyBkYXRhLmhvc3QgOiBkb2N1bWVudC5kb21haW4gfSkudGhlbihmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICAgIHNob3dQb3B1cEJsb2NrZWROb3RpZmljYXRpb24oZGF0YS5wb3Auc3BsaXQoJ3wnKSwgeyBwcmV2ZW50RGlzcGxheUV2ZW50OiB0cnVlLCBxdWlja09wZW46IHRydWUsIGRvbWFpbjogaXNFeHRlcm5hbFNpdGUgPyBkYXRhLmhvc3QgOiBkb2N1bWVudC5kb21haW4gfSk7CgkgICAgICAgICAgICB9KTsKCgkgICAgICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCBmblJlbW92ZSk7CgkgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICB9IGVsc2UgewoJICAgICAgICByZW1vdmVQZW5kaW5nTm90aWZpY2F0aW9uUGFyYW1zKCk7CgkgICAgICB9CgkgICAgfQoJICB9CgoJICBmdW5jdGlvbiBzZXRTaW5nbGVEaXNwbGF5Tm90aWZpY2F0aW9uUGFyYW1zKCkgewoJICAgIHZhciBkYXRhID0gewoJICAgICAgcG9wOiBsb2NhdGlvbi5ocmVmICsgJ3x8JywKCSAgICAgIGRpc3BsYXk6IHRydWUsCgkgICAgICB0aW1lOiBEYXRlLm5vdygpCgkgICAgfTsKCgkgICAgd2luZG93Lm5hbWUgPSAncHBfcGVuZGluZ19udGY6JyArIGJ0b2EoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwoJICB9CgoJICBmdW5jdGlvbiByZW1vdmVQZW5kaW5nTm90aWZpY2F0aW9uUGFyYW1zKCkgewoJICAgIGlmICh3aW5kb3cubmFtZSAmJiB3aW5kb3cubmFtZS5pbmRleE9mKCJwcF9wZW5kaW5nX250ZjoiKSA9PSAwKSB7CgkgICAgICB3aW5kb3cubmFtZSA9ICIiOwoJICAgIH0KCSAgfQoKCSAgLy9wb3B1cCBibG9ja2VkIG5vdGlmaWNhdGlvbgoJICBmdW5jdGlvbiBzaG93UG9wdXBCbG9ja2VkTm90aWZpY2F0aW9uKGFyZ3MpIHsKCSAgICB2YXIgcHJvcHMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9OwoKCSAgICB2YXIgZG9tYWluID0gcHJvcHMuZG9tYWluOwoKCSAgICBub3RpZmljYXRpb24uc2hvdyh7CgkgICAgICB0aXRsZTogKDAsIF91dGlscy5nZXRJMThOKSgnbm90aWZpY2F0aW9uTWVzc2FnZScpLAoJICAgICAgcXVpY2tPcGVuOiBwcm9wcy5xdWlja09wZW4sCgkgICAgICBzaG93SGlkZTogdHJ1ZSwKCSAgICAgIHNob3dSZXNpemU6IHRydWUsCgkgICAgICBzb3VyY2U6ICdwb3B1cC1ibG9ja2VkJywKCSAgICAgIHdpbkFyZ3M6IGFyZ3MsIC8vcG9wIHVybCAvIG5hbWUgLyB3aWR0aCArIGhlaWdodAoJICAgICAgb25DbG9zZTogZnVuY3Rpb24gb25DbG9zZSgpIHsKCSAgICAgICAgcmVtb3ZlUGVuZGluZ05vdGlmaWNhdGlvblBhcmFtcygpOwoJICAgICAgfSwKCgkgICAgICBidXR0b25zOiB7CgkgICAgICAgIGFsbG93T25jZTogZnVuY3Rpb24gYWxsb3dPbmNlKCkgewoJICAgICAgICAgIG50ZlNob3dNYW5hZ2VyLmlzQWN0aXZlID0gdHJ1ZTsKCSAgICAgICAgfSwKCSAgICAgICAgYWxsb3dBbHdheXM6IGZ1bmN0aW9uIGFsbG93QWx3YXlzKCkgewoJICAgICAgICAgIF9zdG9yYWdlMi5kZWZhdWx0LmdldCgncGJfd2hpdGVsaXN0JykudGhlbihmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICB2YXIgd2hpdGVsaXN0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBbXTsKCgkgICAgICAgICAgICB3aGl0ZWxpc3QucHVzaChkb21haW4pOwoKCSAgICAgICAgICAgIF9zdG9yYWdlMi5kZWZhdWx0LnNldCgncGJfd2hpdGVsaXN0Jywgd2hpdGVsaXN0KTsKCSAgICAgICAgICB9KTsKCgkgICAgICAgICAgaWYgKCFwcm9wcy5pc0V4dGVybmFsU2l0ZSkgewoJICAgICAgICAgICAgKDAsIF91dGlscy5leGVjdXRlQ29kZSkoIndpbmRvdy5wYkV4dGVybmFsQ29tbWFuZCgwLCBcIiIgKyBwYk1lc3NhZ2UgKyAiXCIpOyIpOwoJICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgfQoJICAgIH0pOwoJICB9CgoJICAvL2FuIG92ZXJsYXkgYmxvY2tlZCBieSByZWNpcGUgbm90aWZpY2F0aW9uCgkgIGZ1bmN0aW9uIHNob3dSZWNpcGVPdmVybGF5Tm9ydGlmaWNhdGlvbigpIHsKCSAgICBub3RpZmljYXRpb24uc2hvdyh7CgkgICAgICB0aXRsZTogKDAsIF91dGlscy5nZXRJMThOKSgib3ZlcmxheVdhc0Jsb2NrZWQiKSwKCSAgICAgIHNvdXJjZTogJ3JlY2lwZS1ibG9ja2VkJywKCSAgICAgIHNob3dIaWRlOiB0cnVlLAoJICAgICAgc2hvd1Jlc2l6ZTogdHJ1ZSwKCSAgICAgIGJ1dHRvbnM6IHsKCSAgICAgICAgTlRGX2FsbG93T3ZlcmxheU9uY2U6IGZ1bmN0aW9uIE5URl9hbGxvd092ZXJsYXlPbmNlKCkgewoJICAgICAgICAgIG92ZXJsYXlLaWxsZXIucmVzdG9yZSgpOwoJICAgICAgICB9CgkgICAgICB9CgkgICAgfSk7CgkgIH0KCgkgIGZ1bmN0aW9uIHNlbmRHb29nbGVBbmFseXRpY3NFdmVudChkYXRhKSB7CgkgICAgdmFyIF9kYXRhJGRvbWFpbiA9IGRhdGEuZG9tYWluLAoJICAgICAgICBkb21haW4gPSBfZGF0YSRkb21haW4gPT09IHVuZGVmaW5lZCA/IGRvY3VtZW50LmRvbWFpbiA6IF9kYXRhJGRvbWFpbjsKCgoJICAgIHNlbmRNZXNzYWdlVG9CYWNrZ3JvdW5kKHsKCSAgICAgIG5hbWU6ICJ0cmFja0V2ZW50IiwKCSAgICAgIGNhdGVnb3J5OiBkYXRhLmNhdGVnb3J5LAoJICAgICAgYWN0aW9uOiBkYXRhLmFjdGlvbiwKCSAgICAgIGxhYmVsOiBkYXRhLmxhYmVsLAoJICAgICAgaXNDb3VudDogZGF0YS5pc0NvdW50LAoJICAgICAgZG9tYWluOiBkb21haW4KCSAgICB9KTsKCSAgfQoKCSAgZnVuY3Rpb24gaW5pdEJsb2NrRnVuY3Rpb25zKCkgewoJICAgIF9zdG9yYWdlMi5kZWZhdWx0LmdldCgncGJfd2hpdGVsaXN0JywgJ3BiX292ZXJsYXlsaXN0JywgJ3BiX3BvcHVwQmxhY2tMaXN0JykudGhlbihmdW5jdGlvbiAoc2V0dGluZ3MpIHsKCSAgICAgIHNldHRpbmdzLnBiX3doaXRlbGlzdCA9IHNldHRpbmdzLnBiX3doaXRlbGlzdCB8fCBbXTsKCSAgICAgIHNldHRpbmdzLnBiX292ZXJsYXlsaXN0ID0gc2V0dGluZ3MucGJfb3ZlcmxheWxpc3QgfHwgW107CgkgICAgICBzZXR0aW5ncy5wYl9wb3B1cEJsYWNrTGlzdCA9IHNldHRpbmdzLnBiX3BvcHVwQmxhY2tMaXN0IHx8IFtdOwoKCSAgICAgIHZhciB3aGl0ZWxpc3QgPSBzZXR0aW5ncy5wYl93aGl0ZWxpc3QuY29uY2F0KF9jb25zdDIuZGVmYXVsdC5kZWZhdWx0V2hpdGVMaXN0KTsKCgkgICAgICBpZiAoISgwLCBfdXRpbHMuaXNEb21haW5Jbkxpc3QpKGRvY3VtZW50LmRvbWFpbiwgd2hpdGVsaXN0KSkgewoJICAgICAgICB2YXIgY29kZSA9ICIoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHZhciBwYl9tZXNzYWdlID0gXCIiICsgcGJNZXNzYWdlICsgIlwiO1xuICAgICAgICAgIHZhciBwYl9ibGFja2xpc3QgPSAiICsgSlNPTi5zdHJpbmdpZnkoc2V0dGluZ3MucGJfcG9wdXBCbGFja0xpc3QpICsgIjtcbiAgICAgICAgICB2YXIgcGJfd2hpdGVsaXN0ID0gIiArIEpTT04uc3RyaW5naWZ5KHdoaXRlbGlzdCkgKyAiO1xuICAgICAgICAgICIgKyBfaW5qZWN0LmluamVjdC50b1N0cmluZygpICsgIjtcbiAgICAgICAgICBpbmplY3QoKTtcbiAgICAgICAgfSkoKTsiOwoKCSAgICAgICAgKDAsIF91dGlscy5leGVjdXRlQ29kZSkoY29kZSk7CgoJICAgICAgICAvKmFkZFNjcmlwdCh7dGV4dENvbnRlbnQ6IGAke2luamVjdC50b1N0cmluZygpfWAsIGlkOiAicGJfYmxvY2tTY3JpcHQifSk7CgkgICAgICAgIGV4ZWN1dGVDb2RlKCJ2YXIgcGJfYmxhY2tsaXN0ID0gIiArIEpTT04uc3RyaW5naWZ5KHNldHRpbmdzLnBiX3BvcHVwQmxhY2tMaXN0KSk7CgkgICAgICAgIGV4ZWN1dGVDb2RlKCJ2YXIgcGJfd2hpdGVsaXN0ID0gIiArIEpTT04uc3RyaW5naWZ5KHdoaXRlbGlzdCkpOwoJICAgICAgICBleGVjdXRlQ29kZSgiaW5qZWN0KCkiKTsqLwoJICAgICAgICBtb25pdG9yQmxvY2tzKCk7IC8vIFByZXZpb3VzbHkgdGhpcyBvbmx5IHJhbiBpZiB3aW5kb3cgPSBwYXJlbnQKCSAgICAgIH0KCSAgICB9KTsKCSAgfQoKCSAgaW5pdEJsb2NrRnVuY3Rpb25zKCk7CgoJICAvLyBibG9ja2luZyBwb3B1cHMgLSBTVEFSVAoJICBfc3RvcmFnZTIuZGVmYXVsdC5nZXQoJ3BiX3doaXRlbGlzdCcpLnRoZW4oZnVuY3Rpb24gKCkgewoJICAgIHZhciB3aGl0ZWxpc3QgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IFtdOwoJICAgIC8vZ2V0IHdoaXRlbGlzdAoJICAgIHdoaXRlbGlzdCA9IHdoaXRlbGlzdC5jb25jYXQoX2NvbnN0Mi5kZWZhdWx0LmRlZmF1bHRXaGl0ZUxpc3QpOwoKCSAgICBpZiAoISgwLCBfdXRpbHMuaXNEb21haW5Jbkxpc3QpKGRvY3VtZW50LmRvbWFpbiwgd2hpdGVsaXN0KSkgewoJICAgICAgLy9pZiBub3QgaW4gdGhlIHdoaXRlbGlzdAoJICAgICAgJCgiaHRtbCIpLm9uKCJjbGljayIsICJhIiwgb25IeXBlckxpbmtDbGlja2VkKTsgLy8gbGlzdGVuIHRvIGFsbCBsaW5rIGVsZW1lbnRzJ3MgY2xpY2sgZXZlbnQKCSAgICB9CgkgIH0pOwoKCSAgZnVuY3Rpb24gaXNPdmVybGF5aXNoKGVsKSB7CgkgICAgdmFyIHdpbldpZHRoID0gd2luZG93LmlubmVyV2lkdGg7CgkgICAgdmFyIHdpbkhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDsKCgkgICAgaWYgKGVsLm91dGVyV2lkdGgoKSA+PSB3aW5XaWR0aCAqIDAuNiAmJiBlbC5vdXRlckhlaWdodCgpID49IHdpbkhlaWdodCAqIDAuNzUpIHsKCSAgICAgIHJldHVybiB0cnVlOwoJICAgIH0KCgkgICAgcmV0dXJuIGZhbHNlOwoJICB9CgoJICBmdW5jdGlvbiBvbkh5cGVyTGlua0NsaWNrZWQoZSkgewoJICAgIHZhciBlbCA9ICQodGhpcyk7CgkgICAgdmFyIGhyZWYgPSBlbC5hdHRyKCdocmVmJyk7CgkgICAgdmFyIHRhcmdldCA9IGVsLmF0dHIoJ3RhcmdldCcpIHx8ICdfc2VsZic7CgoJICAgIGlmIChocmVmICYmIGhyZWYgIT09ICcjJyAmJiB0YXJnZXQgIT09ICdfc2VsZicpIHsKCSAgICAgIC8vb25seSBpZiBoYXMgaHJlZiBhbmQgb3BlbiBpbiBuZXcgdGFiL3dpbmRvdwoJICAgICAgaWYgKGlzT3ZlcmxheWlzaChlbCkpIHsKCSAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwoKCSAgICAgICAgcGFyZW50LnBvc3RNZXNzYWdlKHsKCSAgICAgICAgICB0eXBlOiAiYmxvY2tlZFdpbmRvdyIsCgkgICAgICAgICAgYXJnczogSlNPTi5zdHJpbmdpZnkoeyAiMCI6IGhyZWYgfSkKCSAgICAgICAgfSwgd2luZG93LnBhcmVudC5sb2NhdGlvbik7CgkgICAgICB9CgkgICAgfQoJICB9CgkgIC8vIGJsb2NraW5nIHBvcHVwcyAtIEVORAoKCSAgZnVuY3Rpb24gb3BlblVybCh1cmwsIG5vdE5ld1RhYikgewoJICAgIHNlbmRNZXNzYWdlVG9CYWNrZ3JvdW5kKHsgbmFtZTogIm9wZW5VcmwiLCB1cmw6IHVybCwgbm90TmV3VGFiOiBub3ROZXdUYWIgfSk7CgkgIH0KCgkgIC8vI1RFTVAKCSAgKGZ1bmN0aW9uICgpIHsKCSAgICAoMCwgX2F0dHJhY3QyLmRlZmF1bHQpKGZ1bmN0aW9uIChkKSB7CgkgICAgICAvKmNvbnNvbGUubG9nKHR5cGVvZiBkLCBkKTsqL3JlY2VpdmVkUmVjaXBlcyhkKTsKCSAgICB9KTsKCSAgfSkoKTsKCX0pKGpRdWVyeS5ub0NvbmZsaWN0KHRydWUpKTsKCgkvKmlmICh3aW5kb3cgPT0gdG9wKSB7CgkgIHNldFRpbWVvdXQoKCkgPT57CgkgICAgd2luZG93Lm9uZm9jdXMgPSAoKSA9PnsKCSAgICAgIHNlbmRNZXNzYWdlVG9CYWNrZ3JvdW5kKHtuYW1lOiAicGFnZSIsIHVybDogd2luZG93LmxvY2F0aW9uLmhyZWZ9KTsKCSAgICB9OwoJICB9LCAyMDAwKTsKCgkgIHdpbmRvdy5vbmJlZm9yZXVubG9hZCA9ICgpID0+ewoJICAgIHNlbmRNZXNzYWdlVG9CYWNrZ3JvdW5kKHtuYW1lOiAicGFnZUNsb3NpbmciLCB1cmw6IHdpbmRvdy5sb2NhdGlvbi5ocmVmfSk7CgkgICAgcmV0dXJuIG51bGw7CgkgIH07Cgl9CgoJZnVuY3Rpb24gc2VuZE1lc3NhZ2VUb0JhY2tncm91bmQobWVzc2FnZSl7CgkgIGNocm9tZS5ydW50aW1lLnNlbmRNZXNzYWdlKG1lc3NhZ2UpOwoJfSovCgovKioqLyB9KSwKLyogMiAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoJJ3VzZSBzdHJpY3QnOwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKCSAgdmFsdWU6IHRydWUKCX0pOwoKCXZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpOwoKCXZhciBfalF1ZXJ5ID0gX193ZWJwYWNrX3JlcXVpcmVfXygzKTsKCgl2YXIgX2pRdWVyeTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9qUXVlcnkpOwoKCXZhciBfc3RvcmFnZSA9IF9fd2VicGFja19yZXF1aXJlX18oNCk7CgoJdmFyIF9zdG9yYWdlMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3N0b3JhZ2UpOwoKCWZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9CgoJZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikgeyBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSB7IGZvciAodmFyIGkgPSAwLCBhcnIyID0gQXJyYXkoYXJyLmxlbmd0aCk7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsgYXJyMltpXSA9IGFycltpXTsgfSByZXR1cm4gYXJyMjsgfSBlbHNlIHsgcmV0dXJuIEFycmF5LmZyb20oYXJyKTsgfSB9CgoJZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkgeyBpZiAoIXNlbGYpIHsgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTsgfSByZXR1cm4gY2FsbCAmJiAodHlwZW9mIGNhbGwgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSA/IGNhbGwgOiBzZWxmOyB9CgoJZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgIiArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH0KCglmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCgl2YXIgX1Byb21pc2UgPSB0eXBlb2YgUHJvbWlzZSA9PT0gJ3VuZGVmaW5lZCcgPyBfX3dlYnBhY2tfcmVxdWlyZV9fKCEoZnVuY3Rpb24gd2VicGFja01pc3NpbmdNb2R1bGUoKSB7IHZhciBlID0gbmV3IEVycm9yKCJDYW5ub3QgZmluZCBtb2R1bGUgXCJlczYtcHJvbWlzZVwiIik7IGUuY29kZSA9ICdNT0RVTEVfTk9UX0ZPVU5EJzsgdGhyb3cgZTsgfSgpKSkuUHJvbWlzZSA6IFByb21pc2U7CgoJdmFyIE92ZXJsYXlEZWN0ZWN0b3IgPSBmdW5jdGlvbiAoKSB7CgkgIGZ1bmN0aW9uIE92ZXJsYXlEZWN0ZWN0b3IoKSB7CgkgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIE92ZXJsYXlEZWN0ZWN0b3IpOwoKCSAgICB0aGlzLndpbldpZHRoID0gd2luZG93LmlubmVyV2lkdGg7CgkgICAgdGhpcy53aW5IZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7CgkgIH0KCgkgIF9jcmVhdGVDbGFzcyhPdmVybGF5RGVjdGVjdG9yLCBbewoJICAgIGtleTogJ0FMR08yJywKCSAgICB2YWx1ZTogZnVuY3Rpb24gQUxHTzIoX3JlZikgewoJICAgICAgdmFyIHggPSBfcmVmLngsCgkgICAgICAgICAgeSA9IF9yZWYueSwKCSAgICAgICAgICBtdyA9IF9yZWYubXcsCgkgICAgICAgICAgbWggPSBfcmVmLm1oOwoKCSAgICAgIHZhciBlbGVtZW50ID0gZG9jdW1lbnQuZWxlbWVudEZyb21Qb2ludCh4LCB5KTsKCSAgICAgIHZhciBvdmVybGF5ID0gdm9pZCAwOwoKCSAgICAgIGlmIChlbGVtZW50ICYmIHRoaXMubm90Um9vdEVsZW1lbnQoZWxlbWVudCkpIHsKCSAgICAgICAgZG8gewoJICAgICAgICAgIHZhciBpc092ZXJsYXlpc2ggPSB0aGlzLmlzT3ZlcmxheWlzaCh7IGVsOiBlbGVtZW50LCBtaW5XaWR0aDogbXcsIG1pbkhlaWdodDogbWggfSk7CgoJICAgICAgICAgIGlmIChpc092ZXJsYXlpc2gpIHsKCSAgICAgICAgICAgIG92ZXJsYXkgPSBlbGVtZW50OwoJICAgICAgICAgIH0KCgkgICAgICAgICAgZWxlbWVudCA9IGVsZW1lbnQucGFyZW50Tm9kZTsKCSAgICAgICAgfSB3aGlsZSAoIW92ZXJsYXkgJiYgdGhpcy5ub3RSb290RWxlbWVudChlbGVtZW50KSk7CgkgICAgICB9CgoJICAgICAgcmV0dXJuIG92ZXJsYXk7CgkgICAgfQoJICB9LCB7CgkgICAga2V5OiAnbm90Um9vdEVsZW1lbnQnLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBub3RSb290RWxlbWVudChlbGVtZW50KSB7CgkgICAgICByZXR1cm4gZWxlbWVudCAhPSBkb2N1bWVudC5ib2R5ICYmIGVsZW1lbnQgIT0gZG9jdW1lbnQgJiYgZWxlbWVudCAhPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7CgkgICAgfQoJICB9LCB7CgkgICAga2V5OiAnZGV0ZWN0T3ZlcmxheUxheWVyJywKCSAgICB2YWx1ZTogZnVuY3Rpb24gZGV0ZWN0T3ZlcmxheUxheWVyKGRldGVjdFJhbmdlKSB7CgkgICAgICB2YXIgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IHRydWU7CgkgICAgICB2YXIgX2RpZEl0ZXJhdG9yRXJyb3IgPSBmYWxzZTsKCSAgICAgIHZhciBfaXRlcmF0b3JFcnJvciA9IHVuZGVmaW5lZDsKCgkgICAgICB0cnkgewoJICAgICAgICBmb3IgKHZhciBfaXRlcmF0b3IgPSBkZXRlY3RSYW5nZVtTeW1ib2wuaXRlcmF0b3JdKCksIF9zdGVwOyAhKF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSAoX3N0ZXAgPSBfaXRlcmF0b3IubmV4dCgpKS5kb25lKTsgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IHRydWUpIHsKCSAgICAgICAgICB2YXIgY29vcmRzID0gX3N0ZXAudmFsdWU7CgoJICAgICAgICAgIHZhciBvdmVybGF5ID0gdGhpcy5BTEdPMihjb29yZHMpOwoKCSAgICAgICAgICBpZiAob3ZlcmxheSkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UmVjaXBlKG92ZXJsYXkpOwoJICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgfSBjYXRjaCAoZXJyKSB7CgkgICAgICAgIF9kaWRJdGVyYXRvckVycm9yID0gdHJ1ZTsKCSAgICAgICAgX2l0ZXJhdG9yRXJyb3IgPSBlcnI7CgkgICAgICB9IGZpbmFsbHkgewoJICAgICAgICB0cnkgewoJICAgICAgICAgIGlmICghX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiAmJiBfaXRlcmF0b3IucmV0dXJuKSB7CgkgICAgICAgICAgICBfaXRlcmF0b3IucmV0dXJuKCk7CgkgICAgICAgICAgfQoJICAgICAgICB9IGZpbmFsbHkgewoJICAgICAgICAgIGlmIChfZGlkSXRlcmF0b3JFcnJvcikgewoJICAgICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3I7CgkgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICB9CgoJICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH0KCSAgfSwgewoJICAgIGtleTogJ2ZpbmQnLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBmaW5kKCkgewoJICAgICAgdmFyIGRldGVjdCA9IHsKCSAgICAgICAgQW55U2l6ZTogW3sgeDogdGhpcy53aW5XaWR0aCAvIDIsIHk6IHRoaXMud2luSGVpZ2h0IC8gMiwgbXc6IDEwMCwgbWg6IDEwMCB9LCB7IHg6IHRoaXMud2luV2lkdGggLyAyLCB5OiB0aGlzLndpbkhlaWdodCAvIDMsIG13OiAxMDAsIG1oOiAxMDAgfV0sCgkgICAgICAgIEZ1bGxTY3JlZW46IFt7IHg6IHRoaXMud2luV2lkdGggLyAyLCB5OiB0aGlzLndpbkhlaWdodCAvIDIsIG13OiB0aGlzLndpbkhlaWdodCAqIDAuOSwgbWg6IHRoaXMud2luSGVpZ2h0ICogMC45IH1dCgkgICAgICB9OwoJICAgICAgdmFyIG92ZXJsYXlzID0gW10sCgkgICAgICAgICAgcmVjaXBlID0gdm9pZCAwOwoKCSAgICAgIHJlY2lwZSA9IHRoaXMuZGV0ZWN0T3ZlcmxheUxheWVyKGRldGVjdC5BbnlTaXplKTsKCgkgICAgICBpZiAocmVjaXBlKSB7CgkgICAgICAgIG92ZXJsYXlzLnB1c2godGhpcy5oaWRlQnlSZWNpcGUocmVjaXBlKSk7CgoJICAgICAgICByZWNpcGUgPSB0aGlzLmRldGVjdE92ZXJsYXlMYXllcihkZXRlY3QuRnVsbFNjcmVlbik7CgoJICAgICAgICBpZiAocmVjaXBlKSB7CgkgICAgICAgICAgb3ZlcmxheXMucHVzaCh0aGlzLmhpZGVCeVJlY2lwZShyZWNpcGUpKTsKCSAgICAgICAgfQoJICAgICAgfQoKCSAgICAgIHJldHVybiBvdmVybGF5czsKCSAgICB9CgkgIH0sIHsKCSAgICBrZXk6ICdnZXRSZWNpcGUnLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRSZWNpcGUoZWwpIHsKCSAgICAgIHZhciByZWNpcGUgPSBbXTsKCSAgICAgIHZhciBpc1NpbmdsZUluc3RhbmNlSW5Eb2N1bWVudCA9IGZ1bmN0aW9uIGlzU2luZ2xlSW5zdGFuY2VJbkRvY3VtZW50KHJlY2lwZSkgewoJICAgICAgICByZXR1cm4gKDAsIF9qUXVlcnkyLmRlZmF1bHQpKHJlY2lwZS5qb2luKCcgPiAnKSkubGVuZ3RoID09IDE7CgkgICAgICB9OwoKCSAgICAgIGRvIHsKCSAgICAgICAgdmFyIG5vZGUgPSBlbC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOwoJICAgICAgICB2YXIgaWQgPSBlbC5nZXRBdHRyaWJ1dGUoJ2lkJyk7CgkgICAgICAgIHZhciBjbGFzc05hbWUgPSBlbC5nZXRBdHRyaWJ1dGUoJ2NsYXNzJyk7CgkgICAgICAgIHZhciBzdHlsZSA9IGVsLmdldEF0dHJpYnV0ZSgnc3R5bGUnKTsKCgkgICAgICAgIGlmIChpZCkgewoJICAgICAgICAgIHJlY2lwZS51bnNoaWZ0KCcjJyArIGlkLnRyaW0oKSk7CgoJICAgICAgICAgIGJyZWFrOwoJICAgICAgICB9IGVsc2UgaWYgKGNsYXNzTmFtZSkgewoJICAgICAgICAgIHJlY2lwZS51bnNoaWZ0KG5vZGUgKyAnLicgKyBjbGFzc05hbWUudHJpbSgpLnJlcGxhY2UoL1xzKy9nLCAnLicpKTsKCSAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICByZWNpcGUudW5zaGlmdChub2RlICsgJ1tzdHlsZT0iJyArIHN0eWxlICsgJyJdJyk7CgkgICAgICAgIH0KCgkgICAgICAgIGlmIChpc1NpbmdsZUluc3RhbmNlSW5Eb2N1bWVudChyZWNpcGUpKSB7CgkgICAgICAgICAgYnJlYWs7CgkgICAgICAgIH0KCgkgICAgICAgIGVsID0gZWwucGFyZW50Tm9kZTsKCSAgICAgIH0gd2hpbGUgKGVsICE9IGRvY3VtZW50LmJvZHkpOwoKCSAgICAgIGlmIChpc1NpbmdsZUluc3RhbmNlSW5Eb2N1bWVudChyZWNpcGUpKSB7CgkgICAgICAgIHJldHVybiByZWNpcGUuam9pbignID4gJyk7CgkgICAgICB9CgoJICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH0KCSAgfSwgewoJICAgIGtleTogJ2hpZGVCeVJlY2lwZScsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIGhpZGVCeVJlY2lwZShyZWNpcGUpIHsKCSAgICAgIHZhciBlbCA9ICgwLCBfalF1ZXJ5Mi5kZWZhdWx0KShyZWNpcGUpOwoJICAgICAgdmFyIGNzcyA9IGVsLnByb3AoJ3N0eWxlJykuY3NzVGV4dDsKCgkgICAgICBlbC5wcm9wKCdzdHlsZScpLmNzc1RleHQgPSBjc3MgKyAnO2Rpc3BsYXk6bm9uZSAhaW1wb3J0YW50Oyc7CgoJICAgICAgcmV0dXJuIHsgZWw6IGVsLCByZWNpcGU6IHJlY2lwZSwgY3NzOiBjc3MgfTsKCSAgICB9CgkgIH0sIHsKCSAgICBrZXk6ICdpc092ZXJsYXlpc2gnLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBpc092ZXJsYXlpc2goX3JlZjIpIHsKCSAgICAgIHZhciBlbCA9IF9yZWYyLmVsLAoJICAgICAgICAgIG1pbldpZHRoID0gX3JlZjIubWluV2lkdGgsCgkgICAgICAgICAgbWluSGVpZ2h0ID0gX3JlZjIubWluSGVpZ2h0OwoKCSAgICAgIHZhciBjc3MgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbCk7CgoJICAgICAgaWYgKGNzcy5kaXNwbGF5ICE9ICdub25lJyAmJiBjc3MudmlzaWJpbGl0eSAhPSAnaGlkZGVuJyAmJiAvZml4ZWR8YWJzb2x1dGUvLnRlc3QoY3NzLnBvc2l0aW9uKSAmJiAoY3NzLnpJbmRleCA9PSAnYXV0bycgfHwgcGFyc2VJbnQoY3NzLnpJbmRleCkgPj0gMCkgJiYgZWwub2Zmc2V0V2lkdGggPj0gbWluV2lkdGggJiYgZWwub2Zmc2V0SGVpZ2h0ID49IG1pbkhlaWdodCkgewoJICAgICAgICByZXR1cm4gW2VsLCBjc3MuekluZGV4ICogMV07CgkgICAgICB9CgoJICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH0KCSAgfV0pOwoKCSAgcmV0dXJuIE92ZXJsYXlEZWN0ZWN0b3I7Cgl9KCk7CgoJdmFyIE92ZXJsYXlLaWxsZXIgPSBmdW5jdGlvbiAoX092ZXJsYXlEZWN0ZWN0b3IpIHsKCSAgX2luaGVyaXRzKE92ZXJsYXlLaWxsZXIsIF9PdmVybGF5RGVjdGVjdG9yKTsKCgkgIGZ1bmN0aW9uIE92ZXJsYXlLaWxsZXIoKSB7CgkgICAgdmFyIHByb3BzID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTsKCgkgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIE92ZXJsYXlLaWxsZXIpOwoKCSAgICB2YXIgX3RoaXMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCAoT3ZlcmxheUtpbGxlci5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKE92ZXJsYXlLaWxsZXIpKS5jYWxsKHRoaXMpKTsKCgkgICAgX3RoaXMuYWN0aXZlQmxvY2tMaXN0ID0gW107CgkgICAgX3RoaXMuYWN0aXZlUmVjZXBpZXNMaXN0ID0gW107CgoJICAgIF90aGlzLm9uQXV0b0RldGVjdCA9IHByb3BzLm9uQXV0b0RldGVjdCB8fCBmdW5jdGlvbiAoKSB7fTsKCSAgICBfdGhpcy5vblVzZXJSZW1vdmUgPSBwcm9wcy5vblVzZXJSZW1vdmUgfHwgZnVuY3Rpb24gKCkge307CgkgICAgX3RoaXMub25CbG9ja0xpc3RGb3VuZCA9IHByb3BzLm9uQmxvY2tMaXN0Rm91bmQgfHwgZnVuY3Rpb24gKCkge307CgkgICAgX3RoaXMub25SZWNpcGVGb3VuZCA9IHByb3BzLm9uUmVjaXBlRm91bmQgfHwgZnVuY3Rpb24gKCkge307CgkgICAgX3RoaXMub25SZWNpcGVOb3RGb3VuZCA9IHByb3BzLm9uUmVjaXBlTm90Rm91bmQgfHwgZnVuY3Rpb24gKCkge307CgoJICAgIF90aGlzLmJsYWNrTGlzdFByb21pc2UgPSBfdGhpcy5jcmVhdGVCbG9ja0xpc3RGcm9tU3RvcmFnZSgpOwoKCSAgICBpZiAod2luZG93ID09IHRvcCkgewoJICAgICAgX3RoaXMuYXV0b0RldGVjdCgpOwoJICAgIH0KCSAgICByZXR1cm4gX3RoaXM7CgkgIH0KCgkgIF9jcmVhdGVDbGFzcyhPdmVybGF5S2lsbGVyLCBbewoJICAgIGtleTogJ2hpZGUnLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBoaWRlKHJlY2VwaWVzKSB7CgkgICAgICB2YXIgX3RoaXMyID0gdGhpczsKCgkgICAgICB0aGlzLmxhc3QgPSBbXTsKCgkgICAgICByZWNlcGllcy5mb3JFYWNoKGZ1bmN0aW9uIChyZWNpcGUpIHsKCSAgICAgICAgX3RoaXMyLmxhc3QucHVzaChfdGhpczIuaGlkZUJ5UmVjaXBlKHJlY2lwZSkpOwoJICAgICAgfSk7CgkgICAgfQoJICB9LCB7CgkgICAga2V5OiAncmVzdG9yZScsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIHJlc3RvcmUoKSB7CgkgICAgICB0aGlzLmxhc3QuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewoJICAgICAgICB2YXIgZWwgPSBpdGVtLmVsLAoJICAgICAgICAgICAgcmVjaXBlID0gaXRlbS5yZWNpcGUsCgkgICAgICAgICAgICBjc3MgPSBpdGVtLmNzczsKCgoJICAgICAgICBlbC5wcm9wKCdzdHlsZScpLmNzc1RleHQgPSBjc3MgKyAnO2Rpc3BsYXk6IGJsb2NrJzsKCgkgICAgICAgIFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkoKDAsIF9qUXVlcnkyLmRlZmF1bHQpKCdzdHlsZS5wcC1yZW1vdmUtb3ZlcmxheScpKSkuZm9yRWFjaChmdW5jdGlvbiAoc3R5bGUpIHsKCSAgICAgICAgICBzdHlsZSA9ICgwLCBfalF1ZXJ5Mi5kZWZhdWx0KShzdHlsZSk7CgoJICAgICAgICAgIGlmIChzdHlsZS5kYXRhKCdyZWNpcGUnKSA9PSBidG9hKHJlY2lwZSkpIHsKCSAgICAgICAgICAgICgwLCBfalF1ZXJ5Mi5kZWZhdWx0KShzdHlsZSkucmVtb3ZlKCk7CgkgICAgICAgICAgfQoJICAgICAgICB9KTsKCSAgICAgIH0pOwoKCSAgICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgncmVzaXplJykpOyAvL3NvbWV0aW1lcyB0aGlzIG1ha2VzIHRoZSBvdmVybGF5IHRvIGJlIGNlbnRlcmVkIHByb3Blcmx5IHdoZW4gcmVzdG9yZWQKCSAgICB9CgoJICAgIC8vID09PT09PT0gcmVtb3ZlIG92ZXJsYXkgdHJpZ2dlcmVkIGJ5IHVzZXIgPT09PT09PT09PQoKCSAgfSwgewoJICAgIGtleTogJ3JlbW92ZScsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZSgpIHsKCSAgICAgIHZhciBwcm9wcyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307CgoJICAgICAgdmFyIG92ZXJsYXlzID0gdGhpcy5maW5kKCk7CgoJICAgICAgaWYgKG92ZXJsYXlzLmxlbmd0aCkgewoJICAgICAgICB0aGlzLmxhc3QgPSBvdmVybGF5czsKCgkgICAgICAgIHRoaXMuY3JlYXRlR2xvYmFsQ1NTKCk7CgkgICAgICAgIHRoaXMub25Vc2VyUmVtb3ZlKHsgc3VjY2VzczogdHJ1ZSwgcmVjZXBpZXM6IG92ZXJsYXlzLm1hcChmdW5jdGlvbiAobykgewoJICAgICAgICAgICAgcmV0dXJuIG8ucmVjaXBlOwoJICAgICAgICAgIH0pLCBwcm9wczogcHJvcHMgfSk7CgkgICAgICB9IGVsc2UgewoJICAgICAgICB0aGlzLm9uVXNlclJlbW92ZSh7IHN1Y2Nlc3M6IGZhbHNlLCBwcm9wczogcHJvcHMgfSk7CgkgICAgICB9CgkgICAgfQoKCSAgICAvLyA9PT09PSBhZGQgZm91bmQgb3ZlcmxheSB0byBsb2NhbCBibGFja2xpc3QsIDxyZW1vdmUgYWx3YXlzPiBidXR0b24gZnJvbSBub3RpZmljYXRpb24KCgkgIH0sIHsKCSAgICBrZXk6ICdhZGRUb0xvY2FsQmxhY2tsaXN0JywKCSAgICB2YWx1ZTogZnVuY3Rpb24gYWRkVG9Mb2NhbEJsYWNrbGlzdCgpIHsKCSAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKCSAgICAgIHZhciBkb21haW4gPSBkb2N1bWVudC5kb21haW47CgkgICAgICB2YXIgdXJsID0gbG9jYXRpb24uaHJlZjsKCgkgICAgICBQQlN0b3JhZ2VTeW5jLnBiX292ZXJsYXlCbG9ja2VkTGlzdC51cGRhdGUoZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbGlzdCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307CgoJICAgICAgICB2YXIgYmxvY2tzID0gbGlzdFtkb21haW5dIHx8IFtdOwoKCSAgICAgICAgYmxvY2tzLnB1c2goewoJICAgICAgICAgIGlkOiAnYmxvY2stJyArIGJsb2Nrcy5sZW5ndGgsCgkgICAgICAgICAgdXJsOiB1cmwsCgkgICAgICAgICAgZG9tYWluOiBkb21haW4sCgkgICAgICAgICAgcmVjaXBlOiBfdGhpczMubGFzdC5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKCSAgICAgICAgICAgIHJldHVybiBpdGVtLnJlY2lwZTsKCSAgICAgICAgICB9KS5qb2luKCcsICcpCgkgICAgICAgIH0pOwoKCSAgICAgICAgbGlzdFtkb21haW5dID0gYmxvY2tzOwoKCSAgICAgICAgcmV0dXJuIGxpc3Q7CgkgICAgICB9KTsKCSAgICB9CgoJICAgIC8vID09PT09IHJlbW92ZSBvdmVybGF5IGZyb20gbG9jYWwgYmxhY2tsaXN0CgoJICB9LCB7CgkgICAga2V5OiAncmVtb3ZlRnJvbUxvY2FsQmxhY2tsaXN0JywKCSAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlRnJvbUxvY2FsQmxhY2tsaXN0KCkgewoJICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgoJICAgICAgdmFyIGRvbWFpbiA9IGRvY3VtZW50LmRvbWFpbjsKCgkgICAgICBQQlN0b3JhZ2VTeW5jLnBiX292ZXJsYXlCbG9ja2VkTGlzdC51cGRhdGUoZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbGlzdCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307CgoJICAgICAgICB2YXIgYmxvY2tzID0gbGlzdFtkb21haW5dIHx8IFtdOwoJICAgICAgICB2YXIgbGFzdFJlY2VwaWVzID0gX3RoaXM0Lmxhc3QubWFwKGZ1bmN0aW9uIChpdGVtKSB7CgkgICAgICAgICAgcmV0dXJuIGl0ZW0ucmVjaXBlOwoJICAgICAgICB9KTsKCgkgICAgICAgIGJsb2NrcyA9IGJsb2Nrcy5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHsKCSAgICAgICAgICByZXR1cm4gbGFzdFJlY2VwaWVzLmluZGV4T2YoaXRlbS5yZWNpcGUpID09IC0xOwoJICAgICAgICB9KTsKCgkgICAgICAgIGxpc3RbZG9tYWluXSA9IGJsb2NrczsKCgkgICAgICAgIHJldHVybiBsaXN0OwoJICAgICAgfSk7CgkgICAgfQoKCSAgICAvLyA9PT09PT09IGF1dG8gYWN0aW9ucyA9PT09PT09PT09CgoJICB9LCB7CgkgICAga2V5OiAnYXV0b0RldGVjdCcsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIGF1dG9EZXRlY3QoKSB7CgkgICAgICB2YXIgX3RoaXM1ID0gdGhpczsKCgkgICAgICB2YXIgYXR0ZW1wdCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogMDsKCgkgICAgICBpZiAoYXR0ZW1wdCA8IDQwKSB7CgkgICAgICAgIC8vbGV0IG92ZXJsYXkgPSB0aGlzLmZpbmQoKTsKCSAgICAgICAgdmFyIGZvdW5kQmxvY2tMaXN0ID0gdGhpcy5mb3JjZUJsb2NrKHRoaXMuYWN0aXZlQmxvY2tMaXN0KTsKCSAgICAgICAgdmFyIGZvdW5kUmVjaXBlTGlzdCA9IHRoaXMuZm9yY2VCbG9jayh0aGlzLmFjdGl2ZVJlY2VwaWVzTGlzdCk7CgoJICAgICAgICAvKmlmIChvdmVybGF5ICYmICF0aGlzLmF1dG9EZXRlY3RlZCkgewoJICAgICAgICAgIGxldCByZWNpcGUgPSBidG9hKHRoaXMuZ2V0UmVjaXBlKG92ZXJsYXkpKTsKCSAgICAgICAgICAgIHRoaXMub25BdXRvRGV0ZWN0KHJlY2lwZSk7CgkgICAgICAgICAgdGhpcy5hdXRvRGV0ZWN0ZWQgPSB0cnVlOwoJICAgICAgICB9Ki8KCgkgICAgICAgIGlmIChmb3VuZEJsb2NrTGlzdC5sZW5ndGgpIHsKCSAgICAgICAgICB0aGlzLm9uQmxvY2tMaXN0Rm91bmQoeyBmb3VuZDogZm91bmRCbG9ja0xpc3QgfSk7CgkgICAgICAgIH0KCgkgICAgICAgIGlmIChmb3VuZFJlY2lwZUxpc3QubGVuZ3RoKSB7CgkgICAgICAgICAgdGhpcy5vblJlY2lwZUZvdW5kKHsgZm91bmQ6IGZvdW5kUmVjaXBlTGlzdCB9KTsKCSAgICAgICAgfQoKCSAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgX3RoaXM1LmF1dG9EZXRlY3QoKythdHRlbXB0KTsKCSAgICAgICAgfSwgMjUwKTsKCSAgICAgIH0gZWxzZSB7CgkgICAgICAgIHRoaXMuY2hlY2tSZWNlcGllc1N1Y2Nlc3MoKTsKCSAgICAgIH0KCSAgICB9CgoJICAgIC8vYXV0byBibG9jayBhbGwgb3ZlcmxheXMgZnJvbSBsb2NhbCBkYgoKCSAgfSwgewoJICAgIGtleTogJ2NyZWF0ZUJsb2NrTGlzdEZyb21TdG9yYWdlJywKCSAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlQmxvY2tMaXN0RnJvbVN0b3JhZ2UoKSB7CgkgICAgICB2YXIgX3RoaXM2ID0gdGhpczsKCgkgICAgICByZXR1cm4gbmV3IF9Qcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CgkgICAgICAgIF9zdG9yYWdlMi5kZWZhdWx0LmdldCgncGJfb3ZlcmxheUJsb2NrZWRMaXN0JykudGhlbihmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgdmFyIGxpc3QgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9OwoKCSAgICAgICAgICBpZiAobGlzdFtkb2N1bWVudC5kb21haW5dKSB7CgkgICAgICAgICAgICBfdGhpczYuYWN0aXZlQmxvY2tMaXN0ID0gbGlzdFtkb2N1bWVudC5kb21haW5dOwoKCSAgICAgICAgICAgIF90aGlzNi5jcmVhdGVCbG9ja0NTUyhfdGhpczYuYWN0aXZlQmxvY2tMaXN0KTsKCSAgICAgICAgICB9CgoJICAgICAgICAgIHJlc29sdmUoKTsKCSAgICAgICAgfSk7CgkgICAgICB9KTsKCSAgICB9CgoJICAgIC8vYmxvY2sgYWxsIG92ZXJsYXlzIGZvdW5kIGluIHJlY2VwaWVzCgoJICB9LCB7CgkgICAga2V5OiAnY3JlYXRlQmxvY2tMaXN0RnJvbVJlY2VwaWVzJywKCSAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlQmxvY2tMaXN0RnJvbVJlY2VwaWVzKHJlY2VwaWVzKSB7CgkgICAgICB2YXIgX3RoaXM3ID0gdGhpczsKCgkgICAgICAvL2xvY2FsIGJsYWNrbGlzdCBuZWVkcyB0byBiZSBsb2FkZWQgYmVmb3JlIGhhbmRlbGluZyByZWNlcGllcwoJICAgICAgdGhpcy5ibGFja0xpc3RQcm9taXNlLnRoZW4oZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgYmxvY2tMaXN0ID0gX3RoaXM3LmFjdGl2ZUJsb2NrTGlzdC5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKCSAgICAgICAgICByZXR1cm4gaXRlbS5yZWNpcGU7CgkgICAgICAgIH0pOwoKCSAgICAgICAgcmVjZXBpZXMgPSByZWNlcGllcy5tYXAoZnVuY3Rpb24gKHJlY2lwZSkgewoJICAgICAgICAgIHJldHVybiB7CgkgICAgICAgICAgICByZWNpcGU6IHJlY2lwZSwKCSAgICAgICAgICAgIGZvdW5kOiBmYWxzZQoJICAgICAgICAgIH07CgkgICAgICAgIH0pLmZpbHRlcihmdW5jdGlvbiAoaXRlbSkgewoJICAgICAgICAgIHJldHVybiBibG9ja0xpc3QuaW5kZXhPZihpdGVtLnJlY2lwZSkgPT0gLTE7CgkgICAgICAgIH0pOwoKCSAgICAgICAgX3RoaXM3LmFjdGl2ZVJlY2VwaWVzTGlzdCA9IHJlY2VwaWVzOwoKCSAgICAgICAgX3RoaXM3LmNyZWF0ZUJsb2NrQ1NTKHJlY2VwaWVzKTsKCSAgICAgIH0pOwoJICAgIH0KCgkgICAgLy9jaGVja3Mgd2hhdCByZWNlcGllcyB3ZXJlIGZvdW5kIC8gbm90IGZvdW5kIGFuZCByZXBvcnQKCgkgIH0sIHsKCSAgICBrZXk6ICdjaGVja1JlY2VwaWVzU3VjY2VzcycsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIGNoZWNrUmVjZXBpZXNTdWNjZXNzKCkgewoJICAgICAgdmFyIG5vdEZvdW5kID0gdGhpcy5hY3RpdmVSZWNlcGllc0xpc3QuZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7CgkgICAgICAgIHJldHVybiAhaXRlbS5mb3VuZDsKCSAgICAgIH0pOwoKCSAgICAgIGlmIChub3RGb3VuZC5sZW5ndGgpIHsKCSAgICAgICAgdGhpcy5vblJlY2lwZU5vdEZvdW5kKG5vdEZvdW5kKTsKCSAgICAgIH0KCSAgICB9CgkgIH0sIHsKCSAgICBrZXk6ICdjcmVhdGVHbG9iYWxDU1MnLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVHbG9iYWxDU1MoKSB7CgkgICAgICB2YXIgaHRtbFN0eWxlID0gKDAsIF9qUXVlcnkyLmRlZmF1bHQpKCdodG1sJykuYXR0cignc3R5bGUnKTsKCSAgICAgIHZhciBib2R5U3R5bGUgPSAoMCwgX2pRdWVyeTIuZGVmYXVsdCkoJ2JvZHknKS5hdHRyKCdzdHlsZScpOwoKCSAgICAgICgwLCBfalF1ZXJ5Mi5kZWZhdWx0KSgnPHN0eWxlIHR5cGU9InRleHQvY3NzIj5odG1sLCBib2R5IHtvdmVyZmxvdzphdXRvICFpbXBvcnRhbnQ7IH08L3N0eWxlPicpLmFwcGVuZFRvKCdoZWFkJyk7CgkgICAgICAoMCwgX2pRdWVyeTIuZGVmYXVsdCkoJ2h0bWwnKS5hdHRyKCdzdHlsZScsIChodG1sU3R5bGUgPyBodG1sU3R5bGUgKyAnOycgOiAnJykgKyAnb3ZlcmZsb3c6YXV0byAhaW1wb3J0YW50OycpOwoJICAgICAgKDAsIF9qUXVlcnkyLmRlZmF1bHQpKCdib2R5JykuYXR0cignc3R5bGUnLCAoYm9keVN0eWxlID8gYm9keVN0eWxlICsgJzsnIDogJycpICsgJ292ZXJmbG93OmF1dG8gIWltcG9ydGFudDsnKTsKCSAgICB9CgoJICAgIC8vYmxvY2tzIG92ZXJsYXlzIHdpdGggY3NzIGZvciBmYXN0ZXIgYmxvY2tpbmcKCgkgIH0sIHsKCSAgICBrZXk6ICdjcmVhdGVCbG9ja0NTUycsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZUJsb2NrQ1NTKGxpc3QpIHsKCSAgICAgIHRoaXMuY3JlYXRlR2xvYmFsQ1NTKCk7CgoJICAgICAgbGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CgkgICAgICAgIHZhciBjc3MgPSBpdGVtLnJlY2lwZSArICcgeyBkaXNwbGF5Om5vbmUgIWltcG9ydGFudDsgfSc7CgoJICAgICAgICAoMCwgX2pRdWVyeTIuZGVmYXVsdCkoJzxzdHlsZSBjbGFzcz0icHAtcmVtb3ZlLW92ZXJsYXkiIGRhdGEtcmVjaXBlPSInICsgYnRvYShpdGVtLnJlY2lwZSkgKyAnIiB0eXBlPSJ0ZXh0L2NzcyI+JyArIGNzcyArICc8L3N0eWxlPicpLmFwcGVuZFRvKCdoZWFkJyk7CgkgICAgICB9KTsKCSAgICB9CgoJICAgIC8vID09PT09PT09PSBpZiBibG9jayBieSBjc3MgZG9lc24ndCB3b3JrLCB0aGlzIHdpbGwgd29yaywgYnV0IG9ubHkgYWZ0ZXIgRE9NIHJlYWR5CgoJICB9LCB7CgkgICAga2V5OiAnZm9yY2VCbG9jaycsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIGZvcmNlQmxvY2sobGlzdCkgewoJICAgICAgdmFyIGhpZGUgPSBbXTsKCgkgICAgICBsaXN0LmZpbHRlcihmdW5jdGlvbiAoaXRlbSkgewoJICAgICAgICByZXR1cm4gIWl0ZW0uZm91bmQ7CgkgICAgICB9KS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CgkgICAgICAgIHZhciBvdmVybGF5ID0gKDAsIF9qUXVlcnkyLmRlZmF1bHQpKGl0ZW0ucmVjaXBlKTsKCgkgICAgICAgIGlmIChvdmVybGF5Lmxlbmd0aCkgewoJICAgICAgICAgIGl0ZW0uZm91bmQgPSB0cnVlOwoKCSAgICAgICAgICBoaWRlLnB1c2goaXRlbS5yZWNpcGUpOwoJICAgICAgICB9CgkgICAgICB9KTsKCgkgICAgICBpZiAoaGlkZS5sZW5ndGgpIHsKCSAgICAgICAgdGhpcy5oaWRlKGhpZGUpOwoJICAgICAgfQoKCSAgICAgIHJldHVybiBoaWRlOwoJICAgIH0KCSAgfV0pOwoKCSAgcmV0dXJuIE92ZXJsYXlLaWxsZXI7Cgl9KE92ZXJsYXlEZWN0ZWN0b3IpOwoKCWV4cG9ydHMuZGVmYXVsdCA9IE92ZXJsYXlLaWxsZXI7CgovKioqLyB9KSwKLyogMyAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoJdmFyIF9fV0VCUEFDS19BTURfREVGSU5FX0FSUkFZX18sIF9fV0VCUEFDS19BTURfREVGSU5FX1JFU1VMVF9fOy8qIQoJICogalF1ZXJ5IEphdmFTY3JpcHQgTGlicmFyeSB2MS4xMi40CgkgKiBodHRwOi8vanF1ZXJ5LmNvbS8KCSAqCgkgKiBJbmNsdWRlcyBTaXp6bGUuanMKCSAqIGh0dHA6Ly9zaXp6bGVqcy5jb20vCgkgKgoJICogQ29weXJpZ2h0IGpRdWVyeSBGb3VuZGF0aW9uIGFuZCBvdGhlciBjb250cmlidXRvcnMKCSAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZQoJICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZQoJICoKCSAqIERhdGU6IDIwMTYtMDUtMjBUMTc6MTdaCgkgKi8KCgkoZnVuY3Rpb24oIGdsb2JhbCwgZmFjdG9yeSApIHsKCgkJaWYgKCB0eXBlb2YgbW9kdWxlID09PSAib2JqZWN0IiAmJiB0eXBlb2YgbW9kdWxlLmV4cG9ydHMgPT09ICJvYmplY3QiICkgewoJCQkvLyBGb3IgQ29tbW9uSlMgYW5kIENvbW1vbkpTLWxpa2UgZW52aXJvbm1lbnRzIHdoZXJlIGEgcHJvcGVyIGB3aW5kb3dgCgkJCS8vIGlzIHByZXNlbnQsIGV4ZWN1dGUgdGhlIGZhY3RvcnkgYW5kIGdldCBqUXVlcnkuCgkJCS8vIEZvciBlbnZpcm9ubWVudHMgdGhhdCBkbyBub3QgaGF2ZSBhIGB3aW5kb3dgIHdpdGggYSBgZG9jdW1lbnRgCgkJCS8vIChzdWNoIGFzIE5vZGUuanMpLCBleHBvc2UgYSBmYWN0b3J5IGFzIG1vZHVsZS5leHBvcnRzLgoJCQkvLyBUaGlzIGFjY2VudHVhdGVzIHRoZSBuZWVkIGZvciB0aGUgY3JlYXRpb24gb2YgYSByZWFsIGB3aW5kb3dgLgoJCQkvLyBlLmcuIHZhciBqUXVlcnkgPSByZXF1aXJlKCJqcXVlcnkiKSh3aW5kb3cpOwoJCQkvLyBTZWUgdGlja2V0ICMxNDU0OSBmb3IgbW9yZSBpbmZvLgoJCQltb2R1bGUuZXhwb3J0cyA9IGdsb2JhbC5kb2N1bWVudCA/CgkJCQlmYWN0b3J5KCBnbG9iYWwsIHRydWUgKSA6CgkJCQlmdW5jdGlvbiggdyApIHsKCQkJCQlpZiAoICF3LmRvY3VtZW50ICkgewoJCQkJCQl0aHJvdyBuZXcgRXJyb3IoICJqUXVlcnkgcmVxdWlyZXMgYSB3aW5kb3cgd2l0aCBhIGRvY3VtZW50IiApOwoJCQkJCX0KCQkJCQlyZXR1cm4gZmFjdG9yeSggdyApOwoJCQkJfTsKCQl9IGVsc2UgewoJCQlmYWN0b3J5KCBnbG9iYWwgKTsKCQl9CgoJLy8gUGFzcyB0aGlzIGlmIHdpbmRvdyBpcyBub3QgZGVmaW5lZCB5ZXQKCX0odHlwZW9mIHdpbmRvdyAhPT0gInVuZGVmaW5lZCIgPyB3aW5kb3cgOiB0aGlzLCBmdW5jdGlvbiggd2luZG93LCBub0dsb2JhbCApIHsKCgkvLyBTdXBwb3J0OiBGaXJlZm94IDE4KwoJLy8gQ2FuJ3QgYmUgaW4gc3RyaWN0IG1vZGUsIHNldmVyYWwgbGlicyBpbmNsdWRpbmcgQVNQLk5FVCB0cmFjZQoJLy8gdGhlIHN0YWNrIHZpYSBhcmd1bWVudHMuY2FsbGVyLmNhbGxlZSBhbmQgRmlyZWZveCBkaWVzIGlmCgkvLyB5b3UgdHJ5IHRvIHRyYWNlIHRocm91Z2ggInVzZSBzdHJpY3QiIGNhbGwgY2hhaW5zLiAoIzEzMzM1KQoJLy8idXNlIHN0cmljdCI7Cgl2YXIgZGVsZXRlZElkcyA9IFtdOwoKCXZhciBkb2N1bWVudCA9IHdpbmRvdy5kb2N1bWVudDsKCgl2YXIgc2xpY2UgPSBkZWxldGVkSWRzLnNsaWNlOwoKCXZhciBjb25jYXQgPSBkZWxldGVkSWRzLmNvbmNhdDsKCgl2YXIgcHVzaCA9IGRlbGV0ZWRJZHMucHVzaDsKCgl2YXIgaW5kZXhPZiA9IGRlbGV0ZWRJZHMuaW5kZXhPZjsKCgl2YXIgY2xhc3MydHlwZSA9IHt9OwoKCXZhciB0b1N0cmluZyA9IGNsYXNzMnR5cGUudG9TdHJpbmc7CgoJdmFyIGhhc093biA9IGNsYXNzMnR5cGUuaGFzT3duUHJvcGVydHk7CgoJdmFyIHN1cHBvcnQgPSB7fTsKCgoKCXZhcgoJCXZlcnNpb24gPSAiMS4xMi40IiwKCgkJLy8gRGVmaW5lIGEgbG9jYWwgY29weSBvZiBqUXVlcnkKCQlqUXVlcnkgPSBmdW5jdGlvbiggc2VsZWN0b3IsIGNvbnRleHQgKSB7CgoJCQkvLyBUaGUgalF1ZXJ5IG9iamVjdCBpcyBhY3R1YWxseSBqdXN0IHRoZSBpbml0IGNvbnN0cnVjdG9yICdlbmhhbmNlZCcKCQkJLy8gTmVlZCBpbml0IGlmIGpRdWVyeSBpcyBjYWxsZWQgKGp1c3QgYWxsb3cgZXJyb3IgdG8gYmUgdGhyb3duIGlmIG5vdCBpbmNsdWRlZCkKCQkJcmV0dXJuIG5ldyBqUXVlcnkuZm4uaW5pdCggc2VsZWN0b3IsIGNvbnRleHQgKTsKCQl9LAoKCQkvLyBTdXBwb3J0OiBBbmRyb2lkPDQuMSwgSUU8OQoJCS8vIE1ha2Ugc3VyZSB3ZSB0cmltIEJPTSBhbmQgTkJTUAoJCXJ0cmltID0gL15bXHNcdUZFRkZceEEwXSt8W1xzXHVGRUZGXHhBMF0rJC9nLAoKCQkvLyBNYXRjaGVzIGRhc2hlZCBzdHJpbmcgZm9yIGNhbWVsaXppbmcKCQlybXNQcmVmaXggPSAvXi1tcy0vLAoJCXJkYXNoQWxwaGEgPSAvLShbXGRhLXpdKS9naSwKCgkJLy8gVXNlZCBieSBqUXVlcnkuY2FtZWxDYXNlIGFzIGNhbGxiYWNrIHRvIHJlcGxhY2UoKQoJCWZjYW1lbENhc2UgPSBmdW5jdGlvbiggYWxsLCBsZXR0ZXIgKSB7CgkJCXJldHVybiBsZXR0ZXIudG9VcHBlckNhc2UoKTsKCQl9OwoKCWpRdWVyeS5mbiA9IGpRdWVyeS5wcm90b3R5cGUgPSB7CgoJCS8vIFRoZSBjdXJyZW50IHZlcnNpb24gb2YgalF1ZXJ5IGJlaW5nIHVzZWQKCQlqcXVlcnk6IHZlcnNpb24sCgoJCWNvbnN0cnVjdG9yOiBqUXVlcnksCgoJCS8vIFN0YXJ0IHdpdGggYW4gZW1wdHkgc2VsZWN0b3IKCQlzZWxlY3RvcjogIiIsCgoJCS8vIFRoZSBkZWZhdWx0IGxlbmd0aCBvZiBhIGpRdWVyeSBvYmplY3QgaXMgMAoJCWxlbmd0aDogMCwKCgkJdG9BcnJheTogZnVuY3Rpb24oKSB7CgkJCXJldHVybiBzbGljZS5jYWxsKCB0aGlzICk7CgkJfSwKCgkJLy8gR2V0IHRoZSBOdGggZWxlbWVudCBpbiB0aGUgbWF0Y2hlZCBlbGVtZW50IHNldCBPUgoJCS8vIEdldCB0aGUgd2hvbGUgbWF0Y2hlZCBlbGVtZW50IHNldCBhcyBhIGNsZWFuIGFycmF5CgkJZ2V0OiBmdW5jdGlvbiggbnVtICkgewoJCQlyZXR1cm4gbnVtICE9IG51bGwgPwoKCQkJCS8vIFJldHVybiBqdXN0IHRoZSBvbmUgZWxlbWVudCBmcm9tIHRoZSBzZXQKCQkJCSggbnVtIDwgMCA/IHRoaXNbIG51bSArIHRoaXMubGVuZ3RoIF0gOiB0aGlzWyBudW0gXSApIDoKCgkJCQkvLyBSZXR1cm4gYWxsIHRoZSBlbGVtZW50cyBpbiBhIGNsZWFuIGFycmF5CgkJCQlzbGljZS5jYWxsKCB0aGlzICk7CgkJfSwKCgkJLy8gVGFrZSBhbiBhcnJheSBvZiBlbGVtZW50cyBhbmQgcHVzaCBpdCBvbnRvIHRoZSBzdGFjawoJCS8vIChyZXR1cm5pbmcgdGhlIG5ldyBtYXRjaGVkIGVsZW1lbnQgc2V0KQoJCXB1c2hTdGFjazogZnVuY3Rpb24oIGVsZW1zICkgewoKCQkJLy8gQnVpbGQgYSBuZXcgalF1ZXJ5IG1hdGNoZWQgZWxlbWVudCBzZXQKCQkJdmFyIHJldCA9IGpRdWVyeS5tZXJnZSggdGhpcy5jb25zdHJ1Y3RvcigpLCBlbGVtcyApOwoKCQkJLy8gQWRkIHRoZSBvbGQgb2JqZWN0IG9udG8gdGhlIHN0YWNrIChhcyBhIHJlZmVyZW5jZSkKCQkJcmV0LnByZXZPYmplY3QgPSB0aGlzOwoJCQlyZXQuY29udGV4dCA9IHRoaXMuY29udGV4dDsKCgkJCS8vIFJldHVybiB0aGUgbmV3bHktZm9ybWVkIGVsZW1lbnQgc2V0CgkJCXJldHVybiByZXQ7CgkJfSwKCgkJLy8gRXhlY3V0ZSBhIGNhbGxiYWNrIGZvciBldmVyeSBlbGVtZW50IGluIHRoZSBtYXRjaGVkIHNldC4KCQllYWNoOiBmdW5jdGlvbiggY2FsbGJhY2sgKSB7CgkJCXJldHVybiBqUXVlcnkuZWFjaCggdGhpcywgY2FsbGJhY2sgKTsKCQl9LAoKCQltYXA6IGZ1bmN0aW9uKCBjYWxsYmFjayApIHsKCQkJcmV0dXJuIHRoaXMucHVzaFN0YWNrKCBqUXVlcnkubWFwKCB0aGlzLCBmdW5jdGlvbiggZWxlbSwgaSApIHsKCQkJCXJldHVybiBjYWxsYmFjay5jYWxsKCBlbGVtLCBpLCBlbGVtICk7CgkJCX0gKSApOwoJCX0sCgoJCXNsaWNlOiBmdW5jdGlvbigpIHsKCQkJcmV0dXJuIHRoaXMucHVzaFN0YWNrKCBzbGljZS5hcHBseSggdGhpcywgYXJndW1lbnRzICkgKTsKCQl9LAoKCQlmaXJzdDogZnVuY3Rpb24oKSB7CgkJCXJldHVybiB0aGlzLmVxKCAwICk7CgkJfSwKCgkJbGFzdDogZnVuY3Rpb24oKSB7CgkJCXJldHVybiB0aGlzLmVxKCAtMSApOwoJCX0sCgoJCWVxOiBmdW5jdGlvbiggaSApIHsKCQkJdmFyIGxlbiA9IHRoaXMubGVuZ3RoLAoJCQkJaiA9ICtpICsgKCBpIDwgMCA/IGxlbiA6IDAgKTsKCQkJcmV0dXJuIHRoaXMucHVzaFN0YWNrKCBqID49IDAgJiYgaiA8IGxlbiA/IFsgdGhpc1sgaiBdIF0gOiBbXSApOwoJCX0sCgoJCWVuZDogZnVuY3Rpb24oKSB7CgkJCXJldHVybiB0aGlzLnByZXZPYmplY3QgfHwgdGhpcy5jb25zdHJ1Y3RvcigpOwoJCX0sCgoJCS8vIEZvciBpbnRlcm5hbCB1c2Ugb25seS4KCQkvLyBCZWhhdmVzIGxpa2UgYW4gQXJyYXkncyBtZXRob2QsIG5vdCBsaWtlIGEgalF1ZXJ5IG1ldGhvZC4KCQlwdXNoOiBwdXNoLAoJCXNvcnQ6IGRlbGV0ZWRJZHMuc29ydCwKCQlzcGxpY2U6IGRlbGV0ZWRJZHMuc3BsaWNlCgl9OwoKCWpRdWVyeS5leHRlbmQgPSBqUXVlcnkuZm4uZXh0ZW5kID0gZnVuY3Rpb24oKSB7CgkJdmFyIHNyYywgY29weUlzQXJyYXksIGNvcHksIG5hbWUsIG9wdGlvbnMsIGNsb25lLAoJCQl0YXJnZXQgPSBhcmd1bWVudHNbIDAgXSB8fCB7fSwKCQkJaSA9IDEsCgkJCWxlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGgsCgkJCWRlZXAgPSBmYWxzZTsKCgkJLy8gSGFuZGxlIGEgZGVlcCBjb3B5IHNpdHVhdGlvbgoJCWlmICggdHlwZW9mIHRhcmdldCA9PT0gImJvb2xlYW4iICkgewoJCQlkZWVwID0gdGFyZ2V0OwoKCQkJLy8gc2tpcCB0aGUgYm9vbGVhbiBhbmQgdGhlIHRhcmdldAoJCQl0YXJnZXQgPSBhcmd1bWVudHNbIGkgXSB8fCB7fTsKCQkJaSsrOwoJCX0KCgkJLy8gSGFuZGxlIGNhc2Ugd2hlbiB0YXJnZXQgaXMgYSBzdHJpbmcgb3Igc29tZXRoaW5nIChwb3NzaWJsZSBpbiBkZWVwIGNvcHkpCgkJaWYgKCB0eXBlb2YgdGFyZ2V0ICE9PSAib2JqZWN0IiAmJiAhalF1ZXJ5LmlzRnVuY3Rpb24oIHRhcmdldCApICkgewoJCQl0YXJnZXQgPSB7fTsKCQl9CgoJCS8vIGV4dGVuZCBqUXVlcnkgaXRzZWxmIGlmIG9ubHkgb25lIGFyZ3VtZW50IGlzIHBhc3NlZAoJCWlmICggaSA9PT0gbGVuZ3RoICkgewoJCQl0YXJnZXQgPSB0aGlzOwoJCQlpLS07CgkJfQoKCQlmb3IgKCA7IGkgPCBsZW5ndGg7IGkrKyApIHsKCgkJCS8vIE9ubHkgZGVhbCB3aXRoIG5vbi1udWxsL3VuZGVmaW5lZCB2YWx1ZXMKCQkJaWYgKCAoIG9wdGlvbnMgPSBhcmd1bWVudHNbIGkgXSApICE9IG51bGwgKSB7CgoJCQkJLy8gRXh0ZW5kIHRoZSBiYXNlIG9iamVjdAoJCQkJZm9yICggbmFtZSBpbiBvcHRpb25zICkgewoJCQkJCXNyYyA9IHRhcmdldFsgbmFtZSBdOwoJCQkJCWNvcHkgPSBvcHRpb25zWyBuYW1lIF07CgoJCQkJCS8vIFByZXZlbnQgbmV2ZXItZW5kaW5nIGxvb3AKCQkJCQlpZiAoIHRhcmdldCA9PT0gY29weSApIHsKCQkJCQkJY29udGludWU7CgkJCQkJfQoKCQkJCQkvLyBSZWN1cnNlIGlmIHdlJ3JlIG1lcmdpbmcgcGxhaW4gb2JqZWN0cyBvciBhcnJheXMKCQkJCQlpZiAoIGRlZXAgJiYgY29weSAmJiAoIGpRdWVyeS5pc1BsYWluT2JqZWN0KCBjb3B5ICkgfHwKCQkJCQkJKCBjb3B5SXNBcnJheSA9IGpRdWVyeS5pc0FycmF5KCBjb3B5ICkgKSApICkgewoKCQkJCQkJaWYgKCBjb3B5SXNBcnJheSApIHsKCQkJCQkJCWNvcHlJc0FycmF5ID0gZmFsc2U7CgkJCQkJCQljbG9uZSA9IHNyYyAmJiBqUXVlcnkuaXNBcnJheSggc3JjICkgPyBzcmMgOiBbXTsKCgkJCQkJCX0gZWxzZSB7CgkJCQkJCQljbG9uZSA9IHNyYyAmJiBqUXVlcnkuaXNQbGFpbk9iamVjdCggc3JjICkgPyBzcmMgOiB7fTsKCQkJCQkJfQoKCQkJCQkJLy8gTmV2ZXIgbW92ZSBvcmlnaW5hbCBvYmplY3RzLCBjbG9uZSB0aGVtCgkJCQkJCXRhcmdldFsgbmFtZSBdID0galF1ZXJ5LmV4dGVuZCggZGVlcCwgY2xvbmUsIGNvcHkgKTsKCgkJCQkJLy8gRG9uJ3QgYnJpbmcgaW4gdW5kZWZpbmVkIHZhbHVlcwoJCQkJCX0gZWxzZSBpZiAoIGNvcHkgIT09IHVuZGVmaW5lZCApIHsKCQkJCQkJdGFyZ2V0WyBuYW1lIF0gPSBjb3B5OwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCgkJLy8gUmV0dXJuIHRoZSBtb2RpZmllZCBvYmplY3QKCQlyZXR1cm4gdGFyZ2V0OwoJfTsKCglqUXVlcnkuZXh0ZW5kKCB7CgoJCS8vIFVuaXF1ZSBmb3IgZWFjaCBjb3B5IG9mIGpRdWVyeSBvbiB0aGUgcGFnZQoJCWV4cGFuZG86ICJqUXVlcnkiICsgKCB2ZXJzaW9uICsgTWF0aC5yYW5kb20oKSApLnJlcGxhY2UoIC9cRC9nLCAiIiApLAoKCQkvLyBBc3N1bWUgalF1ZXJ5IGlzIHJlYWR5IHdpdGhvdXQgdGhlIHJlYWR5IG1vZHVsZQoJCWlzUmVhZHk6IHRydWUsCgoJCWVycm9yOiBmdW5jdGlvbiggbXNnICkgewoJCQl0aHJvdyBuZXcgRXJyb3IoIG1zZyApOwoJCX0sCgoJCW5vb3A6IGZ1bmN0aW9uKCkge30sCgoJCS8vIFNlZSB0ZXN0L3VuaXQvY29yZS5qcyBmb3IgZGV0YWlscyBjb25jZXJuaW5nIGlzRnVuY3Rpb24uCgkJLy8gU2luY2UgdmVyc2lvbiAxLjMsIERPTSBtZXRob2RzIGFuZCBmdW5jdGlvbnMgbGlrZSBhbGVydAoJCS8vIGFyZW4ndCBzdXBwb3J0ZWQuIFRoZXkgcmV0dXJuIGZhbHNlIG9uIElFICgjMjk2OCkuCgkJaXNGdW5jdGlvbjogZnVuY3Rpb24oIG9iaiApIHsKCQkJcmV0dXJuIGpRdWVyeS50eXBlKCBvYmogKSA9PT0gImZ1bmN0aW9uIjsKCQl9LAoKCQlpc0FycmF5OiBBcnJheS5pc0FycmF5IHx8IGZ1bmN0aW9uKCBvYmogKSB7CgkJCXJldHVybiBqUXVlcnkudHlwZSggb2JqICkgPT09ICJhcnJheSI7CgkJfSwKCgkJaXNXaW5kb3c6IGZ1bmN0aW9uKCBvYmogKSB7CgkJCS8qIGpzaGludCBlcWVxZXE6IGZhbHNlICovCgkJCXJldHVybiBvYmogIT0gbnVsbCAmJiBvYmogPT0gb2JqLndpbmRvdzsKCQl9LAoKCQlpc051bWVyaWM6IGZ1bmN0aW9uKCBvYmogKSB7CgoJCQkvLyBwYXJzZUZsb2F0IE5hTnMgbnVtZXJpYy1jYXN0IGZhbHNlIHBvc2l0aXZlcyAobnVsbHx0cnVlfGZhbHNlfCIiKQoJCQkvLyAuLi5idXQgbWlzaW50ZXJwcmV0cyBsZWFkaW5nLW51bWJlciBzdHJpbmdzLCBwYXJ0aWN1bGFybHkgaGV4IGxpdGVyYWxzICgiMHguLi4iKQoJCQkvLyBzdWJ0cmFjdGlvbiBmb3JjZXMgaW5maW5pdGllcyB0byBOYU4KCQkJLy8gYWRkaW5nIDEgY29ycmVjdHMgbG9zcyBvZiBwcmVjaXNpb24gZnJvbSBwYXJzZUZsb2F0ICgjMTUxMDApCgkJCXZhciByZWFsU3RyaW5nT2JqID0gb2JqICYmIG9iai50b1N0cmluZygpOwoJCQlyZXR1cm4gIWpRdWVyeS5pc0FycmF5KCBvYmogKSAmJiAoIHJlYWxTdHJpbmdPYmogLSBwYXJzZUZsb2F0KCByZWFsU3RyaW5nT2JqICkgKyAxICkgPj0gMDsKCQl9LAoKCQlpc0VtcHR5T2JqZWN0OiBmdW5jdGlvbiggb2JqICkgewoJCQl2YXIgbmFtZTsKCQkJZm9yICggbmFtZSBpbiBvYmogKSB7CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCQkJcmV0dXJuIHRydWU7CgkJfSwKCgkJaXNQbGFpbk9iamVjdDogZnVuY3Rpb24oIG9iaiApIHsKCQkJdmFyIGtleTsKCgkJCS8vIE11c3QgYmUgYW4gT2JqZWN0LgoJCQkvLyBCZWNhdXNlIG9mIElFLCB3ZSBhbHNvIGhhdmUgdG8gY2hlY2sgdGhlIHByZXNlbmNlIG9mIHRoZSBjb25zdHJ1Y3RvciBwcm9wZXJ0eS4KCQkJLy8gTWFrZSBzdXJlIHRoYXQgRE9NIG5vZGVzIGFuZCB3aW5kb3cgb2JqZWN0cyBkb24ndCBwYXNzIHRocm91Z2gsIGFzIHdlbGwKCQkJaWYgKCAhb2JqIHx8IGpRdWVyeS50eXBlKCBvYmogKSAhPT0gIm9iamVjdCIgfHwgb2JqLm5vZGVUeXBlIHx8IGpRdWVyeS5pc1dpbmRvdyggb2JqICkgKSB7CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCgkJCXRyeSB7CgoJCQkJLy8gTm90IG93biBjb25zdHJ1Y3RvciBwcm9wZXJ0eSBtdXN0IGJlIE9iamVjdAoJCQkJaWYgKCBvYmouY29uc3RydWN0b3IgJiYKCQkJCQkhaGFzT3duLmNhbGwoIG9iaiwgImNvbnN0cnVjdG9yIiApICYmCgkJCQkJIWhhc093bi5jYWxsKCBvYmouY29uc3RydWN0b3IucHJvdG90eXBlLCAiaXNQcm90b3R5cGVPZiIgKSApIHsKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQl9CgkJCX0gY2F0Y2ggKCBlICkgewoKCQkJCS8vIElFOCw5IFdpbGwgdGhyb3cgZXhjZXB0aW9ucyBvbiBjZXJ0YWluIGhvc3Qgb2JqZWN0cyAjOTg5NwoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9CgoJCQkvLyBTdXBwb3J0OiBJRTw5CgkJCS8vIEhhbmRsZSBpdGVyYXRpb24gb3ZlciBpbmhlcml0ZWQgcHJvcGVydGllcyBiZWZvcmUgb3duIHByb3BlcnRpZXMuCgkJCWlmICggIXN1cHBvcnQub3duRmlyc3QgKSB7CgkJCQlmb3IgKCBrZXkgaW4gb2JqICkgewoJCQkJCXJldHVybiBoYXNPd24uY2FsbCggb2JqLCBrZXkgKTsKCQkJCX0KCQkJfQoKCQkJLy8gT3duIHByb3BlcnRpZXMgYXJlIGVudW1lcmF0ZWQgZmlyc3RseSwgc28gdG8gc3BlZWQgdXAsCgkJCS8vIGlmIGxhc3Qgb25lIGlzIG93biwgdGhlbiBhbGwgcHJvcGVydGllcyBhcmUgb3duLgoJCQlmb3IgKCBrZXkgaW4gb2JqICkge30KCgkJCXJldHVybiBrZXkgPT09IHVuZGVmaW5lZCB8fCBoYXNPd24uY2FsbCggb2JqLCBrZXkgKTsKCQl9LAoKCQl0eXBlOiBmdW5jdGlvbiggb2JqICkgewoJCQlpZiAoIG9iaiA9PSBudWxsICkgewoJCQkJcmV0dXJuIG9iaiArICIiOwoJCQl9CgkJCXJldHVybiB0eXBlb2Ygb2JqID09PSAib2JqZWN0IiB8fCB0eXBlb2Ygb2JqID09PSAiZnVuY3Rpb24iID8KCQkJCWNsYXNzMnR5cGVbIHRvU3RyaW5nLmNhbGwoIG9iaiApIF0gfHwgIm9iamVjdCIgOgoJCQkJdHlwZW9mIG9iajsKCQl9LAoKCQkvLyBXb3JrYXJvdW5kcyBiYXNlZCBvbiBmaW5kaW5ncyBieSBKaW0gRHJpc2NvbGwKCQkvLyBodHRwOi8vd2VibG9ncy5qYXZhLm5ldC9ibG9nL2RyaXNjb2xsL2FyY2hpdmUvMjAwOS8wOS8wOC9ldmFsLWphdmFzY3JpcHQtZ2xvYmFsLWNvbnRleHQKCQlnbG9iYWxFdmFsOiBmdW5jdGlvbiggZGF0YSApIHsKCQkJaWYgKCBkYXRhICYmIGpRdWVyeS50cmltKCBkYXRhICkgKSB7CgoJCQkJLy8gV2UgdXNlIGV4ZWNTY3JpcHQgb24gSW50ZXJuZXQgRXhwbG9yZXIKCQkJCS8vIFdlIHVzZSBhbiBhbm9ueW1vdXMgZnVuY3Rpb24gc28gdGhhdCBjb250ZXh0IGlzIHdpbmRvdwoJCQkJLy8gcmF0aGVyIHRoYW4galF1ZXJ5IGluIEZpcmVmb3gKCQkJCSggd2luZG93LmV4ZWNTY3JpcHQgfHwgZnVuY3Rpb24oIGRhdGEgKSB7CgkJCQkJd2luZG93WyAiZXZhbCIgXS5jYWxsKCB3aW5kb3csIGRhdGEgKTsgLy8ganNjczppZ25vcmUgcmVxdWlyZURvdE5vdGF0aW9uCgkJCQl9ICkoIGRhdGEgKTsKCQkJfQoJCX0sCgoJCS8vIENvbnZlcnQgZGFzaGVkIHRvIGNhbWVsQ2FzZTsgdXNlZCBieSB0aGUgY3NzIGFuZCBkYXRhIG1vZHVsZXMKCQkvLyBNaWNyb3NvZnQgZm9yZ290IHRvIGh1bXAgdGhlaXIgdmVuZG9yIHByZWZpeCAoIzk1NzIpCgkJY2FtZWxDYXNlOiBmdW5jdGlvbiggc3RyaW5nICkgewoJCQlyZXR1cm4gc3RyaW5nLnJlcGxhY2UoIHJtc1ByZWZpeCwgIm1zLSIgKS5yZXBsYWNlKCByZGFzaEFscGhhLCBmY2FtZWxDYXNlICk7CgkJfSwKCgkJbm9kZU5hbWU6IGZ1bmN0aW9uKCBlbGVtLCBuYW1lICkgewoJCQlyZXR1cm4gZWxlbS5ub2RlTmFtZSAmJiBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IG5hbWUudG9Mb3dlckNhc2UoKTsKCQl9LAoKCQllYWNoOiBmdW5jdGlvbiggb2JqLCBjYWxsYmFjayApIHsKCQkJdmFyIGxlbmd0aCwgaSA9IDA7CgoJCQlpZiAoIGlzQXJyYXlMaWtlKCBvYmogKSApIHsKCQkJCWxlbmd0aCA9IG9iai5sZW5ndGg7CgkJCQlmb3IgKCA7IGkgPCBsZW5ndGg7IGkrKyApIHsKCQkJCQlpZiAoIGNhbGxiYWNrLmNhbGwoIG9ialsgaSBdLCBpLCBvYmpbIGkgXSApID09PSBmYWxzZSApIHsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJfQoJCQl9IGVsc2UgewoJCQkJZm9yICggaSBpbiBvYmogKSB7CgkJCQkJaWYgKCBjYWxsYmFjay5jYWxsKCBvYmpbIGkgXSwgaSwgb2JqWyBpIF0gKSA9PT0gZmFsc2UgKSB7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCX0KCQkJfQoKCQkJcmV0dXJuIG9iajsKCQl9LAoKCQkvLyBTdXBwb3J0OiBBbmRyb2lkPDQuMSwgSUU8OQoJCXRyaW06IGZ1bmN0aW9uKCB0ZXh0ICkgewoJCQlyZXR1cm4gdGV4dCA9PSBudWxsID8KCQkJCSIiIDoKCQkJCSggdGV4dCArICIiICkucmVwbGFjZSggcnRyaW0sICIiICk7CgkJfSwKCgkJLy8gcmVzdWx0cyBpcyBmb3IgaW50ZXJuYWwgdXNhZ2Ugb25seQoJCW1ha2VBcnJheTogZnVuY3Rpb24oIGFyciwgcmVzdWx0cyApIHsKCQkJdmFyIHJldCA9IHJlc3VsdHMgfHwgW107CgoJCQlpZiAoIGFyciAhPSBudWxsICkgewoJCQkJaWYgKCBpc0FycmF5TGlrZSggT2JqZWN0KCBhcnIgKSApICkgewoJCQkJCWpRdWVyeS5tZXJnZSggcmV0LAoJCQkJCQl0eXBlb2YgYXJyID09PSAic3RyaW5nIiA/CgkJCQkJCVsgYXJyIF0gOiBhcnIKCQkJCQkpOwoJCQkJfSBlbHNlIHsKCQkJCQlwdXNoLmNhbGwoIHJldCwgYXJyICk7CgkJCQl9CgkJCX0KCgkJCXJldHVybiByZXQ7CgkJfSwKCgkJaW5BcnJheTogZnVuY3Rpb24oIGVsZW0sIGFyciwgaSApIHsKCQkJdmFyIGxlbjsKCgkJCWlmICggYXJyICkgewoJCQkJaWYgKCBpbmRleE9mICkgewoJCQkJCXJldHVybiBpbmRleE9mLmNhbGwoIGFyciwgZWxlbSwgaSApOwoJCQkJfQoKCQkJCWxlbiA9IGFyci5sZW5ndGg7CgkJCQlpID0gaSA/IGkgPCAwID8gTWF0aC5tYXgoIDAsIGxlbiArIGkgKSA6IGkgOiAwOwoKCQkJCWZvciAoIDsgaSA8IGxlbjsgaSsrICkgewoKCQkJCQkvLyBTa2lwIGFjY2Vzc2luZyBpbiBzcGFyc2UgYXJyYXlzCgkJCQkJaWYgKCBpIGluIGFyciAmJiBhcnJbIGkgXSA9PT0gZWxlbSApIHsKCQkJCQkJcmV0dXJuIGk7CgkJCQkJfQoJCQkJfQoJCQl9CgoJCQlyZXR1cm4gLTE7CgkJfSwKCgkJbWVyZ2U6IGZ1bmN0aW9uKCBmaXJzdCwgc2Vjb25kICkgewoJCQl2YXIgbGVuID0gK3NlY29uZC5sZW5ndGgsCgkJCQlqID0gMCwKCQkJCWkgPSBmaXJzdC5sZW5ndGg7CgoJCQl3aGlsZSAoIGogPCBsZW4gKSB7CgkJCQlmaXJzdFsgaSsrIF0gPSBzZWNvbmRbIGorKyBdOwoJCQl9CgoJCQkvLyBTdXBwb3J0OiBJRTw5CgkJCS8vIFdvcmthcm91bmQgY2FzdGluZyBvZiAubGVuZ3RoIHRvIE5hTiBvbiBvdGhlcndpc2UgYXJyYXlsaWtlIG9iamVjdHMgKGUuZy4sIE5vZGVMaXN0cykKCQkJaWYgKCBsZW4gIT09IGxlbiApIHsKCQkJCXdoaWxlICggc2Vjb25kWyBqIF0gIT09IHVuZGVmaW5lZCApIHsKCQkJCQlmaXJzdFsgaSsrIF0gPSBzZWNvbmRbIGorKyBdOwoJCQkJfQoJCQl9CgoJCQlmaXJzdC5sZW5ndGggPSBpOwoKCQkJcmV0dXJuIGZpcnN0OwoJCX0sCgoJCWdyZXA6IGZ1bmN0aW9uKCBlbGVtcywgY2FsbGJhY2ssIGludmVydCApIHsKCQkJdmFyIGNhbGxiYWNrSW52ZXJzZSwKCQkJCW1hdGNoZXMgPSBbXSwKCQkJCWkgPSAwLAoJCQkJbGVuZ3RoID0gZWxlbXMubGVuZ3RoLAoJCQkJY2FsbGJhY2tFeHBlY3QgPSAhaW52ZXJ0OwoKCQkJLy8gR28gdGhyb3VnaCB0aGUgYXJyYXksIG9ubHkgc2F2aW5nIHRoZSBpdGVtcwoJCQkvLyB0aGF0IHBhc3MgdGhlIHZhbGlkYXRvciBmdW5jdGlvbgoJCQlmb3IgKCA7IGkgPCBsZW5ndGg7IGkrKyApIHsKCQkJCWNhbGxiYWNrSW52ZXJzZSA9ICFjYWxsYmFjayggZWxlbXNbIGkgXSwgaSApOwoJCQkJaWYgKCBjYWxsYmFja0ludmVyc2UgIT09IGNhbGxiYWNrRXhwZWN0ICkgewoJCQkJCW1hdGNoZXMucHVzaCggZWxlbXNbIGkgXSApOwoJCQkJfQoJCQl9CgoJCQlyZXR1cm4gbWF0Y2hlczsKCQl9LAoKCQkvLyBhcmcgaXMgZm9yIGludGVybmFsIHVzYWdlIG9ubHkKCQltYXA6IGZ1bmN0aW9uKCBlbGVtcywgY2FsbGJhY2ssIGFyZyApIHsKCQkJdmFyIGxlbmd0aCwgdmFsdWUsCgkJCQlpID0gMCwKCQkJCXJldCA9IFtdOwoKCQkJLy8gR28gdGhyb3VnaCB0aGUgYXJyYXksIHRyYW5zbGF0aW5nIGVhY2ggb2YgdGhlIGl0ZW1zIHRvIHRoZWlyIG5ldyB2YWx1ZXMKCQkJaWYgKCBpc0FycmF5TGlrZSggZWxlbXMgKSApIHsKCQkJCWxlbmd0aCA9IGVsZW1zLmxlbmd0aDsKCQkJCWZvciAoIDsgaSA8IGxlbmd0aDsgaSsrICkgewoJCQkJCXZhbHVlID0gY2FsbGJhY2soIGVsZW1zWyBpIF0sIGksIGFyZyApOwoKCQkJCQlpZiAoIHZhbHVlICE9IG51bGwgKSB7CgkJCQkJCXJldC5wdXNoKCB2YWx1ZSApOwoJCQkJCX0KCQkJCX0KCgkJCS8vIEdvIHRocm91Z2ggZXZlcnkga2V5IG9uIHRoZSBvYmplY3QsCgkJCX0gZWxzZSB7CgkJCQlmb3IgKCBpIGluIGVsZW1zICkgewoJCQkJCXZhbHVlID0gY2FsbGJhY2soIGVsZW1zWyBpIF0sIGksIGFyZyApOwoKCQkJCQlpZiAoIHZhbHVlICE9IG51bGwgKSB7CgkJCQkJCXJldC5wdXNoKCB2YWx1ZSApOwoJCQkJCX0KCQkJCX0KCQkJfQoKCQkJLy8gRmxhdHRlbiBhbnkgbmVzdGVkIGFycmF5cwoJCQlyZXR1cm4gY29uY2F0LmFwcGx5KCBbXSwgcmV0ICk7CgkJfSwKCgkJLy8gQSBnbG9iYWwgR1VJRCBjb3VudGVyIGZvciBvYmplY3RzCgkJZ3VpZDogMSwKCgkJLy8gQmluZCBhIGZ1bmN0aW9uIHRvIGEgY29udGV4dCwgb3B0aW9uYWxseSBwYXJ0aWFsbHkgYXBwbHlpbmcgYW55CgkJLy8gYXJndW1lbnRzLgoJCXByb3h5OiBmdW5jdGlvbiggZm4sIGNvbnRleHQgKSB7CgkJCXZhciBhcmdzLCBwcm94eSwgdG1wOwoKCQkJaWYgKCB0eXBlb2YgY29udGV4dCA9PT0gInN0cmluZyIgKSB7CgkJCQl0bXAgPSBmblsgY29udGV4dCBdOwoJCQkJY29udGV4dCA9IGZuOwoJCQkJZm4gPSB0bXA7CgkJCX0KCgkJCS8vIFF1aWNrIGNoZWNrIHRvIGRldGVybWluZSBpZiB0YXJnZXQgaXMgY2FsbGFibGUsIGluIHRoZSBzcGVjCgkJCS8vIHRoaXMgdGhyb3dzIGEgVHlwZUVycm9yLCBidXQgd2Ugd2lsbCBqdXN0IHJldHVybiB1bmRlZmluZWQuCgkJCWlmICggIWpRdWVyeS5pc0Z1bmN0aW9uKCBmbiApICkgewoJCQkJcmV0dXJuIHVuZGVmaW5lZDsKCQkJfQoKCQkJLy8gU2ltdWxhdGVkIGJpbmQKCQkJYXJncyA9IHNsaWNlLmNhbGwoIGFyZ3VtZW50cywgMiApOwoJCQlwcm94eSA9IGZ1bmN0aW9uKCkgewoJCQkJcmV0dXJuIGZuLmFwcGx5KCBjb250ZXh0IHx8IHRoaXMsIGFyZ3MuY29uY2F0KCBzbGljZS5jYWxsKCBhcmd1bWVudHMgKSApICk7CgkJCX07CgoJCQkvLyBTZXQgdGhlIGd1aWQgb2YgdW5pcXVlIGhhbmRsZXIgdG8gdGhlIHNhbWUgb2Ygb3JpZ2luYWwgaGFuZGxlciwgc28gaXQgY2FuIGJlIHJlbW92ZWQKCQkJcHJveHkuZ3VpZCA9IGZuLmd1aWQgPSBmbi5ndWlkIHx8IGpRdWVyeS5ndWlkKys7CgoJCQlyZXR1cm4gcHJveHk7CgkJfSwKCgkJbm93OiBmdW5jdGlvbigpIHsKCQkJcmV0dXJuICsoIG5ldyBEYXRlKCkgKTsKCQl9LAoKCQkvLyBqUXVlcnkuc3VwcG9ydCBpcyBub3QgdXNlZCBpbiBDb3JlIGJ1dCBvdGhlciBwcm9qZWN0cyBhdHRhY2ggdGhlaXIKCQkvLyBwcm9wZXJ0aWVzIHRvIGl0IHNvIGl0IG5lZWRzIHRvIGV4aXN0LgoJCXN1cHBvcnQ6IHN1cHBvcnQKCX0gKTsKCgkvLyBKU0hpbnQgd291bGQgZXJyb3Igb24gdGhpcyBjb2RlIGR1ZSB0byB0aGUgU3ltYm9sIG5vdCBiZWluZyBkZWZpbmVkIGluIEVTNS4KCS8vIERlZmluaW5nIHRoaXMgZ2xvYmFsIGluIC5qc2hpbnRyYyB3b3VsZCBjcmVhdGUgYSBkYW5nZXIgb2YgdXNpbmcgdGhlIGdsb2JhbAoJLy8gdW5ndWFyZGVkIGluIGFub3RoZXIgcGxhY2UsIGl0IHNlZW1zIHNhZmVyIHRvIGp1c3QgZGlzYWJsZSBKU0hpbnQgZm9yIHRoZXNlCgkvLyB0aHJlZSBsaW5lcy4KCS8qIGpzaGludCBpZ25vcmU6IHN0YXJ0ICovCglpZiAoIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgKSB7CgkJalF1ZXJ5LmZuWyBTeW1ib2wuaXRlcmF0b3IgXSA9IGRlbGV0ZWRJZHNbIFN5bWJvbC5pdGVyYXRvciBdOwoJfQoJLyoganNoaW50IGlnbm9yZTogZW5kICovCgoJLy8gUG9wdWxhdGUgdGhlIGNsYXNzMnR5cGUgbWFwCglqUXVlcnkuZWFjaCggIkJvb2xlYW4gTnVtYmVyIFN0cmluZyBGdW5jdGlvbiBBcnJheSBEYXRlIFJlZ0V4cCBPYmplY3QgRXJyb3IgU3ltYm9sIi5zcGxpdCggIiAiICksCglmdW5jdGlvbiggaSwgbmFtZSApIHsKCQljbGFzczJ0eXBlWyAiW29iamVjdCAiICsgbmFtZSArICJdIiBdID0gbmFtZS50b0xvd2VyQ2FzZSgpOwoJfSApOwoKCWZ1bmN0aW9uIGlzQXJyYXlMaWtlKCBvYmogKSB7CgoJCS8vIFN1cHBvcnQ6IGlPUyA4LjIgKG5vdCByZXByb2R1Y2libGUgaW4gc2ltdWxhdG9yKQoJCS8vIGBpbmAgY2hlY2sgdXNlZCB0byBwcmV2ZW50IEpJVCBlcnJvciAoZ2gtMjE0NSkKCQkvLyBoYXNPd24gaXNuJ3QgdXNlZCBoZXJlIGR1ZSB0byBmYWxzZSBuZWdhdGl2ZXMKCQkvLyByZWdhcmRpbmcgTm9kZWxpc3QgbGVuZ3RoIGluIElFCgkJdmFyIGxlbmd0aCA9ICEhb2JqICYmICJsZW5ndGgiIGluIG9iaiAmJiBvYmoubGVuZ3RoLAoJCQl0eXBlID0galF1ZXJ5LnR5cGUoIG9iaiApOwoKCQlpZiAoIHR5cGUgPT09ICJmdW5jdGlvbiIgfHwgalF1ZXJ5LmlzV2luZG93KCBvYmogKSApIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgkJcmV0dXJuIHR5cGUgPT09ICJhcnJheSIgfHwgbGVuZ3RoID09PSAwIHx8CgkJCXR5cGVvZiBsZW5ndGggPT09ICJudW1iZXIiICYmIGxlbmd0aCA+IDAgJiYgKCBsZW5ndGggLSAxICkgaW4gb2JqOwoJfQoJdmFyIFNpenpsZSA9CgkvKiEKCSAqIFNpenpsZSBDU1MgU2VsZWN0b3IgRW5naW5lIHYyLjIuMQoJICogaHR0cDovL3NpenpsZWpzLmNvbS8KCSAqCgkgKiBDb3B5cmlnaHQgalF1ZXJ5IEZvdW5kYXRpb24gYW5kIG90aGVyIGNvbnRyaWJ1dG9ycwoJICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlCgkgKiBodHRwOi8vanF1ZXJ5Lm9yZy9saWNlbnNlCgkgKgoJICogRGF0ZTogMjAxNS0xMC0xNwoJICovCgkoZnVuY3Rpb24oIHdpbmRvdyApIHsKCgl2YXIgaSwKCQlzdXBwb3J0LAoJCUV4cHIsCgkJZ2V0VGV4dCwKCQlpc1hNTCwKCQl0b2tlbml6ZSwKCQljb21waWxlLAoJCXNlbGVjdCwKCQlvdXRlcm1vc3RDb250ZXh0LAoJCXNvcnRJbnB1dCwKCQloYXNEdXBsaWNhdGUsCgoJCS8vIExvY2FsIGRvY3VtZW50IHZhcnMKCQlzZXREb2N1bWVudCwKCQlkb2N1bWVudCwKCQlkb2NFbGVtLAoJCWRvY3VtZW50SXNIVE1MLAoJCXJidWdneVFTQSwKCQlyYnVnZ3lNYXRjaGVzLAoJCW1hdGNoZXMsCgkJY29udGFpbnMsCgoJCS8vIEluc3RhbmNlLXNwZWNpZmljIGRhdGEKCQlleHBhbmRvID0gInNpenpsZSIgKyAxICogbmV3IERhdGUoKSwKCQlwcmVmZXJyZWREb2MgPSB3aW5kb3cuZG9jdW1lbnQsCgkJZGlycnVucyA9IDAsCgkJZG9uZSA9IDAsCgkJY2xhc3NDYWNoZSA9IGNyZWF0ZUNhY2hlKCksCgkJdG9rZW5DYWNoZSA9IGNyZWF0ZUNhY2hlKCksCgkJY29tcGlsZXJDYWNoZSA9IGNyZWF0ZUNhY2hlKCksCgkJc29ydE9yZGVyID0gZnVuY3Rpb24oIGEsIGIgKSB7CgkJCWlmICggYSA9PT0gYiApIHsKCQkJCWhhc0R1cGxpY2F0ZSA9IHRydWU7CgkJCX0KCQkJcmV0dXJuIDA7CgkJfSwKCgkJLy8gR2VuZXJhbC1wdXJwb3NlIGNvbnN0YW50cwoJCU1BWF9ORUdBVElWRSA9IDEgPDwgMzEsCgoJCS8vIEluc3RhbmNlIG1ldGhvZHMKCQloYXNPd24gPSAoe30pLmhhc093blByb3BlcnR5LAoJCWFyciA9IFtdLAoJCXBvcCA9IGFyci5wb3AsCgkJcHVzaF9uYXRpdmUgPSBhcnIucHVzaCwKCQlwdXNoID0gYXJyLnB1c2gsCgkJc2xpY2UgPSBhcnIuc2xpY2UsCgkJLy8gVXNlIGEgc3RyaXBwZWQtZG93biBpbmRleE9mIGFzIGl0J3MgZmFzdGVyIHRoYW4gbmF0aXZlCgkJLy8gaHR0cDovL2pzcGVyZi5jb20vdGhvci1pbmRleG9mLXZzLWZvci81CgkJaW5kZXhPZiA9IGZ1bmN0aW9uKCBsaXN0LCBlbGVtICkgewoJCQl2YXIgaSA9IDAsCgkJCQlsZW4gPSBsaXN0Lmxlbmd0aDsKCQkJZm9yICggOyBpIDwgbGVuOyBpKysgKSB7CgkJCQlpZiAoIGxpc3RbaV0gPT09IGVsZW0gKSB7CgkJCQkJcmV0dXJuIGk7CgkJCQl9CgkJCX0KCQkJcmV0dXJuIC0xOwoJCX0sCgoJCWJvb2xlYW5zID0gImNoZWNrZWR8c2VsZWN0ZWR8YXN5bmN8YXV0b2ZvY3VzfGF1dG9wbGF5fGNvbnRyb2xzfGRlZmVyfGRpc2FibGVkfGhpZGRlbnxpc21hcHxsb29wfG11bHRpcGxlfG9wZW58cmVhZG9ubHl8cmVxdWlyZWR8c2NvcGVkIiwKCgkJLy8gUmVndWxhciBleHByZXNzaW9ucwoKCQkvLyBodHRwOi8vd3d3LnczLm9yZy9UUi9jc3MzLXNlbGVjdG9ycy8jd2hpdGVzcGFjZQoJCXdoaXRlc3BhY2UgPSAiW1xceDIwXFx0XFxyXFxuXFxmXSIsCgoJCS8vIGh0dHA6Ly93d3cudzMub3JnL1RSL0NTUzIxL3N5bmRhdGEuaHRtbCN2YWx1ZS1kZWYtaWRlbnRpZmllcgoJCWlkZW50aWZpZXIgPSAiKD86XFxcXC58W1xcdy1dfFteXFx4MDAtXFx4YTBdKSsiLAoKCQkvLyBBdHRyaWJ1dGUgc2VsZWN0b3JzOiBodHRwOi8vd3d3LnczLm9yZy9UUi9zZWxlY3RvcnMvI2F0dHJpYnV0ZS1zZWxlY3RvcnMKCQlhdHRyaWJ1dGVzID0gIlxcWyIgKyB3aGl0ZXNwYWNlICsgIiooIiArIGlkZW50aWZpZXIgKyAiKSg/OiIgKyB3aGl0ZXNwYWNlICsKCQkJLy8gT3BlcmF0b3IgKGNhcHR1cmUgMikKCQkJIiooWypeJHwhfl0/PSkiICsgd2hpdGVzcGFjZSArCgkJCS8vICJBdHRyaWJ1dGUgdmFsdWVzIG11c3QgYmUgQ1NTIGlkZW50aWZpZXJzIFtjYXB0dXJlIDVdIG9yIHN0cmluZ3MgW2NhcHR1cmUgMyBvciBjYXB0dXJlIDRdIgoJCQkiKig/OicoKD86XFxcXC58W15cXFxcJ10pKiknfFwiKCg/OlxcXFwufFteXFxcXFwiXSkqKVwifCgiICsgaWRlbnRpZmllciArICIpKXwpIiArIHdoaXRlc3BhY2UgKwoJCQkiKlxcXSIsCgoJCXBzZXVkb3MgPSAiOigiICsgaWRlbnRpZmllciArICIpKD86XFwoKCIgKwoJCQkvLyBUbyByZWR1Y2UgdGhlIG51bWJlciBvZiBzZWxlY3RvcnMgbmVlZGluZyB0b2tlbml6ZSBpbiB0aGUgcHJlRmlsdGVyLCBwcmVmZXIgYXJndW1lbnRzOgoJCQkvLyAxLiBxdW90ZWQgKGNhcHR1cmUgMzsgY2FwdHVyZSA0IG9yIGNhcHR1cmUgNSkKCQkJIignKCg/OlxcXFwufFteXFxcXCddKSopJ3xcIigoPzpcXFxcLnxbXlxcXFxcIl0pKilcIil8IiArCgkJCS8vIDIuIHNpbXBsZSAoY2FwdHVyZSA2KQoJCQkiKCg/OlxcXFwufFteXFxcXCgpW1xcXV18IiArIGF0dHJpYnV0ZXMgKyAiKSopfCIgKwoJCQkvLyAzLiBhbnl0aGluZyBlbHNlIChjYXB0dXJlIDIpCgkJCSIuKiIgKwoJCQkiKVxcKXwpIiwKCgkJLy8gTGVhZGluZyBhbmQgbm9uLWVzY2FwZWQgdHJhaWxpbmcgd2hpdGVzcGFjZSwgY2FwdHVyaW5nIHNvbWUgbm9uLXdoaXRlc3BhY2UgY2hhcmFjdGVycyBwcmVjZWRpbmcgdGhlIGxhdHRlcgoJCXJ3aGl0ZXNwYWNlID0gbmV3IFJlZ0V4cCggd2hpdGVzcGFjZSArICIrIiwgImciICksCgkJcnRyaW0gPSBuZXcgUmVnRXhwKCAiXiIgKyB3aGl0ZXNwYWNlICsgIit8KCg/Ol58W15cXFxcXSkoPzpcXFxcLikqKSIgKyB3aGl0ZXNwYWNlICsgIiskIiwgImciICksCgoJCXJjb21tYSA9IG5ldyBSZWdFeHAoICJeIiArIHdoaXRlc3BhY2UgKyAiKiwiICsgd2hpdGVzcGFjZSArICIqIiApLAoJCXJjb21iaW5hdG9ycyA9IG5ldyBSZWdFeHAoICJeIiArIHdoaXRlc3BhY2UgKyAiKihbPit+XXwiICsgd2hpdGVzcGFjZSArICIpIiArIHdoaXRlc3BhY2UgKyAiKiIgKSwKCgkJcmF0dHJpYnV0ZVF1b3RlcyA9IG5ldyBSZWdFeHAoICI9IiArIHdoaXRlc3BhY2UgKyAiKihbXlxcXSdcIl0qPykiICsgd2hpdGVzcGFjZSArICIqXFxdIiwgImciICksCgoJCXJwc2V1ZG8gPSBuZXcgUmVnRXhwKCBwc2V1ZG9zICksCgkJcmlkZW50aWZpZXIgPSBuZXcgUmVnRXhwKCAiXiIgKyBpZGVudGlmaWVyICsgIiQiICksCgoJCW1hdGNoRXhwciA9IHsKCQkJIklEIjogbmV3IFJlZ0V4cCggIl4jKCIgKyBpZGVudGlmaWVyICsgIikiICksCgkJCSJDTEFTUyI6IG5ldyBSZWdFeHAoICJeXFwuKCIgKyBpZGVudGlmaWVyICsgIikiICksCgkJCSJUQUciOiBuZXcgUmVnRXhwKCAiXigiICsgaWRlbnRpZmllciArICJ8WypdKSIgKSwKCQkJIkFUVFIiOiBuZXcgUmVnRXhwKCAiXiIgKyBhdHRyaWJ1dGVzICksCgkJCSJQU0VVRE8iOiBuZXcgUmVnRXhwKCAiXiIgKyBwc2V1ZG9zICksCgkJCSJDSElMRCI6IG5ldyBSZWdFeHAoICJeOihvbmx5fGZpcnN0fGxhc3R8bnRofG50aC1sYXN0KS0oY2hpbGR8b2YtdHlwZSkoPzpcXCgiICsgd2hpdGVzcGFjZSArCgkJCQkiKihldmVufG9kZHwoKFsrLV18KShcXGQqKW58KSIgKyB3aGl0ZXNwYWNlICsgIiooPzooWystXXwpIiArIHdoaXRlc3BhY2UgKwoJCQkJIiooXFxkKyl8KSkiICsgd2hpdGVzcGFjZSArICIqXFwpfCkiLCAiaSIgKSwKCQkJImJvb2wiOiBuZXcgUmVnRXhwKCAiXig/OiIgKyBib29sZWFucyArICIpJCIsICJpIiApLAoJCQkvLyBGb3IgdXNlIGluIGxpYnJhcmllcyBpbXBsZW1lbnRpbmcgLmlzKCkKCQkJLy8gV2UgdXNlIHRoaXMgZm9yIFBPUyBtYXRjaGluZyBpbiBgc2VsZWN0YAoJCQkibmVlZHNDb250ZXh0IjogbmV3IFJlZ0V4cCggIl4iICsgd2hpdGVzcGFjZSArICIqWz4rfl18OihldmVufG9kZHxlcXxndHxsdHxudGh8Zmlyc3R8bGFzdCkoPzpcXCgiICsKCQkJCXdoaXRlc3BhY2UgKyAiKigoPzotXFxkKT9cXGQqKSIgKyB3aGl0ZXNwYWNlICsgIipcXCl8KSg/PVteLV18JCkiLCAiaSIgKQoJCX0sCgoJCXJpbnB1dHMgPSAvXig/OmlucHV0fHNlbGVjdHx0ZXh0YXJlYXxidXR0b24pJC9pLAoJCXJoZWFkZXIgPSAvXmhcZCQvaSwKCgkJcm5hdGl2ZSA9IC9eW157XStce1xzKlxbbmF0aXZlIFx3LywKCgkJLy8gRWFzaWx5LXBhcnNlYWJsZS9yZXRyaWV2YWJsZSBJRCBvciBUQUcgb3IgQ0xBU1Mgc2VsZWN0b3JzCgkJcnF1aWNrRXhwciA9IC9eKD86IyhbXHctXSspfChcdyspfFwuKFtcdy1dKykpJC8sCgoJCXJzaWJsaW5nID0gL1srfl0vLAoJCXJlc2NhcGUgPSAvJ3xcXC9nLAoKCQkvLyBDU1MgZXNjYXBlcyBodHRwOi8vd3d3LnczLm9yZy9UUi9DU1MyMS9zeW5kYXRhLmh0bWwjZXNjYXBlZC1jaGFyYWN0ZXJzCgkJcnVuZXNjYXBlID0gbmV3IFJlZ0V4cCggIlxcXFwoW1xcZGEtZl17MSw2fSIgKyB3aGl0ZXNwYWNlICsgIj98KCIgKyB3aGl0ZXNwYWNlICsgIil8LikiLCAiaWciICksCgkJZnVuZXNjYXBlID0gZnVuY3Rpb24oIF8sIGVzY2FwZWQsIGVzY2FwZWRXaGl0ZXNwYWNlICkgewoJCQl2YXIgaGlnaCA9ICIweCIgKyBlc2NhcGVkIC0gMHgxMDAwMDsKCQkJLy8gTmFOIG1lYW5zIG5vbi1jb2RlcG9pbnQKCQkJLy8gU3VwcG9ydDogRmlyZWZveDwyNAoJCQkvLyBXb3JrYXJvdW5kIGVycm9uZW91cyBudW1lcmljIGludGVycHJldGF0aW9uIG9mICsiMHgiCgkJCXJldHVybiBoaWdoICE9PSBoaWdoIHx8IGVzY2FwZWRXaGl0ZXNwYWNlID8KCQkJCWVzY2FwZWQgOgoJCQkJaGlnaCA8IDAgPwoJCQkJCS8vIEJNUCBjb2RlcG9pbnQKCQkJCQlTdHJpbmcuZnJvbUNoYXJDb2RlKCBoaWdoICsgMHgxMDAwMCApIDoKCQkJCQkvLyBTdXBwbGVtZW50YWwgUGxhbmUgY29kZXBvaW50IChzdXJyb2dhdGUgcGFpcikKCQkJCQlTdHJpbmcuZnJvbUNoYXJDb2RlKCBoaWdoID4+IDEwIHwgMHhEODAwLCBoaWdoICYgMHgzRkYgfCAweERDMDAgKTsKCQl9LAoKCQkvLyBVc2VkIGZvciBpZnJhbWVzCgkJLy8gU2VlIHNldERvY3VtZW50KCkKCQkvLyBSZW1vdmluZyB0aGUgZnVuY3Rpb24gd3JhcHBlciBjYXVzZXMgYSAiUGVybWlzc2lvbiBEZW5pZWQiCgkJLy8gZXJyb3IgaW4gSUUKCQl1bmxvYWRIYW5kbGVyID0gZnVuY3Rpb24oKSB7CgkJCXNldERvY3VtZW50KCk7CgkJfTsKCgkvLyBPcHRpbWl6ZSBmb3IgcHVzaC5hcHBseSggXywgTm9kZUxpc3QgKQoJdHJ5IHsKCQlwdXNoLmFwcGx5KAoJCQkoYXJyID0gc2xpY2UuY2FsbCggcHJlZmVycmVkRG9jLmNoaWxkTm9kZXMgKSksCgkJCXByZWZlcnJlZERvYy5jaGlsZE5vZGVzCgkJKTsKCQkvLyBTdXBwb3J0OiBBbmRyb2lkPDQuMAoJCS8vIERldGVjdCBzaWxlbnRseSBmYWlsaW5nIHB1c2guYXBwbHkKCQlhcnJbIHByZWZlcnJlZERvYy5jaGlsZE5vZGVzLmxlbmd0aCBdLm5vZGVUeXBlOwoJfSBjYXRjaCAoIGUgKSB7CgkJcHVzaCA9IHsgYXBwbHk6IGFyci5sZW5ndGggPwoKCQkJLy8gTGV2ZXJhZ2Ugc2xpY2UgaWYgcG9zc2libGUKCQkJZnVuY3Rpb24oIHRhcmdldCwgZWxzICkgewoJCQkJcHVzaF9uYXRpdmUuYXBwbHkoIHRhcmdldCwgc2xpY2UuY2FsbChlbHMpICk7CgkJCX0gOgoKCQkJLy8gU3VwcG9ydDogSUU8OQoJCQkvLyBPdGhlcndpc2UgYXBwZW5kIGRpcmVjdGx5CgkJCWZ1bmN0aW9uKCB0YXJnZXQsIGVscyApIHsKCQkJCXZhciBqID0gdGFyZ2V0Lmxlbmd0aCwKCQkJCQlpID0gMDsKCQkJCS8vIENhbid0IHRydXN0IE5vZGVMaXN0Lmxlbmd0aAoJCQkJd2hpbGUgKCAodGFyZ2V0W2orK10gPSBlbHNbaSsrXSkgKSB7fQoJCQkJdGFyZ2V0Lmxlbmd0aCA9IGogLSAxOwoJCQl9CgkJfTsKCX0KCglmdW5jdGlvbiBTaXp6bGUoIHNlbGVjdG9yLCBjb250ZXh0LCByZXN1bHRzLCBzZWVkICkgewoJCXZhciBtLCBpLCBlbGVtLCBuaWQsIG5pZHNlbGVjdCwgbWF0Y2gsIGdyb3VwcywgbmV3U2VsZWN0b3IsCgkJCW5ld0NvbnRleHQgPSBjb250ZXh0ICYmIGNvbnRleHQub3duZXJEb2N1bWVudCwKCgkJCS8vIG5vZGVUeXBlIGRlZmF1bHRzIHRvIDksIHNpbmNlIGNvbnRleHQgZGVmYXVsdHMgdG8gZG9jdW1lbnQKCQkJbm9kZVR5cGUgPSBjb250ZXh0ID8gY29udGV4dC5ub2RlVHlwZSA6IDk7CgoJCXJlc3VsdHMgPSByZXN1bHRzIHx8IFtdOwoKCQkvLyBSZXR1cm4gZWFybHkgZnJvbSBjYWxscyB3aXRoIGludmFsaWQgc2VsZWN0b3Igb3IgY29udGV4dAoJCWlmICggdHlwZW9mIHNlbGVjdG9yICE9PSAic3RyaW5nIiB8fCAhc2VsZWN0b3IgfHwKCQkJbm9kZVR5cGUgIT09IDEgJiYgbm9kZVR5cGUgIT09IDkgJiYgbm9kZVR5cGUgIT09IDExICkgewoKCQkJcmV0dXJuIHJlc3VsdHM7CgkJfQoKCQkvLyBUcnkgdG8gc2hvcnRjdXQgZmluZCBvcGVyYXRpb25zIChhcyBvcHBvc2VkIHRvIGZpbHRlcnMpIGluIEhUTUwgZG9jdW1lbnRzCgkJaWYgKCAhc2VlZCApIHsKCgkJCWlmICggKCBjb250ZXh0ID8gY29udGV4dC5vd25lckRvY3VtZW50IHx8IGNvbnRleHQgOiBwcmVmZXJyZWREb2MgKSAhPT0gZG9jdW1lbnQgKSB7CgkJCQlzZXREb2N1bWVudCggY29udGV4dCApOwoJCQl9CgkJCWNvbnRleHQgPSBjb250ZXh0IHx8IGRvY3VtZW50OwoKCQkJaWYgKCBkb2N1bWVudElzSFRNTCApIHsKCgkJCQkvLyBJZiB0aGUgc2VsZWN0b3IgaXMgc3VmZmljaWVudGx5IHNpbXBsZSwgdHJ5IHVzaW5nIGEgImdldCpCeSoiIERPTSBtZXRob2QKCQkJCS8vIChleGNlcHRpbmcgRG9jdW1lbnRGcmFnbWVudCBjb250ZXh0LCB3aGVyZSB0aGUgbWV0aG9kcyBkb24ndCBleGlzdCkKCQkJCWlmICggbm9kZVR5cGUgIT09IDExICYmIChtYXRjaCA9IHJxdWlja0V4cHIuZXhlYyggc2VsZWN0b3IgKSkgKSB7CgoJCQkJCS8vIElEIHNlbGVjdG9yCgkJCQkJaWYgKCAobSA9IG1hdGNoWzFdKSApIHsKCgkJCQkJCS8vIERvY3VtZW50IGNvbnRleHQKCQkJCQkJaWYgKCBub2RlVHlwZSA9PT0gOSApIHsKCQkJCQkJCWlmICggKGVsZW0gPSBjb250ZXh0LmdldEVsZW1lbnRCeUlkKCBtICkpICkgewoKCQkJCQkJCQkvLyBTdXBwb3J0OiBJRSwgT3BlcmEsIFdlYmtpdAoJCQkJCQkJCS8vIFRPRE86IGlkZW50aWZ5IHZlcnNpb25zCgkJCQkJCQkJLy8gZ2V0RWxlbWVudEJ5SWQgY2FuIG1hdGNoIGVsZW1lbnRzIGJ5IG5hbWUgaW5zdGVhZCBvZiBJRAoJCQkJCQkJCWlmICggZWxlbS5pZCA9PT0gbSApIHsKCQkJCQkJCQkJcmVzdWx0cy5wdXNoKCBlbGVtICk7CgkJCQkJCQkJCXJldHVybiByZXN1bHRzOwoJCQkJCQkJCX0KCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJcmV0dXJuIHJlc3VsdHM7CgkJCQkJCQl9CgoJCQkJCQkvLyBFbGVtZW50IGNvbnRleHQKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkvLyBTdXBwb3J0OiBJRSwgT3BlcmEsIFdlYmtpdAoJCQkJCQkJLy8gVE9ETzogaWRlbnRpZnkgdmVyc2lvbnMKCQkJCQkJCS8vIGdldEVsZW1lbnRCeUlkIGNhbiBtYXRjaCBlbGVtZW50cyBieSBuYW1lIGluc3RlYWQgb2YgSUQKCQkJCQkJCWlmICggbmV3Q29udGV4dCAmJiAoZWxlbSA9IG5ld0NvbnRleHQuZ2V0RWxlbWVudEJ5SWQoIG0gKSkgJiYKCQkJCQkJCQljb250YWlucyggY29udGV4dCwgZWxlbSApICYmCgkJCQkJCQkJZWxlbS5pZCA9PT0gbSApIHsKCgkJCQkJCQkJcmVzdWx0cy5wdXNoKCBlbGVtICk7CgkJCQkJCQkJcmV0dXJuIHJlc3VsdHM7CgkJCQkJCQl9CgkJCQkJCX0KCgkJCQkJLy8gVHlwZSBzZWxlY3RvcgoJCQkJCX0gZWxzZSBpZiAoIG1hdGNoWzJdICkgewoJCQkJCQlwdXNoLmFwcGx5KCByZXN1bHRzLCBjb250ZXh0LmdldEVsZW1lbnRzQnlUYWdOYW1lKCBzZWxlY3RvciApICk7CgkJCQkJCXJldHVybiByZXN1bHRzOwoKCQkJCQkvLyBDbGFzcyBzZWxlY3RvcgoJCQkJCX0gZWxzZSBpZiAoIChtID0gbWF0Y2hbM10pICYmIHN1cHBvcnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSAmJgoJCQkJCQljb250ZXh0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUgKSB7CgoJCQkJCQlwdXNoLmFwcGx5KCByZXN1bHRzLCBjb250ZXh0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoIG0gKSApOwoJCQkJCQlyZXR1cm4gcmVzdWx0czsKCQkJCQl9CgkJCQl9CgoJCQkJLy8gVGFrZSBhZHZhbnRhZ2Ugb2YgcXVlcnlTZWxlY3RvckFsbAoJCQkJaWYgKCBzdXBwb3J0LnFzYSAmJgoJCQkJCSFjb21waWxlckNhY2hlWyBzZWxlY3RvciArICIgIiBdICYmCgkJCQkJKCFyYnVnZ3lRU0EgfHwgIXJidWdneVFTQS50ZXN0KCBzZWxlY3RvciApKSApIHsKCgkJCQkJaWYgKCBub2RlVHlwZSAhPT0gMSApIHsKCQkJCQkJbmV3Q29udGV4dCA9IGNvbnRleHQ7CgkJCQkJCW5ld1NlbGVjdG9yID0gc2VsZWN0b3I7CgoJCQkJCS8vIHFTQSBsb29rcyBvdXRzaWRlIEVsZW1lbnQgY29udGV4dCwgd2hpY2ggaXMgbm90IHdoYXQgd2Ugd2FudAoJCQkJCS8vIFRoYW5rcyB0byBBbmRyZXcgRHVwb250IGZvciB0aGlzIHdvcmthcm91bmQgdGVjaG5pcXVlCgkJCQkJLy8gU3VwcG9ydDogSUUgPD04CgkJCQkJLy8gRXhjbHVkZSBvYmplY3QgZWxlbWVudHMKCQkJCQl9IGVsc2UgaWYgKCBjb250ZXh0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgIT09ICJvYmplY3QiICkgewoKCQkJCQkJLy8gQ2FwdHVyZSB0aGUgY29udGV4dCBJRCwgc2V0dGluZyBpdCBmaXJzdCBpZiBuZWNlc3NhcnkKCQkJCQkJaWYgKCAobmlkID0gY29udGV4dC5nZXRBdHRyaWJ1dGUoICJpZCIgKSkgKSB7CgkJCQkJCQluaWQgPSBuaWQucmVwbGFjZSggcmVzY2FwZSwgIlxcJCYiICk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQljb250ZXh0LnNldEF0dHJpYnV0ZSggImlkIiwgKG5pZCA9IGV4cGFuZG8pICk7CgkJCQkJCX0KCgkJCQkJCS8vIFByZWZpeCBldmVyeSBzZWxlY3RvciBpbiB0aGUgbGlzdAoJCQkJCQlncm91cHMgPSB0b2tlbml6ZSggc2VsZWN0b3IgKTsKCQkJCQkJaSA9IGdyb3Vwcy5sZW5ndGg7CgkJCQkJCW5pZHNlbGVjdCA9IHJpZGVudGlmaWVyLnRlc3QoIG5pZCApID8gIiMiICsgbmlkIDogIltpZD0nIiArIG5pZCArICInXSI7CgkJCQkJCXdoaWxlICggaS0tICkgewoJCQkJCQkJZ3JvdXBzW2ldID0gbmlkc2VsZWN0ICsgIiAiICsgdG9TZWxlY3RvciggZ3JvdXBzW2ldICk7CgkJCQkJCX0KCQkJCQkJbmV3U2VsZWN0b3IgPSBncm91cHMuam9pbiggIiwiICk7CgoJCQkJCQkvLyBFeHBhbmQgY29udGV4dCBmb3Igc2libGluZyBzZWxlY3RvcnMKCQkJCQkJbmV3Q29udGV4dCA9IHJzaWJsaW5nLnRlc3QoIHNlbGVjdG9yICkgJiYgdGVzdENvbnRleHQoIGNvbnRleHQucGFyZW50Tm9kZSApIHx8CgkJCQkJCQljb250ZXh0OwoJCQkJCX0KCgkJCQkJaWYgKCBuZXdTZWxlY3RvciApIHsKCQkJCQkJdHJ5IHsKCQkJCQkJCXB1c2guYXBwbHkoIHJlc3VsdHMsCgkJCQkJCQkJbmV3Q29udGV4dC5xdWVyeVNlbGVjdG9yQWxsKCBuZXdTZWxlY3RvciApCgkJCQkJCQkpOwoJCQkJCQkJcmV0dXJuIHJlc3VsdHM7CgkJCQkJCX0gY2F0Y2ggKCBxc2FFcnJvciApIHsKCQkJCQkJfSBmaW5hbGx5IHsKCQkJCQkJCWlmICggbmlkID09PSBleHBhbmRvICkgewoJCQkJCQkJCWNvbnRleHQucmVtb3ZlQXR0cmlidXRlKCAiaWQiICk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgoJCS8vIEFsbCBvdGhlcnMKCQlyZXR1cm4gc2VsZWN0KCBzZWxlY3Rvci5yZXBsYWNlKCBydHJpbSwgIiQxIiApLCBjb250ZXh0LCByZXN1bHRzLCBzZWVkICk7Cgl9CgoJLyoqCgkgKiBDcmVhdGUga2V5LXZhbHVlIGNhY2hlcyBvZiBsaW1pdGVkIHNpemUKCSAqIEByZXR1cm5zIHtmdW5jdGlvbihzdHJpbmcsIG9iamVjdCl9IFJldHVybnMgdGhlIE9iamVjdCBkYXRhIGFmdGVyIHN0b3JpbmcgaXQgb24gaXRzZWxmIHdpdGgKCSAqCXByb3BlcnR5IG5hbWUgdGhlIChzcGFjZS1zdWZmaXhlZCkgc3RyaW5nIGFuZCAoaWYgdGhlIGNhY2hlIGlzIGxhcmdlciB0aGFuIEV4cHIuY2FjaGVMZW5ndGgpCgkgKglkZWxldGluZyB0aGUgb2xkZXN0IGVudHJ5CgkgKi8KCWZ1bmN0aW9uIGNyZWF0ZUNhY2hlKCkgewoJCXZhciBrZXlzID0gW107CgoJCWZ1bmN0aW9uIGNhY2hlKCBrZXksIHZhbHVlICkgewoJCQkvLyBVc2UgKGtleSArICIgIikgdG8gYXZvaWQgY29sbGlzaW9uIHdpdGggbmF0aXZlIHByb3RvdHlwZSBwcm9wZXJ0aWVzIChzZWUgSXNzdWUgIzE1NykKCQkJaWYgKCBrZXlzLnB1c2goIGtleSArICIgIiApID4gRXhwci5jYWNoZUxlbmd0aCApIHsKCQkJCS8vIE9ubHkga2VlcCB0aGUgbW9zdCByZWNlbnQgZW50cmllcwoJCQkJZGVsZXRlIGNhY2hlWyBrZXlzLnNoaWZ0KCkgXTsKCQkJfQoJCQlyZXR1cm4gKGNhY2hlWyBrZXkgKyAiICIgXSA9IHZhbHVlKTsKCQl9CgkJcmV0dXJuIGNhY2hlOwoJfQoKCS8qKgoJICogTWFyayBhIGZ1bmN0aW9uIGZvciBzcGVjaWFsIHVzZSBieSBTaXp6bGUKCSAqIEBwYXJhbSB7RnVuY3Rpb259IGZuIFRoZSBmdW5jdGlvbiB0byBtYXJrCgkgKi8KCWZ1bmN0aW9uIG1hcmtGdW5jdGlvbiggZm4gKSB7CgkJZm5bIGV4cGFuZG8gXSA9IHRydWU7CgkJcmV0dXJuIGZuOwoJfQoKCS8qKgoJICogU3VwcG9ydCB0ZXN0aW5nIHVzaW5nIGFuIGVsZW1lbnQKCSAqIEBwYXJhbSB7RnVuY3Rpb259IGZuIFBhc3NlZCB0aGUgY3JlYXRlZCBkaXYgYW5kIGV4cGVjdHMgYSBib29sZWFuIHJlc3VsdAoJICovCglmdW5jdGlvbiBhc3NlcnQoIGZuICkgewoJCXZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKCgkJdHJ5IHsKCQkJcmV0dXJuICEhZm4oIGRpdiApOwoJCX0gY2F0Y2ggKGUpIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0gZmluYWxseSB7CgkJCS8vIFJlbW92ZSBmcm9tIGl0cyBwYXJlbnQgYnkgZGVmYXVsdAoJCQlpZiAoIGRpdi5wYXJlbnROb2RlICkgewoJCQkJZGl2LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoIGRpdiApOwoJCQl9CgkJCS8vIHJlbGVhc2UgbWVtb3J5IGluIElFCgkJCWRpdiA9IG51bGw7CgkJfQoJfQoKCS8qKgoJICogQWRkcyB0aGUgc2FtZSBoYW5kbGVyIGZvciBhbGwgb2YgdGhlIHNwZWNpZmllZCBhdHRycwoJICogQHBhcmFtIHtTdHJpbmd9IGF0dHJzIFBpcGUtc2VwYXJhdGVkIGxpc3Qgb2YgYXR0cmlidXRlcwoJICogQHBhcmFtIHtGdW5jdGlvbn0gaGFuZGxlciBUaGUgbWV0aG9kIHRoYXQgd2lsbCBiZSBhcHBsaWVkCgkgKi8KCWZ1bmN0aW9uIGFkZEhhbmRsZSggYXR0cnMsIGhhbmRsZXIgKSB7CgkJdmFyIGFyciA9IGF0dHJzLnNwbGl0KCJ8IiksCgkJCWkgPSBhcnIubGVuZ3RoOwoKCQl3aGlsZSAoIGktLSApIHsKCQkJRXhwci5hdHRySGFuZGxlWyBhcnJbaV0gXSA9IGhhbmRsZXI7CgkJfQoJfQoKCS8qKgoJICogQ2hlY2tzIGRvY3VtZW50IG9yZGVyIG9mIHR3byBzaWJsaW5ncwoJICogQHBhcmFtIHtFbGVtZW50fSBhCgkgKiBAcGFyYW0ge0VsZW1lbnR9IGIKCSAqIEByZXR1cm5zIHtOdW1iZXJ9IFJldHVybnMgbGVzcyB0aGFuIDAgaWYgYSBwcmVjZWRlcyBiLCBncmVhdGVyIHRoYW4gMCBpZiBhIGZvbGxvd3MgYgoJICovCglmdW5jdGlvbiBzaWJsaW5nQ2hlY2soIGEsIGIgKSB7CgkJdmFyIGN1ciA9IGIgJiYgYSwKCQkJZGlmZiA9IGN1ciAmJiBhLm5vZGVUeXBlID09PSAxICYmIGIubm9kZVR5cGUgPT09IDEgJiYKCQkJCSggfmIuc291cmNlSW5kZXggfHwgTUFYX05FR0FUSVZFICkgLQoJCQkJKCB+YS5zb3VyY2VJbmRleCB8fCBNQVhfTkVHQVRJVkUgKTsKCgkJLy8gVXNlIElFIHNvdXJjZUluZGV4IGlmIGF2YWlsYWJsZSBvbiBib3RoIG5vZGVzCgkJaWYgKCBkaWZmICkgewoJCQlyZXR1cm4gZGlmZjsKCQl9CgoJCS8vIENoZWNrIGlmIGIgZm9sbG93cyBhCgkJaWYgKCBjdXIgKSB7CgkJCXdoaWxlICggKGN1ciA9IGN1ci5uZXh0U2libGluZykgKSB7CgkJCQlpZiAoIGN1ciA9PT0gYiApIHsKCQkJCQlyZXR1cm4gLTE7CgkJCQl9CgkJCX0KCQl9CgoJCXJldHVybiBhID8gMSA6IC0xOwoJfQoKCS8qKgoJICogUmV0dXJucyBhIGZ1bmN0aW9uIHRvIHVzZSBpbiBwc2V1ZG9zIGZvciBpbnB1dCB0eXBlcwoJICogQHBhcmFtIHtTdHJpbmd9IHR5cGUKCSAqLwoJZnVuY3Rpb24gY3JlYXRlSW5wdXRQc2V1ZG8oIHR5cGUgKSB7CgkJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCQl2YXIgbmFtZSA9IGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKCQkJcmV0dXJuIG5hbWUgPT09ICJpbnB1dCIgJiYgZWxlbS50eXBlID09PSB0eXBlOwoJCX07Cgl9CgoJLyoqCgkgKiBSZXR1cm5zIGEgZnVuY3Rpb24gdG8gdXNlIGluIHBzZXVkb3MgZm9yIGJ1dHRvbnMKCSAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlCgkgKi8KCWZ1bmN0aW9uIGNyZWF0ZUJ1dHRvblBzZXVkbyggdHlwZSApIHsKCQlyZXR1cm4gZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXZhciBuYW1lID0gZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOwoJCQlyZXR1cm4gKG5hbWUgPT09ICJpbnB1dCIgfHwgbmFtZSA9PT0gImJ1dHRvbiIpICYmIGVsZW0udHlwZSA9PT0gdHlwZTsKCQl9OwoJfQoKCS8qKgoJICogUmV0dXJucyBhIGZ1bmN0aW9uIHRvIHVzZSBpbiBwc2V1ZG9zIGZvciBwb3NpdGlvbmFscwoJICogQHBhcmFtIHtGdW5jdGlvbn0gZm4KCSAqLwoJZnVuY3Rpb24gY3JlYXRlUG9zaXRpb25hbFBzZXVkbyggZm4gKSB7CgkJcmV0dXJuIG1hcmtGdW5jdGlvbihmdW5jdGlvbiggYXJndW1lbnQgKSB7CgkJCWFyZ3VtZW50ID0gK2FyZ3VtZW50OwoJCQlyZXR1cm4gbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBzZWVkLCBtYXRjaGVzICkgewoJCQkJdmFyIGosCgkJCQkJbWF0Y2hJbmRleGVzID0gZm4oIFtdLCBzZWVkLmxlbmd0aCwgYXJndW1lbnQgKSwKCQkJCQlpID0gbWF0Y2hJbmRleGVzLmxlbmd0aDsKCgkJCQkvLyBNYXRjaCBlbGVtZW50cyBmb3VuZCBhdCB0aGUgc3BlY2lmaWVkIGluZGV4ZXMKCQkJCXdoaWxlICggaS0tICkgewoJCQkJCWlmICggc2VlZFsgKGogPSBtYXRjaEluZGV4ZXNbaV0pIF0gKSB7CgkJCQkJCXNlZWRbal0gPSAhKG1hdGNoZXNbal0gPSBzZWVkW2pdKTsKCQkJCQl9CgkJCQl9CgkJCX0pOwoJCX0pOwoJfQoKCS8qKgoJICogQ2hlY2tzIGEgbm9kZSBmb3IgdmFsaWRpdHkgYXMgYSBTaXp6bGUgY29udGV4dAoJICogQHBhcmFtIHtFbGVtZW50fE9iamVjdD19IGNvbnRleHQKCSAqIEByZXR1cm5zIHtFbGVtZW50fE9iamVjdHxCb29sZWFufSBUaGUgaW5wdXQgbm9kZSBpZiBhY2NlcHRhYmxlLCBvdGhlcndpc2UgYSBmYWxzeSB2YWx1ZQoJICovCglmdW5jdGlvbiB0ZXN0Q29udGV4dCggY29udGV4dCApIHsKCQlyZXR1cm4gY29udGV4dCAmJiB0eXBlb2YgY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSAhPT0gInVuZGVmaW5lZCIgJiYgY29udGV4dDsKCX0KCgkvLyBFeHBvc2Ugc3VwcG9ydCB2YXJzIGZvciBjb252ZW5pZW5jZQoJc3VwcG9ydCA9IFNpenpsZS5zdXBwb3J0ID0ge307CgoJLyoqCgkgKiBEZXRlY3RzIFhNTCBub2RlcwoJICogQHBhcmFtIHtFbGVtZW50fE9iamVjdH0gZWxlbSBBbiBlbGVtZW50IG9yIGEgZG9jdW1lbnQKCSAqIEByZXR1cm5zIHtCb29sZWFufSBUcnVlIGlmZiBlbGVtIGlzIGEgbm9uLUhUTUwgWE1MIG5vZGUKCSAqLwoJaXNYTUwgPSBTaXp6bGUuaXNYTUwgPSBmdW5jdGlvbiggZWxlbSApIHsKCQkvLyBkb2N1bWVudEVsZW1lbnQgaXMgdmVyaWZpZWQgZm9yIGNhc2VzIHdoZXJlIGl0IGRvZXNuJ3QgeWV0IGV4aXN0CgkJLy8gKHN1Y2ggYXMgbG9hZGluZyBpZnJhbWVzIGluIElFIC0gIzQ4MzMpCgkJdmFyIGRvY3VtZW50RWxlbWVudCA9IGVsZW0gJiYgKGVsZW0ub3duZXJEb2N1bWVudCB8fCBlbGVtKS5kb2N1bWVudEVsZW1lbnQ7CgkJcmV0dXJuIGRvY3VtZW50RWxlbWVudCA/IGRvY3VtZW50RWxlbWVudC5ub2RlTmFtZSAhPT0gIkhUTUwiIDogZmFsc2U7Cgl9OwoKCS8qKgoJICogU2V0cyBkb2N1bWVudC1yZWxhdGVkIHZhcmlhYmxlcyBvbmNlIGJhc2VkIG9uIHRoZSBjdXJyZW50IGRvY3VtZW50CgkgKiBAcGFyYW0ge0VsZW1lbnR8T2JqZWN0fSBbZG9jXSBBbiBlbGVtZW50IG9yIGRvY3VtZW50IG9iamVjdCB0byB1c2UgdG8gc2V0IHRoZSBkb2N1bWVudAoJICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgY3VycmVudCBkb2N1bWVudAoJICovCglzZXREb2N1bWVudCA9IFNpenpsZS5zZXREb2N1bWVudCA9IGZ1bmN0aW9uKCBub2RlICkgewoJCXZhciBoYXNDb21wYXJlLCBwYXJlbnQsCgkJCWRvYyA9IG5vZGUgPyBub2RlLm93bmVyRG9jdW1lbnQgfHwgbm9kZSA6IHByZWZlcnJlZERvYzsKCgkJLy8gUmV0dXJuIGVhcmx5IGlmIGRvYyBpcyBpbnZhbGlkIG9yIGFscmVhZHkgc2VsZWN0ZWQKCQlpZiAoIGRvYyA9PT0gZG9jdW1lbnQgfHwgZG9jLm5vZGVUeXBlICE9PSA5IHx8ICFkb2MuZG9jdW1lbnRFbGVtZW50ICkgewoJCQlyZXR1cm4gZG9jdW1lbnQ7CgkJfQoKCQkvLyBVcGRhdGUgZ2xvYmFsIHZhcmlhYmxlcwoJCWRvY3VtZW50ID0gZG9jOwoJCWRvY0VsZW0gPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7CgkJZG9jdW1lbnRJc0hUTUwgPSAhaXNYTUwoIGRvY3VtZW50ICk7CgoJCS8vIFN1cHBvcnQ6IElFIDktMTEsIEVkZ2UKCQkvLyBBY2Nlc3NpbmcgaWZyYW1lIGRvY3VtZW50cyBhZnRlciB1bmxvYWQgdGhyb3dzICJwZXJtaXNzaW9uIGRlbmllZCIgZXJyb3JzIChqUXVlcnkgIzEzOTM2KQoJCWlmICggKHBhcmVudCA9IGRvY3VtZW50LmRlZmF1bHRWaWV3KSAmJiBwYXJlbnQudG9wICE9PSBwYXJlbnQgKSB7CgkJCS8vIFN1cHBvcnQ6IElFIDExCgkJCWlmICggcGFyZW50LmFkZEV2ZW50TGlzdGVuZXIgKSB7CgkJCQlwYXJlbnQuYWRkRXZlbnRMaXN0ZW5lciggInVubG9hZCIsIHVubG9hZEhhbmRsZXIsIGZhbHNlICk7CgoJCQkvLyBTdXBwb3J0OiBJRSA5IC0gMTAgb25seQoJCQl9IGVsc2UgaWYgKCBwYXJlbnQuYXR0YWNoRXZlbnQgKSB7CgkJCQlwYXJlbnQuYXR0YWNoRXZlbnQoICJvbnVubG9hZCIsIHVubG9hZEhhbmRsZXIgKTsKCQkJfQoJCX0KCgkJLyogQXR0cmlidXRlcwoJCS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi8KCgkJLy8gU3VwcG9ydDogSUU8OAoJCS8vIFZlcmlmeSB0aGF0IGdldEF0dHJpYnV0ZSByZWFsbHkgcmV0dXJucyBhdHRyaWJ1dGVzIGFuZCBub3QgcHJvcGVydGllcwoJCS8vIChleGNlcHRpbmcgSUU4IGJvb2xlYW5zKQoJCXN1cHBvcnQuYXR0cmlidXRlcyA9IGFzc2VydChmdW5jdGlvbiggZGl2ICkgewoJCQlkaXYuY2xhc3NOYW1lID0gImkiOwoJCQlyZXR1cm4gIWRpdi5nZXRBdHRyaWJ1dGUoImNsYXNzTmFtZSIpOwoJCX0pOwoKCQkvKiBnZXRFbGVtZW50KHMpQnkqCgkJLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqLwoKCQkvLyBDaGVjayBpZiBnZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpIHJldHVybnMgb25seSBlbGVtZW50cwoJCXN1cHBvcnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUgPSBhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHsKCQkJZGl2LmFwcGVuZENoaWxkKCBkb2N1bWVudC5jcmVhdGVDb21tZW50KCIiKSApOwoJCQlyZXR1cm4gIWRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpLmxlbmd0aDsKCQl9KTsKCgkJLy8gU3VwcG9ydDogSUU8OQoJCXN1cHBvcnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSA9IHJuYXRpdmUudGVzdCggZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSApOwoKCQkvLyBTdXBwb3J0OiBJRTwxMAoJCS8vIENoZWNrIGlmIGdldEVsZW1lbnRCeUlkIHJldHVybnMgZWxlbWVudHMgYnkgbmFtZQoJCS8vIFRoZSBicm9rZW4gZ2V0RWxlbWVudEJ5SWQgbWV0aG9kcyBkb24ndCBwaWNrIHVwIHByb2dyYW1hdGljYWxseS1zZXQgbmFtZXMsCgkJLy8gc28gdXNlIGEgcm91bmRhYm91dCBnZXRFbGVtZW50c0J5TmFtZSB0ZXN0CgkJc3VwcG9ydC5nZXRCeUlkID0gYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7CgkJCWRvY0VsZW0uYXBwZW5kQ2hpbGQoIGRpdiApLmlkID0gZXhwYW5kbzsKCQkJcmV0dXJuICFkb2N1bWVudC5nZXRFbGVtZW50c0J5TmFtZSB8fCAhZG9jdW1lbnQuZ2V0RWxlbWVudHNCeU5hbWUoIGV4cGFuZG8gKS5sZW5ndGg7CgkJfSk7CgoJCS8vIElEIGZpbmQgYW5kIGZpbHRlcgoJCWlmICggc3VwcG9ydC5nZXRCeUlkICkgewoJCQlFeHByLmZpbmRbIklEIl0gPSBmdW5jdGlvbiggaWQsIGNvbnRleHQgKSB7CgkJCQlpZiAoIHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRCeUlkICE9PSAidW5kZWZpbmVkIiAmJiBkb2N1bWVudElzSFRNTCApIHsKCQkJCQl2YXIgbSA9IGNvbnRleHQuZ2V0RWxlbWVudEJ5SWQoIGlkICk7CgkJCQkJcmV0dXJuIG0gPyBbIG0gXSA6IFtdOwoJCQkJfQoJCQl9OwoJCQlFeHByLmZpbHRlclsiSUQiXSA9IGZ1bmN0aW9uKCBpZCApIHsKCQkJCXZhciBhdHRySWQgPSBpZC5yZXBsYWNlKCBydW5lc2NhcGUsIGZ1bmVzY2FwZSApOwoJCQkJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJCXJldHVybiBlbGVtLmdldEF0dHJpYnV0ZSgiaWQiKSA9PT0gYXR0cklkOwoJCQkJfTsKCQkJfTsKCQl9IGVsc2UgewoJCQkvLyBTdXBwb3J0OiBJRTYvNwoJCQkvLyBnZXRFbGVtZW50QnlJZCBpcyBub3QgcmVsaWFibGUgYXMgYSBmaW5kIHNob3J0Y3V0CgkJCWRlbGV0ZSBFeHByLmZpbmRbIklEIl07CgoJCQlFeHByLmZpbHRlclsiSUQiXSA9ICBmdW5jdGlvbiggaWQgKSB7CgkJCQl2YXIgYXR0cklkID0gaWQucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKTsKCQkJCXJldHVybiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCQl2YXIgbm9kZSA9IHR5cGVvZiBlbGVtLmdldEF0dHJpYnV0ZU5vZGUgIT09ICJ1bmRlZmluZWQiICYmCgkJCQkJCWVsZW0uZ2V0QXR0cmlidXRlTm9kZSgiaWQiKTsKCQkJCQlyZXR1cm4gbm9kZSAmJiBub2RlLnZhbHVlID09PSBhdHRySWQ7CgkJCQl9OwoJCQl9OwoJCX0KCgkJLy8gVGFnCgkJRXhwci5maW5kWyJUQUciXSA9IHN1cHBvcnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUgPwoJCQlmdW5jdGlvbiggdGFnLCBjb250ZXh0ICkgewoJCQkJaWYgKCB0eXBlb2YgY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSAhPT0gInVuZGVmaW5lZCIgKSB7CgkJCQkJcmV0dXJuIGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIHRhZyApOwoKCQkJCS8vIERvY3VtZW50RnJhZ21lbnQgbm9kZXMgZG9uJ3QgaGF2ZSBnRUJUTgoJCQkJfSBlbHNlIGlmICggc3VwcG9ydC5xc2EgKSB7CgkJCQkJcmV0dXJuIGNvbnRleHQucXVlcnlTZWxlY3RvckFsbCggdGFnICk7CgkJCQl9CgkJCX0gOgoKCQkJZnVuY3Rpb24oIHRhZywgY29udGV4dCApIHsKCQkJCXZhciBlbGVtLAoJCQkJCXRtcCA9IFtdLAoJCQkJCWkgPSAwLAoJCQkJCS8vIEJ5IGhhcHB5IGNvaW5jaWRlbmNlLCBhIChicm9rZW4pIGdFQlROIGFwcGVhcnMgb24gRG9jdW1lbnRGcmFnbWVudCBub2RlcyB0b28KCQkJCQlyZXN1bHRzID0gY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSggdGFnICk7CgoJCQkJLy8gRmlsdGVyIG91dCBwb3NzaWJsZSBjb21tZW50cwoJCQkJaWYgKCB0YWcgPT09ICIqIiApIHsKCQkJCQl3aGlsZSAoIChlbGVtID0gcmVzdWx0c1tpKytdKSApIHsKCQkJCQkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxICkgewoJCQkJCQkJdG1wLnB1c2goIGVsZW0gKTsKCQkJCQkJfQoJCQkJCX0KCgkJCQkJcmV0dXJuIHRtcDsKCQkJCX0KCQkJCXJldHVybiByZXN1bHRzOwoJCQl9OwoKCQkvLyBDbGFzcwoJCUV4cHIuZmluZFsiQ0xBU1MiXSA9IHN1cHBvcnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSAmJiBmdW5jdGlvbiggY2xhc3NOYW1lLCBjb250ZXh0ICkgewoJCQlpZiAoIHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUgIT09ICJ1bmRlZmluZWQiICYmIGRvY3VtZW50SXNIVE1MICkgewoJCQkJcmV0dXJuIGNvbnRleHQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSggY2xhc3NOYW1lICk7CgkJCX0KCQl9OwoKCQkvKiBRU0EvbWF0Y2hlc1NlbGVjdG9yCgkJLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqLwoKCQkvLyBRU0EgYW5kIG1hdGNoZXNTZWxlY3RvciBzdXBwb3J0CgoJCS8vIG1hdGNoZXNTZWxlY3Rvcig6YWN0aXZlKSByZXBvcnRzIGZhbHNlIHdoZW4gdHJ1ZSAoSUU5L09wZXJhIDExLjUpCgkJcmJ1Z2d5TWF0Y2hlcyA9IFtdOwoKCQkvLyBxU2EoOmZvY3VzKSByZXBvcnRzIGZhbHNlIHdoZW4gdHJ1ZSAoQ2hyb21lIDIxKQoJCS8vIFdlIGFsbG93IHRoaXMgYmVjYXVzZSBvZiBhIGJ1ZyBpbiBJRTgvOSB0aGF0IHRocm93cyBhbiBlcnJvcgoJCS8vIHdoZW5ldmVyIGBkb2N1bWVudC5hY3RpdmVFbGVtZW50YCBpcyBhY2Nlc3NlZCBvbiBhbiBpZnJhbWUKCQkvLyBTbywgd2UgYWxsb3cgOmZvY3VzIHRvIHBhc3MgdGhyb3VnaCBRU0EgYWxsIHRoZSB0aW1lIHRvIGF2b2lkIHRoZSBJRSBlcnJvcgoJCS8vIFNlZSBodHRwOi8vYnVncy5qcXVlcnkuY29tL3RpY2tldC8xMzM3OAoJCXJidWdneVFTQSA9IFtdOwoKCQlpZiAoIChzdXBwb3J0LnFzYSA9IHJuYXRpdmUudGVzdCggZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCApKSApIHsKCQkJLy8gQnVpbGQgUVNBIHJlZ2V4CgkJCS8vIFJlZ2V4IHN0cmF0ZWd5IGFkb3B0ZWQgZnJvbSBEaWVnbyBQZXJpbmkKCQkJYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7CgkJCQkvLyBTZWxlY3QgaXMgc2V0IHRvIGVtcHR5IHN0cmluZyBvbiBwdXJwb3NlCgkJCQkvLyBUaGlzIGlzIHRvIHRlc3QgSUUncyB0cmVhdG1lbnQgb2Ygbm90IGV4cGxpY2l0bHkKCQkJCS8vIHNldHRpbmcgYSBib29sZWFuIGNvbnRlbnQgYXR0cmlidXRlLAoJCQkJLy8gc2luY2UgaXRzIHByZXNlbmNlIHNob3VsZCBiZSBlbm91Z2gKCQkJCS8vIGh0dHA6Ly9idWdzLmpxdWVyeS5jb20vdGlja2V0LzEyMzU5CgkJCQlkb2NFbGVtLmFwcGVuZENoaWxkKCBkaXYgKS5pbm5lckhUTUwgPSAiPGEgaWQ9JyIgKyBleHBhbmRvICsgIic+PC9hPiIgKwoJCQkJCSI8c2VsZWN0IGlkPSciICsgZXhwYW5kbyArICItXHJcXCcgbXNhbGxvd2NhcHR1cmU9Jyc+IiArCgkJCQkJIjxvcHRpb24gc2VsZWN0ZWQ9Jyc+PC9vcHRpb24+PC9zZWxlY3Q+IjsKCgkJCQkvLyBTdXBwb3J0OiBJRTgsIE9wZXJhIDExLTEyLjE2CgkJCQkvLyBOb3RoaW5nIHNob3VsZCBiZSBzZWxlY3RlZCB3aGVuIGVtcHR5IHN0cmluZ3MgZm9sbG93IF49IG9yICQ9IG9yICo9CgkJCQkvLyBUaGUgdGVzdCBhdHRyaWJ1dGUgbXVzdCBiZSB1bmtub3duIGluIE9wZXJhIGJ1dCAic2FmZSIgZm9yIFdpblJUCgkJCQkvLyBodHRwOi8vbXNkbi5taWNyb3NvZnQuY29tL2VuLXVzL2xpYnJhcnkvaWUvaGg0NjUzODguYXNweCNhdHRyaWJ1dGVfc2VjdGlvbgoJCQkJaWYgKCBkaXYucXVlcnlTZWxlY3RvckFsbCgiW21zYWxsb3djYXB0dXJlXj0nJ10iKS5sZW5ndGggKSB7CgkJCQkJcmJ1Z2d5UVNBLnB1c2goICJbKl4kXT0iICsgd2hpdGVzcGFjZSArICIqKD86Jyd8XCJcIikiICk7CgkJCQl9CgoJCQkJLy8gU3VwcG9ydDogSUU4CgkJCQkvLyBCb29sZWFuIGF0dHJpYnV0ZXMgYW5kICJ2YWx1ZSIgYXJlIG5vdCB0cmVhdGVkIGNvcnJlY3RseQoJCQkJaWYgKCAhZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoIltzZWxlY3RlZF0iKS5sZW5ndGggKSB7CgkJCQkJcmJ1Z2d5UVNBLnB1c2goICJcXFsiICsgd2hpdGVzcGFjZSArICIqKD86dmFsdWV8IiArIGJvb2xlYW5zICsgIikiICk7CgkJCQl9CgoJCQkJLy8gU3VwcG9ydDogQ2hyb21lPDI5LCBBbmRyb2lkPDQuNCwgU2FmYXJpPDcuMCssIGlPUzw3LjArLCBQaGFudG9tSlM8MS45LjgrCgkJCQlpZiAoICFkaXYucXVlcnlTZWxlY3RvckFsbCggIltpZH49IiArIGV4cGFuZG8gKyAiLV0iICkubGVuZ3RoICkgewoJCQkJCXJidWdneVFTQS5wdXNoKCJ+PSIpOwoJCQkJfQoKCQkJCS8vIFdlYmtpdC9PcGVyYSAtIDpjaGVja2VkIHNob3VsZCByZXR1cm4gc2VsZWN0ZWQgb3B0aW9uIGVsZW1lbnRzCgkJCQkvLyBodHRwOi8vd3d3LnczLm9yZy9UUi8yMDExL1JFQy1jc3MzLXNlbGVjdG9ycy0yMDExMDkyOS8jY2hlY2tlZAoJCQkJLy8gSUU4IHRocm93cyBlcnJvciBoZXJlIGFuZCB3aWxsIG5vdCBzZWUgbGF0ZXIgdGVzdHMKCQkJCWlmICggIWRpdi5xdWVyeVNlbGVjdG9yQWxsKCI6Y2hlY2tlZCIpLmxlbmd0aCApIHsKCQkJCQlyYnVnZ3lRU0EucHVzaCgiOmNoZWNrZWQiKTsKCQkJCX0KCgkJCQkvLyBTdXBwb3J0OiBTYWZhcmkgOCssIGlPUyA4KwoJCQkJLy8gaHR0cHM6Ly9idWdzLndlYmtpdC5vcmcvc2hvd19idWcuY2dpP2lkPTEzNjg1MQoJCQkJLy8gSW4tcGFnZSBgc2VsZWN0b3IjaWQgc2liaW5nLWNvbWJpbmF0b3Igc2VsZWN0b3JgIGZhaWxzCgkJCQlpZiAoICFkaXYucXVlcnlTZWxlY3RvckFsbCggImEjIiArIGV4cGFuZG8gKyAiKyoiICkubGVuZ3RoICkgewoJCQkJCXJidWdneVFTQS5wdXNoKCIuIy4rWyt+XSIpOwoJCQkJfQoJCQl9KTsKCgkJCWFzc2VydChmdW5jdGlvbiggZGl2ICkgewoJCQkJLy8gU3VwcG9ydDogV2luZG93cyA4IE5hdGl2ZSBBcHBzCgkJCQkvLyBUaGUgdHlwZSBhbmQgbmFtZSBhdHRyaWJ1dGVzIGFyZSByZXN0cmljdGVkIGR1cmluZyAuaW5uZXJIVE1MIGFzc2lnbm1lbnQKCQkJCXZhciBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7CgkJCQlpbnB1dC5zZXRBdHRyaWJ1dGUoICJ0eXBlIiwgImhpZGRlbiIgKTsKCQkJCWRpdi5hcHBlbmRDaGlsZCggaW5wdXQgKS5zZXRBdHRyaWJ1dGUoICJuYW1lIiwgIkQiICk7CgoJCQkJLy8gU3VwcG9ydDogSUU4CgkJCQkvLyBFbmZvcmNlIGNhc2Utc2Vuc2l0aXZpdHkgb2YgbmFtZSBhdHRyaWJ1dGUKCQkJCWlmICggZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoIltuYW1lPWRdIikubGVuZ3RoICkgewoJCQkJCXJidWdneVFTQS5wdXNoKCAibmFtZSIgKyB3aGl0ZXNwYWNlICsgIipbKl4kfCF+XT89IiApOwoJCQkJfQoKCQkJCS8vIEZGIDMuNSAtIDplbmFibGVkLzpkaXNhYmxlZCBhbmQgaGlkZGVuIGVsZW1lbnRzIChoaWRkZW4gZWxlbWVudHMgYXJlIHN0aWxsIGVuYWJsZWQpCgkJCQkvLyBJRTggdGhyb3dzIGVycm9yIGhlcmUgYW5kIHdpbGwgbm90IHNlZSBsYXRlciB0ZXN0cwoJCQkJaWYgKCAhZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoIjplbmFibGVkIikubGVuZ3RoICkgewoJCQkJCXJidWdneVFTQS5wdXNoKCAiOmVuYWJsZWQiLCAiOmRpc2FibGVkIiApOwoJCQkJfQoKCQkJCS8vIE9wZXJhIDEwLTExIGRvZXMgbm90IHRocm93IG9uIHBvc3QtY29tbWEgaW52YWxpZCBwc2V1ZG9zCgkJCQlkaXYucXVlcnlTZWxlY3RvckFsbCgiKiw6eCIpOwoJCQkJcmJ1Z2d5UVNBLnB1c2goIiwuKjoiKTsKCQkJfSk7CgkJfQoKCQlpZiAoIChzdXBwb3J0Lm1hdGNoZXNTZWxlY3RvciA9IHJuYXRpdmUudGVzdCggKG1hdGNoZXMgPSBkb2NFbGVtLm1hdGNoZXMgfHwKCQkJZG9jRWxlbS53ZWJraXRNYXRjaGVzU2VsZWN0b3IgfHwKCQkJZG9jRWxlbS5tb3pNYXRjaGVzU2VsZWN0b3IgfHwKCQkJZG9jRWxlbS5vTWF0Y2hlc1NlbGVjdG9yIHx8CgkJCWRvY0VsZW0ubXNNYXRjaGVzU2VsZWN0b3IpICkpICkgewoKCQkJYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7CgkJCQkvLyBDaGVjayB0byBzZWUgaWYgaXQncyBwb3NzaWJsZSB0byBkbyBtYXRjaGVzU2VsZWN0b3IKCQkJCS8vIG9uIGEgZGlzY29ubmVjdGVkIG5vZGUgKElFIDkpCgkJCQlzdXBwb3J0LmRpc2Nvbm5lY3RlZE1hdGNoID0gbWF0Y2hlcy5jYWxsKCBkaXYsICJkaXYiICk7CgoJCQkJLy8gVGhpcyBzaG91bGQgZmFpbCB3aXRoIGFuIGV4Y2VwdGlvbgoJCQkJLy8gR2Vja28gZG9lcyBub3QgZXJyb3IsIHJldHVybnMgZmFsc2UgaW5zdGVhZAoJCQkJbWF0Y2hlcy5jYWxsKCBkaXYsICJbcyE9JyddOngiICk7CgkJCQlyYnVnZ3lNYXRjaGVzLnB1c2goICIhPSIsIHBzZXVkb3MgKTsKCQkJfSk7CgkJfQoKCQlyYnVnZ3lRU0EgPSByYnVnZ3lRU0EubGVuZ3RoICYmIG5ldyBSZWdFeHAoIHJidWdneVFTQS5qb2luKCJ8IikgKTsKCQlyYnVnZ3lNYXRjaGVzID0gcmJ1Z2d5TWF0Y2hlcy5sZW5ndGggJiYgbmV3IFJlZ0V4cCggcmJ1Z2d5TWF0Y2hlcy5qb2luKCJ8IikgKTsKCgkJLyogQ29udGFpbnMKCQktLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovCgkJaGFzQ29tcGFyZSA9IHJuYXRpdmUudGVzdCggZG9jRWxlbS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiApOwoKCQkvLyBFbGVtZW50IGNvbnRhaW5zIGFub3RoZXIKCQkvLyBQdXJwb3NlZnVsbHkgc2VsZi1leGNsdXNpdmUKCQkvLyBBcyBpbiwgYW4gZWxlbWVudCBkb2VzIG5vdCBjb250YWluIGl0c2VsZgoJCWNvbnRhaW5zID0gaGFzQ29tcGFyZSB8fCBybmF0aXZlLnRlc3QoIGRvY0VsZW0uY29udGFpbnMgKSA/CgkJCWZ1bmN0aW9uKCBhLCBiICkgewoJCQkJdmFyIGFkb3duID0gYS5ub2RlVHlwZSA9PT0gOSA/IGEuZG9jdW1lbnRFbGVtZW50IDogYSwKCQkJCQlidXAgPSBiICYmIGIucGFyZW50Tm9kZTsKCQkJCXJldHVybiBhID09PSBidXAgfHwgISEoIGJ1cCAmJiBidXAubm9kZVR5cGUgPT09IDEgJiYgKAoJCQkJCWFkb3duLmNvbnRhaW5zID8KCQkJCQkJYWRvd24uY29udGFpbnMoIGJ1cCApIDoKCQkJCQkJYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiAmJiBhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKCBidXAgKSAmIDE2CgkJCQkpKTsKCQkJfSA6CgkJCWZ1bmN0aW9uKCBhLCBiICkgewoJCQkJaWYgKCBiICkgewoJCQkJCXdoaWxlICggKGIgPSBiLnBhcmVudE5vZGUpICkgewoJCQkJCQlpZiAoIGIgPT09IGEgKSB7CgkJCQkJCQlyZXR1cm4gdHJ1ZTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJCXJldHVybiBmYWxzZTsKCQkJfTsKCgkJLyogU29ydGluZwoJCS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi8KCgkJLy8gRG9jdW1lbnQgb3JkZXIgc29ydGluZwoJCXNvcnRPcmRlciA9IGhhc0NvbXBhcmUgPwoJCWZ1bmN0aW9uKCBhLCBiICkgewoKCQkJLy8gRmxhZyBmb3IgZHVwbGljYXRlIHJlbW92YWwKCQkJaWYgKCBhID09PSBiICkgewoJCQkJaGFzRHVwbGljYXRlID0gdHJ1ZTsKCQkJCXJldHVybiAwOwoJCQl9CgoJCQkvLyBTb3J0IG9uIG1ldGhvZCBleGlzdGVuY2UgaWYgb25seSBvbmUgaW5wdXQgaGFzIGNvbXBhcmVEb2N1bWVudFBvc2l0aW9uCgkJCXZhciBjb21wYXJlID0gIWEuY29tcGFyZURvY3VtZW50UG9zaXRpb24gLSAhYi5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbjsKCQkJaWYgKCBjb21wYXJlICkgewoJCQkJcmV0dXJuIGNvbXBhcmU7CgkJCX0KCgkJCS8vIENhbGN1bGF0ZSBwb3NpdGlvbiBpZiBib3RoIGlucHV0cyBiZWxvbmcgdG8gdGhlIHNhbWUgZG9jdW1lbnQKCQkJY29tcGFyZSA9ICggYS5vd25lckRvY3VtZW50IHx8IGEgKSA9PT0gKCBiLm93bmVyRG9jdW1lbnQgfHwgYiApID8KCQkJCWEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oIGIgKSA6CgoJCQkJLy8gT3RoZXJ3aXNlIHdlIGtub3cgdGhleSBhcmUgZGlzY29ubmVjdGVkCgkJCQkxOwoKCQkJLy8gRGlzY29ubmVjdGVkIG5vZGVzCgkJCWlmICggY29tcGFyZSAmIDEgfHwKCQkJCSghc3VwcG9ydC5zb3J0RGV0YWNoZWQgJiYgYi5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiggYSApID09PSBjb21wYXJlKSApIHsKCgkJCQkvLyBDaG9vc2UgdGhlIGZpcnN0IGVsZW1lbnQgdGhhdCBpcyByZWxhdGVkIHRvIG91ciBwcmVmZXJyZWQgZG9jdW1lbnQKCQkJCWlmICggYSA9PT0gZG9jdW1lbnQgfHwgYS5vd25lckRvY3VtZW50ID09PSBwcmVmZXJyZWREb2MgJiYgY29udGFpbnMocHJlZmVycmVkRG9jLCBhKSApIHsKCQkJCQlyZXR1cm4gLTE7CgkJCQl9CgkJCQlpZiAoIGIgPT09IGRvY3VtZW50IHx8IGIub3duZXJEb2N1bWVudCA9PT0gcHJlZmVycmVkRG9jICYmIGNvbnRhaW5zKHByZWZlcnJlZERvYywgYikgKSB7CgkJCQkJcmV0dXJuIDE7CgkJCQl9CgoJCQkJLy8gTWFpbnRhaW4gb3JpZ2luYWwgb3JkZXIKCQkJCXJldHVybiBzb3J0SW5wdXQgPwoJCQkJCSggaW5kZXhPZiggc29ydElucHV0LCBhICkgLSBpbmRleE9mKCBzb3J0SW5wdXQsIGIgKSApIDoKCQkJCQkwOwoJCQl9CgoJCQlyZXR1cm4gY29tcGFyZSAmIDQgPyAtMSA6IDE7CgkJfSA6CgkJZnVuY3Rpb24oIGEsIGIgKSB7CgkJCS8vIEV4aXQgZWFybHkgaWYgdGhlIG5vZGVzIGFyZSBpZGVudGljYWwKCQkJaWYgKCBhID09PSBiICkgewoJCQkJaGFzRHVwbGljYXRlID0gdHJ1ZTsKCQkJCXJldHVybiAwOwoJCQl9CgoJCQl2YXIgY3VyLAoJCQkJaSA9IDAsCgkJCQlhdXAgPSBhLnBhcmVudE5vZGUsCgkJCQlidXAgPSBiLnBhcmVudE5vZGUsCgkJCQlhcCA9IFsgYSBdLAoJCQkJYnAgPSBbIGIgXTsKCgkJCS8vIFBhcmVudGxlc3Mgbm9kZXMgYXJlIGVpdGhlciBkb2N1bWVudHMgb3IgZGlzY29ubmVjdGVkCgkJCWlmICggIWF1cCB8fCAhYnVwICkgewoJCQkJcmV0dXJuIGEgPT09IGRvY3VtZW50ID8gLTEgOgoJCQkJCWIgPT09IGRvY3VtZW50ID8gMSA6CgkJCQkJYXVwID8gLTEgOgoJCQkJCWJ1cCA/IDEgOgoJCQkJCXNvcnRJbnB1dCA/CgkJCQkJKCBpbmRleE9mKCBzb3J0SW5wdXQsIGEgKSAtIGluZGV4T2YoIHNvcnRJbnB1dCwgYiApICkgOgoJCQkJCTA7CgoJCQkvLyBJZiB0aGUgbm9kZXMgYXJlIHNpYmxpbmdzLCB3ZSBjYW4gZG8gYSBxdWljayBjaGVjawoJCQl9IGVsc2UgaWYgKCBhdXAgPT09IGJ1cCApIHsKCQkJCXJldHVybiBzaWJsaW5nQ2hlY2soIGEsIGIgKTsKCQkJfQoKCQkJLy8gT3RoZXJ3aXNlIHdlIG5lZWQgZnVsbCBsaXN0cyBvZiB0aGVpciBhbmNlc3RvcnMgZm9yIGNvbXBhcmlzb24KCQkJY3VyID0gYTsKCQkJd2hpbGUgKCAoY3VyID0gY3VyLnBhcmVudE5vZGUpICkgewoJCQkJYXAudW5zaGlmdCggY3VyICk7CgkJCX0KCQkJY3VyID0gYjsKCQkJd2hpbGUgKCAoY3VyID0gY3VyLnBhcmVudE5vZGUpICkgewoJCQkJYnAudW5zaGlmdCggY3VyICk7CgkJCX0KCgkJCS8vIFdhbGsgZG93biB0aGUgdHJlZSBsb29raW5nIGZvciBhIGRpc2NyZXBhbmN5CgkJCXdoaWxlICggYXBbaV0gPT09IGJwW2ldICkgewoJCQkJaSsrOwoJCQl9CgoJCQlyZXR1cm4gaSA/CgkJCQkvLyBEbyBhIHNpYmxpbmcgY2hlY2sgaWYgdGhlIG5vZGVzIGhhdmUgYSBjb21tb24gYW5jZXN0b3IKCQkJCXNpYmxpbmdDaGVjayggYXBbaV0sIGJwW2ldICkgOgoKCQkJCS8vIE90aGVyd2lzZSBub2RlcyBpbiBvdXIgZG9jdW1lbnQgc29ydCBmaXJzdAoJCQkJYXBbaV0gPT09IHByZWZlcnJlZERvYyA/IC0xIDoKCQkJCWJwW2ldID09PSBwcmVmZXJyZWREb2MgPyAxIDoKCQkJCTA7CgkJfTsKCgkJcmV0dXJuIGRvY3VtZW50OwoJfTsKCglTaXp6bGUubWF0Y2hlcyA9IGZ1bmN0aW9uKCBleHByLCBlbGVtZW50cyApIHsKCQlyZXR1cm4gU2l6emxlKCBleHByLCBudWxsLCBudWxsLCBlbGVtZW50cyApOwoJfTsKCglTaXp6bGUubWF0Y2hlc1NlbGVjdG9yID0gZnVuY3Rpb24oIGVsZW0sIGV4cHIgKSB7CgkJLy8gU2V0IGRvY3VtZW50IHZhcnMgaWYgbmVlZGVkCgkJaWYgKCAoIGVsZW0ub3duZXJEb2N1bWVudCB8fCBlbGVtICkgIT09IGRvY3VtZW50ICkgewoJCQlzZXREb2N1bWVudCggZWxlbSApOwoJCX0KCgkJLy8gTWFrZSBzdXJlIHRoYXQgYXR0cmlidXRlIHNlbGVjdG9ycyBhcmUgcXVvdGVkCgkJZXhwciA9IGV4cHIucmVwbGFjZSggcmF0dHJpYnV0ZVF1b3RlcywgIj0nJDEnXSIgKTsKCgkJaWYgKCBzdXBwb3J0Lm1hdGNoZXNTZWxlY3RvciAmJiBkb2N1bWVudElzSFRNTCAmJgoJCQkhY29tcGlsZXJDYWNoZVsgZXhwciArICIgIiBdICYmCgkJCSggIXJidWdneU1hdGNoZXMgfHwgIXJidWdneU1hdGNoZXMudGVzdCggZXhwciApICkgJiYKCQkJKCAhcmJ1Z2d5UVNBICAgICB8fCAhcmJ1Z2d5UVNBLnRlc3QoIGV4cHIgKSApICkgewoKCQkJdHJ5IHsKCQkJCXZhciByZXQgPSBtYXRjaGVzLmNhbGwoIGVsZW0sIGV4cHIgKTsKCgkJCQkvLyBJRSA5J3MgbWF0Y2hlc1NlbGVjdG9yIHJldHVybnMgZmFsc2Ugb24gZGlzY29ubmVjdGVkIG5vZGVzCgkJCQlpZiAoIHJldCB8fCBzdXBwb3J0LmRpc2Nvbm5lY3RlZE1hdGNoIHx8CgkJCQkJCS8vIEFzIHdlbGwsIGRpc2Nvbm5lY3RlZCBub2RlcyBhcmUgc2FpZCB0byBiZSBpbiBhIGRvY3VtZW50CgkJCQkJCS8vIGZyYWdtZW50IGluIElFIDkKCQkJCQkJZWxlbS5kb2N1bWVudCAmJiBlbGVtLmRvY3VtZW50Lm5vZGVUeXBlICE9PSAxMSApIHsKCQkJCQlyZXR1cm4gcmV0OwoJCQkJfQoJCQl9IGNhdGNoIChlKSB7fQoJCX0KCgkJcmV0dXJuIFNpenpsZSggZXhwciwgZG9jdW1lbnQsIG51bGwsIFsgZWxlbSBdICkubGVuZ3RoID4gMDsKCX07CgoJU2l6emxlLmNvbnRhaW5zID0gZnVuY3Rpb24oIGNvbnRleHQsIGVsZW0gKSB7CgkJLy8gU2V0IGRvY3VtZW50IHZhcnMgaWYgbmVlZGVkCgkJaWYgKCAoIGNvbnRleHQub3duZXJEb2N1bWVudCB8fCBjb250ZXh0ICkgIT09IGRvY3VtZW50ICkgewoJCQlzZXREb2N1bWVudCggY29udGV4dCApOwoJCX0KCQlyZXR1cm4gY29udGFpbnMoIGNvbnRleHQsIGVsZW0gKTsKCX07CgoJU2l6emxlLmF0dHIgPSBmdW5jdGlvbiggZWxlbSwgbmFtZSApIHsKCQkvLyBTZXQgZG9jdW1lbnQgdmFycyBpZiBuZWVkZWQKCQlpZiAoICggZWxlbS5vd25lckRvY3VtZW50IHx8IGVsZW0gKSAhPT0gZG9jdW1lbnQgKSB7CgkJCXNldERvY3VtZW50KCBlbGVtICk7CgkJfQoKCQl2YXIgZm4gPSBFeHByLmF0dHJIYW5kbGVbIG5hbWUudG9Mb3dlckNhc2UoKSBdLAoJCQkvLyBEb24ndCBnZXQgZm9vbGVkIGJ5IE9iamVjdC5wcm90b3R5cGUgcHJvcGVydGllcyAoalF1ZXJ5ICMxMzgwNykKCQkJdmFsID0gZm4gJiYgaGFzT3duLmNhbGwoIEV4cHIuYXR0ckhhbmRsZSwgbmFtZS50b0xvd2VyQ2FzZSgpICkgPwoJCQkJZm4oIGVsZW0sIG5hbWUsICFkb2N1bWVudElzSFRNTCApIDoKCQkJCXVuZGVmaW5lZDsKCgkJcmV0dXJuIHZhbCAhPT0gdW5kZWZpbmVkID8KCQkJdmFsIDoKCQkJc3VwcG9ydC5hdHRyaWJ1dGVzIHx8ICFkb2N1bWVudElzSFRNTCA/CgkJCQllbGVtLmdldEF0dHJpYnV0ZSggbmFtZSApIDoKCQkJCSh2YWwgPSBlbGVtLmdldEF0dHJpYnV0ZU5vZGUobmFtZSkpICYmIHZhbC5zcGVjaWZpZWQgPwoJCQkJCXZhbC52YWx1ZSA6CgkJCQkJbnVsbDsKCX07CgoJU2l6emxlLmVycm9yID0gZnVuY3Rpb24oIG1zZyApIHsKCQl0aHJvdyBuZXcgRXJyb3IoICJTeW50YXggZXJyb3IsIHVucmVjb2duaXplZCBleHByZXNzaW9uOiAiICsgbXNnICk7Cgl9OwoKCS8qKgoJICogRG9jdW1lbnQgc29ydGluZyBhbmQgcmVtb3ZpbmcgZHVwbGljYXRlcwoJICogQHBhcmFtIHtBcnJheUxpa2V9IHJlc3VsdHMKCSAqLwoJU2l6emxlLnVuaXF1ZVNvcnQgPSBmdW5jdGlvbiggcmVzdWx0cyApIHsKCQl2YXIgZWxlbSwKCQkJZHVwbGljYXRlcyA9IFtdLAoJCQlqID0gMCwKCQkJaSA9IDA7CgoJCS8vIFVubGVzcyB3ZSAqa25vdyogd2UgY2FuIGRldGVjdCBkdXBsaWNhdGVzLCBhc3N1bWUgdGhlaXIgcHJlc2VuY2UKCQloYXNEdXBsaWNhdGUgPSAhc3VwcG9ydC5kZXRlY3REdXBsaWNhdGVzOwoJCXNvcnRJbnB1dCA9ICFzdXBwb3J0LnNvcnRTdGFibGUgJiYgcmVzdWx0cy5zbGljZSggMCApOwoJCXJlc3VsdHMuc29ydCggc29ydE9yZGVyICk7CgoJCWlmICggaGFzRHVwbGljYXRlICkgewoJCQl3aGlsZSAoIChlbGVtID0gcmVzdWx0c1tpKytdKSApIHsKCQkJCWlmICggZWxlbSA9PT0gcmVzdWx0c1sgaSBdICkgewoJCQkJCWogPSBkdXBsaWNhdGVzLnB1c2goIGkgKTsKCQkJCX0KCQkJfQoJCQl3aGlsZSAoIGotLSApIHsKCQkJCXJlc3VsdHMuc3BsaWNlKCBkdXBsaWNhdGVzWyBqIF0sIDEgKTsKCQkJfQoJCX0KCgkJLy8gQ2xlYXIgaW5wdXQgYWZ0ZXIgc29ydGluZyB0byByZWxlYXNlIG9iamVjdHMKCQkvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2pxdWVyeS9zaXp6bGUvcHVsbC8yMjUKCQlzb3J0SW5wdXQgPSBudWxsOwoKCQlyZXR1cm4gcmVzdWx0czsKCX07CgoJLyoqCgkgKiBVdGlsaXR5IGZ1bmN0aW9uIGZvciByZXRyaWV2aW5nIHRoZSB0ZXh0IHZhbHVlIG9mIGFuIGFycmF5IG9mIERPTSBub2RlcwoJICogQHBhcmFtIHtBcnJheXxFbGVtZW50fSBlbGVtCgkgKi8KCWdldFRleHQgPSBTaXp6bGUuZ2V0VGV4dCA9IGZ1bmN0aW9uKCBlbGVtICkgewoJCXZhciBub2RlLAoJCQlyZXQgPSAiIiwKCQkJaSA9IDAsCgkJCW5vZGVUeXBlID0gZWxlbS5ub2RlVHlwZTsKCgkJaWYgKCAhbm9kZVR5cGUgKSB7CgkJCS8vIElmIG5vIG5vZGVUeXBlLCB0aGlzIGlzIGV4cGVjdGVkIHRvIGJlIGFuIGFycmF5CgkJCXdoaWxlICggKG5vZGUgPSBlbGVtW2krK10pICkgewoJCQkJLy8gRG8gbm90IHRyYXZlcnNlIGNvbW1lbnQgbm9kZXMKCQkJCXJldCArPSBnZXRUZXh0KCBub2RlICk7CgkJCX0KCQl9IGVsc2UgaWYgKCBub2RlVHlwZSA9PT0gMSB8fCBub2RlVHlwZSA9PT0gOSB8fCBub2RlVHlwZSA9PT0gMTEgKSB7CgkJCS8vIFVzZSB0ZXh0Q29udGVudCBmb3IgZWxlbWVudHMKCQkJLy8gaW5uZXJUZXh0IHVzYWdlIHJlbW92ZWQgZm9yIGNvbnNpc3RlbmN5IG9mIG5ldyBsaW5lcyAoalF1ZXJ5ICMxMTE1MykKCQkJaWYgKCB0eXBlb2YgZWxlbS50ZXh0Q29udGVudCA9PT0gInN0cmluZyIgKSB7CgkJCQlyZXR1cm4gZWxlbS50ZXh0Q29udGVudDsKCQkJfSBlbHNlIHsKCQkJCS8vIFRyYXZlcnNlIGl0cyBjaGlsZHJlbgoJCQkJZm9yICggZWxlbSA9IGVsZW0uZmlyc3RDaGlsZDsgZWxlbTsgZWxlbSA9IGVsZW0ubmV4dFNpYmxpbmcgKSB7CgkJCQkJcmV0ICs9IGdldFRleHQoIGVsZW0gKTsKCQkJCX0KCQkJfQoJCX0gZWxzZSBpZiAoIG5vZGVUeXBlID09PSAzIHx8IG5vZGVUeXBlID09PSA0ICkgewoJCQlyZXR1cm4gZWxlbS5ub2RlVmFsdWU7CgkJfQoJCS8vIERvIG5vdCBpbmNsdWRlIGNvbW1lbnQgb3IgcHJvY2Vzc2luZyBpbnN0cnVjdGlvbiBub2RlcwoKCQlyZXR1cm4gcmV0OwoJfTsKCglFeHByID0gU2l6emxlLnNlbGVjdG9ycyA9IHsKCgkJLy8gQ2FuIGJlIGFkanVzdGVkIGJ5IHRoZSB1c2VyCgkJY2FjaGVMZW5ndGg6IDUwLAoKCQljcmVhdGVQc2V1ZG86IG1hcmtGdW5jdGlvbiwKCgkJbWF0Y2g6IG1hdGNoRXhwciwKCgkJYXR0ckhhbmRsZToge30sCgoJCWZpbmQ6IHt9LAoKCQlyZWxhdGl2ZTogewoJCQkiPiI6IHsgZGlyOiAicGFyZW50Tm9kZSIsIGZpcnN0OiB0cnVlIH0sCgkJCSIgIjogeyBkaXI6ICJwYXJlbnROb2RlIiB9LAoJCQkiKyI6IHsgZGlyOiAicHJldmlvdXNTaWJsaW5nIiwgZmlyc3Q6IHRydWUgfSwKCQkJIn4iOiB7IGRpcjogInByZXZpb3VzU2libGluZyIgfQoJCX0sCgoJCXByZUZpbHRlcjogewoJCQkiQVRUUiI6IGZ1bmN0aW9uKCBtYXRjaCApIHsKCQkJCW1hdGNoWzFdID0gbWF0Y2hbMV0ucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKTsKCgkJCQkvLyBNb3ZlIHRoZSBnaXZlbiB2YWx1ZSB0byBtYXRjaFszXSB3aGV0aGVyIHF1b3RlZCBvciB1bnF1b3RlZAoJCQkJbWF0Y2hbM10gPSAoIG1hdGNoWzNdIHx8IG1hdGNoWzRdIHx8IG1hdGNoWzVdIHx8ICIiICkucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKTsKCgkJCQlpZiAoIG1hdGNoWzJdID09PSAifj0iICkgewoJCQkJCW1hdGNoWzNdID0gIiAiICsgbWF0Y2hbM10gKyAiICI7CgkJCQl9CgoJCQkJcmV0dXJuIG1hdGNoLnNsaWNlKCAwLCA0ICk7CgkJCX0sCgoJCQkiQ0hJTEQiOiBmdW5jdGlvbiggbWF0Y2ggKSB7CgkJCQkvKiBtYXRjaGVzIGZyb20gbWF0Y2hFeHByWyJDSElMRCJdCgkJCQkJMSB0eXBlIChvbmx5fG50aHwuLi4pCgkJCQkJMiB3aGF0IChjaGlsZHxvZi10eXBlKQoJCQkJCTMgYXJndW1lbnQgKGV2ZW58b2RkfFxkKnxcZCpuKFsrLV1cZCspP3wuLi4pCgkJCQkJNCB4bi1jb21wb25lbnQgb2YgeG4reSBhcmd1bWVudCAoWystXT9cZCpufCkKCQkJCQk1IHNpZ24gb2YgeG4tY29tcG9uZW50CgkJCQkJNiB4IG9mIHhuLWNvbXBvbmVudAoJCQkJCTcgc2lnbiBvZiB5LWNvbXBvbmVudAoJCQkJCTggeSBvZiB5LWNvbXBvbmVudAoJCQkJKi8KCQkJCW1hdGNoWzFdID0gbWF0Y2hbMV0udG9Mb3dlckNhc2UoKTsKCgkJCQlpZiAoIG1hdGNoWzFdLnNsaWNlKCAwLCAzICkgPT09ICJudGgiICkgewoJCQkJCS8vIG50aC0qIHJlcXVpcmVzIGFyZ3VtZW50CgkJCQkJaWYgKCAhbWF0Y2hbM10gKSB7CgkJCQkJCVNpenpsZS5lcnJvciggbWF0Y2hbMF0gKTsKCQkJCQl9CgoJCQkJCS8vIG51bWVyaWMgeCBhbmQgeSBwYXJhbWV0ZXJzIGZvciBFeHByLmZpbHRlci5DSElMRAoJCQkJCS8vIHJlbWVtYmVyIHRoYXQgZmFsc2UvdHJ1ZSBjYXN0IHJlc3BlY3RpdmVseSB0byAwLzEKCQkJCQltYXRjaFs0XSA9ICsoIG1hdGNoWzRdID8gbWF0Y2hbNV0gKyAobWF0Y2hbNl0gfHwgMSkgOiAyICogKCBtYXRjaFszXSA9PT0gImV2ZW4iIHx8IG1hdGNoWzNdID09PSAib2RkIiApICk7CgkJCQkJbWF0Y2hbNV0gPSArKCAoIG1hdGNoWzddICsgbWF0Y2hbOF0gKSB8fCBtYXRjaFszXSA9PT0gIm9kZCIgKTsKCgkJCQkvLyBvdGhlciB0eXBlcyBwcm9oaWJpdCBhcmd1bWVudHMKCQkJCX0gZWxzZSBpZiAoIG1hdGNoWzNdICkgewoJCQkJCVNpenpsZS5lcnJvciggbWF0Y2hbMF0gKTsKCQkJCX0KCgkJCQlyZXR1cm4gbWF0Y2g7CgkJCX0sCgoJCQkiUFNFVURPIjogZnVuY3Rpb24oIG1hdGNoICkgewoJCQkJdmFyIGV4Y2VzcywKCQkJCQl1bnF1b3RlZCA9ICFtYXRjaFs2XSAmJiBtYXRjaFsyXTsKCgkJCQlpZiAoIG1hdGNoRXhwclsiQ0hJTEQiXS50ZXN0KCBtYXRjaFswXSApICkgewoJCQkJCXJldHVybiBudWxsOwoJCQkJfQoKCQkJCS8vIEFjY2VwdCBxdW90ZWQgYXJndW1lbnRzIGFzLWlzCgkJCQlpZiAoIG1hdGNoWzNdICkgewoJCQkJCW1hdGNoWzJdID0gbWF0Y2hbNF0gfHwgbWF0Y2hbNV0gfHwgIiI7CgoJCQkJLy8gU3RyaXAgZXhjZXNzIGNoYXJhY3RlcnMgZnJvbSB1bnF1b3RlZCBhcmd1bWVudHMKCQkJCX0gZWxzZSBpZiAoIHVucXVvdGVkICYmIHJwc2V1ZG8udGVzdCggdW5xdW90ZWQgKSAmJgoJCQkJCS8vIEdldCBleGNlc3MgZnJvbSB0b2tlbml6ZSAocmVjdXJzaXZlbHkpCgkJCQkJKGV4Y2VzcyA9IHRva2VuaXplKCB1bnF1b3RlZCwgdHJ1ZSApKSAmJgoJCQkJCS8vIGFkdmFuY2UgdG8gdGhlIG5leHQgY2xvc2luZyBwYXJlbnRoZXNpcwoJCQkJCShleGNlc3MgPSB1bnF1b3RlZC5pbmRleE9mKCAiKSIsIHVucXVvdGVkLmxlbmd0aCAtIGV4Y2VzcyApIC0gdW5xdW90ZWQubGVuZ3RoKSApIHsKCgkJCQkJLy8gZXhjZXNzIGlzIGEgbmVnYXRpdmUgaW5kZXgKCQkJCQltYXRjaFswXSA9IG1hdGNoWzBdLnNsaWNlKCAwLCBleGNlc3MgKTsKCQkJCQltYXRjaFsyXSA9IHVucXVvdGVkLnNsaWNlKCAwLCBleGNlc3MgKTsKCQkJCX0KCgkJCQkvLyBSZXR1cm4gb25seSBjYXB0dXJlcyBuZWVkZWQgYnkgdGhlIHBzZXVkbyBmaWx0ZXIgbWV0aG9kICh0eXBlIGFuZCBhcmd1bWVudCkKCQkJCXJldHVybiBtYXRjaC5zbGljZSggMCwgMyApOwoJCQl9CgkJfSwKCgkJZmlsdGVyOiB7CgoJCQkiVEFHIjogZnVuY3Rpb24oIG5vZGVOYW1lU2VsZWN0b3IgKSB7CgkJCQl2YXIgbm9kZU5hbWUgPSBub2RlTmFtZVNlbGVjdG9yLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICkudG9Mb3dlckNhc2UoKTsKCQkJCXJldHVybiBub2RlTmFtZVNlbGVjdG9yID09PSAiKiIgPwoJCQkJCWZ1bmN0aW9uKCkgeyByZXR1cm4gdHJ1ZTsgfSA6CgkJCQkJZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQkJCXJldHVybiBlbGVtLm5vZGVOYW1lICYmIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gbm9kZU5hbWU7CgkJCQkJfTsKCQkJfSwKCgkJCSJDTEFTUyI6IGZ1bmN0aW9uKCBjbGFzc05hbWUgKSB7CgkJCQl2YXIgcGF0dGVybiA9IGNsYXNzQ2FjaGVbIGNsYXNzTmFtZSArICIgIiBdOwoKCQkJCXJldHVybiBwYXR0ZXJuIHx8CgkJCQkJKHBhdHRlcm4gPSBuZXcgUmVnRXhwKCAiKF58IiArIHdoaXRlc3BhY2UgKyAiKSIgKyBjbGFzc05hbWUgKyAiKCIgKyB3aGl0ZXNwYWNlICsgInwkKSIgKSkgJiYKCQkJCQljbGFzc0NhY2hlKCBjbGFzc05hbWUsIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJCQlyZXR1cm4gcGF0dGVybi50ZXN0KCB0eXBlb2YgZWxlbS5jbGFzc05hbWUgPT09ICJzdHJpbmciICYmIGVsZW0uY2xhc3NOYW1lIHx8IHR5cGVvZiBlbGVtLmdldEF0dHJpYnV0ZSAhPT0gInVuZGVmaW5lZCIgJiYgZWxlbS5nZXRBdHRyaWJ1dGUoImNsYXNzIikgfHwgIiIgKTsKCQkJCQl9KTsKCQkJfSwKCgkJCSJBVFRSIjogZnVuY3Rpb24oIG5hbWUsIG9wZXJhdG9yLCBjaGVjayApIHsKCQkJCXJldHVybiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCQl2YXIgcmVzdWx0ID0gU2l6emxlLmF0dHIoIGVsZW0sIG5hbWUgKTsKCgkJCQkJaWYgKCByZXN1bHQgPT0gbnVsbCApIHsKCQkJCQkJcmV0dXJuIG9wZXJhdG9yID09PSAiIT0iOwoJCQkJCX0KCQkJCQlpZiAoICFvcGVyYXRvciApIHsKCQkJCQkJcmV0dXJuIHRydWU7CgkJCQkJfQoKCQkJCQlyZXN1bHQgKz0gIiI7CgoJCQkJCXJldHVybiBvcGVyYXRvciA9PT0gIj0iID8gcmVzdWx0ID09PSBjaGVjayA6CgkJCQkJCW9wZXJhdG9yID09PSAiIT0iID8gcmVzdWx0ICE9PSBjaGVjayA6CgkJCQkJCW9wZXJhdG9yID09PSAiXj0iID8gY2hlY2sgJiYgcmVzdWx0LmluZGV4T2YoIGNoZWNrICkgPT09IDAgOgoJCQkJCQlvcGVyYXRvciA9PT0gIio9IiA/IGNoZWNrICYmIHJlc3VsdC5pbmRleE9mKCBjaGVjayApID4gLTEgOgoJCQkJCQlvcGVyYXRvciA9PT0gIiQ9IiA/IGNoZWNrICYmIHJlc3VsdC5zbGljZSggLWNoZWNrLmxlbmd0aCApID09PSBjaGVjayA6CgkJCQkJCW9wZXJhdG9yID09PSAifj0iID8gKCAiICIgKyByZXN1bHQucmVwbGFjZSggcndoaXRlc3BhY2UsICIgIiApICsgIiAiICkuaW5kZXhPZiggY2hlY2sgKSA+IC0xIDoKCQkJCQkJb3BlcmF0b3IgPT09ICJ8PSIgPyByZXN1bHQgPT09IGNoZWNrIHx8IHJlc3VsdC5zbGljZSggMCwgY2hlY2subGVuZ3RoICsgMSApID09PSBjaGVjayArICItIiA6CgkJCQkJCWZhbHNlOwoJCQkJfTsKCQkJfSwKCgkJCSJDSElMRCI6IGZ1bmN0aW9uKCB0eXBlLCB3aGF0LCBhcmd1bWVudCwgZmlyc3QsIGxhc3QgKSB7CgkJCQl2YXIgc2ltcGxlID0gdHlwZS5zbGljZSggMCwgMyApICE9PSAibnRoIiwKCQkJCQlmb3J3YXJkID0gdHlwZS5zbGljZSggLTQgKSAhPT0gImxhc3QiLAoJCQkJCW9mVHlwZSA9IHdoYXQgPT09ICJvZi10eXBlIjsKCgkJCQlyZXR1cm4gZmlyc3QgPT09IDEgJiYgbGFzdCA9PT0gMCA/CgoJCQkJCS8vIFNob3J0Y3V0IGZvciA6bnRoLSoobikKCQkJCQlmdW5jdGlvbiggZWxlbSApIHsKCQkJCQkJcmV0dXJuICEhZWxlbS5wYXJlbnROb2RlOwoJCQkJCX0gOgoKCQkJCQlmdW5jdGlvbiggZWxlbSwgY29udGV4dCwgeG1sICkgewoJCQkJCQl2YXIgY2FjaGUsIHVuaXF1ZUNhY2hlLCBvdXRlckNhY2hlLCBub2RlLCBub2RlSW5kZXgsIHN0YXJ0LAoJCQkJCQkJZGlyID0gc2ltcGxlICE9PSBmb3J3YXJkID8gIm5leHRTaWJsaW5nIiA6ICJwcmV2aW91c1NpYmxpbmciLAoJCQkJCQkJcGFyZW50ID0gZWxlbS5wYXJlbnROb2RlLAoJCQkJCQkJbmFtZSA9IG9mVHlwZSAmJiBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCksCgkJCQkJCQl1c2VDYWNoZSA9ICF4bWwgJiYgIW9mVHlwZSwKCQkJCQkJCWRpZmYgPSBmYWxzZTsKCgkJCQkJCWlmICggcGFyZW50ICkgewoKCQkJCQkJCS8vIDooZmlyc3R8bGFzdHxvbmx5KS0oY2hpbGR8b2YtdHlwZSkKCQkJCQkJCWlmICggc2ltcGxlICkgewoJCQkJCQkJCXdoaWxlICggZGlyICkgewoJCQkJCQkJCQlub2RlID0gZWxlbTsKCQkJCQkJCQkJd2hpbGUgKCAobm9kZSA9IG5vZGVbIGRpciBdKSApIHsKCQkJCQkJCQkJCWlmICggb2ZUeXBlID8KCQkJCQkJCQkJCQlub2RlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IG5hbWUgOgoJCQkJCQkJCQkJCW5vZGUubm9kZVR5cGUgPT09IDEgKSB7CgoJCQkJCQkJCQkJCXJldHVybiBmYWxzZTsKCQkJCQkJCQkJCX0KCQkJCQkJCQkJfQoJCQkJCQkJCQkvLyBSZXZlcnNlIGRpcmVjdGlvbiBmb3IgOm9ubHktKiAoaWYgd2UgaGF2ZW4ndCB5ZXQgZG9uZSBzbykKCQkJCQkJCQkJc3RhcnQgPSBkaXIgPSB0eXBlID09PSAib25seSIgJiYgIXN0YXJ0ICYmICJuZXh0U2libGluZyI7CgkJCQkJCQkJfQoJCQkJCQkJCXJldHVybiB0cnVlOwoJCQkJCQkJfQoKCQkJCQkJCXN0YXJ0ID0gWyBmb3J3YXJkID8gcGFyZW50LmZpcnN0Q2hpbGQgOiBwYXJlbnQubGFzdENoaWxkIF07CgoJCQkJCQkJLy8gbm9uLXhtbCA6bnRoLWNoaWxkKC4uLikgc3RvcmVzIGNhY2hlIGRhdGEgb24gYHBhcmVudGAKCQkJCQkJCWlmICggZm9yd2FyZCAmJiB1c2VDYWNoZSApIHsKCgkJCQkJCQkJLy8gU2VlayBgZWxlbWAgZnJvbSBhIHByZXZpb3VzbHktY2FjaGVkIGluZGV4CgoJCQkJCQkJCS8vIC4uLmluIGEgZ3ppcC1mcmllbmRseSB3YXkKCQkJCQkJCQlub2RlID0gcGFyZW50OwoJCQkJCQkJCW91dGVyQ2FjaGUgPSBub2RlWyBleHBhbmRvIF0gfHwgKG5vZGVbIGV4cGFuZG8gXSA9IHt9KTsKCgkJCQkJCQkJLy8gU3VwcG9ydDogSUUgPDkgb25seQoJCQkJCQkJCS8vIERlZmVuZCBhZ2FpbnN0IGNsb25lZCBhdHRyb3BlcnRpZXMgKGpRdWVyeSBnaC0xNzA5KQoJCQkJCQkJCXVuaXF1ZUNhY2hlID0gb3V0ZXJDYWNoZVsgbm9kZS51bmlxdWVJRCBdIHx8CgkJCQkJCQkJCShvdXRlckNhY2hlWyBub2RlLnVuaXF1ZUlEIF0gPSB7fSk7CgoJCQkJCQkJCWNhY2hlID0gdW5pcXVlQ2FjaGVbIHR5cGUgXSB8fCBbXTsKCQkJCQkJCQlub2RlSW5kZXggPSBjYWNoZVsgMCBdID09PSBkaXJydW5zICYmIGNhY2hlWyAxIF07CgkJCQkJCQkJZGlmZiA9IG5vZGVJbmRleCAmJiBjYWNoZVsgMiBdOwoJCQkJCQkJCW5vZGUgPSBub2RlSW5kZXggJiYgcGFyZW50LmNoaWxkTm9kZXNbIG5vZGVJbmRleCBdOwoKCQkJCQkJCQl3aGlsZSAoIChub2RlID0gKytub2RlSW5kZXggJiYgbm9kZSAmJiBub2RlWyBkaXIgXSB8fAoKCQkJCQkJCQkJLy8gRmFsbGJhY2sgdG8gc2Vla2luZyBgZWxlbWAgZnJvbSB0aGUgc3RhcnQKCQkJCQkJCQkJKGRpZmYgPSBub2RlSW5kZXggPSAwKSB8fCBzdGFydC5wb3AoKSkgKSB7CgoJCQkJCQkJCQkvLyBXaGVuIGZvdW5kLCBjYWNoZSBpbmRleGVzIG9uIGBwYXJlbnRgIGFuZCBicmVhawoJCQkJCQkJCQlpZiAoIG5vZGUubm9kZVR5cGUgPT09IDEgJiYgKytkaWZmICYmIG5vZGUgPT09IGVsZW0gKSB7CgkJCQkJCQkJCQl1bmlxdWVDYWNoZVsgdHlwZSBdID0gWyBkaXJydW5zLCBub2RlSW5kZXgsIGRpZmYgXTsKCQkJCQkJCQkJCWJyZWFrOwoJCQkJCQkJCQl9CgkJCQkJCQkJfQoKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJLy8gVXNlIHByZXZpb3VzbHktY2FjaGVkIGVsZW1lbnQgaW5kZXggaWYgYXZhaWxhYmxlCgkJCQkJCQkJaWYgKCB1c2VDYWNoZSApIHsKCQkJCQkJCQkJLy8gLi4uaW4gYSBnemlwLWZyaWVuZGx5IHdheQoJCQkJCQkJCQlub2RlID0gZWxlbTsKCQkJCQkJCQkJb3V0ZXJDYWNoZSA9IG5vZGVbIGV4cGFuZG8gXSB8fCAobm9kZVsgZXhwYW5kbyBdID0ge30pOwoKCQkJCQkJCQkJLy8gU3VwcG9ydDogSUUgPDkgb25seQoJCQkJCQkJCQkvLyBEZWZlbmQgYWdhaW5zdCBjbG9uZWQgYXR0cm9wZXJ0aWVzIChqUXVlcnkgZ2gtMTcwOSkKCQkJCQkJCQkJdW5pcXVlQ2FjaGUgPSBvdXRlckNhY2hlWyBub2RlLnVuaXF1ZUlEIF0gfHwKCQkJCQkJCQkJCShvdXRlckNhY2hlWyBub2RlLnVuaXF1ZUlEIF0gPSB7fSk7CgoJCQkJCQkJCQljYWNoZSA9IHVuaXF1ZUNhY2hlWyB0eXBlIF0gfHwgW107CgkJCQkJCQkJCW5vZGVJbmRleCA9IGNhY2hlWyAwIF0gPT09IGRpcnJ1bnMgJiYgY2FjaGVbIDEgXTsKCQkJCQkJCQkJZGlmZiA9IG5vZGVJbmRleDsKCQkJCQkJCQl9CgoJCQkJCQkJCS8vIHhtbCA6bnRoLWNoaWxkKC4uLikKCQkJCQkJCQkvLyBvciA6bnRoLWxhc3QtY2hpbGQoLi4uKSBvciA6bnRoKC1sYXN0KT8tb2YtdHlwZSguLi4pCgkJCQkJCQkJaWYgKCBkaWZmID09PSBmYWxzZSApIHsKCQkJCQkJCQkJLy8gVXNlIHRoZSBzYW1lIGxvb3AgYXMgYWJvdmUgdG8gc2VlayBgZWxlbWAgZnJvbSB0aGUgc3RhcnQKCQkJCQkJCQkJd2hpbGUgKCAobm9kZSA9ICsrbm9kZUluZGV4ICYmIG5vZGUgJiYgbm9kZVsgZGlyIF0gfHwKCQkJCQkJCQkJCShkaWZmID0gbm9kZUluZGV4ID0gMCkgfHwgc3RhcnQucG9wKCkpICkgewoKCQkJCQkJCQkJCWlmICggKCBvZlR5cGUgPwoJCQkJCQkJCQkJCW5vZGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gbmFtZSA6CgkJCQkJCQkJCQkJbm9kZS5ub2RlVHlwZSA9PT0gMSApICYmCgkJCQkJCQkJCQkJKytkaWZmICkgewoKCQkJCQkJCQkJCQkvLyBDYWNoZSB0aGUgaW5kZXggb2YgZWFjaCBlbmNvdW50ZXJlZCBlbGVtZW50CgkJCQkJCQkJCQkJaWYgKCB1c2VDYWNoZSApIHsKCQkJCQkJCQkJCQkJb3V0ZXJDYWNoZSA9IG5vZGVbIGV4cGFuZG8gXSB8fCAobm9kZVsgZXhwYW5kbyBdID0ge30pOwoKCQkJCQkJCQkJCQkJLy8gU3VwcG9ydDogSUUgPDkgb25seQoJCQkJCQkJCQkJCQkvLyBEZWZlbmQgYWdhaW5zdCBjbG9uZWQgYXR0cm9wZXJ0aWVzIChqUXVlcnkgZ2gtMTcwOSkKCQkJCQkJCQkJCQkJdW5pcXVlQ2FjaGUgPSBvdXRlckNhY2hlWyBub2RlLnVuaXF1ZUlEIF0gfHwKCQkJCQkJCQkJCQkJCShvdXRlckNhY2hlWyBub2RlLnVuaXF1ZUlEIF0gPSB7fSk7CgoJCQkJCQkJCQkJCQl1bmlxdWVDYWNoZVsgdHlwZSBdID0gWyBkaXJydW5zLCBkaWZmIF07CgkJCQkJCQkJCQkJfQoKCQkJCQkJCQkJCQlpZiAoIG5vZGUgPT09IGVsZW0gKSB7CgkJCQkJCQkJCQkJCWJyZWFrOwoJCQkJCQkJCQkJCX0KCQkJCQkJCQkJCX0KCQkJCQkJCQkJfQoJCQkJCQkJCX0KCQkJCQkJCX0KCgkJCQkJCQkvLyBJbmNvcnBvcmF0ZSB0aGUgb2Zmc2V0LCB0aGVuIGNoZWNrIGFnYWluc3QgY3ljbGUgc2l6ZQoJCQkJCQkJZGlmZiAtPSBsYXN0OwoJCQkJCQkJcmV0dXJuIGRpZmYgPT09IGZpcnN0IHx8ICggZGlmZiAlIGZpcnN0ID09PSAwICYmIGRpZmYgLyBmaXJzdCA+PSAwICk7CgkJCQkJCX0KCQkJCQl9OwoJCQl9LAoKCQkJIlBTRVVETyI6IGZ1bmN0aW9uKCBwc2V1ZG8sIGFyZ3VtZW50ICkgewoJCQkJLy8gcHNldWRvLWNsYXNzIG5hbWVzIGFyZSBjYXNlLWluc2Vuc2l0aXZlCgkJCQkvLyBodHRwOi8vd3d3LnczLm9yZy9UUi9zZWxlY3RvcnMvI3BzZXVkby1jbGFzc2VzCgkJCQkvLyBQcmlvcml0aXplIGJ5IGNhc2Ugc2Vuc2l0aXZpdHkgaW4gY2FzZSBjdXN0b20gcHNldWRvcyBhcmUgYWRkZWQgd2l0aCB1cHBlcmNhc2UgbGV0dGVycwoJCQkJLy8gUmVtZW1iZXIgdGhhdCBzZXRGaWx0ZXJzIGluaGVyaXRzIGZyb20gcHNldWRvcwoJCQkJdmFyIGFyZ3MsCgkJCQkJZm4gPSBFeHByLnBzZXVkb3NbIHBzZXVkbyBdIHx8IEV4cHIuc2V0RmlsdGVyc1sgcHNldWRvLnRvTG93ZXJDYXNlKCkgXSB8fAoJCQkJCQlTaXp6bGUuZXJyb3IoICJ1bnN1cHBvcnRlZCBwc2V1ZG86ICIgKyBwc2V1ZG8gKTsKCgkJCQkvLyBUaGUgdXNlciBtYXkgdXNlIGNyZWF0ZVBzZXVkbyB0byBpbmRpY2F0ZSB0aGF0CgkJCQkvLyBhcmd1bWVudHMgYXJlIG5lZWRlZCB0byBjcmVhdGUgdGhlIGZpbHRlciBmdW5jdGlvbgoJCQkJLy8ganVzdCBhcyBTaXp6bGUgZG9lcwoJCQkJaWYgKCBmblsgZXhwYW5kbyBdICkgewoJCQkJCXJldHVybiBmbiggYXJndW1lbnQgKTsKCQkJCX0KCgkJCQkvLyBCdXQgbWFpbnRhaW4gc3VwcG9ydCBmb3Igb2xkIHNpZ25hdHVyZXMKCQkJCWlmICggZm4ubGVuZ3RoID4gMSApIHsKCQkJCQlhcmdzID0gWyBwc2V1ZG8sIHBzZXVkbywgIiIsIGFyZ3VtZW50IF07CgkJCQkJcmV0dXJuIEV4cHIuc2V0RmlsdGVycy5oYXNPd25Qcm9wZXJ0eSggcHNldWRvLnRvTG93ZXJDYXNlKCkgKSA/CgkJCQkJCW1hcmtGdW5jdGlvbihmdW5jdGlvbiggc2VlZCwgbWF0Y2hlcyApIHsKCQkJCQkJCXZhciBpZHgsCgkJCQkJCQkJbWF0Y2hlZCA9IGZuKCBzZWVkLCBhcmd1bWVudCApLAoJCQkJCQkJCWkgPSBtYXRjaGVkLmxlbmd0aDsKCQkJCQkJCXdoaWxlICggaS0tICkgewoJCQkJCQkJCWlkeCA9IGluZGV4T2YoIHNlZWQsIG1hdGNoZWRbaV0gKTsKCQkJCQkJCQlzZWVkWyBpZHggXSA9ICEoIG1hdGNoZXNbIGlkeCBdID0gbWF0Y2hlZFtpXSApOwoJCQkJCQkJfQoJCQkJCQl9KSA6CgkJCQkJCWZ1bmN0aW9uKCBlbGVtICkgewoJCQkJCQkJcmV0dXJuIGZuKCBlbGVtLCAwLCBhcmdzICk7CgkJCQkJCX07CgkJCQl9CgoJCQkJcmV0dXJuIGZuOwoJCQl9CgkJfSwKCgkJcHNldWRvczogewoJCQkvLyBQb3RlbnRpYWxseSBjb21wbGV4IHBzZXVkb3MKCQkJIm5vdCI6IG1hcmtGdW5jdGlvbihmdW5jdGlvbiggc2VsZWN0b3IgKSB7CgkJCQkvLyBUcmltIHRoZSBzZWxlY3RvciBwYXNzZWQgdG8gY29tcGlsZQoJCQkJLy8gdG8gYXZvaWQgdHJlYXRpbmcgbGVhZGluZyBhbmQgdHJhaWxpbmcKCQkJCS8vIHNwYWNlcyBhcyBjb21iaW5hdG9ycwoJCQkJdmFyIGlucHV0ID0gW10sCgkJCQkJcmVzdWx0cyA9IFtdLAoJCQkJCW1hdGNoZXIgPSBjb21waWxlKCBzZWxlY3Rvci5yZXBsYWNlKCBydHJpbSwgIiQxIiApICk7CgoJCQkJcmV0dXJuIG1hdGNoZXJbIGV4cGFuZG8gXSA/CgkJCQkJbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBzZWVkLCBtYXRjaGVzLCBjb250ZXh0LCB4bWwgKSB7CgkJCQkJCXZhciBlbGVtLAoJCQkJCQkJdW5tYXRjaGVkID0gbWF0Y2hlciggc2VlZCwgbnVsbCwgeG1sLCBbXSApLAoJCQkJCQkJaSA9IHNlZWQubGVuZ3RoOwoKCQkJCQkJLy8gTWF0Y2ggZWxlbWVudHMgdW5tYXRjaGVkIGJ5IGBtYXRjaGVyYAoJCQkJCQl3aGlsZSAoIGktLSApIHsKCQkJCQkJCWlmICggKGVsZW0gPSB1bm1hdGNoZWRbaV0pICkgewoJCQkJCQkJCXNlZWRbaV0gPSAhKG1hdGNoZXNbaV0gPSBlbGVtKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0pIDoKCQkJCQlmdW5jdGlvbiggZWxlbSwgY29udGV4dCwgeG1sICkgewoJCQkJCQlpbnB1dFswXSA9IGVsZW07CgkJCQkJCW1hdGNoZXIoIGlucHV0LCBudWxsLCB4bWwsIHJlc3VsdHMgKTsKCQkJCQkJLy8gRG9uJ3Qga2VlcCB0aGUgZWxlbWVudCAoaXNzdWUgIzI5OSkKCQkJCQkJaW5wdXRbMF0gPSBudWxsOwoJCQkJCQlyZXR1cm4gIXJlc3VsdHMucG9wKCk7CgkJCQkJfTsKCQkJfSksCgoJCQkiaGFzIjogbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQkJCXJldHVybiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCQlyZXR1cm4gU2l6emxlKCBzZWxlY3RvciwgZWxlbSApLmxlbmd0aCA+IDA7CgkJCQl9OwoJCQl9KSwKCgkJCSJjb250YWlucyI6IG1hcmtGdW5jdGlvbihmdW5jdGlvbiggdGV4dCApIHsKCQkJCXRleHQgPSB0ZXh0LnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICk7CgkJCQlyZXR1cm4gZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQkJcmV0dXJuICggZWxlbS50ZXh0Q29udGVudCB8fCBlbGVtLmlubmVyVGV4dCB8fCBnZXRUZXh0KCBlbGVtICkgKS5pbmRleE9mKCB0ZXh0ICkgPiAtMTsKCQkJCX07CgkJCX0pLAoKCQkJLy8gIldoZXRoZXIgYW4gZWxlbWVudCBpcyByZXByZXNlbnRlZCBieSBhIDpsYW5nKCkgc2VsZWN0b3IKCQkJLy8gaXMgYmFzZWQgc29sZWx5IG9uIHRoZSBlbGVtZW50J3MgbGFuZ3VhZ2UgdmFsdWUKCQkJLy8gYmVpbmcgZXF1YWwgdG8gdGhlIGlkZW50aWZpZXIgQywKCQkJLy8gb3IgYmVnaW5uaW5nIHdpdGggdGhlIGlkZW50aWZpZXIgQyBpbW1lZGlhdGVseSBmb2xsb3dlZCBieSAiLSIuCgkJCS8vIFRoZSBtYXRjaGluZyBvZiBDIGFnYWluc3QgdGhlIGVsZW1lbnQncyBsYW5ndWFnZSB2YWx1ZSBpcyBwZXJmb3JtZWQgY2FzZS1pbnNlbnNpdGl2ZWx5LgoJCQkvLyBUaGUgaWRlbnRpZmllciBDIGRvZXMgbm90IGhhdmUgdG8gYmUgYSB2YWxpZCBsYW5ndWFnZSBuYW1lLiIKCQkJLy8gaHR0cDovL3d3dy53My5vcmcvVFIvc2VsZWN0b3JzLyNsYW5nLXBzZXVkbwoJCQkibGFuZyI6IG1hcmtGdW5jdGlvbiggZnVuY3Rpb24oIGxhbmcgKSB7CgkJCQkvLyBsYW5nIHZhbHVlIG11c3QgYmUgYSB2YWxpZCBpZGVudGlmaWVyCgkJCQlpZiAoICFyaWRlbnRpZmllci50ZXN0KGxhbmcgfHwgIiIpICkgewoJCQkJCVNpenpsZS5lcnJvciggInVuc3VwcG9ydGVkIGxhbmc6ICIgKyBsYW5nICk7CgkJCQl9CgkJCQlsYW5nID0gbGFuZy5yZXBsYWNlKCBydW5lc2NhcGUsIGZ1bmVzY2FwZSApLnRvTG93ZXJDYXNlKCk7CgkJCQlyZXR1cm4gZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQkJdmFyIGVsZW1MYW5nOwoJCQkJCWRvIHsKCQkJCQkJaWYgKCAoZWxlbUxhbmcgPSBkb2N1bWVudElzSFRNTCA/CgkJCQkJCQllbGVtLmxhbmcgOgoJCQkJCQkJZWxlbS5nZXRBdHRyaWJ1dGUoInhtbDpsYW5nIikgfHwgZWxlbS5nZXRBdHRyaWJ1dGUoImxhbmciKSkgKSB7CgoJCQkJCQkJZWxlbUxhbmcgPSBlbGVtTGFuZy50b0xvd2VyQ2FzZSgpOwoJCQkJCQkJcmV0dXJuIGVsZW1MYW5nID09PSBsYW5nIHx8IGVsZW1MYW5nLmluZGV4T2YoIGxhbmcgKyAiLSIgKSA9PT0gMDsKCQkJCQkJfQoJCQkJCX0gd2hpbGUgKCAoZWxlbSA9IGVsZW0ucGFyZW50Tm9kZSkgJiYgZWxlbS5ub2RlVHlwZSA9PT0gMSApOwoJCQkJCXJldHVybiBmYWxzZTsKCQkJCX07CgkJCX0pLAoKCQkJLy8gTWlzY2VsbGFuZW91cwoJCQkidGFyZ2V0IjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQl2YXIgaGFzaCA9IHdpbmRvdy5sb2NhdGlvbiAmJiB3aW5kb3cubG9jYXRpb24uaGFzaDsKCQkJCXJldHVybiBoYXNoICYmIGhhc2guc2xpY2UoIDEgKSA9PT0gZWxlbS5pZDsKCQkJfSwKCgkJCSJyb290IjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQlyZXR1cm4gZWxlbSA9PT0gZG9jRWxlbTsKCQkJfSwKCgkJCSJmb2N1cyI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJcmV0dXJuIGVsZW0gPT09IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgJiYgKCFkb2N1bWVudC5oYXNGb2N1cyB8fCBkb2N1bWVudC5oYXNGb2N1cygpKSAmJiAhIShlbGVtLnR5cGUgfHwgZWxlbS5ocmVmIHx8IH5lbGVtLnRhYkluZGV4KTsKCQkJfSwKCgkJCS8vIEJvb2xlYW4gcHJvcGVydGllcwoJCQkiZW5hYmxlZCI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJcmV0dXJuIGVsZW0uZGlzYWJsZWQgPT09IGZhbHNlOwoJCQl9LAoKCQkJImRpc2FibGVkIjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQlyZXR1cm4gZWxlbS5kaXNhYmxlZCA9PT0gdHJ1ZTsKCQkJfSwKCgkJCSJjaGVja2VkIjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQkvLyBJbiBDU1MzLCA6Y2hlY2tlZCBzaG91bGQgcmV0dXJuIGJvdGggY2hlY2tlZCBhbmQgc2VsZWN0ZWQgZWxlbWVudHMKCQkJCS8vIGh0dHA6Ly93d3cudzMub3JnL1RSLzIwMTEvUkVDLWNzczMtc2VsZWN0b3JzLTIwMTEwOTI5LyNjaGVja2VkCgkJCQl2YXIgbm9kZU5hbWUgPSBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CgkJCQlyZXR1cm4gKG5vZGVOYW1lID09PSAiaW5wdXQiICYmICEhZWxlbS5jaGVja2VkKSB8fCAobm9kZU5hbWUgPT09ICJvcHRpb24iICYmICEhZWxlbS5zZWxlY3RlZCk7CgkJCX0sCgoJCQkic2VsZWN0ZWQiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCS8vIEFjY2Vzc2luZyB0aGlzIHByb3BlcnR5IG1ha2VzIHNlbGVjdGVkLWJ5LWRlZmF1bHQKCQkJCS8vIG9wdGlvbnMgaW4gU2FmYXJpIHdvcmsgcHJvcGVybHkKCQkJCWlmICggZWxlbS5wYXJlbnROb2RlICkgewoJCQkJCWVsZW0ucGFyZW50Tm9kZS5zZWxlY3RlZEluZGV4OwoJCQkJfQoKCQkJCXJldHVybiBlbGVtLnNlbGVjdGVkID09PSB0cnVlOwoJCQl9LAoKCQkJLy8gQ29udGVudHMKCQkJImVtcHR5IjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQkvLyBodHRwOi8vd3d3LnczLm9yZy9UUi9zZWxlY3RvcnMvI2VtcHR5LXBzZXVkbwoJCQkJLy8gOmVtcHR5IGlzIG5lZ2F0ZWQgYnkgZWxlbWVudCAoMSkgb3IgY29udGVudCBub2RlcyAodGV4dDogMzsgY2RhdGE6IDQ7IGVudGl0eSByZWY6IDUpLAoJCQkJLy8gICBidXQgbm90IGJ5IG90aGVycyAoY29tbWVudDogODsgcHJvY2Vzc2luZyBpbnN0cnVjdGlvbjogNzsgZXRjLikKCQkJCS8vIG5vZGVUeXBlIDwgNiB3b3JrcyBiZWNhdXNlIGF0dHJpYnV0ZXMgKDIpIGRvIG5vdCBhcHBlYXIgYXMgY2hpbGRyZW4KCQkJCWZvciAoIGVsZW0gPSBlbGVtLmZpcnN0Q2hpbGQ7IGVsZW07IGVsZW0gPSBlbGVtLm5leHRTaWJsaW5nICkgewoJCQkJCWlmICggZWxlbS5ub2RlVHlwZSA8IDYgKSB7CgkJCQkJCXJldHVybiBmYWxzZTsKCQkJCQl9CgkJCQl9CgkJCQlyZXR1cm4gdHJ1ZTsKCQkJfSwKCgkJCSJwYXJlbnQiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCXJldHVybiAhRXhwci5wc2V1ZG9zWyJlbXB0eSJdKCBlbGVtICk7CgkJCX0sCgoJCQkvLyBFbGVtZW50L2lucHV0IHR5cGVzCgkJCSJoZWFkZXIiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCXJldHVybiByaGVhZGVyLnRlc3QoIGVsZW0ubm9kZU5hbWUgKTsKCQkJfSwKCgkJCSJpbnB1dCI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJcmV0dXJuIHJpbnB1dHMudGVzdCggZWxlbS5ub2RlTmFtZSApOwoJCQl9LAoKCQkJImJ1dHRvbiI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJdmFyIG5hbWUgPSBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CgkJCQlyZXR1cm4gbmFtZSA9PT0gImlucHV0IiAmJiBlbGVtLnR5cGUgPT09ICJidXR0b24iIHx8IG5hbWUgPT09ICJidXR0b24iOwoJCQl9LAoKCQkJInRleHQiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCXZhciBhdHRyOwoJCQkJcmV0dXJuIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gImlucHV0IiAmJgoJCQkJCWVsZW0udHlwZSA9PT0gInRleHQiICYmCgoJCQkJCS8vIFN1cHBvcnQ6IElFPDgKCQkJCQkvLyBOZXcgSFRNTDUgYXR0cmlidXRlIHZhbHVlcyAoZS5nLiwgInNlYXJjaCIpIGFwcGVhciB3aXRoIGVsZW0udHlwZSA9PT0gInRleHQiCgkJCQkJKCAoYXR0ciA9IGVsZW0uZ2V0QXR0cmlidXRlKCJ0eXBlIikpID09IG51bGwgfHwgYXR0ci50b0xvd2VyQ2FzZSgpID09PSAidGV4dCIgKTsKCQkJfSwKCgkJCS8vIFBvc2l0aW9uLWluLWNvbGxlY3Rpb24KCQkJImZpcnN0IjogY3JlYXRlUG9zaXRpb25hbFBzZXVkbyhmdW5jdGlvbigpIHsKCQkJCXJldHVybiBbIDAgXTsKCQkJfSksCgoJCQkibGFzdCI6IGNyZWF0ZVBvc2l0aW9uYWxQc2V1ZG8oZnVuY3Rpb24oIG1hdGNoSW5kZXhlcywgbGVuZ3RoICkgewoJCQkJcmV0dXJuIFsgbGVuZ3RoIC0gMSBdOwoJCQl9KSwKCgkJCSJlcSI6IGNyZWF0ZVBvc2l0aW9uYWxQc2V1ZG8oZnVuY3Rpb24oIG1hdGNoSW5kZXhlcywgbGVuZ3RoLCBhcmd1bWVudCApIHsKCQkJCXJldHVybiBbIGFyZ3VtZW50IDwgMCA/IGFyZ3VtZW50ICsgbGVuZ3RoIDogYXJndW1lbnQgXTsKCQkJfSksCgoJCQkiZXZlbiI6IGNyZWF0ZVBvc2l0aW9uYWxQc2V1ZG8oZnVuY3Rpb24oIG1hdGNoSW5kZXhlcywgbGVuZ3RoICkgewoJCQkJdmFyIGkgPSAwOwoJCQkJZm9yICggOyBpIDwgbGVuZ3RoOyBpICs9IDIgKSB7CgkJCQkJbWF0Y2hJbmRleGVzLnB1c2goIGkgKTsKCQkJCX0KCQkJCXJldHVybiBtYXRjaEluZGV4ZXM7CgkJCX0pLAoKCQkJIm9kZCI6IGNyZWF0ZVBvc2l0aW9uYWxQc2V1ZG8oZnVuY3Rpb24oIG1hdGNoSW5kZXhlcywgbGVuZ3RoICkgewoJCQkJdmFyIGkgPSAxOwoJCQkJZm9yICggOyBpIDwgbGVuZ3RoOyBpICs9IDIgKSB7CgkJCQkJbWF0Y2hJbmRleGVzLnB1c2goIGkgKTsKCQkJCX0KCQkJCXJldHVybiBtYXRjaEluZGV4ZXM7CgkJCX0pLAoKCQkJImx0IjogY3JlYXRlUG9zaXRpb25hbFBzZXVkbyhmdW5jdGlvbiggbWF0Y2hJbmRleGVzLCBsZW5ndGgsIGFyZ3VtZW50ICkgewoJCQkJdmFyIGkgPSBhcmd1bWVudCA8IDAgPyBhcmd1bWVudCArIGxlbmd0aCA6IGFyZ3VtZW50OwoJCQkJZm9yICggOyAtLWkgPj0gMDsgKSB7CgkJCQkJbWF0Y2hJbmRleGVzLnB1c2goIGkgKTsKCQkJCX0KCQkJCXJldHVybiBtYXRjaEluZGV4ZXM7CgkJCX0pLAoKCQkJImd0IjogY3JlYXRlUG9zaXRpb25hbFBzZXVkbyhmdW5jdGlvbiggbWF0Y2hJbmRleGVzLCBsZW5ndGgsIGFyZ3VtZW50ICkgewoJCQkJdmFyIGkgPSBhcmd1bWVudCA8IDAgPyBhcmd1bWVudCArIGxlbmd0aCA6IGFyZ3VtZW50OwoJCQkJZm9yICggOyArK2kgPCBsZW5ndGg7ICkgewoJCQkJCW1hdGNoSW5kZXhlcy5wdXNoKCBpICk7CgkJCQl9CgkJCQlyZXR1cm4gbWF0Y2hJbmRleGVzOwoJCQl9KQoJCX0KCX07CgoJRXhwci5wc2V1ZG9zWyJudGgiXSA9IEV4cHIucHNldWRvc1siZXEiXTsKCgkvLyBBZGQgYnV0dG9uL2lucHV0IHR5cGUgcHNldWRvcwoJZm9yICggaSBpbiB7IHJhZGlvOiB0cnVlLCBjaGVja2JveDogdHJ1ZSwgZmlsZTogdHJ1ZSwgcGFzc3dvcmQ6IHRydWUsIGltYWdlOiB0cnVlIH0gKSB7CgkJRXhwci5wc2V1ZG9zWyBpIF0gPSBjcmVhdGVJbnB1dFBzZXVkbyggaSApOwoJfQoJZm9yICggaSBpbiB7IHN1Ym1pdDogdHJ1ZSwgcmVzZXQ6IHRydWUgfSApIHsKCQlFeHByLnBzZXVkb3NbIGkgXSA9IGNyZWF0ZUJ1dHRvblBzZXVkbyggaSApOwoJfQoKCS8vIEVhc3kgQVBJIGZvciBjcmVhdGluZyBuZXcgc2V0RmlsdGVycwoJZnVuY3Rpb24gc2V0RmlsdGVycygpIHt9CglzZXRGaWx0ZXJzLnByb3RvdHlwZSA9IEV4cHIuZmlsdGVycyA9IEV4cHIucHNldWRvczsKCUV4cHIuc2V0RmlsdGVycyA9IG5ldyBzZXRGaWx0ZXJzKCk7CgoJdG9rZW5pemUgPSBTaXp6bGUudG9rZW5pemUgPSBmdW5jdGlvbiggc2VsZWN0b3IsIHBhcnNlT25seSApIHsKCQl2YXIgbWF0Y2hlZCwgbWF0Y2gsIHRva2VucywgdHlwZSwKCQkJc29GYXIsIGdyb3VwcywgcHJlRmlsdGVycywKCQkJY2FjaGVkID0gdG9rZW5DYWNoZVsgc2VsZWN0b3IgKyAiICIgXTsKCgkJaWYgKCBjYWNoZWQgKSB7CgkJCXJldHVybiBwYXJzZU9ubHkgPyAwIDogY2FjaGVkLnNsaWNlKCAwICk7CgkJfQoKCQlzb0ZhciA9IHNlbGVjdG9yOwoJCWdyb3VwcyA9IFtdOwoJCXByZUZpbHRlcnMgPSBFeHByLnByZUZpbHRlcjsKCgkJd2hpbGUgKCBzb0ZhciApIHsKCgkJCS8vIENvbW1hIGFuZCBmaXJzdCBydW4KCQkJaWYgKCAhbWF0Y2hlZCB8fCAobWF0Y2ggPSByY29tbWEuZXhlYyggc29GYXIgKSkgKSB7CgkJCQlpZiAoIG1hdGNoICkgewoJCQkJCS8vIERvbid0IGNvbnN1bWUgdHJhaWxpbmcgY29tbWFzIGFzIHZhbGlkCgkJCQkJc29GYXIgPSBzb0Zhci5zbGljZSggbWF0Y2hbMF0ubGVuZ3RoICkgfHwgc29GYXI7CgkJCQl9CgkJCQlncm91cHMucHVzaCggKHRva2VucyA9IFtdKSApOwoJCQl9CgoJCQltYXRjaGVkID0gZmFsc2U7CgoJCQkvLyBDb21iaW5hdG9ycwoJCQlpZiAoIChtYXRjaCA9IHJjb21iaW5hdG9ycy5leGVjKCBzb0ZhciApKSApIHsKCQkJCW1hdGNoZWQgPSBtYXRjaC5zaGlmdCgpOwoJCQkJdG9rZW5zLnB1c2goewoJCQkJCXZhbHVlOiBtYXRjaGVkLAoJCQkJCS8vIENhc3QgZGVzY2VuZGFudCBjb21iaW5hdG9ycyB0byBzcGFjZQoJCQkJCXR5cGU6IG1hdGNoWzBdLnJlcGxhY2UoIHJ0cmltLCAiICIgKQoJCQkJfSk7CgkJCQlzb0ZhciA9IHNvRmFyLnNsaWNlKCBtYXRjaGVkLmxlbmd0aCApOwoJCQl9CgoJCQkvLyBGaWx0ZXJzCgkJCWZvciAoIHR5cGUgaW4gRXhwci5maWx0ZXIgKSB7CgkJCQlpZiAoIChtYXRjaCA9IG1hdGNoRXhwclsgdHlwZSBdLmV4ZWMoIHNvRmFyICkpICYmICghcHJlRmlsdGVyc1sgdHlwZSBdIHx8CgkJCQkJKG1hdGNoID0gcHJlRmlsdGVyc1sgdHlwZSBdKCBtYXRjaCApKSkgKSB7CgkJCQkJbWF0Y2hlZCA9IG1hdGNoLnNoaWZ0KCk7CgkJCQkJdG9rZW5zLnB1c2goewoJCQkJCQl2YWx1ZTogbWF0Y2hlZCwKCQkJCQkJdHlwZTogdHlwZSwKCQkJCQkJbWF0Y2hlczogbWF0Y2gKCQkJCQl9KTsKCQkJCQlzb0ZhciA9IHNvRmFyLnNsaWNlKCBtYXRjaGVkLmxlbmd0aCApOwoJCQkJfQoJCQl9CgoJCQlpZiAoICFtYXRjaGVkICkgewoJCQkJYnJlYWs7CgkJCX0KCQl9CgoJCS8vIFJldHVybiB0aGUgbGVuZ3RoIG9mIHRoZSBpbnZhbGlkIGV4Y2VzcwoJCS8vIGlmIHdlJ3JlIGp1c3QgcGFyc2luZwoJCS8vIE90aGVyd2lzZSwgdGhyb3cgYW4gZXJyb3Igb3IgcmV0dXJuIHRva2VucwoJCXJldHVybiBwYXJzZU9ubHkgPwoJCQlzb0Zhci5sZW5ndGggOgoJCQlzb0ZhciA/CgkJCQlTaXp6bGUuZXJyb3IoIHNlbGVjdG9yICkgOgoJCQkJLy8gQ2FjaGUgdGhlIHRva2VucwoJCQkJdG9rZW5DYWNoZSggc2VsZWN0b3IsIGdyb3VwcyApLnNsaWNlKCAwICk7Cgl9OwoKCWZ1bmN0aW9uIHRvU2VsZWN0b3IoIHRva2VucyApIHsKCQl2YXIgaSA9IDAsCgkJCWxlbiA9IHRva2Vucy5sZW5ndGgsCgkJCXNlbGVjdG9yID0gIiI7CgkJZm9yICggOyBpIDwgbGVuOyBpKysgKSB7CgkJCXNlbGVjdG9yICs9IHRva2Vuc1tpXS52YWx1ZTsKCQl9CgkJcmV0dXJuIHNlbGVjdG9yOwoJfQoKCWZ1bmN0aW9uIGFkZENvbWJpbmF0b3IoIG1hdGNoZXIsIGNvbWJpbmF0b3IsIGJhc2UgKSB7CgkJdmFyIGRpciA9IGNvbWJpbmF0b3IuZGlyLAoJCQljaGVja05vbkVsZW1lbnRzID0gYmFzZSAmJiBkaXIgPT09ICJwYXJlbnROb2RlIiwKCQkJZG9uZU5hbWUgPSBkb25lKys7CgoJCXJldHVybiBjb21iaW5hdG9yLmZpcnN0ID8KCQkJLy8gQ2hlY2sgYWdhaW5zdCBjbG9zZXN0IGFuY2VzdG9yL3ByZWNlZGluZyBlbGVtZW50CgkJCWZ1bmN0aW9uKCBlbGVtLCBjb250ZXh0LCB4bWwgKSB7CgkJCQl3aGlsZSAoIChlbGVtID0gZWxlbVsgZGlyIF0pICkgewoJCQkJCWlmICggZWxlbS5ub2RlVHlwZSA9PT0gMSB8fCBjaGVja05vbkVsZW1lbnRzICkgewoJCQkJCQlyZXR1cm4gbWF0Y2hlciggZWxlbSwgY29udGV4dCwgeG1sICk7CgkJCQkJfQoJCQkJfQoJCQl9IDoKCgkJCS8vIENoZWNrIGFnYWluc3QgYWxsIGFuY2VzdG9yL3ByZWNlZGluZyBlbGVtZW50cwoJCQlmdW5jdGlvbiggZWxlbSwgY29udGV4dCwgeG1sICkgewoJCQkJdmFyIG9sZENhY2hlLCB1bmlxdWVDYWNoZSwgb3V0ZXJDYWNoZSwKCQkJCQluZXdDYWNoZSA9IFsgZGlycnVucywgZG9uZU5hbWUgXTsKCgkJCQkvLyBXZSBjYW4ndCBzZXQgYXJiaXRyYXJ5IGRhdGEgb24gWE1MIG5vZGVzLCBzbyB0aGV5IGRvbid0IGJlbmVmaXQgZnJvbSBjb21iaW5hdG9yIGNhY2hpbmcKCQkJCWlmICggeG1sICkgewoJCQkJCXdoaWxlICggKGVsZW0gPSBlbGVtWyBkaXIgXSkgKSB7CgkJCQkJCWlmICggZWxlbS5ub2RlVHlwZSA9PT0gMSB8fCBjaGVja05vbkVsZW1lbnRzICkgewoJCQkJCQkJaWYgKCBtYXRjaGVyKCBlbGVtLCBjb250ZXh0LCB4bWwgKSApIHsKCQkJCQkJCQlyZXR1cm4gdHJ1ZTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCX0gZWxzZSB7CgkJCQkJd2hpbGUgKCAoZWxlbSA9IGVsZW1bIGRpciBdKSApIHsKCQkJCQkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxIHx8IGNoZWNrTm9uRWxlbWVudHMgKSB7CgkJCQkJCQlvdXRlckNhY2hlID0gZWxlbVsgZXhwYW5kbyBdIHx8IChlbGVtWyBleHBhbmRvIF0gPSB7fSk7CgoJCQkJCQkJLy8gU3VwcG9ydDogSUUgPDkgb25seQoJCQkJCQkJLy8gRGVmZW5kIGFnYWluc3QgY2xvbmVkIGF0dHJvcGVydGllcyAoalF1ZXJ5IGdoLTE3MDkpCgkJCQkJCQl1bmlxdWVDYWNoZSA9IG91dGVyQ2FjaGVbIGVsZW0udW5pcXVlSUQgXSB8fCAob3V0ZXJDYWNoZVsgZWxlbS51bmlxdWVJRCBdID0ge30pOwoKCQkJCQkJCWlmICggKG9sZENhY2hlID0gdW5pcXVlQ2FjaGVbIGRpciBdKSAmJgoJCQkJCQkJCW9sZENhY2hlWyAwIF0gPT09IGRpcnJ1bnMgJiYgb2xkQ2FjaGVbIDEgXSA9PT0gZG9uZU5hbWUgKSB7CgoJCQkJCQkJCS8vIEFzc2lnbiB0byBuZXdDYWNoZSBzbyByZXN1bHRzIGJhY2stcHJvcGFnYXRlIHRvIHByZXZpb3VzIGVsZW1lbnRzCgkJCQkJCQkJcmV0dXJuIChuZXdDYWNoZVsgMiBdID0gb2xkQ2FjaGVbIDIgXSk7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCS8vIFJldXNlIG5ld2NhY2hlIHNvIHJlc3VsdHMgYmFjay1wcm9wYWdhdGUgdG8gcHJldmlvdXMgZWxlbWVudHMKCQkJCQkJCQl1bmlxdWVDYWNoZVsgZGlyIF0gPSBuZXdDYWNoZTsKCgkJCQkJCQkJLy8gQSBtYXRjaCBtZWFucyB3ZSdyZSBkb25lOyBhIGZhaWwgbWVhbnMgd2UgaGF2ZSB0byBrZWVwIGNoZWNraW5nCgkJCQkJCQkJaWYgKCAobmV3Q2FjaGVbIDIgXSA9IG1hdGNoZXIoIGVsZW0sIGNvbnRleHQsIHhtbCApKSApIHsKCQkJCQkJCQkJcmV0dXJuIHRydWU7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9OwoJfQoKCWZ1bmN0aW9uIGVsZW1lbnRNYXRjaGVyKCBtYXRjaGVycyApIHsKCQlyZXR1cm4gbWF0Y2hlcnMubGVuZ3RoID4gMSA/CgkJCWZ1bmN0aW9uKCBlbGVtLCBjb250ZXh0LCB4bWwgKSB7CgkJCQl2YXIgaSA9IG1hdGNoZXJzLmxlbmd0aDsKCQkJCXdoaWxlICggaS0tICkgewoJCQkJCWlmICggIW1hdGNoZXJzW2ldKCBlbGVtLCBjb250ZXh0LCB4bWwgKSApIHsKCQkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCX0KCQkJCX0KCQkJCXJldHVybiB0cnVlOwoJCQl9IDoKCQkJbWF0Y2hlcnNbMF07Cgl9CgoJZnVuY3Rpb24gbXVsdGlwbGVDb250ZXh0cyggc2VsZWN0b3IsIGNvbnRleHRzLCByZXN1bHRzICkgewoJCXZhciBpID0gMCwKCQkJbGVuID0gY29udGV4dHMubGVuZ3RoOwoJCWZvciAoIDsgaSA8IGxlbjsgaSsrICkgewoJCQlTaXp6bGUoIHNlbGVjdG9yLCBjb250ZXh0c1tpXSwgcmVzdWx0cyApOwoJCX0KCQlyZXR1cm4gcmVzdWx0czsKCX0KCglmdW5jdGlvbiBjb25kZW5zZSggdW5tYXRjaGVkLCBtYXAsIGZpbHRlciwgY29udGV4dCwgeG1sICkgewoJCXZhciBlbGVtLAoJCQluZXdVbm1hdGNoZWQgPSBbXSwKCQkJaSA9IDAsCgkJCWxlbiA9IHVubWF0Y2hlZC5sZW5ndGgsCgkJCW1hcHBlZCA9IG1hcCAhPSBudWxsOwoKCQlmb3IgKCA7IGkgPCBsZW47IGkrKyApIHsKCQkJaWYgKCAoZWxlbSA9IHVubWF0Y2hlZFtpXSkgKSB7CgkJCQlpZiAoICFmaWx0ZXIgfHwgZmlsdGVyKCBlbGVtLCBjb250ZXh0LCB4bWwgKSApIHsKCQkJCQluZXdVbm1hdGNoZWQucHVzaCggZWxlbSApOwoJCQkJCWlmICggbWFwcGVkICkgewoJCQkJCQltYXAucHVzaCggaSApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCgkJcmV0dXJuIG5ld1VubWF0Y2hlZDsKCX0KCglmdW5jdGlvbiBzZXRNYXRjaGVyKCBwcmVGaWx0ZXIsIHNlbGVjdG9yLCBtYXRjaGVyLCBwb3N0RmlsdGVyLCBwb3N0RmluZGVyLCBwb3N0U2VsZWN0b3IgKSB7CgkJaWYgKCBwb3N0RmlsdGVyICYmICFwb3N0RmlsdGVyWyBleHBhbmRvIF0gKSB7CgkJCXBvc3RGaWx0ZXIgPSBzZXRNYXRjaGVyKCBwb3N0RmlsdGVyICk7CgkJfQoJCWlmICggcG9zdEZpbmRlciAmJiAhcG9zdEZpbmRlclsgZXhwYW5kbyBdICkgewoJCQlwb3N0RmluZGVyID0gc2V0TWF0Y2hlciggcG9zdEZpbmRlciwgcG9zdFNlbGVjdG9yICk7CgkJfQoJCXJldHVybiBtYXJrRnVuY3Rpb24oZnVuY3Rpb24oIHNlZWQsIHJlc3VsdHMsIGNvbnRleHQsIHhtbCApIHsKCQkJdmFyIHRlbXAsIGksIGVsZW0sCgkJCQlwcmVNYXAgPSBbXSwKCQkJCXBvc3RNYXAgPSBbXSwKCQkJCXByZWV4aXN0aW5nID0gcmVzdWx0cy5sZW5ndGgsCgoJCQkJLy8gR2V0IGluaXRpYWwgZWxlbWVudHMgZnJvbSBzZWVkIG9yIGNvbnRleHQKCQkJCWVsZW1zID0gc2VlZCB8fCBtdWx0aXBsZUNvbnRleHRzKCBzZWxlY3RvciB8fCAiKiIsIGNvbnRleHQubm9kZVR5cGUgPyBbIGNvbnRleHQgXSA6IGNvbnRleHQsIFtdICksCgoJCQkJLy8gUHJlZmlsdGVyIHRvIGdldCBtYXRjaGVyIGlucHV0LCBwcmVzZXJ2aW5nIGEgbWFwIGZvciBzZWVkLXJlc3VsdHMgc3luY2hyb25pemF0aW9uCgkJCQltYXRjaGVySW4gPSBwcmVGaWx0ZXIgJiYgKCBzZWVkIHx8ICFzZWxlY3RvciApID8KCQkJCQljb25kZW5zZSggZWxlbXMsIHByZU1hcCwgcHJlRmlsdGVyLCBjb250ZXh0LCB4bWwgKSA6CgkJCQkJZWxlbXMsCgoJCQkJbWF0Y2hlck91dCA9IG1hdGNoZXIgPwoJCQkJCS8vIElmIHdlIGhhdmUgYSBwb3N0RmluZGVyLCBvciBmaWx0ZXJlZCBzZWVkLCBvciBub24tc2VlZCBwb3N0RmlsdGVyIG9yIHByZWV4aXN0aW5nIHJlc3VsdHMsCgkJCQkJcG9zdEZpbmRlciB8fCAoIHNlZWQgPyBwcmVGaWx0ZXIgOiBwcmVleGlzdGluZyB8fCBwb3N0RmlsdGVyICkgPwoKCQkJCQkJLy8gLi4uaW50ZXJtZWRpYXRlIHByb2Nlc3NpbmcgaXMgbmVjZXNzYXJ5CgkJCQkJCVtdIDoKCgkJCQkJCS8vIC4uLm90aGVyd2lzZSB1c2UgcmVzdWx0cyBkaXJlY3RseQoJCQkJCQlyZXN1bHRzIDoKCQkJCQltYXRjaGVySW47CgoJCQkvLyBGaW5kIHByaW1hcnkgbWF0Y2hlcwoJCQlpZiAoIG1hdGNoZXIgKSB7CgkJCQltYXRjaGVyKCBtYXRjaGVySW4sIG1hdGNoZXJPdXQsIGNvbnRleHQsIHhtbCApOwoJCQl9CgoJCQkvLyBBcHBseSBwb3N0RmlsdGVyCgkJCWlmICggcG9zdEZpbHRlciApIHsKCQkJCXRlbXAgPSBjb25kZW5zZSggbWF0Y2hlck91dCwgcG9zdE1hcCApOwoJCQkJcG9zdEZpbHRlciggdGVtcCwgW10sIGNvbnRleHQsIHhtbCApOwoKCQkJCS8vIFVuLW1hdGNoIGZhaWxpbmcgZWxlbWVudHMgYnkgbW92aW5nIHRoZW0gYmFjayB0byBtYXRjaGVySW4KCQkJCWkgPSB0ZW1wLmxlbmd0aDsKCQkJCXdoaWxlICggaS0tICkgewoJCQkJCWlmICggKGVsZW0gPSB0ZW1wW2ldKSApIHsKCQkJCQkJbWF0Y2hlck91dFsgcG9zdE1hcFtpXSBdID0gIShtYXRjaGVySW5bIHBvc3RNYXBbaV0gXSA9IGVsZW0pOwoJCQkJCX0KCQkJCX0KCQkJfQoKCQkJaWYgKCBzZWVkICkgewoJCQkJaWYgKCBwb3N0RmluZGVyIHx8IHByZUZpbHRlciApIHsKCQkJCQlpZiAoIHBvc3RGaW5kZXIgKSB7CgkJCQkJCS8vIEdldCB0aGUgZmluYWwgbWF0Y2hlck91dCBieSBjb25kZW5zaW5nIHRoaXMgaW50ZXJtZWRpYXRlIGludG8gcG9zdEZpbmRlciBjb250ZXh0cwoJCQkJCQl0ZW1wID0gW107CgkJCQkJCWkgPSBtYXRjaGVyT3V0Lmxlbmd0aDsKCQkJCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQkJCQlpZiAoIChlbGVtID0gbWF0Y2hlck91dFtpXSkgKSB7CgkJCQkJCQkJLy8gUmVzdG9yZSBtYXRjaGVySW4gc2luY2UgZWxlbSBpcyBub3QgeWV0IGEgZmluYWwgbWF0Y2gKCQkJCQkJCQl0ZW1wLnB1c2goIChtYXRjaGVySW5baV0gPSBlbGVtKSApOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCXBvc3RGaW5kZXIoIG51bGwsIChtYXRjaGVyT3V0ID0gW10pLCB0ZW1wLCB4bWwgKTsKCQkJCQl9CgoJCQkJCS8vIE1vdmUgbWF0Y2hlZCBlbGVtZW50cyBmcm9tIHNlZWQgdG8gcmVzdWx0cyB0byBrZWVwIHRoZW0gc3luY2hyb25pemVkCgkJCQkJaSA9IG1hdGNoZXJPdXQubGVuZ3RoOwoJCQkJCXdoaWxlICggaS0tICkgewoJCQkJCQlpZiAoIChlbGVtID0gbWF0Y2hlck91dFtpXSkgJiYKCQkJCQkJCSh0ZW1wID0gcG9zdEZpbmRlciA/IGluZGV4T2YoIHNlZWQsIGVsZW0gKSA6IHByZU1hcFtpXSkgPiAtMSApIHsKCgkJCQkJCQlzZWVkW3RlbXBdID0gIShyZXN1bHRzW3RlbXBdID0gZWxlbSk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgoJCQkvLyBBZGQgZWxlbWVudHMgdG8gcmVzdWx0cywgdGhyb3VnaCBwb3N0RmluZGVyIGlmIGRlZmluZWQKCQkJfSBlbHNlIHsKCQkJCW1hdGNoZXJPdXQgPSBjb25kZW5zZSgKCQkJCQltYXRjaGVyT3V0ID09PSByZXN1bHRzID8KCQkJCQkJbWF0Y2hlck91dC5zcGxpY2UoIHByZWV4aXN0aW5nLCBtYXRjaGVyT3V0Lmxlbmd0aCApIDoKCQkJCQkJbWF0Y2hlck91dAoJCQkJKTsKCQkJCWlmICggcG9zdEZpbmRlciApIHsKCQkJCQlwb3N0RmluZGVyKCBudWxsLCByZXN1bHRzLCBtYXRjaGVyT3V0LCB4bWwgKTsKCQkJCX0gZWxzZSB7CgkJCQkJcHVzaC5hcHBseSggcmVzdWx0cywgbWF0Y2hlck91dCApOwoJCQkJfQoJCQl9CgkJfSk7Cgl9CgoJZnVuY3Rpb24gbWF0Y2hlckZyb21Ub2tlbnMoIHRva2VucyApIHsKCQl2YXIgY2hlY2tDb250ZXh0LCBtYXRjaGVyLCBqLAoJCQlsZW4gPSB0b2tlbnMubGVuZ3RoLAoJCQlsZWFkaW5nUmVsYXRpdmUgPSBFeHByLnJlbGF0aXZlWyB0b2tlbnNbMF0udHlwZSBdLAoJCQlpbXBsaWNpdFJlbGF0aXZlID0gbGVhZGluZ1JlbGF0aXZlIHx8IEV4cHIucmVsYXRpdmVbIiAiXSwKCQkJaSA9IGxlYWRpbmdSZWxhdGl2ZSA/IDEgOiAwLAoKCQkJLy8gVGhlIGZvdW5kYXRpb25hbCBtYXRjaGVyIGVuc3VyZXMgdGhhdCBlbGVtZW50cyBhcmUgcmVhY2hhYmxlIGZyb20gdG9wLWxldmVsIGNvbnRleHQocykKCQkJbWF0Y2hDb250ZXh0ID0gYWRkQ29tYmluYXRvciggZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQlyZXR1cm4gZWxlbSA9PT0gY2hlY2tDb250ZXh0OwoJCQl9LCBpbXBsaWNpdFJlbGF0aXZlLCB0cnVlICksCgkJCW1hdGNoQW55Q29udGV4dCA9IGFkZENvbWJpbmF0b3IoIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJcmV0dXJuIGluZGV4T2YoIGNoZWNrQ29udGV4dCwgZWxlbSApID4gLTE7CgkJCX0sIGltcGxpY2l0UmVsYXRpdmUsIHRydWUgKSwKCQkJbWF0Y2hlcnMgPSBbIGZ1bmN0aW9uKCBlbGVtLCBjb250ZXh0LCB4bWwgKSB7CgkJCQl2YXIgcmV0ID0gKCAhbGVhZGluZ1JlbGF0aXZlICYmICggeG1sIHx8IGNvbnRleHQgIT09IG91dGVybW9zdENvbnRleHQgKSApIHx8ICgKCQkJCQkoY2hlY2tDb250ZXh0ID0gY29udGV4dCkubm9kZVR5cGUgPwoJCQkJCQltYXRjaENvbnRleHQoIGVsZW0sIGNvbnRleHQsIHhtbCApIDoKCQkJCQkJbWF0Y2hBbnlDb250ZXh0KCBlbGVtLCBjb250ZXh0LCB4bWwgKSApOwoJCQkJLy8gQXZvaWQgaGFuZ2luZyBvbnRvIGVsZW1lbnQgKGlzc3VlICMyOTkpCgkJCQljaGVja0NvbnRleHQgPSBudWxsOwoJCQkJcmV0dXJuIHJldDsKCQkJfSBdOwoKCQlmb3IgKCA7IGkgPCBsZW47IGkrKyApIHsKCQkJaWYgKCAobWF0Y2hlciA9IEV4cHIucmVsYXRpdmVbIHRva2Vuc1tpXS50eXBlIF0pICkgewoJCQkJbWF0Y2hlcnMgPSBbIGFkZENvbWJpbmF0b3IoZWxlbWVudE1hdGNoZXIoIG1hdGNoZXJzICksIG1hdGNoZXIpIF07CgkJCX0gZWxzZSB7CgkJCQltYXRjaGVyID0gRXhwci5maWx0ZXJbIHRva2Vuc1tpXS50eXBlIF0uYXBwbHkoIG51bGwsIHRva2Vuc1tpXS5tYXRjaGVzICk7CgoJCQkJLy8gUmV0dXJuIHNwZWNpYWwgdXBvbiBzZWVpbmcgYSBwb3NpdGlvbmFsIG1hdGNoZXIKCQkJCWlmICggbWF0Y2hlclsgZXhwYW5kbyBdICkgewoJCQkJCS8vIEZpbmQgdGhlIG5leHQgcmVsYXRpdmUgb3BlcmF0b3IgKGlmIGFueSkgZm9yIHByb3BlciBoYW5kbGluZwoJCQkJCWogPSArK2k7CgkJCQkJZm9yICggOyBqIDwgbGVuOyBqKysgKSB7CgkJCQkJCWlmICggRXhwci5yZWxhdGl2ZVsgdG9rZW5zW2pdLnR5cGUgXSApIHsKCQkJCQkJCWJyZWFrOwoJCQkJCQl9CgkJCQkJfQoJCQkJCXJldHVybiBzZXRNYXRjaGVyKAoJCQkJCQlpID4gMSAmJiBlbGVtZW50TWF0Y2hlciggbWF0Y2hlcnMgKSwKCQkJCQkJaSA+IDEgJiYgdG9TZWxlY3RvcigKCQkJCQkJCS8vIElmIHRoZSBwcmVjZWRpbmcgdG9rZW4gd2FzIGEgZGVzY2VuZGFudCBjb21iaW5hdG9yLCBpbnNlcnQgYW4gaW1wbGljaXQgYW55LWVsZW1lbnQgYCpgCgkJCQkJCQl0b2tlbnMuc2xpY2UoIDAsIGkgLSAxICkuY29uY2F0KHsgdmFsdWU6IHRva2Vuc1sgaSAtIDIgXS50eXBlID09PSAiICIgPyAiKiIgOiAiIiB9KQoJCQkJCQkpLnJlcGxhY2UoIHJ0cmltLCAiJDEiICksCgkJCQkJCW1hdGNoZXIsCgkJCQkJCWkgPCBqICYmIG1hdGNoZXJGcm9tVG9rZW5zKCB0b2tlbnMuc2xpY2UoIGksIGogKSApLAoJCQkJCQlqIDwgbGVuICYmIG1hdGNoZXJGcm9tVG9rZW5zKCAodG9rZW5zID0gdG9rZW5zLnNsaWNlKCBqICkpICksCgkJCQkJCWogPCBsZW4gJiYgdG9TZWxlY3RvciggdG9rZW5zICkKCQkJCQkpOwoJCQkJfQoJCQkJbWF0Y2hlcnMucHVzaCggbWF0Y2hlciApOwoJCQl9CgkJfQoKCQlyZXR1cm4gZWxlbWVudE1hdGNoZXIoIG1hdGNoZXJzICk7Cgl9CgoJZnVuY3Rpb24gbWF0Y2hlckZyb21Hcm91cE1hdGNoZXJzKCBlbGVtZW50TWF0Y2hlcnMsIHNldE1hdGNoZXJzICkgewoJCXZhciBieVNldCA9IHNldE1hdGNoZXJzLmxlbmd0aCA+IDAsCgkJCWJ5RWxlbWVudCA9IGVsZW1lbnRNYXRjaGVycy5sZW5ndGggPiAwLAoJCQlzdXBlck1hdGNoZXIgPSBmdW5jdGlvbiggc2VlZCwgY29udGV4dCwgeG1sLCByZXN1bHRzLCBvdXRlcm1vc3QgKSB7CgkJCQl2YXIgZWxlbSwgaiwgbWF0Y2hlciwKCQkJCQltYXRjaGVkQ291bnQgPSAwLAoJCQkJCWkgPSAiMCIsCgkJCQkJdW5tYXRjaGVkID0gc2VlZCAmJiBbXSwKCQkJCQlzZXRNYXRjaGVkID0gW10sCgkJCQkJY29udGV4dEJhY2t1cCA9IG91dGVybW9zdENvbnRleHQsCgkJCQkJLy8gV2UgbXVzdCBhbHdheXMgaGF2ZSBlaXRoZXIgc2VlZCBlbGVtZW50cyBvciBvdXRlcm1vc3QgY29udGV4dAoJCQkJCWVsZW1zID0gc2VlZCB8fCBieUVsZW1lbnQgJiYgRXhwci5maW5kWyJUQUciXSggIioiLCBvdXRlcm1vc3QgKSwKCQkJCQkvLyBVc2UgaW50ZWdlciBkaXJydW5zIGlmZiB0aGlzIGlzIHRoZSBvdXRlcm1vc3QgbWF0Y2hlcgoJCQkJCWRpcnJ1bnNVbmlxdWUgPSAoZGlycnVucyArPSBjb250ZXh0QmFja3VwID09IG51bGwgPyAxIDogTWF0aC5yYW5kb20oKSB8fCAwLjEpLAoJCQkJCWxlbiA9IGVsZW1zLmxlbmd0aDsKCgkJCQlpZiAoIG91dGVybW9zdCApIHsKCQkJCQlvdXRlcm1vc3RDb250ZXh0ID0gY29udGV4dCA9PT0gZG9jdW1lbnQgfHwgY29udGV4dCB8fCBvdXRlcm1vc3Q7CgkJCQl9CgoJCQkJLy8gQWRkIGVsZW1lbnRzIHBhc3NpbmcgZWxlbWVudE1hdGNoZXJzIGRpcmVjdGx5IHRvIHJlc3VsdHMKCQkJCS8vIFN1cHBvcnQ6IElFPDksIFNhZmFyaQoJCQkJLy8gVG9sZXJhdGUgTm9kZUxpc3QgcHJvcGVydGllcyAoSUU6ICJsZW5ndGgiOyBTYWZhcmk6IDxudW1iZXI+KSBtYXRjaGluZyBlbGVtZW50cyBieSBpZAoJCQkJZm9yICggOyBpICE9PSBsZW4gJiYgKGVsZW0gPSBlbGVtc1tpXSkgIT0gbnVsbDsgaSsrICkgewoJCQkJCWlmICggYnlFbGVtZW50ICYmIGVsZW0gKSB7CgkJCQkJCWogPSAwOwoJCQkJCQlpZiAoICFjb250ZXh0ICYmIGVsZW0ub3duZXJEb2N1bWVudCAhPT0gZG9jdW1lbnQgKSB7CgkJCQkJCQlzZXREb2N1bWVudCggZWxlbSApOwoJCQkJCQkJeG1sID0gIWRvY3VtZW50SXNIVE1MOwoJCQkJCQl9CgkJCQkJCXdoaWxlICggKG1hdGNoZXIgPSBlbGVtZW50TWF0Y2hlcnNbaisrXSkgKSB7CgkJCQkJCQlpZiAoIG1hdGNoZXIoIGVsZW0sIGNvbnRleHQgfHwgZG9jdW1lbnQsIHhtbCkgKSB7CgkJCQkJCQkJcmVzdWx0cy5wdXNoKCBlbGVtICk7CgkJCQkJCQkJYnJlYWs7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJaWYgKCBvdXRlcm1vc3QgKSB7CgkJCQkJCQlkaXJydW5zID0gZGlycnVuc1VuaXF1ZTsKCQkJCQkJfQoJCQkJCX0KCgkJCQkJLy8gVHJhY2sgdW5tYXRjaGVkIGVsZW1lbnRzIGZvciBzZXQgZmlsdGVycwoJCQkJCWlmICggYnlTZXQgKSB7CgkJCQkJCS8vIFRoZXkgd2lsbCBoYXZlIGdvbmUgdGhyb3VnaCBhbGwgcG9zc2libGUgbWF0Y2hlcnMKCQkJCQkJaWYgKCAoZWxlbSA9ICFtYXRjaGVyICYmIGVsZW0pICkgewoJCQkJCQkJbWF0Y2hlZENvdW50LS07CgkJCQkJCX0KCgkJCQkJCS8vIExlbmd0aGVuIHRoZSBhcnJheSBmb3IgZXZlcnkgZWxlbWVudCwgbWF0Y2hlZCBvciBub3QKCQkJCQkJaWYgKCBzZWVkICkgewoJCQkJCQkJdW5tYXRjaGVkLnB1c2goIGVsZW0gKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCgkJCQkvLyBgaWAgaXMgbm93IHRoZSBjb3VudCBvZiBlbGVtZW50cyB2aXNpdGVkIGFib3ZlLCBhbmQgYWRkaW5nIGl0IHRvIGBtYXRjaGVkQ291bnRgCgkJCQkvLyBtYWtlcyB0aGUgbGF0dGVyIG5vbm5lZ2F0aXZlLgoJCQkJbWF0Y2hlZENvdW50ICs9IGk7CgoJCQkJLy8gQXBwbHkgc2V0IGZpbHRlcnMgdG8gdW5tYXRjaGVkIGVsZW1lbnRzCgkJCQkvLyBOT1RFOiBUaGlzIGNhbiBiZSBza2lwcGVkIGlmIHRoZXJlIGFyZSBubyB1bm1hdGNoZWQgZWxlbWVudHMgKGkuZS4sIGBtYXRjaGVkQ291bnRgCgkJCQkvLyBlcXVhbHMgYGlgKSwgdW5sZXNzIHdlIGRpZG4ndCB2aXNpdCBfYW55XyBlbGVtZW50cyBpbiB0aGUgYWJvdmUgbG9vcCBiZWNhdXNlIHdlIGhhdmUKCQkJCS8vIG5vIGVsZW1lbnQgbWF0Y2hlcnMgYW5kIG5vIHNlZWQuCgkJCQkvLyBJbmNyZW1lbnRpbmcgYW4gaW5pdGlhbGx5LXN0cmluZyAiMCIgYGlgIGFsbG93cyBgaWAgdG8gcmVtYWluIGEgc3RyaW5nIG9ubHkgaW4gdGhhdAoJCQkJLy8gY2FzZSwgd2hpY2ggd2lsbCByZXN1bHQgaW4gYSAiMDAiIGBtYXRjaGVkQ291bnRgIHRoYXQgZGlmZmVycyBmcm9tIGBpYCBidXQgaXMgYWxzbwoJCQkJLy8gbnVtZXJpY2FsbHkgemVyby4KCQkJCWlmICggYnlTZXQgJiYgaSAhPT0gbWF0Y2hlZENvdW50ICkgewoJCQkJCWogPSAwOwoJCQkJCXdoaWxlICggKG1hdGNoZXIgPSBzZXRNYXRjaGVyc1tqKytdKSApIHsKCQkJCQkJbWF0Y2hlciggdW5tYXRjaGVkLCBzZXRNYXRjaGVkLCBjb250ZXh0LCB4bWwgKTsKCQkJCQl9CgoJCQkJCWlmICggc2VlZCApIHsKCQkJCQkJLy8gUmVpbnRlZ3JhdGUgZWxlbWVudCBtYXRjaGVzIHRvIGVsaW1pbmF0ZSB0aGUgbmVlZCBmb3Igc29ydGluZwoJCQkJCQlpZiAoIG1hdGNoZWRDb3VudCA+IDAgKSB7CgkJCQkJCQl3aGlsZSAoIGktLSApIHsKCQkJCQkJCQlpZiAoICEodW5tYXRjaGVkW2ldIHx8IHNldE1hdGNoZWRbaV0pICkgewoJCQkJCQkJCQlzZXRNYXRjaGVkW2ldID0gcG9wLmNhbGwoIHJlc3VsdHMgKTsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0KCgkJCQkJCS8vIERpc2NhcmQgaW5kZXggcGxhY2Vob2xkZXIgdmFsdWVzIHRvIGdldCBvbmx5IGFjdHVhbCBtYXRjaGVzCgkJCQkJCXNldE1hdGNoZWQgPSBjb25kZW5zZSggc2V0TWF0Y2hlZCApOwoJCQkJCX0KCgkJCQkJLy8gQWRkIG1hdGNoZXMgdG8gcmVzdWx0cwoJCQkJCXB1c2guYXBwbHkoIHJlc3VsdHMsIHNldE1hdGNoZWQgKTsKCgkJCQkJLy8gU2VlZGxlc3Mgc2V0IG1hdGNoZXMgc3VjY2VlZGluZyBtdWx0aXBsZSBzdWNjZXNzZnVsIG1hdGNoZXJzIHN0aXB1bGF0ZSBzb3J0aW5nCgkJCQkJaWYgKCBvdXRlcm1vc3QgJiYgIXNlZWQgJiYgc2V0TWF0Y2hlZC5sZW5ndGggPiAwICYmCgkJCQkJCSggbWF0Y2hlZENvdW50ICsgc2V0TWF0Y2hlcnMubGVuZ3RoICkgPiAxICkgewoKCQkJCQkJU2l6emxlLnVuaXF1ZVNvcnQoIHJlc3VsdHMgKTsKCQkJCQl9CgkJCQl9CgoJCQkJLy8gT3ZlcnJpZGUgbWFuaXB1bGF0aW9uIG9mIGdsb2JhbHMgYnkgbmVzdGVkIG1hdGNoZXJzCgkJCQlpZiAoIG91dGVybW9zdCApIHsKCQkJCQlkaXJydW5zID0gZGlycnVuc1VuaXF1ZTsKCQkJCQlvdXRlcm1vc3RDb250ZXh0ID0gY29udGV4dEJhY2t1cDsKCQkJCX0KCgkJCQlyZXR1cm4gdW5tYXRjaGVkOwoJCQl9OwoKCQlyZXR1cm4gYnlTZXQgPwoJCQltYXJrRnVuY3Rpb24oIHN1cGVyTWF0Y2hlciApIDoKCQkJc3VwZXJNYXRjaGVyOwoJfQoKCWNvbXBpbGUgPSBTaXp6bGUuY29tcGlsZSA9IGZ1bmN0aW9uKCBzZWxlY3RvciwgbWF0Y2ggLyogSW50ZXJuYWwgVXNlIE9ubHkgKi8gKSB7CgkJdmFyIGksCgkJCXNldE1hdGNoZXJzID0gW10sCgkJCWVsZW1lbnRNYXRjaGVycyA9IFtdLAoJCQljYWNoZWQgPSBjb21waWxlckNhY2hlWyBzZWxlY3RvciArICIgIiBdOwoKCQlpZiAoICFjYWNoZWQgKSB7CgkJCS8vIEdlbmVyYXRlIGEgZnVuY3Rpb24gb2YgcmVjdXJzaXZlIGZ1bmN0aW9ucyB0aGF0IGNhbiBiZSB1c2VkIHRvIGNoZWNrIGVhY2ggZWxlbWVudAoJCQlpZiAoICFtYXRjaCApIHsKCQkJCW1hdGNoID0gdG9rZW5pemUoIHNlbGVjdG9yICk7CgkJCX0KCQkJaSA9IG1hdGNoLmxlbmd0aDsKCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQljYWNoZWQgPSBtYXRjaGVyRnJvbVRva2VucyggbWF0Y2hbaV0gKTsKCQkJCWlmICggY2FjaGVkWyBleHBhbmRvIF0gKSB7CgkJCQkJc2V0TWF0Y2hlcnMucHVzaCggY2FjaGVkICk7CgkJCQl9IGVsc2UgewoJCQkJCWVsZW1lbnRNYXRjaGVycy5wdXNoKCBjYWNoZWQgKTsKCQkJCX0KCQkJfQoKCQkJLy8gQ2FjaGUgdGhlIGNvbXBpbGVkIGZ1bmN0aW9uCgkJCWNhY2hlZCA9IGNvbXBpbGVyQ2FjaGUoIHNlbGVjdG9yLCBtYXRjaGVyRnJvbUdyb3VwTWF0Y2hlcnMoIGVsZW1lbnRNYXRjaGVycywgc2V0TWF0Y2hlcnMgKSApOwoKCQkJLy8gU2F2ZSBzZWxlY3RvciBhbmQgdG9rZW5pemF0aW9uCgkJCWNhY2hlZC5zZWxlY3RvciA9IHNlbGVjdG9yOwoJCX0KCQlyZXR1cm4gY2FjaGVkOwoJfTsKCgkvKioKCSAqIEEgbG93LWxldmVsIHNlbGVjdGlvbiBmdW5jdGlvbiB0aGF0IHdvcmtzIHdpdGggU2l6emxlJ3MgY29tcGlsZWQKCSAqICBzZWxlY3RvciBmdW5jdGlvbnMKCSAqIEBwYXJhbSB7U3RyaW5nfEZ1bmN0aW9ufSBzZWxlY3RvciBBIHNlbGVjdG9yIG9yIGEgcHJlLWNvbXBpbGVkCgkgKiAgc2VsZWN0b3IgZnVuY3Rpb24gYnVpbHQgd2l0aCBTaXp6bGUuY29tcGlsZQoJICogQHBhcmFtIHtFbGVtZW50fSBjb250ZXh0CgkgKiBAcGFyYW0ge0FycmF5fSBbcmVzdWx0c10KCSAqIEBwYXJhbSB7QXJyYXl9IFtzZWVkXSBBIHNldCBvZiBlbGVtZW50cyB0byBtYXRjaCBhZ2FpbnN0CgkgKi8KCXNlbGVjdCA9IFNpenpsZS5zZWxlY3QgPSBmdW5jdGlvbiggc2VsZWN0b3IsIGNvbnRleHQsIHJlc3VsdHMsIHNlZWQgKSB7CgkJdmFyIGksIHRva2VucywgdG9rZW4sIHR5cGUsIGZpbmQsCgkJCWNvbXBpbGVkID0gdHlwZW9mIHNlbGVjdG9yID09PSAiZnVuY3Rpb24iICYmIHNlbGVjdG9yLAoJCQltYXRjaCA9ICFzZWVkICYmIHRva2VuaXplKCAoc2VsZWN0b3IgPSBjb21waWxlZC5zZWxlY3RvciB8fCBzZWxlY3RvcikgKTsKCgkJcmVzdWx0cyA9IHJlc3VsdHMgfHwgW107CgoJCS8vIFRyeSB0byBtaW5pbWl6ZSBvcGVyYXRpb25zIGlmIHRoZXJlIGlzIG9ubHkgb25lIHNlbGVjdG9yIGluIHRoZSBsaXN0IGFuZCBubyBzZWVkCgkJLy8gKHRoZSBsYXR0ZXIgb2Ygd2hpY2ggZ3VhcmFudGVlcyB1cyBjb250ZXh0KQoJCWlmICggbWF0Y2gubGVuZ3RoID09PSAxICkgewoKCQkJLy8gUmVkdWNlIGNvbnRleHQgaWYgdGhlIGxlYWRpbmcgY29tcG91bmQgc2VsZWN0b3IgaXMgYW4gSUQKCQkJdG9rZW5zID0gbWF0Y2hbMF0gPSBtYXRjaFswXS5zbGljZSggMCApOwoJCQlpZiAoIHRva2Vucy5sZW5ndGggPiAyICYmICh0b2tlbiA9IHRva2Vuc1swXSkudHlwZSA9PT0gIklEIiAmJgoJCQkJCXN1cHBvcnQuZ2V0QnlJZCAmJiBjb250ZXh0Lm5vZGVUeXBlID09PSA5ICYmIGRvY3VtZW50SXNIVE1MICYmCgkJCQkJRXhwci5yZWxhdGl2ZVsgdG9rZW5zWzFdLnR5cGUgXSApIHsKCgkJCQljb250ZXh0ID0gKCBFeHByLmZpbmRbIklEIl0oIHRva2VuLm1hdGNoZXNbMF0ucmVwbGFjZShydW5lc2NhcGUsIGZ1bmVzY2FwZSksIGNvbnRleHQgKSB8fCBbXSApWzBdOwoJCQkJaWYgKCAhY29udGV4dCApIHsKCQkJCQlyZXR1cm4gcmVzdWx0czsKCgkJCQkvLyBQcmVjb21waWxlZCBtYXRjaGVycyB3aWxsIHN0aWxsIHZlcmlmeSBhbmNlc3RyeSwgc28gc3RlcCB1cCBhIGxldmVsCgkJCQl9IGVsc2UgaWYgKCBjb21waWxlZCApIHsKCQkJCQljb250ZXh0ID0gY29udGV4dC5wYXJlbnROb2RlOwoJCQkJfQoKCQkJCXNlbGVjdG9yID0gc2VsZWN0b3Iuc2xpY2UoIHRva2Vucy5zaGlmdCgpLnZhbHVlLmxlbmd0aCApOwoJCQl9CgoJCQkvLyBGZXRjaCBhIHNlZWQgc2V0IGZvciByaWdodC10by1sZWZ0IG1hdGNoaW5nCgkJCWkgPSBtYXRjaEV4cHJbIm5lZWRzQ29udGV4dCJdLnRlc3QoIHNlbGVjdG9yICkgPyAwIDogdG9rZW5zLmxlbmd0aDsKCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQl0b2tlbiA9IHRva2Vuc1tpXTsKCgkJCQkvLyBBYm9ydCBpZiB3ZSBoaXQgYSBjb21iaW5hdG9yCgkJCQlpZiAoIEV4cHIucmVsYXRpdmVbICh0eXBlID0gdG9rZW4udHlwZSkgXSApIHsKCQkJCQlicmVhazsKCQkJCX0KCQkJCWlmICggKGZpbmQgPSBFeHByLmZpbmRbIHR5cGUgXSkgKSB7CgkJCQkJLy8gU2VhcmNoLCBleHBhbmRpbmcgY29udGV4dCBmb3IgbGVhZGluZyBzaWJsaW5nIGNvbWJpbmF0b3JzCgkJCQkJaWYgKCAoc2VlZCA9IGZpbmQoCgkJCQkJCXRva2VuLm1hdGNoZXNbMF0ucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKSwKCQkJCQkJcnNpYmxpbmcudGVzdCggdG9rZW5zWzBdLnR5cGUgKSAmJiB0ZXN0Q29udGV4dCggY29udGV4dC5wYXJlbnROb2RlICkgfHwgY29udGV4dAoJCQkJCSkpICkgewoKCQkJCQkJLy8gSWYgc2VlZCBpcyBlbXB0eSBvciBubyB0b2tlbnMgcmVtYWluLCB3ZSBjYW4gcmV0dXJuIGVhcmx5CgkJCQkJCXRva2Vucy5zcGxpY2UoIGksIDEgKTsKCQkJCQkJc2VsZWN0b3IgPSBzZWVkLmxlbmd0aCAmJiB0b1NlbGVjdG9yKCB0b2tlbnMgKTsKCQkJCQkJaWYgKCAhc2VsZWN0b3IgKSB7CgkJCQkJCQlwdXNoLmFwcGx5KCByZXN1bHRzLCBzZWVkICk7CgkJCQkJCQlyZXR1cm4gcmVzdWx0czsKCQkJCQkJfQoKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoKCQkvLyBDb21waWxlIGFuZCBleGVjdXRlIGEgZmlsdGVyaW5nIGZ1bmN0aW9uIGlmIG9uZSBpcyBub3QgcHJvdmlkZWQKCQkvLyBQcm92aWRlIGBtYXRjaGAgdG8gYXZvaWQgcmV0b2tlbml6YXRpb24gaWYgd2UgbW9kaWZpZWQgdGhlIHNlbGVjdG9yIGFib3ZlCgkJKCBjb21waWxlZCB8fCBjb21waWxlKCBzZWxlY3RvciwgbWF0Y2ggKSApKAoJCQlzZWVkLAoJCQljb250ZXh0LAoJCQkhZG9jdW1lbnRJc0hUTUwsCgkJCXJlc3VsdHMsCgkJCSFjb250ZXh0IHx8IHJzaWJsaW5nLnRlc3QoIHNlbGVjdG9yICkgJiYgdGVzdENvbnRleHQoIGNvbnRleHQucGFyZW50Tm9kZSApIHx8IGNvbnRleHQKCQkpOwoJCXJldHVybiByZXN1bHRzOwoJfTsKCgkvLyBPbmUtdGltZSBhc3NpZ25tZW50cwoKCS8vIFNvcnQgc3RhYmlsaXR5CglzdXBwb3J0LnNvcnRTdGFibGUgPSBleHBhbmRvLnNwbGl0KCIiKS5zb3J0KCBzb3J0T3JkZXIgKS5qb2luKCIiKSA9PT0gZXhwYW5kbzsKCgkvLyBTdXBwb3J0OiBDaHJvbWUgMTQtMzUrCgkvLyBBbHdheXMgYXNzdW1lIGR1cGxpY2F0ZXMgaWYgdGhleSBhcmVuJ3QgcGFzc2VkIHRvIHRoZSBjb21wYXJpc29uIGZ1bmN0aW9uCglzdXBwb3J0LmRldGVjdER1cGxpY2F0ZXMgPSAhIWhhc0R1cGxpY2F0ZTsKCgkvLyBJbml0aWFsaXplIGFnYWluc3QgdGhlIGRlZmF1bHQgZG9jdW1lbnQKCXNldERvY3VtZW50KCk7CgoJLy8gU3VwcG9ydDogV2Via2l0PDUzNy4zMiAtIFNhZmFyaSA2LjAuMy9DaHJvbWUgMjUgKGZpeGVkIGluIENocm9tZSAyNykKCS8vIERldGFjaGVkIG5vZGVzIGNvbmZvdW5kaW5nbHkgZm9sbG93ICplYWNoIG90aGVyKgoJc3VwcG9ydC5zb3J0RGV0YWNoZWQgPSBhc3NlcnQoZnVuY3Rpb24oIGRpdjEgKSB7CgkJLy8gU2hvdWxkIHJldHVybiAxLCBidXQgcmV0dXJucyA0IChmb2xsb3dpbmcpCgkJcmV0dXJuIGRpdjEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpICkgJiAxOwoJfSk7CgoJLy8gU3VwcG9ydDogSUU8OAoJLy8gUHJldmVudCBhdHRyaWJ1dGUvcHJvcGVydHkgImludGVycG9sYXRpb24iCgkvLyBodHRwOi8vbXNkbi5taWNyb3NvZnQuY29tL2VuLXVzL2xpYnJhcnkvbXM1MzY0MjklMjhWUy44NSUyOS5hc3B4CglpZiAoICFhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHsKCQlkaXYuaW5uZXJIVE1MID0gIjxhIGhyZWY9JyMnPjwvYT4iOwoJCXJldHVybiBkaXYuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUoImhyZWYiKSA9PT0gIiMiIDsKCX0pICkgewoJCWFkZEhhbmRsZSggInR5cGV8aHJlZnxoZWlnaHR8d2lkdGgiLCBmdW5jdGlvbiggZWxlbSwgbmFtZSwgaXNYTUwgKSB7CgkJCWlmICggIWlzWE1MICkgewoJCQkJcmV0dXJuIGVsZW0uZ2V0QXR0cmlidXRlKCBuYW1lLCBuYW1lLnRvTG93ZXJDYXNlKCkgPT09ICJ0eXBlIiA/IDEgOiAyICk7CgkJCX0KCQl9KTsKCX0KCgkvLyBTdXBwb3J0OiBJRTw5CgkvLyBVc2UgZGVmYXVsdFZhbHVlIGluIHBsYWNlIG9mIGdldEF0dHJpYnV0ZSgidmFsdWUiKQoJaWYgKCAhc3VwcG9ydC5hdHRyaWJ1dGVzIHx8ICFhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHsKCQlkaXYuaW5uZXJIVE1MID0gIjxpbnB1dC8+IjsKCQlkaXYuZmlyc3RDaGlsZC5zZXRBdHRyaWJ1dGUoICJ2YWx1ZSIsICIiICk7CgkJcmV0dXJuIGRpdi5maXJzdENoaWxkLmdldEF0dHJpYnV0ZSggInZhbHVlIiApID09PSAiIjsKCX0pICkgewoJCWFkZEhhbmRsZSggInZhbHVlIiwgZnVuY3Rpb24oIGVsZW0sIG5hbWUsIGlzWE1MICkgewoJCQlpZiAoICFpc1hNTCAmJiBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICJpbnB1dCIgKSB7CgkJCQlyZXR1cm4gZWxlbS5kZWZhdWx0VmFsdWU7CgkJCX0KCQl9KTsKCX0KCgkvLyBTdXBwb3J0OiBJRTw5CgkvLyBVc2UgZ2V0QXR0cmlidXRlTm9kZSB0byBmZXRjaCBib29sZWFucyB3aGVuIGdldEF0dHJpYnV0ZSBsaWVzCglpZiAoICFhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHsKCQlyZXR1cm4gZGl2LmdldEF0dHJpYnV0ZSgiZGlzYWJsZWQiKSA9PSBudWxsOwoJfSkgKSB7CgkJYWRkSGFuZGxlKCBib29sZWFucywgZnVuY3Rpb24oIGVsZW0sIG5hbWUsIGlzWE1MICkgewoJCQl2YXIgdmFsOwoJCQlpZiAoICFpc1hNTCApIHsKCQkJCXJldHVybiBlbGVtWyBuYW1lIF0gPT09IHRydWUgPyBuYW1lLnRvTG93ZXJDYXNlKCkgOgoJCQkJCQkodmFsID0gZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKCBuYW1lICkpICYmIHZhbC5zcGVjaWZpZWQgPwoJCQkJCQl2YWwudmFsdWUgOgoJCQkJCW51bGw7CgkJCX0KCQl9KTsKCX0KCglyZXR1cm4gU2l6emxlOwoKCX0pKCB3aW5kb3cgKTsKCgoKCWpRdWVyeS5maW5kID0gU2l6emxlOwoJalF1ZXJ5LmV4cHIgPSBTaXp6bGUuc2VsZWN0b3JzOwoJalF1ZXJ5LmV4cHJbICI6IiBdID0galF1ZXJ5LmV4cHIucHNldWRvczsKCWpRdWVyeS51bmlxdWVTb3J0ID0galF1ZXJ5LnVuaXF1ZSA9IFNpenpsZS51bmlxdWVTb3J0OwoJalF1ZXJ5LnRleHQgPSBTaXp6bGUuZ2V0VGV4dDsKCWpRdWVyeS5pc1hNTERvYyA9IFNpenpsZS5pc1hNTDsKCWpRdWVyeS5jb250YWlucyA9IFNpenpsZS5jb250YWluczsKCgoKCXZhciBkaXIgPSBmdW5jdGlvbiggZWxlbSwgZGlyLCB1bnRpbCApIHsKCQl2YXIgbWF0Y2hlZCA9IFtdLAoJCQl0cnVuY2F0ZSA9IHVudGlsICE9PSB1bmRlZmluZWQ7CgoJCXdoaWxlICggKCBlbGVtID0gZWxlbVsgZGlyIF0gKSAmJiBlbGVtLm5vZGVUeXBlICE9PSA5ICkgewoJCQlpZiAoIGVsZW0ubm9kZVR5cGUgPT09IDEgKSB7CgkJCQlpZiAoIHRydW5jYXRlICYmIGpRdWVyeSggZWxlbSApLmlzKCB1bnRpbCApICkgewoJCQkJCWJyZWFrOwoJCQkJfQoJCQkJbWF0Y2hlZC5wdXNoKCBlbGVtICk7CgkJCX0KCQl9CgkJcmV0dXJuIG1hdGNoZWQ7Cgl9OwoKCgl2YXIgc2libGluZ3MgPSBmdW5jdGlvbiggbiwgZWxlbSApIHsKCQl2YXIgbWF0Y2hlZCA9IFtdOwoKCQlmb3IgKCA7IG47IG4gPSBuLm5leHRTaWJsaW5nICkgewoJCQlpZiAoIG4ubm9kZVR5cGUgPT09IDEgJiYgbiAhPT0gZWxlbSApIHsKCQkJCW1hdGNoZWQucHVzaCggbiApOwoJCQl9CgkJfQoKCQlyZXR1cm4gbWF0Y2hlZDsKCX07CgoKCXZhciBybmVlZHNDb250ZXh0ID0galF1ZXJ5LmV4cHIubWF0Y2gubmVlZHNDb250ZXh0OwoKCXZhciByc2luZ2xlVGFnID0gKCAvXjwoW1x3LV0rKVxzKlwvPz4oPzo8XC9cMT58KSQvICk7CgoKCgl2YXIgcmlzU2ltcGxlID0gL14uW146I1xbXC4sXSokLzsKCgkvLyBJbXBsZW1lbnQgdGhlIGlkZW50aWNhbCBmdW5jdGlvbmFsaXR5IGZvciBmaWx0ZXIgYW5kIG5vdAoJZnVuY3Rpb24gd2lubm93KCBlbGVtZW50cywgcXVhbGlmaWVyLCBub3QgKSB7CgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggcXVhbGlmaWVyICkgKSB7CgkJCXJldHVybiBqUXVlcnkuZ3JlcCggZWxlbWVudHMsIGZ1bmN0aW9uKCBlbGVtLCBpICkgewoJCQkJLyoganNoaW50IC1XMDE4ICovCgkJCQlyZXR1cm4gISFxdWFsaWZpZXIuY2FsbCggZWxlbSwgaSwgZWxlbSApICE9PSBub3Q7CgkJCX0gKTsKCgkJfQoKCQlpZiAoIHF1YWxpZmllci5ub2RlVHlwZSApIHsKCQkJcmV0dXJuIGpRdWVyeS5ncmVwKCBlbGVtZW50cywgZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQlyZXR1cm4gKCBlbGVtID09PSBxdWFsaWZpZXIgKSAhPT0gbm90OwoJCQl9ICk7CgoJCX0KCgkJaWYgKCB0eXBlb2YgcXVhbGlmaWVyID09PSAic3RyaW5nIiApIHsKCQkJaWYgKCByaXNTaW1wbGUudGVzdCggcXVhbGlmaWVyICkgKSB7CgkJCQlyZXR1cm4galF1ZXJ5LmZpbHRlciggcXVhbGlmaWVyLCBlbGVtZW50cywgbm90ICk7CgkJCX0KCgkJCXF1YWxpZmllciA9IGpRdWVyeS5maWx0ZXIoIHF1YWxpZmllciwgZWxlbWVudHMgKTsKCQl9CgoJCXJldHVybiBqUXVlcnkuZ3JlcCggZWxlbWVudHMsIGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gKCBqUXVlcnkuaW5BcnJheSggZWxlbSwgcXVhbGlmaWVyICkgPiAtMSApICE9PSBub3Q7CgkJfSApOwoJfQoKCWpRdWVyeS5maWx0ZXIgPSBmdW5jdGlvbiggZXhwciwgZWxlbXMsIG5vdCApIHsKCQl2YXIgZWxlbSA9IGVsZW1zWyAwIF07CgoJCWlmICggbm90ICkgewoJCQlleHByID0gIjpub3QoIiArIGV4cHIgKyAiKSI7CgkJfQoKCQlyZXR1cm4gZWxlbXMubGVuZ3RoID09PSAxICYmIGVsZW0ubm9kZVR5cGUgPT09IDEgPwoJCQlqUXVlcnkuZmluZC5tYXRjaGVzU2VsZWN0b3IoIGVsZW0sIGV4cHIgKSA/IFsgZWxlbSBdIDogW10gOgoJCQlqUXVlcnkuZmluZC5tYXRjaGVzKCBleHByLCBqUXVlcnkuZ3JlcCggZWxlbXMsIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJcmV0dXJuIGVsZW0ubm9kZVR5cGUgPT09IDE7CgkJCX0gKSApOwoJfTsKCglqUXVlcnkuZm4uZXh0ZW5kKCB7CgkJZmluZDogZnVuY3Rpb24oIHNlbGVjdG9yICkgewoJCQl2YXIgaSwKCQkJCXJldCA9IFtdLAoJCQkJc2VsZiA9IHRoaXMsCgkJCQlsZW4gPSBzZWxmLmxlbmd0aDsKCgkJCWlmICggdHlwZW9mIHNlbGVjdG9yICE9PSAic3RyaW5nIiApIHsKCQkJCXJldHVybiB0aGlzLnB1c2hTdGFjayggalF1ZXJ5KCBzZWxlY3RvciApLmZpbHRlciggZnVuY3Rpb24oKSB7CgkJCQkJZm9yICggaSA9IDA7IGkgPCBsZW47IGkrKyApIHsKCQkJCQkJaWYgKCBqUXVlcnkuY29udGFpbnMoIHNlbGZbIGkgXSwgdGhpcyApICkgewoJCQkJCQkJcmV0dXJuIHRydWU7CgkJCQkJCX0KCQkJCQl9CgkJCQl9ICkgKTsKCQkJfQoKCQkJZm9yICggaSA9IDA7IGkgPCBsZW47IGkrKyApIHsKCQkJCWpRdWVyeS5maW5kKCBzZWxlY3Rvciwgc2VsZlsgaSBdLCByZXQgKTsKCQkJfQoKCQkJLy8gTmVlZGVkIGJlY2F1c2UgJCggc2VsZWN0b3IsIGNvbnRleHQgKSBiZWNvbWVzICQoIGNvbnRleHQgKS5maW5kKCBzZWxlY3RvciApCgkJCXJldCA9IHRoaXMucHVzaFN0YWNrKCBsZW4gPiAxID8galF1ZXJ5LnVuaXF1ZSggcmV0ICkgOiByZXQgKTsKCQkJcmV0LnNlbGVjdG9yID0gdGhpcy5zZWxlY3RvciA/IHRoaXMuc2VsZWN0b3IgKyAiICIgKyBzZWxlY3RvciA6IHNlbGVjdG9yOwoJCQlyZXR1cm4gcmV0OwoJCX0sCgkJZmlsdGVyOiBmdW5jdGlvbiggc2VsZWN0b3IgKSB7CgkJCXJldHVybiB0aGlzLnB1c2hTdGFjayggd2lubm93KCB0aGlzLCBzZWxlY3RvciB8fCBbXSwgZmFsc2UgKSApOwoJCX0sCgkJbm90OiBmdW5jdGlvbiggc2VsZWN0b3IgKSB7CgkJCXJldHVybiB0aGlzLnB1c2hTdGFjayggd2lubm93KCB0aGlzLCBzZWxlY3RvciB8fCBbXSwgdHJ1ZSApICk7CgkJfSwKCQlpczogZnVuY3Rpb24oIHNlbGVjdG9yICkgewoJCQlyZXR1cm4gISF3aW5ub3coCgkJCQl0aGlzLAoKCQkJCS8vIElmIHRoaXMgaXMgYSBwb3NpdGlvbmFsL3JlbGF0aXZlIHNlbGVjdG9yLCBjaGVjayBtZW1iZXJzaGlwIGluIHRoZSByZXR1cm5lZCBzZXQKCQkJCS8vIHNvICQoInA6Zmlyc3QiKS5pcygicDpsYXN0Iikgd29uJ3QgcmV0dXJuIHRydWUgZm9yIGEgZG9jIHdpdGggdHdvICJwIi4KCQkJCXR5cGVvZiBzZWxlY3RvciA9PT0gInN0cmluZyIgJiYgcm5lZWRzQ29udGV4dC50ZXN0KCBzZWxlY3RvciApID8KCQkJCQlqUXVlcnkoIHNlbGVjdG9yICkgOgoJCQkJCXNlbGVjdG9yIHx8IFtdLAoJCQkJZmFsc2UKCQkJKS5sZW5ndGg7CgkJfQoJfSApOwoKCgkvLyBJbml0aWFsaXplIGEgalF1ZXJ5IG9iamVjdAoKCgkvLyBBIGNlbnRyYWwgcmVmZXJlbmNlIHRvIHRoZSByb290IGpRdWVyeShkb2N1bWVudCkKCXZhciByb290alF1ZXJ5LAoKCQkvLyBBIHNpbXBsZSB3YXkgdG8gY2hlY2sgZm9yIEhUTUwgc3RyaW5ncwoJCS8vIFByaW9yaXRpemUgI2lkIG92ZXIgPHRhZz4gdG8gYXZvaWQgWFNTIHZpYSBsb2NhdGlvbi5oYXNoICgjOTUyMSkKCQkvLyBTdHJpY3QgSFRNTCByZWNvZ25pdGlvbiAoIzExMjkwOiBtdXN0IHN0YXJ0IHdpdGggPCkKCQlycXVpY2tFeHByID0gL14oPzpccyooPFtcd1xXXSs+KVtePl0qfCMoW1x3LV0qKSkkLywKCgkJaW5pdCA9IGpRdWVyeS5mbi5pbml0ID0gZnVuY3Rpb24oIHNlbGVjdG9yLCBjb250ZXh0LCByb290ICkgewoJCQl2YXIgbWF0Y2gsIGVsZW07CgoJCQkvLyBIQU5ETEU6ICQoIiIpLCAkKG51bGwpLCAkKHVuZGVmaW5lZCksICQoZmFsc2UpCgkJCWlmICggIXNlbGVjdG9yICkgewoJCQkJcmV0dXJuIHRoaXM7CgkJCX0KCgkJCS8vIGluaXQgYWNjZXB0cyBhbiBhbHRlcm5hdGUgcm9vdGpRdWVyeQoJCQkvLyBzbyBtaWdyYXRlIGNhbiBzdXBwb3J0IGpRdWVyeS5zdWIgKGdoLTIxMDEpCgkJCXJvb3QgPSByb290IHx8IHJvb3RqUXVlcnk7CgoJCQkvLyBIYW5kbGUgSFRNTCBzdHJpbmdzCgkJCWlmICggdHlwZW9mIHNlbGVjdG9yID09PSAic3RyaW5nIiApIHsKCQkJCWlmICggc2VsZWN0b3IuY2hhckF0KCAwICkgPT09ICI8IiAmJgoJCQkJCXNlbGVjdG9yLmNoYXJBdCggc2VsZWN0b3IubGVuZ3RoIC0gMSApID09PSAiPiIgJiYKCQkJCQlzZWxlY3Rvci5sZW5ndGggPj0gMyApIHsKCgkJCQkJLy8gQXNzdW1lIHRoYXQgc3RyaW5ncyB0aGF0IHN0YXJ0IGFuZCBlbmQgd2l0aCA8PiBhcmUgSFRNTCBhbmQgc2tpcCB0aGUgcmVnZXggY2hlY2sKCQkJCQltYXRjaCA9IFsgbnVsbCwgc2VsZWN0b3IsIG51bGwgXTsKCgkJCQl9IGVsc2UgewoJCQkJCW1hdGNoID0gcnF1aWNrRXhwci5leGVjKCBzZWxlY3RvciApOwoJCQkJfQoKCQkJCS8vIE1hdGNoIGh0bWwgb3IgbWFrZSBzdXJlIG5vIGNvbnRleHQgaXMgc3BlY2lmaWVkIGZvciAjaWQKCQkJCWlmICggbWF0Y2ggJiYgKCBtYXRjaFsgMSBdIHx8ICFjb250ZXh0ICkgKSB7CgoJCQkJCS8vIEhBTkRMRTogJChodG1sKSAtPiAkKGFycmF5KQoJCQkJCWlmICggbWF0Y2hbIDEgXSApIHsKCQkJCQkJY29udGV4dCA9IGNvbnRleHQgaW5zdGFuY2VvZiBqUXVlcnkgPyBjb250ZXh0WyAwIF0gOiBjb250ZXh0OwoKCQkJCQkJLy8gc2NyaXB0cyBpcyB0cnVlIGZvciBiYWNrLWNvbXBhdAoJCQkJCQkvLyBJbnRlbnRpb25hbGx5IGxldCB0aGUgZXJyb3IgYmUgdGhyb3duIGlmIHBhcnNlSFRNTCBpcyBub3QgcHJlc2VudAoJCQkJCQlqUXVlcnkubWVyZ2UoIHRoaXMsIGpRdWVyeS5wYXJzZUhUTUwoCgkJCQkJCQltYXRjaFsgMSBdLAoJCQkJCQkJY29udGV4dCAmJiBjb250ZXh0Lm5vZGVUeXBlID8gY29udGV4dC5vd25lckRvY3VtZW50IHx8IGNvbnRleHQgOiBkb2N1bWVudCwKCQkJCQkJCXRydWUKCQkJCQkJKSApOwoKCQkJCQkJLy8gSEFORExFOiAkKGh0bWwsIHByb3BzKQoJCQkJCQlpZiAoIHJzaW5nbGVUYWcudGVzdCggbWF0Y2hbIDEgXSApICYmIGpRdWVyeS5pc1BsYWluT2JqZWN0KCBjb250ZXh0ICkgKSB7CgkJCQkJCQlmb3IgKCBtYXRjaCBpbiBjb250ZXh0ICkgewoKCQkJCQkJCQkvLyBQcm9wZXJ0aWVzIG9mIGNvbnRleHQgYXJlIGNhbGxlZCBhcyBtZXRob2RzIGlmIHBvc3NpYmxlCgkJCQkJCQkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggdGhpc1sgbWF0Y2ggXSApICkgewoJCQkJCQkJCQl0aGlzWyBtYXRjaCBdKCBjb250ZXh0WyBtYXRjaCBdICk7CgoJCQkJCQkJCS8vIC4uLmFuZCBvdGhlcndpc2Ugc2V0IGFzIGF0dHJpYnV0ZXMKCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQl0aGlzLmF0dHIoIG1hdGNoLCBjb250ZXh0WyBtYXRjaCBdICk7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9CgoJCQkJCQlyZXR1cm4gdGhpczsKCgkJCQkJLy8gSEFORExFOiAkKCNpZCkKCQkJCQl9IGVsc2UgewoJCQkJCQllbGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIG1hdGNoWyAyIF0gKTsKCgkJCQkJCS8vIENoZWNrIHBhcmVudE5vZGUgdG8gY2F0Y2ggd2hlbiBCbGFja2JlcnJ5IDQuNiByZXR1cm5zCgkJCQkJCS8vIG5vZGVzIHRoYXQgYXJlIG5vIGxvbmdlciBpbiB0aGUgZG9jdW1lbnQgIzY5NjMKCQkJCQkJaWYgKCBlbGVtICYmIGVsZW0ucGFyZW50Tm9kZSApIHsKCgkJCQkJCQkvLyBIYW5kbGUgdGhlIGNhc2Ugd2hlcmUgSUUgYW5kIE9wZXJhIHJldHVybiBpdGVtcwoJCQkJCQkJLy8gYnkgbmFtZSBpbnN0ZWFkIG9mIElECgkJCQkJCQlpZiAoIGVsZW0uaWQgIT09IG1hdGNoWyAyIF0gKSB7CgkJCQkJCQkJcmV0dXJuIHJvb3RqUXVlcnkuZmluZCggc2VsZWN0b3IgKTsKCQkJCQkJCX0KCgkJCQkJCQkvLyBPdGhlcndpc2UsIHdlIGluamVjdCB0aGUgZWxlbWVudCBkaXJlY3RseSBpbnRvIHRoZSBqUXVlcnkgb2JqZWN0CgkJCQkJCQl0aGlzLmxlbmd0aCA9IDE7CgkJCQkJCQl0aGlzWyAwIF0gPSBlbGVtOwoJCQkJCQl9CgoJCQkJCQl0aGlzLmNvbnRleHQgPSBkb2N1bWVudDsKCQkJCQkJdGhpcy5zZWxlY3RvciA9IHNlbGVjdG9yOwoJCQkJCQlyZXR1cm4gdGhpczsKCQkJCQl9CgoJCQkJLy8gSEFORExFOiAkKGV4cHIsICQoLi4uKSkKCQkJCX0gZWxzZSBpZiAoICFjb250ZXh0IHx8IGNvbnRleHQuanF1ZXJ5ICkgewoJCQkJCXJldHVybiAoIGNvbnRleHQgfHwgcm9vdCApLmZpbmQoIHNlbGVjdG9yICk7CgoJCQkJLy8gSEFORExFOiAkKGV4cHIsIGNvbnRleHQpCgkJCQkvLyAod2hpY2ggaXMganVzdCBlcXVpdmFsZW50IHRvOiAkKGNvbnRleHQpLmZpbmQoZXhwcikKCQkJCX0gZWxzZSB7CgkJCQkJcmV0dXJuIHRoaXMuY29uc3RydWN0b3IoIGNvbnRleHQgKS5maW5kKCBzZWxlY3RvciApOwoJCQkJfQoKCQkJLy8gSEFORExFOiAkKERPTUVsZW1lbnQpCgkJCX0gZWxzZSBpZiAoIHNlbGVjdG9yLm5vZGVUeXBlICkgewoJCQkJdGhpcy5jb250ZXh0ID0gdGhpc1sgMCBdID0gc2VsZWN0b3I7CgkJCQl0aGlzLmxlbmd0aCA9IDE7CgkJCQlyZXR1cm4gdGhpczsKCgkJCS8vIEhBTkRMRTogJChmdW5jdGlvbikKCQkJLy8gU2hvcnRjdXQgZm9yIGRvY3VtZW50IHJlYWR5CgkJCX0gZWxzZSBpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBzZWxlY3RvciApICkgewoJCQkJcmV0dXJuIHR5cGVvZiByb290LnJlYWR5ICE9PSAidW5kZWZpbmVkIiA/CgkJCQkJcm9vdC5yZWFkeSggc2VsZWN0b3IgKSA6CgoJCQkJCS8vIEV4ZWN1dGUgaW1tZWRpYXRlbHkgaWYgcmVhZHkgaXMgbm90IHByZXNlbnQKCQkJCQlzZWxlY3RvciggalF1ZXJ5ICk7CgkJCX0KCgkJCWlmICggc2VsZWN0b3Iuc2VsZWN0b3IgIT09IHVuZGVmaW5lZCApIHsKCQkJCXRoaXMuc2VsZWN0b3IgPSBzZWxlY3Rvci5zZWxlY3RvcjsKCQkJCXRoaXMuY29udGV4dCA9IHNlbGVjdG9yLmNvbnRleHQ7CgkJCX0KCgkJCXJldHVybiBqUXVlcnkubWFrZUFycmF5KCBzZWxlY3RvciwgdGhpcyApOwoJCX07CgoJLy8gR2l2ZSB0aGUgaW5pdCBmdW5jdGlvbiB0aGUgalF1ZXJ5IHByb3RvdHlwZSBmb3IgbGF0ZXIgaW5zdGFudGlhdGlvbgoJaW5pdC5wcm90b3R5cGUgPSBqUXVlcnkuZm47CgoJLy8gSW5pdGlhbGl6ZSBjZW50cmFsIHJlZmVyZW5jZQoJcm9vdGpRdWVyeSA9IGpRdWVyeSggZG9jdW1lbnQgKTsKCgoJdmFyIHJwYXJlbnRzcHJldiA9IC9eKD86cGFyZW50c3xwcmV2KD86VW50aWx8QWxsKSkvLAoKCQkvLyBtZXRob2RzIGd1YXJhbnRlZWQgdG8gcHJvZHVjZSBhIHVuaXF1ZSBzZXQgd2hlbiBzdGFydGluZyBmcm9tIGEgdW5pcXVlIHNldAoJCWd1YXJhbnRlZWRVbmlxdWUgPSB7CgkJCWNoaWxkcmVuOiB0cnVlLAoJCQljb250ZW50czogdHJ1ZSwKCQkJbmV4dDogdHJ1ZSwKCQkJcHJldjogdHJ1ZQoJCX07CgoJalF1ZXJ5LmZuLmV4dGVuZCggewoJCWhhczogZnVuY3Rpb24oIHRhcmdldCApIHsKCQkJdmFyIGksCgkJCQl0YXJnZXRzID0galF1ZXJ5KCB0YXJnZXQsIHRoaXMgKSwKCQkJCWxlbiA9IHRhcmdldHMubGVuZ3RoOwoKCQkJcmV0dXJuIHRoaXMuZmlsdGVyKCBmdW5jdGlvbigpIHsKCQkJCWZvciAoIGkgPSAwOyBpIDwgbGVuOyBpKysgKSB7CgkJCQkJaWYgKCBqUXVlcnkuY29udGFpbnMoIHRoaXMsIHRhcmdldHNbIGkgXSApICkgewoJCQkJCQlyZXR1cm4gdHJ1ZTsKCQkJCQl9CgkJCQl9CgkJCX0gKTsKCQl9LAoKCQljbG9zZXN0OiBmdW5jdGlvbiggc2VsZWN0b3JzLCBjb250ZXh0ICkgewoJCQl2YXIgY3VyLAoJCQkJaSA9IDAsCgkJCQlsID0gdGhpcy5sZW5ndGgsCgkJCQltYXRjaGVkID0gW10sCgkJCQlwb3MgPSBybmVlZHNDb250ZXh0LnRlc3QoIHNlbGVjdG9ycyApIHx8IHR5cGVvZiBzZWxlY3RvcnMgIT09ICJzdHJpbmciID8KCQkJCQlqUXVlcnkoIHNlbGVjdG9ycywgY29udGV4dCB8fCB0aGlzLmNvbnRleHQgKSA6CgkJCQkJMDsKCgkJCWZvciAoIDsgaSA8IGw7IGkrKyApIHsKCQkJCWZvciAoIGN1ciA9IHRoaXNbIGkgXTsgY3VyICYmIGN1ciAhPT0gY29udGV4dDsgY3VyID0gY3VyLnBhcmVudE5vZGUgKSB7CgoJCQkJCS8vIEFsd2F5cyBza2lwIGRvY3VtZW50IGZyYWdtZW50cwoJCQkJCWlmICggY3VyLm5vZGVUeXBlIDwgMTEgJiYgKCBwb3MgPwoJCQkJCQlwb3MuaW5kZXgoIGN1ciApID4gLTEgOgoKCQkJCQkJLy8gRG9uJ3QgcGFzcyBub24tZWxlbWVudHMgdG8gU2l6emxlCgkJCQkJCWN1ci5ub2RlVHlwZSA9PT0gMSAmJgoJCQkJCQkJalF1ZXJ5LmZpbmQubWF0Y2hlc1NlbGVjdG9yKCBjdXIsIHNlbGVjdG9ycyApICkgKSB7CgoJCQkJCQltYXRjaGVkLnB1c2goIGN1ciApOwoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQl9CgkJCX0KCgkJCXJldHVybiB0aGlzLnB1c2hTdGFjayggbWF0Y2hlZC5sZW5ndGggPiAxID8galF1ZXJ5LnVuaXF1ZVNvcnQoIG1hdGNoZWQgKSA6IG1hdGNoZWQgKTsKCQl9LAoKCQkvLyBEZXRlcm1pbmUgdGhlIHBvc2l0aW9uIG9mIGFuIGVsZW1lbnQgd2l0aGluCgkJLy8gdGhlIG1hdGNoZWQgc2V0IG9mIGVsZW1lbnRzCgkJaW5kZXg6IGZ1bmN0aW9uKCBlbGVtICkgewoKCQkJLy8gTm8gYXJndW1lbnQsIHJldHVybiBpbmRleCBpbiBwYXJlbnQKCQkJaWYgKCAhZWxlbSApIHsKCQkJCXJldHVybiAoIHRoaXNbIDAgXSAmJiB0aGlzWyAwIF0ucGFyZW50Tm9kZSApID8gdGhpcy5maXJzdCgpLnByZXZBbGwoKS5sZW5ndGggOiAtMTsKCQkJfQoKCQkJLy8gaW5kZXggaW4gc2VsZWN0b3IKCQkJaWYgKCB0eXBlb2YgZWxlbSA9PT0gInN0cmluZyIgKSB7CgkJCQlyZXR1cm4galF1ZXJ5LmluQXJyYXkoIHRoaXNbIDAgXSwgalF1ZXJ5KCBlbGVtICkgKTsKCQkJfQoKCQkJLy8gTG9jYXRlIHRoZSBwb3NpdGlvbiBvZiB0aGUgZGVzaXJlZCBlbGVtZW50CgkJCXJldHVybiBqUXVlcnkuaW5BcnJheSgKCgkJCQkvLyBJZiBpdCByZWNlaXZlcyBhIGpRdWVyeSBvYmplY3QsIHRoZSBmaXJzdCBlbGVtZW50IGlzIHVzZWQKCQkJCWVsZW0uanF1ZXJ5ID8gZWxlbVsgMCBdIDogZWxlbSwgdGhpcyApOwoJCX0sCgoJCWFkZDogZnVuY3Rpb24oIHNlbGVjdG9yLCBjb250ZXh0ICkgewoJCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soCgkJCQlqUXVlcnkudW5pcXVlU29ydCgKCQkJCQlqUXVlcnkubWVyZ2UoIHRoaXMuZ2V0KCksIGpRdWVyeSggc2VsZWN0b3IsIGNvbnRleHQgKSApCgkJCQkpCgkJCSk7CgkJfSwKCgkJYWRkQmFjazogZnVuY3Rpb24oIHNlbGVjdG9yICkgewoJCQlyZXR1cm4gdGhpcy5hZGQoIHNlbGVjdG9yID09IG51bGwgPwoJCQkJdGhpcy5wcmV2T2JqZWN0IDogdGhpcy5wcmV2T2JqZWN0LmZpbHRlciggc2VsZWN0b3IgKQoJCQkpOwoJCX0KCX0gKTsKCglmdW5jdGlvbiBzaWJsaW5nKCBjdXIsIGRpciApIHsKCQlkbyB7CgkJCWN1ciA9IGN1clsgZGlyIF07CgkJfSB3aGlsZSAoIGN1ciAmJiBjdXIubm9kZVR5cGUgIT09IDEgKTsKCgkJcmV0dXJuIGN1cjsKCX0KCglqUXVlcnkuZWFjaCggewoJCXBhcmVudDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXZhciBwYXJlbnQgPSBlbGVtLnBhcmVudE5vZGU7CgkJCXJldHVybiBwYXJlbnQgJiYgcGFyZW50Lm5vZGVUeXBlICE9PSAxMSA/IHBhcmVudCA6IG51bGw7CgkJfSwKCQlwYXJlbnRzOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIGRpciggZWxlbSwgInBhcmVudE5vZGUiICk7CgkJfSwKCQlwYXJlbnRzVW50aWw6IGZ1bmN0aW9uKCBlbGVtLCBpLCB1bnRpbCApIHsKCQkJcmV0dXJuIGRpciggZWxlbSwgInBhcmVudE5vZGUiLCB1bnRpbCApOwoJCX0sCgkJbmV4dDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiBzaWJsaW5nKCBlbGVtLCAibmV4dFNpYmxpbmciICk7CgkJfSwKCQlwcmV2OiBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIHNpYmxpbmcoIGVsZW0sICJwcmV2aW91c1NpYmxpbmciICk7CgkJfSwKCQluZXh0QWxsOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIGRpciggZWxlbSwgIm5leHRTaWJsaW5nIiApOwoJCX0sCgkJcHJldkFsbDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiBkaXIoIGVsZW0sICJwcmV2aW91c1NpYmxpbmciICk7CgkJfSwKCQluZXh0VW50aWw6IGZ1bmN0aW9uKCBlbGVtLCBpLCB1bnRpbCApIHsKCQkJcmV0dXJuIGRpciggZWxlbSwgIm5leHRTaWJsaW5nIiwgdW50aWwgKTsKCQl9LAoJCXByZXZVbnRpbDogZnVuY3Rpb24oIGVsZW0sIGksIHVudGlsICkgewoJCQlyZXR1cm4gZGlyKCBlbGVtLCAicHJldmlvdXNTaWJsaW5nIiwgdW50aWwgKTsKCQl9LAoJCXNpYmxpbmdzOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIHNpYmxpbmdzKCAoIGVsZW0ucGFyZW50Tm9kZSB8fCB7fSApLmZpcnN0Q2hpbGQsIGVsZW0gKTsKCQl9LAoJCWNoaWxkcmVuOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIHNpYmxpbmdzKCBlbGVtLmZpcnN0Q2hpbGQgKTsKCQl9LAoJCWNvbnRlbnRzOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIGpRdWVyeS5ub2RlTmFtZSggZWxlbSwgImlmcmFtZSIgKSA/CgkJCQllbGVtLmNvbnRlbnREb2N1bWVudCB8fCBlbGVtLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQgOgoJCQkJalF1ZXJ5Lm1lcmdlKCBbXSwgZWxlbS5jaGlsZE5vZGVzICk7CgkJfQoJfSwgZnVuY3Rpb24oIG5hbWUsIGZuICkgewoJCWpRdWVyeS5mblsgbmFtZSBdID0gZnVuY3Rpb24oIHVudGlsLCBzZWxlY3RvciApIHsKCQkJdmFyIHJldCA9IGpRdWVyeS5tYXAoIHRoaXMsIGZuLCB1bnRpbCApOwoKCQkJaWYgKCBuYW1lLnNsaWNlKCAtNSApICE9PSAiVW50aWwiICkgewoJCQkJc2VsZWN0b3IgPSB1bnRpbDsKCQkJfQoKCQkJaWYgKCBzZWxlY3RvciAmJiB0eXBlb2Ygc2VsZWN0b3IgPT09ICJzdHJpbmciICkgewoJCQkJcmV0ID0galF1ZXJ5LmZpbHRlciggc2VsZWN0b3IsIHJldCApOwoJCQl9CgoJCQlpZiAoIHRoaXMubGVuZ3RoID4gMSApIHsKCgkJCQkvLyBSZW1vdmUgZHVwbGljYXRlcwoJCQkJaWYgKCAhZ3VhcmFudGVlZFVuaXF1ZVsgbmFtZSBdICkgewoJCQkJCXJldCA9IGpRdWVyeS51bmlxdWVTb3J0KCByZXQgKTsKCQkJCX0KCgkJCQkvLyBSZXZlcnNlIG9yZGVyIGZvciBwYXJlbnRzKiBhbmQgcHJldi1kZXJpdmF0aXZlcwoJCQkJaWYgKCBycGFyZW50c3ByZXYudGVzdCggbmFtZSApICkgewoJCQkJCXJldCA9IHJldC5yZXZlcnNlKCk7CgkJCQl9CgkJCX0KCgkJCXJldHVybiB0aGlzLnB1c2hTdGFjayggcmV0ICk7CgkJfTsKCX0gKTsKCXZhciBybm90d2hpdGUgPSAoIC9cUysvZyApOwoKCgoJLy8gQ29udmVydCBTdHJpbmctZm9ybWF0dGVkIG9wdGlvbnMgaW50byBPYmplY3QtZm9ybWF0dGVkIG9uZXMKCWZ1bmN0aW9uIGNyZWF0ZU9wdGlvbnMoIG9wdGlvbnMgKSB7CgkJdmFyIG9iamVjdCA9IHt9OwoJCWpRdWVyeS5lYWNoKCBvcHRpb25zLm1hdGNoKCBybm90d2hpdGUgKSB8fCBbXSwgZnVuY3Rpb24oIF8sIGZsYWcgKSB7CgkJCW9iamVjdFsgZmxhZyBdID0gdHJ1ZTsKCQl9ICk7CgkJcmV0dXJuIG9iamVjdDsKCX0KCgkvKgoJICogQ3JlYXRlIGEgY2FsbGJhY2sgbGlzdCB1c2luZyB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6CgkgKgoJICoJb3B0aW9uczogYW4gb3B0aW9uYWwgbGlzdCBvZiBzcGFjZS1zZXBhcmF0ZWQgb3B0aW9ucyB0aGF0IHdpbGwgY2hhbmdlIGhvdwoJICoJCQl0aGUgY2FsbGJhY2sgbGlzdCBiZWhhdmVzIG9yIGEgbW9yZSB0cmFkaXRpb25hbCBvcHRpb24gb2JqZWN0CgkgKgoJICogQnkgZGVmYXVsdCBhIGNhbGxiYWNrIGxpc3Qgd2lsbCBhY3QgbGlrZSBhbiBldmVudCBjYWxsYmFjayBsaXN0IGFuZCBjYW4gYmUKCSAqICJmaXJlZCIgbXVsdGlwbGUgdGltZXMuCgkgKgoJICogUG9zc2libGUgb3B0aW9uczoKCSAqCgkgKglvbmNlOgkJCXdpbGwgZW5zdXJlIHRoZSBjYWxsYmFjayBsaXN0IGNhbiBvbmx5IGJlIGZpcmVkIG9uY2UgKGxpa2UgYSBEZWZlcnJlZCkKCSAqCgkgKgltZW1vcnk6CQkJd2lsbCBrZWVwIHRyYWNrIG9mIHByZXZpb3VzIHZhbHVlcyBhbmQgd2lsbCBjYWxsIGFueSBjYWxsYmFjayBhZGRlZAoJICoJCQkJCWFmdGVyIHRoZSBsaXN0IGhhcyBiZWVuIGZpcmVkIHJpZ2h0IGF3YXkgd2l0aCB0aGUgbGF0ZXN0ICJtZW1vcml6ZWQiCgkgKgkJCQkJdmFsdWVzIChsaWtlIGEgRGVmZXJyZWQpCgkgKgoJICoJdW5pcXVlOgkJCXdpbGwgZW5zdXJlIGEgY2FsbGJhY2sgY2FuIG9ubHkgYmUgYWRkZWQgb25jZSAobm8gZHVwbGljYXRlIGluIHRoZSBsaXN0KQoJICoKCSAqCXN0b3BPbkZhbHNlOglpbnRlcnJ1cHQgY2FsbGluZ3Mgd2hlbiBhIGNhbGxiYWNrIHJldHVybnMgZmFsc2UKCSAqCgkgKi8KCWpRdWVyeS5DYWxsYmFja3MgPSBmdW5jdGlvbiggb3B0aW9ucyApIHsKCgkJLy8gQ29udmVydCBvcHRpb25zIGZyb20gU3RyaW5nLWZvcm1hdHRlZCB0byBPYmplY3QtZm9ybWF0dGVkIGlmIG5lZWRlZAoJCS8vICh3ZSBjaGVjayBpbiBjYWNoZSBmaXJzdCkKCQlvcHRpb25zID0gdHlwZW9mIG9wdGlvbnMgPT09ICJzdHJpbmciID8KCQkJY3JlYXRlT3B0aW9ucyggb3B0aW9ucyApIDoKCQkJalF1ZXJ5LmV4dGVuZCgge30sIG9wdGlvbnMgKTsKCgkJdmFyIC8vIEZsYWcgdG8ga25vdyBpZiBsaXN0IGlzIGN1cnJlbnRseSBmaXJpbmcKCQkJZmlyaW5nLAoKCQkJLy8gTGFzdCBmaXJlIHZhbHVlIGZvciBub24tZm9yZ2V0dGFibGUgbGlzdHMKCQkJbWVtb3J5LAoKCQkJLy8gRmxhZyB0byBrbm93IGlmIGxpc3Qgd2FzIGFscmVhZHkgZmlyZWQKCQkJZmlyZWQsCgoJCQkvLyBGbGFnIHRvIHByZXZlbnQgZmlyaW5nCgkJCWxvY2tlZCwKCgkJCS8vIEFjdHVhbCBjYWxsYmFjayBsaXN0CgkJCWxpc3QgPSBbXSwKCgkJCS8vIFF1ZXVlIG9mIGV4ZWN1dGlvbiBkYXRhIGZvciByZXBlYXRhYmxlIGxpc3RzCgkJCXF1ZXVlID0gW10sCgoJCQkvLyBJbmRleCBvZiBjdXJyZW50bHkgZmlyaW5nIGNhbGxiYWNrIChtb2RpZmllZCBieSBhZGQvcmVtb3ZlIGFzIG5lZWRlZCkKCQkJZmlyaW5nSW5kZXggPSAtMSwKCgkJCS8vIEZpcmUgY2FsbGJhY2tzCgkJCWZpcmUgPSBmdW5jdGlvbigpIHsKCgkJCQkvLyBFbmZvcmNlIHNpbmdsZS1maXJpbmcKCQkJCWxvY2tlZCA9IG9wdGlvbnMub25jZTsKCgkJCQkvLyBFeGVjdXRlIGNhbGxiYWNrcyBmb3IgYWxsIHBlbmRpbmcgZXhlY3V0aW9ucywKCQkJCS8vIHJlc3BlY3RpbmcgZmlyaW5nSW5kZXggb3ZlcnJpZGVzIGFuZCBydW50aW1lIGNoYW5nZXMKCQkJCWZpcmVkID0gZmlyaW5nID0gdHJ1ZTsKCQkJCWZvciAoIDsgcXVldWUubGVuZ3RoOyBmaXJpbmdJbmRleCA9IC0xICkgewoJCQkJCW1lbW9yeSA9IHF1ZXVlLnNoaWZ0KCk7CgkJCQkJd2hpbGUgKCArK2ZpcmluZ0luZGV4IDwgbGlzdC5sZW5ndGggKSB7CgoJCQkJCQkvLyBSdW4gY2FsbGJhY2sgYW5kIGNoZWNrIGZvciBlYXJseSB0ZXJtaW5hdGlvbgoJCQkJCQlpZiAoIGxpc3RbIGZpcmluZ0luZGV4IF0uYXBwbHkoIG1lbW9yeVsgMCBdLCBtZW1vcnlbIDEgXSApID09PSBmYWxzZSAmJgoJCQkJCQkJb3B0aW9ucy5zdG9wT25GYWxzZSApIHsKCgkJCQkJCQkvLyBKdW1wIHRvIGVuZCBhbmQgZm9yZ2V0IHRoZSBkYXRhIHNvIC5hZGQgZG9lc24ndCByZS1maXJlCgkJCQkJCQlmaXJpbmdJbmRleCA9IGxpc3QubGVuZ3RoOwoJCQkJCQkJbWVtb3J5ID0gZmFsc2U7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgoJCQkJLy8gRm9yZ2V0IHRoZSBkYXRhIGlmIHdlJ3JlIGRvbmUgd2l0aCBpdAoJCQkJaWYgKCAhb3B0aW9ucy5tZW1vcnkgKSB7CgkJCQkJbWVtb3J5ID0gZmFsc2U7CgkJCQl9CgoJCQkJZmlyaW5nID0gZmFsc2U7CgoJCQkJLy8gQ2xlYW4gdXAgaWYgd2UncmUgZG9uZSBmaXJpbmcgZm9yIGdvb2QKCQkJCWlmICggbG9ja2VkICkgewoKCQkJCQkvLyBLZWVwIGFuIGVtcHR5IGxpc3QgaWYgd2UgaGF2ZSBkYXRhIGZvciBmdXR1cmUgYWRkIGNhbGxzCgkJCQkJaWYgKCBtZW1vcnkgKSB7CgkJCQkJCWxpc3QgPSBbXTsKCgkJCQkJLy8gT3RoZXJ3aXNlLCB0aGlzIG9iamVjdCBpcyBzcGVudAoJCQkJCX0gZWxzZSB7CgkJCQkJCWxpc3QgPSAiIjsKCQkJCQl9CgkJCQl9CgkJCX0sCgoJCQkvLyBBY3R1YWwgQ2FsbGJhY2tzIG9iamVjdAoJCQlzZWxmID0gewoKCQkJCS8vIEFkZCBhIGNhbGxiYWNrIG9yIGEgY29sbGVjdGlvbiBvZiBjYWxsYmFja3MgdG8gdGhlIGxpc3QKCQkJCWFkZDogZnVuY3Rpb24oKSB7CgkJCQkJaWYgKCBsaXN0ICkgewoKCQkJCQkJLy8gSWYgd2UgaGF2ZSBtZW1vcnkgZnJvbSBhIHBhc3QgcnVuLCB3ZSBzaG91bGQgZmlyZSBhZnRlciBhZGRpbmcKCQkJCQkJaWYgKCBtZW1vcnkgJiYgIWZpcmluZyApIHsKCQkJCQkJCWZpcmluZ0luZGV4ID0gbGlzdC5sZW5ndGggLSAxOwoJCQkJCQkJcXVldWUucHVzaCggbWVtb3J5ICk7CgkJCQkJCX0KCgkJCQkJCSggZnVuY3Rpb24gYWRkKCBhcmdzICkgewoJCQkJCQkJalF1ZXJ5LmVhY2goIGFyZ3MsIGZ1bmN0aW9uKCBfLCBhcmcgKSB7CgkJCQkJCQkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggYXJnICkgKSB7CgkJCQkJCQkJCWlmICggIW9wdGlvbnMudW5pcXVlIHx8ICFzZWxmLmhhcyggYXJnICkgKSB7CgkJCQkJCQkJCQlsaXN0LnB1c2goIGFyZyApOwoJCQkJCQkJCQl9CgkJCQkJCQkJfSBlbHNlIGlmICggYXJnICYmIGFyZy5sZW5ndGggJiYgalF1ZXJ5LnR5cGUoIGFyZyApICE9PSAic3RyaW5nIiApIHsKCgkJCQkJCQkJCS8vIEluc3BlY3QgcmVjdXJzaXZlbHkKCQkJCQkJCQkJYWRkKCBhcmcgKTsKCQkJCQkJCQl9CgkJCQkJCQl9ICk7CgkJCQkJCX0gKSggYXJndW1lbnRzICk7CgoJCQkJCQlpZiAoIG1lbW9yeSAmJiAhZmlyaW5nICkgewoJCQkJCQkJZmlyZSgpOwoJCQkJCQl9CgkJCQkJfQoJCQkJCXJldHVybiB0aGlzOwoJCQkJfSwKCgkJCQkvLyBSZW1vdmUgYSBjYWxsYmFjayBmcm9tIHRoZSBsaXN0CgkJCQlyZW1vdmU6IGZ1bmN0aW9uKCkgewoJCQkJCWpRdWVyeS5lYWNoKCBhcmd1bWVudHMsIGZ1bmN0aW9uKCBfLCBhcmcgKSB7CgkJCQkJCXZhciBpbmRleDsKCQkJCQkJd2hpbGUgKCAoIGluZGV4ID0galF1ZXJ5LmluQXJyYXkoIGFyZywgbGlzdCwgaW5kZXggKSApID4gLTEgKSB7CgkJCQkJCQlsaXN0LnNwbGljZSggaW5kZXgsIDEgKTsKCgkJCQkJCQkvLyBIYW5kbGUgZmlyaW5nIGluZGV4ZXMKCQkJCQkJCWlmICggaW5kZXggPD0gZmlyaW5nSW5kZXggKSB7CgkJCQkJCQkJZmlyaW5nSW5kZXgtLTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0gKTsKCQkJCQlyZXR1cm4gdGhpczsKCQkJCX0sCgoJCQkJLy8gQ2hlY2sgaWYgYSBnaXZlbiBjYWxsYmFjayBpcyBpbiB0aGUgbGlzdC4KCQkJCS8vIElmIG5vIGFyZ3VtZW50IGlzIGdpdmVuLCByZXR1cm4gd2hldGhlciBvciBub3QgbGlzdCBoYXMgY2FsbGJhY2tzIGF0dGFjaGVkLgoJCQkJaGFzOiBmdW5jdGlvbiggZm4gKSB7CgkJCQkJcmV0dXJuIGZuID8KCQkJCQkJalF1ZXJ5LmluQXJyYXkoIGZuLCBsaXN0ICkgPiAtMSA6CgkJCQkJCWxpc3QubGVuZ3RoID4gMDsKCQkJCX0sCgoJCQkJLy8gUmVtb3ZlIGFsbCBjYWxsYmFja3MgZnJvbSB0aGUgbGlzdAoJCQkJZW1wdHk6IGZ1bmN0aW9uKCkgewoJCQkJCWlmICggbGlzdCApIHsKCQkJCQkJbGlzdCA9IFtdOwoJCQkJCX0KCQkJCQlyZXR1cm4gdGhpczsKCQkJCX0sCgoJCQkJLy8gRGlzYWJsZSAuZmlyZSBhbmQgLmFkZAoJCQkJLy8gQWJvcnQgYW55IGN1cnJlbnQvcGVuZGluZyBleGVjdXRpb25zCgkJCQkvLyBDbGVhciBhbGwgY2FsbGJhY2tzIGFuZCB2YWx1ZXMKCQkJCWRpc2FibGU6IGZ1bmN0aW9uKCkgewoJCQkJCWxvY2tlZCA9IHF1ZXVlID0gW107CgkJCQkJbGlzdCA9IG1lbW9yeSA9ICIiOwoJCQkJCXJldHVybiB0aGlzOwoJCQkJfSwKCQkJCWRpc2FibGVkOiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gIWxpc3Q7CgkJCQl9LAoKCQkJCS8vIERpc2FibGUgLmZpcmUKCQkJCS8vIEFsc28gZGlzYWJsZSAuYWRkIHVubGVzcyB3ZSBoYXZlIG1lbW9yeSAoc2luY2UgaXQgd291bGQgaGF2ZSBubyBlZmZlY3QpCgkJCQkvLyBBYm9ydCBhbnkgcGVuZGluZyBleGVjdXRpb25zCgkJCQlsb2NrOiBmdW5jdGlvbigpIHsKCQkJCQlsb2NrZWQgPSB0cnVlOwoJCQkJCWlmICggIW1lbW9yeSApIHsKCQkJCQkJc2VsZi5kaXNhYmxlKCk7CgkJCQkJfQoJCQkJCXJldHVybiB0aGlzOwoJCQkJfSwKCQkJCWxvY2tlZDogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuICEhbG9ja2VkOwoJCQkJfSwKCgkJCQkvLyBDYWxsIGFsbCBjYWxsYmFja3Mgd2l0aCB0aGUgZ2l2ZW4gY29udGV4dCBhbmQgYXJndW1lbnRzCgkJCQlmaXJlV2l0aDogZnVuY3Rpb24oIGNvbnRleHQsIGFyZ3MgKSB7CgkJCQkJaWYgKCAhbG9ja2VkICkgewoJCQkJCQlhcmdzID0gYXJncyB8fCBbXTsKCQkJCQkJYXJncyA9IFsgY29udGV4dCwgYXJncy5zbGljZSA/IGFyZ3Muc2xpY2UoKSA6IGFyZ3MgXTsKCQkJCQkJcXVldWUucHVzaCggYXJncyApOwoJCQkJCQlpZiAoICFmaXJpbmcgKSB7CgkJCQkJCQlmaXJlKCk7CgkJCQkJCX0KCQkJCQl9CgkJCQkJcmV0dXJuIHRoaXM7CgkJCQl9LAoKCQkJCS8vIENhbGwgYWxsIHRoZSBjYWxsYmFja3Mgd2l0aCB0aGUgZ2l2ZW4gYXJndW1lbnRzCgkJCQlmaXJlOiBmdW5jdGlvbigpIHsKCQkJCQlzZWxmLmZpcmVXaXRoKCB0aGlzLCBhcmd1bWVudHMgKTsKCQkJCQlyZXR1cm4gdGhpczsKCQkJCX0sCgoJCQkJLy8gVG8ga25vdyBpZiB0aGUgY2FsbGJhY2tzIGhhdmUgYWxyZWFkeSBiZWVuIGNhbGxlZCBhdCBsZWFzdCBvbmNlCgkJCQlmaXJlZDogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuICEhZmlyZWQ7CgkJCQl9CgkJCX07CgoJCXJldHVybiBzZWxmOwoJfTsKCgoJalF1ZXJ5LmV4dGVuZCggewoKCQlEZWZlcnJlZDogZnVuY3Rpb24oIGZ1bmMgKSB7CgkJCXZhciB0dXBsZXMgPSBbCgoJCQkJCS8vIGFjdGlvbiwgYWRkIGxpc3RlbmVyLCBsaXN0ZW5lciBsaXN0LCBmaW5hbCBzdGF0ZQoJCQkJCVsgInJlc29sdmUiLCAiZG9uZSIsIGpRdWVyeS5DYWxsYmFja3MoICJvbmNlIG1lbW9yeSIgKSwgInJlc29sdmVkIiBdLAoJCQkJCVsgInJlamVjdCIsICJmYWlsIiwgalF1ZXJ5LkNhbGxiYWNrcyggIm9uY2UgbWVtb3J5IiApLCAicmVqZWN0ZWQiIF0sCgkJCQkJWyAibm90aWZ5IiwgInByb2dyZXNzIiwgalF1ZXJ5LkNhbGxiYWNrcyggIm1lbW9yeSIgKSBdCgkJCQldLAoJCQkJc3RhdGUgPSAicGVuZGluZyIsCgkJCQlwcm9taXNlID0gewoJCQkJCXN0YXRlOiBmdW5jdGlvbigpIHsKCQkJCQkJcmV0dXJuIHN0YXRlOwoJCQkJCX0sCgkJCQkJYWx3YXlzOiBmdW5jdGlvbigpIHsKCQkJCQkJZGVmZXJyZWQuZG9uZSggYXJndW1lbnRzICkuZmFpbCggYXJndW1lbnRzICk7CgkJCQkJCXJldHVybiB0aGlzOwoJCQkJCX0sCgkJCQkJdGhlbjogZnVuY3Rpb24oIC8qIGZuRG9uZSwgZm5GYWlsLCBmblByb2dyZXNzICovICkgewoJCQkJCQl2YXIgZm5zID0gYXJndW1lbnRzOwoJCQkJCQlyZXR1cm4galF1ZXJ5LkRlZmVycmVkKCBmdW5jdGlvbiggbmV3RGVmZXIgKSB7CgkJCQkJCQlqUXVlcnkuZWFjaCggdHVwbGVzLCBmdW5jdGlvbiggaSwgdHVwbGUgKSB7CgkJCQkJCQkJdmFyIGZuID0galF1ZXJ5LmlzRnVuY3Rpb24oIGZuc1sgaSBdICkgJiYgZm5zWyBpIF07CgoJCQkJCQkJCS8vIGRlZmVycmVkWyBkb25lIHwgZmFpbCB8IHByb2dyZXNzIF0gZm9yIGZvcndhcmRpbmcgYWN0aW9ucyB0byBuZXdEZWZlcgoJCQkJCQkJCWRlZmVycmVkWyB0dXBsZVsgMSBdIF0oIGZ1bmN0aW9uKCkgewoJCQkJCQkJCQl2YXIgcmV0dXJuZWQgPSBmbiAmJiBmbi5hcHBseSggdGhpcywgYXJndW1lbnRzICk7CgkJCQkJCQkJCWlmICggcmV0dXJuZWQgJiYgalF1ZXJ5LmlzRnVuY3Rpb24oIHJldHVybmVkLnByb21pc2UgKSApIHsKCQkJCQkJCQkJCXJldHVybmVkLnByb21pc2UoKQoJCQkJCQkJCQkJCS5wcm9ncmVzcyggbmV3RGVmZXIubm90aWZ5ICkKCQkJCQkJCQkJCQkuZG9uZSggbmV3RGVmZXIucmVzb2x2ZSApCgkJCQkJCQkJCQkJLmZhaWwoIG5ld0RlZmVyLnJlamVjdCApOwoJCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQkJbmV3RGVmZXJbIHR1cGxlWyAwIF0gKyAiV2l0aCIgXSgKCQkJCQkJCQkJCQl0aGlzID09PSBwcm9taXNlID8gbmV3RGVmZXIucHJvbWlzZSgpIDogdGhpcywKCQkJCQkJCQkJCQlmbiA/IFsgcmV0dXJuZWQgXSA6IGFyZ3VtZW50cwoJCQkJCQkJCQkJKTsKCQkJCQkJCQkJfQoJCQkJCQkJCX0gKTsKCQkJCQkJCX0gKTsKCQkJCQkJCWZucyA9IG51bGw7CgkJCQkJCX0gKS5wcm9taXNlKCk7CgkJCQkJfSwKCgkJCQkJLy8gR2V0IGEgcHJvbWlzZSBmb3IgdGhpcyBkZWZlcnJlZAoJCQkJCS8vIElmIG9iaiBpcyBwcm92aWRlZCwgdGhlIHByb21pc2UgYXNwZWN0IGlzIGFkZGVkIHRvIHRoZSBvYmplY3QKCQkJCQlwcm9taXNlOiBmdW5jdGlvbiggb2JqICkgewoJCQkJCQlyZXR1cm4gb2JqICE9IG51bGwgPyBqUXVlcnkuZXh0ZW5kKCBvYmosIHByb21pc2UgKSA6IHByb21pc2U7CgkJCQkJfQoJCQkJfSwKCQkJCWRlZmVycmVkID0ge307CgoJCQkvLyBLZWVwIHBpcGUgZm9yIGJhY2stY29tcGF0CgkJCXByb21pc2UucGlwZSA9IHByb21pc2UudGhlbjsKCgkJCS8vIEFkZCBsaXN0LXNwZWNpZmljIG1ldGhvZHMKCQkJalF1ZXJ5LmVhY2goIHR1cGxlcywgZnVuY3Rpb24oIGksIHR1cGxlICkgewoJCQkJdmFyIGxpc3QgPSB0dXBsZVsgMiBdLAoJCQkJCXN0YXRlU3RyaW5nID0gdHVwbGVbIDMgXTsKCgkJCQkvLyBwcm9taXNlWyBkb25lIHwgZmFpbCB8IHByb2dyZXNzIF0gPSBsaXN0LmFkZAoJCQkJcHJvbWlzZVsgdHVwbGVbIDEgXSBdID0gbGlzdC5hZGQ7CgoJCQkJLy8gSGFuZGxlIHN0YXRlCgkJCQlpZiAoIHN0YXRlU3RyaW5nICkgewoJCQkJCWxpc3QuYWRkKCBmdW5jdGlvbigpIHsKCgkJCQkJCS8vIHN0YXRlID0gWyByZXNvbHZlZCB8IHJlamVjdGVkIF0KCQkJCQkJc3RhdGUgPSBzdGF0ZVN0cmluZzsKCgkJCQkJLy8gWyByZWplY3RfbGlzdCB8IHJlc29sdmVfbGlzdCBdLmRpc2FibGU7IHByb2dyZXNzX2xpc3QubG9jawoJCQkJCX0sIHR1cGxlc1sgaSBeIDEgXVsgMiBdLmRpc2FibGUsIHR1cGxlc1sgMiBdWyAyIF0ubG9jayApOwoJCQkJfQoKCQkJCS8vIGRlZmVycmVkWyByZXNvbHZlIHwgcmVqZWN0IHwgbm90aWZ5IF0KCQkJCWRlZmVycmVkWyB0dXBsZVsgMCBdIF0gPSBmdW5jdGlvbigpIHsKCQkJCQlkZWZlcnJlZFsgdHVwbGVbIDAgXSArICJXaXRoIiBdKCB0aGlzID09PSBkZWZlcnJlZCA/IHByb21pc2UgOiB0aGlzLCBhcmd1bWVudHMgKTsKCQkJCQlyZXR1cm4gdGhpczsKCQkJCX07CgkJCQlkZWZlcnJlZFsgdHVwbGVbIDAgXSArICJXaXRoIiBdID0gbGlzdC5maXJlV2l0aDsKCQkJfSApOwoKCQkJLy8gTWFrZSB0aGUgZGVmZXJyZWQgYSBwcm9taXNlCgkJCXByb21pc2UucHJvbWlzZSggZGVmZXJyZWQgKTsKCgkJCS8vIENhbGwgZ2l2ZW4gZnVuYyBpZiBhbnkKCQkJaWYgKCBmdW5jICkgewoJCQkJZnVuYy5jYWxsKCBkZWZlcnJlZCwgZGVmZXJyZWQgKTsKCQkJfQoKCQkJLy8gQWxsIGRvbmUhCgkJCXJldHVybiBkZWZlcnJlZDsKCQl9LAoKCQkvLyBEZWZlcnJlZCBoZWxwZXIKCQl3aGVuOiBmdW5jdGlvbiggc3Vib3JkaW5hdGUgLyogLCAuLi4sIHN1Ym9yZGluYXRlTiAqLyApIHsKCQkJdmFyIGkgPSAwLAoJCQkJcmVzb2x2ZVZhbHVlcyA9IHNsaWNlLmNhbGwoIGFyZ3VtZW50cyApLAoJCQkJbGVuZ3RoID0gcmVzb2x2ZVZhbHVlcy5sZW5ndGgsCgoJCQkJLy8gdGhlIGNvdW50IG9mIHVuY29tcGxldGVkIHN1Ym9yZGluYXRlcwoJCQkJcmVtYWluaW5nID0gbGVuZ3RoICE9PSAxIHx8CgkJCQkJKCBzdWJvcmRpbmF0ZSAmJiBqUXVlcnkuaXNGdW5jdGlvbiggc3Vib3JkaW5hdGUucHJvbWlzZSApICkgPyBsZW5ndGggOiAwLAoKCQkJCS8vIHRoZSBtYXN0ZXIgRGVmZXJyZWQuCgkJCQkvLyBJZiByZXNvbHZlVmFsdWVzIGNvbnNpc3Qgb2Ygb25seSBhIHNpbmdsZSBEZWZlcnJlZCwganVzdCB1c2UgdGhhdC4KCQkJCWRlZmVycmVkID0gcmVtYWluaW5nID09PSAxID8gc3Vib3JkaW5hdGUgOiBqUXVlcnkuRGVmZXJyZWQoKSwKCgkJCQkvLyBVcGRhdGUgZnVuY3Rpb24gZm9yIGJvdGggcmVzb2x2ZSBhbmQgcHJvZ3Jlc3MgdmFsdWVzCgkJCQl1cGRhdGVGdW5jID0gZnVuY3Rpb24oIGksIGNvbnRleHRzLCB2YWx1ZXMgKSB7CgkJCQkJcmV0dXJuIGZ1bmN0aW9uKCB2YWx1ZSApIHsKCQkJCQkJY29udGV4dHNbIGkgXSA9IHRoaXM7CgkJCQkJCXZhbHVlc1sgaSBdID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBzbGljZS5jYWxsKCBhcmd1bWVudHMgKSA6IHZhbHVlOwoJCQkJCQlpZiAoIHZhbHVlcyA9PT0gcHJvZ3Jlc3NWYWx1ZXMgKSB7CgkJCQkJCQlkZWZlcnJlZC5ub3RpZnlXaXRoKCBjb250ZXh0cywgdmFsdWVzICk7CgoJCQkJCQl9IGVsc2UgaWYgKCAhKCAtLXJlbWFpbmluZyApICkgewoJCQkJCQkJZGVmZXJyZWQucmVzb2x2ZVdpdGgoIGNvbnRleHRzLCB2YWx1ZXMgKTsKCQkJCQkJfQoJCQkJCX07CgkJCQl9LAoKCQkJCXByb2dyZXNzVmFsdWVzLCBwcm9ncmVzc0NvbnRleHRzLCByZXNvbHZlQ29udGV4dHM7CgoJCQkvLyBhZGQgbGlzdGVuZXJzIHRvIERlZmVycmVkIHN1Ym9yZGluYXRlczsgdHJlYXQgb3RoZXJzIGFzIHJlc29sdmVkCgkJCWlmICggbGVuZ3RoID4gMSApIHsKCQkJCXByb2dyZXNzVmFsdWVzID0gbmV3IEFycmF5KCBsZW5ndGggKTsKCQkJCXByb2dyZXNzQ29udGV4dHMgPSBuZXcgQXJyYXkoIGxlbmd0aCApOwoJCQkJcmVzb2x2ZUNvbnRleHRzID0gbmV3IEFycmF5KCBsZW5ndGggKTsKCQkJCWZvciAoIDsgaSA8IGxlbmd0aDsgaSsrICkgewoJCQkJCWlmICggcmVzb2x2ZVZhbHVlc1sgaSBdICYmIGpRdWVyeS5pc0Z1bmN0aW9uKCByZXNvbHZlVmFsdWVzWyBpIF0ucHJvbWlzZSApICkgewoJCQkJCQlyZXNvbHZlVmFsdWVzWyBpIF0ucHJvbWlzZSgpCgkJCQkJCQkucHJvZ3Jlc3MoIHVwZGF0ZUZ1bmMoIGksIHByb2dyZXNzQ29udGV4dHMsIHByb2dyZXNzVmFsdWVzICkgKQoJCQkJCQkJLmRvbmUoIHVwZGF0ZUZ1bmMoIGksIHJlc29sdmVDb250ZXh0cywgcmVzb2x2ZVZhbHVlcyApICkKCQkJCQkJCS5mYWlsKCBkZWZlcnJlZC5yZWplY3QgKTsKCQkJCQl9IGVsc2UgewoJCQkJCQktLXJlbWFpbmluZzsKCQkJCQl9CgkJCQl9CgkJCX0KCgkJCS8vIGlmIHdlJ3JlIG5vdCB3YWl0aW5nIG9uIGFueXRoaW5nLCByZXNvbHZlIHRoZSBtYXN0ZXIKCQkJaWYgKCAhcmVtYWluaW5nICkgewoJCQkJZGVmZXJyZWQucmVzb2x2ZVdpdGgoIHJlc29sdmVDb250ZXh0cywgcmVzb2x2ZVZhbHVlcyApOwoJCQl9CgoJCQlyZXR1cm4gZGVmZXJyZWQucHJvbWlzZSgpOwoJCX0KCX0gKTsKCgoJLy8gVGhlIGRlZmVycmVkIHVzZWQgb24gRE9NIHJlYWR5Cgl2YXIgcmVhZHlMaXN0OwoKCWpRdWVyeS5mbi5yZWFkeSA9IGZ1bmN0aW9uKCBmbiApIHsKCgkJLy8gQWRkIHRoZSBjYWxsYmFjawoJCWpRdWVyeS5yZWFkeS5wcm9taXNlKCkuZG9uZSggZm4gKTsKCgkJcmV0dXJuIHRoaXM7Cgl9OwoKCWpRdWVyeS5leHRlbmQoIHsKCgkJLy8gSXMgdGhlIERPTSByZWFkeSB0byBiZSB1c2VkPyBTZXQgdG8gdHJ1ZSBvbmNlIGl0IG9jY3Vycy4KCQlpc1JlYWR5OiBmYWxzZSwKCgkJLy8gQSBjb3VudGVyIHRvIHRyYWNrIGhvdyBtYW55IGl0ZW1zIHRvIHdhaXQgZm9yIGJlZm9yZQoJCS8vIHRoZSByZWFkeSBldmVudCBmaXJlcy4gU2VlICM2NzgxCgkJcmVhZHlXYWl0OiAxLAoKCQkvLyBIb2xkIChvciByZWxlYXNlKSB0aGUgcmVhZHkgZXZlbnQKCQlob2xkUmVhZHk6IGZ1bmN0aW9uKCBob2xkICkgewoJCQlpZiAoIGhvbGQgKSB7CgkJCQlqUXVlcnkucmVhZHlXYWl0Kys7CgkJCX0gZWxzZSB7CgkJCQlqUXVlcnkucmVhZHkoIHRydWUgKTsKCQkJfQoJCX0sCgoJCS8vIEhhbmRsZSB3aGVuIHRoZSBET00gaXMgcmVhZHkKCQlyZWFkeTogZnVuY3Rpb24oIHdhaXQgKSB7CgoJCQkvLyBBYm9ydCBpZiB0aGVyZSBhcmUgcGVuZGluZyBob2xkcyBvciB3ZSdyZSBhbHJlYWR5IHJlYWR5CgkJCWlmICggd2FpdCA9PT0gdHJ1ZSA/IC0talF1ZXJ5LnJlYWR5V2FpdCA6IGpRdWVyeS5pc1JlYWR5ICkgewoJCQkJcmV0dXJuOwoJCQl9CgoJCQkvLyBSZW1lbWJlciB0aGF0IHRoZSBET00gaXMgcmVhZHkKCQkJalF1ZXJ5LmlzUmVhZHkgPSB0cnVlOwoKCQkJLy8gSWYgYSBub3JtYWwgRE9NIFJlYWR5IGV2ZW50IGZpcmVkLCBkZWNyZW1lbnQsIGFuZCB3YWl0IGlmIG5lZWQgYmUKCQkJaWYgKCB3YWl0ICE9PSB0cnVlICYmIC0talF1ZXJ5LnJlYWR5V2FpdCA+IDAgKSB7CgkJCQlyZXR1cm47CgkJCX0KCgkJCS8vIElmIHRoZXJlIGFyZSBmdW5jdGlvbnMgYm91bmQsIHRvIGV4ZWN1dGUKCQkJcmVhZHlMaXN0LnJlc29sdmVXaXRoKCBkb2N1bWVudCwgWyBqUXVlcnkgXSApOwoKCQkJLy8gVHJpZ2dlciBhbnkgYm91bmQgcmVhZHkgZXZlbnRzCgkJCWlmICggalF1ZXJ5LmZuLnRyaWdnZXJIYW5kbGVyICkgewoJCQkJalF1ZXJ5KCBkb2N1bWVudCApLnRyaWdnZXJIYW5kbGVyKCAicmVhZHkiICk7CgkJCQlqUXVlcnkoIGRvY3VtZW50ICkub2ZmKCAicmVhZHkiICk7CgkJCX0KCQl9Cgl9ICk7CgoJLyoqCgkgKiBDbGVhbi11cCBtZXRob2QgZm9yIGRvbSByZWFkeSBldmVudHMKCSAqLwoJZnVuY3Rpb24gZGV0YWNoKCkgewoJCWlmICggZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciApIHsKCQkJZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lciggIkRPTUNvbnRlbnRMb2FkZWQiLCBjb21wbGV0ZWQgKTsKCQkJd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoICJsb2FkIiwgY29tcGxldGVkICk7CgoJCX0gZWxzZSB7CgkJCWRvY3VtZW50LmRldGFjaEV2ZW50KCAib25yZWFkeXN0YXRlY2hhbmdlIiwgY29tcGxldGVkICk7CgkJCXdpbmRvdy5kZXRhY2hFdmVudCggIm9ubG9hZCIsIGNvbXBsZXRlZCApOwoJCX0KCX0KCgkvKioKCSAqIFRoZSByZWFkeSBldmVudCBoYW5kbGVyIGFuZCBzZWxmIGNsZWFudXAgbWV0aG9kCgkgKi8KCWZ1bmN0aW9uIGNvbXBsZXRlZCgpIHsKCgkJLy8gcmVhZHlTdGF0ZSA9PT0gImNvbXBsZXRlIiBpcyBnb29kIGVub3VnaCBmb3IgdXMgdG8gY2FsbCB0aGUgZG9tIHJlYWR5IGluIG9sZElFCgkJaWYgKCBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyIHx8CgkJCXdpbmRvdy5ldmVudC50eXBlID09PSAibG9hZCIgfHwKCQkJZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gImNvbXBsZXRlIiApIHsKCgkJCWRldGFjaCgpOwoJCQlqUXVlcnkucmVhZHkoKTsKCQl9Cgl9CgoJalF1ZXJ5LnJlYWR5LnByb21pc2UgPSBmdW5jdGlvbiggb2JqICkgewoJCWlmICggIXJlYWR5TGlzdCApIHsKCgkJCXJlYWR5TGlzdCA9IGpRdWVyeS5EZWZlcnJlZCgpOwoKCQkJLy8gQ2F0Y2ggY2FzZXMgd2hlcmUgJChkb2N1bWVudCkucmVhZHkoKSBpcyBjYWxsZWQKCQkJLy8gYWZ0ZXIgdGhlIGJyb3dzZXIgZXZlbnQgaGFzIGFscmVhZHkgb2NjdXJyZWQuCgkJCS8vIFN1cHBvcnQ6IElFNi0xMAoJCQkvLyBPbGRlciBJRSBzb21ldGltZXMgc2lnbmFscyAiaW50ZXJhY3RpdmUiIHRvbyBzb29uCgkJCWlmICggZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gImNvbXBsZXRlIiB8fAoJCQkJKCBkb2N1bWVudC5yZWFkeVN0YXRlICE9PSAibG9hZGluZyIgJiYgIWRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5kb1Njcm9sbCApICkgewoKCQkJCS8vIEhhbmRsZSBpdCBhc3luY2hyb25vdXNseSB0byBhbGxvdyBzY3JpcHRzIHRoZSBvcHBvcnR1bml0eSB0byBkZWxheSByZWFkeQoJCQkJd2luZG93LnNldFRpbWVvdXQoIGpRdWVyeS5yZWFkeSApOwoKCQkJLy8gU3RhbmRhcmRzLWJhc2VkIGJyb3dzZXJzIHN1cHBvcnQgRE9NQ29udGVudExvYWRlZAoJCQl9IGVsc2UgaWYgKCBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyICkgewoKCQkJCS8vIFVzZSB0aGUgaGFuZHkgZXZlbnQgY2FsbGJhY2sKCQkJCWRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoICJET01Db250ZW50TG9hZGVkIiwgY29tcGxldGVkICk7CgoJCQkJLy8gQSBmYWxsYmFjayB0byB3aW5kb3cub25sb2FkLCB0aGF0IHdpbGwgYWx3YXlzIHdvcmsKCQkJCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCAibG9hZCIsIGNvbXBsZXRlZCApOwoKCQkJLy8gSWYgSUUgZXZlbnQgbW9kZWwgaXMgdXNlZAoJCQl9IGVsc2UgewoKCQkJCS8vIEVuc3VyZSBmaXJpbmcgYmVmb3JlIG9ubG9hZCwgbWF5YmUgbGF0ZSBidXQgc2FmZSBhbHNvIGZvciBpZnJhbWVzCgkJCQlkb2N1bWVudC5hdHRhY2hFdmVudCggIm9ucmVhZHlzdGF0ZWNoYW5nZSIsIGNvbXBsZXRlZCApOwoKCQkJCS8vIEEgZmFsbGJhY2sgdG8gd2luZG93Lm9ubG9hZCwgdGhhdCB3aWxsIGFsd2F5cyB3b3JrCgkJCQl3aW5kb3cuYXR0YWNoRXZlbnQoICJvbmxvYWQiLCBjb21wbGV0ZWQgKTsKCgkJCQkvLyBJZiBJRSBhbmQgbm90IGEgZnJhbWUKCQkJCS8vIGNvbnRpbnVhbGx5IGNoZWNrIHRvIHNlZSBpZiB0aGUgZG9jdW1lbnQgaXMgcmVhZHkKCQkJCXZhciB0b3AgPSBmYWxzZTsKCgkJCQl0cnkgewoJCQkJCXRvcCA9IHdpbmRvdy5mcmFtZUVsZW1lbnQgPT0gbnVsbCAmJiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7CgkJCQl9IGNhdGNoICggZSApIHt9CgoJCQkJaWYgKCB0b3AgJiYgdG9wLmRvU2Nyb2xsICkgewoJCQkJCSggZnVuY3Rpb24gZG9TY3JvbGxDaGVjaygpIHsKCQkJCQkJaWYgKCAhalF1ZXJ5LmlzUmVhZHkgKSB7CgoJCQkJCQkJdHJ5IHsKCgkJCQkJCQkJLy8gVXNlIHRoZSB0cmljayBieSBEaWVnbyBQZXJpbmkKCQkJCQkJCQkvLyBodHRwOi8vamF2YXNjcmlwdC5ud2JveC5jb20vSUVDb250ZW50TG9hZGVkLwoJCQkJCQkJCXRvcC5kb1Njcm9sbCggImxlZnQiICk7CgkJCQkJCQl9IGNhdGNoICggZSApIHsKCQkJCQkJCQlyZXR1cm4gd2luZG93LnNldFRpbWVvdXQoIGRvU2Nyb2xsQ2hlY2ssIDUwICk7CgkJCQkJCQl9CgoJCQkJCQkJLy8gZGV0YWNoIGFsbCBkb20gcmVhZHkgZXZlbnRzCgkJCQkJCQlkZXRhY2goKTsKCgkJCQkJCQkvLyBhbmQgZXhlY3V0ZSBhbnkgd2FpdGluZyBmdW5jdGlvbnMKCQkJCQkJCWpRdWVyeS5yZWFkeSgpOwoJCQkJCQl9CgkJCQkJfSApKCk7CgkJCQl9CgkJCX0KCQl9CgkJcmV0dXJuIHJlYWR5TGlzdC5wcm9taXNlKCBvYmogKTsKCX07CgoJLy8gS2ljayBvZmYgdGhlIERPTSByZWFkeSBjaGVjayBldmVuIGlmIHRoZSB1c2VyIGRvZXMgbm90CglqUXVlcnkucmVhZHkucHJvbWlzZSgpOwoKCgoKCS8vIFN1cHBvcnQ6IElFPDkKCS8vIEl0ZXJhdGlvbiBvdmVyIG9iamVjdCdzIGluaGVyaXRlZCBwcm9wZXJ0aWVzIGJlZm9yZSBpdHMgb3duCgl2YXIgaTsKCWZvciAoIGkgaW4galF1ZXJ5KCBzdXBwb3J0ICkgKSB7CgkJYnJlYWs7Cgl9CglzdXBwb3J0Lm93bkZpcnN0ID0gaSA9PT0gIjAiOwoKCS8vIE5vdGU6IG1vc3Qgc3VwcG9ydCB0ZXN0cyBhcmUgZGVmaW5lZCBpbiB0aGVpciByZXNwZWN0aXZlIG1vZHVsZXMuCgkvLyBmYWxzZSB1bnRpbCB0aGUgdGVzdCBpcyBydW4KCXN1cHBvcnQuaW5saW5lQmxvY2tOZWVkc0xheW91dCA9IGZhbHNlOwoKCS8vIEV4ZWN1dGUgQVNBUCBpbiBjYXNlIHdlIG5lZWQgdG8gc2V0IGJvZHkuc3R5bGUuem9vbQoJalF1ZXJ5KCBmdW5jdGlvbigpIHsKCgkJLy8gTWluaWZpZWQ6IHZhciBhLGIsYyxkCgkJdmFyIHZhbCwgZGl2LCBib2R5LCBjb250YWluZXI7CgoJCWJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSggImJvZHkiIClbIDAgXTsKCQlpZiAoICFib2R5IHx8ICFib2R5LnN0eWxlICkgewoKCQkJLy8gUmV0dXJuIGZvciBmcmFtZXNldCBkb2NzIHRoYXQgZG9uJ3QgaGF2ZSBhIGJvZHkKCQkJcmV0dXJuOwoJCX0KCgkJLy8gU2V0dXAKCQlkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAiZGl2IiApOwoJCWNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJkaXYiICk7CgkJY29udGFpbmVyLnN0eWxlLmNzc1RleHQgPSAicG9zaXRpb246YWJzb2x1dGU7Ym9yZGVyOjA7d2lkdGg6MDtoZWlnaHQ6MDt0b3A6MDtsZWZ0Oi05OTk5cHgiOwoJCWJvZHkuYXBwZW5kQ2hpbGQoIGNvbnRhaW5lciApLmFwcGVuZENoaWxkKCBkaXYgKTsKCgkJaWYgKCB0eXBlb2YgZGl2LnN0eWxlLnpvb20gIT09ICJ1bmRlZmluZWQiICkgewoKCQkJLy8gU3VwcG9ydDogSUU8OAoJCQkvLyBDaGVjayBpZiBuYXRpdmVseSBibG9jay1sZXZlbCBlbGVtZW50cyBhY3QgbGlrZSBpbmxpbmUtYmxvY2sKCQkJLy8gZWxlbWVudHMgd2hlbiBzZXR0aW5nIHRoZWlyIGRpc3BsYXkgdG8gJ2lubGluZScgYW5kIGdpdmluZwoJCQkvLyB0aGVtIGxheW91dAoJCQlkaXYuc3R5bGUuY3NzVGV4dCA9ICJkaXNwbGF5OmlubGluZTttYXJnaW46MDtib3JkZXI6MDtwYWRkaW5nOjFweDt3aWR0aDoxcHg7em9vbToxIjsKCgkJCXN1cHBvcnQuaW5saW5lQmxvY2tOZWVkc0xheW91dCA9IHZhbCA9IGRpdi5vZmZzZXRXaWR0aCA9PT0gMzsKCQkJaWYgKCB2YWwgKSB7CgoJCQkJLy8gUHJldmVudCBJRSA2IGZyb20gYWZmZWN0aW5nIGxheW91dCBmb3IgcG9zaXRpb25lZCBlbGVtZW50cyAjMTEwNDgKCQkJCS8vIFByZXZlbnQgSUUgZnJvbSBzaHJpbmtpbmcgdGhlIGJvZHkgaW4gSUUgNyBtb2RlICMxMjg2OQoJCQkJLy8gU3VwcG9ydDogSUU8OAoJCQkJYm9keS5zdHlsZS56b29tID0gMTsKCQkJfQoJCX0KCgkJYm9keS5yZW1vdmVDaGlsZCggY29udGFpbmVyICk7Cgl9ICk7CgoKCSggZnVuY3Rpb24oKSB7CgkJdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJkaXYiICk7CgoJCS8vIFN1cHBvcnQ6IElFPDkKCQlzdXBwb3J0LmRlbGV0ZUV4cGFuZG8gPSB0cnVlOwoJCXRyeSB7CgkJCWRlbGV0ZSBkaXYudGVzdDsKCQl9IGNhdGNoICggZSApIHsKCQkJc3VwcG9ydC5kZWxldGVFeHBhbmRvID0gZmFsc2U7CgkJfQoKCQkvLyBOdWxsIGVsZW1lbnRzIHRvIGF2b2lkIGxlYWtzIGluIElFLgoJCWRpdiA9IG51bGw7Cgl9ICkoKTsKCXZhciBhY2NlcHREYXRhID0gZnVuY3Rpb24oIGVsZW0gKSB7CgkJdmFyIG5vRGF0YSA9IGpRdWVyeS5ub0RhdGFbICggZWxlbS5ub2RlTmFtZSArICIgIiApLnRvTG93ZXJDYXNlKCkgXSwKCQkJbm9kZVR5cGUgPSArZWxlbS5ub2RlVHlwZSB8fCAxOwoKCQkvLyBEbyBub3Qgc2V0IGRhdGEgb24gbm9uLWVsZW1lbnQgRE9NIG5vZGVzIGJlY2F1c2UgaXQgd2lsbCBub3QgYmUgY2xlYXJlZCAoIzgzMzUpLgoJCXJldHVybiBub2RlVHlwZSAhPT0gMSAmJiBub2RlVHlwZSAhPT0gOSA/CgkJCWZhbHNlIDoKCgkJCS8vIE5vZGVzIGFjY2VwdCBkYXRhIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkOyByZWplY3Rpb24gY2FuIGJlIGNvbmRpdGlvbmFsCgkJCSFub0RhdGEgfHwgbm9EYXRhICE9PSB0cnVlICYmIGVsZW0uZ2V0QXR0cmlidXRlKCAiY2xhc3NpZCIgKSA9PT0gbm9EYXRhOwoJfTsKCgoKCgl2YXIgcmJyYWNlID0gL14oPzpce1tcd1xXXSpcfXxcW1tcd1xXXSpcXSkkLywKCQlybXVsdGlEYXNoID0gLyhbQS1aXSkvZzsKCglmdW5jdGlvbiBkYXRhQXR0ciggZWxlbSwga2V5LCBkYXRhICkgewoKCQkvLyBJZiBub3RoaW5nIHdhcyBmb3VuZCBpbnRlcm5hbGx5LCB0cnkgdG8gZmV0Y2ggYW55CgkJLy8gZGF0YSBmcm9tIHRoZSBIVE1MNSBkYXRhLSogYXR0cmlidXRlCgkJaWYgKCBkYXRhID09PSB1bmRlZmluZWQgJiYgZWxlbS5ub2RlVHlwZSA9PT0gMSApIHsKCgkJCXZhciBuYW1lID0gImRhdGEtIiArIGtleS5yZXBsYWNlKCBybXVsdGlEYXNoLCAiLSQxIiApLnRvTG93ZXJDYXNlKCk7CgoJCQlkYXRhID0gZWxlbS5nZXRBdHRyaWJ1dGUoIG5hbWUgKTsKCgkJCWlmICggdHlwZW9mIGRhdGEgPT09ICJzdHJpbmciICkgewoJCQkJdHJ5IHsKCQkJCQlkYXRhID0gZGF0YSA9PT0gInRydWUiID8gdHJ1ZSA6CgkJCQkJCWRhdGEgPT09ICJmYWxzZSIgPyBmYWxzZSA6CgkJCQkJCWRhdGEgPT09ICJudWxsIiA/IG51bGwgOgoKCQkJCQkJLy8gT25seSBjb252ZXJ0IHRvIGEgbnVtYmVyIGlmIGl0IGRvZXNuJ3QgY2hhbmdlIHRoZSBzdHJpbmcKCQkJCQkJK2RhdGEgKyAiIiA9PT0gZGF0YSA/ICtkYXRhIDoKCQkJCQkJcmJyYWNlLnRlc3QoIGRhdGEgKSA/IGpRdWVyeS5wYXJzZUpTT04oIGRhdGEgKSA6CgkJCQkJCWRhdGE7CgkJCQl9IGNhdGNoICggZSApIHt9CgoJCQkJLy8gTWFrZSBzdXJlIHdlIHNldCB0aGUgZGF0YSBzbyBpdCBpc24ndCBjaGFuZ2VkIGxhdGVyCgkJCQlqUXVlcnkuZGF0YSggZWxlbSwga2V5LCBkYXRhICk7CgoJCQl9IGVsc2UgewoJCQkJZGF0YSA9IHVuZGVmaW5lZDsKCQkJfQoJCX0KCgkJcmV0dXJuIGRhdGE7Cgl9CgoJLy8gY2hlY2tzIGEgY2FjaGUgb2JqZWN0IGZvciBlbXB0aW5lc3MKCWZ1bmN0aW9uIGlzRW1wdHlEYXRhT2JqZWN0KCBvYmogKSB7CgkJdmFyIG5hbWU7CgkJZm9yICggbmFtZSBpbiBvYmogKSB7CgoJCQkvLyBpZiB0aGUgcHVibGljIGRhdGEgb2JqZWN0IGlzIGVtcHR5LCB0aGUgcHJpdmF0ZSBpcyBzdGlsbCBlbXB0eQoJCQlpZiAoIG5hbWUgPT09ICJkYXRhIiAmJiBqUXVlcnkuaXNFbXB0eU9iamVjdCggb2JqWyBuYW1lIF0gKSApIHsKCQkJCWNvbnRpbnVlOwoJCQl9CgkJCWlmICggbmFtZSAhPT0gInRvSlNPTiIgKSB7CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCQl9CgoJCXJldHVybiB0cnVlOwoJfQoKCWZ1bmN0aW9uIGludGVybmFsRGF0YSggZWxlbSwgbmFtZSwgZGF0YSwgcHZ0IC8qIEludGVybmFsIFVzZSBPbmx5ICovICkgewoJCWlmICggIWFjY2VwdERhdGEoIGVsZW0gKSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJdmFyIHJldCwgdGhpc0NhY2hlLAoJCQlpbnRlcm5hbEtleSA9IGpRdWVyeS5leHBhbmRvLAoKCQkJLy8gV2UgaGF2ZSB0byBoYW5kbGUgRE9NIG5vZGVzIGFuZCBKUyBvYmplY3RzIGRpZmZlcmVudGx5IGJlY2F1c2UgSUU2LTcKCQkJLy8gY2FuJ3QgR0Mgb2JqZWN0IHJlZmVyZW5jZXMgcHJvcGVybHkgYWNyb3NzIHRoZSBET00tSlMgYm91bmRhcnkKCQkJaXNOb2RlID0gZWxlbS5ub2RlVHlwZSwKCgkJCS8vIE9ubHkgRE9NIG5vZGVzIG5lZWQgdGhlIGdsb2JhbCBqUXVlcnkgY2FjaGU7IEpTIG9iamVjdCBkYXRhIGlzCgkJCS8vIGF0dGFjaGVkIGRpcmVjdGx5IHRvIHRoZSBvYmplY3Qgc28gR0MgY2FuIG9jY3VyIGF1dG9tYXRpY2FsbHkKCQkJY2FjaGUgPSBpc05vZGUgPyBqUXVlcnkuY2FjaGUgOiBlbGVtLAoKCQkJLy8gT25seSBkZWZpbmluZyBhbiBJRCBmb3IgSlMgb2JqZWN0cyBpZiBpdHMgY2FjaGUgYWxyZWFkeSBleGlzdHMgYWxsb3dzCgkJCS8vIHRoZSBjb2RlIHRvIHNob3J0Y3V0IG9uIHRoZSBzYW1lIHBhdGggYXMgYSBET00gbm9kZSB3aXRoIG5vIGNhY2hlCgkJCWlkID0gaXNOb2RlID8gZWxlbVsgaW50ZXJuYWxLZXkgXSA6IGVsZW1bIGludGVybmFsS2V5IF0gJiYgaW50ZXJuYWxLZXk7CgoJCS8vIEF2b2lkIGRvaW5nIGFueSBtb3JlIHdvcmsgdGhhbiB3ZSBuZWVkIHRvIHdoZW4gdHJ5aW5nIHRvIGdldCBkYXRhIG9uIGFuCgkJLy8gb2JqZWN0IHRoYXQgaGFzIG5vIGRhdGEgYXQgYWxsCgkJaWYgKCAoICFpZCB8fCAhY2FjaGVbIGlkIF0gfHwgKCAhcHZ0ICYmICFjYWNoZVsgaWQgXS5kYXRhICkgKSAmJgoJCQlkYXRhID09PSB1bmRlZmluZWQgJiYgdHlwZW9mIG5hbWUgPT09ICJzdHJpbmciICkgewoJCQlyZXR1cm47CgkJfQoKCQlpZiAoICFpZCApIHsKCgkJCS8vIE9ubHkgRE9NIG5vZGVzIG5lZWQgYSBuZXcgdW5pcXVlIElEIGZvciBlYWNoIGVsZW1lbnQgc2luY2UgdGhlaXIgZGF0YQoJCQkvLyBlbmRzIHVwIGluIHRoZSBnbG9iYWwgY2FjaGUKCQkJaWYgKCBpc05vZGUgKSB7CgkJCQlpZCA9IGVsZW1bIGludGVybmFsS2V5IF0gPSBkZWxldGVkSWRzLnBvcCgpIHx8IGpRdWVyeS5ndWlkKys7CgkJCX0gZWxzZSB7CgkJCQlpZCA9IGludGVybmFsS2V5OwoJCQl9CgkJfQoKCQlpZiAoICFjYWNoZVsgaWQgXSApIHsKCgkJCS8vIEF2b2lkIGV4cG9zaW5nIGpRdWVyeSBtZXRhZGF0YSBvbiBwbGFpbiBKUyBvYmplY3RzIHdoZW4gdGhlIG9iamVjdAoJCQkvLyBpcyBzZXJpYWxpemVkIHVzaW5nIEpTT04uc3RyaW5naWZ5CgkJCWNhY2hlWyBpZCBdID0gaXNOb2RlID8ge30gOiB7IHRvSlNPTjogalF1ZXJ5Lm5vb3AgfTsKCQl9CgoJCS8vIEFuIG9iamVjdCBjYW4gYmUgcGFzc2VkIHRvIGpRdWVyeS5kYXRhIGluc3RlYWQgb2YgYSBrZXkvdmFsdWUgcGFpcjsgdGhpcyBnZXRzCgkJLy8gc2hhbGxvdyBjb3BpZWQgb3ZlciBvbnRvIHRoZSBleGlzdGluZyBjYWNoZQoJCWlmICggdHlwZW9mIG5hbWUgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBuYW1lID09PSAiZnVuY3Rpb24iICkgewoJCQlpZiAoIHB2dCApIHsKCQkJCWNhY2hlWyBpZCBdID0galF1ZXJ5LmV4dGVuZCggY2FjaGVbIGlkIF0sIG5hbWUgKTsKCQkJfSBlbHNlIHsKCQkJCWNhY2hlWyBpZCBdLmRhdGEgPSBqUXVlcnkuZXh0ZW5kKCBjYWNoZVsgaWQgXS5kYXRhLCBuYW1lICk7CgkJCX0KCQl9CgoJCXRoaXNDYWNoZSA9IGNhY2hlWyBpZCBdOwoKCQkvLyBqUXVlcnkgZGF0YSgpIGlzIHN0b3JlZCBpbiBhIHNlcGFyYXRlIG9iamVjdCBpbnNpZGUgdGhlIG9iamVjdCdzIGludGVybmFsIGRhdGEKCQkvLyBjYWNoZSBpbiBvcmRlciB0byBhdm9pZCBrZXkgY29sbGlzaW9ucyBiZXR3ZWVuIGludGVybmFsIGRhdGEgYW5kIHVzZXItZGVmaW5lZAoJCS8vIGRhdGEuCgkJaWYgKCAhcHZ0ICkgewoJCQlpZiAoICF0aGlzQ2FjaGUuZGF0YSApIHsKCQkJCXRoaXNDYWNoZS5kYXRhID0ge307CgkJCX0KCgkJCXRoaXNDYWNoZSA9IHRoaXNDYWNoZS5kYXRhOwoJCX0KCgkJaWYgKCBkYXRhICE9PSB1bmRlZmluZWQgKSB7CgkJCXRoaXNDYWNoZVsgalF1ZXJ5LmNhbWVsQ2FzZSggbmFtZSApIF0gPSBkYXRhOwoJCX0KCgkJLy8gQ2hlY2sgZm9yIGJvdGggY29udmVydGVkLXRvLWNhbWVsIGFuZCBub24tY29udmVydGVkIGRhdGEgcHJvcGVydHkgbmFtZXMKCQkvLyBJZiBhIGRhdGEgcHJvcGVydHkgd2FzIHNwZWNpZmllZAoJCWlmICggdHlwZW9mIG5hbWUgPT09ICJzdHJpbmciICkgewoKCQkJLy8gRmlyc3QgVHJ5IHRvIGZpbmQgYXMtaXMgcHJvcGVydHkgZGF0YQoJCQlyZXQgPSB0aGlzQ2FjaGVbIG5hbWUgXTsKCgkJCS8vIFRlc3QgZm9yIG51bGx8dW5kZWZpbmVkIHByb3BlcnR5IGRhdGEKCQkJaWYgKCByZXQgPT0gbnVsbCApIHsKCgkJCQkvLyBUcnkgdG8gZmluZCB0aGUgY2FtZWxDYXNlZCBwcm9wZXJ0eQoJCQkJcmV0ID0gdGhpc0NhY2hlWyBqUXVlcnkuY2FtZWxDYXNlKCBuYW1lICkgXTsKCQkJfQoJCX0gZWxzZSB7CgkJCXJldCA9IHRoaXNDYWNoZTsKCQl9CgoJCXJldHVybiByZXQ7Cgl9CgoJZnVuY3Rpb24gaW50ZXJuYWxSZW1vdmVEYXRhKCBlbGVtLCBuYW1lLCBwdnQgKSB7CgkJaWYgKCAhYWNjZXB0RGF0YSggZWxlbSApICkgewoJCQlyZXR1cm47CgkJfQoKCQl2YXIgdGhpc0NhY2hlLCBpLAoJCQlpc05vZGUgPSBlbGVtLm5vZGVUeXBlLAoKCQkJLy8gU2VlIGpRdWVyeS5kYXRhIGZvciBtb3JlIGluZm9ybWF0aW9uCgkJCWNhY2hlID0gaXNOb2RlID8galF1ZXJ5LmNhY2hlIDogZWxlbSwKCQkJaWQgPSBpc05vZGUgPyBlbGVtWyBqUXVlcnkuZXhwYW5kbyBdIDogalF1ZXJ5LmV4cGFuZG87CgoJCS8vIElmIHRoZXJlIGlzIGFscmVhZHkgbm8gY2FjaGUgZW50cnkgZm9yIHRoaXMgb2JqZWN0LCB0aGVyZSBpcyBubwoJCS8vIHB1cnBvc2UgaW4gY29udGludWluZwoJCWlmICggIWNhY2hlWyBpZCBdICkgewoJCQlyZXR1cm47CgkJfQoKCQlpZiAoIG5hbWUgKSB7CgoJCQl0aGlzQ2FjaGUgPSBwdnQgPyBjYWNoZVsgaWQgXSA6IGNhY2hlWyBpZCBdLmRhdGE7CgoJCQlpZiAoIHRoaXNDYWNoZSApIHsKCgkJCQkvLyBTdXBwb3J0IGFycmF5IG9yIHNwYWNlIHNlcGFyYXRlZCBzdHJpbmcgbmFtZXMgZm9yIGRhdGEga2V5cwoJCQkJaWYgKCAhalF1ZXJ5LmlzQXJyYXkoIG5hbWUgKSApIHsKCgkJCQkJLy8gdHJ5IHRoZSBzdHJpbmcgYXMgYSBrZXkgYmVmb3JlIGFueSBtYW5pcHVsYXRpb24KCQkJCQlpZiAoIG5hbWUgaW4gdGhpc0NhY2hlICkgewoJCQkJCQluYW1lID0gWyBuYW1lIF07CgkJCQkJfSBlbHNlIHsKCgkJCQkJCS8vIHNwbGl0IHRoZSBjYW1lbCBjYXNlZCB2ZXJzaW9uIGJ5IHNwYWNlcyB1bmxlc3MgYSBrZXkgd2l0aCB0aGUgc3BhY2VzIGV4aXN0cwoJCQkJCQluYW1lID0galF1ZXJ5LmNhbWVsQ2FzZSggbmFtZSApOwoJCQkJCQlpZiAoIG5hbWUgaW4gdGhpc0NhY2hlICkgewoJCQkJCQkJbmFtZSA9IFsgbmFtZSBdOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJbmFtZSA9IG5hbWUuc3BsaXQoICIgIiApOwoJCQkJCQl9CgkJCQkJfQoJCQkJfSBlbHNlIHsKCgkJCQkJLy8gSWYgIm5hbWUiIGlzIGFuIGFycmF5IG9mIGtleXMuLi4KCQkJCQkvLyBXaGVuIGRhdGEgaXMgaW5pdGlhbGx5IGNyZWF0ZWQsIHZpYSAoImtleSIsICJ2YWwiKSBzaWduYXR1cmUsCgkJCQkJLy8ga2V5cyB3aWxsIGJlIGNvbnZlcnRlZCB0byBjYW1lbENhc2UuCgkJCQkJLy8gU2luY2UgdGhlcmUgaXMgbm8gd2F5IHRvIHRlbGwgX2hvd18gYSBrZXkgd2FzIGFkZGVkLCByZW1vdmUKCQkJCQkvLyBib3RoIHBsYWluIGtleSBhbmQgY2FtZWxDYXNlIGtleS4gIzEyNzg2CgkJCQkJLy8gVGhpcyB3aWxsIG9ubHkgcGVuYWxpemUgdGhlIGFycmF5IGFyZ3VtZW50IHBhdGguCgkJCQkJbmFtZSA9IG5hbWUuY29uY2F0KCBqUXVlcnkubWFwKCBuYW1lLCBqUXVlcnkuY2FtZWxDYXNlICkgKTsKCQkJCX0KCgkJCQlpID0gbmFtZS5sZW5ndGg7CgkJCQl3aGlsZSAoIGktLSApIHsKCQkJCQlkZWxldGUgdGhpc0NhY2hlWyBuYW1lWyBpIF0gXTsKCQkJCX0KCgkJCQkvLyBJZiB0aGVyZSBpcyBubyBkYXRhIGxlZnQgaW4gdGhlIGNhY2hlLCB3ZSB3YW50IHRvIGNvbnRpbnVlCgkJCQkvLyBhbmQgbGV0IHRoZSBjYWNoZSBvYmplY3QgaXRzZWxmIGdldCBkZXN0cm95ZWQKCQkJCWlmICggcHZ0ID8gIWlzRW1wdHlEYXRhT2JqZWN0KCB0aGlzQ2FjaGUgKSA6ICFqUXVlcnkuaXNFbXB0eU9iamVjdCggdGhpc0NhY2hlICkgKSB7CgkJCQkJcmV0dXJuOwoJCQkJfQoJCQl9CgkJfQoKCQkvLyBTZWUgalF1ZXJ5LmRhdGEgZm9yIG1vcmUgaW5mb3JtYXRpb24KCQlpZiAoICFwdnQgKSB7CgkJCWRlbGV0ZSBjYWNoZVsgaWQgXS5kYXRhOwoKCQkJLy8gRG9uJ3QgZGVzdHJveSB0aGUgcGFyZW50IGNhY2hlIHVubGVzcyB0aGUgaW50ZXJuYWwgZGF0YSBvYmplY3QKCQkJLy8gaGFkIGJlZW4gdGhlIG9ubHkgdGhpbmcgbGVmdCBpbiBpdAoJCQlpZiAoICFpc0VtcHR5RGF0YU9iamVjdCggY2FjaGVbIGlkIF0gKSApIHsKCQkJCXJldHVybjsKCQkJfQoJCX0KCgkJLy8gRGVzdHJveSB0aGUgY2FjaGUKCQlpZiAoIGlzTm9kZSApIHsKCQkJalF1ZXJ5LmNsZWFuRGF0YSggWyBlbGVtIF0sIHRydWUgKTsKCgkJLy8gVXNlIGRlbGV0ZSB3aGVuIHN1cHBvcnRlZCBmb3IgZXhwYW5kb3Mgb3IgYGNhY2hlYCBpcyBub3QgYSB3aW5kb3cgcGVyIGlzV2luZG93ICgjMTAwODApCgkJLyoganNoaW50IGVxZXFlcTogZmFsc2UgKi8KCQl9IGVsc2UgaWYgKCBzdXBwb3J0LmRlbGV0ZUV4cGFuZG8gfHwgY2FjaGUgIT0gY2FjaGUud2luZG93ICkgewoJCQkvKiBqc2hpbnQgZXFlcWVxOiB0cnVlICovCgkJCWRlbGV0ZSBjYWNoZVsgaWQgXTsKCgkJLy8gV2hlbiBhbGwgZWxzZSBmYWlscywgdW5kZWZpbmVkCgkJfSBlbHNlIHsKCQkJY2FjaGVbIGlkIF0gPSB1bmRlZmluZWQ7CgkJfQoJfQoKCWpRdWVyeS5leHRlbmQoIHsKCQljYWNoZToge30sCgoJCS8vIFRoZSBmb2xsb3dpbmcgZWxlbWVudHMgKHNwYWNlLXN1ZmZpeGVkIHRvIGF2b2lkIE9iamVjdC5wcm90b3R5cGUgY29sbGlzaW9ucykKCQkvLyB0aHJvdyB1bmNhdGNoYWJsZSBleGNlcHRpb25zIGlmIHlvdSBhdHRlbXB0IHRvIHNldCBleHBhbmRvIHByb3BlcnRpZXMKCQlub0RhdGE6IHsKCQkJImFwcGxldCAiOiB0cnVlLAoJCQkiZW1iZWQgIjogdHJ1ZSwKCgkJCS8vIC4uLmJ1dCBGbGFzaCBvYmplY3RzICh3aGljaCBoYXZlIHRoaXMgY2xhc3NpZCkgKmNhbiogaGFuZGxlIGV4cGFuZG9zCgkJCSJvYmplY3QgIjogImNsc2lkOkQyN0NEQjZFLUFFNkQtMTFjZi05NkI4LTQ0NDU1MzU0MDAwMCIKCQl9LAoKCQloYXNEYXRhOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJZWxlbSA9IGVsZW0ubm9kZVR5cGUgPyBqUXVlcnkuY2FjaGVbIGVsZW1bIGpRdWVyeS5leHBhbmRvIF0gXSA6IGVsZW1bIGpRdWVyeS5leHBhbmRvIF07CgkJCXJldHVybiAhIWVsZW0gJiYgIWlzRW1wdHlEYXRhT2JqZWN0KCBlbGVtICk7CgkJfSwKCgkJZGF0YTogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIGRhdGEgKSB7CgkJCXJldHVybiBpbnRlcm5hbERhdGEoIGVsZW0sIG5hbWUsIGRhdGEgKTsKCQl9LAoKCQlyZW1vdmVEYXRhOiBmdW5jdGlvbiggZWxlbSwgbmFtZSApIHsKCQkJcmV0dXJuIGludGVybmFsUmVtb3ZlRGF0YSggZWxlbSwgbmFtZSApOwoJCX0sCgoJCS8vIEZvciBpbnRlcm5hbCB1c2Ugb25seS4KCQlfZGF0YTogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIGRhdGEgKSB7CgkJCXJldHVybiBpbnRlcm5hbERhdGEoIGVsZW0sIG5hbWUsIGRhdGEsIHRydWUgKTsKCQl9LAoKCQlfcmVtb3ZlRGF0YTogZnVuY3Rpb24oIGVsZW0sIG5hbWUgKSB7CgkJCXJldHVybiBpbnRlcm5hbFJlbW92ZURhdGEoIGVsZW0sIG5hbWUsIHRydWUgKTsKCQl9Cgl9ICk7CgoJalF1ZXJ5LmZuLmV4dGVuZCggewoJCWRhdGE6IGZ1bmN0aW9uKCBrZXksIHZhbHVlICkgewoJCQl2YXIgaSwgbmFtZSwgZGF0YSwKCQkJCWVsZW0gPSB0aGlzWyAwIF0sCgkJCQlhdHRycyA9IGVsZW0gJiYgZWxlbS5hdHRyaWJ1dGVzOwoKCQkJLy8gU3BlY2lhbCBleHBlY3Rpb25zIG9mIC5kYXRhIGJhc2ljYWxseSB0aHdhcnQgalF1ZXJ5LmFjY2VzcywKCQkJLy8gc28gaW1wbGVtZW50IHRoZSByZWxldmFudCBiZWhhdmlvciBvdXJzZWx2ZXMKCgkJCS8vIEdldHMgYWxsIHZhbHVlcwoJCQlpZiAoIGtleSA9PT0gdW5kZWZpbmVkICkgewoJCQkJaWYgKCB0aGlzLmxlbmd0aCApIHsKCQkJCQlkYXRhID0galF1ZXJ5LmRhdGEoIGVsZW0gKTsKCgkJCQkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxICYmICFqUXVlcnkuX2RhdGEoIGVsZW0sICJwYXJzZWRBdHRycyIgKSApIHsKCQkJCQkJaSA9IGF0dHJzLmxlbmd0aDsKCQkJCQkJd2hpbGUgKCBpLS0gKSB7CgoJCQkJCQkJLy8gU3VwcG9ydDogSUUxMSsKCQkJCQkJCS8vIFRoZSBhdHRycyBlbGVtZW50cyBjYW4gYmUgbnVsbCAoIzE0ODk0KQoJCQkJCQkJaWYgKCBhdHRyc1sgaSBdICkgewoJCQkJCQkJCW5hbWUgPSBhdHRyc1sgaSBdLm5hbWU7CgkJCQkJCQkJaWYgKCBuYW1lLmluZGV4T2YoICJkYXRhLSIgKSA9PT0gMCApIHsKCQkJCQkJCQkJbmFtZSA9IGpRdWVyeS5jYW1lbENhc2UoIG5hbWUuc2xpY2UoIDUgKSApOwoJCQkJCQkJCQlkYXRhQXR0ciggZWxlbSwgbmFtZSwgZGF0YVsgbmFtZSBdICk7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCWpRdWVyeS5fZGF0YSggZWxlbSwgInBhcnNlZEF0dHJzIiwgdHJ1ZSApOwoJCQkJCX0KCQkJCX0KCgkJCQlyZXR1cm4gZGF0YTsKCQkJfQoKCQkJLy8gU2V0cyBtdWx0aXBsZSB2YWx1ZXMKCQkJaWYgKCB0eXBlb2Yga2V5ID09PSAib2JqZWN0IiApIHsKCQkJCXJldHVybiB0aGlzLmVhY2goIGZ1bmN0aW9uKCkgewoJCQkJCWpRdWVyeS5kYXRhKCB0aGlzLCBrZXkgKTsKCQkJCX0gKTsKCQkJfQoKCQkJcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPiAxID8KCgkJCQkvLyBTZXRzIG9uZSB2YWx1ZQoJCQkJdGhpcy5lYWNoKCBmdW5jdGlvbigpIHsKCQkJCQlqUXVlcnkuZGF0YSggdGhpcywga2V5LCB2YWx1ZSApOwoJCQkJfSApIDoKCgkJCQkvLyBHZXRzIG9uZSB2YWx1ZQoJCQkJLy8gVHJ5IHRvIGZldGNoIGFueSBpbnRlcm5hbGx5IHN0b3JlZCBkYXRhIGZpcnN0CgkJCQllbGVtID8gZGF0YUF0dHIoIGVsZW0sIGtleSwgalF1ZXJ5LmRhdGEoIGVsZW0sIGtleSApICkgOiB1bmRlZmluZWQ7CgkJfSwKCgkJcmVtb3ZlRGF0YTogZnVuY3Rpb24oIGtleSApIHsKCQkJcmV0dXJuIHRoaXMuZWFjaCggZnVuY3Rpb24oKSB7CgkJCQlqUXVlcnkucmVtb3ZlRGF0YSggdGhpcywga2V5ICk7CgkJCX0gKTsKCQl9Cgl9ICk7CgoKCWpRdWVyeS5leHRlbmQoIHsKCQlxdWV1ZTogZnVuY3Rpb24oIGVsZW0sIHR5cGUsIGRhdGEgKSB7CgkJCXZhciBxdWV1ZTsKCgkJCWlmICggZWxlbSApIHsKCQkJCXR5cGUgPSAoIHR5cGUgfHwgImZ4IiApICsgInF1ZXVlIjsKCQkJCXF1ZXVlID0galF1ZXJ5Ll9kYXRhKCBlbGVtLCB0eXBlICk7CgoJCQkJLy8gU3BlZWQgdXAgZGVxdWV1ZSBieSBnZXR0aW5nIG91dCBxdWlja2x5IGlmIHRoaXMgaXMganVzdCBhIGxvb2t1cAoJCQkJaWYgKCBkYXRhICkgewoJCQkJCWlmICggIXF1ZXVlIHx8IGpRdWVyeS5pc0FycmF5KCBkYXRhICkgKSB7CgkJCQkJCXF1ZXVlID0galF1ZXJ5Ll9kYXRhKCBlbGVtLCB0eXBlLCBqUXVlcnkubWFrZUFycmF5KCBkYXRhICkgKTsKCQkJCQl9IGVsc2UgewoJCQkJCQlxdWV1ZS5wdXNoKCBkYXRhICk7CgkJCQkJfQoJCQkJfQoJCQkJcmV0dXJuIHF1ZXVlIHx8IFtdOwoJCQl9CgkJfSwKCgkJZGVxdWV1ZTogZnVuY3Rpb24oIGVsZW0sIHR5cGUgKSB7CgkJCXR5cGUgPSB0eXBlIHx8ICJmeCI7CgoJCQl2YXIgcXVldWUgPSBqUXVlcnkucXVldWUoIGVsZW0sIHR5cGUgKSwKCQkJCXN0YXJ0TGVuZ3RoID0gcXVldWUubGVuZ3RoLAoJCQkJZm4gPSBxdWV1ZS5zaGlmdCgpLAoJCQkJaG9va3MgPSBqUXVlcnkuX3F1ZXVlSG9va3MoIGVsZW0sIHR5cGUgKSwKCQkJCW5leHQgPSBmdW5jdGlvbigpIHsKCQkJCQlqUXVlcnkuZGVxdWV1ZSggZWxlbSwgdHlwZSApOwoJCQkJfTsKCgkJCS8vIElmIHRoZSBmeCBxdWV1ZSBpcyBkZXF1ZXVlZCwgYWx3YXlzIHJlbW92ZSB0aGUgcHJvZ3Jlc3Mgc2VudGluZWwKCQkJaWYgKCBmbiA9PT0gImlucHJvZ3Jlc3MiICkgewoJCQkJZm4gPSBxdWV1ZS5zaGlmdCgpOwoJCQkJc3RhcnRMZW5ndGgtLTsKCQkJfQoKCQkJaWYgKCBmbiApIHsKCgkJCQkvLyBBZGQgYSBwcm9ncmVzcyBzZW50aW5lbCB0byBwcmV2ZW50IHRoZSBmeCBxdWV1ZSBmcm9tIGJlaW5nCgkJCQkvLyBhdXRvbWF0aWNhbGx5IGRlcXVldWVkCgkJCQlpZiAoIHR5cGUgPT09ICJmeCIgKSB7CgkJCQkJcXVldWUudW5zaGlmdCggImlucHJvZ3Jlc3MiICk7CgkJCQl9CgoJCQkJLy8gY2xlYXIgdXAgdGhlIGxhc3QgcXVldWUgc3RvcCBmdW5jdGlvbgoJCQkJZGVsZXRlIGhvb2tzLnN0b3A7CgkJCQlmbi5jYWxsKCBlbGVtLCBuZXh0LCBob29rcyApOwoJCQl9CgoJCQlpZiAoICFzdGFydExlbmd0aCAmJiBob29rcyApIHsKCQkJCWhvb2tzLmVtcHR5LmZpcmUoKTsKCQkJfQoJCX0sCgoJCS8vIG5vdCBpbnRlbmRlZCBmb3IgcHVibGljIGNvbnN1bXB0aW9uIC0gZ2VuZXJhdGVzIGEgcXVldWVIb29rcyBvYmplY3QsCgkJLy8gb3IgcmV0dXJucyB0aGUgY3VycmVudCBvbmUKCQlfcXVldWVIb29rczogZnVuY3Rpb24oIGVsZW0sIHR5cGUgKSB7CgkJCXZhciBrZXkgPSB0eXBlICsgInF1ZXVlSG9va3MiOwoJCQlyZXR1cm4galF1ZXJ5Ll9kYXRhKCBlbGVtLCBrZXkgKSB8fCBqUXVlcnkuX2RhdGEoIGVsZW0sIGtleSwgewoJCQkJZW1wdHk6IGpRdWVyeS5DYWxsYmFja3MoICJvbmNlIG1lbW9yeSIgKS5hZGQoIGZ1bmN0aW9uKCkgewoJCQkJCWpRdWVyeS5fcmVtb3ZlRGF0YSggZWxlbSwgdHlwZSArICJxdWV1ZSIgKTsKCQkJCQlqUXVlcnkuX3JlbW92ZURhdGEoIGVsZW0sIGtleSApOwoJCQkJfSApCgkJCX0gKTsKCQl9Cgl9ICk7CgoJalF1ZXJ5LmZuLmV4dGVuZCggewoJCXF1ZXVlOiBmdW5jdGlvbiggdHlwZSwgZGF0YSApIHsKCQkJdmFyIHNldHRlciA9IDI7CgoJCQlpZiAoIHR5cGVvZiB0eXBlICE9PSAic3RyaW5nIiApIHsKCQkJCWRhdGEgPSB0eXBlOwoJCQkJdHlwZSA9ICJmeCI7CgkJCQlzZXR0ZXItLTsKCQkJfQoKCQkJaWYgKCBhcmd1bWVudHMubGVuZ3RoIDwgc2V0dGVyICkgewoJCQkJcmV0dXJuIGpRdWVyeS5xdWV1ZSggdGhpc1sgMCBdLCB0eXBlICk7CgkJCX0KCgkJCXJldHVybiBkYXRhID09PSB1bmRlZmluZWQgPwoJCQkJdGhpcyA6CgkJCQl0aGlzLmVhY2goIGZ1bmN0aW9uKCkgewoJCQkJCXZhciBxdWV1ZSA9IGpRdWVyeS5xdWV1ZSggdGhpcywgdHlwZSwgZGF0YSApOwoKCQkJCQkvLyBlbnN1cmUgYSBob29rcyBmb3IgdGhpcyBxdWV1ZQoJCQkJCWpRdWVyeS5fcXVldWVIb29rcyggdGhpcywgdHlwZSApOwoKCQkJCQlpZiAoIHR5cGUgPT09ICJmeCIgJiYgcXVldWVbIDAgXSAhPT0gImlucHJvZ3Jlc3MiICkgewoJCQkJCQlqUXVlcnkuZGVxdWV1ZSggdGhpcywgdHlwZSApOwoJCQkJCX0KCQkJCX0gKTsKCQl9LAoJCWRlcXVldWU6IGZ1bmN0aW9uKCB0eXBlICkgewoJCQlyZXR1cm4gdGhpcy5lYWNoKCBmdW5jdGlvbigpIHsKCQkJCWpRdWVyeS5kZXF1ZXVlKCB0aGlzLCB0eXBlICk7CgkJCX0gKTsKCQl9LAoJCWNsZWFyUXVldWU6IGZ1bmN0aW9uKCB0eXBlICkgewoJCQlyZXR1cm4gdGhpcy5xdWV1ZSggdHlwZSB8fCAiZngiLCBbXSApOwoJCX0sCgoJCS8vIEdldCBhIHByb21pc2UgcmVzb2x2ZWQgd2hlbiBxdWV1ZXMgb2YgYSBjZXJ0YWluIHR5cGUKCQkvLyBhcmUgZW1wdGllZCAoZnggaXMgdGhlIHR5cGUgYnkgZGVmYXVsdCkKCQlwcm9taXNlOiBmdW5jdGlvbiggdHlwZSwgb2JqICkgewoJCQl2YXIgdG1wLAoJCQkJY291bnQgPSAxLAoJCQkJZGVmZXIgPSBqUXVlcnkuRGVmZXJyZWQoKSwKCQkJCWVsZW1lbnRzID0gdGhpcywKCQkJCWkgPSB0aGlzLmxlbmd0aCwKCQkJCXJlc29sdmUgPSBmdW5jdGlvbigpIHsKCQkJCQlpZiAoICEoIC0tY291bnQgKSApIHsKCQkJCQkJZGVmZXIucmVzb2x2ZVdpdGgoIGVsZW1lbnRzLCBbIGVsZW1lbnRzIF0gKTsKCQkJCQl9CgkJCQl9OwoKCQkJaWYgKCB0eXBlb2YgdHlwZSAhPT0gInN0cmluZyIgKSB7CgkJCQlvYmogPSB0eXBlOwoJCQkJdHlwZSA9IHVuZGVmaW5lZDsKCQkJfQoJCQl0eXBlID0gdHlwZSB8fCAiZngiOwoKCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQl0bXAgPSBqUXVlcnkuX2RhdGEoIGVsZW1lbnRzWyBpIF0sIHR5cGUgKyAicXVldWVIb29rcyIgKTsKCQkJCWlmICggdG1wICYmIHRtcC5lbXB0eSApIHsKCQkJCQljb3VudCsrOwoJCQkJCXRtcC5lbXB0eS5hZGQoIHJlc29sdmUgKTsKCQkJCX0KCQkJfQoJCQlyZXNvbHZlKCk7CgkJCXJldHVybiBkZWZlci5wcm9taXNlKCBvYmogKTsKCQl9Cgl9ICk7CgoKCSggZnVuY3Rpb24oKSB7CgkJdmFyIHNocmlua1dyYXBCbG9ja3NWYWw7CgoJCXN1cHBvcnQuc2hyaW5rV3JhcEJsb2NrcyA9IGZ1bmN0aW9uKCkgewoJCQlpZiAoIHNocmlua1dyYXBCbG9ja3NWYWwgIT0gbnVsbCApIHsKCQkJCXJldHVybiBzaHJpbmtXcmFwQmxvY2tzVmFsOwoJCQl9CgoJCQkvLyBXaWxsIGJlIGNoYW5nZWQgbGF0ZXIgaWYgbmVlZGVkLgoJCQlzaHJpbmtXcmFwQmxvY2tzVmFsID0gZmFsc2U7CgoJCQkvLyBNaW5pZmllZDogdmFyIGIsYyxkCgkJCXZhciBkaXYsIGJvZHksIGNvbnRhaW5lcjsKCgkJCWJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSggImJvZHkiIClbIDAgXTsKCQkJaWYgKCAhYm9keSB8fCAhYm9keS5zdHlsZSApIHsKCgkJCQkvLyBUZXN0IGZpcmVkIHRvbyBlYXJseSBvciBpbiBhbiB1bnN1cHBvcnRlZCBlbnZpcm9ubWVudCwgZXhpdC4KCQkJCXJldHVybjsKCQkJfQoKCQkJLy8gU2V0dXAKCQkJZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggImRpdiIgKTsKCQkJY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggImRpdiIgKTsKCQkJY29udGFpbmVyLnN0eWxlLmNzc1RleHQgPSAicG9zaXRpb246YWJzb2x1dGU7Ym9yZGVyOjA7d2lkdGg6MDtoZWlnaHQ6MDt0b3A6MDtsZWZ0Oi05OTk5cHgiOwoJCQlib2R5LmFwcGVuZENoaWxkKCBjb250YWluZXIgKS5hcHBlbmRDaGlsZCggZGl2ICk7CgoJCQkvLyBTdXBwb3J0OiBJRTYKCQkJLy8gQ2hlY2sgaWYgZWxlbWVudHMgd2l0aCBsYXlvdXQgc2hyaW5rLXdyYXAgdGhlaXIgY2hpbGRyZW4KCQkJaWYgKCB0eXBlb2YgZGl2LnN0eWxlLnpvb20gIT09ICJ1bmRlZmluZWQiICkgewoKCQkJCS8vIFJlc2V0IENTUzogYm94LXNpemluZzsgZGlzcGxheTsgbWFyZ2luOyBib3JkZXIKCQkJCWRpdi5zdHlsZS5jc3NUZXh0ID0KCgkJCQkJLy8gU3VwcG9ydDogRmlyZWZveDwyOSwgQW5kcm9pZCAyLjMKCQkJCQkvLyBWZW5kb3ItcHJlZml4IGJveC1zaXppbmcKCQkJCQkiLXdlYmtpdC1ib3gtc2l6aW5nOmNvbnRlbnQtYm94Oy1tb3otYm94LXNpemluZzpjb250ZW50LWJveDsiICsKCQkJCQkiYm94LXNpemluZzpjb250ZW50LWJveDtkaXNwbGF5OmJsb2NrO21hcmdpbjowO2JvcmRlcjowOyIgKwoJCQkJCSJwYWRkaW5nOjFweDt3aWR0aDoxcHg7em9vbToxIjsKCQkJCWRpdi5hcHBlbmRDaGlsZCggZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggImRpdiIgKSApLnN0eWxlLndpZHRoID0gIjVweCI7CgkJCQlzaHJpbmtXcmFwQmxvY2tzVmFsID0gZGl2Lm9mZnNldFdpZHRoICE9PSAzOwoJCQl9CgoJCQlib2R5LnJlbW92ZUNoaWxkKCBjb250YWluZXIgKTsKCgkJCXJldHVybiBzaHJpbmtXcmFwQmxvY2tzVmFsOwoJCX07CgoJfSApKCk7Cgl2YXIgcG51bSA9ICggL1srLV0/KD86XGQqXC58KVxkKyg/OltlRV1bKy1dP1xkK3wpLyApLnNvdXJjZTsKCgl2YXIgcmNzc051bSA9IG5ldyBSZWdFeHAoICJeKD86KFsrLV0pPXwpKCIgKyBwbnVtICsgIikoW2EteiVdKikkIiwgImkiICk7CgoKCXZhciBjc3NFeHBhbmQgPSBbICJUb3AiLCAiUmlnaHQiLCAiQm90dG9tIiwgIkxlZnQiIF07CgoJdmFyIGlzSGlkZGVuID0gZnVuY3Rpb24oIGVsZW0sIGVsICkgewoKCQkJLy8gaXNIaWRkZW4gbWlnaHQgYmUgY2FsbGVkIGZyb20galF1ZXJ5I2ZpbHRlciBmdW5jdGlvbjsKCQkJLy8gaW4gdGhhdCBjYXNlLCBlbGVtZW50IHdpbGwgYmUgc2Vjb25kIGFyZ3VtZW50CgkJCWVsZW0gPSBlbCB8fCBlbGVtOwoJCQlyZXR1cm4galF1ZXJ5LmNzcyggZWxlbSwgImRpc3BsYXkiICkgPT09ICJub25lIiB8fAoJCQkJIWpRdWVyeS5jb250YWlucyggZWxlbS5vd25lckRvY3VtZW50LCBlbGVtICk7CgkJfTsKCgoKCWZ1bmN0aW9uIGFkanVzdENTUyggZWxlbSwgcHJvcCwgdmFsdWVQYXJ0cywgdHdlZW4gKSB7CgkJdmFyIGFkanVzdGVkLAoJCQlzY2FsZSA9IDEsCgkJCW1heEl0ZXJhdGlvbnMgPSAyMCwKCQkJY3VycmVudFZhbHVlID0gdHdlZW4gPwoJCQkJZnVuY3Rpb24oKSB7IHJldHVybiB0d2Vlbi5jdXIoKTsgfSA6CgkJCQlmdW5jdGlvbigpIHsgcmV0dXJuIGpRdWVyeS5jc3MoIGVsZW0sIHByb3AsICIiICk7IH0sCgkJCWluaXRpYWwgPSBjdXJyZW50VmFsdWUoKSwKCQkJdW5pdCA9IHZhbHVlUGFydHMgJiYgdmFsdWVQYXJ0c1sgMyBdIHx8ICggalF1ZXJ5LmNzc051bWJlclsgcHJvcCBdID8gIiIgOiAicHgiICksCgoJCQkvLyBTdGFydGluZyB2YWx1ZSBjb21wdXRhdGlvbiBpcyByZXF1aXJlZCBmb3IgcG90ZW50aWFsIHVuaXQgbWlzbWF0Y2hlcwoJCQlpbml0aWFsSW5Vbml0ID0gKCBqUXVlcnkuY3NzTnVtYmVyWyBwcm9wIF0gfHwgdW5pdCAhPT0gInB4IiAmJiAraW5pdGlhbCApICYmCgkJCQlyY3NzTnVtLmV4ZWMoIGpRdWVyeS5jc3MoIGVsZW0sIHByb3AgKSApOwoKCQlpZiAoIGluaXRpYWxJblVuaXQgJiYgaW5pdGlhbEluVW5pdFsgMyBdICE9PSB1bml0ICkgewoKCQkJLy8gVHJ1c3QgdW5pdHMgcmVwb3J0ZWQgYnkgalF1ZXJ5LmNzcwoJCQl1bml0ID0gdW5pdCB8fCBpbml0aWFsSW5Vbml0WyAzIF07CgoJCQkvLyBNYWtlIHN1cmUgd2UgdXBkYXRlIHRoZSB0d2VlbiBwcm9wZXJ0aWVzIGxhdGVyIG9uCgkJCXZhbHVlUGFydHMgPSB2YWx1ZVBhcnRzIHx8IFtdOwoKCQkJLy8gSXRlcmF0aXZlbHkgYXBwcm94aW1hdGUgZnJvbSBhIG5vbnplcm8gc3RhcnRpbmcgcG9pbnQKCQkJaW5pdGlhbEluVW5pdCA9ICtpbml0aWFsIHx8IDE7CgoJCQlkbyB7CgoJCQkJLy8gSWYgcHJldmlvdXMgaXRlcmF0aW9uIHplcm9lZCBvdXQsIGRvdWJsZSB1bnRpbCB3ZSBnZXQgKnNvbWV0aGluZyouCgkJCQkvLyBVc2Ugc3RyaW5nIGZvciBkb3VibGluZyBzbyB3ZSBkb24ndCBhY2NpZGVudGFsbHkgc2VlIHNjYWxlIGFzIHVuY2hhbmdlZCBiZWxvdwoJCQkJc2NhbGUgPSBzY2FsZSB8fCAiLjUiOwoKCQkJCS8vIEFkanVzdCBhbmQgYXBwbHkKCQkJCWluaXRpYWxJblVuaXQgPSBpbml0aWFsSW5Vbml0IC8gc2NhbGU7CgkJCQlqUXVlcnkuc3R5bGUoIGVsZW0sIHByb3AsIGluaXRpYWxJblVuaXQgKyB1bml0ICk7CgoJCQkvLyBVcGRhdGUgc2NhbGUsIHRvbGVyYXRpbmcgemVybyBvciBOYU4gZnJvbSB0d2Vlbi5jdXIoKQoJCQkvLyBCcmVhayB0aGUgbG9vcCBpZiBzY2FsZSBpcyB1bmNoYW5nZWQgb3IgcGVyZmVjdCwgb3IgaWYgd2UndmUganVzdCBoYWQgZW5vdWdoLgoJCQl9IHdoaWxlICgKCQkJCXNjYWxlICE9PSAoIHNjYWxlID0gY3VycmVudFZhbHVlKCkgLyBpbml0aWFsICkgJiYgc2NhbGUgIT09IDEgJiYgLS1tYXhJdGVyYXRpb25zCgkJCSk7CgkJfQoKCQlpZiAoIHZhbHVlUGFydHMgKSB7CgkJCWluaXRpYWxJblVuaXQgPSAraW5pdGlhbEluVW5pdCB8fCAraW5pdGlhbCB8fCAwOwoKCQkJLy8gQXBwbHkgcmVsYXRpdmUgb2Zmc2V0ICgrPS8tPSkgaWYgc3BlY2lmaWVkCgkJCWFkanVzdGVkID0gdmFsdWVQYXJ0c1sgMSBdID8KCQkJCWluaXRpYWxJblVuaXQgKyAoIHZhbHVlUGFydHNbIDEgXSArIDEgKSAqIHZhbHVlUGFydHNbIDIgXSA6CgkJCQkrdmFsdWVQYXJ0c1sgMiBdOwoJCQlpZiAoIHR3ZWVuICkgewoJCQkJdHdlZW4udW5pdCA9IHVuaXQ7CgkJCQl0d2Vlbi5zdGFydCA9IGluaXRpYWxJblVuaXQ7CgkJCQl0d2Vlbi5lbmQgPSBhZGp1c3RlZDsKCQkJfQoJCX0KCQlyZXR1cm4gYWRqdXN0ZWQ7Cgl9CgoKCS8vIE11bHRpZnVuY3Rpb25hbCBtZXRob2QgdG8gZ2V0IGFuZCBzZXQgdmFsdWVzIG9mIGEgY29sbGVjdGlvbgoJLy8gVGhlIHZhbHVlL3MgY2FuIG9wdGlvbmFsbHkgYmUgZXhlY3V0ZWQgaWYgaXQncyBhIGZ1bmN0aW9uCgl2YXIgYWNjZXNzID0gZnVuY3Rpb24oIGVsZW1zLCBmbiwga2V5LCB2YWx1ZSwgY2hhaW5hYmxlLCBlbXB0eUdldCwgcmF3ICkgewoJCXZhciBpID0gMCwKCQkJbGVuZ3RoID0gZWxlbXMubGVuZ3RoLAoJCQlidWxrID0ga2V5ID09IG51bGw7CgoJCS8vIFNldHMgbWFueSB2YWx1ZXMKCQlpZiAoIGpRdWVyeS50eXBlKCBrZXkgKSA9PT0gIm9iamVjdCIgKSB7CgkJCWNoYWluYWJsZSA9IHRydWU7CgkJCWZvciAoIGkgaW4ga2V5ICkgewoJCQkJYWNjZXNzKCBlbGVtcywgZm4sIGksIGtleVsgaSBdLCB0cnVlLCBlbXB0eUdldCwgcmF3ICk7CgkJCX0KCgkJLy8gU2V0cyBvbmUgdmFsdWUKCQl9IGVsc2UgaWYgKCB2YWx1ZSAhPT0gdW5kZWZpbmVkICkgewoJCQljaGFpbmFibGUgPSB0cnVlOwoKCQkJaWYgKCAhalF1ZXJ5LmlzRnVuY3Rpb24oIHZhbHVlICkgKSB7CgkJCQlyYXcgPSB0cnVlOwoJCQl9CgoJCQlpZiAoIGJ1bGsgKSB7CgoJCQkJLy8gQnVsayBvcGVyYXRpb25zIHJ1biBhZ2FpbnN0IHRoZSBlbnRpcmUgc2V0CgkJCQlpZiAoIHJhdyApIHsKCQkJCQlmbi5jYWxsKCBlbGVtcywgdmFsdWUgKTsKCQkJCQlmbiA9IG51bGw7CgoJCQkJLy8gLi4uZXhjZXB0IHdoZW4gZXhlY3V0aW5nIGZ1bmN0aW9uIHZhbHVlcwoJCQkJfSBlbHNlIHsKCQkJCQlidWxrID0gZm47CgkJCQkJZm4gPSBmdW5jdGlvbiggZWxlbSwga2V5LCB2YWx1ZSApIHsKCQkJCQkJcmV0dXJuIGJ1bGsuY2FsbCggalF1ZXJ5KCBlbGVtICksIHZhbHVlICk7CgkJCQkJfTsKCQkJCX0KCQkJfQoKCQkJaWYgKCBmbiApIHsKCQkJCWZvciAoIDsgaSA8IGxlbmd0aDsgaSsrICkgewoJCQkJCWZuKAoJCQkJCQllbGVtc1sgaSBdLAoJCQkJCQlrZXksCgkJCQkJCXJhdyA/IHZhbHVlIDogdmFsdWUuY2FsbCggZWxlbXNbIGkgXSwgaSwgZm4oIGVsZW1zWyBpIF0sIGtleSApICkKCQkJCQkpOwoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gY2hhaW5hYmxlID8KCQkJZWxlbXMgOgoKCQkJLy8gR2V0cwoJCQlidWxrID8KCQkJCWZuLmNhbGwoIGVsZW1zICkgOgoJCQkJbGVuZ3RoID8gZm4oIGVsZW1zWyAwIF0sIGtleSApIDogZW1wdHlHZXQ7Cgl9OwoJdmFyIHJjaGVja2FibGVUeXBlID0gKCAvXig/OmNoZWNrYm94fHJhZGlvKSQvaSApOwoKCXZhciBydGFnTmFtZSA9ICggLzwoW1x3Oi1dKykvICk7CgoJdmFyIHJzY3JpcHRUeXBlID0gKCAvXiR8XC8oPzpqYXZhfGVjbWEpc2NyaXB0L2kgKTsKCgl2YXIgcmxlYWRpbmdXaGl0ZXNwYWNlID0gKCAvXlxzKy8gKTsKCgl2YXIgbm9kZU5hbWVzID0gImFiYnJ8YXJ0aWNsZXxhc2lkZXxhdWRpb3xiZGl8Y2FudmFzfGRhdGF8ZGF0YWxpc3R8IiArCgkJCSJkZXRhaWxzfGRpYWxvZ3xmaWdjYXB0aW9ufGZpZ3VyZXxmb290ZXJ8aGVhZGVyfGhncm91cHxtYWlufCIgKwoJCQkibWFya3xtZXRlcnxuYXZ8b3V0cHV0fHBpY3R1cmV8cHJvZ3Jlc3N8c2VjdGlvbnxzdW1tYXJ5fHRlbXBsYXRlfHRpbWV8dmlkZW8iOwoKCgoJZnVuY3Rpb24gY3JlYXRlU2FmZUZyYWdtZW50KCBkb2N1bWVudCApIHsKCQl2YXIgbGlzdCA9IG5vZGVOYW1lcy5zcGxpdCggInwiICksCgkJCXNhZmVGcmFnID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOwoKCQlpZiAoIHNhZmVGcmFnLmNyZWF0ZUVsZW1lbnQgKSB7CgkJCXdoaWxlICggbGlzdC5sZW5ndGggKSB7CgkJCQlzYWZlRnJhZy5jcmVhdGVFbGVtZW50KAoJCQkJCWxpc3QucG9wKCkKCQkJCSk7CgkJCX0KCQl9CgkJcmV0dXJuIHNhZmVGcmFnOwoJfQoKCgkoIGZ1bmN0aW9uKCkgewoJCXZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAiZGl2IiApLAoJCQlmcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSwKCQkJaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAiaW5wdXQiICk7CgoJCS8vIFNldHVwCgkJZGl2LmlubmVySFRNTCA9ICIgIDxsaW5rLz48dGFibGU+PC90YWJsZT48YSBocmVmPScvYSc+YTwvYT48aW5wdXQgdHlwZT0nY2hlY2tib3gnLz4iOwoKCQkvLyBJRSBzdHJpcHMgbGVhZGluZyB3aGl0ZXNwYWNlIHdoZW4gLmlubmVySFRNTCBpcyB1c2VkCgkJc3VwcG9ydC5sZWFkaW5nV2hpdGVzcGFjZSA9IGRpdi5maXJzdENoaWxkLm5vZGVUeXBlID09PSAzOwoKCQkvLyBNYWtlIHN1cmUgdGhhdCB0Ym9keSBlbGVtZW50cyBhcmVuJ3QgYXV0b21hdGljYWxseSBpbnNlcnRlZAoJCS8vIElFIHdpbGwgaW5zZXJ0IHRoZW0gaW50byBlbXB0eSB0YWJsZXMKCQlzdXBwb3J0LnRib2R5ID0gIWRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZSggInRib2R5IiApLmxlbmd0aDsKCgkJLy8gTWFrZSBzdXJlIHRoYXQgbGluayBlbGVtZW50cyBnZXQgc2VyaWFsaXplZCBjb3JyZWN0bHkgYnkgaW5uZXJIVE1MCgkJLy8gVGhpcyByZXF1aXJlcyBhIHdyYXBwZXIgZWxlbWVudCBpbiBJRQoJCXN1cHBvcnQuaHRtbFNlcmlhbGl6ZSA9ICEhZGl2LmdldEVsZW1lbnRzQnlUYWdOYW1lKCAibGluayIgKS5sZW5ndGg7CgoJCS8vIE1ha2VzIHN1cmUgY2xvbmluZyBhbiBodG1sNSBlbGVtZW50IGRvZXMgbm90IGNhdXNlIHByb2JsZW1zCgkJLy8gV2hlcmUgb3V0ZXJIVE1MIGlzIHVuZGVmaW5lZCwgdGhpcyBzdGlsbCB3b3JrcwoJCXN1cHBvcnQuaHRtbDVDbG9uZSA9CgkJCWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJuYXYiICkuY2xvbmVOb2RlKCB0cnVlICkub3V0ZXJIVE1MICE9PSAiPDpuYXY+PC86bmF2PiI7CgoJCS8vIENoZWNrIGlmIGEgZGlzY29ubmVjdGVkIGNoZWNrYm94IHdpbGwgcmV0YWluIGl0cyBjaGVja2VkCgkJLy8gdmFsdWUgb2YgdHJ1ZSBhZnRlciBhcHBlbmRlZCB0byB0aGUgRE9NIChJRTYvNykKCQlpbnB1dC50eXBlID0gImNoZWNrYm94IjsKCQlpbnB1dC5jaGVja2VkID0gdHJ1ZTsKCQlmcmFnbWVudC5hcHBlbmRDaGlsZCggaW5wdXQgKTsKCQlzdXBwb3J0LmFwcGVuZENoZWNrZWQgPSBpbnB1dC5jaGVja2VkOwoKCQkvLyBNYWtlIHN1cmUgdGV4dGFyZWEgKGFuZCBjaGVja2JveCkgZGVmYXVsdFZhbHVlIGlzIHByb3Blcmx5IGNsb25lZAoJCS8vIFN1cHBvcnQ6IElFNi1JRTExKwoJCWRpdi5pbm5lckhUTUwgPSAiPHRleHRhcmVhPng8L3RleHRhcmVhPiI7CgkJc3VwcG9ydC5ub0Nsb25lQ2hlY2tlZCA9ICEhZGl2LmNsb25lTm9kZSggdHJ1ZSApLmxhc3RDaGlsZC5kZWZhdWx0VmFsdWU7CgoJCS8vICMxMTIxNyAtIFdlYktpdCBsb3NlcyBjaGVjayB3aGVuIHRoZSBuYW1lIGlzIGFmdGVyIHRoZSBjaGVja2VkIGF0dHJpYnV0ZQoJCWZyYWdtZW50LmFwcGVuZENoaWxkKCBkaXYgKTsKCgkJLy8gU3VwcG9ydDogV2luZG93cyBXZWIgQXBwcyAoV1dBKQoJCS8vIGBuYW1lYCBhbmQgYHR5cGVgIG11c3QgdXNlIC5zZXRBdHRyaWJ1dGUgZm9yIFdXQSAoIzE0OTAxKQoJCWlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggImlucHV0IiApOwoJCWlucHV0LnNldEF0dHJpYnV0ZSggInR5cGUiLCAicmFkaW8iICk7CgkJaW5wdXQuc2V0QXR0cmlidXRlKCAiY2hlY2tlZCIsICJjaGVja2VkIiApOwoJCWlucHV0LnNldEF0dHJpYnV0ZSggIm5hbWUiLCAidCIgKTsKCgkJZGl2LmFwcGVuZENoaWxkKCBpbnB1dCApOwoKCQkvLyBTdXBwb3J0OiBTYWZhcmkgNS4xLCBpT1MgNS4xLCBBbmRyb2lkIDQueCwgQW5kcm9pZCAyLjMKCQkvLyBvbGQgV2ViS2l0IGRvZXNuJ3QgY2xvbmUgY2hlY2tlZCBzdGF0ZSBjb3JyZWN0bHkgaW4gZnJhZ21lbnRzCgkJc3VwcG9ydC5jaGVja0Nsb25lID0gZGl2LmNsb25lTm9kZSggdHJ1ZSApLmNsb25lTm9kZSggdHJ1ZSApLmxhc3RDaGlsZC5jaGVja2VkOwoKCQkvLyBTdXBwb3J0OiBJRTw5CgkJLy8gQ2xvbmVkIGVsZW1lbnRzIGtlZXAgYXR0YWNoRXZlbnQgaGFuZGxlcnMsIHdlIHVzZSBhZGRFdmVudExpc3RlbmVyIG9uIElFOSsKCQlzdXBwb3J0Lm5vQ2xvbmVFdmVudCA9ICEhZGl2LmFkZEV2ZW50TGlzdGVuZXI7CgoJCS8vIFN1cHBvcnQ6IElFPDkKCQkvLyBTaW5jZSBhdHRyaWJ1dGVzIGFuZCBwcm9wZXJ0aWVzIGFyZSB0aGUgc2FtZSBpbiBJRSwKCQkvLyBjbGVhbkRhdGEgbXVzdCBzZXQgcHJvcGVydGllcyB0byB1bmRlZmluZWQgcmF0aGVyIHRoYW4gdXNlIHJlbW92ZUF0dHJpYnV0ZQoJCWRpdlsgalF1ZXJ5LmV4cGFuZG8gXSA9IDE7CgkJc3VwcG9ydC5hdHRyaWJ1dGVzID0gIWRpdi5nZXRBdHRyaWJ1dGUoIGpRdWVyeS5leHBhbmRvICk7Cgl9ICkoKTsKCgoJLy8gV2UgaGF2ZSB0byBjbG9zZSB0aGVzZSB0YWdzIHRvIHN1cHBvcnQgWEhUTUwgKCMxMzIwMCkKCXZhciB3cmFwTWFwID0gewoJCW9wdGlvbjogWyAxLCAiPHNlbGVjdCBtdWx0aXBsZT0nbXVsdGlwbGUnPiIsICI8L3NlbGVjdD4iIF0sCgkJbGVnZW5kOiBbIDEsICI8ZmllbGRzZXQ+IiwgIjwvZmllbGRzZXQ+IiBdLAoJCWFyZWE6IFsgMSwgIjxtYXA+IiwgIjwvbWFwPiIgXSwKCgkJLy8gU3VwcG9ydDogSUU4CgkJcGFyYW06IFsgMSwgIjxvYmplY3Q+IiwgIjwvb2JqZWN0PiIgXSwKCQl0aGVhZDogWyAxLCAiPHRhYmxlPiIsICI8L3RhYmxlPiIgXSwKCQl0cjogWyAyLCAiPHRhYmxlPjx0Ym9keT4iLCAiPC90Ym9keT48L3RhYmxlPiIgXSwKCQljb2w6IFsgMiwgIjx0YWJsZT48dGJvZHk+PC90Ym9keT48Y29sZ3JvdXA+IiwgIjwvY29sZ3JvdXA+PC90YWJsZT4iIF0sCgkJdGQ6IFsgMywgIjx0YWJsZT48dGJvZHk+PHRyPiIsICI8L3RyPjwvdGJvZHk+PC90YWJsZT4iIF0sCgoJCS8vIElFNi04IGNhbid0IHNlcmlhbGl6ZSBsaW5rLCBzY3JpcHQsIHN0eWxlLCBvciBhbnkgaHRtbDUgKE5vU2NvcGUpIHRhZ3MsCgkJLy8gdW5sZXNzIHdyYXBwZWQgaW4gYSBkaXYgd2l0aCBub24tYnJlYWtpbmcgY2hhcmFjdGVycyBpbiBmcm9udCBvZiBpdC4KCQlfZGVmYXVsdDogc3VwcG9ydC5odG1sU2VyaWFsaXplID8gWyAwLCAiIiwgIiIgXSA6IFsgMSwgIlg8ZGl2PiIsICI8L2Rpdj4iIF0KCX07CgoJLy8gU3VwcG9ydDogSUU4LUlFOQoJd3JhcE1hcC5vcHRncm91cCA9IHdyYXBNYXAub3B0aW9uOwoKCXdyYXBNYXAudGJvZHkgPSB3cmFwTWFwLnRmb290ID0gd3JhcE1hcC5jb2xncm91cCA9IHdyYXBNYXAuY2FwdGlvbiA9IHdyYXBNYXAudGhlYWQ7Cgl3cmFwTWFwLnRoID0gd3JhcE1hcC50ZDsKCgoJZnVuY3Rpb24gZ2V0QWxsKCBjb250ZXh0LCB0YWcgKSB7CgkJdmFyIGVsZW1zLCBlbGVtLAoJCQlpID0gMCwKCQkJZm91bmQgPSB0eXBlb2YgY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSAhPT0gInVuZGVmaW5lZCIgPwoJCQkJY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSggdGFnIHx8ICIqIiApIDoKCQkJCXR5cGVvZiBjb250ZXh0LnF1ZXJ5U2VsZWN0b3JBbGwgIT09ICJ1bmRlZmluZWQiID8KCQkJCQljb250ZXh0LnF1ZXJ5U2VsZWN0b3JBbGwoIHRhZyB8fCAiKiIgKSA6CgkJCQkJdW5kZWZpbmVkOwoKCQlpZiAoICFmb3VuZCApIHsKCQkJZm9yICggZm91bmQgPSBbXSwgZWxlbXMgPSBjb250ZXh0LmNoaWxkTm9kZXMgfHwgY29udGV4dDsKCQkJCSggZWxlbSA9IGVsZW1zWyBpIF0gKSAhPSBudWxsOwoJCQkJaSsrCgkJCSkgewoJCQkJaWYgKCAhdGFnIHx8IGpRdWVyeS5ub2RlTmFtZSggZWxlbSwgdGFnICkgKSB7CgkJCQkJZm91bmQucHVzaCggZWxlbSApOwoJCQkJfSBlbHNlIHsKCQkJCQlqUXVlcnkubWVyZ2UoIGZvdW5kLCBnZXRBbGwoIGVsZW0sIHRhZyApICk7CgkJCQl9CgkJCX0KCQl9CgoJCXJldHVybiB0YWcgPT09IHVuZGVmaW5lZCB8fCB0YWcgJiYgalF1ZXJ5Lm5vZGVOYW1lKCBjb250ZXh0LCB0YWcgKSA/CgkJCWpRdWVyeS5tZXJnZSggWyBjb250ZXh0IF0sIGZvdW5kICkgOgoJCQlmb3VuZDsKCX0KCgoJLy8gTWFyayBzY3JpcHRzIGFzIGhhdmluZyBhbHJlYWR5IGJlZW4gZXZhbHVhdGVkCglmdW5jdGlvbiBzZXRHbG9iYWxFdmFsKCBlbGVtcywgcmVmRWxlbWVudHMgKSB7CgkJdmFyIGVsZW0sCgkJCWkgPSAwOwoJCWZvciAoIDsgKCBlbGVtID0gZWxlbXNbIGkgXSApICE9IG51bGw7IGkrKyApIHsKCQkJalF1ZXJ5Ll9kYXRhKAoJCQkJZWxlbSwKCQkJCSJnbG9iYWxFdmFsIiwKCQkJCSFyZWZFbGVtZW50cyB8fCBqUXVlcnkuX2RhdGEoIHJlZkVsZW1lbnRzWyBpIF0sICJnbG9iYWxFdmFsIiApCgkJCSk7CgkJfQoJfQoKCgl2YXIgcmh0bWwgPSAvPHwmIz9cdys7LywKCQlydGJvZHkgPSAvPHRib2R5L2k7CgoJZnVuY3Rpb24gZml4RGVmYXVsdENoZWNrZWQoIGVsZW0gKSB7CgkJaWYgKCByY2hlY2thYmxlVHlwZS50ZXN0KCBlbGVtLnR5cGUgKSApIHsKCQkJZWxlbS5kZWZhdWx0Q2hlY2tlZCA9IGVsZW0uY2hlY2tlZDsKCQl9Cgl9CgoJZnVuY3Rpb24gYnVpbGRGcmFnbWVudCggZWxlbXMsIGNvbnRleHQsIHNjcmlwdHMsIHNlbGVjdGlvbiwgaWdub3JlZCApIHsKCQl2YXIgaiwgZWxlbSwgY29udGFpbnMsCgkJCXRtcCwgdGFnLCB0Ym9keSwgd3JhcCwKCQkJbCA9IGVsZW1zLmxlbmd0aCwKCgkJCS8vIEVuc3VyZSBhIHNhZmUgZnJhZ21lbnQKCQkJc2FmZSA9IGNyZWF0ZVNhZmVGcmFnbWVudCggY29udGV4dCApLAoKCQkJbm9kZXMgPSBbXSwKCQkJaSA9IDA7CgoJCWZvciAoIDsgaSA8IGw7IGkrKyApIHsKCQkJZWxlbSA9IGVsZW1zWyBpIF07CgoJCQlpZiAoIGVsZW0gfHwgZWxlbSA9PT0gMCApIHsKCgkJCQkvLyBBZGQgbm9kZXMgZGlyZWN0bHkKCQkJCWlmICggalF1ZXJ5LnR5cGUoIGVsZW0gKSA9PT0gIm9iamVjdCIgKSB7CgkJCQkJalF1ZXJ5Lm1lcmdlKCBub2RlcywgZWxlbS5ub2RlVHlwZSA/IFsgZWxlbSBdIDogZWxlbSApOwoKCQkJCS8vIENvbnZlcnQgbm9uLWh0bWwgaW50byBhIHRleHQgbm9kZQoJCQkJfSBlbHNlIGlmICggIXJodG1sLnRlc3QoIGVsZW0gKSApIHsKCQkJCQlub2Rlcy5wdXNoKCBjb250ZXh0LmNyZWF0ZVRleHROb2RlKCBlbGVtICkgKTsKCgkJCQkvLyBDb252ZXJ0IGh0bWwgaW50byBET00gbm9kZXMKCQkJCX0gZWxzZSB7CgkJCQkJdG1wID0gdG1wIHx8IHNhZmUuYXBwZW5kQ2hpbGQoIGNvbnRleHQuY3JlYXRlRWxlbWVudCggImRpdiIgKSApOwoKCQkJCQkvLyBEZXNlcmlhbGl6ZSBhIHN0YW5kYXJkIHJlcHJlc2VudGF0aW9uCgkJCQkJdGFnID0gKCBydGFnTmFtZS5leGVjKCBlbGVtICkgfHwgWyAiIiwgIiIgXSApWyAxIF0udG9Mb3dlckNhc2UoKTsKCQkJCQl3cmFwID0gd3JhcE1hcFsgdGFnIF0gfHwgd3JhcE1hcC5fZGVmYXVsdDsKCgkJCQkJdG1wLmlubmVySFRNTCA9IHdyYXBbIDEgXSArIGpRdWVyeS5odG1sUHJlZmlsdGVyKCBlbGVtICkgKyB3cmFwWyAyIF07CgoJCQkJCS8vIERlc2NlbmQgdGhyb3VnaCB3cmFwcGVycyB0byB0aGUgcmlnaHQgY29udGVudAoJCQkJCWogPSB3cmFwWyAwIF07CgkJCQkJd2hpbGUgKCBqLS0gKSB7CgkJCQkJCXRtcCA9IHRtcC5sYXN0Q2hpbGQ7CgkJCQkJfQoKCQkJCQkvLyBNYW51YWxseSBhZGQgbGVhZGluZyB3aGl0ZXNwYWNlIHJlbW92ZWQgYnkgSUUKCQkJCQlpZiAoICFzdXBwb3J0LmxlYWRpbmdXaGl0ZXNwYWNlICYmIHJsZWFkaW5nV2hpdGVzcGFjZS50ZXN0KCBlbGVtICkgKSB7CgkJCQkJCW5vZGVzLnB1c2goIGNvbnRleHQuY3JlYXRlVGV4dE5vZGUoIHJsZWFkaW5nV2hpdGVzcGFjZS5leGVjKCBlbGVtIClbIDAgXSApICk7CgkJCQkJfQoKCQkJCQkvLyBSZW1vdmUgSUUncyBhdXRvaW5zZXJ0ZWQgPHRib2R5PiBmcm9tIHRhYmxlIGZyYWdtZW50cwoJCQkJCWlmICggIXN1cHBvcnQudGJvZHkgKSB7CgoJCQkJCQkvLyBTdHJpbmcgd2FzIGEgPHRhYmxlPiwgKm1heSogaGF2ZSBzcHVyaW91cyA8dGJvZHk+CgkJCQkJCWVsZW0gPSB0YWcgPT09ICJ0YWJsZSIgJiYgIXJ0Ym9keS50ZXN0KCBlbGVtICkgPwoJCQkJCQkJdG1wLmZpcnN0Q2hpbGQgOgoKCQkJCQkJCS8vIFN0cmluZyB3YXMgYSBiYXJlIDx0aGVhZD4gb3IgPHRmb290PgoJCQkJCQkJd3JhcFsgMSBdID09PSAiPHRhYmxlPiIgJiYgIXJ0Ym9keS50ZXN0KCBlbGVtICkgPwoJCQkJCQkJCXRtcCA6CgkJCQkJCQkJMDsKCgkJCQkJCWogPSBlbGVtICYmIGVsZW0uY2hpbGROb2Rlcy5sZW5ndGg7CgkJCQkJCXdoaWxlICggai0tICkgewoJCQkJCQkJaWYgKCBqUXVlcnkubm9kZU5hbWUoICggdGJvZHkgPSBlbGVtLmNoaWxkTm9kZXNbIGogXSApLCAidGJvZHkiICkgJiYKCQkJCQkJCQkhdGJvZHkuY2hpbGROb2Rlcy5sZW5ndGggKSB7CgoJCQkJCQkJCWVsZW0ucmVtb3ZlQ2hpbGQoIHRib2R5ICk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgoJCQkJCWpRdWVyeS5tZXJnZSggbm9kZXMsIHRtcC5jaGlsZE5vZGVzICk7CgoJCQkJCS8vIEZpeCAjMTIzOTIgZm9yIFdlYktpdCBhbmQgSUUgPiA5CgkJCQkJdG1wLnRleHRDb250ZW50ID0gIiI7CgoJCQkJCS8vIEZpeCAjMTIzOTIgZm9yIG9sZElFCgkJCQkJd2hpbGUgKCB0bXAuZmlyc3RDaGlsZCApIHsKCQkJCQkJdG1wLnJlbW92ZUNoaWxkKCB0bXAuZmlyc3RDaGlsZCApOwoJCQkJCX0KCgkJCQkJLy8gUmVtZW1iZXIgdGhlIHRvcC1sZXZlbCBjb250YWluZXIgZm9yIHByb3BlciBjbGVhbnVwCgkJCQkJdG1wID0gc2FmZS5sYXN0Q2hpbGQ7CgkJCQl9CgkJCX0KCQl9CgoJCS8vIEZpeCAjMTEzNTY6IENsZWFyIGVsZW1lbnRzIGZyb20gZnJhZ21lbnQKCQlpZiAoIHRtcCApIHsKCQkJc2FmZS5yZW1vdmVDaGlsZCggdG1wICk7CgkJfQoKCQkvLyBSZXNldCBkZWZhdWx0Q2hlY2tlZCBmb3IgYW55IHJhZGlvcyBhbmQgY2hlY2tib3hlcwoJCS8vIGFib3V0IHRvIGJlIGFwcGVuZGVkIHRvIHRoZSBET00gaW4gSUUgNi83ICgjODA2MCkKCQlpZiAoICFzdXBwb3J0LmFwcGVuZENoZWNrZWQgKSB7CgkJCWpRdWVyeS5ncmVwKCBnZXRBbGwoIG5vZGVzLCAiaW5wdXQiICksIGZpeERlZmF1bHRDaGVja2VkICk7CgkJfQoKCQlpID0gMDsKCQl3aGlsZSAoICggZWxlbSA9IG5vZGVzWyBpKysgXSApICkgewoKCQkJLy8gU2tpcCBlbGVtZW50cyBhbHJlYWR5IGluIHRoZSBjb250ZXh0IGNvbGxlY3Rpb24gKHRyYWMtNDA4NykKCQkJaWYgKCBzZWxlY3Rpb24gJiYgalF1ZXJ5LmluQXJyYXkoIGVsZW0sIHNlbGVjdGlvbiApID4gLTEgKSB7CgkJCQlpZiAoIGlnbm9yZWQgKSB7CgkJCQkJaWdub3JlZC5wdXNoKCBlbGVtICk7CgkJCQl9CgoJCQkJY29udGludWU7CgkJCX0KCgkJCWNvbnRhaW5zID0galF1ZXJ5LmNvbnRhaW5zKCBlbGVtLm93bmVyRG9jdW1lbnQsIGVsZW0gKTsKCgkJCS8vIEFwcGVuZCB0byBmcmFnbWVudAoJCQl0bXAgPSBnZXRBbGwoIHNhZmUuYXBwZW5kQ2hpbGQoIGVsZW0gKSwgInNjcmlwdCIgKTsKCgkJCS8vIFByZXNlcnZlIHNjcmlwdCBldmFsdWF0aW9uIGhpc3RvcnkKCQkJaWYgKCBjb250YWlucyApIHsKCQkJCXNldEdsb2JhbEV2YWwoIHRtcCApOwoJCQl9CgoJCQkvLyBDYXB0dXJlIGV4ZWN1dGFibGVzCgkJCWlmICggc2NyaXB0cyApIHsKCQkJCWogPSAwOwoJCQkJd2hpbGUgKCAoIGVsZW0gPSB0bXBbIGorKyBdICkgKSB7CgkJCQkJaWYgKCByc2NyaXB0VHlwZS50ZXN0KCBlbGVtLnR5cGUgfHwgIiIgKSApIHsKCQkJCQkJc2NyaXB0cy5wdXNoKCBlbGVtICk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoKCQl0bXAgPSBudWxsOwoKCQlyZXR1cm4gc2FmZTsKCX0KCgoJKCBmdW5jdGlvbigpIHsKCQl2YXIgaSwgZXZlbnROYW1lLAoJCQlkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAiZGl2IiApOwoKCQkvLyBTdXBwb3J0OiBJRTw5IChsYWNrIHN1Ym1pdC9jaGFuZ2UgYnViYmxlKSwgRmlyZWZveCAobGFjayBmb2N1cyhpbiB8IG91dCkgZXZlbnRzKQoJCWZvciAoIGkgaW4geyBzdWJtaXQ6IHRydWUsIGNoYW5nZTogdHJ1ZSwgZm9jdXNpbjogdHJ1ZSB9ICkgewoJCQlldmVudE5hbWUgPSAib24iICsgaTsKCgkJCWlmICggISggc3VwcG9ydFsgaSBdID0gZXZlbnROYW1lIGluIHdpbmRvdyApICkgewoKCQkJCS8vIEJld2FyZSBvZiBDU1AgcmVzdHJpY3Rpb25zIChodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi9TZWN1cml0eS9DU1ApCgkJCQlkaXYuc2V0QXR0cmlidXRlKCBldmVudE5hbWUsICJ0IiApOwoJCQkJc3VwcG9ydFsgaSBdID0gZGl2LmF0dHJpYnV0ZXNbIGV2ZW50TmFtZSBdLmV4cGFuZG8gPT09IGZhbHNlOwoJCQl9CgkJfQoKCQkvLyBOdWxsIGVsZW1lbnRzIHRvIGF2b2lkIGxlYWtzIGluIElFLgoJCWRpdiA9IG51bGw7Cgl9ICkoKTsKCgoJdmFyIHJmb3JtRWxlbXMgPSAvXig/OmlucHV0fHNlbGVjdHx0ZXh0YXJlYSkkL2ksCgkJcmtleUV2ZW50ID0gL15rZXkvLAoJCXJtb3VzZUV2ZW50ID0gL14oPzptb3VzZXxwb2ludGVyfGNvbnRleHRtZW51fGRyYWd8ZHJvcCl8Y2xpY2svLAoJCXJmb2N1c01vcnBoID0gL14oPzpmb2N1c2luZm9jdXN8Zm9jdXNvdXRibHVyKSQvLAoJCXJ0eXBlbmFtZXNwYWNlID0gL14oW14uXSopKD86XC4oLispfCkvOwoKCWZ1bmN0aW9uIHJldHVyblRydWUoKSB7CgkJcmV0dXJuIHRydWU7Cgl9CgoJZnVuY3Rpb24gcmV0dXJuRmFsc2UoKSB7CgkJcmV0dXJuIGZhbHNlOwoJfQoKCS8vIFN1cHBvcnQ6IElFOQoJLy8gU2VlICMxMzM5MyBmb3IgbW9yZSBpbmZvCglmdW5jdGlvbiBzYWZlQWN0aXZlRWxlbWVudCgpIHsKCQl0cnkgewoJCQlyZXR1cm4gZG9jdW1lbnQuYWN0aXZlRWxlbWVudDsKCQl9IGNhdGNoICggZXJyICkgeyB9Cgl9CgoJZnVuY3Rpb24gb24oIGVsZW0sIHR5cGVzLCBzZWxlY3RvciwgZGF0YSwgZm4sIG9uZSApIHsKCQl2YXIgb3JpZ0ZuLCB0eXBlOwoKCQkvLyBUeXBlcyBjYW4gYmUgYSBtYXAgb2YgdHlwZXMvaGFuZGxlcnMKCQlpZiAoIHR5cGVvZiB0eXBlcyA9PT0gIm9iamVjdCIgKSB7CgoJCQkvLyAoIHR5cGVzLU9iamVjdCwgc2VsZWN0b3IsIGRhdGEgKQoJCQlpZiAoIHR5cGVvZiBzZWxlY3RvciAhPT0gInN0cmluZyIgKSB7CgoJCQkJLy8gKCB0eXBlcy1PYmplY3QsIGRhdGEgKQoJCQkJZGF0YSA9IGRhdGEgfHwgc2VsZWN0b3I7CgkJCQlzZWxlY3RvciA9IHVuZGVmaW5lZDsKCQkJfQoJCQlmb3IgKCB0eXBlIGluIHR5cGVzICkgewoJCQkJb24oIGVsZW0sIHR5cGUsIHNlbGVjdG9yLCBkYXRhLCB0eXBlc1sgdHlwZSBdLCBvbmUgKTsKCQkJfQoJCQlyZXR1cm4gZWxlbTsKCQl9CgoJCWlmICggZGF0YSA9PSBudWxsICYmIGZuID09IG51bGwgKSB7CgoJCQkvLyAoIHR5cGVzLCBmbiApCgkJCWZuID0gc2VsZWN0b3I7CgkJCWRhdGEgPSBzZWxlY3RvciA9IHVuZGVmaW5lZDsKCQl9IGVsc2UgaWYgKCBmbiA9PSBudWxsICkgewoJCQlpZiAoIHR5cGVvZiBzZWxlY3RvciA9PT0gInN0cmluZyIgKSB7CgoJCQkJLy8gKCB0eXBlcywgc2VsZWN0b3IsIGZuICkKCQkJCWZuID0gZGF0YTsKCQkJCWRhdGEgPSB1bmRlZmluZWQ7CgkJCX0gZWxzZSB7CgoJCQkJLy8gKCB0eXBlcywgZGF0YSwgZm4gKQoJCQkJZm4gPSBkYXRhOwoJCQkJZGF0YSA9IHNlbGVjdG9yOwoJCQkJc2VsZWN0b3IgPSB1bmRlZmluZWQ7CgkJCX0KCQl9CgkJaWYgKCBmbiA9PT0gZmFsc2UgKSB7CgkJCWZuID0gcmV0dXJuRmFsc2U7CgkJfSBlbHNlIGlmICggIWZuICkgewoJCQlyZXR1cm4gZWxlbTsKCQl9CgoJCWlmICggb25lID09PSAxICkgewoJCQlvcmlnRm4gPSBmbjsKCQkJZm4gPSBmdW5jdGlvbiggZXZlbnQgKSB7CgoJCQkJLy8gQ2FuIHVzZSBhbiBlbXB0eSBzZXQsIHNpbmNlIGV2ZW50IGNvbnRhaW5zIHRoZSBpbmZvCgkJCQlqUXVlcnkoKS5vZmYoIGV2ZW50ICk7CgkJCQlyZXR1cm4gb3JpZ0ZuLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTsKCQkJfTsKCgkJCS8vIFVzZSBzYW1lIGd1aWQgc28gY2FsbGVyIGNhbiByZW1vdmUgdXNpbmcgb3JpZ0ZuCgkJCWZuLmd1aWQgPSBvcmlnRm4uZ3VpZCB8fCAoIG9yaWdGbi5ndWlkID0galF1ZXJ5Lmd1aWQrKyApOwoJCX0KCQlyZXR1cm4gZWxlbS5lYWNoKCBmdW5jdGlvbigpIHsKCQkJalF1ZXJ5LmV2ZW50LmFkZCggdGhpcywgdHlwZXMsIGZuLCBkYXRhLCBzZWxlY3RvciApOwoJCX0gKTsKCX0KCgkvKgoJICogSGVscGVyIGZ1bmN0aW9ucyBmb3IgbWFuYWdpbmcgZXZlbnRzIC0tIG5vdCBwYXJ0IG9mIHRoZSBwdWJsaWMgaW50ZXJmYWNlLgoJICogUHJvcHMgdG8gRGVhbiBFZHdhcmRzJyBhZGRFdmVudCBsaWJyYXJ5IGZvciBtYW55IG9mIHRoZSBpZGVhcy4KCSAqLwoJalF1ZXJ5LmV2ZW50ID0gewoKCQlnbG9iYWw6IHt9LAoKCQlhZGQ6IGZ1bmN0aW9uKCBlbGVtLCB0eXBlcywgaGFuZGxlciwgZGF0YSwgc2VsZWN0b3IgKSB7CgkJCXZhciB0bXAsIGV2ZW50cywgdCwgaGFuZGxlT2JqSW4sCgkJCQlzcGVjaWFsLCBldmVudEhhbmRsZSwgaGFuZGxlT2JqLAoJCQkJaGFuZGxlcnMsIHR5cGUsIG5hbWVzcGFjZXMsIG9yaWdUeXBlLAoJCQkJZWxlbURhdGEgPSBqUXVlcnkuX2RhdGEoIGVsZW0gKTsKCgkJCS8vIERvbid0IGF0dGFjaCBldmVudHMgdG8gbm9EYXRhIG9yIHRleHQvY29tbWVudCBub2RlcyAoYnV0IGFsbG93IHBsYWluIG9iamVjdHMpCgkJCWlmICggIWVsZW1EYXRhICkgewoJCQkJcmV0dXJuOwoJCQl9CgoJCQkvLyBDYWxsZXIgY2FuIHBhc3MgaW4gYW4gb2JqZWN0IG9mIGN1c3RvbSBkYXRhIGluIGxpZXUgb2YgdGhlIGhhbmRsZXIKCQkJaWYgKCBoYW5kbGVyLmhhbmRsZXIgKSB7CgkJCQloYW5kbGVPYmpJbiA9IGhhbmRsZXI7CgkJCQloYW5kbGVyID0gaGFuZGxlT2JqSW4uaGFuZGxlcjsKCQkJCXNlbGVjdG9yID0gaGFuZGxlT2JqSW4uc2VsZWN0b3I7CgkJCX0KCgkJCS8vIE1ha2Ugc3VyZSB0aGF0IHRoZSBoYW5kbGVyIGhhcyBhIHVuaXF1ZSBJRCwgdXNlZCB0byBmaW5kL3JlbW92ZSBpdCBsYXRlcgoJCQlpZiAoICFoYW5kbGVyLmd1aWQgKSB7CgkJCQloYW5kbGVyLmd1aWQgPSBqUXVlcnkuZ3VpZCsrOwoJCQl9CgoJCQkvLyBJbml0IHRoZSBlbGVtZW50J3MgZXZlbnQgc3RydWN0dXJlIGFuZCBtYWluIGhhbmRsZXIsIGlmIHRoaXMgaXMgdGhlIGZpcnN0CgkJCWlmICggISggZXZlbnRzID0gZWxlbURhdGEuZXZlbnRzICkgKSB7CgkJCQlldmVudHMgPSBlbGVtRGF0YS5ldmVudHMgPSB7fTsKCQkJfQoJCQlpZiAoICEoIGV2ZW50SGFuZGxlID0gZWxlbURhdGEuaGFuZGxlICkgKSB7CgkJCQlldmVudEhhbmRsZSA9IGVsZW1EYXRhLmhhbmRsZSA9IGZ1bmN0aW9uKCBlICkgewoKCQkJCQkvLyBEaXNjYXJkIHRoZSBzZWNvbmQgZXZlbnQgb2YgYSBqUXVlcnkuZXZlbnQudHJpZ2dlcigpIGFuZAoJCQkJCS8vIHdoZW4gYW4gZXZlbnQgaXMgY2FsbGVkIGFmdGVyIGEgcGFnZSBoYXMgdW5sb2FkZWQKCQkJCQlyZXR1cm4gdHlwZW9mIGpRdWVyeSAhPT0gInVuZGVmaW5lZCIgJiYKCQkJCQkJKCAhZSB8fCBqUXVlcnkuZXZlbnQudHJpZ2dlcmVkICE9PSBlLnR5cGUgKSA/CgkJCQkJCWpRdWVyeS5ldmVudC5kaXNwYXRjaC5hcHBseSggZXZlbnRIYW5kbGUuZWxlbSwgYXJndW1lbnRzICkgOgoJCQkJCQl1bmRlZmluZWQ7CgkJCQl9OwoKCQkJCS8vIEFkZCBlbGVtIGFzIGEgcHJvcGVydHkgb2YgdGhlIGhhbmRsZSBmbiB0byBwcmV2ZW50IGEgbWVtb3J5IGxlYWsKCQkJCS8vIHdpdGggSUUgbm9uLW5hdGl2ZSBldmVudHMKCQkJCWV2ZW50SGFuZGxlLmVsZW0gPSBlbGVtOwoJCQl9CgoJCQkvLyBIYW5kbGUgbXVsdGlwbGUgZXZlbnRzIHNlcGFyYXRlZCBieSBhIHNwYWNlCgkJCXR5cGVzID0gKCB0eXBlcyB8fCAiIiApLm1hdGNoKCBybm90d2hpdGUgKSB8fCBbICIiIF07CgkJCXQgPSB0eXBlcy5sZW5ndGg7CgkJCXdoaWxlICggdC0tICkgewoJCQkJdG1wID0gcnR5cGVuYW1lc3BhY2UuZXhlYyggdHlwZXNbIHQgXSApIHx8IFtdOwoJCQkJdHlwZSA9IG9yaWdUeXBlID0gdG1wWyAxIF07CgkJCQluYW1lc3BhY2VzID0gKCB0bXBbIDIgXSB8fCAiIiApLnNwbGl0KCAiLiIgKS5zb3J0KCk7CgoJCQkJLy8gVGhlcmUgKm11c3QqIGJlIGEgdHlwZSwgbm8gYXR0YWNoaW5nIG5hbWVzcGFjZS1vbmx5IGhhbmRsZXJzCgkJCQlpZiAoICF0eXBlICkgewoJCQkJCWNvbnRpbnVlOwoJCQkJfQoKCQkJCS8vIElmIGV2ZW50IGNoYW5nZXMgaXRzIHR5cGUsIHVzZSB0aGUgc3BlY2lhbCBldmVudCBoYW5kbGVycyBmb3IgdGhlIGNoYW5nZWQgdHlwZQoJCQkJc3BlY2lhbCA9IGpRdWVyeS5ldmVudC5zcGVjaWFsWyB0eXBlIF0gfHwge307CgoJCQkJLy8gSWYgc2VsZWN0b3IgZGVmaW5lZCwgZGV0ZXJtaW5lIHNwZWNpYWwgZXZlbnQgYXBpIHR5cGUsIG90aGVyd2lzZSBnaXZlbiB0eXBlCgkJCQl0eXBlID0gKCBzZWxlY3RvciA/IHNwZWNpYWwuZGVsZWdhdGVUeXBlIDogc3BlY2lhbC5iaW5kVHlwZSApIHx8IHR5cGU7CgoJCQkJLy8gVXBkYXRlIHNwZWNpYWwgYmFzZWQgb24gbmV3bHkgcmVzZXQgdHlwZQoJCQkJc3BlY2lhbCA9IGpRdWVyeS5ldmVudC5zcGVjaWFsWyB0eXBlIF0gfHwge307CgoJCQkJLy8gaGFuZGxlT2JqIGlzIHBhc3NlZCB0byBhbGwgZXZlbnQgaGFuZGxlcnMKCQkJCWhhbmRsZU9iaiA9IGpRdWVyeS5leHRlbmQoIHsKCQkJCQl0eXBlOiB0eXBlLAoJCQkJCW9yaWdUeXBlOiBvcmlnVHlwZSwKCQkJCQlkYXRhOiBkYXRhLAoJCQkJCWhhbmRsZXI6IGhhbmRsZXIsCgkJCQkJZ3VpZDogaGFuZGxlci5ndWlkLAoJCQkJCXNlbGVjdG9yOiBzZWxlY3RvciwKCQkJCQluZWVkc0NvbnRleHQ6IHNlbGVjdG9yICYmIGpRdWVyeS5leHByLm1hdGNoLm5lZWRzQ29udGV4dC50ZXN0KCBzZWxlY3RvciApLAoJCQkJCW5hbWVzcGFjZTogbmFtZXNwYWNlcy5qb2luKCAiLiIgKQoJCQkJfSwgaGFuZGxlT2JqSW4gKTsKCgkJCQkvLyBJbml0IHRoZSBldmVudCBoYW5kbGVyIHF1ZXVlIGlmIHdlJ3JlIHRoZSBmaXJzdAoJCQkJaWYgKCAhKCBoYW5kbGVycyA9IGV2ZW50c1sgdHlwZSBdICkgKSB7CgkJCQkJaGFuZGxlcnMgPSBldmVudHNbIHR5cGUgXSA9IFtdOwoJCQkJCWhhbmRsZXJzLmRlbGVnYXRlQ291bnQgPSAwOwoKCQkJCQkvLyBPbmx5IHVzZSBhZGRFdmVudExpc3RlbmVyL2F0dGFjaEV2ZW50IGlmIHRoZSBzcGVjaWFsIGV2ZW50cyBoYW5kbGVyIHJldHVybnMgZmFsc2UKCQkJCQlpZiAoICFzcGVjaWFsLnNldHVwIHx8CgkJCQkJCXNwZWNpYWwuc2V0dXAuY2FsbCggZWxlbSwgZGF0YSwgbmFtZXNwYWNlcywgZXZlbnRIYW5kbGUgKSA9PT0gZmFsc2UgKSB7CgoJCQkJCQkvLyBCaW5kIHRoZSBnbG9iYWwgZXZlbnQgaGFuZGxlciB0byB0aGUgZWxlbWVudAoJCQkJCQlpZiAoIGVsZW0uYWRkRXZlbnRMaXN0ZW5lciApIHsKCQkJCQkJCWVsZW0uYWRkRXZlbnRMaXN0ZW5lciggdHlwZSwgZXZlbnRIYW5kbGUsIGZhbHNlICk7CgoJCQkJCQl9IGVsc2UgaWYgKCBlbGVtLmF0dGFjaEV2ZW50ICkgewoJCQkJCQkJZWxlbS5hdHRhY2hFdmVudCggIm9uIiArIHR5cGUsIGV2ZW50SGFuZGxlICk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgoJCQkJaWYgKCBzcGVjaWFsLmFkZCApIHsKCQkJCQlzcGVjaWFsLmFkZC5jYWxsKCBlbGVtLCBoYW5kbGVPYmogKTsKCgkJCQkJaWYgKCAhaGFuZGxlT2JqLmhhbmRsZXIuZ3VpZCApIHsKCQkJCQkJaGFuZGxlT2JqLmhhbmRsZXIuZ3VpZCA9IGhhbmRsZXIuZ3VpZDsKCQkJCQl9CgkJCQl9CgoJCQkJLy8gQWRkIHRvIHRoZSBlbGVtZW50J3MgaGFuZGxlciBsaXN0LCBkZWxlZ2F0ZXMgaW4gZnJvbnQKCQkJCWlmICggc2VsZWN0b3IgKSB7CgkJCQkJaGFuZGxlcnMuc3BsaWNlKCBoYW5kbGVycy5kZWxlZ2F0ZUNvdW50KyssIDAsIGhhbmRsZU9iaiApOwoJCQkJfSBlbHNlIHsKCQkJCQloYW5kbGVycy5wdXNoKCBoYW5kbGVPYmogKTsKCQkJCX0KCgkJCQkvLyBLZWVwIHRyYWNrIG9mIHdoaWNoIGV2ZW50cyBoYXZlIGV2ZXIgYmVlbiB1c2VkLCBmb3IgZXZlbnQgb3B0aW1pemF0aW9uCgkJCQlqUXVlcnkuZXZlbnQuZ2xvYmFsWyB0eXBlIF0gPSB0cnVlOwoJCQl9CgoJCQkvLyBOdWxsaWZ5IGVsZW0gdG8gcHJldmVudCBtZW1vcnkgbGVha3MgaW4gSUUKCQkJZWxlbSA9IG51bGw7CgkJfSwKCgkJLy8gRGV0YWNoIGFuIGV2ZW50IG9yIHNldCBvZiBldmVudHMgZnJvbSBhbiBlbGVtZW50CgkJcmVtb3ZlOiBmdW5jdGlvbiggZWxlbSwgdHlwZXMsIGhhbmRsZXIsIHNlbGVjdG9yLCBtYXBwZWRUeXBlcyApIHsKCQkJdmFyIGosIGhhbmRsZU9iaiwgdG1wLAoJCQkJb3JpZ0NvdW50LCB0LCBldmVudHMsCgkJCQlzcGVjaWFsLCBoYW5kbGVycywgdHlwZSwKCQkJCW5hbWVzcGFjZXMsIG9yaWdUeXBlLAoJCQkJZWxlbURhdGEgPSBqUXVlcnkuaGFzRGF0YSggZWxlbSApICYmIGpRdWVyeS5fZGF0YSggZWxlbSApOwoKCQkJaWYgKCAhZWxlbURhdGEgfHwgISggZXZlbnRzID0gZWxlbURhdGEuZXZlbnRzICkgKSB7CgkJCQlyZXR1cm47CgkJCX0KCgkJCS8vIE9uY2UgZm9yIGVhY2ggdHlwZS5uYW1lc3BhY2UgaW4gdHlwZXM7IHR5cGUgbWF5IGJlIG9taXR0ZWQKCQkJdHlwZXMgPSAoIHR5cGVzIHx8ICIiICkubWF0Y2goIHJub3R3aGl0ZSApIHx8IFsgIiIgXTsKCQkJdCA9IHR5cGVzLmxlbmd0aDsKCQkJd2hpbGUgKCB0LS0gKSB7CgkJCQl0bXAgPSBydHlwZW5hbWVzcGFjZS5leGVjKCB0eXBlc1sgdCBdICkgfHwgW107CgkJCQl0eXBlID0gb3JpZ1R5cGUgPSB0bXBbIDEgXTsKCQkJCW5hbWVzcGFjZXMgPSAoIHRtcFsgMiBdIHx8ICIiICkuc3BsaXQoICIuIiApLnNvcnQoKTsKCgkJCQkvLyBVbmJpbmQgYWxsIGV2ZW50cyAob24gdGhpcyBuYW1lc3BhY2UsIGlmIHByb3ZpZGVkKSBmb3IgdGhlIGVsZW1lbnQKCQkJCWlmICggIXR5cGUgKSB7CgkJCQkJZm9yICggdHlwZSBpbiBldmVudHMgKSB7CgkJCQkJCWpRdWVyeS5ldmVudC5yZW1vdmUoIGVsZW0sIHR5cGUgKyB0eXBlc1sgdCBdLCBoYW5kbGVyLCBzZWxlY3RvciwgdHJ1ZSApOwoJCQkJCX0KCQkJCQljb250aW51ZTsKCQkJCX0KCgkJCQlzcGVjaWFsID0galF1ZXJ5LmV2ZW50LnNwZWNpYWxbIHR5cGUgXSB8fCB7fTsKCQkJCXR5cGUgPSAoIHNlbGVjdG9yID8gc3BlY2lhbC5kZWxlZ2F0ZVR5cGUgOiBzcGVjaWFsLmJpbmRUeXBlICkgfHwgdHlwZTsKCQkJCWhhbmRsZXJzID0gZXZlbnRzWyB0eXBlIF0gfHwgW107CgkJCQl0bXAgPSB0bXBbIDIgXSAmJgoJCQkJCW5ldyBSZWdFeHAoICIoXnxcXC4pIiArIG5hbWVzcGFjZXMuam9pbiggIlxcLig/Oi4qXFwufCkiICkgKyAiKFxcLnwkKSIgKTsKCgkJCQkvLyBSZW1vdmUgbWF0Y2hpbmcgZXZlbnRzCgkJCQlvcmlnQ291bnQgPSBqID0gaGFuZGxlcnMubGVuZ3RoOwoJCQkJd2hpbGUgKCBqLS0gKSB7CgkJCQkJaGFuZGxlT2JqID0gaGFuZGxlcnNbIGogXTsKCgkJCQkJaWYgKCAoIG1hcHBlZFR5cGVzIHx8IG9yaWdUeXBlID09PSBoYW5kbGVPYmoub3JpZ1R5cGUgKSAmJgoJCQkJCQkoICFoYW5kbGVyIHx8IGhhbmRsZXIuZ3VpZCA9PT0gaGFuZGxlT2JqLmd1aWQgKSAmJgoJCQkJCQkoICF0bXAgfHwgdG1wLnRlc3QoIGhhbmRsZU9iai5uYW1lc3BhY2UgKSApICYmCgkJCQkJCSggIXNlbGVjdG9yIHx8IHNlbGVjdG9yID09PSBoYW5kbGVPYmouc2VsZWN0b3IgfHwKCQkJCQkJCXNlbGVjdG9yID09PSAiKioiICYmIGhhbmRsZU9iai5zZWxlY3RvciApICkgewoJCQkJCQloYW5kbGVycy5zcGxpY2UoIGosIDEgKTsKCgkJCQkJCWlmICggaGFuZGxlT2JqLnNlbGVjdG9yICkgewoJCQkJCQkJaGFuZGxlcnMuZGVsZWdhdGVDb3VudC0tOwoJCQkJCQl9CgkJCQkJCWlmICggc3BlY2lhbC5yZW1vdmUgKSB7CgkJCQkJCQlzcGVjaWFsLnJlbW92ZS5jYWxsKCBlbGVtLCBoYW5kbGVPYmogKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCgkJCQkvLyBSZW1vdmUgZ2VuZXJpYyBldmVudCBoYW5kbGVyIGlmIHdlIHJlbW92ZWQgc29tZXRoaW5nIGFuZCBubyBtb3JlIGhhbmRsZXJzIGV4aXN0CgkJCQkvLyAoYXZvaWRzIHBvdGVudGlhbCBmb3IgZW5kbGVzcyByZWN1cnNpb24gZHVyaW5nIHJlbW92YWwgb2Ygc3BlY2lhbCBldmVudCBoYW5kbGVycykKCQkJCWlmICggb3JpZ0NvdW50ICYmICFoYW5kbGVycy5sZW5ndGggKSB7CgkJCQkJaWYgKCAhc3BlY2lhbC50ZWFyZG93biB8fAoJCQkJCQlzcGVjaWFsLnRlYXJkb3duLmNhbGwoIGVsZW0sIG5hbWVzcGFjZXMsIGVsZW1EYXRhLmhhbmRsZSApID09PSBmYWxzZSApIHsKCgkJCQkJCWpRdWVyeS5yZW1vdmVFdmVudCggZWxlbSwgdHlwZSwgZWxlbURhdGEuaGFuZGxlICk7CgkJCQkJfQoKCQkJCQlkZWxldGUgZXZlbnRzWyB0eXBlIF07CgkJCQl9CgkJCX0KCgkJCS8vIFJlbW92ZSB0aGUgZXhwYW5kbyBpZiBpdCdzIG5vIGxvbmdlciB1c2VkCgkJCWlmICggalF1ZXJ5LmlzRW1wdHlPYmplY3QoIGV2ZW50cyApICkgewoJCQkJZGVsZXRlIGVsZW1EYXRhLmhhbmRsZTsKCgkJCQkvLyByZW1vdmVEYXRhIGFsc28gY2hlY2tzIGZvciBlbXB0aW5lc3MgYW5kIGNsZWFycyB0aGUgZXhwYW5kbyBpZiBlbXB0eQoJCQkJLy8gc28gdXNlIGl0IGluc3RlYWQgb2YgZGVsZXRlCgkJCQlqUXVlcnkuX3JlbW92ZURhdGEoIGVsZW0sICJldmVudHMiICk7CgkJCX0KCQl9LAoKCQl0cmlnZ2VyOiBmdW5jdGlvbiggZXZlbnQsIGRhdGEsIGVsZW0sIG9ubHlIYW5kbGVycyApIHsKCQkJdmFyIGhhbmRsZSwgb250eXBlLCBjdXIsCgkJCQlidWJibGVUeXBlLCBzcGVjaWFsLCB0bXAsIGksCgkJCQlldmVudFBhdGggPSBbIGVsZW0gfHwgZG9jdW1lbnQgXSwKCQkJCXR5cGUgPSBoYXNPd24uY2FsbCggZXZlbnQsICJ0eXBlIiApID8gZXZlbnQudHlwZSA6IGV2ZW50LAoJCQkJbmFtZXNwYWNlcyA9IGhhc093bi5jYWxsKCBldmVudCwgIm5hbWVzcGFjZSIgKSA/IGV2ZW50Lm5hbWVzcGFjZS5zcGxpdCggIi4iICkgOiBbXTsKCgkJCWN1ciA9IHRtcCA9IGVsZW0gPSBlbGVtIHx8IGRvY3VtZW50OwoKCQkJLy8gRG9uJ3QgZG8gZXZlbnRzIG9uIHRleHQgYW5kIGNvbW1lbnQgbm9kZXMKCQkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAzIHx8IGVsZW0ubm9kZVR5cGUgPT09IDggKSB7CgkJCQlyZXR1cm47CgkJCX0KCgkJCS8vIGZvY3VzL2JsdXIgbW9ycGhzIHRvIGZvY3VzaW4vb3V0OyBlbnN1cmUgd2UncmUgbm90IGZpcmluZyB0aGVtIHJpZ2h0IG5vdwoJCQlpZiAoIHJmb2N1c01vcnBoLnRlc3QoIHR5cGUgKyBqUXVlcnkuZXZlbnQudHJpZ2dlcmVkICkgKSB7CgkJCQlyZXR1cm47CgkJCX0KCgkJCWlmICggdHlwZS5pbmRleE9mKCAiLiIgKSA+IC0xICkgewoKCQkJCS8vIE5hbWVzcGFjZWQgdHJpZ2dlcjsgY3JlYXRlIGEgcmVnZXhwIHRvIG1hdGNoIGV2ZW50IHR5cGUgaW4gaGFuZGxlKCkKCQkJCW5hbWVzcGFjZXMgPSB0eXBlLnNwbGl0KCAiLiIgKTsKCQkJCXR5cGUgPSBuYW1lc3BhY2VzLnNoaWZ0KCk7CgkJCQluYW1lc3BhY2VzLnNvcnQoKTsKCQkJfQoJCQlvbnR5cGUgPSB0eXBlLmluZGV4T2YoICI6IiApIDwgMCAmJiAib24iICsgdHlwZTsKCgkJCS8vIENhbGxlciBjYW4gcGFzcyBpbiBhIGpRdWVyeS5FdmVudCBvYmplY3QsIE9iamVjdCwgb3IganVzdCBhbiBldmVudCB0eXBlIHN0cmluZwoJCQlldmVudCA9IGV2ZW50WyBqUXVlcnkuZXhwYW5kbyBdID8KCQkJCWV2ZW50IDoKCQkJCW5ldyBqUXVlcnkuRXZlbnQoIHR5cGUsIHR5cGVvZiBldmVudCA9PT0gIm9iamVjdCIgJiYgZXZlbnQgKTsKCgkJCS8vIFRyaWdnZXIgYml0bWFzazogJiAxIGZvciBuYXRpdmUgaGFuZGxlcnM7ICYgMiBmb3IgalF1ZXJ5IChhbHdheXMgdHJ1ZSkKCQkJZXZlbnQuaXNUcmlnZ2VyID0gb25seUhhbmRsZXJzID8gMiA6IDM7CgkJCWV2ZW50Lm5hbWVzcGFjZSA9IG5hbWVzcGFjZXMuam9pbiggIi4iICk7CgkJCWV2ZW50LnJuYW1lc3BhY2UgPSBldmVudC5uYW1lc3BhY2UgPwoJCQkJbmV3IFJlZ0V4cCggIihefFxcLikiICsgbmFtZXNwYWNlcy5qb2luKCAiXFwuKD86LipcXC58KSIgKSArICIoXFwufCQpIiApIDoKCQkJCW51bGw7CgoJCQkvLyBDbGVhbiB1cCB0aGUgZXZlbnQgaW4gY2FzZSBpdCBpcyBiZWluZyByZXVzZWQKCQkJZXZlbnQucmVzdWx0ID0gdW5kZWZpbmVkOwoJCQlpZiAoICFldmVudC50YXJnZXQgKSB7CgkJCQlldmVudC50YXJnZXQgPSBlbGVtOwoJCQl9CgoJCQkvLyBDbG9uZSBhbnkgaW5jb21pbmcgZGF0YSBhbmQgcHJlcGVuZCB0aGUgZXZlbnQsIGNyZWF0aW5nIHRoZSBoYW5kbGVyIGFyZyBsaXN0CgkJCWRhdGEgPSBkYXRhID09IG51bGwgPwoJCQkJWyBldmVudCBdIDoKCQkJCWpRdWVyeS5tYWtlQXJyYXkoIGRhdGEsIFsgZXZlbnQgXSApOwoKCQkJLy8gQWxsb3cgc3BlY2lhbCBldmVudHMgdG8gZHJhdyBvdXRzaWRlIHRoZSBsaW5lcwoJCQlzcGVjaWFsID0galF1ZXJ5LmV2ZW50LnNwZWNpYWxbIHR5cGUgXSB8fCB7fTsKCQkJaWYgKCAhb25seUhhbmRsZXJzICYmIHNwZWNpYWwudHJpZ2dlciAmJiBzcGVjaWFsLnRyaWdnZXIuYXBwbHkoIGVsZW0sIGRhdGEgKSA9PT0gZmFsc2UgKSB7CgkJCQlyZXR1cm47CgkJCX0KCgkJCS8vIERldGVybWluZSBldmVudCBwcm9wYWdhdGlvbiBwYXRoIGluIGFkdmFuY2UsIHBlciBXM0MgZXZlbnRzIHNwZWMgKCM5OTUxKQoJCQkvLyBCdWJibGUgdXAgdG8gZG9jdW1lbnQsIHRoZW4gdG8gd2luZG93OyB3YXRjaCBmb3IgYSBnbG9iYWwgb3duZXJEb2N1bWVudCB2YXIgKCM5NzI0KQoJCQlpZiAoICFvbmx5SGFuZGxlcnMgJiYgIXNwZWNpYWwubm9CdWJibGUgJiYgIWpRdWVyeS5pc1dpbmRvdyggZWxlbSApICkgewoKCQkJCWJ1YmJsZVR5cGUgPSBzcGVjaWFsLmRlbGVnYXRlVHlwZSB8fCB0eXBlOwoJCQkJaWYgKCAhcmZvY3VzTW9ycGgudGVzdCggYnViYmxlVHlwZSArIHR5cGUgKSApIHsKCQkJCQljdXIgPSBjdXIucGFyZW50Tm9kZTsKCQkJCX0KCQkJCWZvciAoIDsgY3VyOyBjdXIgPSBjdXIucGFyZW50Tm9kZSApIHsKCQkJCQlldmVudFBhdGgucHVzaCggY3VyICk7CgkJCQkJdG1wID0gY3VyOwoJCQkJfQoKCQkJCS8vIE9ubHkgYWRkIHdpbmRvdyBpZiB3ZSBnb3QgdG8gZG9jdW1lbnQgKGUuZy4sIG5vdCBwbGFpbiBvYmogb3IgZGV0YWNoZWQgRE9NKQoJCQkJaWYgKCB0bXAgPT09ICggZWxlbS5vd25lckRvY3VtZW50IHx8IGRvY3VtZW50ICkgKSB7CgkJCQkJZXZlbnRQYXRoLnB1c2goIHRtcC5kZWZhdWx0VmlldyB8fCB0bXAucGFyZW50V2luZG93IHx8IHdpbmRvdyApOwoJCQkJfQoJCQl9CgoJCQkvLyBGaXJlIGhhbmRsZXJzIG9uIHRoZSBldmVudCBwYXRoCgkJCWkgPSAwOwoJCQl3aGlsZSAoICggY3VyID0gZXZlbnRQYXRoWyBpKysgXSApICYmICFldmVudC5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpICkgewoKCQkJCWV2ZW50LnR5cGUgPSBpID4gMSA/CgkJCQkJYnViYmxlVHlwZSA6CgkJCQkJc3BlY2lhbC5iaW5kVHlwZSB8fCB0eXBlOwoKCQkJCS8vIGpRdWVyeSBoYW5kbGVyCgkJCQloYW5kbGUgPSAoIGpRdWVyeS5fZGF0YSggY3VyLCAiZXZlbnRzIiApIHx8IHt9IClbIGV2ZW50LnR5cGUgXSAmJgoJCQkJCWpRdWVyeS5fZGF0YSggY3VyLCAiaGFuZGxlIiApOwoKCQkJCWlmICggaGFuZGxlICkgewoJCQkJCWhhbmRsZS5hcHBseSggY3VyLCBkYXRhICk7CgkJCQl9CgoJCQkJLy8gTmF0aXZlIGhhbmRsZXIKCQkJCWhhbmRsZSA9IG9udHlwZSAmJiBjdXJbIG9udHlwZSBdOwoJCQkJaWYgKCBoYW5kbGUgJiYgaGFuZGxlLmFwcGx5ICYmIGFjY2VwdERhdGEoIGN1ciApICkgewoJCQkJCWV2ZW50LnJlc3VsdCA9IGhhbmRsZS5hcHBseSggY3VyLCBkYXRhICk7CgkJCQkJaWYgKCBldmVudC5yZXN1bHQgPT09IGZhbHNlICkgewoJCQkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQlldmVudC50eXBlID0gdHlwZTsKCgkJCS8vIElmIG5vYm9keSBwcmV2ZW50ZWQgdGhlIGRlZmF1bHQgYWN0aW9uLCBkbyBpdCBub3cKCQkJaWYgKCAhb25seUhhbmRsZXJzICYmICFldmVudC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSApIHsKCgkJCQlpZiAoCgkJCQkJKCAhc3BlY2lhbC5fZGVmYXVsdCB8fAoJCQkJCSBzcGVjaWFsLl9kZWZhdWx0LmFwcGx5KCBldmVudFBhdGgucG9wKCksIGRhdGEgKSA9PT0gZmFsc2UKCQkJCQkpICYmIGFjY2VwdERhdGEoIGVsZW0gKQoJCQkJKSB7CgoJCQkJCS8vIENhbGwgYSBuYXRpdmUgRE9NIG1ldGhvZCBvbiB0aGUgdGFyZ2V0IHdpdGggdGhlIHNhbWUgbmFtZSBuYW1lIGFzIHRoZSBldmVudC4KCQkJCQkvLyBDYW4ndCB1c2UgYW4gLmlzRnVuY3Rpb24oKSBjaGVjayBoZXJlIGJlY2F1c2UgSUU2LzcgZmFpbHMgdGhhdCB0ZXN0LgoJCQkJCS8vIERvbid0IGRvIGRlZmF1bHQgYWN0aW9ucyBvbiB3aW5kb3csIHRoYXQncyB3aGVyZSBnbG9iYWwgdmFyaWFibGVzIGJlICgjNjE3MCkKCQkJCQlpZiAoIG9udHlwZSAmJiBlbGVtWyB0eXBlIF0gJiYgIWpRdWVyeS5pc1dpbmRvdyggZWxlbSApICkgewoKCQkJCQkJLy8gRG9uJ3QgcmUtdHJpZ2dlciBhbiBvbkZPTyBldmVudCB3aGVuIHdlIGNhbGwgaXRzIEZPTygpIG1ldGhvZAoJCQkJCQl0bXAgPSBlbGVtWyBvbnR5cGUgXTsKCgkJCQkJCWlmICggdG1wICkgewoJCQkJCQkJZWxlbVsgb250eXBlIF0gPSBudWxsOwoJCQkJCQl9CgoJCQkJCQkvLyBQcmV2ZW50IHJlLXRyaWdnZXJpbmcgb2YgdGhlIHNhbWUgZXZlbnQsIHNpbmNlIHdlIGFscmVhZHkgYnViYmxlZCBpdCBhYm92ZQoJCQkJCQlqUXVlcnkuZXZlbnQudHJpZ2dlcmVkID0gdHlwZTsKCQkJCQkJdHJ5IHsKCQkJCQkJCWVsZW1bIHR5cGUgXSgpOwoJCQkJCQl9IGNhdGNoICggZSApIHsKCgkJCQkJCQkvLyBJRTw5IGRpZXMgb24gZm9jdXMvYmx1ciB0byBoaWRkZW4gZWxlbWVudCAoIzE0ODYsIzEyNTE4KQoJCQkJCQkJLy8gb25seSByZXByb2R1Y2libGUgb24gd2luWFAgSUU4IG5hdGl2ZSwgbm90IElFOSBpbiBJRTggbW9kZQoJCQkJCQl9CgkJCQkJCWpRdWVyeS5ldmVudC50cmlnZ2VyZWQgPSB1bmRlZmluZWQ7CgoJCQkJCQlpZiAoIHRtcCApIHsKCQkJCQkJCWVsZW1bIG9udHlwZSBdID0gdG1wOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgoJCQlyZXR1cm4gZXZlbnQucmVzdWx0OwoJCX0sCgoJCWRpc3BhdGNoOiBmdW5jdGlvbiggZXZlbnQgKSB7CgoJCQkvLyBNYWtlIGEgd3JpdGFibGUgalF1ZXJ5LkV2ZW50IGZyb20gdGhlIG5hdGl2ZSBldmVudCBvYmplY3QKCQkJZXZlbnQgPSBqUXVlcnkuZXZlbnQuZml4KCBldmVudCApOwoKCQkJdmFyIGksIGosIHJldCwgbWF0Y2hlZCwgaGFuZGxlT2JqLAoJCQkJaGFuZGxlclF1ZXVlID0gW10sCgkJCQlhcmdzID0gc2xpY2UuY2FsbCggYXJndW1lbnRzICksCgkJCQloYW5kbGVycyA9ICggalF1ZXJ5Ll9kYXRhKCB0aGlzLCAiZXZlbnRzIiApIHx8IHt9IClbIGV2ZW50LnR5cGUgXSB8fCBbXSwKCQkJCXNwZWNpYWwgPSBqUXVlcnkuZXZlbnQuc3BlY2lhbFsgZXZlbnQudHlwZSBdIHx8IHt9OwoKCQkJLy8gVXNlIHRoZSBmaXgtZWQgalF1ZXJ5LkV2ZW50IHJhdGhlciB0aGFuIHRoZSAocmVhZC1vbmx5KSBuYXRpdmUgZXZlbnQKCQkJYXJnc1sgMCBdID0gZXZlbnQ7CgkJCWV2ZW50LmRlbGVnYXRlVGFyZ2V0ID0gdGhpczsKCgkJCS8vIENhbGwgdGhlIHByZURpc3BhdGNoIGhvb2sgZm9yIHRoZSBtYXBwZWQgdHlwZSwgYW5kIGxldCBpdCBiYWlsIGlmIGRlc2lyZWQKCQkJaWYgKCBzcGVjaWFsLnByZURpc3BhdGNoICYmIHNwZWNpYWwucHJlRGlzcGF0Y2guY2FsbCggdGhpcywgZXZlbnQgKSA9PT0gZmFsc2UgKSB7CgkJCQlyZXR1cm47CgkJCX0KCgkJCS8vIERldGVybWluZSBoYW5kbGVycwoJCQloYW5kbGVyUXVldWUgPSBqUXVlcnkuZXZlbnQuaGFuZGxlcnMuY2FsbCggdGhpcywgZXZlbnQsIGhhbmRsZXJzICk7CgoJCQkvLyBSdW4gZGVsZWdhdGVzIGZpcnN0OyB0aGV5IG1heSB3YW50IHRvIHN0b3AgcHJvcGFnYXRpb24gYmVuZWF0aCB1cwoJCQlpID0gMDsKCQkJd2hpbGUgKCAoIG1hdGNoZWQgPSBoYW5kbGVyUXVldWVbIGkrKyBdICkgJiYgIWV2ZW50LmlzUHJvcGFnYXRpb25TdG9wcGVkKCkgKSB7CgkJCQlldmVudC5jdXJyZW50VGFyZ2V0ID0gbWF0Y2hlZC5lbGVtOwoKCQkJCWogPSAwOwoJCQkJd2hpbGUgKCAoIGhhbmRsZU9iaiA9IG1hdGNoZWQuaGFuZGxlcnNbIGorKyBdICkgJiYKCQkJCQkhZXZlbnQuaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQoKSApIHsKCgkJCQkJLy8gVHJpZ2dlcmVkIGV2ZW50IG11c3QgZWl0aGVyIDEpIGhhdmUgbm8gbmFtZXNwYWNlLCBvciAyKSBoYXZlIG5hbWVzcGFjZShzKQoJCQkJCS8vIGEgc3Vic2V0IG9yIGVxdWFsIHRvIHRob3NlIGluIHRoZSBib3VuZCBldmVudCAoYm90aCBjYW4gaGF2ZSBubyBuYW1lc3BhY2UpLgoJCQkJCWlmICggIWV2ZW50LnJuYW1lc3BhY2UgfHwgZXZlbnQucm5hbWVzcGFjZS50ZXN0KCBoYW5kbGVPYmoubmFtZXNwYWNlICkgKSB7CgoJCQkJCQlldmVudC5oYW5kbGVPYmogPSBoYW5kbGVPYmo7CgkJCQkJCWV2ZW50LmRhdGEgPSBoYW5kbGVPYmouZGF0YTsKCgkJCQkJCXJldCA9ICggKCBqUXVlcnkuZXZlbnQuc3BlY2lhbFsgaGFuZGxlT2JqLm9yaWdUeXBlIF0gfHwge30gKS5oYW5kbGUgfHwKCQkJCQkJCWhhbmRsZU9iai5oYW5kbGVyICkuYXBwbHkoIG1hdGNoZWQuZWxlbSwgYXJncyApOwoKCQkJCQkJaWYgKCByZXQgIT09IHVuZGVmaW5lZCApIHsKCQkJCQkJCWlmICggKCBldmVudC5yZXN1bHQgPSByZXQgKSA9PT0gZmFsc2UgKSB7CgkJCQkJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQkJCQkJCQlldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoKCQkJLy8gQ2FsbCB0aGUgcG9zdERpc3BhdGNoIGhvb2sgZm9yIHRoZSBtYXBwZWQgdHlwZQoJCQlpZiAoIHNwZWNpYWwucG9zdERpc3BhdGNoICkgewoJCQkJc3BlY2lhbC5wb3N0RGlzcGF0Y2guY2FsbCggdGhpcywgZXZlbnQgKTsKCQkJfQoKCQkJcmV0dXJuIGV2ZW50LnJlc3VsdDsKCQl9LAoKCQloYW5kbGVyczogZnVuY3Rpb24oIGV2ZW50LCBoYW5kbGVycyApIHsKCQkJdmFyIGksIG1hdGNoZXMsIHNlbCwgaGFuZGxlT2JqLAoJCQkJaGFuZGxlclF1ZXVlID0gW10sCgkJCQlkZWxlZ2F0ZUNvdW50ID0gaGFuZGxlcnMuZGVsZWdhdGVDb3VudCwKCQkJCWN1ciA9IGV2ZW50LnRhcmdldDsKCgkJCS8vIFN1cHBvcnQgKGF0IGxlYXN0KTogQ2hyb21lLCBJRTkKCQkJLy8gRmluZCBkZWxlZ2F0ZSBoYW5kbGVycwoJCQkvLyBCbGFjay1ob2xlIFNWRyA8dXNlPiBpbnN0YW5jZSB0cmVlcyAoIzEzMTgwKQoJCQkvLwoJCQkvLyBTdXBwb3J0OiBGaXJlZm94PD00MisKCQkJLy8gQXZvaWQgbm9uLWxlZnQtY2xpY2sgaW4gRkYgYnV0IGRvbid0IGJsb2NrIElFIHJhZGlvIGV2ZW50cyAoIzM4NjEsIGdoLTIzNDMpCgkJCWlmICggZGVsZWdhdGVDb3VudCAmJiBjdXIubm9kZVR5cGUgJiYKCQkJCSggZXZlbnQudHlwZSAhPT0gImNsaWNrIiB8fCBpc05hTiggZXZlbnQuYnV0dG9uICkgfHwgZXZlbnQuYnV0dG9uIDwgMSApICkgewoKCQkJCS8qIGpzaGludCBlcWVxZXE6IGZhbHNlICovCgkJCQlmb3IgKCA7IGN1ciAhPSB0aGlzOyBjdXIgPSBjdXIucGFyZW50Tm9kZSB8fCB0aGlzICkgewoJCQkJCS8qIGpzaGludCBlcWVxZXE6IHRydWUgKi8KCgkJCQkJLy8gRG9uJ3QgY2hlY2sgbm9uLWVsZW1lbnRzICgjMTMyMDgpCgkJCQkJLy8gRG9uJ3QgcHJvY2VzcyBjbGlja3Mgb24gZGlzYWJsZWQgZWxlbWVudHMgKCM2OTExLCAjODE2NSwgIzExMzgyLCAjMTE3NjQpCgkJCQkJaWYgKCBjdXIubm9kZVR5cGUgPT09IDEgJiYgKCBjdXIuZGlzYWJsZWQgIT09IHRydWUgfHwgZXZlbnQudHlwZSAhPT0gImNsaWNrIiApICkgewoJCQkJCQltYXRjaGVzID0gW107CgkJCQkJCWZvciAoIGkgPSAwOyBpIDwgZGVsZWdhdGVDb3VudDsgaSsrICkgewoJCQkJCQkJaGFuZGxlT2JqID0gaGFuZGxlcnNbIGkgXTsKCgkJCQkJCQkvLyBEb24ndCBjb25mbGljdCB3aXRoIE9iamVjdC5wcm90b3R5cGUgcHJvcGVydGllcyAoIzEzMjAzKQoJCQkJCQkJc2VsID0gaGFuZGxlT2JqLnNlbGVjdG9yICsgIiAiOwoKCQkJCQkJCWlmICggbWF0Y2hlc1sgc2VsIF0gPT09IHVuZGVmaW5lZCApIHsKCQkJCQkJCQltYXRjaGVzWyBzZWwgXSA9IGhhbmRsZU9iai5uZWVkc0NvbnRleHQgPwoJCQkJCQkJCQlqUXVlcnkoIHNlbCwgdGhpcyApLmluZGV4KCBjdXIgKSA+IC0xIDoKCQkJCQkJCQkJalF1ZXJ5LmZpbmQoIHNlbCwgdGhpcywgbnVsbCwgWyBjdXIgXSApLmxlbmd0aDsKCQkJCQkJCX0KCQkJCQkJCWlmICggbWF0Y2hlc1sgc2VsIF0gKSB7CgkJCQkJCQkJbWF0Y2hlcy5wdXNoKCBoYW5kbGVPYmogKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQlpZiAoIG1hdGNoZXMubGVuZ3RoICkgewoJCQkJCQkJaGFuZGxlclF1ZXVlLnB1c2goIHsgZWxlbTogY3VyLCBoYW5kbGVyczogbWF0Y2hlcyB9ICk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCgkJCS8vIEFkZCB0aGUgcmVtYWluaW5nIChkaXJlY3RseS1ib3VuZCkgaGFuZGxlcnMKCQkJaWYgKCBkZWxlZ2F0ZUNvdW50IDwgaGFuZGxlcnMubGVuZ3RoICkgewoJCQkJaGFuZGxlclF1ZXVlLnB1c2goIHsgZWxlbTogdGhpcywgaGFuZGxlcnM6IGhhbmRsZXJzLnNsaWNlKCBkZWxlZ2F0ZUNvdW50ICkgfSApOwoJCQl9CgoJCQlyZXR1cm4gaGFuZGxlclF1ZXVlOwoJCX0sCgoJCWZpeDogZnVuY3Rpb24oIGV2ZW50ICkgewoJCQlpZiAoIGV2ZW50WyBqUXVlcnkuZXhwYW5kbyBdICkgewoJCQkJcmV0dXJuIGV2ZW50OwoJCQl9CgoJCQkvLyBDcmVhdGUgYSB3cml0YWJsZSBjb3B5IG9mIHRoZSBldmVudCBvYmplY3QgYW5kIG5vcm1hbGl6ZSBzb21lIHByb3BlcnRpZXMKCQkJdmFyIGksIHByb3AsIGNvcHksCgkJCQl0eXBlID0gZXZlbnQudHlwZSwKCQkJCW9yaWdpbmFsRXZlbnQgPSBldmVudCwKCQkJCWZpeEhvb2sgPSB0aGlzLmZpeEhvb2tzWyB0eXBlIF07CgoJCQlpZiAoICFmaXhIb29rICkgewoJCQkJdGhpcy5maXhIb29rc1sgdHlwZSBdID0gZml4SG9vayA9CgkJCQkJcm1vdXNlRXZlbnQudGVzdCggdHlwZSApID8gdGhpcy5tb3VzZUhvb2tzIDoKCQkJCQlya2V5RXZlbnQudGVzdCggdHlwZSApID8gdGhpcy5rZXlIb29rcyA6CgkJCQkJe307CgkJCX0KCQkJY29weSA9IGZpeEhvb2sucHJvcHMgPyB0aGlzLnByb3BzLmNvbmNhdCggZml4SG9vay5wcm9wcyApIDogdGhpcy5wcm9wczsKCgkJCWV2ZW50ID0gbmV3IGpRdWVyeS5FdmVudCggb3JpZ2luYWxFdmVudCApOwoKCQkJaSA9IGNvcHkubGVuZ3RoOwoJCQl3aGlsZSAoIGktLSApIHsKCQkJCXByb3AgPSBjb3B5WyBpIF07CgkJCQlldmVudFsgcHJvcCBdID0gb3JpZ2luYWxFdmVudFsgcHJvcCBdOwoJCQl9CgoJCQkvLyBTdXBwb3J0OiBJRTw5CgkJCS8vIEZpeCB0YXJnZXQgcHJvcGVydHkgKCMxOTI1KQoJCQlpZiAoICFldmVudC50YXJnZXQgKSB7CgkJCQlldmVudC50YXJnZXQgPSBvcmlnaW5hbEV2ZW50LnNyY0VsZW1lbnQgfHwgZG9jdW1lbnQ7CgkJCX0KCgkJCS8vIFN1cHBvcnQ6IFNhZmFyaSA2LTgrCgkJCS8vIFRhcmdldCBzaG91bGQgbm90IGJlIGEgdGV4dCBub2RlICgjNTA0LCAjMTMxNDMpCgkJCWlmICggZXZlbnQudGFyZ2V0Lm5vZGVUeXBlID09PSAzICkgewoJCQkJZXZlbnQudGFyZ2V0ID0gZXZlbnQudGFyZ2V0LnBhcmVudE5vZGU7CgkJCX0KCgkJCS8vIFN1cHBvcnQ6IElFPDkKCQkJLy8gRm9yIG1vdXNlL2tleSBldmVudHMsIG1ldGFLZXk9PWZhbHNlIGlmIGl0J3MgdW5kZWZpbmVkICgjMzM2OCwgIzExMzI4KQoJCQlldmVudC5tZXRhS2V5ID0gISFldmVudC5tZXRhS2V5OwoKCQkJcmV0dXJuIGZpeEhvb2suZmlsdGVyID8gZml4SG9vay5maWx0ZXIoIGV2ZW50LCBvcmlnaW5hbEV2ZW50ICkgOiBldmVudDsKCQl9LAoKCQkvLyBJbmNsdWRlcyBzb21lIGV2ZW50IHByb3BzIHNoYXJlZCBieSBLZXlFdmVudCBhbmQgTW91c2VFdmVudAoJCXByb3BzOiAoICJhbHRLZXkgYnViYmxlcyBjYW5jZWxhYmxlIGN0cmxLZXkgY3VycmVudFRhcmdldCBkZXRhaWwgZXZlbnRQaGFzZSAiICsKCQkJIm1ldGFLZXkgcmVsYXRlZFRhcmdldCBzaGlmdEtleSB0YXJnZXQgdGltZVN0YW1wIHZpZXcgd2hpY2giICkuc3BsaXQoICIgIiApLAoKCQlmaXhIb29rczoge30sCgoJCWtleUhvb2tzOiB7CgkJCXByb3BzOiAiY2hhciBjaGFyQ29kZSBrZXkga2V5Q29kZSIuc3BsaXQoICIgIiApLAoJCQlmaWx0ZXI6IGZ1bmN0aW9uKCBldmVudCwgb3JpZ2luYWwgKSB7CgoJCQkJLy8gQWRkIHdoaWNoIGZvciBrZXkgZXZlbnRzCgkJCQlpZiAoIGV2ZW50LndoaWNoID09IG51bGwgKSB7CgkJCQkJZXZlbnQud2hpY2ggPSBvcmlnaW5hbC5jaGFyQ29kZSAhPSBudWxsID8gb3JpZ2luYWwuY2hhckNvZGUgOiBvcmlnaW5hbC5rZXlDb2RlOwoJCQkJfQoKCQkJCXJldHVybiBldmVudDsKCQkJfQoJCX0sCgoJCW1vdXNlSG9va3M6IHsKCQkJcHJvcHM6ICggImJ1dHRvbiBidXR0b25zIGNsaWVudFggY2xpZW50WSBmcm9tRWxlbWVudCBvZmZzZXRYIG9mZnNldFkgIiArCgkJCQkicGFnZVggcGFnZVkgc2NyZWVuWCBzY3JlZW5ZIHRvRWxlbWVudCIgKS5zcGxpdCggIiAiICksCgkJCWZpbHRlcjogZnVuY3Rpb24oIGV2ZW50LCBvcmlnaW5hbCApIHsKCQkJCXZhciBib2R5LCBldmVudERvYywgZG9jLAoJCQkJCWJ1dHRvbiA9IG9yaWdpbmFsLmJ1dHRvbiwKCQkJCQlmcm9tRWxlbWVudCA9IG9yaWdpbmFsLmZyb21FbGVtZW50OwoKCQkJCS8vIENhbGN1bGF0ZSBwYWdlWC9ZIGlmIG1pc3NpbmcgYW5kIGNsaWVudFgvWSBhdmFpbGFibGUKCQkJCWlmICggZXZlbnQucGFnZVggPT0gbnVsbCAmJiBvcmlnaW5hbC5jbGllbnRYICE9IG51bGwgKSB7CgkJCQkJZXZlbnREb2MgPSBldmVudC50YXJnZXQub3duZXJEb2N1bWVudCB8fCBkb2N1bWVudDsKCQkJCQlkb2MgPSBldmVudERvYy5kb2N1bWVudEVsZW1lbnQ7CgkJCQkJYm9keSA9IGV2ZW50RG9jLmJvZHk7CgoJCQkJCWV2ZW50LnBhZ2VYID0gb3JpZ2luYWwuY2xpZW50WCArCgkJCQkJCSggZG9jICYmIGRvYy5zY3JvbGxMZWZ0IHx8IGJvZHkgJiYgYm9keS5zY3JvbGxMZWZ0IHx8IDAgKSAtCgkJCQkJCSggZG9jICYmIGRvYy5jbGllbnRMZWZ0IHx8IGJvZHkgJiYgYm9keS5jbGllbnRMZWZ0IHx8IDAgKTsKCQkJCQlldmVudC5wYWdlWSA9IG9yaWdpbmFsLmNsaWVudFkgKwoJCQkJCQkoIGRvYyAmJiBkb2Muc2Nyb2xsVG9wICB8fCBib2R5ICYmIGJvZHkuc2Nyb2xsVG9wICB8fCAwICkgLQoJCQkJCQkoIGRvYyAmJiBkb2MuY2xpZW50VG9wICB8fCBib2R5ICYmIGJvZHkuY2xpZW50VG9wICB8fCAwICk7CgkJCQl9CgoJCQkJLy8gQWRkIHJlbGF0ZWRUYXJnZXQsIGlmIG5lY2Vzc2FyeQoJCQkJaWYgKCAhZXZlbnQucmVsYXRlZFRhcmdldCAmJiBmcm9tRWxlbWVudCApIHsKCQkJCQlldmVudC5yZWxhdGVkVGFyZ2V0ID0gZnJvbUVsZW1lbnQgPT09IGV2ZW50LnRhcmdldCA/CgkJCQkJCW9yaWdpbmFsLnRvRWxlbWVudCA6CgkJCQkJCWZyb21FbGVtZW50OwoJCQkJfQoKCQkJCS8vIEFkZCB3aGljaCBmb3IgY2xpY2s6IDEgPT09IGxlZnQ7IDIgPT09IG1pZGRsZTsgMyA9PT0gcmlnaHQKCQkJCS8vIE5vdGU6IGJ1dHRvbiBpcyBub3Qgbm9ybWFsaXplZCwgc28gZG9uJ3QgdXNlIGl0CgkJCQlpZiAoICFldmVudC53aGljaCAmJiBidXR0b24gIT09IHVuZGVmaW5lZCApIHsKCQkJCQlldmVudC53aGljaCA9ICggYnV0dG9uICYgMSA/IDEgOiAoIGJ1dHRvbiAmIDIgPyAzIDogKCBidXR0b24gJiA0ID8gMiA6IDAgKSApICk7CgkJCQl9CgoJCQkJcmV0dXJuIGV2ZW50OwoJCQl9CgkJfSwKCgkJc3BlY2lhbDogewoJCQlsb2FkOiB7CgoJCQkJLy8gUHJldmVudCB0cmlnZ2VyZWQgaW1hZ2UubG9hZCBldmVudHMgZnJvbSBidWJibGluZyB0byB3aW5kb3cubG9hZAoJCQkJbm9CdWJibGU6IHRydWUKCQkJfSwKCQkJZm9jdXM6IHsKCgkJCQkvLyBGaXJlIG5hdGl2ZSBldmVudCBpZiBwb3NzaWJsZSBzbyBibHVyL2ZvY3VzIHNlcXVlbmNlIGlzIGNvcnJlY3QKCQkJCXRyaWdnZXI6IGZ1bmN0aW9uKCkgewoJCQkJCWlmICggdGhpcyAhPT0gc2FmZUFjdGl2ZUVsZW1lbnQoKSAmJiB0aGlzLmZvY3VzICkgewoJCQkJCQl0cnkgewoJCQkJCQkJdGhpcy5mb2N1cygpOwoJCQkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCQl9IGNhdGNoICggZSApIHsKCgkJCQkJCQkvLyBTdXBwb3J0OiBJRTw5CgkJCQkJCQkvLyBJZiB3ZSBlcnJvciBvbiBmb2N1cyB0byBoaWRkZW4gZWxlbWVudCAoIzE0ODYsICMxMjUxOCksCgkJCQkJCQkvLyBsZXQgLnRyaWdnZXIoKSBydW4gdGhlIGhhbmRsZXJzCgkJCQkJCX0KCQkJCQl9CgkJCQl9LAoJCQkJZGVsZWdhdGVUeXBlOiAiZm9jdXNpbiIKCQkJfSwKCQkJYmx1cjogewoJCQkJdHJpZ2dlcjogZnVuY3Rpb24oKSB7CgkJCQkJaWYgKCB0aGlzID09PSBzYWZlQWN0aXZlRWxlbWVudCgpICYmIHRoaXMuYmx1ciApIHsKCQkJCQkJdGhpcy5ibHVyKCk7CgkJCQkJCXJldHVybiBmYWxzZTsKCQkJCQl9CgkJCQl9LAoJCQkJZGVsZWdhdGVUeXBlOiAiZm9jdXNvdXQiCgkJCX0sCgkJCWNsaWNrOiB7CgoJCQkJLy8gRm9yIGNoZWNrYm94LCBmaXJlIG5hdGl2ZSBldmVudCBzbyBjaGVja2VkIHN0YXRlIHdpbGwgYmUgcmlnaHQKCQkJCXRyaWdnZXI6IGZ1bmN0aW9uKCkgewoJCQkJCWlmICggalF1ZXJ5Lm5vZGVOYW1lKCB0aGlzLCAiaW5wdXQiICkgJiYgdGhpcy50eXBlID09PSAiY2hlY2tib3giICYmIHRoaXMuY2xpY2sgKSB7CgkJCQkJCXRoaXMuY2xpY2soKTsKCQkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCX0KCQkJCX0sCgoJCQkJLy8gRm9yIGNyb3NzLWJyb3dzZXIgY29uc2lzdGVuY3ksIGRvbid0IGZpcmUgbmF0aXZlIC5jbGljaygpIG9uIGxpbmtzCgkJCQlfZGVmYXVsdDogZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJCXJldHVybiBqUXVlcnkubm9kZU5hbWUoIGV2ZW50LnRhcmdldCwgImEiICk7CgkJCQl9CgkJCX0sCgoJCQliZWZvcmV1bmxvYWQ6IHsKCQkJCXBvc3REaXNwYXRjaDogZnVuY3Rpb24oIGV2ZW50ICkgewoKCQkJCQkvLyBTdXBwb3J0OiBGaXJlZm94IDIwKwoJCQkJCS8vIEZpcmVmb3ggZG9lc24ndCBhbGVydCBpZiB0aGUgcmV0dXJuVmFsdWUgZmllbGQgaXMgbm90IHNldC4KCQkJCQlpZiAoIGV2ZW50LnJlc3VsdCAhPT0gdW5kZWZpbmVkICYmIGV2ZW50Lm9yaWdpbmFsRXZlbnQgKSB7CgkJCQkJCWV2ZW50Lm9yaWdpbmFsRXZlbnQucmV0dXJuVmFsdWUgPSBldmVudC5yZXN1bHQ7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfSwKCgkJLy8gUGlnZ3liYWNrIG9uIGEgZG9ub3IgZXZlbnQgdG8gc2ltdWxhdGUgYSBkaWZmZXJlbnQgb25lCgkJc2ltdWxhdGU6IGZ1bmN0aW9uKCB0eXBlLCBlbGVtLCBldmVudCApIHsKCQkJdmFyIGUgPSBqUXVlcnkuZXh0ZW5kKAoJCQkJbmV3IGpRdWVyeS5FdmVudCgpLAoJCQkJZXZlbnQsCgkJCQl7CgkJCQkJdHlwZTogdHlwZSwKCQkJCQlpc1NpbXVsYXRlZDogdHJ1ZQoKCQkJCQkvLyBQcmV2aW91c2x5LCBgb3JpZ2luYWxFdmVudDoge31gIHdhcyBzZXQgaGVyZSwgc28gc3RvcFByb3BhZ2F0aW9uIGNhbGwKCQkJCQkvLyB3b3VsZCBub3QgYmUgdHJpZ2dlcmVkIG9uIGRvbm9yIGV2ZW50LCBzaW5jZSBpbiBvdXIgb3duCgkJCQkJLy8galF1ZXJ5LmV2ZW50LnN0b3BQcm9wYWdhdGlvbiBmdW5jdGlvbiB3ZSBoYWQgYSBjaGVjayBmb3IgZXhpc3RlbmNlIG9mCgkJCQkJLy8gb3JpZ2luYWxFdmVudC5zdG9wUHJvcGFnYXRpb24gbWV0aG9kLCBzbywgY29uc2VxdWVudGx5IGl0IHdvdWxkIGJlIGEgbm9vcC4KCQkJCQkvLwoJCQkJCS8vIEd1YXJkIGZvciBzaW11bGF0ZWQgZXZlbnRzIHdhcyBtb3ZlZCB0byBqUXVlcnkuZXZlbnQuc3RvcFByb3BhZ2F0aW9uIGZ1bmN0aW9uCgkJCQkJLy8gc2luY2UgYG9yaWdpbmFsRXZlbnRgIHNob3VsZCBwb2ludCB0byB0aGUgb3JpZ2luYWwgZXZlbnQgZm9yIHRoZQoJCQkJCS8vIGNvbnN0YW5jeSB3aXRoIG90aGVyIGV2ZW50cyBhbmQgZm9yIG1vcmUgZm9jdXNlZCBsb2dpYwoJCQkJfQoJCQkpOwoKCQkJalF1ZXJ5LmV2ZW50LnRyaWdnZXIoIGUsIG51bGwsIGVsZW0gKTsKCgkJCWlmICggZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSApIHsKCQkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgkJCX0KCQl9Cgl9OwoKCWpRdWVyeS5yZW1vdmVFdmVudCA9IGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIgPwoJCWZ1bmN0aW9uKCBlbGVtLCB0eXBlLCBoYW5kbGUgKSB7CgoJCQkvLyBUaGlzICJpZiIgaXMgbmVlZGVkIGZvciBwbGFpbiBvYmplY3RzCgkJCWlmICggZWxlbS5yZW1vdmVFdmVudExpc3RlbmVyICkgewoJCQkJZWxlbS5yZW1vdmVFdmVudExpc3RlbmVyKCB0eXBlLCBoYW5kbGUgKTsKCQkJfQoJCX0gOgoJCWZ1bmN0aW9uKCBlbGVtLCB0eXBlLCBoYW5kbGUgKSB7CgkJCXZhciBuYW1lID0gIm9uIiArIHR5cGU7CgoJCQlpZiAoIGVsZW0uZGV0YWNoRXZlbnQgKSB7CgoJCQkJLy8gIzg1NDUsICM3MDU0LCBwcmV2ZW50aW5nIG1lbW9yeSBsZWFrcyBmb3IgY3VzdG9tIGV2ZW50cyBpbiBJRTYtOAoJCQkJLy8gZGV0YWNoRXZlbnQgbmVlZGVkIHByb3BlcnR5IG9uIGVsZW1lbnQsIGJ5IG5hbWUgb2YgdGhhdCBldmVudCwKCQkJCS8vIHRvIHByb3Blcmx5IGV4cG9zZSBpdCB0byBHQwoJCQkJaWYgKCB0eXBlb2YgZWxlbVsgbmFtZSBdID09PSAidW5kZWZpbmVkIiApIHsKCQkJCQllbGVtWyBuYW1lIF0gPSBudWxsOwoJCQkJfQoKCQkJCWVsZW0uZGV0YWNoRXZlbnQoIG5hbWUsIGhhbmRsZSApOwoJCQl9CgkJfTsKCglqUXVlcnkuRXZlbnQgPSBmdW5jdGlvbiggc3JjLCBwcm9wcyApIHsKCgkJLy8gQWxsb3cgaW5zdGFudGlhdGlvbiB3aXRob3V0IHRoZSAnbmV3JyBrZXl3b3JkCgkJaWYgKCAhKCB0aGlzIGluc3RhbmNlb2YgalF1ZXJ5LkV2ZW50ICkgKSB7CgkJCXJldHVybiBuZXcgalF1ZXJ5LkV2ZW50KCBzcmMsIHByb3BzICk7CgkJfQoKCQkvLyBFdmVudCBvYmplY3QKCQlpZiAoIHNyYyAmJiBzcmMudHlwZSApIHsKCQkJdGhpcy5vcmlnaW5hbEV2ZW50ID0gc3JjOwoJCQl0aGlzLnR5cGUgPSBzcmMudHlwZTsKCgkJCS8vIEV2ZW50cyBidWJibGluZyB1cCB0aGUgZG9jdW1lbnQgbWF5IGhhdmUgYmVlbiBtYXJrZWQgYXMgcHJldmVudGVkCgkJCS8vIGJ5IGEgaGFuZGxlciBsb3dlciBkb3duIHRoZSB0cmVlOyByZWZsZWN0IHRoZSBjb3JyZWN0IHZhbHVlLgoJCQl0aGlzLmlzRGVmYXVsdFByZXZlbnRlZCA9IHNyYy5kZWZhdWx0UHJldmVudGVkIHx8CgkJCQkJc3JjLmRlZmF1bHRQcmV2ZW50ZWQgPT09IHVuZGVmaW5lZCAmJgoKCQkJCQkvLyBTdXBwb3J0OiBJRSA8IDksIEFuZHJvaWQgPCA0LjAKCQkJCQlzcmMucmV0dXJuVmFsdWUgPT09IGZhbHNlID8KCQkJCXJldHVyblRydWUgOgoJCQkJcmV0dXJuRmFsc2U7CgoJCS8vIEV2ZW50IHR5cGUKCQl9IGVsc2UgewoJCQl0aGlzLnR5cGUgPSBzcmM7CgkJfQoKCQkvLyBQdXQgZXhwbGljaXRseSBwcm92aWRlZCBwcm9wZXJ0aWVzIG9udG8gdGhlIGV2ZW50IG9iamVjdAoJCWlmICggcHJvcHMgKSB7CgkJCWpRdWVyeS5leHRlbmQoIHRoaXMsIHByb3BzICk7CgkJfQoKCQkvLyBDcmVhdGUgYSB0aW1lc3RhbXAgaWYgaW5jb21pbmcgZXZlbnQgZG9lc24ndCBoYXZlIG9uZQoJCXRoaXMudGltZVN0YW1wID0gc3JjICYmIHNyYy50aW1lU3RhbXAgfHwgalF1ZXJ5Lm5vdygpOwoKCQkvLyBNYXJrIGl0IGFzIGZpeGVkCgkJdGhpc1sgalF1ZXJ5LmV4cGFuZG8gXSA9IHRydWU7Cgl9OwoKCS8vIGpRdWVyeS5FdmVudCBpcyBiYXNlZCBvbiBET00zIEV2ZW50cyBhcyBzcGVjaWZpZWQgYnkgdGhlIEVDTUFTY3JpcHQgTGFuZ3VhZ2UgQmluZGluZwoJLy8gaHR0cDovL3d3dy53My5vcmcvVFIvMjAwMy9XRC1ET00tTGV2ZWwtMy1FdmVudHMtMjAwMzAzMzEvZWNtYS1zY3JpcHQtYmluZGluZy5odG1sCglqUXVlcnkuRXZlbnQucHJvdG90eXBlID0gewoJCWNvbnN0cnVjdG9yOiBqUXVlcnkuRXZlbnQsCgkJaXNEZWZhdWx0UHJldmVudGVkOiByZXR1cm5GYWxzZSwKCQlpc1Byb3BhZ2F0aW9uU3RvcHBlZDogcmV0dXJuRmFsc2UsCgkJaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQ6IHJldHVybkZhbHNlLAoKCQlwcmV2ZW50RGVmYXVsdDogZnVuY3Rpb24oKSB7CgkJCXZhciBlID0gdGhpcy5vcmlnaW5hbEV2ZW50OwoKCQkJdGhpcy5pc0RlZmF1bHRQcmV2ZW50ZWQgPSByZXR1cm5UcnVlOwoJCQlpZiAoICFlICkgewoJCQkJcmV0dXJuOwoJCQl9CgoJCQkvLyBJZiBwcmV2ZW50RGVmYXVsdCBleGlzdHMsIHJ1biBpdCBvbiB0aGUgb3JpZ2luYWwgZXZlbnQKCQkJaWYgKCBlLnByZXZlbnREZWZhdWx0ICkgewoJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOwoKCQkJLy8gU3VwcG9ydDogSUUKCQkJLy8gT3RoZXJ3aXNlIHNldCB0aGUgcmV0dXJuVmFsdWUgcHJvcGVydHkgb2YgdGhlIG9yaWdpbmFsIGV2ZW50IHRvIGZhbHNlCgkJCX0gZWxzZSB7CgkJCQllLnJldHVyblZhbHVlID0gZmFsc2U7CgkJCX0KCQl9LAoJCXN0b3BQcm9wYWdhdGlvbjogZnVuY3Rpb24oKSB7CgkJCXZhciBlID0gdGhpcy5vcmlnaW5hbEV2ZW50OwoKCQkJdGhpcy5pc1Byb3BhZ2F0aW9uU3RvcHBlZCA9IHJldHVyblRydWU7CgoJCQlpZiAoICFlIHx8IHRoaXMuaXNTaW11bGF0ZWQgKSB7CgkJCQlyZXR1cm47CgkJCX0KCgkJCS8vIElmIHN0b3BQcm9wYWdhdGlvbiBleGlzdHMsIHJ1biBpdCBvbiB0aGUgb3JpZ2luYWwgZXZlbnQKCQkJaWYgKCBlLnN0b3BQcm9wYWdhdGlvbiApIHsKCQkJCWUuc3RvcFByb3BhZ2F0aW9uKCk7CgkJCX0KCgkJCS8vIFN1cHBvcnQ6IElFCgkJCS8vIFNldCB0aGUgY2FuY2VsQnViYmxlIHByb3BlcnR5IG9mIHRoZSBvcmlnaW5hbCBldmVudCB0byB0cnVlCgkJCWUuY2FuY2VsQnViYmxlID0gdHJ1ZTsKCQl9LAoJCXN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbjogZnVuY3Rpb24oKSB7CgkJCXZhciBlID0gdGhpcy5vcmlnaW5hbEV2ZW50OwoKCQkJdGhpcy5pc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZCA9IHJldHVyblRydWU7CgoJCQlpZiAoIGUgJiYgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24gKSB7CgkJCQllLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpOwoJCQl9CgoJCQl0aGlzLnN0b3BQcm9wYWdhdGlvbigpOwoJCX0KCX07CgoJLy8gQ3JlYXRlIG1vdXNlZW50ZXIvbGVhdmUgZXZlbnRzIHVzaW5nIG1vdXNlb3Zlci9vdXQgYW5kIGV2ZW50LXRpbWUgY2hlY2tzCgkvLyBzbyB0aGF0IGV2ZW50IGRlbGVnYXRpb24gd29ya3MgaW4galF1ZXJ5LgoJLy8gRG8gdGhlIHNhbWUgZm9yIHBvaW50ZXJlbnRlci9wb2ludGVybGVhdmUgYW5kIHBvaW50ZXJvdmVyL3BvaW50ZXJvdXQKCS8vCgkvLyBTdXBwb3J0OiBTYWZhcmkgNyBvbmx5CgkvLyBTYWZhcmkgc2VuZHMgbW91c2VlbnRlciB0b28gb2Z0ZW47IHNlZToKCS8vIGh0dHBzOi8vY29kZS5nb29nbGUuY29tL3AvY2hyb21pdW0vaXNzdWVzL2RldGFpbD9pZD00NzAyNTgKCS8vIGZvciB0aGUgZGVzY3JpcHRpb24gb2YgdGhlIGJ1ZyAoaXQgZXhpc3RlZCBpbiBvbGRlciBDaHJvbWUgdmVyc2lvbnMgYXMgd2VsbCkuCglqUXVlcnkuZWFjaCggewoJCW1vdXNlZW50ZXI6ICJtb3VzZW92ZXIiLAoJCW1vdXNlbGVhdmU6ICJtb3VzZW91dCIsCgkJcG9pbnRlcmVudGVyOiAicG9pbnRlcm92ZXIiLAoJCXBvaW50ZXJsZWF2ZTogInBvaW50ZXJvdXQiCgl9LCBmdW5jdGlvbiggb3JpZywgZml4ICkgewoJCWpRdWVyeS5ldmVudC5zcGVjaWFsWyBvcmlnIF0gPSB7CgkJCWRlbGVnYXRlVHlwZTogZml4LAoJCQliaW5kVHlwZTogZml4LAoKCQkJaGFuZGxlOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQl2YXIgcmV0LAoJCQkJCXRhcmdldCA9IHRoaXMsCgkJCQkJcmVsYXRlZCA9IGV2ZW50LnJlbGF0ZWRUYXJnZXQsCgkJCQkJaGFuZGxlT2JqID0gZXZlbnQuaGFuZGxlT2JqOwoKCQkJCS8vIEZvciBtb3VzZWVudGVyL2xlYXZlIGNhbGwgdGhlIGhhbmRsZXIgaWYgcmVsYXRlZCBpcyBvdXRzaWRlIHRoZSB0YXJnZXQuCgkJCQkvLyBOQjogTm8gcmVsYXRlZFRhcmdldCBpZiB0aGUgbW91c2UgbGVmdC9lbnRlcmVkIHRoZSBicm93c2VyIHdpbmRvdwoJCQkJaWYgKCAhcmVsYXRlZCB8fCAoIHJlbGF0ZWQgIT09IHRhcmdldCAmJiAhalF1ZXJ5LmNvbnRhaW5zKCB0YXJnZXQsIHJlbGF0ZWQgKSApICkgewoJCQkJCWV2ZW50LnR5cGUgPSBoYW5kbGVPYmoub3JpZ1R5cGU7CgkJCQkJcmV0ID0gaGFuZGxlT2JqLmhhbmRsZXIuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApOwoJCQkJCWV2ZW50LnR5cGUgPSBmaXg7CgkJCQl9CgkJCQlyZXR1cm4gcmV0OwoJCQl9CgkJfTsKCX0gKTsKCgkvLyBJRSBzdWJtaXQgZGVsZWdhdGlvbgoJaWYgKCAhc3VwcG9ydC5zdWJtaXQgKSB7CgoJCWpRdWVyeS5ldmVudC5zcGVjaWFsLnN1Ym1pdCA9IHsKCQkJc2V0dXA6IGZ1bmN0aW9uKCkgewoKCQkJCS8vIE9ubHkgbmVlZCB0aGlzIGZvciBkZWxlZ2F0ZWQgZm9ybSBzdWJtaXQgZXZlbnRzCgkJCQlpZiAoIGpRdWVyeS5ub2RlTmFtZSggdGhpcywgImZvcm0iICkgKSB7CgkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJfQoKCQkJCS8vIExhenktYWRkIGEgc3VibWl0IGhhbmRsZXIgd2hlbiBhIGRlc2NlbmRhbnQgZm9ybSBtYXkgcG90ZW50aWFsbHkgYmUgc3VibWl0dGVkCgkJCQlqUXVlcnkuZXZlbnQuYWRkKCB0aGlzLCAiY2xpY2suX3N1Ym1pdCBrZXlwcmVzcy5fc3VibWl0IiwgZnVuY3Rpb24oIGUgKSB7CgoJCQkJCS8vIE5vZGUgbmFtZSBjaGVjayBhdm9pZHMgYSBWTUwtcmVsYXRlZCBjcmFzaCBpbiBJRSAoIzk4MDcpCgkJCQkJdmFyIGVsZW0gPSBlLnRhcmdldCwKCQkJCQkJZm9ybSA9IGpRdWVyeS5ub2RlTmFtZSggZWxlbSwgImlucHV0IiApIHx8IGpRdWVyeS5ub2RlTmFtZSggZWxlbSwgImJ1dHRvbiIgKSA/CgoJCQkJCQkJLy8gU3VwcG9ydDogSUUgPD04CgkJCQkJCQkvLyBXZSB1c2UgalF1ZXJ5LnByb3AgaW5zdGVhZCBvZiBlbGVtLmZvcm0KCQkJCQkJCS8vIHRvIGFsbG93IGZpeGluZyB0aGUgSUU4IGRlbGVnYXRlZCBzdWJtaXQgaXNzdWUgKGdoLTIzMzIpCgkJCQkJCQkvLyBieSAzcmQgcGFydHkgcG9seWZpbGxzL3dvcmthcm91bmRzLgoJCQkJCQkJalF1ZXJ5LnByb3AoIGVsZW0sICJmb3JtIiApIDoKCQkJCQkJCXVuZGVmaW5lZDsKCgkJCQkJaWYgKCBmb3JtICYmICFqUXVlcnkuX2RhdGEoIGZvcm0sICJzdWJtaXQiICkgKSB7CgkJCQkJCWpRdWVyeS5ldmVudC5hZGQoIGZvcm0sICJzdWJtaXQuX3N1Ym1pdCIsIGZ1bmN0aW9uKCBldmVudCApIHsKCQkJCQkJCWV2ZW50Ll9zdWJtaXRCdWJibGUgPSB0cnVlOwoJCQkJCQl9ICk7CgkJCQkJCWpRdWVyeS5fZGF0YSggZm9ybSwgInN1Ym1pdCIsIHRydWUgKTsKCQkJCQl9CgkJCQl9ICk7CgoJCQkJLy8gcmV0dXJuIHVuZGVmaW5lZCBzaW5jZSB3ZSBkb24ndCBuZWVkIGFuIGV2ZW50IGxpc3RlbmVyCgkJCX0sCgoJCQlwb3N0RGlzcGF0Y2g6IGZ1bmN0aW9uKCBldmVudCApIHsKCgkJCQkvLyBJZiBmb3JtIHdhcyBzdWJtaXR0ZWQgYnkgdGhlIHVzZXIsIGJ1YmJsZSB0aGUgZXZlbnQgdXAgdGhlIHRyZWUKCQkJCWlmICggZXZlbnQuX3N1Ym1pdEJ1YmJsZSApIHsKCQkJCQlkZWxldGUgZXZlbnQuX3N1Ym1pdEJ1YmJsZTsKCQkJCQlpZiAoIHRoaXMucGFyZW50Tm9kZSAmJiAhZXZlbnQuaXNUcmlnZ2VyICkgewoJCQkJCQlqUXVlcnkuZXZlbnQuc2ltdWxhdGUoICJzdWJtaXQiLCB0aGlzLnBhcmVudE5vZGUsIGV2ZW50ICk7CgkJCQkJfQoJCQkJfQoJCQl9LAoKCQkJdGVhcmRvd246IGZ1bmN0aW9uKCkgewoKCQkJCS8vIE9ubHkgbmVlZCB0aGlzIGZvciBkZWxlZ2F0ZWQgZm9ybSBzdWJtaXQgZXZlbnRzCgkJCQlpZiAoIGpRdWVyeS5ub2RlTmFtZSggdGhpcywgImZvcm0iICkgKSB7CgkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJfQoKCQkJCS8vIFJlbW92ZSBkZWxlZ2F0ZWQgaGFuZGxlcnM7IGNsZWFuRGF0YSBldmVudHVhbGx5IHJlYXBzIHN1Ym1pdCBoYW5kbGVycyBhdHRhY2hlZCBhYm92ZQoJCQkJalF1ZXJ5LmV2ZW50LnJlbW92ZSggdGhpcywgIi5fc3VibWl0IiApOwoJCQl9CgkJfTsKCX0KCgkvLyBJRSBjaGFuZ2UgZGVsZWdhdGlvbiBhbmQgY2hlY2tib3gvcmFkaW8gZml4CglpZiAoICFzdXBwb3J0LmNoYW5nZSApIHsKCgkJalF1ZXJ5LmV2ZW50LnNwZWNpYWwuY2hhbmdlID0gewoKCQkJc2V0dXA6IGZ1bmN0aW9uKCkgewoKCQkJCWlmICggcmZvcm1FbGVtcy50ZXN0KCB0aGlzLm5vZGVOYW1lICkgKSB7CgoJCQkJCS8vIElFIGRvZXNuJ3QgZmlyZSBjaGFuZ2Ugb24gYSBjaGVjay9yYWRpbyB1bnRpbCBibHVyOyB0cmlnZ2VyIGl0IG9uIGNsaWNrCgkJCQkJLy8gYWZ0ZXIgYSBwcm9wZXJ0eWNoYW5nZS4gRWF0IHRoZSBibHVyLWNoYW5nZSBpbiBzcGVjaWFsLmNoYW5nZS5oYW5kbGUuCgkJCQkJLy8gVGhpcyBzdGlsbCBmaXJlcyBvbmNoYW5nZSBhIHNlY29uZCB0aW1lIGZvciBjaGVjay9yYWRpbyBhZnRlciBibHVyLgoJCQkJCWlmICggdGhpcy50eXBlID09PSAiY2hlY2tib3giIHx8IHRoaXMudHlwZSA9PT0gInJhZGlvIiApIHsKCQkJCQkJalF1ZXJ5LmV2ZW50LmFkZCggdGhpcywgInByb3BlcnR5Y2hhbmdlLl9jaGFuZ2UiLCBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQkJCQlpZiAoIGV2ZW50Lm9yaWdpbmFsRXZlbnQucHJvcGVydHlOYW1lID09PSAiY2hlY2tlZCIgKSB7CgkJCQkJCQkJdGhpcy5fanVzdENoYW5nZWQgPSB0cnVlOwoJCQkJCQkJfQoJCQkJCQl9ICk7CgkJCQkJCWpRdWVyeS5ldmVudC5hZGQoIHRoaXMsICJjbGljay5fY2hhbmdlIiwgZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJCQkJaWYgKCB0aGlzLl9qdXN0Q2hhbmdlZCAmJiAhZXZlbnQuaXNUcmlnZ2VyICkgewoJCQkJCQkJCXRoaXMuX2p1c3RDaGFuZ2VkID0gZmFsc2U7CgkJCQkJCQl9CgoJCQkJCQkJLy8gQWxsb3cgdHJpZ2dlcmVkLCBzaW11bGF0ZWQgY2hhbmdlIGV2ZW50cyAoIzExNTAwKQoJCQkJCQkJalF1ZXJ5LmV2ZW50LnNpbXVsYXRlKCAiY2hhbmdlIiwgdGhpcywgZXZlbnQgKTsKCQkJCQkJfSApOwoJCQkJCX0KCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQl9CgoJCQkJLy8gRGVsZWdhdGVkIGV2ZW50OyBsYXp5LWFkZCBhIGNoYW5nZSBoYW5kbGVyIG9uIGRlc2NlbmRhbnQgaW5wdXRzCgkJCQlqUXVlcnkuZXZlbnQuYWRkKCB0aGlzLCAiYmVmb3JlYWN0aXZhdGUuX2NoYW5nZSIsIGZ1bmN0aW9uKCBlICkgewoJCQkJCXZhciBlbGVtID0gZS50YXJnZXQ7CgoJCQkJCWlmICggcmZvcm1FbGVtcy50ZXN0KCBlbGVtLm5vZGVOYW1lICkgJiYgIWpRdWVyeS5fZGF0YSggZWxlbSwgImNoYW5nZSIgKSApIHsKCQkJCQkJalF1ZXJ5LmV2ZW50LmFkZCggZWxlbSwgImNoYW5nZS5fY2hhbmdlIiwgZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJCQkJaWYgKCB0aGlzLnBhcmVudE5vZGUgJiYgIWV2ZW50LmlzU2ltdWxhdGVkICYmICFldmVudC5pc1RyaWdnZXIgKSB7CgkJCQkJCQkJalF1ZXJ5LmV2ZW50LnNpbXVsYXRlKCAiY2hhbmdlIiwgdGhpcy5wYXJlbnROb2RlLCBldmVudCApOwoJCQkJCQkJfQoJCQkJCQl9ICk7CgkJCQkJCWpRdWVyeS5fZGF0YSggZWxlbSwgImNoYW5nZSIsIHRydWUgKTsKCQkJCQl9CgkJCQl9ICk7CgkJCX0sCgoJCQloYW5kbGU6IGZ1bmN0aW9uKCBldmVudCApIHsKCQkJCXZhciBlbGVtID0gZXZlbnQudGFyZ2V0OwoKCQkJCS8vIFN3YWxsb3cgbmF0aXZlIGNoYW5nZSBldmVudHMgZnJvbSBjaGVja2JveC9yYWRpbywgd2UgYWxyZWFkeSB0cmlnZ2VyZWQgdGhlbSBhYm92ZQoJCQkJaWYgKCB0aGlzICE9PSBlbGVtIHx8IGV2ZW50LmlzU2ltdWxhdGVkIHx8IGV2ZW50LmlzVHJpZ2dlciB8fAoJCQkJCSggZWxlbS50eXBlICE9PSAicmFkaW8iICYmIGVsZW0udHlwZSAhPT0gImNoZWNrYm94IiApICkgewoKCQkJCQlyZXR1cm4gZXZlbnQuaGFuZGxlT2JqLmhhbmRsZXIuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApOwoJCQkJfQoJCQl9LAoKCQkJdGVhcmRvd246IGZ1bmN0aW9uKCkgewoJCQkJalF1ZXJ5LmV2ZW50LnJlbW92ZSggdGhpcywgIi5fY2hhbmdlIiApOwoKCQkJCXJldHVybiAhcmZvcm1FbGVtcy50ZXN0KCB0aGlzLm5vZGVOYW1lICk7CgkJCX0KCQl9OwoJfQoKCS8vIFN1cHBvcnQ6IEZpcmVmb3gKCS8vIEZpcmVmb3ggZG9lc24ndCBoYXZlIGZvY3VzKGluIHwgb3V0KSBldmVudHMKCS8vIFJlbGF0ZWQgdGlja2V0IC0gaHR0cHM6Ly9idWd6aWxsYS5tb3ppbGxhLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9Njg3Nzg3CgkvLwoJLy8gU3VwcG9ydDogQ2hyb21lLCBTYWZhcmkKCS8vIGZvY3VzKGluIHwgb3V0KSBldmVudHMgZmlyZSBhZnRlciBmb2N1cyAmIGJsdXIgZXZlbnRzLAoJLy8gd2hpY2ggaXMgc3BlYyB2aW9sYXRpb24gLSBodHRwOi8vd3d3LnczLm9yZy9UUi9ET00tTGV2ZWwtMy1FdmVudHMvI2V2ZW50cy1mb2N1c2V2ZW50LWV2ZW50LW9yZGVyCgkvLyBSZWxhdGVkIHRpY2tldCAtIGh0dHBzOi8vY29kZS5nb29nbGUuY29tL3AvY2hyb21pdW0vaXNzdWVzL2RldGFpbD9pZD00NDk4NTcKCWlmICggIXN1cHBvcnQuZm9jdXNpbiApIHsKCQlqUXVlcnkuZWFjaCggeyBmb2N1czogImZvY3VzaW4iLCBibHVyOiAiZm9jdXNvdXQiIH0sIGZ1bmN0aW9uKCBvcmlnLCBmaXggKSB7CgoJCQkvLyBBdHRhY2ggYSBzaW5nbGUgY2FwdHVyaW5nIGhhbmRsZXIgb24gdGhlIGRvY3VtZW50IHdoaWxlIHNvbWVvbmUgd2FudHMgZm9jdXNpbi9mb2N1c291dAoJCQl2YXIgaGFuZGxlciA9IGZ1bmN0aW9uKCBldmVudCApIHsKCQkJCWpRdWVyeS5ldmVudC5zaW11bGF0ZSggZml4LCBldmVudC50YXJnZXQsIGpRdWVyeS5ldmVudC5maXgoIGV2ZW50ICkgKTsKCQkJfTsKCgkJCWpRdWVyeS5ldmVudC5zcGVjaWFsWyBmaXggXSA9IHsKCQkJCXNldHVwOiBmdW5jdGlvbigpIHsKCQkJCQl2YXIgZG9jID0gdGhpcy5vd25lckRvY3VtZW50IHx8IHRoaXMsCgkJCQkJCWF0dGFjaGVzID0galF1ZXJ5Ll9kYXRhKCBkb2MsIGZpeCApOwoKCQkJCQlpZiAoICFhdHRhY2hlcyApIHsKCQkJCQkJZG9jLmFkZEV2ZW50TGlzdGVuZXIoIG9yaWcsIGhhbmRsZXIsIHRydWUgKTsKCQkJCQl9CgkJCQkJalF1ZXJ5Ll9kYXRhKCBkb2MsIGZpeCwgKCBhdHRhY2hlcyB8fCAwICkgKyAxICk7CgkJCQl9LAoJCQkJdGVhcmRvd246IGZ1bmN0aW9uKCkgewoJCQkJCXZhciBkb2MgPSB0aGlzLm93bmVyRG9jdW1lbnQgfHwgdGhpcywKCQkJCQkJYXR0YWNoZXMgPSBqUXVlcnkuX2RhdGEoIGRvYywgZml4ICkgLSAxOwoKCQkJCQlpZiAoICFhdHRhY2hlcyApIHsKCQkJCQkJZG9jLnJlbW92ZUV2ZW50TGlzdGVuZXIoIG9yaWcsIGhhbmRsZXIsIHRydWUgKTsKCQkJCQkJalF1ZXJ5Ll9yZW1vdmVEYXRhKCBkb2MsIGZpeCApOwoJCQkJCX0gZWxzZSB7CgkJCQkJCWpRdWVyeS5fZGF0YSggZG9jLCBmaXgsIGF0dGFjaGVzICk7CgkJCQkJfQoJCQkJfQoJCQl9OwoJCX0gKTsKCX0KCglqUXVlcnkuZm4uZXh0ZW5kKCB7CgoJCW9uOiBmdW5jdGlvbiggdHlwZXMsIHNlbGVjdG9yLCBkYXRhLCBmbiApIHsKCQkJcmV0dXJuIG9uKCB0aGlzLCB0eXBlcywgc2VsZWN0b3IsIGRhdGEsIGZuICk7CgkJfSwKCQlvbmU6IGZ1bmN0aW9uKCB0eXBlcywgc2VsZWN0b3IsIGRhdGEsIGZuICkgewoJCQlyZXR1cm4gb24oIHRoaXMsIHR5cGVzLCBzZWxlY3RvciwgZGF0YSwgZm4sIDEgKTsKCQl9LAoJCW9mZjogZnVuY3Rpb24oIHR5cGVzLCBzZWxlY3RvciwgZm4gKSB7CgkJCXZhciBoYW5kbGVPYmosIHR5cGU7CgkJCWlmICggdHlwZXMgJiYgdHlwZXMucHJldmVudERlZmF1bHQgJiYgdHlwZXMuaGFuZGxlT2JqICkgewoKCQkJCS8vICggZXZlbnQgKSAgZGlzcGF0Y2hlZCBqUXVlcnkuRXZlbnQKCQkJCWhhbmRsZU9iaiA9IHR5cGVzLmhhbmRsZU9iajsKCQkJCWpRdWVyeSggdHlwZXMuZGVsZWdhdGVUYXJnZXQgKS5vZmYoCgkJCQkJaGFuZGxlT2JqLm5hbWVzcGFjZSA/CgkJCQkJCWhhbmRsZU9iai5vcmlnVHlwZSArICIuIiArIGhhbmRsZU9iai5uYW1lc3BhY2UgOgoJCQkJCQloYW5kbGVPYmoub3JpZ1R5cGUsCgkJCQkJaGFuZGxlT2JqLnNlbGVjdG9yLAoJCQkJCWhhbmRsZU9iai5oYW5kbGVyCgkJCQkpOwoJCQkJcmV0dXJuIHRoaXM7CgkJCX0KCQkJaWYgKCB0eXBlb2YgdHlwZXMgPT09ICJvYmplY3QiICkgewoKCQkJCS8vICggdHlwZXMtb2JqZWN0IFssIHNlbGVjdG9yXSApCgkJCQlmb3IgKCB0eXBlIGluIHR5cGVzICkgewoJCQkJCXRoaXMub2ZmKCB0eXBlLCBzZWxlY3RvciwgdHlwZXNbIHR5cGUgXSApOwoJCQkJfQoJCQkJcmV0dXJuIHRoaXM7CgkJCX0KCQkJaWYgKCBzZWxlY3RvciA9PT0gZmFsc2UgfHwgdHlwZW9mIHNlbGVjdG9yID09PSAiZnVuY3Rpb24iICkgewoKCQkJCS8vICggdHlwZXMgWywgZm5dICkKCQkJCWZuID0gc2VsZWN0b3I7CgkJCQlzZWxlY3RvciA9IHVuZGVmaW5lZDsKCQkJfQoJCQlpZiAoIGZuID09PSBmYWxzZSApIHsKCQkJCWZuID0gcmV0dXJuRmFsc2U7CgkJCX0KCQkJcmV0dXJuIHRoaXMuZWFjaCggZnVuY3Rpb24oKSB7CgkJCQlqUXVlcnkuZXZlbnQucmVtb3ZlKCB0aGlzLCB0eXBlcywgZm4sIHNlbGVjdG9yICk7CgkJCX0gKTsKCQl9LAoKCQl0cmlnZ2VyOiBmdW5jdGlvbiggdHlwZSwgZGF0YSApIHsKCQkJcmV0dXJuIHRoaXMuZWFjaCggZnVuY3Rpb24oKSB7CgkJCQlqUXVlcnkuZXZlbnQudHJpZ2dlciggdHlwZSwgZGF0YSwgdGhpcyApOwoJCQl9ICk7CgkJfSwKCQl0cmlnZ2VySGFuZGxlcjogZnVuY3Rpb24oIHR5cGUsIGRhdGEgKSB7CgkJCXZhciBlbGVtID0gdGhpc1sgMCBdOwoJCQlpZiAoIGVsZW0gKSB7CgkJCQlyZXR1cm4galF1ZXJ5LmV2ZW50LnRyaWdnZXIoIHR5cGUsIGRhdGEsIGVsZW0sIHRydWUgKTsKCQkJfQoJCX0KCX0gKTsKCgoJdmFyIHJpbmxpbmVqUXVlcnkgPSAvIGpRdWVyeVxkKz0iKD86bnVsbHxcZCspIi9nLAoJCXJub3NoaW1jYWNoZSA9IG5ldyBSZWdFeHAoICI8KD86IiArIG5vZGVOYW1lcyArICIpW1xccy8+XSIsICJpIiApLAoJCXJ4aHRtbFRhZyA9IC88KD8hYXJlYXxicnxjb2x8ZW1iZWR8aHJ8aW1nfGlucHV0fGxpbmt8bWV0YXxwYXJhbSkoKFtcdzotXSspW14+XSopXC8+L2dpLAoKCQkvLyBTdXBwb3J0OiBJRSAxMC0xMSwgRWRnZSAxMDI0MCsKCQkvLyBJbiBJRS9FZGdlIHVzaW5nIHJlZ2V4IGdyb3VwcyBoZXJlIGNhdXNlcyBzZXZlcmUgc2xvd2Rvd25zLgoJCS8vIFNlZSBodHRwczovL2Nvbm5lY3QubWljcm9zb2Z0LmNvbS9JRS9mZWVkYmFjay9kZXRhaWxzLzE3MzY1MTIvCgkJcm5vSW5uZXJodG1sID0gLzxzY3JpcHR8PHN0eWxlfDxsaW5rL2ksCgoJCS8vIGNoZWNrZWQ9ImNoZWNrZWQiIG9yIGNoZWNrZWQKCQlyY2hlY2tlZCA9IC9jaGVja2VkXHMqKD86W149XXw9XHMqLmNoZWNrZWQuKS9pLAoJCXJzY3JpcHRUeXBlTWFza2VkID0gL150cnVlXC8oLiopLywKCQlyY2xlYW5TY3JpcHQgPSAvXlxzKjwhKD86XFtDREFUQVxbfC0tKXwoPzpcXVxdfC0tKT5ccyokL2csCgkJc2FmZUZyYWdtZW50ID0gY3JlYXRlU2FmZUZyYWdtZW50KCBkb2N1bWVudCApLAoJCWZyYWdtZW50RGl2ID0gc2FmZUZyYWdtZW50LmFwcGVuZENoaWxkKCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAiZGl2IiApICk7CgoJLy8gU3VwcG9ydDogSUU8OAoJLy8gTWFuaXB1bGF0aW5nIHRhYmxlcyByZXF1aXJlcyBhIHRib2R5CglmdW5jdGlvbiBtYW5pcHVsYXRpb25UYXJnZXQoIGVsZW0sIGNvbnRlbnQgKSB7CgkJcmV0dXJuIGpRdWVyeS5ub2RlTmFtZSggZWxlbSwgInRhYmxlIiApICYmCgkJCWpRdWVyeS5ub2RlTmFtZSggY29udGVudC5ub2RlVHlwZSAhPT0gMTEgPyBjb250ZW50IDogY29udGVudC5maXJzdENoaWxkLCAidHIiICkgPwoKCQkJZWxlbS5nZXRFbGVtZW50c0J5VGFnTmFtZSggInRib2R5IiApWyAwIF0gfHwKCQkJCWVsZW0uYXBwZW5kQ2hpbGQoIGVsZW0ub3duZXJEb2N1bWVudC5jcmVhdGVFbGVtZW50KCAidGJvZHkiICkgKSA6CgkJCWVsZW07Cgl9CgoJLy8gUmVwbGFjZS9yZXN0b3JlIHRoZSB0eXBlIGF0dHJpYnV0ZSBvZiBzY3JpcHQgZWxlbWVudHMgZm9yIHNhZmUgRE9NIG1hbmlwdWxhdGlvbgoJZnVuY3Rpb24gZGlzYWJsZVNjcmlwdCggZWxlbSApIHsKCQllbGVtLnR5cGUgPSAoIGpRdWVyeS5maW5kLmF0dHIoIGVsZW0sICJ0eXBlIiApICE9PSBudWxsICkgKyAiLyIgKyBlbGVtLnR5cGU7CgkJcmV0dXJuIGVsZW07Cgl9CglmdW5jdGlvbiByZXN0b3JlU2NyaXB0KCBlbGVtICkgewoJCXZhciBtYXRjaCA9IHJzY3JpcHRUeXBlTWFza2VkLmV4ZWMoIGVsZW0udHlwZSApOwoJCWlmICggbWF0Y2ggKSB7CgkJCWVsZW0udHlwZSA9IG1hdGNoWyAxIF07CgkJfSBlbHNlIHsKCQkJZWxlbS5yZW1vdmVBdHRyaWJ1dGUoICJ0eXBlIiApOwoJCX0KCQlyZXR1cm4gZWxlbTsKCX0KCglmdW5jdGlvbiBjbG9uZUNvcHlFdmVudCggc3JjLCBkZXN0ICkgewoJCWlmICggZGVzdC5ub2RlVHlwZSAhPT0gMSB8fCAhalF1ZXJ5Lmhhc0RhdGEoIHNyYyApICkgewoJCQlyZXR1cm47CgkJfQoKCQl2YXIgdHlwZSwgaSwgbCwKCQkJb2xkRGF0YSA9IGpRdWVyeS5fZGF0YSggc3JjICksCgkJCWN1ckRhdGEgPSBqUXVlcnkuX2RhdGEoIGRlc3QsIG9sZERhdGEgKSwKCQkJZXZlbnRzID0gb2xkRGF0YS5ldmVudHM7CgoJCWlmICggZXZlbnRzICkgewoJCQlkZWxldGUgY3VyRGF0YS5oYW5kbGU7CgkJCWN1ckRhdGEuZXZlbnRzID0ge307CgoJCQlmb3IgKCB0eXBlIGluIGV2ZW50cyApIHsKCQkJCWZvciAoIGkgPSAwLCBsID0gZXZlbnRzWyB0eXBlIF0ubGVuZ3RoOyBpIDwgbDsgaSsrICkgewoJCQkJCWpRdWVyeS5ldmVudC5hZGQoIGRlc3QsIHR5cGUsIGV2ZW50c1sgdHlwZSBdWyBpIF0gKTsKCQkJCX0KCQkJfQoJCX0KCgkJLy8gbWFrZSB0aGUgY2xvbmVkIHB1YmxpYyBkYXRhIG9iamVjdCBhIGNvcHkgZnJvbSB0aGUgb3JpZ2luYWwKCQlpZiAoIGN1ckRhdGEuZGF0YSApIHsKCQkJY3VyRGF0YS5kYXRhID0galF1ZXJ5LmV4dGVuZCgge30sIGN1ckRhdGEuZGF0YSApOwoJCX0KCX0KCglmdW5jdGlvbiBmaXhDbG9uZU5vZGVJc3N1ZXMoIHNyYywgZGVzdCApIHsKCQl2YXIgbm9kZU5hbWUsIGUsIGRhdGE7CgoJCS8vIFdlIGRvIG5vdCBuZWVkIHRvIGRvIGFueXRoaW5nIGZvciBub24tRWxlbWVudHMKCQlpZiAoIGRlc3Qubm9kZVR5cGUgIT09IDEgKSB7CgkJCXJldHVybjsKCQl9CgoJCW5vZGVOYW1lID0gZGVzdC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOwoKCQkvLyBJRTYtOCBjb3BpZXMgZXZlbnRzIGJvdW5kIHZpYSBhdHRhY2hFdmVudCB3aGVuIHVzaW5nIGNsb25lTm9kZS4KCQlpZiAoICFzdXBwb3J0Lm5vQ2xvbmVFdmVudCAmJiBkZXN0WyBqUXVlcnkuZXhwYW5kbyBdICkgewoJCQlkYXRhID0galF1ZXJ5Ll9kYXRhKCBkZXN0ICk7CgoJCQlmb3IgKCBlIGluIGRhdGEuZXZlbnRzICkgewoJCQkJalF1ZXJ5LnJlbW92ZUV2ZW50KCBkZXN0LCBlLCBkYXRhLmhhbmRsZSApOwoJCQl9CgoJCQkvLyBFdmVudCBkYXRhIGdldHMgcmVmZXJlbmNlZCBpbnN0ZWFkIG9mIGNvcGllZCBpZiB0aGUgZXhwYW5kbyBnZXRzIGNvcGllZCB0b28KCQkJZGVzdC5yZW1vdmVBdHRyaWJ1dGUoIGpRdWVyeS5leHBhbmRvICk7CgkJfQoKCQkvLyBJRSBibGFua3MgY29udGVudHMgd2hlbiBjbG9uaW5nIHNjcmlwdHMsIGFuZCB0cmllcyB0byBldmFsdWF0ZSBuZXdseS1zZXQgdGV4dAoJCWlmICggbm9kZU5hbWUgPT09ICJzY3JpcHQiICYmIGRlc3QudGV4dCAhPT0gc3JjLnRleHQgKSB7CgkJCWRpc2FibGVTY3JpcHQoIGRlc3QgKS50ZXh0ID0gc3JjLnRleHQ7CgkJCXJlc3RvcmVTY3JpcHQoIGRlc3QgKTsKCgkJLy8gSUU2LTEwIGltcHJvcGVybHkgY2xvbmVzIGNoaWxkcmVuIG9mIG9iamVjdCBlbGVtZW50cyB1c2luZyBjbGFzc2lkLgoJCS8vIElFMTAgdGhyb3dzIE5vTW9kaWZpY2F0aW9uQWxsb3dlZEVycm9yIGlmIHBhcmVudCBpcyBudWxsLCAjMTIxMzIuCgkJfSBlbHNlIGlmICggbm9kZU5hbWUgPT09ICJvYmplY3QiICkgewoJCQlpZiAoIGRlc3QucGFyZW50Tm9kZSApIHsKCQkJCWRlc3Qub3V0ZXJIVE1MID0gc3JjLm91dGVySFRNTDsKCQkJfQoKCQkJLy8gVGhpcyBwYXRoIGFwcGVhcnMgdW5hdm9pZGFibGUgZm9yIElFOS4gV2hlbiBjbG9uaW5nIGFuIG9iamVjdAoJCQkvLyBlbGVtZW50IGluIElFOSwgdGhlIG91dGVySFRNTCBzdHJhdGVneSBhYm92ZSBpcyBub3Qgc3VmZmljaWVudC4KCQkJLy8gSWYgdGhlIHNyYyBoYXMgaW5uZXJIVE1MIGFuZCB0aGUgZGVzdGluYXRpb24gZG9lcyBub3QsCgkJCS8vIGNvcHkgdGhlIHNyYy5pbm5lckhUTUwgaW50byB0aGUgZGVzdC5pbm5lckhUTUwuICMxMDMyNAoJCQlpZiAoIHN1cHBvcnQuaHRtbDVDbG9uZSAmJiAoIHNyYy5pbm5lckhUTUwgJiYgIWpRdWVyeS50cmltKCBkZXN0LmlubmVySFRNTCApICkgKSB7CgkJCQlkZXN0LmlubmVySFRNTCA9IHNyYy5pbm5lckhUTUw7CgkJCX0KCgkJfSBlbHNlIGlmICggbm9kZU5hbWUgPT09ICJpbnB1dCIgJiYgcmNoZWNrYWJsZVR5cGUudGVzdCggc3JjLnR5cGUgKSApIHsKCgkJCS8vIElFNi04IGZhaWxzIHRvIHBlcnNpc3QgdGhlIGNoZWNrZWQgc3RhdGUgb2YgYSBjbG9uZWQgY2hlY2tib3gKCQkJLy8gb3IgcmFkaW8gYnV0dG9uLiBXb3JzZSwgSUU2LTcgZmFpbCB0byBnaXZlIHRoZSBjbG9uZWQgZWxlbWVudAoJCQkvLyBhIGNoZWNrZWQgYXBwZWFyYW5jZSBpZiB0aGUgZGVmYXVsdENoZWNrZWQgdmFsdWUgaXNuJ3QgYWxzbyBzZXQKCgkJCWRlc3QuZGVmYXVsdENoZWNrZWQgPSBkZXN0LmNoZWNrZWQgPSBzcmMuY2hlY2tlZDsKCgkJCS8vIElFNi03IGdldCBjb25mdXNlZCBhbmQgZW5kIHVwIHNldHRpbmcgdGhlIHZhbHVlIG9mIGEgY2xvbmVkCgkJCS8vIGNoZWNrYm94L3JhZGlvIGJ1dHRvbiB0byBhbiBlbXB0eSBzdHJpbmcgaW5zdGVhZCBvZiAib24iCgkJCWlmICggZGVzdC52YWx1ZSAhPT0gc3JjLnZhbHVlICkgewoJCQkJZGVzdC52YWx1ZSA9IHNyYy52YWx1ZTsKCQkJfQoKCQkvLyBJRTYtOCBmYWlscyB0byByZXR1cm4gdGhlIHNlbGVjdGVkIG9wdGlvbiB0byB0aGUgZGVmYXVsdCBzZWxlY3RlZAoJCS8vIHN0YXRlIHdoZW4gY2xvbmluZyBvcHRpb25zCgkJfSBlbHNlIGlmICggbm9kZU5hbWUgPT09ICJvcHRpb24iICkgewoJCQlkZXN0LmRlZmF1bHRTZWxlY3RlZCA9IGRlc3Quc2VsZWN0ZWQgPSBzcmMuZGVmYXVsdFNlbGVjdGVkOwoKCQkvLyBJRTYtOCBmYWlscyB0byBzZXQgdGhlIGRlZmF1bHRWYWx1ZSB0byB0aGUgY29ycmVjdCB2YWx1ZSB3aGVuCgkJLy8gY2xvbmluZyBvdGhlciB0eXBlcyBvZiBpbnB1dCBmaWVsZHMKCQl9IGVsc2UgaWYgKCBub2RlTmFtZSA9PT0gImlucHV0IiB8fCBub2RlTmFtZSA9PT0gInRleHRhcmVhIiApIHsKCQkJZGVzdC5kZWZhdWx0VmFsdWUgPSBzcmMuZGVmYXVsdFZhbHVlOwoJCX0KCX0KCglmdW5jdGlvbiBkb21NYW5pcCggY29sbGVjdGlvbiwgYXJncywgY2FsbGJhY2ssIGlnbm9yZWQgKSB7CgoJCS8vIEZsYXR0ZW4gYW55IG5lc3RlZCBhcnJheXMKCQlhcmdzID0gY29uY2F0LmFwcGx5KCBbXSwgYXJncyApOwoKCQl2YXIgZmlyc3QsIG5vZGUsIGhhc1NjcmlwdHMsCgkJCXNjcmlwdHMsIGRvYywgZnJhZ21lbnQsCgkJCWkgPSAwLAoJCQlsID0gY29sbGVjdGlvbi5sZW5ndGgsCgkJCWlOb0Nsb25lID0gbCAtIDEsCgkJCXZhbHVlID0gYXJnc1sgMCBdLAoJCQlpc0Z1bmN0aW9uID0galF1ZXJ5LmlzRnVuY3Rpb24oIHZhbHVlICk7CgoJCS8vIFdlIGNhbid0IGNsb25lTm9kZSBmcmFnbWVudHMgdGhhdCBjb250YWluIGNoZWNrZWQsIGluIFdlYktpdAoJCWlmICggaXNGdW5jdGlvbiB8fAoJCQkJKCBsID4gMSAmJiB0eXBlb2YgdmFsdWUgPT09ICJzdHJpbmciICYmCgkJCQkJIXN1cHBvcnQuY2hlY2tDbG9uZSAmJiByY2hlY2tlZC50ZXN0KCB2YWx1ZSApICkgKSB7CgkJCXJldHVybiBjb2xsZWN0aW9uLmVhY2goIGZ1bmN0aW9uKCBpbmRleCApIHsKCQkJCXZhciBzZWxmID0gY29sbGVjdGlvbi5lcSggaW5kZXggKTsKCQkJCWlmICggaXNGdW5jdGlvbiApIHsKCQkJCQlhcmdzWyAwIF0gPSB2YWx1ZS5jYWxsKCB0aGlzLCBpbmRleCwgc2VsZi5odG1sKCkgKTsKCQkJCX0KCQkJCWRvbU1hbmlwKCBzZWxmLCBhcmdzLCBjYWxsYmFjaywgaWdub3JlZCApOwoJCQl9ICk7CgkJfQoKCQlpZiAoIGwgKSB7CgkJCWZyYWdtZW50ID0gYnVpbGRGcmFnbWVudCggYXJncywgY29sbGVjdGlvblsgMCBdLm93bmVyRG9jdW1lbnQsIGZhbHNlLCBjb2xsZWN0aW9uLCBpZ25vcmVkICk7CgkJCWZpcnN0ID0gZnJhZ21lbnQuZmlyc3RDaGlsZDsKCgkJCWlmICggZnJhZ21lbnQuY2hpbGROb2Rlcy5sZW5ndGggPT09IDEgKSB7CgkJCQlmcmFnbWVudCA9IGZpcnN0OwoJCQl9CgoJCQkvLyBSZXF1aXJlIGVpdGhlciBuZXcgY29udGVudCBvciBhbiBpbnRlcmVzdCBpbiBpZ25vcmVkIGVsZW1lbnRzIHRvIGludm9rZSB0aGUgY2FsbGJhY2sKCQkJaWYgKCBmaXJzdCB8fCBpZ25vcmVkICkgewoJCQkJc2NyaXB0cyA9IGpRdWVyeS5tYXAoIGdldEFsbCggZnJhZ21lbnQsICJzY3JpcHQiICksIGRpc2FibGVTY3JpcHQgKTsKCQkJCWhhc1NjcmlwdHMgPSBzY3JpcHRzLmxlbmd0aDsKCgkJCQkvLyBVc2UgdGhlIG9yaWdpbmFsIGZyYWdtZW50IGZvciB0aGUgbGFzdCBpdGVtCgkJCQkvLyBpbnN0ZWFkIG9mIHRoZSBmaXJzdCBiZWNhdXNlIGl0IGNhbiBlbmQgdXAKCQkJCS8vIGJlaW5nIGVtcHRpZWQgaW5jb3JyZWN0bHkgaW4gY2VydGFpbiBzaXR1YXRpb25zICgjODA3MCkuCgkJCQlmb3IgKCA7IGkgPCBsOyBpKysgKSB7CgkJCQkJbm9kZSA9IGZyYWdtZW50OwoKCQkJCQlpZiAoIGkgIT09IGlOb0Nsb25lICkgewoJCQkJCQlub2RlID0galF1ZXJ5LmNsb25lKCBub2RlLCB0cnVlLCB0cnVlICk7CgoJCQkJCQkvLyBLZWVwIHJlZmVyZW5jZXMgdG8gY2xvbmVkIHNjcmlwdHMgZm9yIGxhdGVyIHJlc3RvcmF0aW9uCgkJCQkJCWlmICggaGFzU2NyaXB0cyApIHsKCgkJCQkJCQkvLyBTdXBwb3J0OiBBbmRyb2lkPDQuMSwgUGhhbnRvbUpTPDIKCQkJCQkJCS8vIHB1c2guYXBwbHkoXywgYXJyYXlsaWtlKSB0aHJvd3Mgb24gYW5jaWVudCBXZWJLaXQKCQkJCQkJCWpRdWVyeS5tZXJnZSggc2NyaXB0cywgZ2V0QWxsKCBub2RlLCAic2NyaXB0IiApICk7CgkJCQkJCX0KCQkJCQl9CgoJCQkJCWNhbGxiYWNrLmNhbGwoIGNvbGxlY3Rpb25bIGkgXSwgbm9kZSwgaSApOwoJCQkJfQoKCQkJCWlmICggaGFzU2NyaXB0cyApIHsKCQkJCQlkb2MgPSBzY3JpcHRzWyBzY3JpcHRzLmxlbmd0aCAtIDEgXS5vd25lckRvY3VtZW50OwoKCQkJCQkvLyBSZWVuYWJsZSBzY3JpcHRzCgkJCQkJalF1ZXJ5Lm1hcCggc2NyaXB0cywgcmVzdG9yZVNjcmlwdCApOwoKCQkJCQkvLyBFdmFsdWF0ZSBleGVjdXRhYmxlIHNjcmlwdHMgb24gZmlyc3QgZG9jdW1lbnQgaW5zZXJ0aW9uCgkJCQkJZm9yICggaSA9IDA7IGkgPCBoYXNTY3JpcHRzOyBpKysgKSB7CgkJCQkJCW5vZGUgPSBzY3JpcHRzWyBpIF07CgkJCQkJCWlmICggcnNjcmlwdFR5cGUudGVzdCggbm9kZS50eXBlIHx8ICIiICkgJiYKCQkJCQkJCSFqUXVlcnkuX2RhdGEoIG5vZGUsICJnbG9iYWxFdmFsIiApICYmCgkJCQkJCQlqUXVlcnkuY29udGFpbnMoIGRvYywgbm9kZSApICkgewoKCQkJCQkJCWlmICggbm9kZS5zcmMgKSB7CgoJCQkJCQkJCS8vIE9wdGlvbmFsIEFKQVggZGVwZW5kZW5jeSwgYnV0IHdvbid0IHJ1biBzY3JpcHRzIGlmIG5vdCBwcmVzZW50CgkJCQkJCQkJaWYgKCBqUXVlcnkuX2V2YWxVcmwgKSB7CgkJCQkJCQkJCWpRdWVyeS5fZXZhbFVybCggbm9kZS5zcmMgKTsKCQkJCQkJCQl9CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCWpRdWVyeS5nbG9iYWxFdmFsKAoJCQkJCQkJCQkoIG5vZGUudGV4dCB8fCBub2RlLnRleHRDb250ZW50IHx8IG5vZGUuaW5uZXJIVE1MIHx8ICIiICkKCQkJCQkJCQkJCS5yZXBsYWNlKCByY2xlYW5TY3JpcHQsICIiICkKCQkJCQkJCQkpOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfQoKCQkJCS8vIEZpeCAjMTE4MDk6IEF2b2lkIGxlYWtpbmcgbWVtb3J5CgkJCQlmcmFnbWVudCA9IGZpcnN0ID0gbnVsbDsKCQkJfQoJCX0KCgkJcmV0dXJuIGNvbGxlY3Rpb247Cgl9CgoJZnVuY3Rpb24gcmVtb3ZlKCBlbGVtLCBzZWxlY3Rvciwga2VlcERhdGEgKSB7CgkJdmFyIG5vZGUsCgkJCWVsZW1zID0gc2VsZWN0b3IgPyBqUXVlcnkuZmlsdGVyKCBzZWxlY3RvciwgZWxlbSApIDogZWxlbSwKCQkJaSA9IDA7CgoJCWZvciAoIDsgKCBub2RlID0gZWxlbXNbIGkgXSApICE9IG51bGw7IGkrKyApIHsKCgkJCWlmICggIWtlZXBEYXRhICYmIG5vZGUubm9kZVR5cGUgPT09IDEgKSB7CgkJCQlqUXVlcnkuY2xlYW5EYXRhKCBnZXRBbGwoIG5vZGUgKSApOwoJCQl9CgoJCQlpZiAoIG5vZGUucGFyZW50Tm9kZSApIHsKCQkJCWlmICgga2VlcERhdGEgJiYgalF1ZXJ5LmNvbnRhaW5zKCBub2RlLm93bmVyRG9jdW1lbnQsIG5vZGUgKSApIHsKCQkJCQlzZXRHbG9iYWxFdmFsKCBnZXRBbGwoIG5vZGUsICJzY3JpcHQiICkgKTsKCQkJCX0KCQkJCW5vZGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggbm9kZSApOwoJCQl9CgkJfQoKCQlyZXR1cm4gZWxlbTsKCX0KCglqUXVlcnkuZXh0ZW5kKCB7CgkJaHRtbFByZWZpbHRlcjogZnVuY3Rpb24oIGh0bWwgKSB7CgkJCXJldHVybiBodG1sLnJlcGxhY2UoIHJ4aHRtbFRhZywgIjwkMT48LyQyPiIgKTsKCQl9LAoKCQljbG9uZTogZnVuY3Rpb24oIGVsZW0sIGRhdGFBbmRFdmVudHMsIGRlZXBEYXRhQW5kRXZlbnRzICkgewoJCQl2YXIgZGVzdEVsZW1lbnRzLCBub2RlLCBjbG9uZSwgaSwgc3JjRWxlbWVudHMsCgkJCQlpblBhZ2UgPSBqUXVlcnkuY29udGFpbnMoIGVsZW0ub3duZXJEb2N1bWVudCwgZWxlbSApOwoKCQkJaWYgKCBzdXBwb3J0Lmh0bWw1Q2xvbmUgfHwgalF1ZXJ5LmlzWE1MRG9jKCBlbGVtICkgfHwKCQkJCSFybm9zaGltY2FjaGUudGVzdCggIjwiICsgZWxlbS5ub2RlTmFtZSArICI+IiApICkgewoKCQkJCWNsb25lID0gZWxlbS5jbG9uZU5vZGUoIHRydWUgKTsKCgkJCS8vIElFPD04IGRvZXMgbm90IHByb3Blcmx5IGNsb25lIGRldGFjaGVkLCB1bmtub3duIGVsZW1lbnQgbm9kZXMKCQkJfSBlbHNlIHsKCQkJCWZyYWdtZW50RGl2LmlubmVySFRNTCA9IGVsZW0ub3V0ZXJIVE1MOwoJCQkJZnJhZ21lbnREaXYucmVtb3ZlQ2hpbGQoIGNsb25lID0gZnJhZ21lbnREaXYuZmlyc3RDaGlsZCApOwoJCQl9CgoJCQlpZiAoICggIXN1cHBvcnQubm9DbG9uZUV2ZW50IHx8ICFzdXBwb3J0Lm5vQ2xvbmVDaGVja2VkICkgJiYKCQkJCQkoIGVsZW0ubm9kZVR5cGUgPT09IDEgfHwgZWxlbS5ub2RlVHlwZSA9PT0gMTEgKSAmJiAhalF1ZXJ5LmlzWE1MRG9jKCBlbGVtICkgKSB7CgoJCQkJLy8gV2UgZXNjaGV3IFNpenpsZSBoZXJlIGZvciBwZXJmb3JtYW5jZSByZWFzb25zOiBodHRwOi8vanNwZXJmLmNvbS9nZXRhbGwtdnMtc2l6emxlLzIKCQkJCWRlc3RFbGVtZW50cyA9IGdldEFsbCggY2xvbmUgKTsKCQkJCXNyY0VsZW1lbnRzID0gZ2V0QWxsKCBlbGVtICk7CgoJCQkJLy8gRml4IGFsbCBJRSBjbG9uaW5nIGlzc3VlcwoJCQkJZm9yICggaSA9IDA7ICggbm9kZSA9IHNyY0VsZW1lbnRzWyBpIF0gKSAhPSBudWxsOyArK2kgKSB7CgoJCQkJCS8vIEVuc3VyZSB0aGF0IHRoZSBkZXN0aW5hdGlvbiBub2RlIGlzIG5vdCBudWxsOyBGaXhlcyAjOTU4NwoJCQkJCWlmICggZGVzdEVsZW1lbnRzWyBpIF0gKSB7CgkJCQkJCWZpeENsb25lTm9kZUlzc3Vlcyggbm9kZSwgZGVzdEVsZW1lbnRzWyBpIF0gKTsKCQkJCQl9CgkJCQl9CgkJCX0KCgkJCS8vIENvcHkgdGhlIGV2ZW50cyBmcm9tIHRoZSBvcmlnaW5hbCB0byB0aGUgY2xvbmUKCQkJaWYgKCBkYXRhQW5kRXZlbnRzICkgewoJCQkJaWYgKCBkZWVwRGF0YUFuZEV2ZW50cyApIHsKCQkJCQlzcmNFbGVtZW50cyA9IHNyY0VsZW1lbnRzIHx8IGdldEFsbCggZWxlbSApOwoJCQkJCWRlc3RFbGVtZW50cyA9IGRlc3RFbGVtZW50cyB8fCBnZXRBbGwoIGNsb25lICk7CgoJCQkJCWZvciAoIGkgPSAwOyAoIG5vZGUgPSBzcmNFbGVtZW50c1sgaSBdICkgIT0gbnVsbDsgaSsrICkgewoJCQkJCQljbG9uZUNvcHlFdmVudCggbm9kZSwgZGVzdEVsZW1lbnRzWyBpIF0gKTsKCQkJCQl9CgkJCQl9IGVsc2UgewoJCQkJCWNsb25lQ29weUV2ZW50KCBlbGVtLCBjbG9uZSApOwoJCQkJfQoJCQl9CgoJCQkvLyBQcmVzZXJ2ZSBzY3JpcHQgZXZhbHVhdGlvbiBoaXN0b3J5CgkJCWRlc3RFbGVtZW50cyA9IGdldEFsbCggY2xvbmUsICJzY3JpcHQiICk7CgkJCWlmICggZGVzdEVsZW1lbnRzLmxlbmd0aCA+IDAgKSB7CgkJCQlzZXRHbG9iYWxFdmFsKCBkZXN0RWxlbWVudHMsICFpblBhZ2UgJiYgZ2V0QWxsKCBlbGVtLCAic2NyaXB0IiApICk7CgkJCX0KCgkJCWRlc3RFbGVtZW50cyA9IHNyY0VsZW1lbnRzID0gbm9kZSA9IG51bGw7CgoJCQkvLyBSZXR1cm4gdGhlIGNsb25lZCBzZXQKCQkJcmV0dXJuIGNsb25lOwoJCX0sCgoJCWNsZWFuRGF0YTogZnVuY3Rpb24oIGVsZW1zLCAvKiBpbnRlcm5hbCAqLyBmb3JjZUFjY2VwdERhdGEgKSB7CgkJCXZhciBlbGVtLCB0eXBlLCBpZCwgZGF0YSwKCQkJCWkgPSAwLAoJCQkJaW50ZXJuYWxLZXkgPSBqUXVlcnkuZXhwYW5kbywKCQkJCWNhY2hlID0galF1ZXJ5LmNhY2hlLAoJCQkJYXR0cmlidXRlcyA9IHN1cHBvcnQuYXR0cmlidXRlcywKCQkJCXNwZWNpYWwgPSBqUXVlcnkuZXZlbnQuc3BlY2lhbDsKCgkJCWZvciAoIDsgKCBlbGVtID0gZWxlbXNbIGkgXSApICE9IG51bGw7IGkrKyApIHsKCQkJCWlmICggZm9yY2VBY2NlcHREYXRhIHx8IGFjY2VwdERhdGEoIGVsZW0gKSApIHsKCgkJCQkJaWQgPSBlbGVtWyBpbnRlcm5hbEtleSBdOwoJCQkJCWRhdGEgPSBpZCAmJiBjYWNoZVsgaWQgXTsKCgkJCQkJaWYgKCBkYXRhICkgewoJCQkJCQlpZiAoIGRhdGEuZXZlbnRzICkgewoJCQkJCQkJZm9yICggdHlwZSBpbiBkYXRhLmV2ZW50cyApIHsKCQkJCQkJCQlpZiAoIHNwZWNpYWxbIHR5cGUgXSApIHsKCQkJCQkJCQkJalF1ZXJ5LmV2ZW50LnJlbW92ZSggZWxlbSwgdHlwZSApOwoKCQkJCQkJCQkvLyBUaGlzIGlzIGEgc2hvcnRjdXQgdG8gYXZvaWQgalF1ZXJ5LmV2ZW50LnJlbW92ZSdzIG92ZXJoZWFkCgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJalF1ZXJ5LnJlbW92ZUV2ZW50KCBlbGVtLCB0eXBlLCBkYXRhLmhhbmRsZSApOwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfQoKCQkJCQkJLy8gUmVtb3ZlIGNhY2hlIG9ubHkgaWYgaXQgd2FzIG5vdCBhbHJlYWR5IHJlbW92ZWQgYnkgalF1ZXJ5LmV2ZW50LnJlbW92ZQoJCQkJCQlpZiAoIGNhY2hlWyBpZCBdICkgewoKCQkJCQkJCWRlbGV0ZSBjYWNoZVsgaWQgXTsKCgkJCQkJCQkvLyBTdXBwb3J0OiBJRTw5CgkJCQkJCQkvLyBJRSBkb2VzIG5vdCBhbGxvdyB1cyB0byBkZWxldGUgZXhwYW5kbyBwcm9wZXJ0aWVzIGZyb20gbm9kZXMKCQkJCQkJCS8vIElFIGNyZWF0ZXMgZXhwYW5kbyBhdHRyaWJ1dGVzIGFsb25nIHdpdGggdGhlIHByb3BlcnR5CgkJCQkJCQkvLyBJRSBkb2VzIG5vdCBoYXZlIGEgcmVtb3ZlQXR0cmlidXRlIGZ1bmN0aW9uIG9uIERvY3VtZW50IG5vZGVzCgkJCQkJCQlpZiAoICFhdHRyaWJ1dGVzICYmIHR5cGVvZiBlbGVtLnJlbW92ZUF0dHJpYnV0ZSAhPT0gInVuZGVmaW5lZCIgKSB7CgkJCQkJCQkJZWxlbS5yZW1vdmVBdHRyaWJ1dGUoIGludGVybmFsS2V5ICk7CgoJCQkJCQkJLy8gV2Via2l0ICYgQmxpbmsgcGVyZm9ybWFuY2Ugc3VmZmVycyB3aGVuIGRlbGV0aW5nIHByb3BlcnRpZXMKCQkJCQkJCS8vIGZyb20gRE9NIG5vZGVzLCBzbyBzZXQgdG8gdW5kZWZpbmVkIGluc3RlYWQKCQkJCQkJCS8vIGh0dHBzOi8vY29kZS5nb29nbGUuY29tL3AvY2hyb21pdW0vaXNzdWVzL2RldGFpbD9pZD0zNzg2MDcKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJZWxlbVsgaW50ZXJuYWxLZXkgXSA9IHVuZGVmaW5lZDsKCQkJCQkJCX0KCgkJCQkJCQlkZWxldGVkSWRzLnB1c2goIGlkICk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQl9Cgl9ICk7CgoJalF1ZXJ5LmZuLmV4dGVuZCggewoKCQkvLyBLZWVwIGRvbU1hbmlwIGV4cG9zZWQgdW50aWwgMy4wIChnaC0yMjI1KQoJCWRvbU1hbmlwOiBkb21NYW5pcCwKCgkJZGV0YWNoOiBmdW5jdGlvbiggc2VsZWN0b3IgKSB7CgkJCXJldHVybiByZW1vdmUoIHRoaXMsIHNlbGVjdG9yLCB0cnVlICk7CgkJfSwKCgkJcmVtb3ZlOiBmdW5jdGlvbiggc2VsZWN0b3IgKSB7CgkJCXJldHVybiByZW1vdmUoIHRoaXMsIHNlbGVjdG9yICk7CgkJfSwKCgkJdGV4dDogZnVuY3Rpb24oIHZhbHVlICkgewoJCQlyZXR1cm4gYWNjZXNzKCB0aGlzLCBmdW5jdGlvbiggdmFsdWUgKSB7CgkJCQlyZXR1cm4gdmFsdWUgPT09IHVuZGVmaW5lZCA/CgkJCQkJalF1ZXJ5LnRleHQoIHRoaXMgKSA6CgkJCQkJdGhpcy5lbXB0eSgpLmFwcGVuZCgKCQkJCQkJKCB0aGlzWyAwIF0gJiYgdGhpc1sgMCBdLm93bmVyRG9jdW1lbnQgfHwgZG9jdW1lbnQgKS5jcmVhdGVUZXh0Tm9kZSggdmFsdWUgKQoJCQkJCSk7CgkJCX0sIG51bGwsIHZhbHVlLCBhcmd1bWVudHMubGVuZ3RoICk7CgkJfSwKCgkJYXBwZW5kOiBmdW5jdGlvbigpIHsKCQkJcmV0dXJuIGRvbU1hbmlwKCB0aGlzLCBhcmd1bWVudHMsIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJaWYgKCB0aGlzLm5vZGVUeXBlID09PSAxIHx8IHRoaXMubm9kZVR5cGUgPT09IDExIHx8IHRoaXMubm9kZVR5cGUgPT09IDkgKSB7CgkJCQkJdmFyIHRhcmdldCA9IG1hbmlwdWxhdGlvblRhcmdldCggdGhpcywgZWxlbSApOwoJCQkJCXRhcmdldC5hcHBlbmRDaGlsZCggZWxlbSApOwoJCQkJfQoJCQl9ICk7CgkJfSwKCgkJcHJlcGVuZDogZnVuY3Rpb24oKSB7CgkJCXJldHVybiBkb21NYW5pcCggdGhpcywgYXJndW1lbnRzLCBmdW5jdGlvbiggZWxlbSApIHsKCQkJCWlmICggdGhpcy5ub2RlVHlwZSA9PT0gMSB8fCB0aGlzLm5vZGVUeXBlID09PSAxMSB8fCB0aGlzLm5vZGVUeXBlID09PSA5ICkgewoJCQkJCXZhciB0YXJnZXQgPSBtYW5pcHVsYXRpb25UYXJnZXQoIHRoaXMsIGVsZW0gKTsKCQkJCQl0YXJnZXQuaW5zZXJ0QmVmb3JlKCBlbGVtLCB0YXJnZXQuZmlyc3RDaGlsZCApOwoJCQkJfQoJCQl9ICk7CgkJfSwKCgkJYmVmb3JlOiBmdW5jdGlvbigpIHsKCQkJcmV0dXJuIGRvbU1hbmlwKCB0aGlzLCBhcmd1bWVudHMsIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJaWYgKCB0aGlzLnBhcmVudE5vZGUgKSB7CgkJCQkJdGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZSggZWxlbSwgdGhpcyApOwoJCQkJfQoJCQl9ICk7CgkJfSwKCgkJYWZ0ZXI6IGZ1bmN0aW9uKCkgewoJCQlyZXR1cm4gZG9tTWFuaXAoIHRoaXMsIGFyZ3VtZW50cywgZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQlpZiAoIHRoaXMucGFyZW50Tm9kZSApIHsKCQkJCQl0aGlzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKCBlbGVtLCB0aGlzLm5leHRTaWJsaW5nICk7CgkJCQl9CgkJCX0gKTsKCQl9LAoKCQllbXB0eTogZnVuY3Rpb24oKSB7CgkJCXZhciBlbGVtLAoJCQkJaSA9IDA7CgoJCQlmb3IgKCA7ICggZWxlbSA9IHRoaXNbIGkgXSApICE9IG51bGw7IGkrKyApIHsKCgkJCQkvLyBSZW1vdmUgZWxlbWVudCBub2RlcyBhbmQgcHJldmVudCBtZW1vcnkgbGVha3MKCQkJCWlmICggZWxlbS5ub2RlVHlwZSA9PT0gMSApIHsKCQkJCQlqUXVlcnkuY2xlYW5EYXRhKCBnZXRBbGwoIGVsZW0sIGZhbHNlICkgKTsKCQkJCX0KCgkJCQkvLyBSZW1vdmUgYW55IHJlbWFpbmluZyBub2RlcwoJCQkJd2hpbGUgKCBlbGVtLmZpcnN0Q2hpbGQgKSB7CgkJCQkJZWxlbS5yZW1vdmVDaGlsZCggZWxlbS5maXJzdENoaWxkICk7CgkJCQl9CgoJCQkJLy8gSWYgdGhpcyBpcyBhIHNlbGVjdCwgZW5zdXJlIHRoYXQgaXQgZGlzcGxheXMgZW1wdHkgKCMxMjMzNikKCQkJCS8vIFN1cHBvcnQ6IElFPDkKCQkJCWlmICggZWxlbS5vcHRpb25zICYmIGpRdWVyeS5ub2RlTmFtZSggZWxlbSwgInNlbGVjdCIgKSApIHsKCQkJCQllbGVtLm9wdGlvbnMubGVuZ3RoID0gMDsKCQkJCX0KCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgkJfSwKCgkJY2xvbmU6IGZ1bmN0aW9uKCBkYXRhQW5kRXZlbnRzLCBkZWVwRGF0YUFuZEV2ZW50cyApIHsKCQkJZGF0YUFuZEV2ZW50cyA9IGRhdGFBbmRFdmVudHMgPT0gbnVsbCA/IGZhbHNlIDogZGF0YUFuZEV2ZW50czsKCQkJZGVlcERhdGFBbmRFdmVudHMgPSBkZWVwRGF0YUFuZEV2ZW50cyA9PSBudWxsID8gZGF0YUFuZEV2ZW50cyA6IGRlZXBEYXRhQW5kRXZlbnRzOwoKCQkJcmV0dXJuIHRoaXMubWFwKCBmdW5jdGlvbigpIHsKCQkJCXJldHVybiBqUXVlcnkuY2xvbmUoIHRoaXMsIGRhdGFBbmRFdmVudHMsIGRlZXBEYXRhQW5kRXZlbnRzICk7CgkJCX0gKTsKCQl9LAoKCQlodG1sOiBmdW5jdGlvbiggdmFsdWUgKSB7CgkJCXJldHVybiBhY2Nlc3MoIHRoaXMsIGZ1bmN0aW9uKCB2YWx1ZSApIHsKCQkJCXZhciBlbGVtID0gdGhpc1sgMCBdIHx8IHt9LAoJCQkJCWkgPSAwLAoJCQkJCWwgPSB0aGlzLmxlbmd0aDsKCgkJCQlpZiAoIHZhbHVlID09PSB1bmRlZmluZWQgKSB7CgkJCQkJcmV0dXJuIGVsZW0ubm9kZVR5cGUgPT09IDEgPwoJCQkJCQllbGVtLmlubmVySFRNTC5yZXBsYWNlKCByaW5saW5lalF1ZXJ5LCAiIiApIDoKCQkJCQkJdW5kZWZpbmVkOwoJCQkJfQoKCQkJCS8vIFNlZSBpZiB3ZSBjYW4gdGFrZSBhIHNob3J0Y3V0IGFuZCBqdXN0IHVzZSBpbm5lckhUTUwKCQkJCWlmICggdHlwZW9mIHZhbHVlID09PSAic3RyaW5nIiAmJiAhcm5vSW5uZXJodG1sLnRlc3QoIHZhbHVlICkgJiYKCQkJCQkoIHN1cHBvcnQuaHRtbFNlcmlhbGl6ZSB8fCAhcm5vc2hpbWNhY2hlLnRlc3QoIHZhbHVlICkgICkgJiYKCQkJCQkoIHN1cHBvcnQubGVhZGluZ1doaXRlc3BhY2UgfHwgIXJsZWFkaW5nV2hpdGVzcGFjZS50ZXN0KCB2YWx1ZSApICkgJiYKCQkJCQkhd3JhcE1hcFsgKCBydGFnTmFtZS5leGVjKCB2YWx1ZSApIHx8IFsgIiIsICIiIF0gKVsgMSBdLnRvTG93ZXJDYXNlKCkgXSApIHsKCgkJCQkJdmFsdWUgPSBqUXVlcnkuaHRtbFByZWZpbHRlciggdmFsdWUgKTsKCgkJCQkJdHJ5IHsKCQkJCQkJZm9yICggOyBpIDwgbDsgaSsrICkgewoKCQkJCQkJCS8vIFJlbW92ZSBlbGVtZW50IG5vZGVzIGFuZCBwcmV2ZW50IG1lbW9yeSBsZWFrcwoJCQkJCQkJZWxlbSA9IHRoaXNbIGkgXSB8fCB7fTsKCQkJCQkJCWlmICggZWxlbS5ub2RlVHlwZSA9PT0gMSApIHsKCQkJCQkJCQlqUXVlcnkuY2xlYW5EYXRhKCBnZXRBbGwoIGVsZW0sIGZhbHNlICkgKTsKCQkJCQkJCQllbGVtLmlubmVySFRNTCA9IHZhbHVlOwoJCQkJCQkJfQoJCQkJCQl9CgoJCQkJCQllbGVtID0gMDsKCgkJCQkJLy8gSWYgdXNpbmcgaW5uZXJIVE1MIHRocm93cyBhbiBleGNlcHRpb24sIHVzZSB0aGUgZmFsbGJhY2sgbWV0aG9kCgkJCQkJfSBjYXRjaCAoIGUgKSB7fQoJCQkJfQoKCQkJCWlmICggZWxlbSApIHsKCQkJCQl0aGlzLmVtcHR5KCkuYXBwZW5kKCB2YWx1ZSApOwoJCQkJfQoJCQl9LCBudWxsLCB2YWx1ZSwgYXJndW1lbnRzLmxlbmd0aCApOwoJCX0sCgoJCXJlcGxhY2VXaXRoOiBmdW5jdGlvbigpIHsKCQkJdmFyIGlnbm9yZWQgPSBbXTsKCgkJCS8vIE1ha2UgdGhlIGNoYW5nZXMsIHJlcGxhY2luZyBlYWNoIG5vbi1pZ25vcmVkIGNvbnRleHQgZWxlbWVudCB3aXRoIHRoZSBuZXcgY29udGVudAoJCQlyZXR1cm4gZG9tTWFuaXAoIHRoaXMsIGFyZ3VtZW50cywgZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQl2YXIgcGFyZW50ID0gdGhpcy5wYXJlbnROb2RlOwoKCQkJCWlmICggalF1ZXJ5LmluQXJyYXkoIHRoaXMsIGlnbm9yZWQgKSA8IDAgKSB7CgkJCQkJalF1ZXJ5LmNsZWFuRGF0YSggZ2V0QWxsKCB0aGlzICkgKTsKCQkJCQlpZiAoIHBhcmVudCApIHsKCQkJCQkJcGFyZW50LnJlcGxhY2VDaGlsZCggZWxlbSwgdGhpcyApOwoJCQkJCX0KCQkJCX0KCgkJCS8vIEZvcmNlIGNhbGxiYWNrIGludm9jYXRpb24KCQkJfSwgaWdub3JlZCApOwoJCX0KCX0gKTsKCglqUXVlcnkuZWFjaCggewoJCWFwcGVuZFRvOiAiYXBwZW5kIiwKCQlwcmVwZW5kVG86ICJwcmVwZW5kIiwKCQlpbnNlcnRCZWZvcmU6ICJiZWZvcmUiLAoJCWluc2VydEFmdGVyOiAiYWZ0ZXIiLAoJCXJlcGxhY2VBbGw6ICJyZXBsYWNlV2l0aCIKCX0sIGZ1bmN0aW9uKCBuYW1lLCBvcmlnaW5hbCApIHsKCQlqUXVlcnkuZm5bIG5hbWUgXSA9IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQkJdmFyIGVsZW1zLAoJCQkJaSA9IDAsCgkJCQlyZXQgPSBbXSwKCQkJCWluc2VydCA9IGpRdWVyeSggc2VsZWN0b3IgKSwKCQkJCWxhc3QgPSBpbnNlcnQubGVuZ3RoIC0gMTsKCgkJCWZvciAoIDsgaSA8PSBsYXN0OyBpKysgKSB7CgkJCQllbGVtcyA9IGkgPT09IGxhc3QgPyB0aGlzIDogdGhpcy5jbG9uZSggdHJ1ZSApOwoJCQkJalF1ZXJ5KCBpbnNlcnRbIGkgXSApWyBvcmlnaW5hbCBdKCBlbGVtcyApOwoKCQkJCS8vIE1vZGVybiBicm93c2VycyBjYW4gYXBwbHkgalF1ZXJ5IGNvbGxlY3Rpb25zIGFzIGFycmF5cywgYnV0IG9sZElFIG5lZWRzIGEgLmdldCgpCgkJCQlwdXNoLmFwcGx5KCByZXQsIGVsZW1zLmdldCgpICk7CgkJCX0KCgkJCXJldHVybiB0aGlzLnB1c2hTdGFjayggcmV0ICk7CgkJfTsKCX0gKTsKCgoJdmFyIGlmcmFtZSwKCQllbGVtZGlzcGxheSA9IHsKCgkJCS8vIFN1cHBvcnQ6IEZpcmVmb3gKCQkJLy8gV2UgaGF2ZSB0byBwcmUtZGVmaW5lIHRoZXNlIHZhbHVlcyBmb3IgRkYgKCMxMDIyNykKCQkJSFRNTDogImJsb2NrIiwKCQkJQk9EWTogImJsb2NrIgoJCX07CgoJLyoqCgkgKiBSZXRyaWV2ZSB0aGUgYWN0dWFsIGRpc3BsYXkgb2YgYSBlbGVtZW50CgkgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBub2RlTmFtZSBvZiB0aGUgZWxlbWVudAoJICogQHBhcmFtIHtPYmplY3R9IGRvYyBEb2N1bWVudCBvYmplY3QKCSAqLwoKCS8vIENhbGxlZCBvbmx5IGZyb20gd2l0aGluIGRlZmF1bHREaXNwbGF5CglmdW5jdGlvbiBhY3R1YWxEaXNwbGF5KCBuYW1lLCBkb2MgKSB7CgkJdmFyIGVsZW0gPSBqUXVlcnkoIGRvYy5jcmVhdGVFbGVtZW50KCBuYW1lICkgKS5hcHBlbmRUbyggZG9jLmJvZHkgKSwKCgkJCWRpc3BsYXkgPSBqUXVlcnkuY3NzKCBlbGVtWyAwIF0sICJkaXNwbGF5IiApOwoKCQkvLyBXZSBkb24ndCBoYXZlIGFueSBkYXRhIHN0b3JlZCBvbiB0aGUgZWxlbWVudCwKCQkvLyBzbyB1c2UgImRldGFjaCIgbWV0aG9kIGFzIGZhc3Qgd2F5IHRvIGdldCByaWQgb2YgdGhlIGVsZW1lbnQKCQllbGVtLmRldGFjaCgpOwoKCQlyZXR1cm4gZGlzcGxheTsKCX0KCgkvKioKCSAqIFRyeSB0byBkZXRlcm1pbmUgdGhlIGRlZmF1bHQgZGlzcGxheSB2YWx1ZSBvZiBhbiBlbGVtZW50CgkgKiBAcGFyYW0ge1N0cmluZ30gbm9kZU5hbWUKCSAqLwoJZnVuY3Rpb24gZGVmYXVsdERpc3BsYXkoIG5vZGVOYW1lICkgewoJCXZhciBkb2MgPSBkb2N1bWVudCwKCQkJZGlzcGxheSA9IGVsZW1kaXNwbGF5WyBub2RlTmFtZSBdOwoKCQlpZiAoICFkaXNwbGF5ICkgewoJCQlkaXNwbGF5ID0gYWN0dWFsRGlzcGxheSggbm9kZU5hbWUsIGRvYyApOwoKCQkJLy8gSWYgdGhlIHNpbXBsZSB3YXkgZmFpbHMsIHJlYWQgZnJvbSBpbnNpZGUgYW4gaWZyYW1lCgkJCWlmICggZGlzcGxheSA9PT0gIm5vbmUiIHx8ICFkaXNwbGF5ICkgewoKCQkJCS8vIFVzZSB0aGUgYWxyZWFkeS1jcmVhdGVkIGlmcmFtZSBpZiBwb3NzaWJsZQoJCQkJaWZyYW1lID0gKCBpZnJhbWUgfHwgalF1ZXJ5KCAiPGlmcmFtZSBmcmFtZWJvcmRlcj0nMCcgd2lkdGg9JzAnIGhlaWdodD0nMCcvPiIgKSApCgkJCQkJLmFwcGVuZFRvKCBkb2MuZG9jdW1lbnRFbGVtZW50ICk7CgoJCQkJLy8gQWx3YXlzIHdyaXRlIGEgbmV3IEhUTUwgc2tlbGV0b24gc28gV2Via2l0IGFuZCBGaXJlZm94IGRvbid0IGNob2tlIG9uIHJldXNlCgkJCQlkb2MgPSAoIGlmcmFtZVsgMCBdLmNvbnRlbnRXaW5kb3cgfHwgaWZyYW1lWyAwIF0uY29udGVudERvY3VtZW50ICkuZG9jdW1lbnQ7CgoJCQkJLy8gU3VwcG9ydDogSUUKCQkJCWRvYy53cml0ZSgpOwoJCQkJZG9jLmNsb3NlKCk7CgoJCQkJZGlzcGxheSA9IGFjdHVhbERpc3BsYXkoIG5vZGVOYW1lLCBkb2MgKTsKCQkJCWlmcmFtZS5kZXRhY2goKTsKCQkJfQoKCQkJLy8gU3RvcmUgdGhlIGNvcnJlY3QgZGVmYXVsdCBkaXNwbGF5CgkJCWVsZW1kaXNwbGF5WyBub2RlTmFtZSBdID0gZGlzcGxheTsKCQl9CgoJCXJldHVybiBkaXNwbGF5OwoJfQoJdmFyIHJtYXJnaW4gPSAoIC9ebWFyZ2luLyApOwoKCXZhciBybnVtbm9ucHggPSBuZXcgUmVnRXhwKCAiXigiICsgcG51bSArICIpKD8hcHgpW2EteiVdKyQiLCAiaSIgKTsKCgl2YXIgc3dhcCA9IGZ1bmN0aW9uKCBlbGVtLCBvcHRpb25zLCBjYWxsYmFjaywgYXJncyApIHsKCQl2YXIgcmV0LCBuYW1lLAoJCQlvbGQgPSB7fTsKCgkJLy8gUmVtZW1iZXIgdGhlIG9sZCB2YWx1ZXMsIGFuZCBpbnNlcnQgdGhlIG5ldyBvbmVzCgkJZm9yICggbmFtZSBpbiBvcHRpb25zICkgewoJCQlvbGRbIG5hbWUgXSA9IGVsZW0uc3R5bGVbIG5hbWUgXTsKCQkJZWxlbS5zdHlsZVsgbmFtZSBdID0gb3B0aW9uc1sgbmFtZSBdOwoJCX0KCgkJcmV0ID0gY2FsbGJhY2suYXBwbHkoIGVsZW0sIGFyZ3MgfHwgW10gKTsKCgkJLy8gUmV2ZXJ0IHRoZSBvbGQgdmFsdWVzCgkJZm9yICggbmFtZSBpbiBvcHRpb25zICkgewoJCQllbGVtLnN0eWxlWyBuYW1lIF0gPSBvbGRbIG5hbWUgXTsKCQl9CgoJCXJldHVybiByZXQ7Cgl9OwoKCgl2YXIgZG9jdW1lbnRFbGVtZW50ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50OwoKCgoJKCBmdW5jdGlvbigpIHsKCQl2YXIgcGl4ZWxQb3NpdGlvblZhbCwgcGl4ZWxNYXJnaW5SaWdodFZhbCwgYm94U2l6aW5nUmVsaWFibGVWYWwsCgkJCXJlbGlhYmxlSGlkZGVuT2Zmc2V0c1ZhbCwgcmVsaWFibGVNYXJnaW5SaWdodFZhbCwgcmVsaWFibGVNYXJnaW5MZWZ0VmFsLAoJCQljb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAiZGl2IiApLAoJCQlkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAiZGl2IiApOwoKCQkvLyBGaW5pc2ggZWFybHkgaW4gbGltaXRlZCAobm9uLWJyb3dzZXIpIGVudmlyb25tZW50cwoJCWlmICggIWRpdi5zdHlsZSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJZGl2LnN0eWxlLmNzc1RleHQgPSAiZmxvYXQ6bGVmdDtvcGFjaXR5Oi41IjsKCgkJLy8gU3VwcG9ydDogSUU8OQoJCS8vIE1ha2Ugc3VyZSB0aGF0IGVsZW1lbnQgb3BhY2l0eSBleGlzdHMgKGFzIG9wcG9zZWQgdG8gZmlsdGVyKQoJCXN1cHBvcnQub3BhY2l0eSA9IGRpdi5zdHlsZS5vcGFjaXR5ID09PSAiMC41IjsKCgkJLy8gVmVyaWZ5IHN0eWxlIGZsb2F0IGV4aXN0ZW5jZQoJCS8vIChJRSB1c2VzIHN0eWxlRmxvYXQgaW5zdGVhZCBvZiBjc3NGbG9hdCkKCQlzdXBwb3J0LmNzc0Zsb2F0ID0gISFkaXYuc3R5bGUuY3NzRmxvYXQ7CgoJCWRpdi5zdHlsZS5iYWNrZ3JvdW5kQ2xpcCA9ICJjb250ZW50LWJveCI7CgkJZGl2LmNsb25lTm9kZSggdHJ1ZSApLnN0eWxlLmJhY2tncm91bmRDbGlwID0gIiI7CgkJc3VwcG9ydC5jbGVhckNsb25lU3R5bGUgPSBkaXYuc3R5bGUuYmFja2dyb3VuZENsaXAgPT09ICJjb250ZW50LWJveCI7CgoJCWNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJkaXYiICk7CgkJY29udGFpbmVyLnN0eWxlLmNzc1RleHQgPSAiYm9yZGVyOjA7d2lkdGg6OHB4O2hlaWdodDowO3RvcDowO2xlZnQ6LTk5OTlweDsiICsKCQkJInBhZGRpbmc6MDttYXJnaW4tdG9wOjFweDtwb3NpdGlvbjphYnNvbHV0ZSI7CgkJZGl2LmlubmVySFRNTCA9ICIiOwoJCWNvbnRhaW5lci5hcHBlbmRDaGlsZCggZGl2ICk7CgoJCS8vIFN1cHBvcnQ6IEZpcmVmb3g8MjksIEFuZHJvaWQgMi4zCgkJLy8gVmVuZG9yLXByZWZpeCBib3gtc2l6aW5nCgkJc3VwcG9ydC5ib3hTaXppbmcgPSBkaXYuc3R5bGUuYm94U2l6aW5nID09PSAiIiB8fCBkaXYuc3R5bGUuTW96Qm94U2l6aW5nID09PSAiIiB8fAoJCQlkaXYuc3R5bGUuV2Via2l0Qm94U2l6aW5nID09PSAiIjsKCgkJalF1ZXJ5LmV4dGVuZCggc3VwcG9ydCwgewoJCQlyZWxpYWJsZUhpZGRlbk9mZnNldHM6IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCBwaXhlbFBvc2l0aW9uVmFsID09IG51bGwgKSB7CgkJCQkJY29tcHV0ZVN0eWxlVGVzdHMoKTsKCQkJCX0KCQkJCXJldHVybiByZWxpYWJsZUhpZGRlbk9mZnNldHNWYWw7CgkJCX0sCgoJCQlib3hTaXppbmdSZWxpYWJsZTogZnVuY3Rpb24oKSB7CgoJCQkJLy8gV2UncmUgY2hlY2tpbmcgZm9yIHBpeGVsUG9zaXRpb25WYWwgaGVyZSBpbnN0ZWFkIG9mIGJveFNpemluZ1JlbGlhYmxlVmFsCgkJCQkvLyBzaW5jZSB0aGF0IGNvbXByZXNzZXMgYmV0dGVyIGFuZCB0aGV5J3JlIGNvbXB1dGVkIHRvZ2V0aGVyIGFueXdheS4KCQkJCWlmICggcGl4ZWxQb3NpdGlvblZhbCA9PSBudWxsICkgewoJCQkJCWNvbXB1dGVTdHlsZVRlc3RzKCk7CgkJCQl9CgkJCQlyZXR1cm4gYm94U2l6aW5nUmVsaWFibGVWYWw7CgkJCX0sCgoJCQlwaXhlbE1hcmdpblJpZ2h0OiBmdW5jdGlvbigpIHsKCgkJCQkvLyBTdXBwb3J0OiBBbmRyb2lkIDQuMC00LjMKCQkJCWlmICggcGl4ZWxQb3NpdGlvblZhbCA9PSBudWxsICkgewoJCQkJCWNvbXB1dGVTdHlsZVRlc3RzKCk7CgkJCQl9CgkJCQlyZXR1cm4gcGl4ZWxNYXJnaW5SaWdodFZhbDsKCQkJfSwKCgkJCXBpeGVsUG9zaXRpb246IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCBwaXhlbFBvc2l0aW9uVmFsID09IG51bGwgKSB7CgkJCQkJY29tcHV0ZVN0eWxlVGVzdHMoKTsKCQkJCX0KCQkJCXJldHVybiBwaXhlbFBvc2l0aW9uVmFsOwoJCQl9LAoKCQkJcmVsaWFibGVNYXJnaW5SaWdodDogZnVuY3Rpb24oKSB7CgoJCQkJLy8gU3VwcG9ydDogQW5kcm9pZCAyLjMKCQkJCWlmICggcGl4ZWxQb3NpdGlvblZhbCA9PSBudWxsICkgewoJCQkJCWNvbXB1dGVTdHlsZVRlc3RzKCk7CgkJCQl9CgkJCQlyZXR1cm4gcmVsaWFibGVNYXJnaW5SaWdodFZhbDsKCQkJfSwKCgkJCXJlbGlhYmxlTWFyZ2luTGVmdDogZnVuY3Rpb24oKSB7CgoJCQkJLy8gU3VwcG9ydDogSUUgPD04IG9ubHksIEFuZHJvaWQgNC4wIC0gNC4zIG9ubHksIEZpcmVmb3ggPD0zIC0gMzcKCQkJCWlmICggcGl4ZWxQb3NpdGlvblZhbCA9PSBudWxsICkgewoJCQkJCWNvbXB1dGVTdHlsZVRlc3RzKCk7CgkJCQl9CgkJCQlyZXR1cm4gcmVsaWFibGVNYXJnaW5MZWZ0VmFsOwoJCQl9CgkJfSApOwoKCQlmdW5jdGlvbiBjb21wdXRlU3R5bGVUZXN0cygpIHsKCQkJdmFyIGNvbnRlbnRzLCBkaXZTdHlsZSwKCQkJCWRvY3VtZW50RWxlbWVudCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKCgkJCS8vIFNldHVwCgkJCWRvY3VtZW50RWxlbWVudC5hcHBlbmRDaGlsZCggY29udGFpbmVyICk7CgoJCQlkaXYuc3R5bGUuY3NzVGV4dCA9CgoJCQkJLy8gU3VwcG9ydDogQW5kcm9pZCAyLjMKCQkJCS8vIFZlbmRvci1wcmVmaXggYm94LXNpemluZwoJCQkJIi13ZWJraXQtYm94LXNpemluZzpib3JkZXItYm94O2JveC1zaXppbmc6Ym9yZGVyLWJveDsiICsKCQkJCSJwb3NpdGlvbjpyZWxhdGl2ZTtkaXNwbGF5OmJsb2NrOyIgKwoJCQkJIm1hcmdpbjphdXRvO2JvcmRlcjoxcHg7cGFkZGluZzoxcHg7IiArCgkJCQkidG9wOjElO3dpZHRoOjUwJSI7CgoJCQkvLyBTdXBwb3J0OiBJRTw5CgkJCS8vIEFzc3VtZSByZWFzb25hYmxlIHZhbHVlcyBpbiB0aGUgYWJzZW5jZSBvZiBnZXRDb21wdXRlZFN0eWxlCgkJCXBpeGVsUG9zaXRpb25WYWwgPSBib3hTaXppbmdSZWxpYWJsZVZhbCA9IHJlbGlhYmxlTWFyZ2luTGVmdFZhbCA9IGZhbHNlOwoJCQlwaXhlbE1hcmdpblJpZ2h0VmFsID0gcmVsaWFibGVNYXJnaW5SaWdodFZhbCA9IHRydWU7CgoJCQkvLyBDaGVjayBmb3IgZ2V0Q29tcHV0ZWRTdHlsZSBzbyB0aGF0IHRoaXMgY29kZSBpcyBub3QgcnVuIGluIElFPDkuCgkJCWlmICggd2luZG93LmdldENvbXB1dGVkU3R5bGUgKSB7CgkJCQlkaXZTdHlsZSA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKCBkaXYgKTsKCQkJCXBpeGVsUG9zaXRpb25WYWwgPSAoIGRpdlN0eWxlIHx8IHt9ICkudG9wICE9PSAiMSUiOwoJCQkJcmVsaWFibGVNYXJnaW5MZWZ0VmFsID0gKCBkaXZTdHlsZSB8fCB7fSApLm1hcmdpbkxlZnQgPT09ICIycHgiOwoJCQkJYm94U2l6aW5nUmVsaWFibGVWYWwgPSAoIGRpdlN0eWxlIHx8IHsgd2lkdGg6ICI0cHgiIH0gKS53aWR0aCA9PT0gIjRweCI7CgoJCQkJLy8gU3VwcG9ydDogQW5kcm9pZCA0LjAgLSA0LjMgb25seQoJCQkJLy8gU29tZSBzdHlsZXMgY29tZSBiYWNrIHdpdGggcGVyY2VudGFnZSB2YWx1ZXMsIGV2ZW4gdGhvdWdoIHRoZXkgc2hvdWxkbid0CgkJCQlkaXYuc3R5bGUubWFyZ2luUmlnaHQgPSAiNTAlIjsKCQkJCXBpeGVsTWFyZ2luUmlnaHRWYWwgPSAoIGRpdlN0eWxlIHx8IHsgbWFyZ2luUmlnaHQ6ICI0cHgiIH0gKS5tYXJnaW5SaWdodCA9PT0gIjRweCI7CgoJCQkJLy8gU3VwcG9ydDogQW5kcm9pZCAyLjMgb25seQoJCQkJLy8gRGl2IHdpdGggZXhwbGljaXQgd2lkdGggYW5kIG5vIG1hcmdpbi1yaWdodCBpbmNvcnJlY3RseQoJCQkJLy8gZ2V0cyBjb21wdXRlZCBtYXJnaW4tcmlnaHQgYmFzZWQgb24gd2lkdGggb2YgY29udGFpbmVyICgjMzMzMykKCQkJCS8vIFdlYktpdCBCdWcgMTMzNDMgLSBnZXRDb21wdXRlZFN0eWxlIHJldHVybnMgd3JvbmcgdmFsdWUgZm9yIG1hcmdpbi1yaWdodAoJCQkJY29udGVudHMgPSBkaXYuYXBwZW5kQ2hpbGQoIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJkaXYiICkgKTsKCgkJCQkvLyBSZXNldCBDU1M6IGJveC1zaXppbmc7IGRpc3BsYXk7IG1hcmdpbjsgYm9yZGVyOyBwYWRkaW5nCgkJCQljb250ZW50cy5zdHlsZS5jc3NUZXh0ID0gZGl2LnN0eWxlLmNzc1RleHQgPQoKCQkJCQkvLyBTdXBwb3J0OiBBbmRyb2lkIDIuMwoJCQkJCS8vIFZlbmRvci1wcmVmaXggYm94LXNpemluZwoJCQkJCSItd2Via2l0LWJveC1zaXppbmc6Y29udGVudC1ib3g7LW1vei1ib3gtc2l6aW5nOmNvbnRlbnQtYm94OyIgKwoJCQkJCSJib3gtc2l6aW5nOmNvbnRlbnQtYm94O2Rpc3BsYXk6YmxvY2s7bWFyZ2luOjA7Ym9yZGVyOjA7cGFkZGluZzowIjsKCQkJCWNvbnRlbnRzLnN0eWxlLm1hcmdpblJpZ2h0ID0gY29udGVudHMuc3R5bGUud2lkdGggPSAiMCI7CgkJCQlkaXYuc3R5bGUud2lkdGggPSAiMXB4IjsKCgkJCQlyZWxpYWJsZU1hcmdpblJpZ2h0VmFsID0KCQkJCQkhcGFyc2VGbG9hdCggKCB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSggY29udGVudHMgKSB8fCB7fSApLm1hcmdpblJpZ2h0ICk7CgoJCQkJZGl2LnJlbW92ZUNoaWxkKCBjb250ZW50cyApOwoJCQl9CgoJCQkvLyBTdXBwb3J0OiBJRTYtOAoJCQkvLyBGaXJzdCBjaGVjayB0aGF0IGdldENsaWVudFJlY3RzIHdvcmtzIGFzIGV4cGVjdGVkCgkJCS8vIENoZWNrIGlmIHRhYmxlIGNlbGxzIHN0aWxsIGhhdmUgb2Zmc2V0V2lkdGgvSGVpZ2h0IHdoZW4gdGhleSBhcmUgc2V0CgkJCS8vIHRvIGRpc3BsYXk6bm9uZSBhbmQgdGhlcmUgYXJlIHN0aWxsIG90aGVyIHZpc2libGUgdGFibGUgY2VsbHMgaW4gYQoJCQkvLyB0YWJsZSByb3c7IGlmIHNvLCBvZmZzZXRXaWR0aC9IZWlnaHQgYXJlIG5vdCByZWxpYWJsZSBmb3IgdXNlIHdoZW4KCQkJLy8gZGV0ZXJtaW5pbmcgaWYgYW4gZWxlbWVudCBoYXMgYmVlbiBoaWRkZW4gZGlyZWN0bHkgdXNpbmcKCQkJLy8gZGlzcGxheTpub25lIChpdCBpcyBzdGlsbCBzYWZlIHRvIHVzZSBvZmZzZXRzIGlmIGEgcGFyZW50IGVsZW1lbnQgaXMKCQkJLy8gaGlkZGVuOyBkb24gc2FmZXR5IGdvZ2dsZXMgYW5kIHNlZSBidWcgIzQ1MTIgZm9yIG1vcmUgaW5mb3JtYXRpb24pLgoJCQlkaXYuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJcmVsaWFibGVIaWRkZW5PZmZzZXRzVmFsID0gZGl2LmdldENsaWVudFJlY3RzKCkubGVuZ3RoID09PSAwOwoJCQlpZiAoIHJlbGlhYmxlSGlkZGVuT2Zmc2V0c1ZhbCApIHsKCQkJCWRpdi5zdHlsZS5kaXNwbGF5ID0gIiI7CgkJCQlkaXYuaW5uZXJIVE1MID0gIjx0YWJsZT48dHI+PHRkPjwvdGQ+PHRkPnQ8L3RkPjwvdHI+PC90YWJsZT4iOwoJCQkJZGl2LmNoaWxkTm9kZXNbIDAgXS5zdHlsZS5ib3JkZXJDb2xsYXBzZSA9ICJzZXBhcmF0ZSI7CgkJCQljb250ZW50cyA9IGRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZSggInRkIiApOwoJCQkJY29udGVudHNbIDAgXS5zdHlsZS5jc3NUZXh0ID0gIm1hcmdpbjowO2JvcmRlcjowO3BhZGRpbmc6MDtkaXNwbGF5Om5vbmUiOwoJCQkJcmVsaWFibGVIaWRkZW5PZmZzZXRzVmFsID0gY29udGVudHNbIDAgXS5vZmZzZXRIZWlnaHQgPT09IDA7CgkJCQlpZiAoIHJlbGlhYmxlSGlkZGVuT2Zmc2V0c1ZhbCApIHsKCQkJCQljb250ZW50c1sgMCBdLnN0eWxlLmRpc3BsYXkgPSAiIjsKCQkJCQljb250ZW50c1sgMSBdLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQkJcmVsaWFibGVIaWRkZW5PZmZzZXRzVmFsID0gY29udGVudHNbIDAgXS5vZmZzZXRIZWlnaHQgPT09IDA7CgkJCQl9CgkJCX0KCgkJCS8vIFRlYXJkb3duCgkJCWRvY3VtZW50RWxlbWVudC5yZW1vdmVDaGlsZCggY29udGFpbmVyICk7CgkJfQoKCX0gKSgpOwoKCgl2YXIgZ2V0U3R5bGVzLCBjdXJDU1MsCgkJcnBvc2l0aW9uID0gL14odG9wfHJpZ2h0fGJvdHRvbXxsZWZ0KSQvOwoKCWlmICggd2luZG93LmdldENvbXB1dGVkU3R5bGUgKSB7CgkJZ2V0U3R5bGVzID0gZnVuY3Rpb24oIGVsZW0gKSB7CgoJCQkvLyBTdXBwb3J0OiBJRTw9MTErLCBGaXJlZm94PD0zMCsgKCMxNTA5OCwgIzE0MTUwKQoJCQkvLyBJRSB0aHJvd3Mgb24gZWxlbWVudHMgY3JlYXRlZCBpbiBwb3B1cHMKCQkJLy8gRkYgbWVhbndoaWxlIHRocm93cyBvbiBmcmFtZSBlbGVtZW50cyB0aHJvdWdoICJkZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlIgoJCQl2YXIgdmlldyA9IGVsZW0ub3duZXJEb2N1bWVudC5kZWZhdWx0VmlldzsKCgkJCWlmICggIXZpZXcgfHwgIXZpZXcub3BlbmVyICkgewoJCQkJdmlldyA9IHdpbmRvdzsKCQkJfQoKCQkJcmV0dXJuIHZpZXcuZ2V0Q29tcHV0ZWRTdHlsZSggZWxlbSApOwoJCX07CgoJCWN1ckNTUyA9IGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCBjb21wdXRlZCApIHsKCQkJdmFyIHdpZHRoLCBtaW5XaWR0aCwgbWF4V2lkdGgsIHJldCwKCQkJCXN0eWxlID0gZWxlbS5zdHlsZTsKCgkJCWNvbXB1dGVkID0gY29tcHV0ZWQgfHwgZ2V0U3R5bGVzKCBlbGVtICk7CgoJCQkvLyBnZXRQcm9wZXJ0eVZhbHVlIGlzIG9ubHkgbmVlZGVkIGZvciAuY3NzKCdmaWx0ZXInKSBpbiBJRTksIHNlZSAjMTI1MzcKCQkJcmV0ID0gY29tcHV0ZWQgPyBjb21wdXRlZC5nZXRQcm9wZXJ0eVZhbHVlKCBuYW1lICkgfHwgY29tcHV0ZWRbIG5hbWUgXSA6IHVuZGVmaW5lZDsKCgkJCS8vIFN1cHBvcnQ6IE9wZXJhIDEyLjF4IG9ubHkKCQkJLy8gRmFsbCBiYWNrIHRvIHN0eWxlIGV2ZW4gd2l0aG91dCBjb21wdXRlZAoJCQkvLyBjb21wdXRlZCBpcyB1bmRlZmluZWQgZm9yIGVsZW1zIG9uIGRvY3VtZW50IGZyYWdtZW50cwoJCQlpZiAoICggcmV0ID09PSAiIiB8fCByZXQgPT09IHVuZGVmaW5lZCApICYmICFqUXVlcnkuY29udGFpbnMoIGVsZW0ub3duZXJEb2N1bWVudCwgZWxlbSApICkgewoJCQkJcmV0ID0galF1ZXJ5LnN0eWxlKCBlbGVtLCBuYW1lICk7CgkJCX0KCgkJCWlmICggY29tcHV0ZWQgKSB7CgoJCQkJLy8gQSB0cmlidXRlIHRvIHRoZSAiYXdlc29tZSBoYWNrIGJ5IERlYW4gRWR3YXJkcyIKCQkJCS8vIENocm9tZSA8IDE3IGFuZCBTYWZhcmkgNS4wIHVzZXMgImNvbXB1dGVkIHZhbHVlIgoJCQkJLy8gaW5zdGVhZCBvZiAidXNlZCB2YWx1ZSIgZm9yIG1hcmdpbi1yaWdodAoJCQkJLy8gU2FmYXJpIDUuMS43IChhdCBsZWFzdCkgcmV0dXJucyBwZXJjZW50YWdlIGZvciBhIGxhcmdlciBzZXQgb2YgdmFsdWVzLAoJCQkJLy8gYnV0IHdpZHRoIHNlZW1zIHRvIGJlIHJlbGlhYmx5IHBpeGVscwoJCQkJLy8gdGhpcyBpcyBhZ2FpbnN0IHRoZSBDU1NPTSBkcmFmdCBzcGVjOgoJCQkJLy8gaHR0cDovL2Rldi53My5vcmcvY3Nzd2cvY3Nzb20vI3Jlc29sdmVkLXZhbHVlcwoJCQkJaWYgKCAhc3VwcG9ydC5waXhlbE1hcmdpblJpZ2h0KCkgJiYgcm51bW5vbnB4LnRlc3QoIHJldCApICYmIHJtYXJnaW4udGVzdCggbmFtZSApICkgewoKCQkJCQkvLyBSZW1lbWJlciB0aGUgb3JpZ2luYWwgdmFsdWVzCgkJCQkJd2lkdGggPSBzdHlsZS53aWR0aDsKCQkJCQltaW5XaWR0aCA9IHN0eWxlLm1pbldpZHRoOwoJCQkJCW1heFdpZHRoID0gc3R5bGUubWF4V2lkdGg7CgoJCQkJCS8vIFB1dCBpbiB0aGUgbmV3IHZhbHVlcyB0byBnZXQgYSBjb21wdXRlZCB2YWx1ZSBvdXQKCQkJCQlzdHlsZS5taW5XaWR0aCA9IHN0eWxlLm1heFdpZHRoID0gc3R5bGUud2lkdGggPSByZXQ7CgkJCQkJcmV0ID0gY29tcHV0ZWQud2lkdGg7CgoJCQkJCS8vIFJldmVydCB0aGUgY2hhbmdlZCB2YWx1ZXMKCQkJCQlzdHlsZS53aWR0aCA9IHdpZHRoOwoJCQkJCXN0eWxlLm1pbldpZHRoID0gbWluV2lkdGg7CgkJCQkJc3R5bGUubWF4V2lkdGggPSBtYXhXaWR0aDsKCQkJCX0KCQkJfQoKCQkJLy8gU3VwcG9ydDogSUUKCQkJLy8gSUUgcmV0dXJucyB6SW5kZXggdmFsdWUgYXMgYW4gaW50ZWdlci4KCQkJcmV0dXJuIHJldCA9PT0gdW5kZWZpbmVkID8KCQkJCXJldCA6CgkJCQlyZXQgKyAiIjsKCQl9OwoJfSBlbHNlIGlmICggZG9jdW1lbnRFbGVtZW50LmN1cnJlbnRTdHlsZSApIHsKCQlnZXRTdHlsZXMgPSBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIGVsZW0uY3VycmVudFN0eWxlOwoJCX07CgoJCWN1ckNTUyA9IGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCBjb21wdXRlZCApIHsKCQkJdmFyIGxlZnQsIHJzLCByc0xlZnQsIHJldCwKCQkJCXN0eWxlID0gZWxlbS5zdHlsZTsKCgkJCWNvbXB1dGVkID0gY29tcHV0ZWQgfHwgZ2V0U3R5bGVzKCBlbGVtICk7CgkJCXJldCA9IGNvbXB1dGVkID8gY29tcHV0ZWRbIG5hbWUgXSA6IHVuZGVmaW5lZDsKCgkJCS8vIEF2b2lkIHNldHRpbmcgcmV0IHRvIGVtcHR5IHN0cmluZyBoZXJlCgkJCS8vIHNvIHdlIGRvbid0IGRlZmF1bHQgdG8gYXV0bwoJCQlpZiAoIHJldCA9PSBudWxsICYmIHN0eWxlICYmIHN0eWxlWyBuYW1lIF0gKSB7CgkJCQlyZXQgPSBzdHlsZVsgbmFtZSBdOwoJCQl9CgoJCQkvLyBGcm9tIHRoZSBhd2Vzb21lIGhhY2sgYnkgRGVhbiBFZHdhcmRzCgkJCS8vIGh0dHA6Ly9lcmlrLmVhZS5uZXQvYXJjaGl2ZXMvMjAwNy8wNy8yNy8xOC41NC4xNS8jY29tbWVudC0xMDIyOTEKCgkJCS8vIElmIHdlJ3JlIG5vdCBkZWFsaW5nIHdpdGggYSByZWd1bGFyIHBpeGVsIG51bWJlcgoJCQkvLyBidXQgYSBudW1iZXIgdGhhdCBoYXMgYSB3ZWlyZCBlbmRpbmcsIHdlIG5lZWQgdG8gY29udmVydCBpdCB0byBwaXhlbHMKCQkJLy8gYnV0IG5vdCBwb3NpdGlvbiBjc3MgYXR0cmlidXRlcywgYXMgdGhvc2UgYXJlCgkJCS8vIHByb3BvcnRpb25hbCB0byB0aGUgcGFyZW50IGVsZW1lbnQgaW5zdGVhZAoJCQkvLyBhbmQgd2UgY2FuJ3QgbWVhc3VyZSB0aGUgcGFyZW50IGluc3RlYWQgYmVjYXVzZSBpdAoJCQkvLyBtaWdodCB0cmlnZ2VyIGEgInN0YWNraW5nIGRvbGxzIiBwcm9ibGVtCgkJCWlmICggcm51bW5vbnB4LnRlc3QoIHJldCApICYmICFycG9zaXRpb24udGVzdCggbmFtZSApICkgewoKCQkJCS8vIFJlbWVtYmVyIHRoZSBvcmlnaW5hbCB2YWx1ZXMKCQkJCWxlZnQgPSBzdHlsZS5sZWZ0OwoJCQkJcnMgPSBlbGVtLnJ1bnRpbWVTdHlsZTsKCQkJCXJzTGVmdCA9IHJzICYmIHJzLmxlZnQ7CgoJCQkJLy8gUHV0IGluIHRoZSBuZXcgdmFsdWVzIHRvIGdldCBhIGNvbXB1dGVkIHZhbHVlIG91dAoJCQkJaWYgKCByc0xlZnQgKSB7CgkJCQkJcnMubGVmdCA9IGVsZW0uY3VycmVudFN0eWxlLmxlZnQ7CgkJCQl9CgkJCQlzdHlsZS5sZWZ0ID0gbmFtZSA9PT0gImZvbnRTaXplIiA/ICIxZW0iIDogcmV0OwoJCQkJcmV0ID0gc3R5bGUucGl4ZWxMZWZ0ICsgInB4IjsKCgkJCQkvLyBSZXZlcnQgdGhlIGNoYW5nZWQgdmFsdWVzCgkJCQlzdHlsZS5sZWZ0ID0gbGVmdDsKCQkJCWlmICggcnNMZWZ0ICkgewoJCQkJCXJzLmxlZnQgPSByc0xlZnQ7CgkJCQl9CgkJCX0KCgkJCS8vIFN1cHBvcnQ6IElFCgkJCS8vIElFIHJldHVybnMgekluZGV4IHZhbHVlIGFzIGFuIGludGVnZXIuCgkJCXJldHVybiByZXQgPT09IHVuZGVmaW5lZCA/CgkJCQlyZXQgOgoJCQkJcmV0ICsgIiIgfHwgImF1dG8iOwoJCX07Cgl9CgoKCgoJZnVuY3Rpb24gYWRkR2V0SG9va0lmKCBjb25kaXRpb25GbiwgaG9va0ZuICkgewoKCQkvLyBEZWZpbmUgdGhlIGhvb2ssIHdlJ2xsIGNoZWNrIG9uIHRoZSBmaXJzdCBydW4gaWYgaXQncyByZWFsbHkgbmVlZGVkLgoJCXJldHVybiB7CgkJCWdldDogZnVuY3Rpb24oKSB7CgkJCQlpZiAoIGNvbmRpdGlvbkZuKCkgKSB7CgoJCQkJCS8vIEhvb2sgbm90IG5lZWRlZCAob3IgaXQncyBub3QgcG9zc2libGUgdG8gdXNlIGl0IGR1ZQoJCQkJCS8vIHRvIG1pc3NpbmcgZGVwZW5kZW5jeSksIHJlbW92ZSBpdC4KCQkJCQlkZWxldGUgdGhpcy5nZXQ7CgkJCQkJcmV0dXJuOwoJCQkJfQoKCQkJCS8vIEhvb2sgbmVlZGVkOyByZWRlZmluZSBpdCBzbyB0aGF0IHRoZSBzdXBwb3J0IHRlc3QgaXMgbm90IGV4ZWN1dGVkIGFnYWluLgoJCQkJcmV0dXJuICggdGhpcy5nZXQgPSBob29rRm4gKS5hcHBseSggdGhpcywgYXJndW1lbnRzICk7CgkJCX0KCQl9OwoJfQoKCgl2YXIKCgkJCXJhbHBoYSA9IC9hbHBoYVwoW14pXSpcKS9pLAoJCXJvcGFjaXR5ID0gL29wYWNpdHlccyo9XHMqKFteKV0qKS9pLAoKCQkvLyBzd2FwcGFibGUgaWYgZGlzcGxheSBpcyBub25lIG9yIHN0YXJ0cyB3aXRoIHRhYmxlIGV4Y2VwdAoJCS8vICJ0YWJsZSIsICJ0YWJsZS1jZWxsIiwgb3IgInRhYmxlLWNhcHRpb24iCgkJLy8gc2VlIGhlcmUgZm9yIGRpc3BsYXkgdmFsdWVzOgoJCS8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvQ1NTL2Rpc3BsYXkKCQlyZGlzcGxheXN3YXAgPSAvXihub25lfHRhYmxlKD8hLWNbZWFdKS4rKS8sCgkJcm51bXNwbGl0ID0gbmV3IFJlZ0V4cCggIl4oIiArIHBudW0gKyAiKSguKikkIiwgImkiICksCgoJCWNzc1Nob3cgPSB7IHBvc2l0aW9uOiAiYWJzb2x1dGUiLCB2aXNpYmlsaXR5OiAiaGlkZGVuIiwgZGlzcGxheTogImJsb2NrIiB9LAoJCWNzc05vcm1hbFRyYW5zZm9ybSA9IHsKCQkJbGV0dGVyU3BhY2luZzogIjAiLAoJCQlmb250V2VpZ2h0OiAiNDAwIgoJCX0sCgoJCWNzc1ByZWZpeGVzID0gWyAiV2Via2l0IiwgIk8iLCAiTW96IiwgIm1zIiBdLAoJCWVtcHR5U3R5bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAiZGl2IiApLnN0eWxlOwoKCgkvLyByZXR1cm4gYSBjc3MgcHJvcGVydHkgbWFwcGVkIHRvIGEgcG90ZW50aWFsbHkgdmVuZG9yIHByZWZpeGVkIHByb3BlcnR5CglmdW5jdGlvbiB2ZW5kb3JQcm9wTmFtZSggbmFtZSApIHsKCgkJLy8gc2hvcnRjdXQgZm9yIG5hbWVzIHRoYXQgYXJlIG5vdCB2ZW5kb3IgcHJlZml4ZWQKCQlpZiAoIG5hbWUgaW4gZW1wdHlTdHlsZSApIHsKCQkJcmV0dXJuIG5hbWU7CgkJfQoKCQkvLyBjaGVjayBmb3IgdmVuZG9yIHByZWZpeGVkIG5hbWVzCgkJdmFyIGNhcE5hbWUgPSBuYW1lLmNoYXJBdCggMCApLnRvVXBwZXJDYXNlKCkgKyBuYW1lLnNsaWNlKCAxICksCgkJCWkgPSBjc3NQcmVmaXhlcy5sZW5ndGg7CgoJCXdoaWxlICggaS0tICkgewoJCQluYW1lID0gY3NzUHJlZml4ZXNbIGkgXSArIGNhcE5hbWU7CgkJCWlmICggbmFtZSBpbiBlbXB0eVN0eWxlICkgewoJCQkJcmV0dXJuIG5hbWU7CgkJCX0KCQl9Cgl9CgoJZnVuY3Rpb24gc2hvd0hpZGUoIGVsZW1lbnRzLCBzaG93ICkgewoJCXZhciBkaXNwbGF5LCBlbGVtLCBoaWRkZW4sCgkJCXZhbHVlcyA9IFtdLAoJCQlpbmRleCA9IDAsCgkJCWxlbmd0aCA9IGVsZW1lbnRzLmxlbmd0aDsKCgkJZm9yICggOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKyApIHsKCQkJZWxlbSA9IGVsZW1lbnRzWyBpbmRleCBdOwoJCQlpZiAoICFlbGVtLnN0eWxlICkgewoJCQkJY29udGludWU7CgkJCX0KCgkJCXZhbHVlc1sgaW5kZXggXSA9IGpRdWVyeS5fZGF0YSggZWxlbSwgIm9sZGRpc3BsYXkiICk7CgkJCWRpc3BsYXkgPSBlbGVtLnN0eWxlLmRpc3BsYXk7CgkJCWlmICggc2hvdyApIHsKCgkJCQkvLyBSZXNldCB0aGUgaW5saW5lIGRpc3BsYXkgb2YgdGhpcyBlbGVtZW50IHRvIGxlYXJuIGlmIGl0IGlzCgkJCQkvLyBiZWluZyBoaWRkZW4gYnkgY2FzY2FkZWQgcnVsZXMgb3Igbm90CgkJCQlpZiAoICF2YWx1ZXNbIGluZGV4IF0gJiYgZGlzcGxheSA9PT0gIm5vbmUiICkgewoJCQkJCWVsZW0uc3R5bGUuZGlzcGxheSA9ICIiOwoJCQkJfQoKCQkJCS8vIFNldCBlbGVtZW50cyB3aGljaCBoYXZlIGJlZW4gb3ZlcnJpZGRlbiB3aXRoIGRpc3BsYXk6IG5vbmUKCQkJCS8vIGluIGEgc3R5bGVzaGVldCB0byB3aGF0ZXZlciB0aGUgZGVmYXVsdCBicm93c2VyIHN0eWxlIGlzCgkJCQkvLyBmb3Igc3VjaCBhbiBlbGVtZW50CgkJCQlpZiAoIGVsZW0uc3R5bGUuZGlzcGxheSA9PT0gIiIgJiYgaXNIaWRkZW4oIGVsZW0gKSApIHsKCQkJCQl2YWx1ZXNbIGluZGV4IF0gPQoJCQkJCQlqUXVlcnkuX2RhdGEoIGVsZW0sICJvbGRkaXNwbGF5IiwgZGVmYXVsdERpc3BsYXkoIGVsZW0ubm9kZU5hbWUgKSApOwoJCQkJfQoJCQl9IGVsc2UgewoJCQkJaGlkZGVuID0gaXNIaWRkZW4oIGVsZW0gKTsKCgkJCQlpZiAoIGRpc3BsYXkgJiYgZGlzcGxheSAhPT0gIm5vbmUiIHx8ICFoaWRkZW4gKSB7CgkJCQkJalF1ZXJ5Ll9kYXRhKAoJCQkJCQllbGVtLAoJCQkJCQkib2xkZGlzcGxheSIsCgkJCQkJCWhpZGRlbiA/IGRpc3BsYXkgOiBqUXVlcnkuY3NzKCBlbGVtLCAiZGlzcGxheSIgKQoJCQkJCSk7CgkJCQl9CgkJCX0KCQl9CgoJCS8vIFNldCB0aGUgZGlzcGxheSBvZiBtb3N0IG9mIHRoZSBlbGVtZW50cyBpbiBhIHNlY29uZCBsb29wCgkJLy8gdG8gYXZvaWQgdGhlIGNvbnN0YW50IHJlZmxvdwoJCWZvciAoIGluZGV4ID0gMDsgaW5kZXggPCBsZW5ndGg7IGluZGV4KysgKSB7CgkJCWVsZW0gPSBlbGVtZW50c1sgaW5kZXggXTsKCQkJaWYgKCAhZWxlbS5zdHlsZSApIHsKCQkJCWNvbnRpbnVlOwoJCQl9CgkJCWlmICggIXNob3cgfHwgZWxlbS5zdHlsZS5kaXNwbGF5ID09PSAibm9uZSIgfHwgZWxlbS5zdHlsZS5kaXNwbGF5ID09PSAiIiApIHsKCQkJCWVsZW0uc3R5bGUuZGlzcGxheSA9IHNob3cgPyB2YWx1ZXNbIGluZGV4IF0gfHwgIiIgOiAibm9uZSI7CgkJCX0KCQl9CgoJCXJldHVybiBlbGVtZW50czsKCX0KCglmdW5jdGlvbiBzZXRQb3NpdGl2ZU51bWJlciggZWxlbSwgdmFsdWUsIHN1YnRyYWN0ICkgewoJCXZhciBtYXRjaGVzID0gcm51bXNwbGl0LmV4ZWMoIHZhbHVlICk7CgkJcmV0dXJuIG1hdGNoZXMgPwoKCQkJLy8gR3VhcmQgYWdhaW5zdCB1bmRlZmluZWQgInN1YnRyYWN0IiwgZS5nLiwgd2hlbiB1c2VkIGFzIGluIGNzc0hvb2tzCgkJCU1hdGgubWF4KCAwLCBtYXRjaGVzWyAxIF0gLSAoIHN1YnRyYWN0IHx8IDAgKSApICsgKCBtYXRjaGVzWyAyIF0gfHwgInB4IiApIDoKCQkJdmFsdWU7Cgl9CgoJZnVuY3Rpb24gYXVnbWVudFdpZHRoT3JIZWlnaHQoIGVsZW0sIG5hbWUsIGV4dHJhLCBpc0JvcmRlckJveCwgc3R5bGVzICkgewoJCXZhciBpID0gZXh0cmEgPT09ICggaXNCb3JkZXJCb3ggPyAiYm9yZGVyIiA6ICJjb250ZW50IiApID8KCgkJCS8vIElmIHdlIGFscmVhZHkgaGF2ZSB0aGUgcmlnaHQgbWVhc3VyZW1lbnQsIGF2b2lkIGF1Z21lbnRhdGlvbgoJCQk0IDoKCgkJCS8vIE90aGVyd2lzZSBpbml0aWFsaXplIGZvciBob3Jpem9udGFsIG9yIHZlcnRpY2FsIHByb3BlcnRpZXMKCQkJbmFtZSA9PT0gIndpZHRoIiA/IDEgOiAwLAoKCQkJdmFsID0gMDsKCgkJZm9yICggOyBpIDwgNDsgaSArPSAyICkgewoKCQkJLy8gYm90aCBib3ggbW9kZWxzIGV4Y2x1ZGUgbWFyZ2luLCBzbyBhZGQgaXQgaWYgd2Ugd2FudCBpdAoJCQlpZiAoIGV4dHJhID09PSAibWFyZ2luIiApIHsKCQkJCXZhbCArPSBqUXVlcnkuY3NzKCBlbGVtLCBleHRyYSArIGNzc0V4cGFuZFsgaSBdLCB0cnVlLCBzdHlsZXMgKTsKCQkJfQoKCQkJaWYgKCBpc0JvcmRlckJveCApIHsKCgkJCQkvLyBib3JkZXItYm94IGluY2x1ZGVzIHBhZGRpbmcsIHNvIHJlbW92ZSBpdCBpZiB3ZSB3YW50IGNvbnRlbnQKCQkJCWlmICggZXh0cmEgPT09ICJjb250ZW50IiApIHsKCQkJCQl2YWwgLT0galF1ZXJ5LmNzcyggZWxlbSwgInBhZGRpbmciICsgY3NzRXhwYW5kWyBpIF0sIHRydWUsIHN0eWxlcyApOwoJCQkJfQoKCQkJCS8vIGF0IHRoaXMgcG9pbnQsIGV4dHJhIGlzbid0IGJvcmRlciBub3IgbWFyZ2luLCBzbyByZW1vdmUgYm9yZGVyCgkJCQlpZiAoIGV4dHJhICE9PSAibWFyZ2luIiApIHsKCQkJCQl2YWwgLT0galF1ZXJ5LmNzcyggZWxlbSwgImJvcmRlciIgKyBjc3NFeHBhbmRbIGkgXSArICJXaWR0aCIsIHRydWUsIHN0eWxlcyApOwoJCQkJfQoJCQl9IGVsc2UgewoKCQkJCS8vIGF0IHRoaXMgcG9pbnQsIGV4dHJhIGlzbid0IGNvbnRlbnQsIHNvIGFkZCBwYWRkaW5nCgkJCQl2YWwgKz0galF1ZXJ5LmNzcyggZWxlbSwgInBhZGRpbmciICsgY3NzRXhwYW5kWyBpIF0sIHRydWUsIHN0eWxlcyApOwoKCQkJCS8vIGF0IHRoaXMgcG9pbnQsIGV4dHJhIGlzbid0IGNvbnRlbnQgbm9yIHBhZGRpbmcsIHNvIGFkZCBib3JkZXIKCQkJCWlmICggZXh0cmEgIT09ICJwYWRkaW5nIiApIHsKCQkJCQl2YWwgKz0galF1ZXJ5LmNzcyggZWxlbSwgImJvcmRlciIgKyBjc3NFeHBhbmRbIGkgXSArICJXaWR0aCIsIHRydWUsIHN0eWxlcyApOwoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gdmFsOwoJfQoKCWZ1bmN0aW9uIGdldFdpZHRoT3JIZWlnaHQoIGVsZW0sIG5hbWUsIGV4dHJhICkgewoKCQkvLyBTdGFydCB3aXRoIG9mZnNldCBwcm9wZXJ0eSwgd2hpY2ggaXMgZXF1aXZhbGVudCB0byB0aGUgYm9yZGVyLWJveCB2YWx1ZQoJCXZhciB2YWx1ZUlzQm9yZGVyQm94ID0gdHJ1ZSwKCQkJdmFsID0gbmFtZSA9PT0gIndpZHRoIiA/IGVsZW0ub2Zmc2V0V2lkdGggOiBlbGVtLm9mZnNldEhlaWdodCwKCQkJc3R5bGVzID0gZ2V0U3R5bGVzKCBlbGVtICksCgkJCWlzQm9yZGVyQm94ID0gc3VwcG9ydC5ib3hTaXppbmcgJiYKCQkJCWpRdWVyeS5jc3MoIGVsZW0sICJib3hTaXppbmciLCBmYWxzZSwgc3R5bGVzICkgPT09ICJib3JkZXItYm94IjsKCgkJLy8gc29tZSBub24taHRtbCBlbGVtZW50cyByZXR1cm4gdW5kZWZpbmVkIGZvciBvZmZzZXRXaWR0aCwgc28gY2hlY2sgZm9yIG51bGwvdW5kZWZpbmVkCgkJLy8gc3ZnIC0gaHR0cHM6Ly9idWd6aWxsYS5tb3ppbGxhLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9NjQ5Mjg1CgkJLy8gTWF0aE1MIC0gaHR0cHM6Ly9idWd6aWxsYS5tb3ppbGxhLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9NDkxNjY4CgkJaWYgKCB2YWwgPD0gMCB8fCB2YWwgPT0gbnVsbCApIHsKCgkJCS8vIEZhbGwgYmFjayB0byBjb21wdXRlZCB0aGVuIHVuY29tcHV0ZWQgY3NzIGlmIG5lY2Vzc2FyeQoJCQl2YWwgPSBjdXJDU1MoIGVsZW0sIG5hbWUsIHN0eWxlcyApOwoJCQlpZiAoIHZhbCA8IDAgfHwgdmFsID09IG51bGwgKSB7CgkJCQl2YWwgPSBlbGVtLnN0eWxlWyBuYW1lIF07CgkJCX0KCgkJCS8vIENvbXB1dGVkIHVuaXQgaXMgbm90IHBpeGVscy4gU3RvcCBoZXJlIGFuZCByZXR1cm4uCgkJCWlmICggcm51bW5vbnB4LnRlc3QoIHZhbCApICkgewoJCQkJcmV0dXJuIHZhbDsKCQkJfQoKCQkJLy8gd2UgbmVlZCB0aGUgY2hlY2sgZm9yIHN0eWxlIGluIGNhc2UgYSBicm93c2VyIHdoaWNoIHJldHVybnMgdW5yZWxpYWJsZSB2YWx1ZXMKCQkJLy8gZm9yIGdldENvbXB1dGVkU3R5bGUgc2lsZW50bHkgZmFsbHMgYmFjayB0byB0aGUgcmVsaWFibGUgZWxlbS5zdHlsZQoJCQl2YWx1ZUlzQm9yZGVyQm94ID0gaXNCb3JkZXJCb3ggJiYKCQkJCSggc3VwcG9ydC5ib3hTaXppbmdSZWxpYWJsZSgpIHx8IHZhbCA9PT0gZWxlbS5zdHlsZVsgbmFtZSBdICk7CgoJCQkvLyBOb3JtYWxpemUgIiIsIGF1dG8sIGFuZCBwcmVwYXJlIGZvciBleHRyYQoJCQl2YWwgPSBwYXJzZUZsb2F0KCB2YWwgKSB8fCAwOwoJCX0KCgkJLy8gdXNlIHRoZSBhY3RpdmUgYm94LXNpemluZyBtb2RlbCB0byBhZGQvc3VidHJhY3QgaXJyZWxldmFudCBzdHlsZXMKCQlyZXR1cm4gKCB2YWwgKwoJCQlhdWdtZW50V2lkdGhPckhlaWdodCgKCQkJCWVsZW0sCgkJCQluYW1lLAoJCQkJZXh0cmEgfHwgKCBpc0JvcmRlckJveCA/ICJib3JkZXIiIDogImNvbnRlbnQiICksCgkJCQl2YWx1ZUlzQm9yZGVyQm94LAoJCQkJc3R5bGVzCgkJCSkKCQkpICsgInB4IjsKCX0KCglqUXVlcnkuZXh0ZW5kKCB7CgoJCS8vIEFkZCBpbiBzdHlsZSBwcm9wZXJ0eSBob29rcyBmb3Igb3ZlcnJpZGluZyB0aGUgZGVmYXVsdAoJCS8vIGJlaGF2aW9yIG9mIGdldHRpbmcgYW5kIHNldHRpbmcgYSBzdHlsZSBwcm9wZXJ0eQoJCWNzc0hvb2tzOiB7CgkJCW9wYWNpdHk6IHsKCQkJCWdldDogZnVuY3Rpb24oIGVsZW0sIGNvbXB1dGVkICkgewoJCQkJCWlmICggY29tcHV0ZWQgKSB7CgoJCQkJCQkvLyBXZSBzaG91bGQgYWx3YXlzIGdldCBhIG51bWJlciBiYWNrIGZyb20gb3BhY2l0eQoJCQkJCQl2YXIgcmV0ID0gY3VyQ1NTKCBlbGVtLCAib3BhY2l0eSIgKTsKCQkJCQkJcmV0dXJuIHJldCA9PT0gIiIgPyAiMSIgOiByZXQ7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfSwKCgkJLy8gRG9uJ3QgYXV0b21hdGljYWxseSBhZGQgInB4IiB0byB0aGVzZSBwb3NzaWJseS11bml0bGVzcyBwcm9wZXJ0aWVzCgkJY3NzTnVtYmVyOiB7CgkJCSJhbmltYXRpb25JdGVyYXRpb25Db3VudCI6IHRydWUsCgkJCSJjb2x1bW5Db3VudCI6IHRydWUsCgkJCSJmaWxsT3BhY2l0eSI6IHRydWUsCgkJCSJmbGV4R3JvdyI6IHRydWUsCgkJCSJmbGV4U2hyaW5rIjogdHJ1ZSwKCQkJImZvbnRXZWlnaHQiOiB0cnVlLAoJCQkibGluZUhlaWdodCI6IHRydWUsCgkJCSJvcGFjaXR5IjogdHJ1ZSwKCQkJIm9yZGVyIjogdHJ1ZSwKCQkJIm9ycGhhbnMiOiB0cnVlLAoJCQkid2lkb3dzIjogdHJ1ZSwKCQkJInpJbmRleCI6IHRydWUsCgkJCSJ6b29tIjogdHJ1ZQoJCX0sCgoJCS8vIEFkZCBpbiBwcm9wZXJ0aWVzIHdob3NlIG5hbWVzIHlvdSB3aXNoIHRvIGZpeCBiZWZvcmUKCQkvLyBzZXR0aW5nIG9yIGdldHRpbmcgdGhlIHZhbHVlCgkJY3NzUHJvcHM6IHsKCgkJCS8vIG5vcm1hbGl6ZSBmbG9hdCBjc3MgcHJvcGVydHkKCQkJImZsb2F0Ijogc3VwcG9ydC5jc3NGbG9hdCA/ICJjc3NGbG9hdCIgOiAic3R5bGVGbG9hdCIKCQl9LAoKCQkvLyBHZXQgYW5kIHNldCB0aGUgc3R5bGUgcHJvcGVydHkgb24gYSBET00gTm9kZQoJCXN0eWxlOiBmdW5jdGlvbiggZWxlbSwgbmFtZSwgdmFsdWUsIGV4dHJhICkgewoKCQkJLy8gRG9uJ3Qgc2V0IHN0eWxlcyBvbiB0ZXh0IGFuZCBjb21tZW50IG5vZGVzCgkJCWlmICggIWVsZW0gfHwgZWxlbS5ub2RlVHlwZSA9PT0gMyB8fCBlbGVtLm5vZGVUeXBlID09PSA4IHx8ICFlbGVtLnN0eWxlICkgewoJCQkJcmV0dXJuOwoJCQl9CgoJCQkvLyBNYWtlIHN1cmUgdGhhdCB3ZSdyZSB3b3JraW5nIHdpdGggdGhlIHJpZ2h0IG5hbWUKCQkJdmFyIHJldCwgdHlwZSwgaG9va3MsCgkJCQlvcmlnTmFtZSA9IGpRdWVyeS5jYW1lbENhc2UoIG5hbWUgKSwKCQkJCXN0eWxlID0gZWxlbS5zdHlsZTsKCgkJCW5hbWUgPSBqUXVlcnkuY3NzUHJvcHNbIG9yaWdOYW1lIF0gfHwKCQkJCSggalF1ZXJ5LmNzc1Byb3BzWyBvcmlnTmFtZSBdID0gdmVuZG9yUHJvcE5hbWUoIG9yaWdOYW1lICkgfHwgb3JpZ05hbWUgKTsKCgkJCS8vIGdldHMgaG9vayBmb3IgdGhlIHByZWZpeGVkIHZlcnNpb24KCQkJLy8gZm9sbG93ZWQgYnkgdGhlIHVucHJlZml4ZWQgdmVyc2lvbgoJCQlob29rcyA9IGpRdWVyeS5jc3NIb29rc1sgbmFtZSBdIHx8IGpRdWVyeS5jc3NIb29rc1sgb3JpZ05hbWUgXTsKCgkJCS8vIENoZWNrIGlmIHdlJ3JlIHNldHRpbmcgYSB2YWx1ZQoJCQlpZiAoIHZhbHVlICE9PSB1bmRlZmluZWQgKSB7CgkJCQl0eXBlID0gdHlwZW9mIHZhbHVlOwoKCQkJCS8vIENvbnZlcnQgIis9IiBvciAiLT0iIHRvIHJlbGF0aXZlIG51bWJlcnMgKCM3MzQ1KQoJCQkJaWYgKCB0eXBlID09PSAic3RyaW5nIiAmJiAoIHJldCA9IHJjc3NOdW0uZXhlYyggdmFsdWUgKSApICYmIHJldFsgMSBdICkgewoJCQkJCXZhbHVlID0gYWRqdXN0Q1NTKCBlbGVtLCBuYW1lLCByZXQgKTsKCgkJCQkJLy8gRml4ZXMgYnVnICM5MjM3CgkJCQkJdHlwZSA9ICJudW1iZXIiOwoJCQkJfQoKCQkJCS8vIE1ha2Ugc3VyZSB0aGF0IG51bGwgYW5kIE5hTiB2YWx1ZXMgYXJlbid0IHNldC4gU2VlOiAjNzExNgoJCQkJaWYgKCB2YWx1ZSA9PSBudWxsIHx8IHZhbHVlICE9PSB2YWx1ZSApIHsKCQkJCQlyZXR1cm47CgkJCQl9CgoJCQkJLy8gSWYgYSBudW1iZXIgd2FzIHBhc3NlZCBpbiwgYWRkIHRoZSB1bml0IChleGNlcHQgZm9yIGNlcnRhaW4gQ1NTIHByb3BlcnRpZXMpCgkJCQlpZiAoIHR5cGUgPT09ICJudW1iZXIiICkgewoJCQkJCXZhbHVlICs9IHJldCAmJiByZXRbIDMgXSB8fCAoIGpRdWVyeS5jc3NOdW1iZXJbIG9yaWdOYW1lIF0gPyAiIiA6ICJweCIgKTsKCQkJCX0KCgkJCQkvLyBGaXhlcyAjODkwOCwgaXQgY2FuIGJlIGRvbmUgbW9yZSBjb3JyZWN0bHkgYnkgc3BlY2lmaW5nIHNldHRlcnMgaW4gY3NzSG9va3MsCgkJCQkvLyBidXQgaXQgd291bGQgbWVhbiB0byBkZWZpbmUgZWlnaHQKCQkJCS8vIChmb3IgZXZlcnkgcHJvYmxlbWF0aWMgcHJvcGVydHkpIGlkZW50aWNhbCBmdW5jdGlvbnMKCQkJCWlmICggIXN1cHBvcnQuY2xlYXJDbG9uZVN0eWxlICYmIHZhbHVlID09PSAiIiAmJiBuYW1lLmluZGV4T2YoICJiYWNrZ3JvdW5kIiApID09PSAwICkgewoJCQkJCXN0eWxlWyBuYW1lIF0gPSAiaW5oZXJpdCI7CgkJCQl9CgoJCQkJLy8gSWYgYSBob29rIHdhcyBwcm92aWRlZCwgdXNlIHRoYXQgdmFsdWUsIG90aGVyd2lzZSBqdXN0IHNldCB0aGUgc3BlY2lmaWVkIHZhbHVlCgkJCQlpZiAoICFob29rcyB8fCAhKCAic2V0IiBpbiBob29rcyApIHx8CgkJCQkJKCB2YWx1ZSA9IGhvb2tzLnNldCggZWxlbSwgdmFsdWUsIGV4dHJhICkgKSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQkvLyBTdXBwb3J0OiBJRQoJCQkJCS8vIFN3YWxsb3cgZXJyb3JzIGZyb20gJ2ludmFsaWQnIENTUyB2YWx1ZXMgKCM1NTA5KQoJCQkJCXRyeSB7CgkJCQkJCXN0eWxlWyBuYW1lIF0gPSB2YWx1ZTsKCQkJCQl9IGNhdGNoICggZSApIHt9CgkJCQl9CgoJCQl9IGVsc2UgewoKCQkJCS8vIElmIGEgaG9vayB3YXMgcHJvdmlkZWQgZ2V0IHRoZSBub24tY29tcHV0ZWQgdmFsdWUgZnJvbSB0aGVyZQoJCQkJaWYgKCBob29rcyAmJiAiZ2V0IiBpbiBob29rcyAmJgoJCQkJCSggcmV0ID0gaG9va3MuZ2V0KCBlbGVtLCBmYWxzZSwgZXh0cmEgKSApICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCXJldHVybiByZXQ7CgkJCQl9CgoJCQkJLy8gT3RoZXJ3aXNlIGp1c3QgZ2V0IHRoZSB2YWx1ZSBmcm9tIHRoZSBzdHlsZSBvYmplY3QKCQkJCXJldHVybiBzdHlsZVsgbmFtZSBdOwoJCQl9CgkJfSwKCgkJY3NzOiBmdW5jdGlvbiggZWxlbSwgbmFtZSwgZXh0cmEsIHN0eWxlcyApIHsKCQkJdmFyIG51bSwgdmFsLCBob29rcywKCQkJCW9yaWdOYW1lID0galF1ZXJ5LmNhbWVsQ2FzZSggbmFtZSApOwoKCQkJLy8gTWFrZSBzdXJlIHRoYXQgd2UncmUgd29ya2luZyB3aXRoIHRoZSByaWdodCBuYW1lCgkJCW5hbWUgPSBqUXVlcnkuY3NzUHJvcHNbIG9yaWdOYW1lIF0gfHwKCQkJCSggalF1ZXJ5LmNzc1Byb3BzWyBvcmlnTmFtZSBdID0gdmVuZG9yUHJvcE5hbWUoIG9yaWdOYW1lICkgfHwgb3JpZ05hbWUgKTsKCgkJCS8vIGdldHMgaG9vayBmb3IgdGhlIHByZWZpeGVkIHZlcnNpb24KCQkJLy8gZm9sbG93ZWQgYnkgdGhlIHVucHJlZml4ZWQgdmVyc2lvbgoJCQlob29rcyA9IGpRdWVyeS5jc3NIb29rc1sgbmFtZSBdIHx8IGpRdWVyeS5jc3NIb29rc1sgb3JpZ05hbWUgXTsKCgkJCS8vIElmIGEgaG9vayB3YXMgcHJvdmlkZWQgZ2V0IHRoZSBjb21wdXRlZCB2YWx1ZSBmcm9tIHRoZXJlCgkJCWlmICggaG9va3MgJiYgImdldCIgaW4gaG9va3MgKSB7CgkJCQl2YWwgPSBob29rcy5nZXQoIGVsZW0sIHRydWUsIGV4dHJhICk7CgkJCX0KCgkJCS8vIE90aGVyd2lzZSwgaWYgYSB3YXkgdG8gZ2V0IHRoZSBjb21wdXRlZCB2YWx1ZSBleGlzdHMsIHVzZSB0aGF0CgkJCWlmICggdmFsID09PSB1bmRlZmluZWQgKSB7CgkJCQl2YWwgPSBjdXJDU1MoIGVsZW0sIG5hbWUsIHN0eWxlcyApOwoJCQl9CgoJCQkvL2NvbnZlcnQgIm5vcm1hbCIgdG8gY29tcHV0ZWQgdmFsdWUKCQkJaWYgKCB2YWwgPT09ICJub3JtYWwiICYmIG5hbWUgaW4gY3NzTm9ybWFsVHJhbnNmb3JtICkgewoJCQkJdmFsID0gY3NzTm9ybWFsVHJhbnNmb3JtWyBuYW1lIF07CgkJCX0KCgkJCS8vIFJldHVybiwgY29udmVydGluZyB0byBudW1iZXIgaWYgZm9yY2VkIG9yIGEgcXVhbGlmaWVyIHdhcyBwcm92aWRlZCBhbmQgdmFsIGxvb2tzIG51bWVyaWMKCQkJaWYgKCBleHRyYSA9PT0gIiIgfHwgZXh0cmEgKSB7CgkJCQludW0gPSBwYXJzZUZsb2F0KCB2YWwgKTsKCQkJCXJldHVybiBleHRyYSA9PT0gdHJ1ZSB8fCBpc0Zpbml0ZSggbnVtICkgPyBudW0gfHwgMCA6IHZhbDsKCQkJfQoJCQlyZXR1cm4gdmFsOwoJCX0KCX0gKTsKCglqUXVlcnkuZWFjaCggWyAiaGVpZ2h0IiwgIndpZHRoIiBdLCBmdW5jdGlvbiggaSwgbmFtZSApIHsKCQlqUXVlcnkuY3NzSG9va3NbIG5hbWUgXSA9IHsKCQkJZ2V0OiBmdW5jdGlvbiggZWxlbSwgY29tcHV0ZWQsIGV4dHJhICkgewoJCQkJaWYgKCBjb21wdXRlZCApIHsKCgkJCQkJLy8gY2VydGFpbiBlbGVtZW50cyBjYW4gaGF2ZSBkaW1lbnNpb24gaW5mbyBpZiB3ZSBpbnZpc2libHkgc2hvdyB0aGVtCgkJCQkJLy8gaG93ZXZlciwgaXQgbXVzdCBoYXZlIGEgY3VycmVudCBkaXNwbGF5IHN0eWxlIHRoYXQgd291bGQgYmVuZWZpdCBmcm9tIHRoaXMKCQkJCQlyZXR1cm4gcmRpc3BsYXlzd2FwLnRlc3QoIGpRdWVyeS5jc3MoIGVsZW0sICJkaXNwbGF5IiApICkgJiYKCQkJCQkJZWxlbS5vZmZzZXRXaWR0aCA9PT0gMCA/CgkJCQkJCQlzd2FwKCBlbGVtLCBjc3NTaG93LCBmdW5jdGlvbigpIHsKCQkJCQkJCQlyZXR1cm4gZ2V0V2lkdGhPckhlaWdodCggZWxlbSwgbmFtZSwgZXh0cmEgKTsKCQkJCQkJCX0gKSA6CgkJCQkJCQlnZXRXaWR0aE9ySGVpZ2h0KCBlbGVtLCBuYW1lLCBleHRyYSApOwoJCQkJfQoJCQl9LAoKCQkJc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUsIGV4dHJhICkgewoJCQkJdmFyIHN0eWxlcyA9IGV4dHJhICYmIGdldFN0eWxlcyggZWxlbSApOwoJCQkJcmV0dXJuIHNldFBvc2l0aXZlTnVtYmVyKCBlbGVtLCB2YWx1ZSwgZXh0cmEgPwoJCQkJCWF1Z21lbnRXaWR0aE9ySGVpZ2h0KAoJCQkJCQllbGVtLAoJCQkJCQluYW1lLAoJCQkJCQlleHRyYSwKCQkJCQkJc3VwcG9ydC5ib3hTaXppbmcgJiYKCQkJCQkJCWpRdWVyeS5jc3MoIGVsZW0sICJib3hTaXppbmciLCBmYWxzZSwgc3R5bGVzICkgPT09ICJib3JkZXItYm94IiwKCQkJCQkJc3R5bGVzCgkJCQkJKSA6IDAKCQkJCSk7CgkJCX0KCQl9OwoJfSApOwoKCWlmICggIXN1cHBvcnQub3BhY2l0eSApIHsKCQlqUXVlcnkuY3NzSG9va3Mub3BhY2l0eSA9IHsKCQkJZ2V0OiBmdW5jdGlvbiggZWxlbSwgY29tcHV0ZWQgKSB7CgoJCQkJLy8gSUUgdXNlcyBmaWx0ZXJzIGZvciBvcGFjaXR5CgkJCQlyZXR1cm4gcm9wYWNpdHkudGVzdCggKCBjb21wdXRlZCAmJiBlbGVtLmN1cnJlbnRTdHlsZSA/CgkJCQkJZWxlbS5jdXJyZW50U3R5bGUuZmlsdGVyIDoKCQkJCQllbGVtLnN0eWxlLmZpbHRlciApIHx8ICIiICkgPwoJCQkJCQkoIDAuMDEgKiBwYXJzZUZsb2F0KCBSZWdFeHAuJDEgKSApICsgIiIgOgoJCQkJCQljb21wdXRlZCA/ICIxIiA6ICIiOwoJCQl9LAoKCQkJc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUgKSB7CgkJCQl2YXIgc3R5bGUgPSBlbGVtLnN0eWxlLAoJCQkJCWN1cnJlbnRTdHlsZSA9IGVsZW0uY3VycmVudFN0eWxlLAoJCQkJCW9wYWNpdHkgPSBqUXVlcnkuaXNOdW1lcmljKCB2YWx1ZSApID8gImFscGhhKG9wYWNpdHk9IiArIHZhbHVlICogMTAwICsgIikiIDogIiIsCgkJCQkJZmlsdGVyID0gY3VycmVudFN0eWxlICYmIGN1cnJlbnRTdHlsZS5maWx0ZXIgfHwgc3R5bGUuZmlsdGVyIHx8ICIiOwoKCQkJCS8vIElFIGhhcyB0cm91YmxlIHdpdGggb3BhY2l0eSBpZiBpdCBkb2VzIG5vdCBoYXZlIGxheW91dAoJCQkJLy8gRm9yY2UgaXQgYnkgc2V0dGluZyB0aGUgem9vbSBsZXZlbAoJCQkJc3R5bGUuem9vbSA9IDE7CgoJCQkJLy8gaWYgc2V0dGluZyBvcGFjaXR5IHRvIDEsIGFuZCBubyBvdGhlciBmaWx0ZXJzIGV4aXN0IC0KCQkJCS8vIGF0dGVtcHQgdG8gcmVtb3ZlIGZpbHRlciBhdHRyaWJ1dGUgIzY2NTIKCQkJCS8vIGlmIHZhbHVlID09PSAiIiwgdGhlbiByZW1vdmUgaW5saW5lIG9wYWNpdHkgIzEyNjg1CgkJCQlpZiAoICggdmFsdWUgPj0gMSB8fCB2YWx1ZSA9PT0gIiIgKSAmJgoJCQkJCQlqUXVlcnkudHJpbSggZmlsdGVyLnJlcGxhY2UoIHJhbHBoYSwgIiIgKSApID09PSAiIiAmJgoJCQkJCQlzdHlsZS5yZW1vdmVBdHRyaWJ1dGUgKSB7CgoJCQkJCS8vIFNldHRpbmcgc3R5bGUuZmlsdGVyIHRvIG51bGwsICIiICYgIiAiIHN0aWxsIGxlYXZlICJmaWx0ZXI6IiBpbiB0aGUgY3NzVGV4dAoJCQkJCS8vIGlmICJmaWx0ZXI6IiBpcyBwcmVzZW50IGF0IGFsbCwgY2xlYXJUeXBlIGlzIGRpc2FibGVkLCB3ZSB3YW50IHRvIGF2b2lkIHRoaXMKCQkJCQkvLyBzdHlsZS5yZW1vdmVBdHRyaWJ1dGUgaXMgSUUgT25seSwgYnV0IHNvIGFwcGFyZW50bHkgaXMgdGhpcyBjb2RlIHBhdGguLi4KCQkJCQlzdHlsZS5yZW1vdmVBdHRyaWJ1dGUoICJmaWx0ZXIiICk7CgoJCQkJCS8vIGlmIHRoZXJlIGlzIG5vIGZpbHRlciBzdHlsZSBhcHBsaWVkIGluIGEgY3NzIHJ1bGUKCQkJCQkvLyBvciB1bnNldCBpbmxpbmUgb3BhY2l0eSwgd2UgYXJlIGRvbmUKCQkJCQlpZiAoIHZhbHVlID09PSAiIiB8fCBjdXJyZW50U3R5bGUgJiYgIWN1cnJlbnRTdHlsZS5maWx0ZXIgKSB7CgkJCQkJCXJldHVybjsKCQkJCQl9CgkJCQl9CgoJCQkJLy8gb3RoZXJ3aXNlLCBzZXQgbmV3IGZpbHRlciB2YWx1ZXMKCQkJCXN0eWxlLmZpbHRlciA9IHJhbHBoYS50ZXN0KCBmaWx0ZXIgKSA/CgkJCQkJZmlsdGVyLnJlcGxhY2UoIHJhbHBoYSwgb3BhY2l0eSApIDoKCQkJCQlmaWx0ZXIgKyAiICIgKyBvcGFjaXR5OwoJCQl9CgkJfTsKCX0KCglqUXVlcnkuY3NzSG9va3MubWFyZ2luUmlnaHQgPSBhZGRHZXRIb29rSWYoIHN1cHBvcnQucmVsaWFibGVNYXJnaW5SaWdodCwKCQlmdW5jdGlvbiggZWxlbSwgY29tcHV0ZWQgKSB7CgkJCWlmICggY29tcHV0ZWQgKSB7CgkJCQlyZXR1cm4gc3dhcCggZWxlbSwgeyAiZGlzcGxheSI6ICJpbmxpbmUtYmxvY2siIH0sCgkJCQkJY3VyQ1NTLCBbIGVsZW0sICJtYXJnaW5SaWdodCIgXSApOwoJCQl9CgkJfQoJKTsKCglqUXVlcnkuY3NzSG9va3MubWFyZ2luTGVmdCA9IGFkZEdldEhvb2tJZiggc3VwcG9ydC5yZWxpYWJsZU1hcmdpbkxlZnQsCgkJZnVuY3Rpb24oIGVsZW0sIGNvbXB1dGVkICkgewoJCQlpZiAoIGNvbXB1dGVkICkgewoJCQkJcmV0dXJuICgKCQkJCQlwYXJzZUZsb2F0KCBjdXJDU1MoIGVsZW0sICJtYXJnaW5MZWZ0IiApICkgfHwKCgkJCQkJLy8gU3VwcG9ydDogSUU8PTExKwoJCQkJCS8vIFJ1bm5pbmcgZ2V0Qm91bmRpbmdDbGllbnRSZWN0IG9uIGEgZGlzY29ubmVjdGVkIG5vZGUgaW4gSUUgdGhyb3dzIGFuIGVycm9yCgkJCQkJLy8gU3VwcG9ydDogSUU4IG9ubHkKCQkJCQkvLyBnZXRDbGllbnRSZWN0cygpIGVycm9ycyBvbiBkaXNjb25uZWN0ZWQgZWxlbXMKCQkJCQkoIGpRdWVyeS5jb250YWlucyggZWxlbS5vd25lckRvY3VtZW50LCBlbGVtICkgPwoJCQkJCQllbGVtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQgLQoJCQkJCQkJc3dhcCggZWxlbSwgeyBtYXJnaW5MZWZ0OiAwIH0sIGZ1bmN0aW9uKCkgewoJCQkJCQkJCXJldHVybiBlbGVtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQ7CgkJCQkJCQl9ICkgOgoJCQkJCQkwCgkJCQkJKQoJCQkJKSArICJweCI7CgkJCX0KCQl9CgkpOwoKCS8vIFRoZXNlIGhvb2tzIGFyZSB1c2VkIGJ5IGFuaW1hdGUgdG8gZXhwYW5kIHByb3BlcnRpZXMKCWpRdWVyeS5lYWNoKCB7CgkJbWFyZ2luOiAiIiwKCQlwYWRkaW5nOiAiIiwKCQlib3JkZXI6ICJXaWR0aCIKCX0sIGZ1bmN0aW9uKCBwcmVmaXgsIHN1ZmZpeCApIHsKCQlqUXVlcnkuY3NzSG9va3NbIHByZWZpeCArIHN1ZmZpeCBdID0gewoJCQlleHBhbmQ6IGZ1bmN0aW9uKCB2YWx1ZSApIHsKCQkJCXZhciBpID0gMCwKCQkJCQlleHBhbmRlZCA9IHt9LAoKCQkJCQkvLyBhc3N1bWVzIGEgc2luZ2xlIG51bWJlciBpZiBub3QgYSBzdHJpbmcKCQkJCQlwYXJ0cyA9IHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIgPyB2YWx1ZS5zcGxpdCggIiAiICkgOiBbIHZhbHVlIF07CgoJCQkJZm9yICggOyBpIDwgNDsgaSsrICkgewoJCQkJCWV4cGFuZGVkWyBwcmVmaXggKyBjc3NFeHBhbmRbIGkgXSArIHN1ZmZpeCBdID0KCQkJCQkJcGFydHNbIGkgXSB8fCBwYXJ0c1sgaSAtIDIgXSB8fCBwYXJ0c1sgMCBdOwoJCQkJfQoKCQkJCXJldHVybiBleHBhbmRlZDsKCQkJfQoJCX07CgoJCWlmICggIXJtYXJnaW4udGVzdCggcHJlZml4ICkgKSB7CgkJCWpRdWVyeS5jc3NIb29rc1sgcHJlZml4ICsgc3VmZml4IF0uc2V0ID0gc2V0UG9zaXRpdmVOdW1iZXI7CgkJfQoJfSApOwoKCWpRdWVyeS5mbi5leHRlbmQoIHsKCQljc3M6IGZ1bmN0aW9uKCBuYW1lLCB2YWx1ZSApIHsKCQkJcmV0dXJuIGFjY2VzcyggdGhpcywgZnVuY3Rpb24oIGVsZW0sIG5hbWUsIHZhbHVlICkgewoJCQkJdmFyIHN0eWxlcywgbGVuLAoJCQkJCW1hcCA9IHt9LAoJCQkJCWkgPSAwOwoKCQkJCWlmICggalF1ZXJ5LmlzQXJyYXkoIG5hbWUgKSApIHsKCQkJCQlzdHlsZXMgPSBnZXRTdHlsZXMoIGVsZW0gKTsKCQkJCQlsZW4gPSBuYW1lLmxlbmd0aDsKCgkJCQkJZm9yICggOyBpIDwgbGVuOyBpKysgKSB7CgkJCQkJCW1hcFsgbmFtZVsgaSBdIF0gPSBqUXVlcnkuY3NzKCBlbGVtLCBuYW1lWyBpIF0sIGZhbHNlLCBzdHlsZXMgKTsKCQkJCQl9CgoJCQkJCXJldHVybiBtYXA7CgkJCQl9CgoJCQkJcmV0dXJuIHZhbHVlICE9PSB1bmRlZmluZWQgPwoJCQkJCWpRdWVyeS5zdHlsZSggZWxlbSwgbmFtZSwgdmFsdWUgKSA6CgkJCQkJalF1ZXJ5LmNzcyggZWxlbSwgbmFtZSApOwoJCQl9LCBuYW1lLCB2YWx1ZSwgYXJndW1lbnRzLmxlbmd0aCA+IDEgKTsKCQl9LAoJCXNob3c6IGZ1bmN0aW9uKCkgewoJCQlyZXR1cm4gc2hvd0hpZGUoIHRoaXMsIHRydWUgKTsKCQl9LAoJCWhpZGU6IGZ1bmN0aW9uKCkgewoJCQlyZXR1cm4gc2hvd0hpZGUoIHRoaXMgKTsKCQl9LAoJCXRvZ2dsZTogZnVuY3Rpb24oIHN0YXRlICkgewoJCQlpZiAoIHR5cGVvZiBzdGF0ZSA9PT0gImJvb2xlYW4iICkgewoJCQkJcmV0dXJuIHN0YXRlID8gdGhpcy5zaG93KCkgOiB0aGlzLmhpZGUoKTsKCQkJfQoKCQkJcmV0dXJuIHRoaXMuZWFjaCggZnVuY3Rpb24oKSB7CgkJCQlpZiAoIGlzSGlkZGVuKCB0aGlzICkgKSB7CgkJCQkJalF1ZXJ5KCB0aGlzICkuc2hvdygpOwoJCQkJfSBlbHNlIHsKCQkJCQlqUXVlcnkoIHRoaXMgKS5oaWRlKCk7CgkJCQl9CgkJCX0gKTsKCQl9Cgl9ICk7CgoKCWZ1bmN0aW9uIFR3ZWVuKCBlbGVtLCBvcHRpb25zLCBwcm9wLCBlbmQsIGVhc2luZyApIHsKCQlyZXR1cm4gbmV3IFR3ZWVuLnByb3RvdHlwZS5pbml0KCBlbGVtLCBvcHRpb25zLCBwcm9wLCBlbmQsIGVhc2luZyApOwoJfQoJalF1ZXJ5LlR3ZWVuID0gVHdlZW47CgoJVHdlZW4ucHJvdG90eXBlID0gewoJCWNvbnN0cnVjdG9yOiBUd2VlbiwKCQlpbml0OiBmdW5jdGlvbiggZWxlbSwgb3B0aW9ucywgcHJvcCwgZW5kLCBlYXNpbmcsIHVuaXQgKSB7CgkJCXRoaXMuZWxlbSA9IGVsZW07CgkJCXRoaXMucHJvcCA9IHByb3A7CgkJCXRoaXMuZWFzaW5nID0gZWFzaW5nIHx8IGpRdWVyeS5lYXNpbmcuX2RlZmF1bHQ7CgkJCXRoaXMub3B0aW9ucyA9IG9wdGlvbnM7CgkJCXRoaXMuc3RhcnQgPSB0aGlzLm5vdyA9IHRoaXMuY3VyKCk7CgkJCXRoaXMuZW5kID0gZW5kOwoJCQl0aGlzLnVuaXQgPSB1bml0IHx8ICggalF1ZXJ5LmNzc051bWJlclsgcHJvcCBdID8gIiIgOiAicHgiICk7CgkJfSwKCQljdXI6IGZ1bmN0aW9uKCkgewoJCQl2YXIgaG9va3MgPSBUd2Vlbi5wcm9wSG9va3NbIHRoaXMucHJvcCBdOwoKCQkJcmV0dXJuIGhvb2tzICYmIGhvb2tzLmdldCA/CgkJCQlob29rcy5nZXQoIHRoaXMgKSA6CgkJCQlUd2Vlbi5wcm9wSG9va3MuX2RlZmF1bHQuZ2V0KCB0aGlzICk7CgkJfSwKCQlydW46IGZ1bmN0aW9uKCBwZXJjZW50ICkgewoJCQl2YXIgZWFzZWQsCgkJCQlob29rcyA9IFR3ZWVuLnByb3BIb29rc1sgdGhpcy5wcm9wIF07CgoJCQlpZiAoIHRoaXMub3B0aW9ucy5kdXJhdGlvbiApIHsKCQkJCXRoaXMucG9zID0gZWFzZWQgPSBqUXVlcnkuZWFzaW5nWyB0aGlzLmVhc2luZyBdKAoJCQkJCXBlcmNlbnQsIHRoaXMub3B0aW9ucy5kdXJhdGlvbiAqIHBlcmNlbnQsIDAsIDEsIHRoaXMub3B0aW9ucy5kdXJhdGlvbgoJCQkJKTsKCQkJfSBlbHNlIHsKCQkJCXRoaXMucG9zID0gZWFzZWQgPSBwZXJjZW50OwoJCQl9CgkJCXRoaXMubm93ID0gKCB0aGlzLmVuZCAtIHRoaXMuc3RhcnQgKSAqIGVhc2VkICsgdGhpcy5zdGFydDsKCgkJCWlmICggdGhpcy5vcHRpb25zLnN0ZXAgKSB7CgkJCQl0aGlzLm9wdGlvbnMuc3RlcC5jYWxsKCB0aGlzLmVsZW0sIHRoaXMubm93LCB0aGlzICk7CgkJCX0KCgkJCWlmICggaG9va3MgJiYgaG9va3Muc2V0ICkgewoJCQkJaG9va3Muc2V0KCB0aGlzICk7CgkJCX0gZWxzZSB7CgkJCQlUd2Vlbi5wcm9wSG9va3MuX2RlZmF1bHQuc2V0KCB0aGlzICk7CgkJCX0KCQkJcmV0dXJuIHRoaXM7CgkJfQoJfTsKCglUd2Vlbi5wcm90b3R5cGUuaW5pdC5wcm90b3R5cGUgPSBUd2Vlbi5wcm90b3R5cGU7CgoJVHdlZW4ucHJvcEhvb2tzID0gewoJCV9kZWZhdWx0OiB7CgkJCWdldDogZnVuY3Rpb24oIHR3ZWVuICkgewoJCQkJdmFyIHJlc3VsdDsKCgkJCQkvLyBVc2UgYSBwcm9wZXJ0eSBvbiB0aGUgZWxlbWVudCBkaXJlY3RseSB3aGVuIGl0IGlzIG5vdCBhIERPTSBlbGVtZW50LAoJCQkJLy8gb3Igd2hlbiB0aGVyZSBpcyBubyBtYXRjaGluZyBzdHlsZSBwcm9wZXJ0eSB0aGF0IGV4aXN0cy4KCQkJCWlmICggdHdlZW4uZWxlbS5ub2RlVHlwZSAhPT0gMSB8fAoJCQkJCXR3ZWVuLmVsZW1bIHR3ZWVuLnByb3AgXSAhPSBudWxsICYmIHR3ZWVuLmVsZW0uc3R5bGVbIHR3ZWVuLnByb3AgXSA9PSBudWxsICkgewoJCQkJCXJldHVybiB0d2Vlbi5lbGVtWyB0d2Vlbi5wcm9wIF07CgkJCQl9CgoJCQkJLy8gcGFzc2luZyBhbiBlbXB0eSBzdHJpbmcgYXMgYSAzcmQgcGFyYW1ldGVyIHRvIC5jc3Mgd2lsbCBhdXRvbWF0aWNhbGx5CgkJCQkvLyBhdHRlbXB0IGEgcGFyc2VGbG9hdCBhbmQgZmFsbGJhY2sgdG8gYSBzdHJpbmcgaWYgdGhlIHBhcnNlIGZhaWxzCgkJCQkvLyBzbywgc2ltcGxlIHZhbHVlcyBzdWNoIGFzICIxMHB4IiBhcmUgcGFyc2VkIHRvIEZsb2F0LgoJCQkJLy8gY29tcGxleCB2YWx1ZXMgc3VjaCBhcyAicm90YXRlKDFyYWQpIiBhcmUgcmV0dXJuZWQgYXMgaXMuCgkJCQlyZXN1bHQgPSBqUXVlcnkuY3NzKCB0d2Vlbi5lbGVtLCB0d2Vlbi5wcm9wLCAiIiApOwoKCQkJCS8vIEVtcHR5IHN0cmluZ3MsIG51bGwsIHVuZGVmaW5lZCBhbmQgImF1dG8iIGFyZSBjb252ZXJ0ZWQgdG8gMC4KCQkJCXJldHVybiAhcmVzdWx0IHx8IHJlc3VsdCA9PT0gImF1dG8iID8gMCA6IHJlc3VsdDsKCQkJfSwKCQkJc2V0OiBmdW5jdGlvbiggdHdlZW4gKSB7CgoJCQkJLy8gdXNlIHN0ZXAgaG9vayBmb3IgYmFjayBjb21wYXQgLSB1c2UgY3NzSG9vayBpZiBpdHMgdGhlcmUgLSB1c2UgLnN0eWxlIGlmIGl0cwoJCQkJLy8gYXZhaWxhYmxlIGFuZCB1c2UgcGxhaW4gcHJvcGVydGllcyB3aGVyZSBhdmFpbGFibGUKCQkJCWlmICggalF1ZXJ5LmZ4LnN0ZXBbIHR3ZWVuLnByb3AgXSApIHsKCQkJCQlqUXVlcnkuZnguc3RlcFsgdHdlZW4ucHJvcCBdKCB0d2VlbiApOwoJCQkJfSBlbHNlIGlmICggdHdlZW4uZWxlbS5ub2RlVHlwZSA9PT0gMSAmJgoJCQkJCSggdHdlZW4uZWxlbS5zdHlsZVsgalF1ZXJ5LmNzc1Byb3BzWyB0d2Vlbi5wcm9wIF0gXSAhPSBudWxsIHx8CgkJCQkJCWpRdWVyeS5jc3NIb29rc1sgdHdlZW4ucHJvcCBdICkgKSB7CgkJCQkJalF1ZXJ5LnN0eWxlKCB0d2Vlbi5lbGVtLCB0d2Vlbi5wcm9wLCB0d2Vlbi5ub3cgKyB0d2Vlbi51bml0ICk7CgkJCQl9IGVsc2UgewoJCQkJCXR3ZWVuLmVsZW1bIHR3ZWVuLnByb3AgXSA9IHR3ZWVuLm5vdzsKCQkJCX0KCQkJfQoJCX0KCX07CgoJLy8gU3VwcG9ydDogSUUgPD05CgkvLyBQYW5pYyBiYXNlZCBhcHByb2FjaCB0byBzZXR0aW5nIHRoaW5ncyBvbiBkaXNjb25uZWN0ZWQgbm9kZXMKCglUd2Vlbi5wcm9wSG9va3Muc2Nyb2xsVG9wID0gVHdlZW4ucHJvcEhvb2tzLnNjcm9sbExlZnQgPSB7CgkJc2V0OiBmdW5jdGlvbiggdHdlZW4gKSB7CgkJCWlmICggdHdlZW4uZWxlbS5ub2RlVHlwZSAmJiB0d2Vlbi5lbGVtLnBhcmVudE5vZGUgKSB7CgkJCQl0d2Vlbi5lbGVtWyB0d2Vlbi5wcm9wIF0gPSB0d2Vlbi5ub3c7CgkJCX0KCQl9Cgl9OwoKCWpRdWVyeS5lYXNpbmcgPSB7CgkJbGluZWFyOiBmdW5jdGlvbiggcCApIHsKCQkJcmV0dXJuIHA7CgkJfSwKCQlzd2luZzogZnVuY3Rpb24oIHAgKSB7CgkJCXJldHVybiAwLjUgLSBNYXRoLmNvcyggcCAqIE1hdGguUEkgKSAvIDI7CgkJfSwKCQlfZGVmYXVsdDogInN3aW5nIgoJfTsKCglqUXVlcnkuZnggPSBUd2Vlbi5wcm90b3R5cGUuaW5pdDsKCgkvLyBCYWNrIENvbXBhdCA8MS44IGV4dGVuc2lvbiBwb2ludAoJalF1ZXJ5LmZ4LnN0ZXAgPSB7fTsKCgoKCgl2YXIKCQlmeE5vdywgdGltZXJJZCwKCQlyZnh0eXBlcyA9IC9eKD86dG9nZ2xlfHNob3d8aGlkZSkkLywKCQlycnVuID0gL3F1ZXVlSG9va3MkLzsKCgkvLyBBbmltYXRpb25zIGNyZWF0ZWQgc3luY2hyb25vdXNseSB3aWxsIHJ1biBzeW5jaHJvbm91c2x5CglmdW5jdGlvbiBjcmVhdGVGeE5vdygpIHsKCQl3aW5kb3cuc2V0VGltZW91dCggZnVuY3Rpb24oKSB7CgkJCWZ4Tm93ID0gdW5kZWZpbmVkOwoJCX0gKTsKCQlyZXR1cm4gKCBmeE5vdyA9IGpRdWVyeS5ub3coKSApOwoJfQoKCS8vIEdlbmVyYXRlIHBhcmFtZXRlcnMgdG8gY3JlYXRlIGEgc3RhbmRhcmQgYW5pbWF0aW9uCglmdW5jdGlvbiBnZW5GeCggdHlwZSwgaW5jbHVkZVdpZHRoICkgewoJCXZhciB3aGljaCwKCQkJYXR0cnMgPSB7IGhlaWdodDogdHlwZSB9LAoJCQlpID0gMDsKCgkJLy8gaWYgd2UgaW5jbHVkZSB3aWR0aCwgc3RlcCB2YWx1ZSBpcyAxIHRvIGRvIGFsbCBjc3NFeHBhbmQgdmFsdWVzLAoJCS8vIGlmIHdlIGRvbid0IGluY2x1ZGUgd2lkdGgsIHN0ZXAgdmFsdWUgaXMgMiB0byBza2lwIG92ZXIgTGVmdCBhbmQgUmlnaHQKCQlpbmNsdWRlV2lkdGggPSBpbmNsdWRlV2lkdGggPyAxIDogMDsKCQlmb3IgKCA7IGkgPCA0IDsgaSArPSAyIC0gaW5jbHVkZVdpZHRoICkgewoJCQl3aGljaCA9IGNzc0V4cGFuZFsgaSBdOwoJCQlhdHRyc1sgIm1hcmdpbiIgKyB3aGljaCBdID0gYXR0cnNbICJwYWRkaW5nIiArIHdoaWNoIF0gPSB0eXBlOwoJCX0KCgkJaWYgKCBpbmNsdWRlV2lkdGggKSB7CgkJCWF0dHJzLm9wYWNpdHkgPSBhdHRycy53aWR0aCA9IHR5cGU7CgkJfQoKCQlyZXR1cm4gYXR0cnM7Cgl9CgoJZnVuY3Rpb24gY3JlYXRlVHdlZW4oIHZhbHVlLCBwcm9wLCBhbmltYXRpb24gKSB7CgkJdmFyIHR3ZWVuLAoJCQljb2xsZWN0aW9uID0gKCBBbmltYXRpb24udHdlZW5lcnNbIHByb3AgXSB8fCBbXSApLmNvbmNhdCggQW5pbWF0aW9uLnR3ZWVuZXJzWyAiKiIgXSApLAoJCQlpbmRleCA9IDAsCgkJCWxlbmd0aCA9IGNvbGxlY3Rpb24ubGVuZ3RoOwoJCWZvciAoIDsgaW5kZXggPCBsZW5ndGg7IGluZGV4KysgKSB7CgkJCWlmICggKCB0d2VlbiA9IGNvbGxlY3Rpb25bIGluZGV4IF0uY2FsbCggYW5pbWF0aW9uLCBwcm9wLCB2YWx1ZSApICkgKSB7CgoJCQkJLy8gd2UncmUgZG9uZSB3aXRoIHRoaXMgcHJvcGVydHkKCQkJCXJldHVybiB0d2VlbjsKCQkJfQoJCX0KCX0KCglmdW5jdGlvbiBkZWZhdWx0UHJlZmlsdGVyKCBlbGVtLCBwcm9wcywgb3B0cyApIHsKCQkvKiBqc2hpbnQgdmFsaWR0aGlzOiB0cnVlICovCgkJdmFyIHByb3AsIHZhbHVlLCB0b2dnbGUsIHR3ZWVuLCBob29rcywgb2xkZmlyZSwgZGlzcGxheSwgY2hlY2tEaXNwbGF5LAoJCQlhbmltID0gdGhpcywKCQkJb3JpZyA9IHt9LAoJCQlzdHlsZSA9IGVsZW0uc3R5bGUsCgkJCWhpZGRlbiA9IGVsZW0ubm9kZVR5cGUgJiYgaXNIaWRkZW4oIGVsZW0gKSwKCQkJZGF0YVNob3cgPSBqUXVlcnkuX2RhdGEoIGVsZW0sICJmeHNob3ciICk7CgoJCS8vIGhhbmRsZSBxdWV1ZTogZmFsc2UgcHJvbWlzZXMKCQlpZiAoICFvcHRzLnF1ZXVlICkgewoJCQlob29rcyA9IGpRdWVyeS5fcXVldWVIb29rcyggZWxlbSwgImZ4IiApOwoJCQlpZiAoIGhvb2tzLnVucXVldWVkID09IG51bGwgKSB7CgkJCQlob29rcy51bnF1ZXVlZCA9IDA7CgkJCQlvbGRmaXJlID0gaG9va3MuZW1wdHkuZmlyZTsKCQkJCWhvb2tzLmVtcHR5LmZpcmUgPSBmdW5jdGlvbigpIHsKCQkJCQlpZiAoICFob29rcy51bnF1ZXVlZCApIHsKCQkJCQkJb2xkZmlyZSgpOwoJCQkJCX0KCQkJCX07CgkJCX0KCQkJaG9va3MudW5xdWV1ZWQrKzsKCgkJCWFuaW0uYWx3YXlzKCBmdW5jdGlvbigpIHsKCgkJCQkvLyBkb2luZyB0aGlzIG1ha2VzIHN1cmUgdGhhdCB0aGUgY29tcGxldGUgaGFuZGxlciB3aWxsIGJlIGNhbGxlZAoJCQkJLy8gYmVmb3JlIHRoaXMgY29tcGxldGVzCgkJCQlhbmltLmFsd2F5cyggZnVuY3Rpb24oKSB7CgkJCQkJaG9va3MudW5xdWV1ZWQtLTsKCQkJCQlpZiAoICFqUXVlcnkucXVldWUoIGVsZW0sICJmeCIgKS5sZW5ndGggKSB7CgkJCQkJCWhvb2tzLmVtcHR5LmZpcmUoKTsKCQkJCQl9CgkJCQl9ICk7CgkJCX0gKTsKCQl9CgoJCS8vIGhlaWdodC93aWR0aCBvdmVyZmxvdyBwYXNzCgkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxICYmICggImhlaWdodCIgaW4gcHJvcHMgfHwgIndpZHRoIiBpbiBwcm9wcyApICkgewoKCQkJLy8gTWFrZSBzdXJlIHRoYXQgbm90aGluZyBzbmVha3Mgb3V0CgkJCS8vIFJlY29yZCBhbGwgMyBvdmVyZmxvdyBhdHRyaWJ1dGVzIGJlY2F1c2UgSUUgZG9lcyBub3QKCQkJLy8gY2hhbmdlIHRoZSBvdmVyZmxvdyBhdHRyaWJ1dGUgd2hlbiBvdmVyZmxvd1ggYW5kCgkJCS8vIG92ZXJmbG93WSBhcmUgc2V0IHRvIHRoZSBzYW1lIHZhbHVlCgkJCW9wdHMub3ZlcmZsb3cgPSBbIHN0eWxlLm92ZXJmbG93LCBzdHlsZS5vdmVyZmxvd1gsIHN0eWxlLm92ZXJmbG93WSBdOwoKCQkJLy8gU2V0IGRpc3BsYXkgcHJvcGVydHkgdG8gaW5saW5lLWJsb2NrIGZvciBoZWlnaHQvd2lkdGgKCQkJLy8gYW5pbWF0aW9ucyBvbiBpbmxpbmUgZWxlbWVudHMgdGhhdCBhcmUgaGF2aW5nIHdpZHRoL2hlaWdodCBhbmltYXRlZAoJCQlkaXNwbGF5ID0galF1ZXJ5LmNzcyggZWxlbSwgImRpc3BsYXkiICk7CgoJCQkvLyBUZXN0IGRlZmF1bHQgZGlzcGxheSBpZiBkaXNwbGF5IGlzIGN1cnJlbnRseSAibm9uZSIKCQkJY2hlY2tEaXNwbGF5ID0gZGlzcGxheSA9PT0gIm5vbmUiID8KCQkJCWpRdWVyeS5fZGF0YSggZWxlbSwgIm9sZGRpc3BsYXkiICkgfHwgZGVmYXVsdERpc3BsYXkoIGVsZW0ubm9kZU5hbWUgKSA6IGRpc3BsYXk7CgoJCQlpZiAoIGNoZWNrRGlzcGxheSA9PT0gImlubGluZSIgJiYgalF1ZXJ5LmNzcyggZWxlbSwgImZsb2F0IiApID09PSAibm9uZSIgKSB7CgoJCQkJLy8gaW5saW5lLWxldmVsIGVsZW1lbnRzIGFjY2VwdCBpbmxpbmUtYmxvY2s7CgkJCQkvLyBibG9jay1sZXZlbCBlbGVtZW50cyBuZWVkIHRvIGJlIGlubGluZSB3aXRoIGxheW91dAoJCQkJaWYgKCAhc3VwcG9ydC5pbmxpbmVCbG9ja05lZWRzTGF5b3V0IHx8IGRlZmF1bHREaXNwbGF5KCBlbGVtLm5vZGVOYW1lICkgPT09ICJpbmxpbmUiICkgewoJCQkJCXN0eWxlLmRpc3BsYXkgPSAiaW5saW5lLWJsb2NrIjsKCQkJCX0gZWxzZSB7CgkJCQkJc3R5bGUuem9vbSA9IDE7CgkJCQl9CgkJCX0KCQl9CgoJCWlmICggb3B0cy5vdmVyZmxvdyApIHsKCQkJc3R5bGUub3ZlcmZsb3cgPSAiaGlkZGVuIjsKCQkJaWYgKCAhc3VwcG9ydC5zaHJpbmtXcmFwQmxvY2tzKCkgKSB7CgkJCQlhbmltLmFsd2F5cyggZnVuY3Rpb24oKSB7CgkJCQkJc3R5bGUub3ZlcmZsb3cgPSBvcHRzLm92ZXJmbG93WyAwIF07CgkJCQkJc3R5bGUub3ZlcmZsb3dYID0gb3B0cy5vdmVyZmxvd1sgMSBdOwoJCQkJCXN0eWxlLm92ZXJmbG93WSA9IG9wdHMub3ZlcmZsb3dbIDIgXTsKCQkJCX0gKTsKCQkJfQoJCX0KCgkJLy8gc2hvdy9oaWRlIHBhc3MKCQlmb3IgKCBwcm9wIGluIHByb3BzICkgewoJCQl2YWx1ZSA9IHByb3BzWyBwcm9wIF07CgkJCWlmICggcmZ4dHlwZXMuZXhlYyggdmFsdWUgKSApIHsKCQkJCWRlbGV0ZSBwcm9wc1sgcHJvcCBdOwoJCQkJdG9nZ2xlID0gdG9nZ2xlIHx8IHZhbHVlID09PSAidG9nZ2xlIjsKCQkJCWlmICggdmFsdWUgPT09ICggaGlkZGVuID8gImhpZGUiIDogInNob3ciICkgKSB7CgoJCQkJCS8vIElmIHRoZXJlIGlzIGRhdGFTaG93IGxlZnQgb3ZlciBmcm9tIGEgc3RvcHBlZCBoaWRlIG9yIHNob3cKCQkJCQkvLyBhbmQgd2UgYXJlIGdvaW5nIHRvIHByb2NlZWQgd2l0aCBzaG93LCB3ZSBzaG91bGQgcHJldGVuZCB0byBiZSBoaWRkZW4KCQkJCQlpZiAoIHZhbHVlID09PSAic2hvdyIgJiYgZGF0YVNob3cgJiYgZGF0YVNob3dbIHByb3AgXSAhPT0gdW5kZWZpbmVkICkgewoJCQkJCQloaWRkZW4gPSB0cnVlOwoJCQkJCX0gZWxzZSB7CgkJCQkJCWNvbnRpbnVlOwoJCQkJCX0KCQkJCX0KCQkJCW9yaWdbIHByb3AgXSA9IGRhdGFTaG93ICYmIGRhdGFTaG93WyBwcm9wIF0gfHwgalF1ZXJ5LnN0eWxlKCBlbGVtLCBwcm9wICk7CgoJCQkvLyBBbnkgbm9uLWZ4IHZhbHVlIHN0b3BzIHVzIGZyb20gcmVzdG9yaW5nIHRoZSBvcmlnaW5hbCBkaXNwbGF5IHZhbHVlCgkJCX0gZWxzZSB7CgkJCQlkaXNwbGF5ID0gdW5kZWZpbmVkOwoJCQl9CgkJfQoKCQlpZiAoICFqUXVlcnkuaXNFbXB0eU9iamVjdCggb3JpZyApICkgewoJCQlpZiAoIGRhdGFTaG93ICkgewoJCQkJaWYgKCAiaGlkZGVuIiBpbiBkYXRhU2hvdyApIHsKCQkJCQloaWRkZW4gPSBkYXRhU2hvdy5oaWRkZW47CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQlkYXRhU2hvdyA9IGpRdWVyeS5fZGF0YSggZWxlbSwgImZ4c2hvdyIsIHt9ICk7CgkJCX0KCgkJCS8vIHN0b3JlIHN0YXRlIGlmIGl0cyB0b2dnbGUgLSBlbmFibGVzIC5zdG9wKCkudG9nZ2xlKCkgdG8gInJldmVyc2UiCgkJCWlmICggdG9nZ2xlICkgewoJCQkJZGF0YVNob3cuaGlkZGVuID0gIWhpZGRlbjsKCQkJfQoJCQlpZiAoIGhpZGRlbiApIHsKCQkJCWpRdWVyeSggZWxlbSApLnNob3coKTsKCQkJfSBlbHNlIHsKCQkJCWFuaW0uZG9uZSggZnVuY3Rpb24oKSB7CgkJCQkJalF1ZXJ5KCBlbGVtICkuaGlkZSgpOwoJCQkJfSApOwoJCQl9CgkJCWFuaW0uZG9uZSggZnVuY3Rpb24oKSB7CgkJCQl2YXIgcHJvcDsKCQkJCWpRdWVyeS5fcmVtb3ZlRGF0YSggZWxlbSwgImZ4c2hvdyIgKTsKCQkJCWZvciAoIHByb3AgaW4gb3JpZyApIHsKCQkJCQlqUXVlcnkuc3R5bGUoIGVsZW0sIHByb3AsIG9yaWdbIHByb3AgXSApOwoJCQkJfQoJCQl9ICk7CgkJCWZvciAoIHByb3AgaW4gb3JpZyApIHsKCQkJCXR3ZWVuID0gY3JlYXRlVHdlZW4oIGhpZGRlbiA/IGRhdGFTaG93WyBwcm9wIF0gOiAwLCBwcm9wLCBhbmltICk7CgoJCQkJaWYgKCAhKCBwcm9wIGluIGRhdGFTaG93ICkgKSB7CgkJCQkJZGF0YVNob3dbIHByb3AgXSA9IHR3ZWVuLnN0YXJ0OwoJCQkJCWlmICggaGlkZGVuICkgewoJCQkJCQl0d2Vlbi5lbmQgPSB0d2Vlbi5zdGFydDsKCQkJCQkJdHdlZW4uc3RhcnQgPSBwcm9wID09PSAid2lkdGgiIHx8IHByb3AgPT09ICJoZWlnaHQiID8gMSA6IDA7CgkJCQkJfQoJCQkJfQoJCQl9CgoJCS8vIElmIHRoaXMgaXMgYSBub29wIGxpa2UgLmhpZGUoKS5oaWRlKCksIHJlc3RvcmUgYW4gb3ZlcndyaXR0ZW4gZGlzcGxheSB2YWx1ZQoJCX0gZWxzZSBpZiAoICggZGlzcGxheSA9PT0gIm5vbmUiID8gZGVmYXVsdERpc3BsYXkoIGVsZW0ubm9kZU5hbWUgKSA6IGRpc3BsYXkgKSA9PT0gImlubGluZSIgKSB7CgkJCXN0eWxlLmRpc3BsYXkgPSBkaXNwbGF5OwoJCX0KCX0KCglmdW5jdGlvbiBwcm9wRmlsdGVyKCBwcm9wcywgc3BlY2lhbEVhc2luZyApIHsKCQl2YXIgaW5kZXgsIG5hbWUsIGVhc2luZywgdmFsdWUsIGhvb2tzOwoKCQkvLyBjYW1lbENhc2UsIHNwZWNpYWxFYXNpbmcgYW5kIGV4cGFuZCBjc3NIb29rIHBhc3MKCQlmb3IgKCBpbmRleCBpbiBwcm9wcyApIHsKCQkJbmFtZSA9IGpRdWVyeS5jYW1lbENhc2UoIGluZGV4ICk7CgkJCWVhc2luZyA9IHNwZWNpYWxFYXNpbmdbIG5hbWUgXTsKCQkJdmFsdWUgPSBwcm9wc1sgaW5kZXggXTsKCQkJaWYgKCBqUXVlcnkuaXNBcnJheSggdmFsdWUgKSApIHsKCQkJCWVhc2luZyA9IHZhbHVlWyAxIF07CgkJCQl2YWx1ZSA9IHByb3BzWyBpbmRleCBdID0gdmFsdWVbIDAgXTsKCQkJfQoKCQkJaWYgKCBpbmRleCAhPT0gbmFtZSApIHsKCQkJCXByb3BzWyBuYW1lIF0gPSB2YWx1ZTsKCQkJCWRlbGV0ZSBwcm9wc1sgaW5kZXggXTsKCQkJfQoKCQkJaG9va3MgPSBqUXVlcnkuY3NzSG9va3NbIG5hbWUgXTsKCQkJaWYgKCBob29rcyAmJiAiZXhwYW5kIiBpbiBob29rcyApIHsKCQkJCXZhbHVlID0gaG9va3MuZXhwYW5kKCB2YWx1ZSApOwoJCQkJZGVsZXRlIHByb3BzWyBuYW1lIF07CgoJCQkJLy8gbm90IHF1aXRlICQuZXh0ZW5kLCB0aGlzIHdvbnQgb3ZlcndyaXRlIGtleXMgYWxyZWFkeSBwcmVzZW50LgoJCQkJLy8gYWxzbyAtIHJldXNpbmcgJ2luZGV4JyBmcm9tIGFib3ZlIGJlY2F1c2Ugd2UgaGF2ZSB0aGUgY29ycmVjdCAibmFtZSIKCQkJCWZvciAoIGluZGV4IGluIHZhbHVlICkgewoJCQkJCWlmICggISggaW5kZXggaW4gcHJvcHMgKSApIHsKCQkJCQkJcHJvcHNbIGluZGV4IF0gPSB2YWx1ZVsgaW5kZXggXTsKCQkJCQkJc3BlY2lhbEVhc2luZ1sgaW5kZXggXSA9IGVhc2luZzsKCQkJCQl9CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQlzcGVjaWFsRWFzaW5nWyBuYW1lIF0gPSBlYXNpbmc7CgkJCX0KCQl9Cgl9CgoJZnVuY3Rpb24gQW5pbWF0aW9uKCBlbGVtLCBwcm9wZXJ0aWVzLCBvcHRpb25zICkgewoJCXZhciByZXN1bHQsCgkJCXN0b3BwZWQsCgkJCWluZGV4ID0gMCwKCQkJbGVuZ3RoID0gQW5pbWF0aW9uLnByZWZpbHRlcnMubGVuZ3RoLAoJCQlkZWZlcnJlZCA9IGpRdWVyeS5EZWZlcnJlZCgpLmFsd2F5cyggZnVuY3Rpb24oKSB7CgoJCQkJLy8gZG9uJ3QgbWF0Y2ggZWxlbSBpbiB0aGUgOmFuaW1hdGVkIHNlbGVjdG9yCgkJCQlkZWxldGUgdGljay5lbGVtOwoJCQl9ICksCgkJCXRpY2sgPSBmdW5jdGlvbigpIHsKCQkJCWlmICggc3RvcHBlZCApIHsKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQl9CgkJCQl2YXIgY3VycmVudFRpbWUgPSBmeE5vdyB8fCBjcmVhdGVGeE5vdygpLAoJCQkJCXJlbWFpbmluZyA9IE1hdGgubWF4KCAwLCBhbmltYXRpb24uc3RhcnRUaW1lICsgYW5pbWF0aW9uLmR1cmF0aW9uIC0gY3VycmVudFRpbWUgKSwKCgkJCQkJLy8gU3VwcG9ydDogQW5kcm9pZCAyLjMKCQkJCQkvLyBBcmNoYWljIGNyYXNoIGJ1ZyB3b24ndCBhbGxvdyB1cyB0byB1c2UgYDEgLSAoIDAuNSB8fCAwIClgICgjMTI0OTcpCgkJCQkJdGVtcCA9IHJlbWFpbmluZyAvIGFuaW1hdGlvbi5kdXJhdGlvbiB8fCAwLAoJCQkJCXBlcmNlbnQgPSAxIC0gdGVtcCwKCQkJCQlpbmRleCA9IDAsCgkJCQkJbGVuZ3RoID0gYW5pbWF0aW9uLnR3ZWVucy5sZW5ndGg7CgoJCQkJZm9yICggOyBpbmRleCA8IGxlbmd0aCA7IGluZGV4KysgKSB7CgkJCQkJYW5pbWF0aW9uLnR3ZWVuc1sgaW5kZXggXS5ydW4oIHBlcmNlbnQgKTsKCQkJCX0KCgkJCQlkZWZlcnJlZC5ub3RpZnlXaXRoKCBlbGVtLCBbIGFuaW1hdGlvbiwgcGVyY2VudCwgcmVtYWluaW5nIF0gKTsKCgkJCQlpZiAoIHBlcmNlbnQgPCAxICYmIGxlbmd0aCApIHsKCQkJCQlyZXR1cm4gcmVtYWluaW5nOwoJCQkJfSBlbHNlIHsKCQkJCQlkZWZlcnJlZC5yZXNvbHZlV2l0aCggZWxlbSwgWyBhbmltYXRpb24gXSApOwoJCQkJCXJldHVybiBmYWxzZTsKCQkJCX0KCQkJfSwKCQkJYW5pbWF0aW9uID0gZGVmZXJyZWQucHJvbWlzZSggewoJCQkJZWxlbTogZWxlbSwKCQkJCXByb3BzOiBqUXVlcnkuZXh0ZW5kKCB7fSwgcHJvcGVydGllcyApLAoJCQkJb3B0czogalF1ZXJ5LmV4dGVuZCggdHJ1ZSwgewoJCQkJCXNwZWNpYWxFYXNpbmc6IHt9LAoJCQkJCWVhc2luZzogalF1ZXJ5LmVhc2luZy5fZGVmYXVsdAoJCQkJfSwgb3B0aW9ucyApLAoJCQkJb3JpZ2luYWxQcm9wZXJ0aWVzOiBwcm9wZXJ0aWVzLAoJCQkJb3JpZ2luYWxPcHRpb25zOiBvcHRpb25zLAoJCQkJc3RhcnRUaW1lOiBmeE5vdyB8fCBjcmVhdGVGeE5vdygpLAoJCQkJZHVyYXRpb246IG9wdGlvbnMuZHVyYXRpb24sCgkJCQl0d2VlbnM6IFtdLAoJCQkJY3JlYXRlVHdlZW46IGZ1bmN0aW9uKCBwcm9wLCBlbmQgKSB7CgkJCQkJdmFyIHR3ZWVuID0galF1ZXJ5LlR3ZWVuKCBlbGVtLCBhbmltYXRpb24ub3B0cywgcHJvcCwgZW5kLAoJCQkJCQkJYW5pbWF0aW9uLm9wdHMuc3BlY2lhbEVhc2luZ1sgcHJvcCBdIHx8IGFuaW1hdGlvbi5vcHRzLmVhc2luZyApOwoJCQkJCWFuaW1hdGlvbi50d2VlbnMucHVzaCggdHdlZW4gKTsKCQkJCQlyZXR1cm4gdHdlZW47CgkJCQl9LAoJCQkJc3RvcDogZnVuY3Rpb24oIGdvdG9FbmQgKSB7CgkJCQkJdmFyIGluZGV4ID0gMCwKCgkJCQkJCS8vIGlmIHdlIGFyZSBnb2luZyB0byB0aGUgZW5kLCB3ZSB3YW50IHRvIHJ1biBhbGwgdGhlIHR3ZWVucwoJCQkJCQkvLyBvdGhlcndpc2Ugd2Ugc2tpcCB0aGlzIHBhcnQKCQkJCQkJbGVuZ3RoID0gZ290b0VuZCA/IGFuaW1hdGlvbi50d2VlbnMubGVuZ3RoIDogMDsKCQkJCQlpZiAoIHN0b3BwZWQgKSB7CgkJCQkJCXJldHVybiB0aGlzOwoJCQkJCX0KCQkJCQlzdG9wcGVkID0gdHJ1ZTsKCQkJCQlmb3IgKCA7IGluZGV4IDwgbGVuZ3RoIDsgaW5kZXgrKyApIHsKCQkJCQkJYW5pbWF0aW9uLnR3ZWVuc1sgaW5kZXggXS5ydW4oIDEgKTsKCQkJCQl9CgoJCQkJCS8vIHJlc29sdmUgd2hlbiB3ZSBwbGF5ZWQgdGhlIGxhc3QgZnJhbWUKCQkJCQkvLyBvdGhlcndpc2UsIHJlamVjdAoJCQkJCWlmICggZ290b0VuZCApIHsKCQkJCQkJZGVmZXJyZWQubm90aWZ5V2l0aCggZWxlbSwgWyBhbmltYXRpb24sIDEsIDAgXSApOwoJCQkJCQlkZWZlcnJlZC5yZXNvbHZlV2l0aCggZWxlbSwgWyBhbmltYXRpb24sIGdvdG9FbmQgXSApOwoJCQkJCX0gZWxzZSB7CgkJCQkJCWRlZmVycmVkLnJlamVjdFdpdGgoIGVsZW0sIFsgYW5pbWF0aW9uLCBnb3RvRW5kIF0gKTsKCQkJCQl9CgkJCQkJcmV0dXJuIHRoaXM7CgkJCQl9CgkJCX0gKSwKCQkJcHJvcHMgPSBhbmltYXRpb24ucHJvcHM7CgoJCXByb3BGaWx0ZXIoIHByb3BzLCBhbmltYXRpb24ub3B0cy5zcGVjaWFsRWFzaW5nICk7CgoJCWZvciAoIDsgaW5kZXggPCBsZW5ndGggOyBpbmRleCsrICkgewoJCQlyZXN1bHQgPSBBbmltYXRpb24ucHJlZmlsdGVyc1sgaW5kZXggXS5jYWxsKCBhbmltYXRpb24sIGVsZW0sIHByb3BzLCBhbmltYXRpb24ub3B0cyApOwoJCQlpZiAoIHJlc3VsdCApIHsKCQkJCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHJlc3VsdC5zdG9wICkgKSB7CgkJCQkJalF1ZXJ5Ll9xdWV1ZUhvb2tzKCBhbmltYXRpb24uZWxlbSwgYW5pbWF0aW9uLm9wdHMucXVldWUgKS5zdG9wID0KCQkJCQkJalF1ZXJ5LnByb3h5KCByZXN1bHQuc3RvcCwgcmVzdWx0ICk7CgkJCQl9CgkJCQlyZXR1cm4gcmVzdWx0OwoJCQl9CgkJfQoKCQlqUXVlcnkubWFwKCBwcm9wcywgY3JlYXRlVHdlZW4sIGFuaW1hdGlvbiApOwoKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBhbmltYXRpb24ub3B0cy5zdGFydCApICkgewoJCQlhbmltYXRpb24ub3B0cy5zdGFydC5jYWxsKCBlbGVtLCBhbmltYXRpb24gKTsKCQl9CgoJCWpRdWVyeS5meC50aW1lcigKCQkJalF1ZXJ5LmV4dGVuZCggdGljaywgewoJCQkJZWxlbTogZWxlbSwKCQkJCWFuaW06IGFuaW1hdGlvbiwKCQkJCXF1ZXVlOiBhbmltYXRpb24ub3B0cy5xdWV1ZQoJCQl9ICkKCQkpOwoKCQkvLyBhdHRhY2ggY2FsbGJhY2tzIGZyb20gb3B0aW9ucwoJCXJldHVybiBhbmltYXRpb24ucHJvZ3Jlc3MoIGFuaW1hdGlvbi5vcHRzLnByb2dyZXNzICkKCQkJLmRvbmUoIGFuaW1hdGlvbi5vcHRzLmRvbmUsIGFuaW1hdGlvbi5vcHRzLmNvbXBsZXRlICkKCQkJLmZhaWwoIGFuaW1hdGlvbi5vcHRzLmZhaWwgKQoJCQkuYWx3YXlzKCBhbmltYXRpb24ub3B0cy5hbHdheXMgKTsKCX0KCglqUXVlcnkuQW5pbWF0aW9uID0galF1ZXJ5LmV4dGVuZCggQW5pbWF0aW9uLCB7CgoJCXR3ZWVuZXJzOiB7CgkJCSIqIjogWyBmdW5jdGlvbiggcHJvcCwgdmFsdWUgKSB7CgkJCQl2YXIgdHdlZW4gPSB0aGlzLmNyZWF0ZVR3ZWVuKCBwcm9wLCB2YWx1ZSApOwoJCQkJYWRqdXN0Q1NTKCB0d2Vlbi5lbGVtLCBwcm9wLCByY3NzTnVtLmV4ZWMoIHZhbHVlICksIHR3ZWVuICk7CgkJCQlyZXR1cm4gdHdlZW47CgkJCX0gXQoJCX0sCgoJCXR3ZWVuZXI6IGZ1bmN0aW9uKCBwcm9wcywgY2FsbGJhY2sgKSB7CgkJCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHByb3BzICkgKSB7CgkJCQljYWxsYmFjayA9IHByb3BzOwoJCQkJcHJvcHMgPSBbICIqIiBdOwoJCQl9IGVsc2UgewoJCQkJcHJvcHMgPSBwcm9wcy5tYXRjaCggcm5vdHdoaXRlICk7CgkJCX0KCgkJCXZhciBwcm9wLAoJCQkJaW5kZXggPSAwLAoJCQkJbGVuZ3RoID0gcHJvcHMubGVuZ3RoOwoKCQkJZm9yICggOyBpbmRleCA8IGxlbmd0aCA7IGluZGV4KysgKSB7CgkJCQlwcm9wID0gcHJvcHNbIGluZGV4IF07CgkJCQlBbmltYXRpb24udHdlZW5lcnNbIHByb3AgXSA9IEFuaW1hdGlvbi50d2VlbmVyc1sgcHJvcCBdIHx8IFtdOwoJCQkJQW5pbWF0aW9uLnR3ZWVuZXJzWyBwcm9wIF0udW5zaGlmdCggY2FsbGJhY2sgKTsKCQkJfQoJCX0sCgoJCXByZWZpbHRlcnM6IFsgZGVmYXVsdFByZWZpbHRlciBdLAoKCQlwcmVmaWx0ZXI6IGZ1bmN0aW9uKCBjYWxsYmFjaywgcHJlcGVuZCApIHsKCQkJaWYgKCBwcmVwZW5kICkgewoJCQkJQW5pbWF0aW9uLnByZWZpbHRlcnMudW5zaGlmdCggY2FsbGJhY2sgKTsKCQkJfSBlbHNlIHsKCQkJCUFuaW1hdGlvbi5wcmVmaWx0ZXJzLnB1c2goIGNhbGxiYWNrICk7CgkJCX0KCQl9Cgl9ICk7CgoJalF1ZXJ5LnNwZWVkID0gZnVuY3Rpb24oIHNwZWVkLCBlYXNpbmcsIGZuICkgewoJCXZhciBvcHQgPSBzcGVlZCAmJiB0eXBlb2Ygc3BlZWQgPT09ICJvYmplY3QiID8galF1ZXJ5LmV4dGVuZCgge30sIHNwZWVkICkgOiB7CgkJCWNvbXBsZXRlOiBmbiB8fCAhZm4gJiYgZWFzaW5nIHx8CgkJCQlqUXVlcnkuaXNGdW5jdGlvbiggc3BlZWQgKSAmJiBzcGVlZCwKCQkJZHVyYXRpb246IHNwZWVkLAoJCQllYXNpbmc6IGZuICYmIGVhc2luZyB8fCBlYXNpbmcgJiYgIWpRdWVyeS5pc0Z1bmN0aW9uKCBlYXNpbmcgKSAmJiBlYXNpbmcKCQl9OwoKCQlvcHQuZHVyYXRpb24gPSBqUXVlcnkuZngub2ZmID8gMCA6IHR5cGVvZiBvcHQuZHVyYXRpb24gPT09ICJudW1iZXIiID8gb3B0LmR1cmF0aW9uIDoKCQkJb3B0LmR1cmF0aW9uIGluIGpRdWVyeS5meC5zcGVlZHMgPwoJCQkJalF1ZXJ5LmZ4LnNwZWVkc1sgb3B0LmR1cmF0aW9uIF0gOiBqUXVlcnkuZnguc3BlZWRzLl9kZWZhdWx0OwoKCQkvLyBub3JtYWxpemUgb3B0LnF1ZXVlIC0gdHJ1ZS91bmRlZmluZWQvbnVsbCAtPiAiZngiCgkJaWYgKCBvcHQucXVldWUgPT0gbnVsbCB8fCBvcHQucXVldWUgPT09IHRydWUgKSB7CgkJCW9wdC5xdWV1ZSA9ICJmeCI7CgkJfQoKCQkvLyBRdWV1ZWluZwoJCW9wdC5vbGQgPSBvcHQuY29tcGxldGU7CgoJCW9wdC5jb21wbGV0ZSA9IGZ1bmN0aW9uKCkgewoJCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBvcHQub2xkICkgKSB7CgkJCQlvcHQub2xkLmNhbGwoIHRoaXMgKTsKCQkJfQoKCQkJaWYgKCBvcHQucXVldWUgKSB7CgkJCQlqUXVlcnkuZGVxdWV1ZSggdGhpcywgb3B0LnF1ZXVlICk7CgkJCX0KCQl9OwoKCQlyZXR1cm4gb3B0OwoJfTsKCglqUXVlcnkuZm4uZXh0ZW5kKCB7CgkJZmFkZVRvOiBmdW5jdGlvbiggc3BlZWQsIHRvLCBlYXNpbmcsIGNhbGxiYWNrICkgewoKCQkJLy8gc2hvdyBhbnkgaGlkZGVuIGVsZW1lbnRzIGFmdGVyIHNldHRpbmcgb3BhY2l0eSB0byAwCgkJCXJldHVybiB0aGlzLmZpbHRlciggaXNIaWRkZW4gKS5jc3MoICJvcGFjaXR5IiwgMCApLnNob3coKQoKCQkJCS8vIGFuaW1hdGUgdG8gdGhlIHZhbHVlIHNwZWNpZmllZAoJCQkJLmVuZCgpLmFuaW1hdGUoIHsgb3BhY2l0eTogdG8gfSwgc3BlZWQsIGVhc2luZywgY2FsbGJhY2sgKTsKCQl9LAoJCWFuaW1hdGU6IGZ1bmN0aW9uKCBwcm9wLCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayApIHsKCQkJdmFyIGVtcHR5ID0galF1ZXJ5LmlzRW1wdHlPYmplY3QoIHByb3AgKSwKCQkJCW9wdGFsbCA9IGpRdWVyeS5zcGVlZCggc3BlZWQsIGVhc2luZywgY2FsbGJhY2sgKSwKCQkJCWRvQW5pbWF0aW9uID0gZnVuY3Rpb24oKSB7CgoJCQkJCS8vIE9wZXJhdGUgb24gYSBjb3B5IG9mIHByb3Agc28gcGVyLXByb3BlcnR5IGVhc2luZyB3b24ndCBiZSBsb3N0CgkJCQkJdmFyIGFuaW0gPSBBbmltYXRpb24oIHRoaXMsIGpRdWVyeS5leHRlbmQoIHt9LCBwcm9wICksIG9wdGFsbCApOwoKCQkJCQkvLyBFbXB0eSBhbmltYXRpb25zLCBvciBmaW5pc2hpbmcgcmVzb2x2ZXMgaW1tZWRpYXRlbHkKCQkJCQlpZiAoIGVtcHR5IHx8IGpRdWVyeS5fZGF0YSggdGhpcywgImZpbmlzaCIgKSApIHsKCQkJCQkJYW5pbS5zdG9wKCB0cnVlICk7CgkJCQkJfQoJCQkJfTsKCQkJCWRvQW5pbWF0aW9uLmZpbmlzaCA9IGRvQW5pbWF0aW9uOwoKCQkJcmV0dXJuIGVtcHR5IHx8IG9wdGFsbC5xdWV1ZSA9PT0gZmFsc2UgPwoJCQkJdGhpcy5lYWNoKCBkb0FuaW1hdGlvbiApIDoKCQkJCXRoaXMucXVldWUoIG9wdGFsbC5xdWV1ZSwgZG9BbmltYXRpb24gKTsKCQl9LAoJCXN0b3A6IGZ1bmN0aW9uKCB0eXBlLCBjbGVhclF1ZXVlLCBnb3RvRW5kICkgewoJCQl2YXIgc3RvcFF1ZXVlID0gZnVuY3Rpb24oIGhvb2tzICkgewoJCQkJdmFyIHN0b3AgPSBob29rcy5zdG9wOwoJCQkJZGVsZXRlIGhvb2tzLnN0b3A7CgkJCQlzdG9wKCBnb3RvRW5kICk7CgkJCX07CgoJCQlpZiAoIHR5cGVvZiB0eXBlICE9PSAic3RyaW5nIiApIHsKCQkJCWdvdG9FbmQgPSBjbGVhclF1ZXVlOwoJCQkJY2xlYXJRdWV1ZSA9IHR5cGU7CgkJCQl0eXBlID0gdW5kZWZpbmVkOwoJCQl9CgkJCWlmICggY2xlYXJRdWV1ZSAmJiB0eXBlICE9PSBmYWxzZSApIHsKCQkJCXRoaXMucXVldWUoIHR5cGUgfHwgImZ4IiwgW10gKTsKCQkJfQoKCQkJcmV0dXJuIHRoaXMuZWFjaCggZnVuY3Rpb24oKSB7CgkJCQl2YXIgZGVxdWV1ZSA9IHRydWUsCgkJCQkJaW5kZXggPSB0eXBlICE9IG51bGwgJiYgdHlwZSArICJxdWV1ZUhvb2tzIiwKCQkJCQl0aW1lcnMgPSBqUXVlcnkudGltZXJzLAoJCQkJCWRhdGEgPSBqUXVlcnkuX2RhdGEoIHRoaXMgKTsKCgkJCQlpZiAoIGluZGV4ICkgewoJCQkJCWlmICggZGF0YVsgaW5kZXggXSAmJiBkYXRhWyBpbmRleCBdLnN0b3AgKSB7CgkJCQkJCXN0b3BRdWV1ZSggZGF0YVsgaW5kZXggXSApOwoJCQkJCX0KCQkJCX0gZWxzZSB7CgkJCQkJZm9yICggaW5kZXggaW4gZGF0YSApIHsKCQkJCQkJaWYgKCBkYXRhWyBpbmRleCBdICYmIGRhdGFbIGluZGV4IF0uc3RvcCAmJiBycnVuLnRlc3QoIGluZGV4ICkgKSB7CgkJCQkJCQlzdG9wUXVldWUoIGRhdGFbIGluZGV4IF0gKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCgkJCQlmb3IgKCBpbmRleCA9IHRpbWVycy5sZW5ndGg7IGluZGV4LS07ICkgewoJCQkJCWlmICggdGltZXJzWyBpbmRleCBdLmVsZW0gPT09IHRoaXMgJiYKCQkJCQkJKCB0eXBlID09IG51bGwgfHwgdGltZXJzWyBpbmRleCBdLnF1ZXVlID09PSB0eXBlICkgKSB7CgoJCQkJCQl0aW1lcnNbIGluZGV4IF0uYW5pbS5zdG9wKCBnb3RvRW5kICk7CgkJCQkJCWRlcXVldWUgPSBmYWxzZTsKCQkJCQkJdGltZXJzLnNwbGljZSggaW5kZXgsIDEgKTsKCQkJCQl9CgkJCQl9CgoJCQkJLy8gc3RhcnQgdGhlIG5leHQgaW4gdGhlIHF1ZXVlIGlmIHRoZSBsYXN0IHN0ZXAgd2Fzbid0IGZvcmNlZAoJCQkJLy8gdGltZXJzIGN1cnJlbnRseSB3aWxsIGNhbGwgdGhlaXIgY29tcGxldGUgY2FsbGJhY2tzLCB3aGljaCB3aWxsIGRlcXVldWUKCQkJCS8vIGJ1dCBvbmx5IGlmIHRoZXkgd2VyZSBnb3RvRW5kCgkJCQlpZiAoIGRlcXVldWUgfHwgIWdvdG9FbmQgKSB7CgkJCQkJalF1ZXJ5LmRlcXVldWUoIHRoaXMsIHR5cGUgKTsKCQkJCX0KCQkJfSApOwoJCX0sCgkJZmluaXNoOiBmdW5jdGlvbiggdHlwZSApIHsKCQkJaWYgKCB0eXBlICE9PSBmYWxzZSApIHsKCQkJCXR5cGUgPSB0eXBlIHx8ICJmeCI7CgkJCX0KCQkJcmV0dXJuIHRoaXMuZWFjaCggZnVuY3Rpb24oKSB7CgkJCQl2YXIgaW5kZXgsCgkJCQkJZGF0YSA9IGpRdWVyeS5fZGF0YSggdGhpcyApLAoJCQkJCXF1ZXVlID0gZGF0YVsgdHlwZSArICJxdWV1ZSIgXSwKCQkJCQlob29rcyA9IGRhdGFbIHR5cGUgKyAicXVldWVIb29rcyIgXSwKCQkJCQl0aW1lcnMgPSBqUXVlcnkudGltZXJzLAoJCQkJCWxlbmd0aCA9IHF1ZXVlID8gcXVldWUubGVuZ3RoIDogMDsKCgkJCQkvLyBlbmFibGUgZmluaXNoaW5nIGZsYWcgb24gcHJpdmF0ZSBkYXRhCgkJCQlkYXRhLmZpbmlzaCA9IHRydWU7CgoJCQkJLy8gZW1wdHkgdGhlIHF1ZXVlIGZpcnN0CgkJCQlqUXVlcnkucXVldWUoIHRoaXMsIHR5cGUsIFtdICk7CgoJCQkJaWYgKCBob29rcyAmJiBob29rcy5zdG9wICkgewoJCQkJCWhvb2tzLnN0b3AuY2FsbCggdGhpcywgdHJ1ZSApOwoJCQkJfQoKCQkJCS8vIGxvb2sgZm9yIGFueSBhY3RpdmUgYW5pbWF0aW9ucywgYW5kIGZpbmlzaCB0aGVtCgkJCQlmb3IgKCBpbmRleCA9IHRpbWVycy5sZW5ndGg7IGluZGV4LS07ICkgewoJCQkJCWlmICggdGltZXJzWyBpbmRleCBdLmVsZW0gPT09IHRoaXMgJiYgdGltZXJzWyBpbmRleCBdLnF1ZXVlID09PSB0eXBlICkgewoJCQkJCQl0aW1lcnNbIGluZGV4IF0uYW5pbS5zdG9wKCB0cnVlICk7CgkJCQkJCXRpbWVycy5zcGxpY2UoIGluZGV4LCAxICk7CgkJCQkJfQoJCQkJfQoKCQkJCS8vIGxvb2sgZm9yIGFueSBhbmltYXRpb25zIGluIHRoZSBvbGQgcXVldWUgYW5kIGZpbmlzaCB0aGVtCgkJCQlmb3IgKCBpbmRleCA9IDA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrICkgewoJCQkJCWlmICggcXVldWVbIGluZGV4IF0gJiYgcXVldWVbIGluZGV4IF0uZmluaXNoICkgewoJCQkJCQlxdWV1ZVsgaW5kZXggXS5maW5pc2guY2FsbCggdGhpcyApOwoJCQkJCX0KCQkJCX0KCgkJCQkvLyB0dXJuIG9mZiBmaW5pc2hpbmcgZmxhZwoJCQkJZGVsZXRlIGRhdGEuZmluaXNoOwoJCQl9ICk7CgkJfQoJfSApOwoKCWpRdWVyeS5lYWNoKCBbICJ0b2dnbGUiLCAic2hvdyIsICJoaWRlIiBdLCBmdW5jdGlvbiggaSwgbmFtZSApIHsKCQl2YXIgY3NzRm4gPSBqUXVlcnkuZm5bIG5hbWUgXTsKCQlqUXVlcnkuZm5bIG5hbWUgXSA9IGZ1bmN0aW9uKCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayApIHsKCQkJcmV0dXJuIHNwZWVkID09IG51bGwgfHwgdHlwZW9mIHNwZWVkID09PSAiYm9vbGVhbiIgPwoJCQkJY3NzRm4uYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApIDoKCQkJCXRoaXMuYW5pbWF0ZSggZ2VuRngoIG5hbWUsIHRydWUgKSwgc3BlZWQsIGVhc2luZywgY2FsbGJhY2sgKTsKCQl9OwoJfSApOwoKCS8vIEdlbmVyYXRlIHNob3J0Y3V0cyBmb3IgY3VzdG9tIGFuaW1hdGlvbnMKCWpRdWVyeS5lYWNoKCB7CgkJc2xpZGVEb3duOiBnZW5GeCggInNob3ciICksCgkJc2xpZGVVcDogZ2VuRngoICJoaWRlIiApLAoJCXNsaWRlVG9nZ2xlOiBnZW5GeCggInRvZ2dsZSIgKSwKCQlmYWRlSW46IHsgb3BhY2l0eTogInNob3ciIH0sCgkJZmFkZU91dDogeyBvcGFjaXR5OiAiaGlkZSIgfSwKCQlmYWRlVG9nZ2xlOiB7IG9wYWNpdHk6ICJ0b2dnbGUiIH0KCX0sIGZ1bmN0aW9uKCBuYW1lLCBwcm9wcyApIHsKCQlqUXVlcnkuZm5bIG5hbWUgXSA9IGZ1bmN0aW9uKCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayApIHsKCQkJcmV0dXJuIHRoaXMuYW5pbWF0ZSggcHJvcHMsIHNwZWVkLCBlYXNpbmcsIGNhbGxiYWNrICk7CgkJfTsKCX0gKTsKCglqUXVlcnkudGltZXJzID0gW107CglqUXVlcnkuZngudGljayA9IGZ1bmN0aW9uKCkgewoJCXZhciB0aW1lciwKCQkJdGltZXJzID0galF1ZXJ5LnRpbWVycywKCQkJaSA9IDA7CgoJCWZ4Tm93ID0galF1ZXJ5Lm5vdygpOwoKCQlmb3IgKCA7IGkgPCB0aW1lcnMubGVuZ3RoOyBpKysgKSB7CgkJCXRpbWVyID0gdGltZXJzWyBpIF07CgoJCQkvLyBDaGVja3MgdGhlIHRpbWVyIGhhcyBub3QgYWxyZWFkeSBiZWVuIHJlbW92ZWQKCQkJaWYgKCAhdGltZXIoKSAmJiB0aW1lcnNbIGkgXSA9PT0gdGltZXIgKSB7CgkJCQl0aW1lcnMuc3BsaWNlKCBpLS0sIDEgKTsKCQkJfQoJCX0KCgkJaWYgKCAhdGltZXJzLmxlbmd0aCApIHsKCQkJalF1ZXJ5LmZ4LnN0b3AoKTsKCQl9CgkJZnhOb3cgPSB1bmRlZmluZWQ7Cgl9OwoKCWpRdWVyeS5meC50aW1lciA9IGZ1bmN0aW9uKCB0aW1lciApIHsKCQlqUXVlcnkudGltZXJzLnB1c2goIHRpbWVyICk7CgkJaWYgKCB0aW1lcigpICkgewoJCQlqUXVlcnkuZnguc3RhcnQoKTsKCQl9IGVsc2UgewoJCQlqUXVlcnkudGltZXJzLnBvcCgpOwoJCX0KCX07CgoJalF1ZXJ5LmZ4LmludGVydmFsID0gMTM7CgoJalF1ZXJ5LmZ4LnN0YXJ0ID0gZnVuY3Rpb24oKSB7CgkJaWYgKCAhdGltZXJJZCApIHsKCQkJdGltZXJJZCA9IHdpbmRvdy5zZXRJbnRlcnZhbCggalF1ZXJ5LmZ4LnRpY2ssIGpRdWVyeS5meC5pbnRlcnZhbCApOwoJCX0KCX07CgoJalF1ZXJ5LmZ4LnN0b3AgPSBmdW5jdGlvbigpIHsKCQl3aW5kb3cuY2xlYXJJbnRlcnZhbCggdGltZXJJZCApOwoJCXRpbWVySWQgPSBudWxsOwoJfTsKCglqUXVlcnkuZnguc3BlZWRzID0gewoJCXNsb3c6IDYwMCwKCQlmYXN0OiAyMDAsCgoJCS8vIERlZmF1bHQgc3BlZWQKCQlfZGVmYXVsdDogNDAwCgl9OwoKCgkvLyBCYXNlZCBvZmYgb2YgdGhlIHBsdWdpbiBieSBDbGludCBIZWxmZXJzLCB3aXRoIHBlcm1pc3Npb24uCgkvLyBodHRwOi8vd2ViLmFyY2hpdmUub3JnL3dlYi8yMDEwMDMyNDAxNDc0Ny9odHRwOi8vYmxpbmRzaWduYWxzLmNvbS9pbmRleC5waHAvMjAwOS8wNy9qcXVlcnktZGVsYXkvCglqUXVlcnkuZm4uZGVsYXkgPSBmdW5jdGlvbiggdGltZSwgdHlwZSApIHsKCQl0aW1lID0galF1ZXJ5LmZ4ID8galF1ZXJ5LmZ4LnNwZWVkc1sgdGltZSBdIHx8IHRpbWUgOiB0aW1lOwoJCXR5cGUgPSB0eXBlIHx8ICJmeCI7CgoJCXJldHVybiB0aGlzLnF1ZXVlKCB0eXBlLCBmdW5jdGlvbiggbmV4dCwgaG9va3MgKSB7CgkJCXZhciB0aW1lb3V0ID0gd2luZG93LnNldFRpbWVvdXQoIG5leHQsIHRpbWUgKTsKCQkJaG9va3Muc3RvcCA9IGZ1bmN0aW9uKCkgewoJCQkJd2luZG93LmNsZWFyVGltZW91dCggdGltZW91dCApOwoJCQl9OwoJCX0gKTsKCX07CgoKCSggZnVuY3Rpb24oKSB7CgkJdmFyIGEsCgkJCWlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggImlucHV0IiApLAoJCQlkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAiZGl2IiApLAoJCQlzZWxlY3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAic2VsZWN0IiApLAoJCQlvcHQgPSBzZWxlY3QuYXBwZW5kQ2hpbGQoIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJvcHRpb24iICkgKTsKCgkJLy8gU2V0dXAKCQlkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAiZGl2IiApOwoJCWRpdi5zZXRBdHRyaWJ1dGUoICJjbGFzc05hbWUiLCAidCIgKTsKCQlkaXYuaW5uZXJIVE1MID0gIiAgPGxpbmsvPjx0YWJsZT48L3RhYmxlPjxhIGhyZWY9Jy9hJz5hPC9hPjxpbnB1dCB0eXBlPSdjaGVja2JveCcvPiI7CgkJYSA9IGRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZSggImEiIClbIDAgXTsKCgkJLy8gU3VwcG9ydDogV2luZG93cyBXZWIgQXBwcyAoV1dBKQoJCS8vIGB0eXBlYCBtdXN0IHVzZSAuc2V0QXR0cmlidXRlIGZvciBXV0EgKCMxNDkwMSkKCQlpbnB1dC5zZXRBdHRyaWJ1dGUoICJ0eXBlIiwgImNoZWNrYm94IiApOwoJCWRpdi5hcHBlbmRDaGlsZCggaW5wdXQgKTsKCgkJYSA9IGRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZSggImEiIClbIDAgXTsKCgkJLy8gRmlyc3QgYmF0Y2ggb2YgdGVzdHMuCgkJYS5zdHlsZS5jc3NUZXh0ID0gInRvcDoxcHgiOwoKCQkvLyBUZXN0IHNldEF0dHJpYnV0ZSBvbiBjYW1lbENhc2UgY2xhc3MuCgkJLy8gSWYgaXQgd29ya3MsIHdlIG5lZWQgYXR0ckZpeGVzIHdoZW4gZG9pbmcgZ2V0L3NldEF0dHJpYnV0ZSAoaWU2LzcpCgkJc3VwcG9ydC5nZXRTZXRBdHRyaWJ1dGUgPSBkaXYuY2xhc3NOYW1lICE9PSAidCI7CgoJCS8vIEdldCB0aGUgc3R5bGUgaW5mb3JtYXRpb24gZnJvbSBnZXRBdHRyaWJ1dGUKCQkvLyAoSUUgdXNlcyAuY3NzVGV4dCBpbnN0ZWFkKQoJCXN1cHBvcnQuc3R5bGUgPSAvdG9wLy50ZXN0KCBhLmdldEF0dHJpYnV0ZSggInN0eWxlIiApICk7CgoJCS8vIE1ha2Ugc3VyZSB0aGF0IFVSTHMgYXJlbid0IG1hbmlwdWxhdGVkCgkJLy8gKElFIG5vcm1hbGl6ZXMgaXQgYnkgZGVmYXVsdCkKCQlzdXBwb3J0LmhyZWZOb3JtYWxpemVkID0gYS5nZXRBdHRyaWJ1dGUoICJocmVmIiApID09PSAiL2EiOwoKCQkvLyBDaGVjayB0aGUgZGVmYXVsdCBjaGVja2JveC9yYWRpbyB2YWx1ZSAoIiIgb24gV2ViS2l0OyAib24iIGVsc2V3aGVyZSkKCQlzdXBwb3J0LmNoZWNrT24gPSAhIWlucHV0LnZhbHVlOwoKCQkvLyBNYWtlIHN1cmUgdGhhdCBhIHNlbGVjdGVkLWJ5LWRlZmF1bHQgb3B0aW9uIGhhcyBhIHdvcmtpbmcgc2VsZWN0ZWQgcHJvcGVydHkuCgkJLy8gKFdlYktpdCBkZWZhdWx0cyB0byBmYWxzZSBpbnN0ZWFkIG9mIHRydWUsIElFIHRvbywgaWYgaXQncyBpbiBhbiBvcHRncm91cCkKCQlzdXBwb3J0Lm9wdFNlbGVjdGVkID0gb3B0LnNlbGVjdGVkOwoKCQkvLyBUZXN0cyBmb3IgZW5jdHlwZSBzdXBwb3J0IG9uIGEgZm9ybSAoIzY3NDMpCgkJc3VwcG9ydC5lbmN0eXBlID0gISFkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAiZm9ybSIgKS5lbmN0eXBlOwoKCQkvLyBNYWtlIHN1cmUgdGhhdCB0aGUgb3B0aW9ucyBpbnNpZGUgZGlzYWJsZWQgc2VsZWN0cyBhcmVuJ3QgbWFya2VkIGFzIGRpc2FibGVkCgkJLy8gKFdlYktpdCBtYXJrcyB0aGVtIGFzIGRpc2FibGVkKQoJCXNlbGVjdC5kaXNhYmxlZCA9IHRydWU7CgkJc3VwcG9ydC5vcHREaXNhYmxlZCA9ICFvcHQuZGlzYWJsZWQ7CgoJCS8vIFN1cHBvcnQ6IElFOCBvbmx5CgkJLy8gQ2hlY2sgaWYgd2UgY2FuIHRydXN0IGdldEF0dHJpYnV0ZSgidmFsdWUiKQoJCWlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggImlucHV0IiApOwoJCWlucHV0LnNldEF0dHJpYnV0ZSggInZhbHVlIiwgIiIgKTsKCQlzdXBwb3J0LmlucHV0ID0gaW5wdXQuZ2V0QXR0cmlidXRlKCAidmFsdWUiICkgPT09ICIiOwoKCQkvLyBDaGVjayBpZiBhbiBpbnB1dCBtYWludGFpbnMgaXRzIHZhbHVlIGFmdGVyIGJlY29taW5nIGEgcmFkaW8KCQlpbnB1dC52YWx1ZSA9ICJ0IjsKCQlpbnB1dC5zZXRBdHRyaWJ1dGUoICJ0eXBlIiwgInJhZGlvIiApOwoJCXN1cHBvcnQucmFkaW9WYWx1ZSA9IGlucHV0LnZhbHVlID09PSAidCI7Cgl9ICkoKTsKCgoJdmFyIHJyZXR1cm4gPSAvXHIvZywKCQlyc3BhY2VzID0gL1tceDIwXHRcclxuXGZdKy9nOwoKCWpRdWVyeS5mbi5leHRlbmQoIHsKCQl2YWw6IGZ1bmN0aW9uKCB2YWx1ZSApIHsKCQkJdmFyIGhvb2tzLCByZXQsIGlzRnVuY3Rpb24sCgkJCQllbGVtID0gdGhpc1sgMCBdOwoKCQkJaWYgKCAhYXJndW1lbnRzLmxlbmd0aCApIHsKCQkJCWlmICggZWxlbSApIHsKCQkJCQlob29rcyA9IGpRdWVyeS52YWxIb29rc1sgZWxlbS50eXBlIF0gfHwKCQkJCQkJalF1ZXJ5LnZhbEhvb2tzWyBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgXTsKCgkJCQkJaWYgKAoJCQkJCQlob29rcyAmJgoJCQkJCQkiZ2V0IiBpbiBob29rcyAmJgoJCQkJCQkoIHJldCA9IGhvb2tzLmdldCggZWxlbSwgInZhbHVlIiApICkgIT09IHVuZGVmaW5lZAoJCQkJCSkgewoJCQkJCQlyZXR1cm4gcmV0OwoJCQkJCX0KCgkJCQkJcmV0ID0gZWxlbS52YWx1ZTsKCgkJCQkJcmV0dXJuIHR5cGVvZiByZXQgPT09ICJzdHJpbmciID8KCgkJCQkJCS8vIGhhbmRsZSBtb3N0IGNvbW1vbiBzdHJpbmcgY2FzZXMKCQkJCQkJcmV0LnJlcGxhY2UoIHJyZXR1cm4sICIiICkgOgoKCQkJCQkJLy8gaGFuZGxlIGNhc2VzIHdoZXJlIHZhbHVlIGlzIG51bGwvdW5kZWYgb3IgbnVtYmVyCgkJCQkJCXJldCA9PSBudWxsID8gIiIgOiByZXQ7CgkJCQl9CgoJCQkJcmV0dXJuOwoJCQl9CgoJCQlpc0Z1bmN0aW9uID0galF1ZXJ5LmlzRnVuY3Rpb24oIHZhbHVlICk7CgoJCQlyZXR1cm4gdGhpcy5lYWNoKCBmdW5jdGlvbiggaSApIHsKCQkJCXZhciB2YWw7CgoJCQkJaWYgKCB0aGlzLm5vZGVUeXBlICE9PSAxICkgewoJCQkJCXJldHVybjsKCQkJCX0KCgkJCQlpZiAoIGlzRnVuY3Rpb24gKSB7CgkJCQkJdmFsID0gdmFsdWUuY2FsbCggdGhpcywgaSwgalF1ZXJ5KCB0aGlzICkudmFsKCkgKTsKCQkJCX0gZWxzZSB7CgkJCQkJdmFsID0gdmFsdWU7CgkJCQl9CgoJCQkJLy8gVHJlYXQgbnVsbC91bmRlZmluZWQgYXMgIiI7IGNvbnZlcnQgbnVtYmVycyB0byBzdHJpbmcKCQkJCWlmICggdmFsID09IG51bGwgKSB7CgkJCQkJdmFsID0gIiI7CgkJCQl9IGVsc2UgaWYgKCB0eXBlb2YgdmFsID09PSAibnVtYmVyIiApIHsKCQkJCQl2YWwgKz0gIiI7CgkJCQl9IGVsc2UgaWYgKCBqUXVlcnkuaXNBcnJheSggdmFsICkgKSB7CgkJCQkJdmFsID0galF1ZXJ5Lm1hcCggdmFsLCBmdW5jdGlvbiggdmFsdWUgKSB7CgkJCQkJCXJldHVybiB2YWx1ZSA9PSBudWxsID8gIiIgOiB2YWx1ZSArICIiOwoJCQkJCX0gKTsKCQkJCX0KCgkJCQlob29rcyA9IGpRdWVyeS52YWxIb29rc1sgdGhpcy50eXBlIF0gfHwgalF1ZXJ5LnZhbEhvb2tzWyB0aGlzLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgXTsKCgkJCQkvLyBJZiBzZXQgcmV0dXJucyB1bmRlZmluZWQsIGZhbGwgYmFjayB0byBub3JtYWwgc2V0dGluZwoJCQkJaWYgKCAhaG9va3MgfHwgISggInNldCIgaW4gaG9va3MgKSB8fCBob29rcy5zZXQoIHRoaXMsIHZhbCwgInZhbHVlIiApID09PSB1bmRlZmluZWQgKSB7CgkJCQkJdGhpcy52YWx1ZSA9IHZhbDsKCQkJCX0KCQkJfSApOwoJCX0KCX0gKTsKCglqUXVlcnkuZXh0ZW5kKCB7CgkJdmFsSG9va3M6IHsKCQkJb3B0aW9uOiB7CgkJCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJCXZhciB2YWwgPSBqUXVlcnkuZmluZC5hdHRyKCBlbGVtLCAidmFsdWUiICk7CgkJCQkJcmV0dXJuIHZhbCAhPSBudWxsID8KCQkJCQkJdmFsIDoKCgkJCQkJCS8vIFN1cHBvcnQ6IElFMTAtMTErCgkJCQkJCS8vIG9wdGlvbi50ZXh0IHRocm93cyBleGNlcHRpb25zICgjMTQ2ODYsICMxNDg1OCkKCQkJCQkJLy8gU3RyaXAgYW5kIGNvbGxhcHNlIHdoaXRlc3BhY2UKCQkJCQkJLy8gaHR0cHM6Ly9odG1sLnNwZWMud2hhdHdnLm9yZy8jc3RyaXAtYW5kLWNvbGxhcHNlLXdoaXRlc3BhY2UKCQkJCQkJalF1ZXJ5LnRyaW0oIGpRdWVyeS50ZXh0KCBlbGVtICkgKS5yZXBsYWNlKCByc3BhY2VzLCAiICIgKTsKCQkJCX0KCQkJfSwKCQkJc2VsZWN0OiB7CgkJCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJCXZhciB2YWx1ZSwgb3B0aW9uLAoJCQkJCQlvcHRpb25zID0gZWxlbS5vcHRpb25zLAoJCQkJCQlpbmRleCA9IGVsZW0uc2VsZWN0ZWRJbmRleCwKCQkJCQkJb25lID0gZWxlbS50eXBlID09PSAic2VsZWN0LW9uZSIgfHwgaW5kZXggPCAwLAoJCQkJCQl2YWx1ZXMgPSBvbmUgPyBudWxsIDogW10sCgkJCQkJCW1heCA9IG9uZSA/IGluZGV4ICsgMSA6IG9wdGlvbnMubGVuZ3RoLAoJCQkJCQlpID0gaW5kZXggPCAwID8KCQkJCQkJCW1heCA6CgkJCQkJCQlvbmUgPyBpbmRleCA6IDA7CgoJCQkJCS8vIExvb3AgdGhyb3VnaCBhbGwgdGhlIHNlbGVjdGVkIG9wdGlvbnMKCQkJCQlmb3IgKCA7IGkgPCBtYXg7IGkrKyApIHsKCQkJCQkJb3B0aW9uID0gb3B0aW9uc1sgaSBdOwoKCQkJCQkJLy8gb2xkSUUgZG9lc24ndCB1cGRhdGUgc2VsZWN0ZWQgYWZ0ZXIgZm9ybSByZXNldCAoIzI1NTEpCgkJCQkJCWlmICggKCBvcHRpb24uc2VsZWN0ZWQgfHwgaSA9PT0gaW5kZXggKSAmJgoKCQkJCQkJCQkvLyBEb24ndCByZXR1cm4gb3B0aW9ucyB0aGF0IGFyZSBkaXNhYmxlZCBvciBpbiBhIGRpc2FibGVkIG9wdGdyb3VwCgkJCQkJCQkJKCBzdXBwb3J0Lm9wdERpc2FibGVkID8KCQkJCQkJCQkJIW9wdGlvbi5kaXNhYmxlZCA6CgkJCQkJCQkJCW9wdGlvbi5nZXRBdHRyaWJ1dGUoICJkaXNhYmxlZCIgKSA9PT0gbnVsbCApICYmCgkJCQkJCQkJKCAhb3B0aW9uLnBhcmVudE5vZGUuZGlzYWJsZWQgfHwKCQkJCQkJCQkJIWpRdWVyeS5ub2RlTmFtZSggb3B0aW9uLnBhcmVudE5vZGUsICJvcHRncm91cCIgKSApICkgewoKCQkJCQkJCS8vIEdldCB0aGUgc3BlY2lmaWMgdmFsdWUgZm9yIHRoZSBvcHRpb24KCQkJCQkJCXZhbHVlID0galF1ZXJ5KCBvcHRpb24gKS52YWwoKTsKCgkJCQkJCQkvLyBXZSBkb24ndCBuZWVkIGFuIGFycmF5IGZvciBvbmUgc2VsZWN0cwoJCQkJCQkJaWYgKCBvbmUgKSB7CgkJCQkJCQkJcmV0dXJuIHZhbHVlOwoJCQkJCQkJfQoKCQkJCQkJCS8vIE11bHRpLVNlbGVjdHMgcmV0dXJuIGFuIGFycmF5CgkJCQkJCQl2YWx1ZXMucHVzaCggdmFsdWUgKTsKCQkJCQkJfQoJCQkJCX0KCgkJCQkJcmV0dXJuIHZhbHVlczsKCQkJCX0sCgoJCQkJc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUgKSB7CgkJCQkJdmFyIG9wdGlvblNldCwgb3B0aW9uLAoJCQkJCQlvcHRpb25zID0gZWxlbS5vcHRpb25zLAoJCQkJCQl2YWx1ZXMgPSBqUXVlcnkubWFrZUFycmF5KCB2YWx1ZSApLAoJCQkJCQlpID0gb3B0aW9ucy5sZW5ndGg7CgoJCQkJCXdoaWxlICggaS0tICkgewoJCQkJCQlvcHRpb24gPSBvcHRpb25zWyBpIF07CgoJCQkJCQlpZiAoIGpRdWVyeS5pbkFycmF5KCBqUXVlcnkudmFsSG9va3Mub3B0aW9uLmdldCggb3B0aW9uICksIHZhbHVlcyApID4gLTEgKSB7CgoJCQkJCQkJLy8gU3VwcG9ydDogSUU2CgkJCQkJCQkvLyBXaGVuIG5ldyBvcHRpb24gZWxlbWVudCBpcyBhZGRlZCB0byBzZWxlY3QgYm94IHdlIG5lZWQgdG8KCQkJCQkJCS8vIGZvcmNlIHJlZmxvdyBvZiBuZXdseSBhZGRlZCBub2RlIGluIG9yZGVyIHRvIHdvcmthcm91bmQgZGVsYXkKCQkJCQkJCS8vIG9mIGluaXRpYWxpemF0aW9uIHByb3BlcnRpZXMKCQkJCQkJCXRyeSB7CgkJCQkJCQkJb3B0aW9uLnNlbGVjdGVkID0gb3B0aW9uU2V0ID0gdHJ1ZTsKCgkJCQkJCQl9IGNhdGNoICggXyApIHsKCgkJCQkJCQkJLy8gV2lsbCBiZSBleGVjdXRlZCBvbmx5IGluIElFNgoJCQkJCQkJCW9wdGlvbi5zY3JvbGxIZWlnaHQ7CgkJCQkJCQl9CgoJCQkJCQl9IGVsc2UgewoJCQkJCQkJb3B0aW9uLnNlbGVjdGVkID0gZmFsc2U7CgkJCQkJCX0KCQkJCQl9CgoJCQkJCS8vIEZvcmNlIGJyb3dzZXJzIHRvIGJlaGF2ZSBjb25zaXN0ZW50bHkgd2hlbiBub24tbWF0Y2hpbmcgdmFsdWUgaXMgc2V0CgkJCQkJaWYgKCAhb3B0aW9uU2V0ICkgewoJCQkJCQllbGVtLnNlbGVjdGVkSW5kZXggPSAtMTsKCQkJCQl9CgoJCQkJCXJldHVybiBvcHRpb25zOwoJCQkJfQoJCQl9CgkJfQoJfSApOwoKCS8vIFJhZGlvcyBhbmQgY2hlY2tib3hlcyBnZXR0ZXIvc2V0dGVyCglqUXVlcnkuZWFjaCggWyAicmFkaW8iLCAiY2hlY2tib3giIF0sIGZ1bmN0aW9uKCkgewoJCWpRdWVyeS52YWxIb29rc1sgdGhpcyBdID0gewoJCQlzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSApIHsKCQkJCWlmICggalF1ZXJ5LmlzQXJyYXkoIHZhbHVlICkgKSB7CgkJCQkJcmV0dXJuICggZWxlbS5jaGVja2VkID0galF1ZXJ5LmluQXJyYXkoIGpRdWVyeSggZWxlbSApLnZhbCgpLCB2YWx1ZSApID4gLTEgKTsKCQkJCX0KCQkJfQoJCX07CgkJaWYgKCAhc3VwcG9ydC5jaGVja09uICkgewoJCQlqUXVlcnkudmFsSG9va3NbIHRoaXMgXS5nZXQgPSBmdW5jdGlvbiggZWxlbSApIHsKCQkJCXJldHVybiBlbGVtLmdldEF0dHJpYnV0ZSggInZhbHVlIiApID09PSBudWxsID8gIm9uIiA6IGVsZW0udmFsdWU7CgkJCX07CgkJfQoJfSApOwoKCgoKCXZhciBub2RlSG9vaywgYm9vbEhvb2ssCgkJYXR0ckhhbmRsZSA9IGpRdWVyeS5leHByLmF0dHJIYW5kbGUsCgkJcnVzZURlZmF1bHQgPSAvXig/OmNoZWNrZWR8c2VsZWN0ZWQpJC9pLAoJCWdldFNldEF0dHJpYnV0ZSA9IHN1cHBvcnQuZ2V0U2V0QXR0cmlidXRlLAoJCWdldFNldElucHV0ID0gc3VwcG9ydC5pbnB1dDsKCglqUXVlcnkuZm4uZXh0ZW5kKCB7CgkJYXR0cjogZnVuY3Rpb24oIG5hbWUsIHZhbHVlICkgewoJCQlyZXR1cm4gYWNjZXNzKCB0aGlzLCBqUXVlcnkuYXR0ciwgbmFtZSwgdmFsdWUsIGFyZ3VtZW50cy5sZW5ndGggPiAxICk7CgkJfSwKCgkJcmVtb3ZlQXR0cjogZnVuY3Rpb24oIG5hbWUgKSB7CgkJCXJldHVybiB0aGlzLmVhY2goIGZ1bmN0aW9uKCkgewoJCQkJalF1ZXJ5LnJlbW92ZUF0dHIoIHRoaXMsIG5hbWUgKTsKCQkJfSApOwoJCX0KCX0gKTsKCglqUXVlcnkuZXh0ZW5kKCB7CgkJYXR0cjogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIHZhbHVlICkgewoJCQl2YXIgcmV0LCBob29rcywKCQkJCW5UeXBlID0gZWxlbS5ub2RlVHlwZTsKCgkJCS8vIERvbid0IGdldC9zZXQgYXR0cmlidXRlcyBvbiB0ZXh0LCBjb21tZW50IGFuZCBhdHRyaWJ1dGUgbm9kZXMKCQkJaWYgKCBuVHlwZSA9PT0gMyB8fCBuVHlwZSA9PT0gOCB8fCBuVHlwZSA9PT0gMiApIHsKCQkJCXJldHVybjsKCQkJfQoKCQkJLy8gRmFsbGJhY2sgdG8gcHJvcCB3aGVuIGF0dHJpYnV0ZXMgYXJlIG5vdCBzdXBwb3J0ZWQKCQkJaWYgKCB0eXBlb2YgZWxlbS5nZXRBdHRyaWJ1dGUgPT09ICJ1bmRlZmluZWQiICkgewoJCQkJcmV0dXJuIGpRdWVyeS5wcm9wKCBlbGVtLCBuYW1lLCB2YWx1ZSApOwoJCQl9CgoJCQkvLyBBbGwgYXR0cmlidXRlcyBhcmUgbG93ZXJjYXNlCgkJCS8vIEdyYWIgbmVjZXNzYXJ5IGhvb2sgaWYgb25lIGlzIGRlZmluZWQKCQkJaWYgKCBuVHlwZSAhPT0gMSB8fCAhalF1ZXJ5LmlzWE1MRG9jKCBlbGVtICkgKSB7CgkJCQluYW1lID0gbmFtZS50b0xvd2VyQ2FzZSgpOwoJCQkJaG9va3MgPSBqUXVlcnkuYXR0ckhvb2tzWyBuYW1lIF0gfHwKCQkJCQkoIGpRdWVyeS5leHByLm1hdGNoLmJvb2wudGVzdCggbmFtZSApID8gYm9vbEhvb2sgOiBub2RlSG9vayApOwoJCQl9CgoJCQlpZiAoIHZhbHVlICE9PSB1bmRlZmluZWQgKSB7CgkJCQlpZiAoIHZhbHVlID09PSBudWxsICkgewoJCQkJCWpRdWVyeS5yZW1vdmVBdHRyKCBlbGVtLCBuYW1lICk7CgkJCQkJcmV0dXJuOwoJCQkJfQoKCQkJCWlmICggaG9va3MgJiYgInNldCIgaW4gaG9va3MgJiYKCQkJCQkoIHJldCA9IGhvb2tzLnNldCggZWxlbSwgdmFsdWUsIG5hbWUgKSApICE9PSB1bmRlZmluZWQgKSB7CgkJCQkJcmV0dXJuIHJldDsKCQkJCX0KCgkJCQllbGVtLnNldEF0dHJpYnV0ZSggbmFtZSwgdmFsdWUgKyAiIiApOwoJCQkJcmV0dXJuIHZhbHVlOwoJCQl9CgoJCQlpZiAoIGhvb2tzICYmICJnZXQiIGluIGhvb2tzICYmICggcmV0ID0gaG9va3MuZ2V0KCBlbGVtLCBuYW1lICkgKSAhPT0gbnVsbCApIHsKCQkJCXJldHVybiByZXQ7CgkJCX0KCgkJCXJldCA9IGpRdWVyeS5maW5kLmF0dHIoIGVsZW0sIG5hbWUgKTsKCgkJCS8vIE5vbi1leGlzdGVudCBhdHRyaWJ1dGVzIHJldHVybiBudWxsLCB3ZSBub3JtYWxpemUgdG8gdW5kZWZpbmVkCgkJCXJldHVybiByZXQgPT0gbnVsbCA/IHVuZGVmaW5lZCA6IHJldDsKCQl9LAoKCQlhdHRySG9va3M6IHsKCQkJdHlwZTogewoJCQkJc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUgKSB7CgkJCQkJaWYgKCAhc3VwcG9ydC5yYWRpb1ZhbHVlICYmIHZhbHVlID09PSAicmFkaW8iICYmCgkJCQkJCWpRdWVyeS5ub2RlTmFtZSggZWxlbSwgImlucHV0IiApICkgewoKCQkJCQkJLy8gU2V0dGluZyB0aGUgdHlwZSBvbiBhIHJhZGlvIGJ1dHRvbiBhZnRlciB0aGUgdmFsdWUgcmVzZXRzIHRoZSB2YWx1ZSBpbiBJRTgtOQoJCQkJCQkvLyBSZXNldCB2YWx1ZSB0byBkZWZhdWx0IGluIGNhc2UgdHlwZSBpcyBzZXQgYWZ0ZXIgdmFsdWUgZHVyaW5nIGNyZWF0aW9uCgkJCQkJCXZhciB2YWwgPSBlbGVtLnZhbHVlOwoJCQkJCQllbGVtLnNldEF0dHJpYnV0ZSggInR5cGUiLCB2YWx1ZSApOwoJCQkJCQlpZiAoIHZhbCApIHsKCQkJCQkJCWVsZW0udmFsdWUgPSB2YWw7CgkJCQkJCX0KCQkJCQkJcmV0dXJuIHZhbHVlOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0sCgoJCXJlbW92ZUF0dHI6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSApIHsKCQkJdmFyIG5hbWUsIHByb3BOYW1lLAoJCQkJaSA9IDAsCgkJCQlhdHRyTmFtZXMgPSB2YWx1ZSAmJiB2YWx1ZS5tYXRjaCggcm5vdHdoaXRlICk7CgoJCQlpZiAoIGF0dHJOYW1lcyAmJiBlbGVtLm5vZGVUeXBlID09PSAxICkgewoJCQkJd2hpbGUgKCAoIG5hbWUgPSBhdHRyTmFtZXNbIGkrKyBdICkgKSB7CgkJCQkJcHJvcE5hbWUgPSBqUXVlcnkucHJvcEZpeFsgbmFtZSBdIHx8IG5hbWU7CgoJCQkJCS8vIEJvb2xlYW4gYXR0cmlidXRlcyBnZXQgc3BlY2lhbCB0cmVhdG1lbnQgKCMxMDg3MCkKCQkJCQlpZiAoIGpRdWVyeS5leHByLm1hdGNoLmJvb2wudGVzdCggbmFtZSApICkgewoKCQkJCQkJLy8gU2V0IGNvcnJlc3BvbmRpbmcgcHJvcGVydHkgdG8gZmFsc2UKCQkJCQkJaWYgKCBnZXRTZXRJbnB1dCAmJiBnZXRTZXRBdHRyaWJ1dGUgfHwgIXJ1c2VEZWZhdWx0LnRlc3QoIG5hbWUgKSApIHsKCQkJCQkJCWVsZW1bIHByb3BOYW1lIF0gPSBmYWxzZTsKCgkJCQkJCS8vIFN1cHBvcnQ6IElFPDkKCQkJCQkJLy8gQWxzbyBjbGVhciBkZWZhdWx0Q2hlY2tlZC9kZWZhdWx0U2VsZWN0ZWQgKGlmIGFwcHJvcHJpYXRlKQoJCQkJCQl9IGVsc2UgewoJCQkJCQkJZWxlbVsgalF1ZXJ5LmNhbWVsQ2FzZSggImRlZmF1bHQtIiArIG5hbWUgKSBdID0KCQkJCQkJCQllbGVtWyBwcm9wTmFtZSBdID0gZmFsc2U7CgkJCQkJCX0KCgkJCQkJLy8gU2VlICM5Njk5IGZvciBleHBsYW5hdGlvbiBvZiB0aGlzIGFwcHJvYWNoIChzZXR0aW5nIGZpcnN0LCB0aGVuIHJlbW92YWwpCgkJCQkJfSBlbHNlIHsKCQkJCQkJalF1ZXJ5LmF0dHIoIGVsZW0sIG5hbWUsICIiICk7CgkJCQkJfQoKCQkJCQllbGVtLnJlbW92ZUF0dHJpYnV0ZSggZ2V0U2V0QXR0cmlidXRlID8gbmFtZSA6IHByb3BOYW1lICk7CgkJCQl9CgkJCX0KCQl9Cgl9ICk7CgoJLy8gSG9va3MgZm9yIGJvb2xlYW4gYXR0cmlidXRlcwoJYm9vbEhvb2sgPSB7CgkJc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUsIG5hbWUgKSB7CgkJCWlmICggdmFsdWUgPT09IGZhbHNlICkgewoKCQkJCS8vIFJlbW92ZSBib29sZWFuIGF0dHJpYnV0ZXMgd2hlbiBzZXQgdG8gZmFsc2UKCQkJCWpRdWVyeS5yZW1vdmVBdHRyKCBlbGVtLCBuYW1lICk7CgkJCX0gZWxzZSBpZiAoIGdldFNldElucHV0ICYmIGdldFNldEF0dHJpYnV0ZSB8fCAhcnVzZURlZmF1bHQudGVzdCggbmFtZSApICkgewoKCQkJCS8vIElFPDggbmVlZHMgdGhlICpwcm9wZXJ0eSogbmFtZQoJCQkJZWxlbS5zZXRBdHRyaWJ1dGUoICFnZXRTZXRBdHRyaWJ1dGUgJiYgalF1ZXJ5LnByb3BGaXhbIG5hbWUgXSB8fCBuYW1lLCBuYW1lICk7CgoJCQl9IGVsc2UgewoKCQkJCS8vIFN1cHBvcnQ6IElFPDkKCQkJCS8vIFVzZSBkZWZhdWx0Q2hlY2tlZCBhbmQgZGVmYXVsdFNlbGVjdGVkIGZvciBvbGRJRQoJCQkJZWxlbVsgalF1ZXJ5LmNhbWVsQ2FzZSggImRlZmF1bHQtIiArIG5hbWUgKSBdID0gZWxlbVsgbmFtZSBdID0gdHJ1ZTsKCQkJfQoJCQlyZXR1cm4gbmFtZTsKCQl9Cgl9OwoKCWpRdWVyeS5lYWNoKCBqUXVlcnkuZXhwci5tYXRjaC5ib29sLnNvdXJjZS5tYXRjaCggL1x3Ky9nICksIGZ1bmN0aW9uKCBpLCBuYW1lICkgewoJCXZhciBnZXR0ZXIgPSBhdHRySGFuZGxlWyBuYW1lIF0gfHwgalF1ZXJ5LmZpbmQuYXR0cjsKCgkJaWYgKCBnZXRTZXRJbnB1dCAmJiBnZXRTZXRBdHRyaWJ1dGUgfHwgIXJ1c2VEZWZhdWx0LnRlc3QoIG5hbWUgKSApIHsKCQkJYXR0ckhhbmRsZVsgbmFtZSBdID0gZnVuY3Rpb24oIGVsZW0sIG5hbWUsIGlzWE1MICkgewoJCQkJdmFyIHJldCwgaGFuZGxlOwoJCQkJaWYgKCAhaXNYTUwgKSB7CgoJCQkJCS8vIEF2b2lkIGFuIGluZmluaXRlIGxvb3AgYnkgdGVtcG9yYXJpbHkgcmVtb3ZpbmcgdGhpcyBmdW5jdGlvbiBmcm9tIHRoZSBnZXR0ZXIKCQkJCQloYW5kbGUgPSBhdHRySGFuZGxlWyBuYW1lIF07CgkJCQkJYXR0ckhhbmRsZVsgbmFtZSBdID0gcmV0OwoJCQkJCXJldCA9IGdldHRlciggZWxlbSwgbmFtZSwgaXNYTUwgKSAhPSBudWxsID8KCQkJCQkJbmFtZS50b0xvd2VyQ2FzZSgpIDoKCQkJCQkJbnVsbDsKCQkJCQlhdHRySGFuZGxlWyBuYW1lIF0gPSBoYW5kbGU7CgkJCQl9CgkJCQlyZXR1cm4gcmV0OwoJCQl9OwoJCX0gZWxzZSB7CgkJCWF0dHJIYW5kbGVbIG5hbWUgXSA9IGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCBpc1hNTCApIHsKCQkJCWlmICggIWlzWE1MICkgewoJCQkJCXJldHVybiBlbGVtWyBqUXVlcnkuY2FtZWxDYXNlKCAiZGVmYXVsdC0iICsgbmFtZSApIF0gPwoJCQkJCQluYW1lLnRvTG93ZXJDYXNlKCkgOgoJCQkJCQludWxsOwoJCQkJfQoJCQl9OwoJCX0KCX0gKTsKCgkvLyBmaXggb2xkSUUgYXR0cm9wZXJ0aWVzCglpZiAoICFnZXRTZXRJbnB1dCB8fCAhZ2V0U2V0QXR0cmlidXRlICkgewoJCWpRdWVyeS5hdHRySG9va3MudmFsdWUgPSB7CgkJCXNldDogZnVuY3Rpb24oIGVsZW0sIHZhbHVlLCBuYW1lICkgewoJCQkJaWYgKCBqUXVlcnkubm9kZU5hbWUoIGVsZW0sICJpbnB1dCIgKSApIHsKCgkJCQkJLy8gRG9lcyBub3QgcmV0dXJuIHNvIHRoYXQgc2V0QXR0cmlidXRlIGlzIGFsc28gdXNlZAoJCQkJCWVsZW0uZGVmYXVsdFZhbHVlID0gdmFsdWU7CgkJCQl9IGVsc2UgewoKCQkJCQkvLyBVc2Ugbm9kZUhvb2sgaWYgZGVmaW5lZCAoIzE5NTQpOyBvdGhlcndpc2Ugc2V0QXR0cmlidXRlIGlzIGZpbmUKCQkJCQlyZXR1cm4gbm9kZUhvb2sgJiYgbm9kZUhvb2suc2V0KCBlbGVtLCB2YWx1ZSwgbmFtZSApOwoJCQkJfQoJCQl9CgkJfTsKCX0KCgkvLyBJRTYvNyBkbyBub3Qgc3VwcG9ydCBnZXR0aW5nL3NldHRpbmcgc29tZSBhdHRyaWJ1dGVzIHdpdGggZ2V0L3NldEF0dHJpYnV0ZQoJaWYgKCAhZ2V0U2V0QXR0cmlidXRlICkgewoKCQkvLyBVc2UgdGhpcyBmb3IgYW55IGF0dHJpYnV0ZSBpbiBJRTYvNwoJCS8vIFRoaXMgZml4ZXMgYWxtb3N0IGV2ZXJ5IElFNi83IGlzc3VlCgkJbm9kZUhvb2sgPSB7CgkJCXNldDogZnVuY3Rpb24oIGVsZW0sIHZhbHVlLCBuYW1lICkgewoKCQkJCS8vIFNldCB0aGUgZXhpc3Rpbmcgb3IgY3JlYXRlIGEgbmV3IGF0dHJpYnV0ZSBub2RlCgkJCQl2YXIgcmV0ID0gZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKCBuYW1lICk7CgkJCQlpZiAoICFyZXQgKSB7CgkJCQkJZWxlbS5zZXRBdHRyaWJ1dGVOb2RlKAoJCQkJCQkoIHJldCA9IGVsZW0ub3duZXJEb2N1bWVudC5jcmVhdGVBdHRyaWJ1dGUoIG5hbWUgKSApCgkJCQkJKTsKCQkJCX0KCgkJCQlyZXQudmFsdWUgPSB2YWx1ZSArPSAiIjsKCgkJCQkvLyBCcmVhayBhc3NvY2lhdGlvbiB3aXRoIGNsb25lZCBlbGVtZW50cyBieSBhbHNvIHVzaW5nIHNldEF0dHJpYnV0ZSAoIzk2NDYpCgkJCQlpZiAoIG5hbWUgPT09ICJ2YWx1ZSIgfHwgdmFsdWUgPT09IGVsZW0uZ2V0QXR0cmlidXRlKCBuYW1lICkgKSB7CgkJCQkJcmV0dXJuIHZhbHVlOwoJCQkJfQoJCQl9CgkJfTsKCgkJLy8gU29tZSBhdHRyaWJ1dGVzIGFyZSBjb25zdHJ1Y3RlZCB3aXRoIGVtcHR5LXN0cmluZyB2YWx1ZXMgd2hlbiBub3QgZGVmaW5lZAoJCWF0dHJIYW5kbGUuaWQgPSBhdHRySGFuZGxlLm5hbWUgPSBhdHRySGFuZGxlLmNvb3JkcyA9CgkJCWZ1bmN0aW9uKCBlbGVtLCBuYW1lLCBpc1hNTCApIHsKCQkJCXZhciByZXQ7CgkJCQlpZiAoICFpc1hNTCApIHsKCQkJCQlyZXR1cm4gKCByZXQgPSBlbGVtLmdldEF0dHJpYnV0ZU5vZGUoIG5hbWUgKSApICYmIHJldC52YWx1ZSAhPT0gIiIgPwoJCQkJCQlyZXQudmFsdWUgOgoJCQkJCQludWxsOwoJCQkJfQoJCQl9OwoKCQkvLyBGaXhpbmcgdmFsdWUgcmV0cmlldmFsIG9uIGEgYnV0dG9uIHJlcXVpcmVzIHRoaXMgbW9kdWxlCgkJalF1ZXJ5LnZhbEhvb2tzLmJ1dHRvbiA9IHsKCQkJZ2V0OiBmdW5jdGlvbiggZWxlbSwgbmFtZSApIHsKCQkJCXZhciByZXQgPSBlbGVtLmdldEF0dHJpYnV0ZU5vZGUoIG5hbWUgKTsKCQkJCWlmICggcmV0ICYmIHJldC5zcGVjaWZpZWQgKSB7CgkJCQkJcmV0dXJuIHJldC52YWx1ZTsKCQkJCX0KCQkJfSwKCQkJc2V0OiBub2RlSG9vay5zZXQKCQl9OwoKCQkvLyBTZXQgY29udGVudGVkaXRhYmxlIHRvIGZhbHNlIG9uIHJlbW92YWxzKCMxMDQyOSkKCQkvLyBTZXR0aW5nIHRvIGVtcHR5IHN0cmluZyB0aHJvd3MgYW4gZXJyb3IgYXMgYW4gaW52YWxpZCB2YWx1ZQoJCWpRdWVyeS5hdHRySG9va3MuY29udGVudGVkaXRhYmxlID0gewoJCQlzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSwgbmFtZSApIHsKCQkJCW5vZGVIb29rLnNldCggZWxlbSwgdmFsdWUgPT09ICIiID8gZmFsc2UgOiB2YWx1ZSwgbmFtZSApOwoJCQl9CgkJfTsKCgkJLy8gU2V0IHdpZHRoIGFuZCBoZWlnaHQgdG8gYXV0byBpbnN0ZWFkIG9mIDAgb24gZW1wdHkgc3RyaW5nKCBCdWcgIzgxNTAgKQoJCS8vIFRoaXMgaXMgZm9yIHJlbW92YWxzCgkJalF1ZXJ5LmVhY2goIFsgIndpZHRoIiwgImhlaWdodCIgXSwgZnVuY3Rpb24oIGksIG5hbWUgKSB7CgkJCWpRdWVyeS5hdHRySG9va3NbIG5hbWUgXSA9IHsKCQkJCXNldDogZnVuY3Rpb24oIGVsZW0sIHZhbHVlICkgewoJCQkJCWlmICggdmFsdWUgPT09ICIiICkgewoJCQkJCQllbGVtLnNldEF0dHJpYnV0ZSggbmFtZSwgImF1dG8iICk7CgkJCQkJCXJldHVybiB2YWx1ZTsKCQkJCQl9CgkJCQl9CgkJCX07CgkJfSApOwoJfQoKCWlmICggIXN1cHBvcnQuc3R5bGUgKSB7CgkJalF1ZXJ5LmF0dHJIb29rcy5zdHlsZSA9IHsKCQkJZ2V0OiBmdW5jdGlvbiggZWxlbSApIHsKCgkJCQkvLyBSZXR1cm4gdW5kZWZpbmVkIGluIHRoZSBjYXNlIG9mIGVtcHR5IHN0cmluZwoJCQkJLy8gTm90ZTogSUUgdXBwZXJjYXNlcyBjc3MgcHJvcGVydHkgbmFtZXMsIGJ1dCBpZiB3ZSB3ZXJlIHRvIC50b0xvd2VyQ2FzZSgpCgkJCQkvLyAuY3NzVGV4dCwgdGhhdCB3b3VsZCBkZXN0cm95IGNhc2Ugc2Vuc2l0aXZpdHkgaW4gVVJMJ3MsIGxpa2UgaW4gImJhY2tncm91bmQiCgkJCQlyZXR1cm4gZWxlbS5zdHlsZS5jc3NUZXh0IHx8IHVuZGVmaW5lZDsKCQkJfSwKCQkJc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUgKSB7CgkJCQlyZXR1cm4gKCBlbGVtLnN0eWxlLmNzc1RleHQgPSB2YWx1ZSArICIiICk7CgkJCX0KCQl9OwoJfQoKCgoKCXZhciByZm9jdXNhYmxlID0gL14oPzppbnB1dHxzZWxlY3R8dGV4dGFyZWF8YnV0dG9ufG9iamVjdCkkL2ksCgkJcmNsaWNrYWJsZSA9IC9eKD86YXxhcmVhKSQvaTsKCglqUXVlcnkuZm4uZXh0ZW5kKCB7CgkJcHJvcDogZnVuY3Rpb24oIG5hbWUsIHZhbHVlICkgewoJCQlyZXR1cm4gYWNjZXNzKCB0aGlzLCBqUXVlcnkucHJvcCwgbmFtZSwgdmFsdWUsIGFyZ3VtZW50cy5sZW5ndGggPiAxICk7CgkJfSwKCgkJcmVtb3ZlUHJvcDogZnVuY3Rpb24oIG5hbWUgKSB7CgkJCW5hbWUgPSBqUXVlcnkucHJvcEZpeFsgbmFtZSBdIHx8IG5hbWU7CgkJCXJldHVybiB0aGlzLmVhY2goIGZ1bmN0aW9uKCkgewoKCQkJCS8vIHRyeS9jYXRjaCBoYW5kbGVzIGNhc2VzIHdoZXJlIElFIGJhbGtzIChzdWNoIGFzIHJlbW92aW5nIGEgcHJvcGVydHkgb24gd2luZG93KQoJCQkJdHJ5IHsKCQkJCQl0aGlzWyBuYW1lIF0gPSB1bmRlZmluZWQ7CgkJCQkJZGVsZXRlIHRoaXNbIG5hbWUgXTsKCQkJCX0gY2F0Y2ggKCBlICkge30KCQkJfSApOwoJCX0KCX0gKTsKCglqUXVlcnkuZXh0ZW5kKCB7CgkJcHJvcDogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIHZhbHVlICkgewoJCQl2YXIgcmV0LCBob29rcywKCQkJCW5UeXBlID0gZWxlbS5ub2RlVHlwZTsKCgkJCS8vIERvbid0IGdldC9zZXQgcHJvcGVydGllcyBvbiB0ZXh0LCBjb21tZW50IGFuZCBhdHRyaWJ1dGUgbm9kZXMKCQkJaWYgKCBuVHlwZSA9PT0gMyB8fCBuVHlwZSA9PT0gOCB8fCBuVHlwZSA9PT0gMiApIHsKCQkJCXJldHVybjsKCQkJfQoKCQkJaWYgKCBuVHlwZSAhPT0gMSB8fCAhalF1ZXJ5LmlzWE1MRG9jKCBlbGVtICkgKSB7CgoJCQkJLy8gRml4IG5hbWUgYW5kIGF0dGFjaCBob29rcwoJCQkJbmFtZSA9IGpRdWVyeS5wcm9wRml4WyBuYW1lIF0gfHwgbmFtZTsKCQkJCWhvb2tzID0galF1ZXJ5LnByb3BIb29rc1sgbmFtZSBdOwoJCQl9CgoJCQlpZiAoIHZhbHVlICE9PSB1bmRlZmluZWQgKSB7CgkJCQlpZiAoIGhvb2tzICYmICJzZXQiIGluIGhvb2tzICYmCgkJCQkJKCByZXQgPSBob29rcy5zZXQoIGVsZW0sIHZhbHVlLCBuYW1lICkgKSAhPT0gdW5kZWZpbmVkICkgewoJCQkJCXJldHVybiByZXQ7CgkJCQl9CgoJCQkJcmV0dXJuICggZWxlbVsgbmFtZSBdID0gdmFsdWUgKTsKCQkJfQoKCQkJaWYgKCBob29rcyAmJiAiZ2V0IiBpbiBob29rcyAmJiAoIHJldCA9IGhvb2tzLmdldCggZWxlbSwgbmFtZSApICkgIT09IG51bGwgKSB7CgkJCQlyZXR1cm4gcmV0OwoJCQl9CgoJCQlyZXR1cm4gZWxlbVsgbmFtZSBdOwoJCX0sCgoJCXByb3BIb29rczogewoJCQl0YWJJbmRleDogewoJCQkJZ2V0OiBmdW5jdGlvbiggZWxlbSApIHsKCgkJCQkJLy8gZWxlbS50YWJJbmRleCBkb2Vzbid0IGFsd2F5cyByZXR1cm4gdGhlCgkJCQkJLy8gY29ycmVjdCB2YWx1ZSB3aGVuIGl0IGhhc24ndCBiZWVuIGV4cGxpY2l0bHkgc2V0CgkJCQkJLy8gaHR0cDovL2ZsdWlkcHJvamVjdC5vcmcvYmxvZy8yMDA4LzAxLzA5L2dldHRpbmctc2V0dGluZy1hbmQtcmVtb3ZpbmctdGFiaW5kZXgtdmFsdWVzLXdpdGgtamF2YXNjcmlwdC8KCQkJCQkvLyBVc2UgcHJvcGVyIGF0dHJpYnV0ZSByZXRyaWV2YWwoIzEyMDcyKQoJCQkJCXZhciB0YWJpbmRleCA9IGpRdWVyeS5maW5kLmF0dHIoIGVsZW0sICJ0YWJpbmRleCIgKTsKCgkJCQkJcmV0dXJuIHRhYmluZGV4ID8KCQkJCQkJcGFyc2VJbnQoIHRhYmluZGV4LCAxMCApIDoKCQkJCQkJcmZvY3VzYWJsZS50ZXN0KCBlbGVtLm5vZGVOYW1lICkgfHwKCQkJCQkJCXJjbGlja2FibGUudGVzdCggZWxlbS5ub2RlTmFtZSApICYmIGVsZW0uaHJlZiA/CgkJCQkJCQkJMCA6CgkJCQkJCQkJLTE7CgkJCQl9CgkJCX0KCQl9LAoKCQlwcm9wRml4OiB7CgkJCSJmb3IiOiAiaHRtbEZvciIsCgkJCSJjbGFzcyI6ICJjbGFzc05hbWUiCgkJfQoJfSApOwoKCS8vIFNvbWUgYXR0cmlidXRlcyByZXF1aXJlIGEgc3BlY2lhbCBjYWxsIG9uIElFCgkvLyBodHRwOi8vbXNkbi5taWNyb3NvZnQuY29tL2VuLXVzL2xpYnJhcnkvbXM1MzY0MjklMjhWUy44NSUyOS5hc3B4CglpZiAoICFzdXBwb3J0LmhyZWZOb3JtYWxpemVkICkgewoKCQkvLyBocmVmL3NyYyBwcm9wZXJ0eSBzaG91bGQgZ2V0IHRoZSBmdWxsIG5vcm1hbGl6ZWQgVVJMICgjMTAyOTkvIzEyOTE1KQoJCWpRdWVyeS5lYWNoKCBbICJocmVmIiwgInNyYyIgXSwgZnVuY3Rpb24oIGksIG5hbWUgKSB7CgkJCWpRdWVyeS5wcm9wSG9va3NbIG5hbWUgXSA9IHsKCQkJCWdldDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQkJcmV0dXJuIGVsZW0uZ2V0QXR0cmlidXRlKCBuYW1lLCA0ICk7CgkJCQl9CgkJCX07CgkJfSApOwoJfQoKCS8vIFN1cHBvcnQ6IFNhZmFyaSwgSUU5KwoJLy8gQWNjZXNzaW5nIHRoZSBzZWxlY3RlZEluZGV4IHByb3BlcnR5CgkvLyBmb3JjZXMgdGhlIGJyb3dzZXIgdG8gcmVzcGVjdCBzZXR0aW5nIHNlbGVjdGVkCgkvLyBvbiB0aGUgb3B0aW9uCgkvLyBUaGUgZ2V0dGVyIGVuc3VyZXMgYSBkZWZhdWx0IG9wdGlvbiBpcyBzZWxlY3RlZAoJLy8gd2hlbiBpbiBhbiBvcHRncm91cAoJaWYgKCAhc3VwcG9ydC5vcHRTZWxlY3RlZCApIHsKCQlqUXVlcnkucHJvcEhvb2tzLnNlbGVjdGVkID0gewoJCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJdmFyIHBhcmVudCA9IGVsZW0ucGFyZW50Tm9kZTsKCgkJCQlpZiAoIHBhcmVudCApIHsKCQkJCQlwYXJlbnQuc2VsZWN0ZWRJbmRleDsKCgkJCQkJLy8gTWFrZSBzdXJlIHRoYXQgaXQgYWxzbyB3b3JrcyB3aXRoIG9wdGdyb3Vwcywgc2VlICM1NzAxCgkJCQkJaWYgKCBwYXJlbnQucGFyZW50Tm9kZSApIHsKCQkJCQkJcGFyZW50LnBhcmVudE5vZGUuc2VsZWN0ZWRJbmRleDsKCQkJCQl9CgkJCQl9CgkJCQlyZXR1cm4gbnVsbDsKCQkJfSwKCQkJc2V0OiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCXZhciBwYXJlbnQgPSBlbGVtLnBhcmVudE5vZGU7CgkJCQlpZiAoIHBhcmVudCApIHsKCQkJCQlwYXJlbnQuc2VsZWN0ZWRJbmRleDsKCgkJCQkJaWYgKCBwYXJlbnQucGFyZW50Tm9kZSApIHsKCQkJCQkJcGFyZW50LnBhcmVudE5vZGUuc2VsZWN0ZWRJbmRleDsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9OwoJfQoKCWpRdWVyeS5lYWNoKCBbCgkJInRhYkluZGV4IiwKCQkicmVhZE9ubHkiLAoJCSJtYXhMZW5ndGgiLAoJCSJjZWxsU3BhY2luZyIsCgkJImNlbGxQYWRkaW5nIiwKCQkicm93U3BhbiIsCgkJImNvbFNwYW4iLAoJCSJ1c2VNYXAiLAoJCSJmcmFtZUJvcmRlciIsCgkJImNvbnRlbnRFZGl0YWJsZSIKCV0sIGZ1bmN0aW9uKCkgewoJCWpRdWVyeS5wcm9wRml4WyB0aGlzLnRvTG93ZXJDYXNlKCkgXSA9IHRoaXM7Cgl9ICk7CgoJLy8gSUU2LzcgY2FsbCBlbmN0eXBlIGVuY29kaW5nCglpZiAoICFzdXBwb3J0LmVuY3R5cGUgKSB7CgkJalF1ZXJ5LnByb3BGaXguZW5jdHlwZSA9ICJlbmNvZGluZyI7Cgl9CgoKCgoJdmFyIHJjbGFzcyA9IC9bXHRcclxuXGZdL2c7CgoJZnVuY3Rpb24gZ2V0Q2xhc3MoIGVsZW0gKSB7CgkJcmV0dXJuIGpRdWVyeS5hdHRyKCBlbGVtLCAiY2xhc3MiICkgfHwgIiI7Cgl9CgoJalF1ZXJ5LmZuLmV4dGVuZCggewoJCWFkZENsYXNzOiBmdW5jdGlvbiggdmFsdWUgKSB7CgkJCXZhciBjbGFzc2VzLCBlbGVtLCBjdXIsIGN1clZhbHVlLCBjbGF6eiwgaiwgZmluYWxWYWx1ZSwKCQkJCWkgPSAwOwoKCQkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggdmFsdWUgKSApIHsKCQkJCXJldHVybiB0aGlzLmVhY2goIGZ1bmN0aW9uKCBqICkgewoJCQkJCWpRdWVyeSggdGhpcyApLmFkZENsYXNzKCB2YWx1ZS5jYWxsKCB0aGlzLCBqLCBnZXRDbGFzcyggdGhpcyApICkgKTsKCQkJCX0gKTsKCQkJfQoKCQkJaWYgKCB0eXBlb2YgdmFsdWUgPT09ICJzdHJpbmciICYmIHZhbHVlICkgewoJCQkJY2xhc3NlcyA9IHZhbHVlLm1hdGNoKCBybm90d2hpdGUgKSB8fCBbXTsKCgkJCQl3aGlsZSAoICggZWxlbSA9IHRoaXNbIGkrKyBdICkgKSB7CgkJCQkJY3VyVmFsdWUgPSBnZXRDbGFzcyggZWxlbSApOwoJCQkJCWN1ciA9IGVsZW0ubm9kZVR5cGUgPT09IDEgJiYKCQkJCQkJKCAiICIgKyBjdXJWYWx1ZSArICIgIiApLnJlcGxhY2UoIHJjbGFzcywgIiAiICk7CgoJCQkJCWlmICggY3VyICkgewoJCQkJCQlqID0gMDsKCQkJCQkJd2hpbGUgKCAoIGNsYXp6ID0gY2xhc3Nlc1sgaisrIF0gKSApIHsKCQkJCQkJCWlmICggY3VyLmluZGV4T2YoICIgIiArIGNsYXp6ICsgIiAiICkgPCAwICkgewoJCQkJCQkJCWN1ciArPSBjbGF6eiArICIgIjsKCQkJCQkJCX0KCQkJCQkJfQoKCQkJCQkJLy8gb25seSBhc3NpZ24gaWYgZGlmZmVyZW50IHRvIGF2b2lkIHVubmVlZGVkIHJlbmRlcmluZy4KCQkJCQkJZmluYWxWYWx1ZSA9IGpRdWVyeS50cmltKCBjdXIgKTsKCQkJCQkJaWYgKCBjdXJWYWx1ZSAhPT0gZmluYWxWYWx1ZSApIHsKCQkJCQkJCWpRdWVyeS5hdHRyKCBlbGVtLCAiY2xhc3MiLCBmaW5hbFZhbHVlICk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCgkJCXJldHVybiB0aGlzOwoJCX0sCgoJCXJlbW92ZUNsYXNzOiBmdW5jdGlvbiggdmFsdWUgKSB7CgkJCXZhciBjbGFzc2VzLCBlbGVtLCBjdXIsIGN1clZhbHVlLCBjbGF6eiwgaiwgZmluYWxWYWx1ZSwKCQkJCWkgPSAwOwoKCQkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggdmFsdWUgKSApIHsKCQkJCXJldHVybiB0aGlzLmVhY2goIGZ1bmN0aW9uKCBqICkgewoJCQkJCWpRdWVyeSggdGhpcyApLnJlbW92ZUNsYXNzKCB2YWx1ZS5jYWxsKCB0aGlzLCBqLCBnZXRDbGFzcyggdGhpcyApICkgKTsKCQkJCX0gKTsKCQkJfQoKCQkJaWYgKCAhYXJndW1lbnRzLmxlbmd0aCApIHsKCQkJCXJldHVybiB0aGlzLmF0dHIoICJjbGFzcyIsICIiICk7CgkJCX0KCgkJCWlmICggdHlwZW9mIHZhbHVlID09PSAic3RyaW5nIiAmJiB2YWx1ZSApIHsKCQkJCWNsYXNzZXMgPSB2YWx1ZS5tYXRjaCggcm5vdHdoaXRlICkgfHwgW107CgoJCQkJd2hpbGUgKCAoIGVsZW0gPSB0aGlzWyBpKysgXSApICkgewoJCQkJCWN1clZhbHVlID0gZ2V0Q2xhc3MoIGVsZW0gKTsKCgkJCQkJLy8gVGhpcyBleHByZXNzaW9uIGlzIGhlcmUgZm9yIGJldHRlciBjb21wcmVzc2liaWxpdHkgKHNlZSBhZGRDbGFzcykKCQkJCQljdXIgPSBlbGVtLm5vZGVUeXBlID09PSAxICYmCgkJCQkJCSggIiAiICsgY3VyVmFsdWUgKyAiICIgKS5yZXBsYWNlKCByY2xhc3MsICIgIiApOwoKCQkJCQlpZiAoIGN1ciApIHsKCQkJCQkJaiA9IDA7CgkJCQkJCXdoaWxlICggKCBjbGF6eiA9IGNsYXNzZXNbIGorKyBdICkgKSB7CgoJCQkJCQkJLy8gUmVtb3ZlICphbGwqIGluc3RhbmNlcwoJCQkJCQkJd2hpbGUgKCBjdXIuaW5kZXhPZiggIiAiICsgY2xhenogKyAiICIgKSA+IC0xICkgewoJCQkJCQkJCWN1ciA9IGN1ci5yZXBsYWNlKCAiICIgKyBjbGF6eiArICIgIiwgIiAiICk7CgkJCQkJCQl9CgkJCQkJCX0KCgkJCQkJCS8vIE9ubHkgYXNzaWduIGlmIGRpZmZlcmVudCB0byBhdm9pZCB1bm5lZWRlZCByZW5kZXJpbmcuCgkJCQkJCWZpbmFsVmFsdWUgPSBqUXVlcnkudHJpbSggY3VyICk7CgkJCQkJCWlmICggY3VyVmFsdWUgIT09IGZpbmFsVmFsdWUgKSB7CgkJCQkJCQlqUXVlcnkuYXR0ciggZWxlbSwgImNsYXNzIiwgZmluYWxWYWx1ZSApOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCQl9LAoKCQl0b2dnbGVDbGFzczogZnVuY3Rpb24oIHZhbHVlLCBzdGF0ZVZhbCApIHsKCQkJdmFyIHR5cGUgPSB0eXBlb2YgdmFsdWU7CgoJCQlpZiAoIHR5cGVvZiBzdGF0ZVZhbCA9PT0gImJvb2xlYW4iICYmIHR5cGUgPT09ICJzdHJpbmciICkgewoJCQkJcmV0dXJuIHN0YXRlVmFsID8gdGhpcy5hZGRDbGFzcyggdmFsdWUgKSA6IHRoaXMucmVtb3ZlQ2xhc3MoIHZhbHVlICk7CgkJCX0KCgkJCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHZhbHVlICkgKSB7CgkJCQlyZXR1cm4gdGhpcy5lYWNoKCBmdW5jdGlvbiggaSApIHsKCQkJCQlqUXVlcnkoIHRoaXMgKS50b2dnbGVDbGFzcygKCQkJCQkJdmFsdWUuY2FsbCggdGhpcywgaSwgZ2V0Q2xhc3MoIHRoaXMgKSwgc3RhdGVWYWwgKSwKCQkJCQkJc3RhdGVWYWwKCQkJCQkpOwoJCQkJfSApOwoJCQl9CgoJCQlyZXR1cm4gdGhpcy5lYWNoKCBmdW5jdGlvbigpIHsKCQkJCXZhciBjbGFzc05hbWUsIGksIHNlbGYsIGNsYXNzTmFtZXM7CgoJCQkJaWYgKCB0eXBlID09PSAic3RyaW5nIiApIHsKCgkJCQkJLy8gVG9nZ2xlIGluZGl2aWR1YWwgY2xhc3MgbmFtZXMKCQkJCQlpID0gMDsKCQkJCQlzZWxmID0galF1ZXJ5KCB0aGlzICk7CgkJCQkJY2xhc3NOYW1lcyA9IHZhbHVlLm1hdGNoKCBybm90d2hpdGUgKSB8fCBbXTsKCgkJCQkJd2hpbGUgKCAoIGNsYXNzTmFtZSA9IGNsYXNzTmFtZXNbIGkrKyBdICkgKSB7CgoJCQkJCQkvLyBDaGVjayBlYWNoIGNsYXNzTmFtZSBnaXZlbiwgc3BhY2Ugc2VwYXJhdGVkIGxpc3QKCQkJCQkJaWYgKCBzZWxmLmhhc0NsYXNzKCBjbGFzc05hbWUgKSApIHsKCQkJCQkJCXNlbGYucmVtb3ZlQ2xhc3MoIGNsYXNzTmFtZSApOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJc2VsZi5hZGRDbGFzcyggY2xhc3NOYW1lICk7CgkJCQkJCX0KCQkJCQl9CgoJCQkJLy8gVG9nZ2xlIHdob2xlIGNsYXNzIG5hbWUKCQkJCX0gZWxzZSBpZiAoIHZhbHVlID09PSB1bmRlZmluZWQgfHwgdHlwZSA9PT0gImJvb2xlYW4iICkgewoJCQkJCWNsYXNzTmFtZSA9IGdldENsYXNzKCB0aGlzICk7CgkJCQkJaWYgKCBjbGFzc05hbWUgKSB7CgoJCQkJCQkvLyBzdG9yZSBjbGFzc05hbWUgaWYgc2V0CgkJCQkJCWpRdWVyeS5fZGF0YSggdGhpcywgIl9fY2xhc3NOYW1lX18iLCBjbGFzc05hbWUgKTsKCQkJCQl9CgoJCQkJCS8vIElmIHRoZSBlbGVtZW50IGhhcyBhIGNsYXNzIG5hbWUgb3IgaWYgd2UncmUgcGFzc2VkICJmYWxzZSIsCgkJCQkJLy8gdGhlbiByZW1vdmUgdGhlIHdob2xlIGNsYXNzbmFtZSAoaWYgdGhlcmUgd2FzIG9uZSwgdGhlIGFib3ZlIHNhdmVkIGl0KS4KCQkJCQkvLyBPdGhlcndpc2UgYnJpbmcgYmFjayB3aGF0ZXZlciB3YXMgcHJldmlvdXNseSBzYXZlZCAoaWYgYW55dGhpbmcpLAoJCQkJCS8vIGZhbGxpbmcgYmFjayB0byB0aGUgZW1wdHkgc3RyaW5nIGlmIG5vdGhpbmcgd2FzIHN0b3JlZC4KCQkJCQlqUXVlcnkuYXR0ciggdGhpcywgImNsYXNzIiwKCQkJCQkJY2xhc3NOYW1lIHx8IHZhbHVlID09PSBmYWxzZSA/CgkJCQkJCSIiIDoKCQkJCQkJalF1ZXJ5Ll9kYXRhKCB0aGlzLCAiX19jbGFzc05hbWVfXyIgKSB8fCAiIgoJCQkJCSk7CgkJCQl9CgkJCX0gKTsKCQl9LAoKCQloYXNDbGFzczogZnVuY3Rpb24oIHNlbGVjdG9yICkgewoJCQl2YXIgY2xhc3NOYW1lLCBlbGVtLAoJCQkJaSA9IDA7CgoJCQljbGFzc05hbWUgPSAiICIgKyBzZWxlY3RvciArICIgIjsKCQkJd2hpbGUgKCAoIGVsZW0gPSB0aGlzWyBpKysgXSApICkgewoJCQkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxICYmCgkJCQkJKCAiICIgKyBnZXRDbGFzcyggZWxlbSApICsgIiAiICkucmVwbGFjZSggcmNsYXNzLCAiICIgKQoJCQkJCQkuaW5kZXhPZiggY2xhc3NOYW1lICkgPiAtMQoJCQkJKSB7CgkJCQkJcmV0dXJuIHRydWU7CgkJCQl9CgkJCX0KCgkJCXJldHVybiBmYWxzZTsKCQl9Cgl9ICk7CgoKCgoJLy8gUmV0dXJuIGpRdWVyeSBmb3IgYXR0cmlidXRlcy1vbmx5IGluY2x1c2lvbgoKCglqUXVlcnkuZWFjaCggKCAiYmx1ciBmb2N1cyBmb2N1c2luIGZvY3Vzb3V0IGxvYWQgcmVzaXplIHNjcm9sbCB1bmxvYWQgY2xpY2sgZGJsY2xpY2sgIiArCgkJIm1vdXNlZG93biBtb3VzZXVwIG1vdXNlbW92ZSBtb3VzZW92ZXIgbW91c2VvdXQgbW91c2VlbnRlciBtb3VzZWxlYXZlICIgKwoJCSJjaGFuZ2Ugc2VsZWN0IHN1Ym1pdCBrZXlkb3duIGtleXByZXNzIGtleXVwIGVycm9yIGNvbnRleHRtZW51IiApLnNwbGl0KCAiICIgKSwKCQlmdW5jdGlvbiggaSwgbmFtZSApIHsKCgkJLy8gSGFuZGxlIGV2ZW50IGJpbmRpbmcKCQlqUXVlcnkuZm5bIG5hbWUgXSA9IGZ1bmN0aW9uKCBkYXRhLCBmbiApIHsKCQkJcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPiAwID8KCQkJCXRoaXMub24oIG5hbWUsIG51bGwsIGRhdGEsIGZuICkgOgoJCQkJdGhpcy50cmlnZ2VyKCBuYW1lICk7CgkJfTsKCX0gKTsKCglqUXVlcnkuZm4uZXh0ZW5kKCB7CgkJaG92ZXI6IGZ1bmN0aW9uKCBmbk92ZXIsIGZuT3V0ICkgewoJCQlyZXR1cm4gdGhpcy5tb3VzZWVudGVyKCBmbk92ZXIgKS5tb3VzZWxlYXZlKCBmbk91dCB8fCBmbk92ZXIgKTsKCQl9Cgl9ICk7CgoKCXZhciBsb2NhdGlvbiA9IHdpbmRvdy5sb2NhdGlvbjsKCgl2YXIgbm9uY2UgPSBqUXVlcnkubm93KCk7CgoJdmFyIHJxdWVyeSA9ICggL1w/LyApOwoKCgoJdmFyIHJ2YWxpZHRva2VucyA9IC8oLCl8KFxbfHspfCh9fF0pfCIoPzpbXiJcXFxyXG5dfFxcWyJcXFwvYmZucnRdfFxcdVtcZGEtZkEtRl17NH0pKiJccyo6P3x0cnVlfGZhbHNlfG51bGx8LT8oPyEwXGQpXGQrKD86XC5cZCt8KSg/OltlRV1bKy1dP1xkK3wpL2c7CgoJalF1ZXJ5LnBhcnNlSlNPTiA9IGZ1bmN0aW9uKCBkYXRhICkgewoKCQkvLyBBdHRlbXB0IHRvIHBhcnNlIHVzaW5nIHRoZSBuYXRpdmUgSlNPTiBwYXJzZXIgZmlyc3QKCQlpZiAoIHdpbmRvdy5KU09OICYmIHdpbmRvdy5KU09OLnBhcnNlICkgewoKCQkJLy8gU3VwcG9ydDogQW5kcm9pZCAyLjMKCQkJLy8gV29ya2Fyb3VuZCBmYWlsdXJlIHRvIHN0cmluZy1jYXN0IG51bGwgaW5wdXQKCQkJcmV0dXJuIHdpbmRvdy5KU09OLnBhcnNlKCBkYXRhICsgIiIgKTsKCQl9CgoJCXZhciByZXF1aXJlTm9uQ29tbWEsCgkJCWRlcHRoID0gbnVsbCwKCQkJc3RyID0galF1ZXJ5LnRyaW0oIGRhdGEgKyAiIiApOwoKCQkvLyBHdWFyZCBhZ2FpbnN0IGludmFsaWQgKGFuZCBwb3NzaWJseSBkYW5nZXJvdXMpIGlucHV0IGJ5IGVuc3VyaW5nIHRoYXQgbm90aGluZyByZW1haW5zCgkJLy8gYWZ0ZXIgcmVtb3ZpbmcgdmFsaWQgdG9rZW5zCgkJcmV0dXJuIHN0ciAmJiAhalF1ZXJ5LnRyaW0oIHN0ci5yZXBsYWNlKCBydmFsaWR0b2tlbnMsIGZ1bmN0aW9uKCB0b2tlbiwgY29tbWEsIG9wZW4sIGNsb3NlICkgewoKCQkJLy8gRm9yY2UgdGVybWluYXRpb24gaWYgd2Ugc2VlIGEgbWlzcGxhY2VkIGNvbW1hCgkJCWlmICggcmVxdWlyZU5vbkNvbW1hICYmIGNvbW1hICkgewoJCQkJZGVwdGggPSAwOwoJCQl9CgoJCQkvLyBQZXJmb3JtIG5vIG1vcmUgcmVwbGFjZW1lbnRzIGFmdGVyIHJldHVybmluZyB0byBvdXRlcm1vc3QgZGVwdGgKCQkJaWYgKCBkZXB0aCA9PT0gMCApIHsKCQkJCXJldHVybiB0b2tlbjsKCQkJfQoKCQkJLy8gQ29tbWFzIG11c3Qgbm90IGZvbGxvdyAiWyIsICJ7Iiwgb3IgIiwiCgkJCXJlcXVpcmVOb25Db21tYSA9IG9wZW4gfHwgY29tbWE7CgoJCQkvLyBEZXRlcm1pbmUgbmV3IGRlcHRoCgkJCS8vIGFycmF5L29iamVjdCBvcGVuICgiWyIgb3IgInsiKTogZGVwdGggKz0gdHJ1ZSAtIGZhbHNlIChpbmNyZW1lbnQpCgkJCS8vIGFycmF5L29iamVjdCBjbG9zZSAoIl0iIG9yICJ9Iik6IGRlcHRoICs9IGZhbHNlIC0gdHJ1ZSAoZGVjcmVtZW50KQoJCQkvLyBvdGhlciBjYXNlcyAoIiwiIG9yIHByaW1pdGl2ZSk6IGRlcHRoICs9IHRydWUgLSB0cnVlIChudW1lcmljIGNhc3QpCgkJCWRlcHRoICs9ICFjbG9zZSAtICFvcGVuOwoKCQkJLy8gUmVtb3ZlIHRoaXMgdG9rZW4KCQkJcmV0dXJuICIiOwoJCX0gKSApID8KCQkJKCBGdW5jdGlvbiggInJldHVybiAiICsgc3RyICkgKSgpIDoKCQkJalF1ZXJ5LmVycm9yKCAiSW52YWxpZCBKU09OOiAiICsgZGF0YSApOwoJfTsKCgoJLy8gQ3Jvc3MtYnJvd3NlciB4bWwgcGFyc2luZwoJalF1ZXJ5LnBhcnNlWE1MID0gZnVuY3Rpb24oIGRhdGEgKSB7CgkJdmFyIHhtbCwgdG1wOwoJCWlmICggIWRhdGEgfHwgdHlwZW9mIGRhdGEgIT09ICJzdHJpbmciICkgewoJCQlyZXR1cm4gbnVsbDsKCQl9CgkJdHJ5IHsKCQkJaWYgKCB3aW5kb3cuRE9NUGFyc2VyICkgeyAvLyBTdGFuZGFyZAoJCQkJdG1wID0gbmV3IHdpbmRvdy5ET01QYXJzZXIoKTsKCQkJCXhtbCA9IHRtcC5wYXJzZUZyb21TdHJpbmcoIGRhdGEsICJ0ZXh0L3htbCIgKTsKCQkJfSBlbHNlIHsgLy8gSUUKCQkJCXhtbCA9IG5ldyB3aW5kb3cuQWN0aXZlWE9iamVjdCggIk1pY3Jvc29mdC5YTUxET00iICk7CgkJCQl4bWwuYXN5bmMgPSAiZmFsc2UiOwoJCQkJeG1sLmxvYWRYTUwoIGRhdGEgKTsKCQkJfQoJCX0gY2F0Y2ggKCBlICkgewoJCQl4bWwgPSB1bmRlZmluZWQ7CgkJfQoJCWlmICggIXhtbCB8fCAheG1sLmRvY3VtZW50RWxlbWVudCB8fCB4bWwuZ2V0RWxlbWVudHNCeVRhZ05hbWUoICJwYXJzZXJlcnJvciIgKS5sZW5ndGggKSB7CgkJCWpRdWVyeS5lcnJvciggIkludmFsaWQgWE1MOiAiICsgZGF0YSApOwoJCX0KCQlyZXR1cm4geG1sOwoJfTsKCgoJdmFyCgkJcmhhc2ggPSAvIy4qJC8sCgkJcnRzID0gLyhbPyZdKV89W14mXSovLAoKCQkvLyBJRSBsZWF2ZXMgYW4gXHIgY2hhcmFjdGVyIGF0IEVPTAoJCXJoZWFkZXJzID0gL14oLio/KTpbIFx0XSooW15cclxuXSopXHI/JC9tZywKCgkJLy8gIzc2NTMsICM4MTI1LCAjODE1MjogbG9jYWwgcHJvdG9jb2wgZGV0ZWN0aW9uCgkJcmxvY2FsUHJvdG9jb2wgPSAvXig/OmFib3V0fGFwcHxhcHAtc3RvcmFnZXwuKy1leHRlbnNpb258ZmlsZXxyZXN8d2lkZ2V0KTokLywKCQlybm9Db250ZW50ID0gL14oPzpHRVR8SEVBRCkkLywKCQlycHJvdG9jb2wgPSAvXlwvXC8vLAoJCXJ1cmwgPSAvXihbXHcuKy1dKzopKD86XC9cLyg/OlteXC8/I10qQHwpKFteXC8/IzpdKikoPzo6KFxkKyl8KXwpLywKCgkJLyogUHJlZmlsdGVycwoJCSAqIDEpIFRoZXkgYXJlIHVzZWZ1bCB0byBpbnRyb2R1Y2UgY3VzdG9tIGRhdGFUeXBlcyAoc2VlIGFqYXgvanNvbnAuanMgZm9yIGFuIGV4YW1wbGUpCgkJICogMikgVGhlc2UgYXJlIGNhbGxlZDoKCQkgKiAgICAtIEJFRk9SRSBhc2tpbmcgZm9yIGEgdHJhbnNwb3J0CgkJICogICAgLSBBRlRFUiBwYXJhbSBzZXJpYWxpemF0aW9uIChzLmRhdGEgaXMgYSBzdHJpbmcgaWYgcy5wcm9jZXNzRGF0YSBpcyB0cnVlKQoJCSAqIDMpIGtleSBpcyB0aGUgZGF0YVR5cGUKCQkgKiA0KSB0aGUgY2F0Y2hhbGwgc3ltYm9sICIqIiBjYW4gYmUgdXNlZAoJCSAqIDUpIGV4ZWN1dGlvbiB3aWxsIHN0YXJ0IHdpdGggdHJhbnNwb3J0IGRhdGFUeXBlIGFuZCBUSEVOIGNvbnRpbnVlIGRvd24gdG8gIioiIGlmIG5lZWRlZAoJCSAqLwoJCXByZWZpbHRlcnMgPSB7fSwKCgkJLyogVHJhbnNwb3J0cyBiaW5kaW5ncwoJCSAqIDEpIGtleSBpcyB0aGUgZGF0YVR5cGUKCQkgKiAyKSB0aGUgY2F0Y2hhbGwgc3ltYm9sICIqIiBjYW4gYmUgdXNlZAoJCSAqIDMpIHNlbGVjdGlvbiB3aWxsIHN0YXJ0IHdpdGggdHJhbnNwb3J0IGRhdGFUeXBlIGFuZCBUSEVOIGdvIHRvICIqIiBpZiBuZWVkZWQKCQkgKi8KCQl0cmFuc3BvcnRzID0ge30sCgoJCS8vIEF2b2lkIGNvbW1lbnQtcHJvbG9nIGNoYXIgc2VxdWVuY2UgKCMxMDA5OCk7IG11c3QgYXBwZWFzZSBsaW50IGFuZCBldmFkZSBjb21wcmVzc2lvbgoJCWFsbFR5cGVzID0gIiovIi5jb25jYXQoICIqIiApLAoKCQkvLyBEb2N1bWVudCBsb2NhdGlvbgoJCWFqYXhMb2NhdGlvbiA9IGxvY2F0aW9uLmhyZWYsCgoJCS8vIFNlZ21lbnQgbG9jYXRpb24gaW50byBwYXJ0cwoJCWFqYXhMb2NQYXJ0cyA9IHJ1cmwuZXhlYyggYWpheExvY2F0aW9uLnRvTG93ZXJDYXNlKCkgKSB8fCBbXTsKCgkvLyBCYXNlICJjb25zdHJ1Y3RvciIgZm9yIGpRdWVyeS5hamF4UHJlZmlsdGVyIGFuZCBqUXVlcnkuYWpheFRyYW5zcG9ydAoJZnVuY3Rpb24gYWRkVG9QcmVmaWx0ZXJzT3JUcmFuc3BvcnRzKCBzdHJ1Y3R1cmUgKSB7CgoJCS8vIGRhdGFUeXBlRXhwcmVzc2lvbiBpcyBvcHRpb25hbCBhbmQgZGVmYXVsdHMgdG8gIioiCgkJcmV0dXJuIGZ1bmN0aW9uKCBkYXRhVHlwZUV4cHJlc3Npb24sIGZ1bmMgKSB7CgoJCQlpZiAoIHR5cGVvZiBkYXRhVHlwZUV4cHJlc3Npb24gIT09ICJzdHJpbmciICkgewoJCQkJZnVuYyA9IGRhdGFUeXBlRXhwcmVzc2lvbjsKCQkJCWRhdGFUeXBlRXhwcmVzc2lvbiA9ICIqIjsKCQkJfQoKCQkJdmFyIGRhdGFUeXBlLAoJCQkJaSA9IDAsCgkJCQlkYXRhVHlwZXMgPSBkYXRhVHlwZUV4cHJlc3Npb24udG9Mb3dlckNhc2UoKS5tYXRjaCggcm5vdHdoaXRlICkgfHwgW107CgoJCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBmdW5jICkgKSB7CgoJCQkJLy8gRm9yIGVhY2ggZGF0YVR5cGUgaW4gdGhlIGRhdGFUeXBlRXhwcmVzc2lvbgoJCQkJd2hpbGUgKCAoIGRhdGFUeXBlID0gZGF0YVR5cGVzWyBpKysgXSApICkgewoKCQkJCQkvLyBQcmVwZW5kIGlmIHJlcXVlc3RlZAoJCQkJCWlmICggZGF0YVR5cGUuY2hhckF0KCAwICkgPT09ICIrIiApIHsKCQkJCQkJZGF0YVR5cGUgPSBkYXRhVHlwZS5zbGljZSggMSApIHx8ICIqIjsKCQkJCQkJKCBzdHJ1Y3R1cmVbIGRhdGFUeXBlIF0gPSBzdHJ1Y3R1cmVbIGRhdGFUeXBlIF0gfHwgW10gKS51bnNoaWZ0KCBmdW5jICk7CgoJCQkJCS8vIE90aGVyd2lzZSBhcHBlbmQKCQkJCQl9IGVsc2UgewoJCQkJCQkoIHN0cnVjdHVyZVsgZGF0YVR5cGUgXSA9IHN0cnVjdHVyZVsgZGF0YVR5cGUgXSB8fCBbXSApLnB1c2goIGZ1bmMgKTsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9OwoJfQoKCS8vIEJhc2UgaW5zcGVjdGlvbiBmdW5jdGlvbiBmb3IgcHJlZmlsdGVycyBhbmQgdHJhbnNwb3J0cwoJZnVuY3Rpb24gaW5zcGVjdFByZWZpbHRlcnNPclRyYW5zcG9ydHMoIHN0cnVjdHVyZSwgb3B0aW9ucywgb3JpZ2luYWxPcHRpb25zLCBqcVhIUiApIHsKCgkJdmFyIGluc3BlY3RlZCA9IHt9LAoJCQlzZWVraW5nVHJhbnNwb3J0ID0gKCBzdHJ1Y3R1cmUgPT09IHRyYW5zcG9ydHMgKTsKCgkJZnVuY3Rpb24gaW5zcGVjdCggZGF0YVR5cGUgKSB7CgkJCXZhciBzZWxlY3RlZDsKCQkJaW5zcGVjdGVkWyBkYXRhVHlwZSBdID0gdHJ1ZTsKCQkJalF1ZXJ5LmVhY2goIHN0cnVjdHVyZVsgZGF0YVR5cGUgXSB8fCBbXSwgZnVuY3Rpb24oIF8sIHByZWZpbHRlck9yRmFjdG9yeSApIHsKCQkJCXZhciBkYXRhVHlwZU9yVHJhbnNwb3J0ID0gcHJlZmlsdGVyT3JGYWN0b3J5KCBvcHRpb25zLCBvcmlnaW5hbE9wdGlvbnMsIGpxWEhSICk7CgkJCQlpZiAoIHR5cGVvZiBkYXRhVHlwZU9yVHJhbnNwb3J0ID09PSAic3RyaW5nIiAmJgoJCQkJCSFzZWVraW5nVHJhbnNwb3J0ICYmICFpbnNwZWN0ZWRbIGRhdGFUeXBlT3JUcmFuc3BvcnQgXSApIHsKCgkJCQkJb3B0aW9ucy5kYXRhVHlwZXMudW5zaGlmdCggZGF0YVR5cGVPclRyYW5zcG9ydCApOwoJCQkJCWluc3BlY3QoIGRhdGFUeXBlT3JUcmFuc3BvcnQgKTsKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQl9IGVsc2UgaWYgKCBzZWVraW5nVHJhbnNwb3J0ICkgewoJCQkJCXJldHVybiAhKCBzZWxlY3RlZCA9IGRhdGFUeXBlT3JUcmFuc3BvcnQgKTsKCQkJCX0KCQkJfSApOwoJCQlyZXR1cm4gc2VsZWN0ZWQ7CgkJfQoKCQlyZXR1cm4gaW5zcGVjdCggb3B0aW9ucy5kYXRhVHlwZXNbIDAgXSApIHx8ICFpbnNwZWN0ZWRbICIqIiBdICYmIGluc3BlY3QoICIqIiApOwoJfQoKCS8vIEEgc3BlY2lhbCBleHRlbmQgZm9yIGFqYXggb3B0aW9ucwoJLy8gdGhhdCB0YWtlcyAiZmxhdCIgb3B0aW9ucyAobm90IHRvIGJlIGRlZXAgZXh0ZW5kZWQpCgkvLyBGaXhlcyAjOTg4NwoJZnVuY3Rpb24gYWpheEV4dGVuZCggdGFyZ2V0LCBzcmMgKSB7CgkJdmFyIGRlZXAsIGtleSwKCQkJZmxhdE9wdGlvbnMgPSBqUXVlcnkuYWpheFNldHRpbmdzLmZsYXRPcHRpb25zIHx8IHt9OwoKCQlmb3IgKCBrZXkgaW4gc3JjICkgewoJCQlpZiAoIHNyY1sga2V5IF0gIT09IHVuZGVmaW5lZCApIHsKCQkJCSggZmxhdE9wdGlvbnNbIGtleSBdID8gdGFyZ2V0IDogKCBkZWVwIHx8ICggZGVlcCA9IHt9ICkgKSApWyBrZXkgXSA9IHNyY1sga2V5IF07CgkJCX0KCQl9CgkJaWYgKCBkZWVwICkgewoJCQlqUXVlcnkuZXh0ZW5kKCB0cnVlLCB0YXJnZXQsIGRlZXAgKTsKCQl9CgoJCXJldHVybiB0YXJnZXQ7Cgl9CgoJLyogSGFuZGxlcyByZXNwb25zZXMgdG8gYW4gYWpheCByZXF1ZXN0OgoJICogLSBmaW5kcyB0aGUgcmlnaHQgZGF0YVR5cGUgKG1lZGlhdGVzIGJldHdlZW4gY29udGVudC10eXBlIGFuZCBleHBlY3RlZCBkYXRhVHlwZSkKCSAqIC0gcmV0dXJucyB0aGUgY29ycmVzcG9uZGluZyByZXNwb25zZQoJICovCglmdW5jdGlvbiBhamF4SGFuZGxlUmVzcG9uc2VzKCBzLCBqcVhIUiwgcmVzcG9uc2VzICkgewoJCXZhciBmaXJzdERhdGFUeXBlLCBjdCwgZmluYWxEYXRhVHlwZSwgdHlwZSwKCQkJY29udGVudHMgPSBzLmNvbnRlbnRzLAoJCQlkYXRhVHlwZXMgPSBzLmRhdGFUeXBlczsKCgkJLy8gUmVtb3ZlIGF1dG8gZGF0YVR5cGUgYW5kIGdldCBjb250ZW50LXR5cGUgaW4gdGhlIHByb2Nlc3MKCQl3aGlsZSAoIGRhdGFUeXBlc1sgMCBdID09PSAiKiIgKSB7CgkJCWRhdGFUeXBlcy5zaGlmdCgpOwoJCQlpZiAoIGN0ID09PSB1bmRlZmluZWQgKSB7CgkJCQljdCA9IHMubWltZVR5cGUgfHwganFYSFIuZ2V0UmVzcG9uc2VIZWFkZXIoICJDb250ZW50LVR5cGUiICk7CgkJCX0KCQl9CgoJCS8vIENoZWNrIGlmIHdlJ3JlIGRlYWxpbmcgd2l0aCBhIGtub3duIGNvbnRlbnQtdHlwZQoJCWlmICggY3QgKSB7CgkJCWZvciAoIHR5cGUgaW4gY29udGVudHMgKSB7CgkJCQlpZiAoIGNvbnRlbnRzWyB0eXBlIF0gJiYgY29udGVudHNbIHR5cGUgXS50ZXN0KCBjdCApICkgewoJCQkJCWRhdGFUeXBlcy51bnNoaWZ0KCB0eXBlICk7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCX0KCQl9CgoJCS8vIENoZWNrIHRvIHNlZSBpZiB3ZSBoYXZlIGEgcmVzcG9uc2UgZm9yIHRoZSBleHBlY3RlZCBkYXRhVHlwZQoJCWlmICggZGF0YVR5cGVzWyAwIF0gaW4gcmVzcG9uc2VzICkgewoJCQlmaW5hbERhdGFUeXBlID0gZGF0YVR5cGVzWyAwIF07CgkJfSBlbHNlIHsKCgkJCS8vIFRyeSBjb252ZXJ0aWJsZSBkYXRhVHlwZXMKCQkJZm9yICggdHlwZSBpbiByZXNwb25zZXMgKSB7CgkJCQlpZiAoICFkYXRhVHlwZXNbIDAgXSB8fCBzLmNvbnZlcnRlcnNbIHR5cGUgKyAiICIgKyBkYXRhVHlwZXNbIDAgXSBdICkgewoJCQkJCWZpbmFsRGF0YVR5cGUgPSB0eXBlOwoJCQkJCWJyZWFrOwoJCQkJfQoJCQkJaWYgKCAhZmlyc3REYXRhVHlwZSApIHsKCQkJCQlmaXJzdERhdGFUeXBlID0gdHlwZTsKCQkJCX0KCQkJfQoKCQkJLy8gT3IganVzdCB1c2UgZmlyc3Qgb25lCgkJCWZpbmFsRGF0YVR5cGUgPSBmaW5hbERhdGFUeXBlIHx8IGZpcnN0RGF0YVR5cGU7CgkJfQoKCQkvLyBJZiB3ZSBmb3VuZCBhIGRhdGFUeXBlCgkJLy8gV2UgYWRkIHRoZSBkYXRhVHlwZSB0byB0aGUgbGlzdCBpZiBuZWVkZWQKCQkvLyBhbmQgcmV0dXJuIHRoZSBjb3JyZXNwb25kaW5nIHJlc3BvbnNlCgkJaWYgKCBmaW5hbERhdGFUeXBlICkgewoJCQlpZiAoIGZpbmFsRGF0YVR5cGUgIT09IGRhdGFUeXBlc1sgMCBdICkgewoJCQkJZGF0YVR5cGVzLnVuc2hpZnQoIGZpbmFsRGF0YVR5cGUgKTsKCQkJfQoJCQlyZXR1cm4gcmVzcG9uc2VzWyBmaW5hbERhdGFUeXBlIF07CgkJfQoJfQoKCS8qIENoYWluIGNvbnZlcnNpb25zIGdpdmVuIHRoZSByZXF1ZXN0IGFuZCB0aGUgb3JpZ2luYWwgcmVzcG9uc2UKCSAqIEFsc28gc2V0cyB0aGUgcmVzcG9uc2VYWFggZmllbGRzIG9uIHRoZSBqcVhIUiBpbnN0YW5jZQoJICovCglmdW5jdGlvbiBhamF4Q29udmVydCggcywgcmVzcG9uc2UsIGpxWEhSLCBpc1N1Y2Nlc3MgKSB7CgkJdmFyIGNvbnYyLCBjdXJyZW50LCBjb252LCB0bXAsIHByZXYsCgkJCWNvbnZlcnRlcnMgPSB7fSwKCgkJCS8vIFdvcmsgd2l0aCBhIGNvcHkgb2YgZGF0YVR5cGVzIGluIGNhc2Ugd2UgbmVlZCB0byBtb2RpZnkgaXQgZm9yIGNvbnZlcnNpb24KCQkJZGF0YVR5cGVzID0gcy5kYXRhVHlwZXMuc2xpY2UoKTsKCgkJLy8gQ3JlYXRlIGNvbnZlcnRlcnMgbWFwIHdpdGggbG93ZXJjYXNlZCBrZXlzCgkJaWYgKCBkYXRhVHlwZXNbIDEgXSApIHsKCQkJZm9yICggY29udiBpbiBzLmNvbnZlcnRlcnMgKSB7CgkJCQljb252ZXJ0ZXJzWyBjb252LnRvTG93ZXJDYXNlKCkgXSA9IHMuY29udmVydGVyc1sgY29udiBdOwoJCQl9CgkJfQoKCQljdXJyZW50ID0gZGF0YVR5cGVzLnNoaWZ0KCk7CgoJCS8vIENvbnZlcnQgdG8gZWFjaCBzZXF1ZW50aWFsIGRhdGFUeXBlCgkJd2hpbGUgKCBjdXJyZW50ICkgewoKCQkJaWYgKCBzLnJlc3BvbnNlRmllbGRzWyBjdXJyZW50IF0gKSB7CgkJCQlqcVhIUlsgcy5yZXNwb25zZUZpZWxkc1sgY3VycmVudCBdIF0gPSByZXNwb25zZTsKCQkJfQoKCQkJLy8gQXBwbHkgdGhlIGRhdGFGaWx0ZXIgaWYgcHJvdmlkZWQKCQkJaWYgKCAhcHJldiAmJiBpc1N1Y2Nlc3MgJiYgcy5kYXRhRmlsdGVyICkgewoJCQkJcmVzcG9uc2UgPSBzLmRhdGFGaWx0ZXIoIHJlc3BvbnNlLCBzLmRhdGFUeXBlICk7CgkJCX0KCgkJCXByZXYgPSBjdXJyZW50OwoJCQljdXJyZW50ID0gZGF0YVR5cGVzLnNoaWZ0KCk7CgoJCQlpZiAoIGN1cnJlbnQgKSB7CgoJCQkJLy8gVGhlcmUncyBvbmx5IHdvcmsgdG8gZG8gaWYgY3VycmVudCBkYXRhVHlwZSBpcyBub24tYXV0bwoJCQkJaWYgKCBjdXJyZW50ID09PSAiKiIgKSB7CgoJCQkJCWN1cnJlbnQgPSBwcmV2OwoKCQkJCS8vIENvbnZlcnQgcmVzcG9uc2UgaWYgcHJldiBkYXRhVHlwZSBpcyBub24tYXV0byBhbmQgZGlmZmVycyBmcm9tIGN1cnJlbnQKCQkJCX0gZWxzZSBpZiAoIHByZXYgIT09ICIqIiAmJiBwcmV2ICE9PSBjdXJyZW50ICkgewoKCQkJCQkvLyBTZWVrIGEgZGlyZWN0IGNvbnZlcnRlcgoJCQkJCWNvbnYgPSBjb252ZXJ0ZXJzWyBwcmV2ICsgIiAiICsgY3VycmVudCBdIHx8IGNvbnZlcnRlcnNbICIqICIgKyBjdXJyZW50IF07CgoJCQkJCS8vIElmIG5vbmUgZm91bmQsIHNlZWsgYSBwYWlyCgkJCQkJaWYgKCAhY29udiApIHsKCQkJCQkJZm9yICggY29udjIgaW4gY29udmVydGVycyApIHsKCgkJCQkJCQkvLyBJZiBjb252MiBvdXRwdXRzIGN1cnJlbnQKCQkJCQkJCXRtcCA9IGNvbnYyLnNwbGl0KCAiICIgKTsKCQkJCQkJCWlmICggdG1wWyAxIF0gPT09IGN1cnJlbnQgKSB7CgoJCQkJCQkJCS8vIElmIHByZXYgY2FuIGJlIGNvbnZlcnRlZCB0byBhY2NlcHRlZCBpbnB1dAoJCQkJCQkJCWNvbnYgPSBjb252ZXJ0ZXJzWyBwcmV2ICsgIiAiICsgdG1wWyAwIF0gXSB8fAoJCQkJCQkJCQljb252ZXJ0ZXJzWyAiKiAiICsgdG1wWyAwIF0gXTsKCQkJCQkJCQlpZiAoIGNvbnYgKSB7CgoJCQkJCQkJCQkvLyBDb25kZW5zZSBlcXVpdmFsZW5jZSBjb252ZXJ0ZXJzCgkJCQkJCQkJCWlmICggY29udiA9PT0gdHJ1ZSApIHsKCQkJCQkJCQkJCWNvbnYgPSBjb252ZXJ0ZXJzWyBjb252MiBdOwoKCQkJCQkJCQkJLy8gT3RoZXJ3aXNlLCBpbnNlcnQgdGhlIGludGVybWVkaWF0ZSBkYXRhVHlwZQoJCQkJCQkJCQl9IGVsc2UgaWYgKCBjb252ZXJ0ZXJzWyBjb252MiBdICE9PSB0cnVlICkgewoJCQkJCQkJCQkJY3VycmVudCA9IHRtcFsgMCBdOwoJCQkJCQkJCQkJZGF0YVR5cGVzLnVuc2hpZnQoIHRtcFsgMSBdICk7CgkJCQkJCQkJCX0KCQkJCQkJCQkJYnJlYWs7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoKCQkJCQkvLyBBcHBseSBjb252ZXJ0ZXIgKGlmIG5vdCBhbiBlcXVpdmFsZW5jZSkKCQkJCQlpZiAoIGNvbnYgIT09IHRydWUgKSB7CgoJCQkJCQkvLyBVbmxlc3MgZXJyb3JzIGFyZSBhbGxvd2VkIHRvIGJ1YmJsZSwgY2F0Y2ggYW5kIHJldHVybiB0aGVtCgkJCQkJCWlmICggY29udiAmJiBzWyAidGhyb3dzIiBdICkgeyAvLyBqc2NzOmlnbm9yZSByZXF1aXJlRG90Tm90YXRpb24KCQkJCQkJCXJlc3BvbnNlID0gY29udiggcmVzcG9uc2UgKTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXRyeSB7CgkJCQkJCQkJcmVzcG9uc2UgPSBjb252KCByZXNwb25zZSApOwoJCQkJCQkJfSBjYXRjaCAoIGUgKSB7CgkJCQkJCQkJcmV0dXJuIHsKCQkJCQkJCQkJc3RhdGU6ICJwYXJzZXJlcnJvciIsCgkJCQkJCQkJCWVycm9yOiBjb252ID8gZSA6ICJObyBjb252ZXJzaW9uIGZyb20gIiArIHByZXYgKyAiIHRvICIgKyBjdXJyZW50CgkJCQkJCQkJfTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCgkJcmV0dXJuIHsgc3RhdGU6ICJzdWNjZXNzIiwgZGF0YTogcmVzcG9uc2UgfTsKCX0KCglqUXVlcnkuZXh0ZW5kKCB7CgoJCS8vIENvdW50ZXIgZm9yIGhvbGRpbmcgdGhlIG51bWJlciBvZiBhY3RpdmUgcXVlcmllcwoJCWFjdGl2ZTogMCwKCgkJLy8gTGFzdC1Nb2RpZmllZCBoZWFkZXIgY2FjaGUgZm9yIG5leHQgcmVxdWVzdAoJCWxhc3RNb2RpZmllZDoge30sCgkJZXRhZzoge30sCgoJCWFqYXhTZXR0aW5nczogewoJCQl1cmw6IGFqYXhMb2NhdGlvbiwKCQkJdHlwZTogIkdFVCIsCgkJCWlzTG9jYWw6IHJsb2NhbFByb3RvY29sLnRlc3QoIGFqYXhMb2NQYXJ0c1sgMSBdICksCgkJCWdsb2JhbDogdHJ1ZSwKCQkJcHJvY2Vzc0RhdGE6IHRydWUsCgkJCWFzeW5jOiB0cnVlLAoJCQljb250ZW50VHlwZTogImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZDsgY2hhcnNldD1VVEYtOCIsCgkJCS8qCgkJCXRpbWVvdXQ6IDAsCgkJCWRhdGE6IG51bGwsCgkJCWRhdGFUeXBlOiBudWxsLAoJCQl1c2VybmFtZTogbnVsbCwKCQkJcGFzc3dvcmQ6IG51bGwsCgkJCWNhY2hlOiBudWxsLAoJCQl0aHJvd3M6IGZhbHNlLAoJCQl0cmFkaXRpb25hbDogZmFsc2UsCgkJCWhlYWRlcnM6IHt9LAoJCQkqLwoKCQkJYWNjZXB0czogewoJCQkJIioiOiBhbGxUeXBlcywKCQkJCXRleHQ6ICJ0ZXh0L3BsYWluIiwKCQkJCWh0bWw6ICJ0ZXh0L2h0bWwiLAoJCQkJeG1sOiAiYXBwbGljYXRpb24veG1sLCB0ZXh0L3htbCIsCgkJCQlqc29uOiAiYXBwbGljYXRpb24vanNvbiwgdGV4dC9qYXZhc2NyaXB0IgoJCQl9LAoKCQkJY29udGVudHM6IHsKCQkJCXhtbDogL1xieG1sXGIvLAoJCQkJaHRtbDogL1xiaHRtbC8sCgkJCQlqc29uOiAvXGJqc29uXGIvCgkJCX0sCgoJCQlyZXNwb25zZUZpZWxkczogewoJCQkJeG1sOiAicmVzcG9uc2VYTUwiLAoJCQkJdGV4dDogInJlc3BvbnNlVGV4dCIsCgkJCQlqc29uOiAicmVzcG9uc2VKU09OIgoJCQl9LAoKCQkJLy8gRGF0YSBjb252ZXJ0ZXJzCgkJCS8vIEtleXMgc2VwYXJhdGUgc291cmNlIChvciBjYXRjaGFsbCAiKiIpIGFuZCBkZXN0aW5hdGlvbiB0eXBlcyB3aXRoIGEgc2luZ2xlIHNwYWNlCgkJCWNvbnZlcnRlcnM6IHsKCgkJCQkvLyBDb252ZXJ0IGFueXRoaW5nIHRvIHRleHQKCQkJCSIqIHRleHQiOiBTdHJpbmcsCgoJCQkJLy8gVGV4dCB0byBodG1sICh0cnVlID0gbm8gdHJhbnNmb3JtYXRpb24pCgkJCQkidGV4dCBodG1sIjogdHJ1ZSwKCgkJCQkvLyBFdmFsdWF0ZSB0ZXh0IGFzIGEganNvbiBleHByZXNzaW9uCgkJCQkidGV4dCBqc29uIjogalF1ZXJ5LnBhcnNlSlNPTiwKCgkJCQkvLyBQYXJzZSB0ZXh0IGFzIHhtbAoJCQkJInRleHQgeG1sIjogalF1ZXJ5LnBhcnNlWE1MCgkJCX0sCgoJCQkvLyBGb3Igb3B0aW9ucyB0aGF0IHNob3VsZG4ndCBiZSBkZWVwIGV4dGVuZGVkOgoJCQkvLyB5b3UgY2FuIGFkZCB5b3VyIG93biBjdXN0b20gb3B0aW9ucyBoZXJlIGlmCgkJCS8vIGFuZCB3aGVuIHlvdSBjcmVhdGUgb25lIHRoYXQgc2hvdWxkbid0IGJlCgkJCS8vIGRlZXAgZXh0ZW5kZWQgKHNlZSBhamF4RXh0ZW5kKQoJCQlmbGF0T3B0aW9uczogewoJCQkJdXJsOiB0cnVlLAoJCQkJY29udGV4dDogdHJ1ZQoJCQl9CgkJfSwKCgkJLy8gQ3JlYXRlcyBhIGZ1bGwgZmxlZGdlZCBzZXR0aW5ncyBvYmplY3QgaW50byB0YXJnZXQKCQkvLyB3aXRoIGJvdGggYWpheFNldHRpbmdzIGFuZCBzZXR0aW5ncyBmaWVsZHMuCgkJLy8gSWYgdGFyZ2V0IGlzIG9taXR0ZWQsIHdyaXRlcyBpbnRvIGFqYXhTZXR0aW5ncy4KCQlhamF4U2V0dXA6IGZ1bmN0aW9uKCB0YXJnZXQsIHNldHRpbmdzICkgewoJCQlyZXR1cm4gc2V0dGluZ3MgPwoKCQkJCS8vIEJ1aWxkaW5nIGEgc2V0dGluZ3Mgb2JqZWN0CgkJCQlhamF4RXh0ZW5kKCBhamF4RXh0ZW5kKCB0YXJnZXQsIGpRdWVyeS5hamF4U2V0dGluZ3MgKSwgc2V0dGluZ3MgKSA6CgoJCQkJLy8gRXh0ZW5kaW5nIGFqYXhTZXR0aW5ncwoJCQkJYWpheEV4dGVuZCggalF1ZXJ5LmFqYXhTZXR0aW5ncywgdGFyZ2V0ICk7CgkJfSwKCgkJYWpheFByZWZpbHRlcjogYWRkVG9QcmVmaWx0ZXJzT3JUcmFuc3BvcnRzKCBwcmVmaWx0ZXJzICksCgkJYWpheFRyYW5zcG9ydDogYWRkVG9QcmVmaWx0ZXJzT3JUcmFuc3BvcnRzKCB0cmFuc3BvcnRzICksCgoJCS8vIE1haW4gbWV0aG9kCgkJYWpheDogZnVuY3Rpb24oIHVybCwgb3B0aW9ucyApIHsKCgkJCS8vIElmIHVybCBpcyBhbiBvYmplY3QsIHNpbXVsYXRlIHByZS0xLjUgc2lnbmF0dXJlCgkJCWlmICggdHlwZW9mIHVybCA9PT0gIm9iamVjdCIgKSB7CgkJCQlvcHRpb25zID0gdXJsOwoJCQkJdXJsID0gdW5kZWZpbmVkOwoJCQl9CgoJCQkvLyBGb3JjZSBvcHRpb25zIHRvIGJlIGFuIG9iamVjdAoJCQlvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKCgkJCXZhcgoKCQkJCS8vIENyb3NzLWRvbWFpbiBkZXRlY3Rpb24gdmFycwoJCQkJcGFydHMsCgoJCQkJLy8gTG9vcCB2YXJpYWJsZQoJCQkJaSwKCgkJCQkvLyBVUkwgd2l0aG91dCBhbnRpLWNhY2hlIHBhcmFtCgkJCQljYWNoZVVSTCwKCgkJCQkvLyBSZXNwb25zZSBoZWFkZXJzIGFzIHN0cmluZwoJCQkJcmVzcG9uc2VIZWFkZXJzU3RyaW5nLAoKCQkJCS8vIHRpbWVvdXQgaGFuZGxlCgkJCQl0aW1lb3V0VGltZXIsCgoJCQkJLy8gVG8ga25vdyBpZiBnbG9iYWwgZXZlbnRzIGFyZSB0byBiZSBkaXNwYXRjaGVkCgkJCQlmaXJlR2xvYmFscywKCgkJCQl0cmFuc3BvcnQsCgoJCQkJLy8gUmVzcG9uc2UgaGVhZGVycwoJCQkJcmVzcG9uc2VIZWFkZXJzLAoKCQkJCS8vIENyZWF0ZSB0aGUgZmluYWwgb3B0aW9ucyBvYmplY3QKCQkJCXMgPSBqUXVlcnkuYWpheFNldHVwKCB7fSwgb3B0aW9ucyApLAoKCQkJCS8vIENhbGxiYWNrcyBjb250ZXh0CgkJCQljYWxsYmFja0NvbnRleHQgPSBzLmNvbnRleHQgfHwgcywKCgkJCQkvLyBDb250ZXh0IGZvciBnbG9iYWwgZXZlbnRzIGlzIGNhbGxiYWNrQ29udGV4dCBpZiBpdCBpcyBhIERPTSBub2RlIG9yIGpRdWVyeSBjb2xsZWN0aW9uCgkJCQlnbG9iYWxFdmVudENvbnRleHQgPSBzLmNvbnRleHQgJiYKCQkJCQkoIGNhbGxiYWNrQ29udGV4dC5ub2RlVHlwZSB8fCBjYWxsYmFja0NvbnRleHQuanF1ZXJ5ICkgPwoJCQkJCQlqUXVlcnkoIGNhbGxiYWNrQ29udGV4dCApIDoKCQkJCQkJalF1ZXJ5LmV2ZW50LAoKCQkJCS8vIERlZmVycmVkcwoJCQkJZGVmZXJyZWQgPSBqUXVlcnkuRGVmZXJyZWQoKSwKCQkJCWNvbXBsZXRlRGVmZXJyZWQgPSBqUXVlcnkuQ2FsbGJhY2tzKCAib25jZSBtZW1vcnkiICksCgoJCQkJLy8gU3RhdHVzLWRlcGVuZGVudCBjYWxsYmFja3MKCQkJCXN0YXR1c0NvZGUgPSBzLnN0YXR1c0NvZGUgfHwge30sCgoJCQkJLy8gSGVhZGVycyAodGhleSBhcmUgc2VudCBhbGwgYXQgb25jZSkKCQkJCXJlcXVlc3RIZWFkZXJzID0ge30sCgkJCQlyZXF1ZXN0SGVhZGVyc05hbWVzID0ge30sCgoJCQkJLy8gVGhlIGpxWEhSIHN0YXRlCgkJCQlzdGF0ZSA9IDAsCgoJCQkJLy8gRGVmYXVsdCBhYm9ydCBtZXNzYWdlCgkJCQlzdHJBYm9ydCA9ICJjYW5jZWxlZCIsCgoJCQkJLy8gRmFrZSB4aHIKCQkJCWpxWEhSID0gewoJCQkJCXJlYWR5U3RhdGU6IDAsCgoJCQkJCS8vIEJ1aWxkcyBoZWFkZXJzIGhhc2h0YWJsZSBpZiBuZWVkZWQKCQkJCQlnZXRSZXNwb25zZUhlYWRlcjogZnVuY3Rpb24oIGtleSApIHsKCQkJCQkJdmFyIG1hdGNoOwoJCQkJCQlpZiAoIHN0YXRlID09PSAyICkgewoJCQkJCQkJaWYgKCAhcmVzcG9uc2VIZWFkZXJzICkgewoJCQkJCQkJCXJlc3BvbnNlSGVhZGVycyA9IHt9OwoJCQkJCQkJCXdoaWxlICggKCBtYXRjaCA9IHJoZWFkZXJzLmV4ZWMoIHJlc3BvbnNlSGVhZGVyc1N0cmluZyApICkgKSB7CgkJCQkJCQkJCXJlc3BvbnNlSGVhZGVyc1sgbWF0Y2hbIDEgXS50b0xvd2VyQ2FzZSgpIF0gPSBtYXRjaFsgMiBdOwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJCW1hdGNoID0gcmVzcG9uc2VIZWFkZXJzWyBrZXkudG9Mb3dlckNhc2UoKSBdOwoJCQkJCQl9CgkJCQkJCXJldHVybiBtYXRjaCA9PSBudWxsID8gbnVsbCA6IG1hdGNoOwoJCQkJCX0sCgoJCQkJCS8vIFJhdyBzdHJpbmcKCQkJCQlnZXRBbGxSZXNwb25zZUhlYWRlcnM6IGZ1bmN0aW9uKCkgewoJCQkJCQlyZXR1cm4gc3RhdGUgPT09IDIgPyByZXNwb25zZUhlYWRlcnNTdHJpbmcgOiBudWxsOwoJCQkJCX0sCgoJCQkJCS8vIENhY2hlcyB0aGUgaGVhZGVyCgkJCQkJc2V0UmVxdWVzdEhlYWRlcjogZnVuY3Rpb24oIG5hbWUsIHZhbHVlICkgewoJCQkJCQl2YXIgbG5hbWUgPSBuYW1lLnRvTG93ZXJDYXNlKCk7CgkJCQkJCWlmICggIXN0YXRlICkgewoJCQkJCQkJbmFtZSA9IHJlcXVlc3RIZWFkZXJzTmFtZXNbIGxuYW1lIF0gPSByZXF1ZXN0SGVhZGVyc05hbWVzWyBsbmFtZSBdIHx8IG5hbWU7CgkJCQkJCQlyZXF1ZXN0SGVhZGVyc1sgbmFtZSBdID0gdmFsdWU7CgkJCQkJCX0KCQkJCQkJcmV0dXJuIHRoaXM7CgkJCQkJfSwKCgkJCQkJLy8gT3ZlcnJpZGVzIHJlc3BvbnNlIGNvbnRlbnQtdHlwZSBoZWFkZXIKCQkJCQlvdmVycmlkZU1pbWVUeXBlOiBmdW5jdGlvbiggdHlwZSApIHsKCQkJCQkJaWYgKCAhc3RhdGUgKSB7CgkJCQkJCQlzLm1pbWVUeXBlID0gdHlwZTsKCQkJCQkJfQoJCQkJCQlyZXR1cm4gdGhpczsKCQkJCQl9LAoKCQkJCQkvLyBTdGF0dXMtZGVwZW5kZW50IGNhbGxiYWNrcwoJCQkJCXN0YXR1c0NvZGU6IGZ1bmN0aW9uKCBtYXAgKSB7CgkJCQkJCXZhciBjb2RlOwoJCQkJCQlpZiAoIG1hcCApIHsKCQkJCQkJCWlmICggc3RhdGUgPCAyICkgewoJCQkJCQkJCWZvciAoIGNvZGUgaW4gbWFwICkgewoKCQkJCQkJCQkJLy8gTGF6eS1hZGQgdGhlIG5ldyBjYWxsYmFjayBpbiBhIHdheSB0aGF0IHByZXNlcnZlcyBvbGQgb25lcwoJCQkJCQkJCQlzdGF0dXNDb2RlWyBjb2RlIF0gPSBbIHN0YXR1c0NvZGVbIGNvZGUgXSwgbWFwWyBjb2RlIF0gXTsKCQkJCQkJCQl9CgkJCQkJCQl9IGVsc2UgewoKCQkJCQkJCQkvLyBFeGVjdXRlIHRoZSBhcHByb3ByaWF0ZSBjYWxsYmFja3MKCQkJCQkJCQlqcVhIUi5hbHdheXMoIG1hcFsganFYSFIuc3RhdHVzIF0gKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQlyZXR1cm4gdGhpczsKCQkJCQl9LAoKCQkJCQkvLyBDYW5jZWwgdGhlIHJlcXVlc3QKCQkJCQlhYm9ydDogZnVuY3Rpb24oIHN0YXR1c1RleHQgKSB7CgkJCQkJCXZhciBmaW5hbFRleHQgPSBzdGF0dXNUZXh0IHx8IHN0ckFib3J0OwoJCQkJCQlpZiAoIHRyYW5zcG9ydCApIHsKCQkJCQkJCXRyYW5zcG9ydC5hYm9ydCggZmluYWxUZXh0ICk7CgkJCQkJCX0KCQkJCQkJZG9uZSggMCwgZmluYWxUZXh0ICk7CgkJCQkJCXJldHVybiB0aGlzOwoJCQkJCX0KCQkJCX07CgoJCQkvLyBBdHRhY2ggZGVmZXJyZWRzCgkJCWRlZmVycmVkLnByb21pc2UoIGpxWEhSICkuY29tcGxldGUgPSBjb21wbGV0ZURlZmVycmVkLmFkZDsKCQkJanFYSFIuc3VjY2VzcyA9IGpxWEhSLmRvbmU7CgkJCWpxWEhSLmVycm9yID0ganFYSFIuZmFpbDsKCgkJCS8vIFJlbW92ZSBoYXNoIGNoYXJhY3RlciAoIzc1MzE6IGFuZCBzdHJpbmcgcHJvbW90aW9uKQoJCQkvLyBBZGQgcHJvdG9jb2wgaWYgbm90IHByb3ZpZGVkICgjNTg2NjogSUU3IGlzc3VlIHdpdGggcHJvdG9jb2wtbGVzcyB1cmxzKQoJCQkvLyBIYW5kbGUgZmFsc3kgdXJsIGluIHRoZSBzZXR0aW5ncyBvYmplY3QgKCMxMDA5MzogY29uc2lzdGVuY3kgd2l0aCBvbGQgc2lnbmF0dXJlKQoJCQkvLyBXZSBhbHNvIHVzZSB0aGUgdXJsIHBhcmFtZXRlciBpZiBhdmFpbGFibGUKCQkJcy51cmwgPSAoICggdXJsIHx8IHMudXJsIHx8IGFqYXhMb2NhdGlvbiApICsgIiIgKQoJCQkJLnJlcGxhY2UoIHJoYXNoLCAiIiApCgkJCQkucmVwbGFjZSggcnByb3RvY29sLCBhamF4TG9jUGFydHNbIDEgXSArICIvLyIgKTsKCgkJCS8vIEFsaWFzIG1ldGhvZCBvcHRpb24gdG8gdHlwZSBhcyBwZXIgdGlja2V0ICMxMjAwNAoJCQlzLnR5cGUgPSBvcHRpb25zLm1ldGhvZCB8fCBvcHRpb25zLnR5cGUgfHwgcy5tZXRob2QgfHwgcy50eXBlOwoKCQkJLy8gRXh0cmFjdCBkYXRhVHlwZXMgbGlzdAoJCQlzLmRhdGFUeXBlcyA9IGpRdWVyeS50cmltKCBzLmRhdGFUeXBlIHx8ICIqIiApLnRvTG93ZXJDYXNlKCkubWF0Y2goIHJub3R3aGl0ZSApIHx8IFsgIiIgXTsKCgkJCS8vIEEgY3Jvc3MtZG9tYWluIHJlcXVlc3QgaXMgaW4gb3JkZXIgd2hlbiB3ZSBoYXZlIGEgcHJvdG9jb2w6aG9zdDpwb3J0IG1pc21hdGNoCgkJCWlmICggcy5jcm9zc0RvbWFpbiA9PSBudWxsICkgewoJCQkJcGFydHMgPSBydXJsLmV4ZWMoIHMudXJsLnRvTG93ZXJDYXNlKCkgKTsKCQkJCXMuY3Jvc3NEb21haW4gPSAhISggcGFydHMgJiYKCQkJCQkoIHBhcnRzWyAxIF0gIT09IGFqYXhMb2NQYXJ0c1sgMSBdIHx8IHBhcnRzWyAyIF0gIT09IGFqYXhMb2NQYXJ0c1sgMiBdIHx8CgkJCQkJCSggcGFydHNbIDMgXSB8fCAoIHBhcnRzWyAxIF0gPT09ICJodHRwOiIgPyAiODAiIDogIjQ0MyIgKSApICE9PQoJCQkJCQkJKCBhamF4TG9jUGFydHNbIDMgXSB8fCAoIGFqYXhMb2NQYXJ0c1sgMSBdID09PSAiaHR0cDoiID8gIjgwIiA6ICI0NDMiICkgKSApCgkJCQkpOwoJCQl9CgoJCQkvLyBDb252ZXJ0IGRhdGEgaWYgbm90IGFscmVhZHkgYSBzdHJpbmcKCQkJaWYgKCBzLmRhdGEgJiYgcy5wcm9jZXNzRGF0YSAmJiB0eXBlb2Ygcy5kYXRhICE9PSAic3RyaW5nIiApIHsKCQkJCXMuZGF0YSA9IGpRdWVyeS5wYXJhbSggcy5kYXRhLCBzLnRyYWRpdGlvbmFsICk7CgkJCX0KCgkJCS8vIEFwcGx5IHByZWZpbHRlcnMKCQkJaW5zcGVjdFByZWZpbHRlcnNPclRyYW5zcG9ydHMoIHByZWZpbHRlcnMsIHMsIG9wdGlvbnMsIGpxWEhSICk7CgoJCQkvLyBJZiByZXF1ZXN0IHdhcyBhYm9ydGVkIGluc2lkZSBhIHByZWZpbHRlciwgc3RvcCB0aGVyZQoJCQlpZiAoIHN0YXRlID09PSAyICkgewoJCQkJcmV0dXJuIGpxWEhSOwoJCQl9CgoJCQkvLyBXZSBjYW4gZmlyZSBnbG9iYWwgZXZlbnRzIGFzIG9mIG5vdyBpZiBhc2tlZCB0bwoJCQkvLyBEb24ndCBmaXJlIGV2ZW50cyBpZiBqUXVlcnkuZXZlbnQgaXMgdW5kZWZpbmVkIGluIGFuIEFNRC11c2FnZSBzY2VuYXJpbyAoIzE1MTE4KQoJCQlmaXJlR2xvYmFscyA9IGpRdWVyeS5ldmVudCAmJiBzLmdsb2JhbDsKCgkJCS8vIFdhdGNoIGZvciBhIG5ldyBzZXQgb2YgcmVxdWVzdHMKCQkJaWYgKCBmaXJlR2xvYmFscyAmJiBqUXVlcnkuYWN0aXZlKysgPT09IDAgKSB7CgkJCQlqUXVlcnkuZXZlbnQudHJpZ2dlciggImFqYXhTdGFydCIgKTsKCQkJfQoKCQkJLy8gVXBwZXJjYXNlIHRoZSB0eXBlCgkJCXMudHlwZSA9IHMudHlwZS50b1VwcGVyQ2FzZSgpOwoKCQkJLy8gRGV0ZXJtaW5lIGlmIHJlcXVlc3QgaGFzIGNvbnRlbnQKCQkJcy5oYXNDb250ZW50ID0gIXJub0NvbnRlbnQudGVzdCggcy50eXBlICk7CgoJCQkvLyBTYXZlIHRoZSBVUkwgaW4gY2FzZSB3ZSdyZSB0b3lpbmcgd2l0aCB0aGUgSWYtTW9kaWZpZWQtU2luY2UKCQkJLy8gYW5kL29yIElmLU5vbmUtTWF0Y2ggaGVhZGVyIGxhdGVyIG9uCgkJCWNhY2hlVVJMID0gcy51cmw7CgoJCQkvLyBNb3JlIG9wdGlvbnMgaGFuZGxpbmcgZm9yIHJlcXVlc3RzIHdpdGggbm8gY29udGVudAoJCQlpZiAoICFzLmhhc0NvbnRlbnQgKSB7CgoJCQkJLy8gSWYgZGF0YSBpcyBhdmFpbGFibGUsIGFwcGVuZCBkYXRhIHRvIHVybAoJCQkJaWYgKCBzLmRhdGEgKSB7CgkJCQkJY2FjaGVVUkwgPSAoIHMudXJsICs9ICggcnF1ZXJ5LnRlc3QoIGNhY2hlVVJMICkgPyAiJiIgOiAiPyIgKSArIHMuZGF0YSApOwoKCQkJCQkvLyAjOTY4MjogcmVtb3ZlIGRhdGEgc28gdGhhdCBpdCdzIG5vdCB1c2VkIGluIGFuIGV2ZW50dWFsIHJldHJ5CgkJCQkJZGVsZXRlIHMuZGF0YTsKCQkJCX0KCgkJCQkvLyBBZGQgYW50aS1jYWNoZSBpbiB1cmwgaWYgbmVlZGVkCgkJCQlpZiAoIHMuY2FjaGUgPT09IGZhbHNlICkgewoJCQkJCXMudXJsID0gcnRzLnRlc3QoIGNhY2hlVVJMICkgPwoKCQkJCQkJLy8gSWYgdGhlcmUgaXMgYWxyZWFkeSBhICdfJyBwYXJhbWV0ZXIsIHNldCBpdHMgdmFsdWUKCQkJCQkJY2FjaGVVUkwucmVwbGFjZSggcnRzLCAiJDFfPSIgKyBub25jZSsrICkgOgoKCQkJCQkJLy8gT3RoZXJ3aXNlIGFkZCBvbmUgdG8gdGhlIGVuZAoJCQkJCQljYWNoZVVSTCArICggcnF1ZXJ5LnRlc3QoIGNhY2hlVVJMICkgPyAiJiIgOiAiPyIgKSArICJfPSIgKyBub25jZSsrOwoJCQkJfQoJCQl9CgoJCQkvLyBTZXQgdGhlIElmLU1vZGlmaWVkLVNpbmNlIGFuZC9vciBJZi1Ob25lLU1hdGNoIGhlYWRlciwgaWYgaW4gaWZNb2RpZmllZCBtb2RlLgoJCQlpZiAoIHMuaWZNb2RpZmllZCApIHsKCQkJCWlmICggalF1ZXJ5Lmxhc3RNb2RpZmllZFsgY2FjaGVVUkwgXSApIHsKCQkJCQlqcVhIUi5zZXRSZXF1ZXN0SGVhZGVyKCAiSWYtTW9kaWZpZWQtU2luY2UiLCBqUXVlcnkubGFzdE1vZGlmaWVkWyBjYWNoZVVSTCBdICk7CgkJCQl9CgkJCQlpZiAoIGpRdWVyeS5ldGFnWyBjYWNoZVVSTCBdICkgewoJCQkJCWpxWEhSLnNldFJlcXVlc3RIZWFkZXIoICJJZi1Ob25lLU1hdGNoIiwgalF1ZXJ5LmV0YWdbIGNhY2hlVVJMIF0gKTsKCQkJCX0KCQkJfQoKCQkJLy8gU2V0IHRoZSBjb3JyZWN0IGhlYWRlciwgaWYgZGF0YSBpcyBiZWluZyBzZW50CgkJCWlmICggcy5kYXRhICYmIHMuaGFzQ29udGVudCAmJiBzLmNvbnRlbnRUeXBlICE9PSBmYWxzZSB8fCBvcHRpb25zLmNvbnRlbnRUeXBlICkgewoJCQkJanFYSFIuc2V0UmVxdWVzdEhlYWRlciggIkNvbnRlbnQtVHlwZSIsIHMuY29udGVudFR5cGUgKTsKCQkJfQoKCQkJLy8gU2V0IHRoZSBBY2NlcHRzIGhlYWRlciBmb3IgdGhlIHNlcnZlciwgZGVwZW5kaW5nIG9uIHRoZSBkYXRhVHlwZQoJCQlqcVhIUi5zZXRSZXF1ZXN0SGVhZGVyKAoJCQkJIkFjY2VwdCIsCgkJCQlzLmRhdGFUeXBlc1sgMCBdICYmIHMuYWNjZXB0c1sgcy5kYXRhVHlwZXNbIDAgXSBdID8KCQkJCQlzLmFjY2VwdHNbIHMuZGF0YVR5cGVzWyAwIF0gXSArCgkJCQkJCSggcy5kYXRhVHlwZXNbIDAgXSAhPT0gIioiID8gIiwgIiArIGFsbFR5cGVzICsgIjsgcT0wLjAxIiA6ICIiICkgOgoJCQkJCXMuYWNjZXB0c1sgIioiIF0KCQkJKTsKCgkJCS8vIENoZWNrIGZvciBoZWFkZXJzIG9wdGlvbgoJCQlmb3IgKCBpIGluIHMuaGVhZGVycyApIHsKCQkJCWpxWEhSLnNldFJlcXVlc3RIZWFkZXIoIGksIHMuaGVhZGVyc1sgaSBdICk7CgkJCX0KCgkJCS8vIEFsbG93IGN1c3RvbSBoZWFkZXJzL21pbWV0eXBlcyBhbmQgZWFybHkgYWJvcnQKCQkJaWYgKCBzLmJlZm9yZVNlbmQgJiYKCQkJCSggcy5iZWZvcmVTZW5kLmNhbGwoIGNhbGxiYWNrQ29udGV4dCwganFYSFIsIHMgKSA9PT0gZmFsc2UgfHwgc3RhdGUgPT09IDIgKSApIHsKCgkJCQkvLyBBYm9ydCBpZiBub3QgZG9uZSBhbHJlYWR5IGFuZCByZXR1cm4KCQkJCXJldHVybiBqcVhIUi5hYm9ydCgpOwoJCQl9CgoJCQkvLyBhYm9ydGluZyBpcyBubyBsb25nZXIgYSBjYW5jZWxsYXRpb24KCQkJc3RyQWJvcnQgPSAiYWJvcnQiOwoKCQkJLy8gSW5zdGFsbCBjYWxsYmFja3Mgb24gZGVmZXJyZWRzCgkJCWZvciAoIGkgaW4geyBzdWNjZXNzOiAxLCBlcnJvcjogMSwgY29tcGxldGU6IDEgfSApIHsKCQkJCWpxWEhSWyBpIF0oIHNbIGkgXSApOwoJCQl9CgoJCQkvLyBHZXQgdHJhbnNwb3J0CgkJCXRyYW5zcG9ydCA9IGluc3BlY3RQcmVmaWx0ZXJzT3JUcmFuc3BvcnRzKCB0cmFuc3BvcnRzLCBzLCBvcHRpb25zLCBqcVhIUiApOwoKCQkJLy8gSWYgbm8gdHJhbnNwb3J0LCB3ZSBhdXRvLWFib3J0CgkJCWlmICggIXRyYW5zcG9ydCApIHsKCQkJCWRvbmUoIC0xLCAiTm8gVHJhbnNwb3J0IiApOwoJCQl9IGVsc2UgewoJCQkJanFYSFIucmVhZHlTdGF0ZSA9IDE7CgoJCQkJLy8gU2VuZCBnbG9iYWwgZXZlbnQKCQkJCWlmICggZmlyZUdsb2JhbHMgKSB7CgkJCQkJZ2xvYmFsRXZlbnRDb250ZXh0LnRyaWdnZXIoICJhamF4U2VuZCIsIFsganFYSFIsIHMgXSApOwoJCQkJfQoKCQkJCS8vIElmIHJlcXVlc3Qgd2FzIGFib3J0ZWQgaW5zaWRlIGFqYXhTZW5kLCBzdG9wIHRoZXJlCgkJCQlpZiAoIHN0YXRlID09PSAyICkgewoJCQkJCXJldHVybiBqcVhIUjsKCQkJCX0KCgkJCQkvLyBUaW1lb3V0CgkJCQlpZiAoIHMuYXN5bmMgJiYgcy50aW1lb3V0ID4gMCApIHsKCQkJCQl0aW1lb3V0VGltZXIgPSB3aW5kb3cuc2V0VGltZW91dCggZnVuY3Rpb24oKSB7CgkJCQkJCWpxWEhSLmFib3J0KCAidGltZW91dCIgKTsKCQkJCQl9LCBzLnRpbWVvdXQgKTsKCQkJCX0KCgkJCQl0cnkgewoJCQkJCXN0YXRlID0gMTsKCQkJCQl0cmFuc3BvcnQuc2VuZCggcmVxdWVzdEhlYWRlcnMsIGRvbmUgKTsKCQkJCX0gY2F0Y2ggKCBlICkgewoKCQkJCQkvLyBQcm9wYWdhdGUgZXhjZXB0aW9uIGFzIGVycm9yIGlmIG5vdCBkb25lCgkJCQkJaWYgKCBzdGF0ZSA8IDIgKSB7CgkJCQkJCWRvbmUoIC0xLCBlICk7CgoJCQkJCS8vIFNpbXBseSByZXRocm93IG90aGVyd2lzZQoJCQkJCX0gZWxzZSB7CgkJCQkJCXRocm93IGU7CgkJCQkJfQoJCQkJfQoJCQl9CgoJCQkvLyBDYWxsYmFjayBmb3Igd2hlbiBldmVyeXRoaW5nIGlzIGRvbmUKCQkJZnVuY3Rpb24gZG9uZSggc3RhdHVzLCBuYXRpdmVTdGF0dXNUZXh0LCByZXNwb25zZXMsIGhlYWRlcnMgKSB7CgkJCQl2YXIgaXNTdWNjZXNzLCBzdWNjZXNzLCBlcnJvciwgcmVzcG9uc2UsIG1vZGlmaWVkLAoJCQkJCXN0YXR1c1RleHQgPSBuYXRpdmVTdGF0dXNUZXh0OwoKCQkJCS8vIENhbGxlZCBvbmNlCgkJCQlpZiAoIHN0YXRlID09PSAyICkgewoJCQkJCXJldHVybjsKCQkJCX0KCgkJCQkvLyBTdGF0ZSBpcyAiZG9uZSIgbm93CgkJCQlzdGF0ZSA9IDI7CgoJCQkJLy8gQ2xlYXIgdGltZW91dCBpZiBpdCBleGlzdHMKCQkJCWlmICggdGltZW91dFRpbWVyICkgewoJCQkJCXdpbmRvdy5jbGVhclRpbWVvdXQoIHRpbWVvdXRUaW1lciApOwoJCQkJfQoKCQkJCS8vIERlcmVmZXJlbmNlIHRyYW5zcG9ydCBmb3IgZWFybHkgZ2FyYmFnZSBjb2xsZWN0aW9uCgkJCQkvLyAobm8gbWF0dGVyIGhvdyBsb25nIHRoZSBqcVhIUiBvYmplY3Qgd2lsbCBiZSB1c2VkKQoJCQkJdHJhbnNwb3J0ID0gdW5kZWZpbmVkOwoKCQkJCS8vIENhY2hlIHJlc3BvbnNlIGhlYWRlcnMKCQkJCXJlc3BvbnNlSGVhZGVyc1N0cmluZyA9IGhlYWRlcnMgfHwgIiI7CgoJCQkJLy8gU2V0IHJlYWR5U3RhdGUKCQkJCWpxWEhSLnJlYWR5U3RhdGUgPSBzdGF0dXMgPiAwID8gNCA6IDA7CgoJCQkJLy8gRGV0ZXJtaW5lIGlmIHN1Y2Nlc3NmdWwKCQkJCWlzU3VjY2VzcyA9IHN0YXR1cyA+PSAyMDAgJiYgc3RhdHVzIDwgMzAwIHx8IHN0YXR1cyA9PT0gMzA0OwoKCQkJCS8vIEdldCByZXNwb25zZSBkYXRhCgkJCQlpZiAoIHJlc3BvbnNlcyApIHsKCQkJCQlyZXNwb25zZSA9IGFqYXhIYW5kbGVSZXNwb25zZXMoIHMsIGpxWEhSLCByZXNwb25zZXMgKTsKCQkJCX0KCgkJCQkvLyBDb252ZXJ0IG5vIG1hdHRlciB3aGF0ICh0aGF0IHdheSByZXNwb25zZVhYWCBmaWVsZHMgYXJlIGFsd2F5cyBzZXQpCgkJCQlyZXNwb25zZSA9IGFqYXhDb252ZXJ0KCBzLCByZXNwb25zZSwganFYSFIsIGlzU3VjY2VzcyApOwoKCQkJCS8vIElmIHN1Y2Nlc3NmdWwsIGhhbmRsZSB0eXBlIGNoYWluaW5nCgkJCQlpZiAoIGlzU3VjY2VzcyApIHsKCgkJCQkJLy8gU2V0IHRoZSBJZi1Nb2RpZmllZC1TaW5jZSBhbmQvb3IgSWYtTm9uZS1NYXRjaCBoZWFkZXIsIGlmIGluIGlmTW9kaWZpZWQgbW9kZS4KCQkJCQlpZiAoIHMuaWZNb2RpZmllZCApIHsKCQkJCQkJbW9kaWZpZWQgPSBqcVhIUi5nZXRSZXNwb25zZUhlYWRlciggIkxhc3QtTW9kaWZpZWQiICk7CgkJCQkJCWlmICggbW9kaWZpZWQgKSB7CgkJCQkJCQlqUXVlcnkubGFzdE1vZGlmaWVkWyBjYWNoZVVSTCBdID0gbW9kaWZpZWQ7CgkJCQkJCX0KCQkJCQkJbW9kaWZpZWQgPSBqcVhIUi5nZXRSZXNwb25zZUhlYWRlciggImV0YWciICk7CgkJCQkJCWlmICggbW9kaWZpZWQgKSB7CgkJCQkJCQlqUXVlcnkuZXRhZ1sgY2FjaGVVUkwgXSA9IG1vZGlmaWVkOwoJCQkJCQl9CgkJCQkJfQoKCQkJCQkvLyBpZiBubyBjb250ZW50CgkJCQkJaWYgKCBzdGF0dXMgPT09IDIwNCB8fCBzLnR5cGUgPT09ICJIRUFEIiApIHsKCQkJCQkJc3RhdHVzVGV4dCA9ICJub2NvbnRlbnQiOwoKCQkJCQkvLyBpZiBub3QgbW9kaWZpZWQKCQkJCQl9IGVsc2UgaWYgKCBzdGF0dXMgPT09IDMwNCApIHsKCQkJCQkJc3RhdHVzVGV4dCA9ICJub3Rtb2RpZmllZCI7CgoJCQkJCS8vIElmIHdlIGhhdmUgZGF0YSwgbGV0J3MgY29udmVydCBpdAoJCQkJCX0gZWxzZSB7CgkJCQkJCXN0YXR1c1RleHQgPSByZXNwb25zZS5zdGF0ZTsKCQkJCQkJc3VjY2VzcyA9IHJlc3BvbnNlLmRhdGE7CgkJCQkJCWVycm9yID0gcmVzcG9uc2UuZXJyb3I7CgkJCQkJCWlzU3VjY2VzcyA9ICFlcnJvcjsKCQkJCQl9CgkJCQl9IGVsc2UgewoKCQkJCQkvLyBXZSBleHRyYWN0IGVycm9yIGZyb20gc3RhdHVzVGV4dAoJCQkJCS8vIHRoZW4gbm9ybWFsaXplIHN0YXR1c1RleHQgYW5kIHN0YXR1cyBmb3Igbm9uLWFib3J0cwoJCQkJCWVycm9yID0gc3RhdHVzVGV4dDsKCQkJCQlpZiAoIHN0YXR1cyB8fCAhc3RhdHVzVGV4dCApIHsKCQkJCQkJc3RhdHVzVGV4dCA9ICJlcnJvciI7CgkJCQkJCWlmICggc3RhdHVzIDwgMCApIHsKCQkJCQkJCXN0YXR1cyA9IDA7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgoJCQkJLy8gU2V0IGRhdGEgZm9yIHRoZSBmYWtlIHhociBvYmplY3QKCQkJCWpxWEhSLnN0YXR1cyA9IHN0YXR1czsKCQkJCWpxWEhSLnN0YXR1c1RleHQgPSAoIG5hdGl2ZVN0YXR1c1RleHQgfHwgc3RhdHVzVGV4dCApICsgIiI7CgoJCQkJLy8gU3VjY2Vzcy9FcnJvcgoJCQkJaWYgKCBpc1N1Y2Nlc3MgKSB7CgkJCQkJZGVmZXJyZWQucmVzb2x2ZVdpdGgoIGNhbGxiYWNrQ29udGV4dCwgWyBzdWNjZXNzLCBzdGF0dXNUZXh0LCBqcVhIUiBdICk7CgkJCQl9IGVsc2UgewoJCQkJCWRlZmVycmVkLnJlamVjdFdpdGgoIGNhbGxiYWNrQ29udGV4dCwgWyBqcVhIUiwgc3RhdHVzVGV4dCwgZXJyb3IgXSApOwoJCQkJfQoKCQkJCS8vIFN0YXR1cy1kZXBlbmRlbnQgY2FsbGJhY2tzCgkJCQlqcVhIUi5zdGF0dXNDb2RlKCBzdGF0dXNDb2RlICk7CgkJCQlzdGF0dXNDb2RlID0gdW5kZWZpbmVkOwoKCQkJCWlmICggZmlyZUdsb2JhbHMgKSB7CgkJCQkJZ2xvYmFsRXZlbnRDb250ZXh0LnRyaWdnZXIoIGlzU3VjY2VzcyA/ICJhamF4U3VjY2VzcyIgOiAiYWpheEVycm9yIiwKCQkJCQkJWyBqcVhIUiwgcywgaXNTdWNjZXNzID8gc3VjY2VzcyA6IGVycm9yIF0gKTsKCQkJCX0KCgkJCQkvLyBDb21wbGV0ZQoJCQkJY29tcGxldGVEZWZlcnJlZC5maXJlV2l0aCggY2FsbGJhY2tDb250ZXh0LCBbIGpxWEhSLCBzdGF0dXNUZXh0IF0gKTsKCgkJCQlpZiAoIGZpcmVHbG9iYWxzICkgewoJCQkJCWdsb2JhbEV2ZW50Q29udGV4dC50cmlnZ2VyKCAiYWpheENvbXBsZXRlIiwgWyBqcVhIUiwgcyBdICk7CgoJCQkJCS8vIEhhbmRsZSB0aGUgZ2xvYmFsIEFKQVggY291bnRlcgoJCQkJCWlmICggISggLS1qUXVlcnkuYWN0aXZlICkgKSB7CgkJCQkJCWpRdWVyeS5ldmVudC50cmlnZ2VyKCAiYWpheFN0b3AiICk7CgkJCQkJfQoJCQkJfQoJCQl9CgoJCQlyZXR1cm4ganFYSFI7CgkJfSwKCgkJZ2V0SlNPTjogZnVuY3Rpb24oIHVybCwgZGF0YSwgY2FsbGJhY2sgKSB7CgkJCXJldHVybiBqUXVlcnkuZ2V0KCB1cmwsIGRhdGEsIGNhbGxiYWNrLCAianNvbiIgKTsKCQl9LAoKCQlnZXRTY3JpcHQ6IGZ1bmN0aW9uKCB1cmwsIGNhbGxiYWNrICkgewoJCQlyZXR1cm4galF1ZXJ5LmdldCggdXJsLCB1bmRlZmluZWQsIGNhbGxiYWNrLCAic2NyaXB0IiApOwoJCX0KCX0gKTsKCglqUXVlcnkuZWFjaCggWyAiZ2V0IiwgInBvc3QiIF0sIGZ1bmN0aW9uKCBpLCBtZXRob2QgKSB7CgkJalF1ZXJ5WyBtZXRob2QgXSA9IGZ1bmN0aW9uKCB1cmwsIGRhdGEsIGNhbGxiYWNrLCB0eXBlICkgewoKCQkJLy8gc2hpZnQgYXJndW1lbnRzIGlmIGRhdGEgYXJndW1lbnQgd2FzIG9taXR0ZWQKCQkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggZGF0YSApICkgewoJCQkJdHlwZSA9IHR5cGUgfHwgY2FsbGJhY2s7CgkJCQljYWxsYmFjayA9IGRhdGE7CgkJCQlkYXRhID0gdW5kZWZpbmVkOwoJCQl9CgoJCQkvLyBUaGUgdXJsIGNhbiBiZSBhbiBvcHRpb25zIG9iamVjdCAod2hpY2ggdGhlbiBtdXN0IGhhdmUgLnVybCkKCQkJcmV0dXJuIGpRdWVyeS5hamF4KCBqUXVlcnkuZXh0ZW5kKCB7CgkJCQl1cmw6IHVybCwKCQkJCXR5cGU6IG1ldGhvZCwKCQkJCWRhdGFUeXBlOiB0eXBlLAoJCQkJZGF0YTogZGF0YSwKCQkJCXN1Y2Nlc3M6IGNhbGxiYWNrCgkJCX0sIGpRdWVyeS5pc1BsYWluT2JqZWN0KCB1cmwgKSAmJiB1cmwgKSApOwoJCX07Cgl9ICk7CgoKCWpRdWVyeS5fZXZhbFVybCA9IGZ1bmN0aW9uKCB1cmwgKSB7CgkJcmV0dXJuIGpRdWVyeS5hamF4KCB7CgkJCXVybDogdXJsLAoKCQkJLy8gTWFrZSB0aGlzIGV4cGxpY2l0LCBzaW5jZSB1c2VyIGNhbiBvdmVycmlkZSB0aGlzIHRocm91Z2ggYWpheFNldHVwICgjMTEyNjQpCgkJCXR5cGU6ICJHRVQiLAoJCQlkYXRhVHlwZTogInNjcmlwdCIsCgkJCWNhY2hlOiB0cnVlLAoJCQlhc3luYzogZmFsc2UsCgkJCWdsb2JhbDogZmFsc2UsCgkJCSJ0aHJvd3MiOiB0cnVlCgkJfSApOwoJfTsKCgoJalF1ZXJ5LmZuLmV4dGVuZCggewoJCXdyYXBBbGw6IGZ1bmN0aW9uKCBodG1sICkgewoJCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBodG1sICkgKSB7CgkJCQlyZXR1cm4gdGhpcy5lYWNoKCBmdW5jdGlvbiggaSApIHsKCQkJCQlqUXVlcnkoIHRoaXMgKS53cmFwQWxsKCBodG1sLmNhbGwoIHRoaXMsIGkgKSApOwoJCQkJfSApOwoJCQl9CgoJCQlpZiAoIHRoaXNbIDAgXSApIHsKCgkJCQkvLyBUaGUgZWxlbWVudHMgdG8gd3JhcCB0aGUgdGFyZ2V0IGFyb3VuZAoJCQkJdmFyIHdyYXAgPSBqUXVlcnkoIGh0bWwsIHRoaXNbIDAgXS5vd25lckRvY3VtZW50ICkuZXEoIDAgKS5jbG9uZSggdHJ1ZSApOwoKCQkJCWlmICggdGhpc1sgMCBdLnBhcmVudE5vZGUgKSB7CgkJCQkJd3JhcC5pbnNlcnRCZWZvcmUoIHRoaXNbIDAgXSApOwoJCQkJfQoKCQkJCXdyYXAubWFwKCBmdW5jdGlvbigpIHsKCQkJCQl2YXIgZWxlbSA9IHRoaXM7CgoJCQkJCXdoaWxlICggZWxlbS5maXJzdENoaWxkICYmIGVsZW0uZmlyc3RDaGlsZC5ub2RlVHlwZSA9PT0gMSApIHsKCQkJCQkJZWxlbSA9IGVsZW0uZmlyc3RDaGlsZDsKCQkJCQl9CgoJCQkJCXJldHVybiBlbGVtOwoJCQkJfSApLmFwcGVuZCggdGhpcyApOwoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCQl9LAoKCQl3cmFwSW5uZXI6IGZ1bmN0aW9uKCBodG1sICkgewoJCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBodG1sICkgKSB7CgkJCQlyZXR1cm4gdGhpcy5lYWNoKCBmdW5jdGlvbiggaSApIHsKCQkJCQlqUXVlcnkoIHRoaXMgKS53cmFwSW5uZXIoIGh0bWwuY2FsbCggdGhpcywgaSApICk7CgkJCQl9ICk7CgkJCX0KCgkJCXJldHVybiB0aGlzLmVhY2goIGZ1bmN0aW9uKCkgewoJCQkJdmFyIHNlbGYgPSBqUXVlcnkoIHRoaXMgKSwKCQkJCQljb250ZW50cyA9IHNlbGYuY29udGVudHMoKTsKCgkJCQlpZiAoIGNvbnRlbnRzLmxlbmd0aCApIHsKCQkJCQljb250ZW50cy53cmFwQWxsKCBodG1sICk7CgoJCQkJfSBlbHNlIHsKCQkJCQlzZWxmLmFwcGVuZCggaHRtbCApOwoJCQkJfQoJCQl9ICk7CgkJfSwKCgkJd3JhcDogZnVuY3Rpb24oIGh0bWwgKSB7CgkJCXZhciBpc0Z1bmN0aW9uID0galF1ZXJ5LmlzRnVuY3Rpb24oIGh0bWwgKTsKCgkJCXJldHVybiB0aGlzLmVhY2goIGZ1bmN0aW9uKCBpICkgewoJCQkJalF1ZXJ5KCB0aGlzICkud3JhcEFsbCggaXNGdW5jdGlvbiA/IGh0bWwuY2FsbCggdGhpcywgaSApIDogaHRtbCApOwoJCQl9ICk7CgkJfSwKCgkJdW53cmFwOiBmdW5jdGlvbigpIHsKCQkJcmV0dXJuIHRoaXMucGFyZW50KCkuZWFjaCggZnVuY3Rpb24oKSB7CgkJCQlpZiAoICFqUXVlcnkubm9kZU5hbWUoIHRoaXMsICJib2R5IiApICkgewoJCQkJCWpRdWVyeSggdGhpcyApLnJlcGxhY2VXaXRoKCB0aGlzLmNoaWxkTm9kZXMgKTsKCQkJCX0KCQkJfSApLmVuZCgpOwoJCX0KCX0gKTsKCgoJZnVuY3Rpb24gZ2V0RGlzcGxheSggZWxlbSApIHsKCQlyZXR1cm4gZWxlbS5zdHlsZSAmJiBlbGVtLnN0eWxlLmRpc3BsYXkgfHwgalF1ZXJ5LmNzcyggZWxlbSwgImRpc3BsYXkiICk7Cgl9CgoJZnVuY3Rpb24gZmlsdGVySGlkZGVuKCBlbGVtICkgewoKCQkvLyBEaXNjb25uZWN0ZWQgZWxlbWVudHMgYXJlIGNvbnNpZGVyZWQgaGlkZGVuCgkJaWYgKCAhalF1ZXJ5LmNvbnRhaW5zKCBlbGVtLm93bmVyRG9jdW1lbnQgfHwgZG9jdW1lbnQsIGVsZW0gKSApIHsKCQkJcmV0dXJuIHRydWU7CgkJfQoJCXdoaWxlICggZWxlbSAmJiBlbGVtLm5vZGVUeXBlID09PSAxICkgewoJCQlpZiAoIGdldERpc3BsYXkoIGVsZW0gKSA9PT0gIm5vbmUiIHx8IGVsZW0udHlwZSA9PT0gImhpZGRlbiIgKSB7CgkJCQlyZXR1cm4gdHJ1ZTsKCQkJfQoJCQllbGVtID0gZWxlbS5wYXJlbnROb2RlOwoJCX0KCQlyZXR1cm4gZmFsc2U7Cgl9CgoJalF1ZXJ5LmV4cHIuZmlsdGVycy5oaWRkZW4gPSBmdW5jdGlvbiggZWxlbSApIHsKCgkJLy8gU3VwcG9ydDogT3BlcmEgPD0gMTIuMTIKCQkvLyBPcGVyYSByZXBvcnRzIG9mZnNldFdpZHRocyBhbmQgb2Zmc2V0SGVpZ2h0cyBsZXNzIHRoYW4gemVybyBvbiBzb21lIGVsZW1lbnRzCgkJcmV0dXJuIHN1cHBvcnQucmVsaWFibGVIaWRkZW5PZmZzZXRzKCkgPwoJCQkoIGVsZW0ub2Zmc2V0V2lkdGggPD0gMCAmJiBlbGVtLm9mZnNldEhlaWdodCA8PSAwICYmCgkJCQkhZWxlbS5nZXRDbGllbnRSZWN0cygpLmxlbmd0aCApIDoKCQkJCWZpbHRlckhpZGRlbiggZWxlbSApOwoJfTsKCglqUXVlcnkuZXhwci5maWx0ZXJzLnZpc2libGUgPSBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4gIWpRdWVyeS5leHByLmZpbHRlcnMuaGlkZGVuKCBlbGVtICk7Cgl9OwoKCgoKCXZhciByMjAgPSAvJTIwL2csCgkJcmJyYWNrZXQgPSAvXFtcXSQvLAoJCXJDUkxGID0gL1xyP1xuL2csCgkJcnN1Ym1pdHRlclR5cGVzID0gL14oPzpzdWJtaXR8YnV0dG9ufGltYWdlfHJlc2V0fGZpbGUpJC9pLAoJCXJzdWJtaXR0YWJsZSA9IC9eKD86aW5wdXR8c2VsZWN0fHRleHRhcmVhfGtleWdlbikvaTsKCglmdW5jdGlvbiBidWlsZFBhcmFtcyggcHJlZml4LCBvYmosIHRyYWRpdGlvbmFsLCBhZGQgKSB7CgkJdmFyIG5hbWU7CgoJCWlmICggalF1ZXJ5LmlzQXJyYXkoIG9iaiApICkgewoKCQkJLy8gU2VyaWFsaXplIGFycmF5IGl0ZW0uCgkJCWpRdWVyeS5lYWNoKCBvYmosIGZ1bmN0aW9uKCBpLCB2ICkgewoJCQkJaWYgKCB0cmFkaXRpb25hbCB8fCByYnJhY2tldC50ZXN0KCBwcmVmaXggKSApIHsKCgkJCQkJLy8gVHJlYXQgZWFjaCBhcnJheSBpdGVtIGFzIGEgc2NhbGFyLgoJCQkJCWFkZCggcHJlZml4LCB2ICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJLy8gSXRlbSBpcyBub24tc2NhbGFyIChhcnJheSBvciBvYmplY3QpLCBlbmNvZGUgaXRzIG51bWVyaWMgaW5kZXguCgkJCQkJYnVpbGRQYXJhbXMoCgkJCQkJCXByZWZpeCArICJbIiArICggdHlwZW9mIHYgPT09ICJvYmplY3QiICYmIHYgIT0gbnVsbCA/IGkgOiAiIiApICsgIl0iLAoJCQkJCQl2LAoJCQkJCQl0cmFkaXRpb25hbCwKCQkJCQkJYWRkCgkJCQkJKTsKCQkJCX0KCQkJfSApOwoKCQl9IGVsc2UgaWYgKCAhdHJhZGl0aW9uYWwgJiYgalF1ZXJ5LnR5cGUoIG9iaiApID09PSAib2JqZWN0IiApIHsKCgkJCS8vIFNlcmlhbGl6ZSBvYmplY3QgaXRlbS4KCQkJZm9yICggbmFtZSBpbiBvYmogKSB7CgkJCQlidWlsZFBhcmFtcyggcHJlZml4ICsgIlsiICsgbmFtZSArICJdIiwgb2JqWyBuYW1lIF0sIHRyYWRpdGlvbmFsLCBhZGQgKTsKCQkJfQoKCQl9IGVsc2UgewoKCQkJLy8gU2VyaWFsaXplIHNjYWxhciBpdGVtLgoJCQlhZGQoIHByZWZpeCwgb2JqICk7CgkJfQoJfQoKCS8vIFNlcmlhbGl6ZSBhbiBhcnJheSBvZiBmb3JtIGVsZW1lbnRzIG9yIGEgc2V0IG9mCgkvLyBrZXkvdmFsdWVzIGludG8gYSBxdWVyeSBzdHJpbmcKCWpRdWVyeS5wYXJhbSA9IGZ1bmN0aW9uKCBhLCB0cmFkaXRpb25hbCApIHsKCQl2YXIgcHJlZml4LAoJCQlzID0gW10sCgkJCWFkZCA9IGZ1bmN0aW9uKCBrZXksIHZhbHVlICkgewoKCQkJCS8vIElmIHZhbHVlIGlzIGEgZnVuY3Rpb24sIGludm9rZSBpdCBhbmQgcmV0dXJuIGl0cyB2YWx1ZQoJCQkJdmFsdWUgPSBqUXVlcnkuaXNGdW5jdGlvbiggdmFsdWUgKSA/IHZhbHVlKCkgOiAoIHZhbHVlID09IG51bGwgPyAiIiA6IHZhbHVlICk7CgkJCQlzWyBzLmxlbmd0aCBdID0gZW5jb2RlVVJJQ29tcG9uZW50KCBrZXkgKSArICI9IiArIGVuY29kZVVSSUNvbXBvbmVudCggdmFsdWUgKTsKCQkJfTsKCgkJLy8gU2V0IHRyYWRpdGlvbmFsIHRvIHRydWUgZm9yIGpRdWVyeSA8PSAxLjMuMiBiZWhhdmlvci4KCQlpZiAoIHRyYWRpdGlvbmFsID09PSB1bmRlZmluZWQgKSB7CgkJCXRyYWRpdGlvbmFsID0galF1ZXJ5LmFqYXhTZXR0aW5ncyAmJiBqUXVlcnkuYWpheFNldHRpbmdzLnRyYWRpdGlvbmFsOwoJCX0KCgkJLy8gSWYgYW4gYXJyYXkgd2FzIHBhc3NlZCBpbiwgYXNzdW1lIHRoYXQgaXQgaXMgYW4gYXJyYXkgb2YgZm9ybSBlbGVtZW50cy4KCQlpZiAoIGpRdWVyeS5pc0FycmF5KCBhICkgfHwgKCBhLmpxdWVyeSAmJiAhalF1ZXJ5LmlzUGxhaW5PYmplY3QoIGEgKSApICkgewoKCQkJLy8gU2VyaWFsaXplIHRoZSBmb3JtIGVsZW1lbnRzCgkJCWpRdWVyeS5lYWNoKCBhLCBmdW5jdGlvbigpIHsKCQkJCWFkZCggdGhpcy5uYW1lLCB0aGlzLnZhbHVlICk7CgkJCX0gKTsKCgkJfSBlbHNlIHsKCgkJCS8vIElmIHRyYWRpdGlvbmFsLCBlbmNvZGUgdGhlICJvbGQiIHdheSAodGhlIHdheSAxLjMuMiBvciBvbGRlcgoJCQkvLyBkaWQgaXQpLCBvdGhlcndpc2UgZW5jb2RlIHBhcmFtcyByZWN1cnNpdmVseS4KCQkJZm9yICggcHJlZml4IGluIGEgKSB7CgkJCQlidWlsZFBhcmFtcyggcHJlZml4LCBhWyBwcmVmaXggXSwgdHJhZGl0aW9uYWwsIGFkZCApOwoJCQl9CgkJfQoKCQkvLyBSZXR1cm4gdGhlIHJlc3VsdGluZyBzZXJpYWxpemF0aW9uCgkJcmV0dXJuIHMuam9pbiggIiYiICkucmVwbGFjZSggcjIwLCAiKyIgKTsKCX07CgoJalF1ZXJ5LmZuLmV4dGVuZCggewoJCXNlcmlhbGl6ZTogZnVuY3Rpb24oKSB7CgkJCXJldHVybiBqUXVlcnkucGFyYW0oIHRoaXMuc2VyaWFsaXplQXJyYXkoKSApOwoJCX0sCgkJc2VyaWFsaXplQXJyYXk6IGZ1bmN0aW9uKCkgewoJCQlyZXR1cm4gdGhpcy5tYXAoIGZ1bmN0aW9uKCkgewoKCQkJCS8vIENhbiBhZGQgcHJvcEhvb2sgZm9yICJlbGVtZW50cyIgdG8gZmlsdGVyIG9yIGFkZCBmb3JtIGVsZW1lbnRzCgkJCQl2YXIgZWxlbWVudHMgPSBqUXVlcnkucHJvcCggdGhpcywgImVsZW1lbnRzIiApOwoJCQkJcmV0dXJuIGVsZW1lbnRzID8galF1ZXJ5Lm1ha2VBcnJheSggZWxlbWVudHMgKSA6IHRoaXM7CgkJCX0gKQoJCQkuZmlsdGVyKCBmdW5jdGlvbigpIHsKCQkJCXZhciB0eXBlID0gdGhpcy50eXBlOwoKCQkJCS8vIFVzZSAuaXMoIjpkaXNhYmxlZCIpIHNvIHRoYXQgZmllbGRzZXRbZGlzYWJsZWRdIHdvcmtzCgkJCQlyZXR1cm4gdGhpcy5uYW1lICYmICFqUXVlcnkoIHRoaXMgKS5pcyggIjpkaXNhYmxlZCIgKSAmJgoJCQkJCXJzdWJtaXR0YWJsZS50ZXN0KCB0aGlzLm5vZGVOYW1lICkgJiYgIXJzdWJtaXR0ZXJUeXBlcy50ZXN0KCB0eXBlICkgJiYKCQkJCQkoIHRoaXMuY2hlY2tlZCB8fCAhcmNoZWNrYWJsZVR5cGUudGVzdCggdHlwZSApICk7CgkJCX0gKQoJCQkubWFwKCBmdW5jdGlvbiggaSwgZWxlbSApIHsKCQkJCXZhciB2YWwgPSBqUXVlcnkoIHRoaXMgKS52YWwoKTsKCgkJCQlyZXR1cm4gdmFsID09IG51bGwgPwoJCQkJCW51bGwgOgoJCQkJCWpRdWVyeS5pc0FycmF5KCB2YWwgKSA/CgkJCQkJCWpRdWVyeS5tYXAoIHZhbCwgZnVuY3Rpb24oIHZhbCApIHsKCQkJCQkJCXJldHVybiB7IG5hbWU6IGVsZW0ubmFtZSwgdmFsdWU6IHZhbC5yZXBsYWNlKCByQ1JMRiwgIlxyXG4iICkgfTsKCQkJCQkJfSApIDoKCQkJCQkJeyBuYW1lOiBlbGVtLm5hbWUsIHZhbHVlOiB2YWwucmVwbGFjZSggckNSTEYsICJcclxuIiApIH07CgkJCX0gKS5nZXQoKTsKCQl9Cgl9ICk7CgoKCS8vIENyZWF0ZSB0aGUgcmVxdWVzdCBvYmplY3QKCS8vIChUaGlzIGlzIHN0aWxsIGF0dGFjaGVkIHRvIGFqYXhTZXR0aW5ncyBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eSkKCWpRdWVyeS5hamF4U2V0dGluZ3MueGhyID0gd2luZG93LkFjdGl2ZVhPYmplY3QgIT09IHVuZGVmaW5lZCA/CgoJCS8vIFN1cHBvcnQ6IElFNi1JRTgKCQlmdW5jdGlvbigpIHsKCgkJCS8vIFhIUiBjYW5ub3QgYWNjZXNzIGxvY2FsIGZpbGVzLCBhbHdheXMgdXNlIEFjdGl2ZVggZm9yIHRoYXQgY2FzZQoJCQlpZiAoIHRoaXMuaXNMb2NhbCApIHsKCQkJCXJldHVybiBjcmVhdGVBY3RpdmVYSFIoKTsKCQkJfQoKCQkJLy8gU3VwcG9ydDogSUUgOS0xMQoJCQkvLyBJRSBzZWVtcyB0byBlcnJvciBvbiBjcm9zcy1kb21haW4gUEFUQ0ggcmVxdWVzdHMgd2hlbiBBY3RpdmVYIFhIUgoJCQkvLyBpcyB1c2VkLiBJbiBJRSA5KyBhbHdheXMgdXNlIHRoZSBuYXRpdmUgWEhSLgoJCQkvLyBOb3RlOiB0aGlzIGNvbmRpdGlvbiB3b24ndCBjYXRjaCBFZGdlIGFzIGl0IGRvZXNuJ3QgZGVmaW5lCgkJCS8vIGRvY3VtZW50LmRvY3VtZW50TW9kZSBidXQgaXQgYWxzbyBkb2Vzbid0IHN1cHBvcnQgQWN0aXZlWCBzbyBpdCB3b24ndAoJCQkvLyByZWFjaCB0aGlzIGNvZGUuCgkJCWlmICggZG9jdW1lbnQuZG9jdW1lbnRNb2RlID4gOCApIHsKCQkJCXJldHVybiBjcmVhdGVTdGFuZGFyZFhIUigpOwoJCQl9CgoJCQkvLyBTdXBwb3J0OiBJRTw5CgkJCS8vIG9sZElFIFhIUiBkb2VzIG5vdCBzdXBwb3J0IG5vbi1SRkMyNjE2IG1ldGhvZHMgKCMxMzI0MCkKCQkJLy8gU2VlIGh0dHA6Ly9tc2RuLm1pY3Jvc29mdC5jb20vZW4tdXMvbGlicmFyeS9pZS9tczUzNjY0OCh2PXZzLjg1KS5hc3B4CgkJCS8vIGFuZCBodHRwOi8vd3d3LnczLm9yZy9Qcm90b2NvbHMvcmZjMjYxNi9yZmMyNjE2LXNlYzkuaHRtbCNzZWM5CgkJCS8vIEFsdGhvdWdoIHRoaXMgY2hlY2sgZm9yIHNpeCBtZXRob2RzIGluc3RlYWQgb2YgZWlnaHQKCQkJLy8gc2luY2UgSUUgYWxzbyBkb2VzIG5vdCBzdXBwb3J0ICJ0cmFjZSIgYW5kICJjb25uZWN0IgoJCQlyZXR1cm4gL14oZ2V0fHBvc3R8aGVhZHxwdXR8ZGVsZXRlfG9wdGlvbnMpJC9pLnRlc3QoIHRoaXMudHlwZSApICYmCgkJCQljcmVhdGVTdGFuZGFyZFhIUigpIHx8IGNyZWF0ZUFjdGl2ZVhIUigpOwoJCX0gOgoKCQkvLyBGb3IgYWxsIG90aGVyIGJyb3dzZXJzLCB1c2UgdGhlIHN0YW5kYXJkIFhNTEh0dHBSZXF1ZXN0IG9iamVjdAoJCWNyZWF0ZVN0YW5kYXJkWEhSOwoKCXZhciB4aHJJZCA9IDAsCgkJeGhyQ2FsbGJhY2tzID0ge30sCgkJeGhyU3VwcG9ydGVkID0galF1ZXJ5LmFqYXhTZXR0aW5ncy54aHIoKTsKCgkvLyBTdXBwb3J0OiBJRTwxMAoJLy8gT3BlbiByZXF1ZXN0cyBtdXN0IGJlIG1hbnVhbGx5IGFib3J0ZWQgb24gdW5sb2FkICgjNTI4MCkKCS8vIFNlZSBodHRwczovL3N1cHBvcnQubWljcm9zb2Z0LmNvbS9rYi8yODU2NzQ2IGZvciBtb3JlIGluZm8KCWlmICggd2luZG93LmF0dGFjaEV2ZW50ICkgewoJCXdpbmRvdy5hdHRhY2hFdmVudCggIm9udW5sb2FkIiwgZnVuY3Rpb24oKSB7CgkJCWZvciAoIHZhciBrZXkgaW4geGhyQ2FsbGJhY2tzICkgewoJCQkJeGhyQ2FsbGJhY2tzWyBrZXkgXSggdW5kZWZpbmVkLCB0cnVlICk7CgkJCX0KCQl9ICk7Cgl9CgoJLy8gRGV0ZXJtaW5lIHN1cHBvcnQgcHJvcGVydGllcwoJc3VwcG9ydC5jb3JzID0gISF4aHJTdXBwb3J0ZWQgJiYgKCAid2l0aENyZWRlbnRpYWxzIiBpbiB4aHJTdXBwb3J0ZWQgKTsKCXhoclN1cHBvcnRlZCA9IHN1cHBvcnQuYWpheCA9ICEheGhyU3VwcG9ydGVkOwoKCS8vIENyZWF0ZSB0cmFuc3BvcnQgaWYgdGhlIGJyb3dzZXIgY2FuIHByb3ZpZGUgYW4geGhyCglpZiAoIHhoclN1cHBvcnRlZCApIHsKCgkJalF1ZXJ5LmFqYXhUcmFuc3BvcnQoIGZ1bmN0aW9uKCBvcHRpb25zICkgewoKCQkJLy8gQ3Jvc3MgZG9tYWluIG9ubHkgYWxsb3dlZCBpZiBzdXBwb3J0ZWQgdGhyb3VnaCBYTUxIdHRwUmVxdWVzdAoJCQlpZiAoICFvcHRpb25zLmNyb3NzRG9tYWluIHx8IHN1cHBvcnQuY29ycyApIHsKCgkJCQl2YXIgY2FsbGJhY2s7CgoJCQkJcmV0dXJuIHsKCQkJCQlzZW5kOiBmdW5jdGlvbiggaGVhZGVycywgY29tcGxldGUgKSB7CgkJCQkJCXZhciBpLAoJCQkJCQkJeGhyID0gb3B0aW9ucy54aHIoKSwKCQkJCQkJCWlkID0gKyt4aHJJZDsKCgkJCQkJCS8vIE9wZW4gdGhlIHNvY2tldAoJCQkJCQl4aHIub3BlbigKCQkJCQkJCW9wdGlvbnMudHlwZSwKCQkJCQkJCW9wdGlvbnMudXJsLAoJCQkJCQkJb3B0aW9ucy5hc3luYywKCQkJCQkJCW9wdGlvbnMudXNlcm5hbWUsCgkJCQkJCQlvcHRpb25zLnBhc3N3b3JkCgkJCQkJCSk7CgoJCQkJCQkvLyBBcHBseSBjdXN0b20gZmllbGRzIGlmIHByb3ZpZGVkCgkJCQkJCWlmICggb3B0aW9ucy54aHJGaWVsZHMgKSB7CgkJCQkJCQlmb3IgKCBpIGluIG9wdGlvbnMueGhyRmllbGRzICkgewoJCQkJCQkJCXhoclsgaSBdID0gb3B0aW9ucy54aHJGaWVsZHNbIGkgXTsKCQkJCQkJCX0KCQkJCQkJfQoKCQkJCQkJLy8gT3ZlcnJpZGUgbWltZSB0eXBlIGlmIG5lZWRlZAoJCQkJCQlpZiAoIG9wdGlvbnMubWltZVR5cGUgJiYgeGhyLm92ZXJyaWRlTWltZVR5cGUgKSB7CgkJCQkJCQl4aHIub3ZlcnJpZGVNaW1lVHlwZSggb3B0aW9ucy5taW1lVHlwZSApOwoJCQkJCQl9CgoJCQkJCQkvLyBYLVJlcXVlc3RlZC1XaXRoIGhlYWRlcgoJCQkJCQkvLyBGb3IgY3Jvc3MtZG9tYWluIHJlcXVlc3RzLCBzZWVpbmcgYXMgY29uZGl0aW9ucyBmb3IgYSBwcmVmbGlnaHQgYXJlCgkJCQkJCS8vIGFraW4gdG8gYSBqaWdzYXcgcHV6emxlLCB3ZSBzaW1wbHkgbmV2ZXIgc2V0IGl0IHRvIGJlIHN1cmUuCgkJCQkJCS8vIChpdCBjYW4gYWx3YXlzIGJlIHNldCBvbiBhIHBlci1yZXF1ZXN0IGJhc2lzIG9yIGV2ZW4gdXNpbmcgYWpheFNldHVwKQoJCQkJCQkvLyBGb3Igc2FtZS1kb21haW4gcmVxdWVzdHMsIHdvbid0IGNoYW5nZSBoZWFkZXIgaWYgYWxyZWFkeSBwcm92aWRlZC4KCQkJCQkJaWYgKCAhb3B0aW9ucy5jcm9zc0RvbWFpbiAmJiAhaGVhZGVyc1sgIlgtUmVxdWVzdGVkLVdpdGgiIF0gKSB7CgkJCQkJCQloZWFkZXJzWyAiWC1SZXF1ZXN0ZWQtV2l0aCIgXSA9ICJYTUxIdHRwUmVxdWVzdCI7CgkJCQkJCX0KCgkJCQkJCS8vIFNldCBoZWFkZXJzCgkJCQkJCWZvciAoIGkgaW4gaGVhZGVycyApIHsKCgkJCQkJCQkvLyBTdXBwb3J0OiBJRTw5CgkJCQkJCQkvLyBJRSdzIEFjdGl2ZVhPYmplY3QgdGhyb3dzIGEgJ1R5cGUgTWlzbWF0Y2gnIGV4Y2VwdGlvbiB3aGVuIHNldHRpbmcKCQkJCQkJCS8vIHJlcXVlc3QgaGVhZGVyIHRvIGEgbnVsbC12YWx1ZS4KCQkJCQkJCS8vCgkJCQkJCQkvLyBUbyBrZWVwIGNvbnNpc3RlbnQgd2l0aCBvdGhlciBYSFIgaW1wbGVtZW50YXRpb25zLCBjYXN0IHRoZSB2YWx1ZQoJCQkJCQkJLy8gdG8gc3RyaW5nIGFuZCBpZ25vcmUgYHVuZGVmaW5lZGAuCgkJCQkJCQlpZiAoIGhlYWRlcnNbIGkgXSAhPT0gdW5kZWZpbmVkICkgewoJCQkJCQkJCXhoci5zZXRSZXF1ZXN0SGVhZGVyKCBpLCBoZWFkZXJzWyBpIF0gKyAiIiApOwoJCQkJCQkJfQoJCQkJCQl9CgoJCQkJCQkvLyBEbyBzZW5kIHRoZSByZXF1ZXN0CgkJCQkJCS8vIFRoaXMgbWF5IHJhaXNlIGFuIGV4Y2VwdGlvbiB3aGljaCBpcyBhY3R1YWxseQoJCQkJCQkvLyBoYW5kbGVkIGluIGpRdWVyeS5hamF4IChzbyBubyB0cnkvY2F0Y2ggaGVyZSkKCQkJCQkJeGhyLnNlbmQoICggb3B0aW9ucy5oYXNDb250ZW50ICYmIG9wdGlvbnMuZGF0YSApIHx8IG51bGwgKTsKCgkJCQkJCS8vIExpc3RlbmVyCgkJCQkJCWNhbGxiYWNrID0gZnVuY3Rpb24oIF8sIGlzQWJvcnQgKSB7CgkJCQkJCQl2YXIgc3RhdHVzLCBzdGF0dXNUZXh0LCByZXNwb25zZXM7CgoJCQkJCQkJLy8gV2FzIG5ldmVyIGNhbGxlZCBhbmQgaXMgYWJvcnRlZCBvciBjb21wbGV0ZQoJCQkJCQkJaWYgKCBjYWxsYmFjayAmJiAoIGlzQWJvcnQgfHwgeGhyLnJlYWR5U3RhdGUgPT09IDQgKSApIHsKCgkJCQkJCQkJLy8gQ2xlYW4gdXAKCQkJCQkJCQlkZWxldGUgeGhyQ2FsbGJhY2tzWyBpZCBdOwoJCQkJCQkJCWNhbGxiYWNrID0gdW5kZWZpbmVkOwoJCQkJCQkJCXhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBqUXVlcnkubm9vcDsKCgkJCQkJCQkJLy8gQWJvcnQgbWFudWFsbHkgaWYgbmVlZGVkCgkJCQkJCQkJaWYgKCBpc0Fib3J0ICkgewoJCQkJCQkJCQlpZiAoIHhoci5yZWFkeVN0YXRlICE9PSA0ICkgewoJCQkJCQkJCQkJeGhyLmFib3J0KCk7CgkJCQkJCQkJCX0KCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQlyZXNwb25zZXMgPSB7fTsKCQkJCQkJCQkJc3RhdHVzID0geGhyLnN0YXR1czsKCgkJCQkJCQkJCS8vIFN1cHBvcnQ6IElFPDEwCgkJCQkJCQkJCS8vIEFjY2Vzc2luZyBiaW5hcnktZGF0YSByZXNwb25zZVRleHQgdGhyb3dzIGFuIGV4Y2VwdGlvbgoJCQkJCQkJCQkvLyAoIzExNDI2KQoJCQkJCQkJCQlpZiAoIHR5cGVvZiB4aHIucmVzcG9uc2VUZXh0ID09PSAic3RyaW5nIiApIHsKCQkJCQkJCQkJCXJlc3BvbnNlcy50ZXh0ID0geGhyLnJlc3BvbnNlVGV4dDsKCQkJCQkJCQkJfQoKCQkJCQkJCQkJLy8gRmlyZWZveCB0aHJvd3MgYW4gZXhjZXB0aW9uIHdoZW4gYWNjZXNzaW5nCgkJCQkJCQkJCS8vIHN0YXR1c1RleHQgZm9yIGZhdWx0eSBjcm9zcy1kb21haW4gcmVxdWVzdHMKCQkJCQkJCQkJdHJ5IHsKCQkJCQkJCQkJCXN0YXR1c1RleHQgPSB4aHIuc3RhdHVzVGV4dDsKCQkJCQkJCQkJfSBjYXRjaCAoIGUgKSB7CgoJCQkJCQkJCQkJLy8gV2Ugbm9ybWFsaXplIHdpdGggV2Via2l0IGdpdmluZyBhbiBlbXB0eSBzdGF0dXNUZXh0CgkJCQkJCQkJCQlzdGF0dXNUZXh0ID0gIiI7CgkJCQkJCQkJCX0KCgkJCQkJCQkJCS8vIEZpbHRlciBzdGF0dXMgZm9yIG5vbiBzdGFuZGFyZCBiZWhhdmlvcnMKCgkJCQkJCQkJCS8vIElmIHRoZSByZXF1ZXN0IGlzIGxvY2FsIGFuZCB3ZSBoYXZlIGRhdGE6IGFzc3VtZSBhIHN1Y2Nlc3MKCQkJCQkJCQkJLy8gKHN1Y2Nlc3Mgd2l0aCBubyBkYXRhIHdvbid0IGdldCBub3RpZmllZCwgdGhhdCdzIHRoZSBiZXN0IHdlCgkJCQkJCQkJCS8vIGNhbiBkbyBnaXZlbiBjdXJyZW50IGltcGxlbWVudGF0aW9ucykKCQkJCQkJCQkJaWYgKCAhc3RhdHVzICYmIG9wdGlvbnMuaXNMb2NhbCAmJiAhb3B0aW9ucy5jcm9zc0RvbWFpbiApIHsKCQkJCQkJCQkJCXN0YXR1cyA9IHJlc3BvbnNlcy50ZXh0ID8gMjAwIDogNDA0OwoKCQkJCQkJCQkJLy8gSUUgLSAjMTQ1MDogc29tZXRpbWVzIHJldHVybnMgMTIyMyB3aGVuIGl0IHNob3VsZCBiZSAyMDQKCQkJCQkJCQkJfSBlbHNlIGlmICggc3RhdHVzID09PSAxMjIzICkgewoJCQkJCQkJCQkJc3RhdHVzID0gMjA0OwoJCQkJCQkJCQl9CgkJCQkJCQkJfQoJCQkJCQkJfQoKCQkJCQkJCS8vIENhbGwgY29tcGxldGUgaWYgbmVlZGVkCgkJCQkJCQlpZiAoIHJlc3BvbnNlcyApIHsKCQkJCQkJCQljb21wbGV0ZSggc3RhdHVzLCBzdGF0dXNUZXh0LCByZXNwb25zZXMsIHhoci5nZXRBbGxSZXNwb25zZUhlYWRlcnMoKSApOwoJCQkJCQkJfQoJCQkJCQl9OwoKCQkJCQkJLy8gRG8gc2VuZCB0aGUgcmVxdWVzdAoJCQkJCQkvLyBgeGhyLnNlbmRgIG1heSByYWlzZSBhbiBleGNlcHRpb24sIGJ1dCBpdCB3aWxsIGJlCgkJCQkJCS8vIGhhbmRsZWQgaW4galF1ZXJ5LmFqYXggKHNvIG5vIHRyeS9jYXRjaCBoZXJlKQoJCQkJCQlpZiAoICFvcHRpb25zLmFzeW5jICkgewoKCQkJCQkJCS8vIElmIHdlJ3JlIGluIHN5bmMgbW9kZSB3ZSBmaXJlIHRoZSBjYWxsYmFjawoJCQkJCQkJY2FsbGJhY2soKTsKCQkJCQkJfSBlbHNlIGlmICggeGhyLnJlYWR5U3RhdGUgPT09IDQgKSB7CgoJCQkJCQkJLy8gKElFNiAmIElFNykgaWYgaXQncyBpbiBjYWNoZSBhbmQgaGFzIGJlZW4KCQkJCQkJCS8vIHJldHJpZXZlZCBkaXJlY3RseSB3ZSBuZWVkIHRvIGZpcmUgdGhlIGNhbGxiYWNrCgkJCQkJCQl3aW5kb3cuc2V0VGltZW91dCggY2FsbGJhY2sgKTsKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkvLyBSZWdpc3RlciB0aGUgY2FsbGJhY2ssIGJ1dCBkZWxheSBpdCBpbiBjYXNlIGB4aHIuc2VuZGAgdGhyb3dzCgkJCQkJCQkvLyBBZGQgdG8gdGhlIGxpc3Qgb2YgYWN0aXZlIHhociBjYWxsYmFja3MKCQkJCQkJCXhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSB4aHJDYWxsYmFja3NbIGlkIF0gPSBjYWxsYmFjazsKCQkJCQkJfQoJCQkJCX0sCgoJCQkJCWFib3J0OiBmdW5jdGlvbigpIHsKCQkJCQkJaWYgKCBjYWxsYmFjayApIHsKCQkJCQkJCWNhbGxiYWNrKCB1bmRlZmluZWQsIHRydWUgKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX07CgkJCX0KCQl9ICk7Cgl9CgoJLy8gRnVuY3Rpb25zIHRvIGNyZWF0ZSB4aHJzCglmdW5jdGlvbiBjcmVhdGVTdGFuZGFyZFhIUigpIHsKCQl0cnkgewoJCQlyZXR1cm4gbmV3IHdpbmRvdy5YTUxIdHRwUmVxdWVzdCgpOwoJCX0gY2F0Y2ggKCBlICkge30KCX0KCglmdW5jdGlvbiBjcmVhdGVBY3RpdmVYSFIoKSB7CgkJdHJ5IHsKCQkJcmV0dXJuIG5ldyB3aW5kb3cuQWN0aXZlWE9iamVjdCggIk1pY3Jvc29mdC5YTUxIVFRQIiApOwoJCX0gY2F0Y2ggKCBlICkge30KCX0KCgoKCgkvLyBJbnN0YWxsIHNjcmlwdCBkYXRhVHlwZQoJalF1ZXJ5LmFqYXhTZXR1cCggewoJCWFjY2VwdHM6IHsKCQkJc2NyaXB0OiAidGV4dC9qYXZhc2NyaXB0LCBhcHBsaWNhdGlvbi9qYXZhc2NyaXB0LCAiICsKCQkJCSJhcHBsaWNhdGlvbi9lY21hc2NyaXB0LCBhcHBsaWNhdGlvbi94LWVjbWFzY3JpcHQiCgkJfSwKCQljb250ZW50czogewoJCQlzY3JpcHQ6IC9cYig/OmphdmF8ZWNtYSlzY3JpcHRcYi8KCQl9LAoJCWNvbnZlcnRlcnM6IHsKCQkJInRleHQgc2NyaXB0IjogZnVuY3Rpb24oIHRleHQgKSB7CgkJCQlqUXVlcnkuZ2xvYmFsRXZhbCggdGV4dCApOwoJCQkJcmV0dXJuIHRleHQ7CgkJCX0KCQl9Cgl9ICk7CgoJLy8gSGFuZGxlIGNhY2hlJ3Mgc3BlY2lhbCBjYXNlIGFuZCBnbG9iYWwKCWpRdWVyeS5hamF4UHJlZmlsdGVyKCAic2NyaXB0IiwgZnVuY3Rpb24oIHMgKSB7CgkJaWYgKCBzLmNhY2hlID09PSB1bmRlZmluZWQgKSB7CgkJCXMuY2FjaGUgPSBmYWxzZTsKCQl9CgkJaWYgKCBzLmNyb3NzRG9tYWluICkgewoJCQlzLnR5cGUgPSAiR0VUIjsKCQkJcy5nbG9iYWwgPSBmYWxzZTsKCQl9Cgl9ICk7CgoJLy8gQmluZCBzY3JpcHQgdGFnIGhhY2sgdHJhbnNwb3J0CglqUXVlcnkuYWpheFRyYW5zcG9ydCggInNjcmlwdCIsIGZ1bmN0aW9uKCBzICkgewoKCQkvLyBUaGlzIHRyYW5zcG9ydCBvbmx5IGRlYWxzIHdpdGggY3Jvc3MgZG9tYWluIHJlcXVlc3RzCgkJaWYgKCBzLmNyb3NzRG9tYWluICkgewoKCQkJdmFyIHNjcmlwdCwKCQkJCWhlYWQgPSBkb2N1bWVudC5oZWFkIHx8IGpRdWVyeSggImhlYWQiIClbIDAgXSB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7CgoJCQlyZXR1cm4gewoKCQkJCXNlbmQ6IGZ1bmN0aW9uKCBfLCBjYWxsYmFjayApIHsKCgkJCQkJc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggInNjcmlwdCIgKTsKCgkJCQkJc2NyaXB0LmFzeW5jID0gdHJ1ZTsKCgkJCQkJaWYgKCBzLnNjcmlwdENoYXJzZXQgKSB7CgkJCQkJCXNjcmlwdC5jaGFyc2V0ID0gcy5zY3JpcHRDaGFyc2V0OwoJCQkJCX0KCgkJCQkJc2NyaXB0LnNyYyA9IHMudXJsOwoKCQkJCQkvLyBBdHRhY2ggaGFuZGxlcnMgZm9yIGFsbCBicm93c2VycwoJCQkJCXNjcmlwdC5vbmxvYWQgPSBzY3JpcHQub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oIF8sIGlzQWJvcnQgKSB7CgoJCQkJCQlpZiAoIGlzQWJvcnQgfHwgIXNjcmlwdC5yZWFkeVN0YXRlIHx8IC9sb2FkZWR8Y29tcGxldGUvLnRlc3QoIHNjcmlwdC5yZWFkeVN0YXRlICkgKSB7CgoJCQkJCQkJLy8gSGFuZGxlIG1lbW9yeSBsZWFrIGluIElFCgkJCQkJCQlzY3JpcHQub25sb2FkID0gc2NyaXB0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IG51bGw7CgoJCQkJCQkJLy8gUmVtb3ZlIHRoZSBzY3JpcHQKCQkJCQkJCWlmICggc2NyaXB0LnBhcmVudE5vZGUgKSB7CgkJCQkJCQkJc2NyaXB0LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoIHNjcmlwdCApOwoJCQkJCQkJfQoKCQkJCQkJCS8vIERlcmVmZXJlbmNlIHRoZSBzY3JpcHQKCQkJCQkJCXNjcmlwdCA9IG51bGw7CgoJCQkJCQkJLy8gQ2FsbGJhY2sgaWYgbm90IGFib3J0CgkJCQkJCQlpZiAoICFpc0Fib3J0ICkgewoJCQkJCQkJCWNhbGxiYWNrKCAyMDAsICJzdWNjZXNzIiApOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfTsKCgkJCQkJLy8gQ2lyY3VtdmVudCBJRTYgYnVncyB3aXRoIGJhc2UgZWxlbWVudHMgKCMyNzA5IGFuZCAjNDM3OCkgYnkgcHJlcGVuZGluZwoJCQkJCS8vIFVzZSBuYXRpdmUgRE9NIG1hbmlwdWxhdGlvbiB0byBhdm9pZCBvdXIgZG9tTWFuaXAgQUpBWCB0cmlja2VyeQoJCQkJCWhlYWQuaW5zZXJ0QmVmb3JlKCBzY3JpcHQsIGhlYWQuZmlyc3RDaGlsZCApOwoJCQkJfSwKCgkJCQlhYm9ydDogZnVuY3Rpb24oKSB7CgkJCQkJaWYgKCBzY3JpcHQgKSB7CgkJCQkJCXNjcmlwdC5vbmxvYWQoIHVuZGVmaW5lZCwgdHJ1ZSApOwoJCQkJCX0KCQkJCX0KCQkJfTsKCQl9Cgl9ICk7CgoKCgoJdmFyIG9sZENhbGxiYWNrcyA9IFtdLAoJCXJqc29ucCA9IC8oPSlcPyg/PSZ8JCl8XD9cPy87CgoJLy8gRGVmYXVsdCBqc29ucCBzZXR0aW5ncwoJalF1ZXJ5LmFqYXhTZXR1cCggewoJCWpzb25wOiAiY2FsbGJhY2siLAoJCWpzb25wQ2FsbGJhY2s6IGZ1bmN0aW9uKCkgewoJCQl2YXIgY2FsbGJhY2sgPSBvbGRDYWxsYmFja3MucG9wKCkgfHwgKCBqUXVlcnkuZXhwYW5kbyArICJfIiArICggbm9uY2UrKyApICk7CgkJCXRoaXNbIGNhbGxiYWNrIF0gPSB0cnVlOwoJCQlyZXR1cm4gY2FsbGJhY2s7CgkJfQoJfSApOwoKCS8vIERldGVjdCwgbm9ybWFsaXplIG9wdGlvbnMgYW5kIGluc3RhbGwgY2FsbGJhY2tzIGZvciBqc29ucCByZXF1ZXN0cwoJalF1ZXJ5LmFqYXhQcmVmaWx0ZXIoICJqc29uIGpzb25wIiwgZnVuY3Rpb24oIHMsIG9yaWdpbmFsU2V0dGluZ3MsIGpxWEhSICkgewoKCQl2YXIgY2FsbGJhY2tOYW1lLCBvdmVyd3JpdHRlbiwgcmVzcG9uc2VDb250YWluZXIsCgkJCWpzb25Qcm9wID0gcy5qc29ucCAhPT0gZmFsc2UgJiYgKCByanNvbnAudGVzdCggcy51cmwgKSA/CgkJCQkidXJsIiA6CgkJCQl0eXBlb2Ygcy5kYXRhID09PSAic3RyaW5nIiAmJgoJCQkJCSggcy5jb250ZW50VHlwZSB8fCAiIiApCgkJCQkJCS5pbmRleE9mKCAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkIiApID09PSAwICYmCgkJCQkJcmpzb25wLnRlc3QoIHMuZGF0YSApICYmICJkYXRhIgoJCQkpOwoKCQkvLyBIYW5kbGUgaWZmIHRoZSBleHBlY3RlZCBkYXRhIHR5cGUgaXMgImpzb25wIiBvciB3ZSBoYXZlIGEgcGFyYW1ldGVyIHRvIHNldAoJCWlmICgganNvblByb3AgfHwgcy5kYXRhVHlwZXNbIDAgXSA9PT0gImpzb25wIiApIHsKCgkJCS8vIEdldCBjYWxsYmFjayBuYW1lLCByZW1lbWJlcmluZyBwcmVleGlzdGluZyB2YWx1ZSBhc3NvY2lhdGVkIHdpdGggaXQKCQkJY2FsbGJhY2tOYW1lID0gcy5qc29ucENhbGxiYWNrID0galF1ZXJ5LmlzRnVuY3Rpb24oIHMuanNvbnBDYWxsYmFjayApID8KCQkJCXMuanNvbnBDYWxsYmFjaygpIDoKCQkJCXMuanNvbnBDYWxsYmFjazsKCgkJCS8vIEluc2VydCBjYWxsYmFjayBpbnRvIHVybCBvciBmb3JtIGRhdGEKCQkJaWYgKCBqc29uUHJvcCApIHsKCQkJCXNbIGpzb25Qcm9wIF0gPSBzWyBqc29uUHJvcCBdLnJlcGxhY2UoIHJqc29ucCwgIiQxIiArIGNhbGxiYWNrTmFtZSApOwoJCQl9IGVsc2UgaWYgKCBzLmpzb25wICE9PSBmYWxzZSApIHsKCQkJCXMudXJsICs9ICggcnF1ZXJ5LnRlc3QoIHMudXJsICkgPyAiJiIgOiAiPyIgKSArIHMuanNvbnAgKyAiPSIgKyBjYWxsYmFja05hbWU7CgkJCX0KCgkJCS8vIFVzZSBkYXRhIGNvbnZlcnRlciB0byByZXRyaWV2ZSBqc29uIGFmdGVyIHNjcmlwdCBleGVjdXRpb24KCQkJcy5jb252ZXJ0ZXJzWyAic2NyaXB0IGpzb24iIF0gPSBmdW5jdGlvbigpIHsKCQkJCWlmICggIXJlc3BvbnNlQ29udGFpbmVyICkgewoJCQkJCWpRdWVyeS5lcnJvciggY2FsbGJhY2tOYW1lICsgIiB3YXMgbm90IGNhbGxlZCIgKTsKCQkJCX0KCQkJCXJldHVybiByZXNwb25zZUNvbnRhaW5lclsgMCBdOwoJCQl9OwoKCQkJLy8gZm9yY2UganNvbiBkYXRhVHlwZQoJCQlzLmRhdGFUeXBlc1sgMCBdID0gImpzb24iOwoKCQkJLy8gSW5zdGFsbCBjYWxsYmFjawoJCQlvdmVyd3JpdHRlbiA9IHdpbmRvd1sgY2FsbGJhY2tOYW1lIF07CgkJCXdpbmRvd1sgY2FsbGJhY2tOYW1lIF0gPSBmdW5jdGlvbigpIHsKCQkJCXJlc3BvbnNlQ29udGFpbmVyID0gYXJndW1lbnRzOwoJCQl9OwoKCQkJLy8gQ2xlYW4tdXAgZnVuY3Rpb24gKGZpcmVzIGFmdGVyIGNvbnZlcnRlcnMpCgkJCWpxWEhSLmFsd2F5cyggZnVuY3Rpb24oKSB7CgoJCQkJLy8gSWYgcHJldmlvdXMgdmFsdWUgZGlkbid0IGV4aXN0IC0gcmVtb3ZlIGl0CgkJCQlpZiAoIG92ZXJ3cml0dGVuID09PSB1bmRlZmluZWQgKSB7CgkJCQkJalF1ZXJ5KCB3aW5kb3cgKS5yZW1vdmVQcm9wKCBjYWxsYmFja05hbWUgKTsKCgkJCQkvLyBPdGhlcndpc2UgcmVzdG9yZSBwcmVleGlzdGluZyB2YWx1ZQoJCQkJfSBlbHNlIHsKCQkJCQl3aW5kb3dbIGNhbGxiYWNrTmFtZSBdID0gb3ZlcndyaXR0ZW47CgkJCQl9CgoJCQkJLy8gU2F2ZSBiYWNrIGFzIGZyZWUKCQkJCWlmICggc1sgY2FsbGJhY2tOYW1lIF0gKSB7CgoJCQkJCS8vIG1ha2Ugc3VyZSB0aGF0IHJlLXVzaW5nIHRoZSBvcHRpb25zIGRvZXNuJ3Qgc2NyZXcgdGhpbmdzIGFyb3VuZAoJCQkJCXMuanNvbnBDYWxsYmFjayA9IG9yaWdpbmFsU2V0dGluZ3MuanNvbnBDYWxsYmFjazsKCgkJCQkJLy8gc2F2ZSB0aGUgY2FsbGJhY2sgbmFtZSBmb3IgZnV0dXJlIHVzZQoJCQkJCW9sZENhbGxiYWNrcy5wdXNoKCBjYWxsYmFja05hbWUgKTsKCQkJCX0KCgkJCQkvLyBDYWxsIGlmIGl0IHdhcyBhIGZ1bmN0aW9uIGFuZCB3ZSBoYXZlIGEgcmVzcG9uc2UKCQkJCWlmICggcmVzcG9uc2VDb250YWluZXIgJiYgalF1ZXJ5LmlzRnVuY3Rpb24oIG92ZXJ3cml0dGVuICkgKSB7CgkJCQkJb3ZlcndyaXR0ZW4oIHJlc3BvbnNlQ29udGFpbmVyWyAwIF0gKTsKCQkJCX0KCgkJCQlyZXNwb25zZUNvbnRhaW5lciA9IG92ZXJ3cml0dGVuID0gdW5kZWZpbmVkOwoJCQl9ICk7CgoJCQkvLyBEZWxlZ2F0ZSB0byBzY3JpcHQKCQkJcmV0dXJuICJzY3JpcHQiOwoJCX0KCX0gKTsKCgoKCgkvLyBkYXRhOiBzdHJpbmcgb2YgaHRtbAoJLy8gY29udGV4dCAob3B0aW9uYWwpOiBJZiBzcGVjaWZpZWQsIHRoZSBmcmFnbWVudCB3aWxsIGJlIGNyZWF0ZWQgaW4gdGhpcyBjb250ZXh0LAoJLy8gZGVmYXVsdHMgdG8gZG9jdW1lbnQKCS8vIGtlZXBTY3JpcHRzIChvcHRpb25hbCk6IElmIHRydWUsIHdpbGwgaW5jbHVkZSBzY3JpcHRzIHBhc3NlZCBpbiB0aGUgaHRtbCBzdHJpbmcKCWpRdWVyeS5wYXJzZUhUTUwgPSBmdW5jdGlvbiggZGF0YSwgY29udGV4dCwga2VlcFNjcmlwdHMgKSB7CgkJaWYgKCAhZGF0YSB8fCB0eXBlb2YgZGF0YSAhPT0gInN0cmluZyIgKSB7CgkJCXJldHVybiBudWxsOwoJCX0KCQlpZiAoIHR5cGVvZiBjb250ZXh0ID09PSAiYm9vbGVhbiIgKSB7CgkJCWtlZXBTY3JpcHRzID0gY29udGV4dDsKCQkJY29udGV4dCA9IGZhbHNlOwoJCX0KCQljb250ZXh0ID0gY29udGV4dCB8fCBkb2N1bWVudDsKCgkJdmFyIHBhcnNlZCA9IHJzaW5nbGVUYWcuZXhlYyggZGF0YSApLAoJCQlzY3JpcHRzID0gIWtlZXBTY3JpcHRzICYmIFtdOwoKCQkvLyBTaW5nbGUgdGFnCgkJaWYgKCBwYXJzZWQgKSB7CgkJCXJldHVybiBbIGNvbnRleHQuY3JlYXRlRWxlbWVudCggcGFyc2VkWyAxIF0gKSBdOwoJCX0KCgkJcGFyc2VkID0gYnVpbGRGcmFnbWVudCggWyBkYXRhIF0sIGNvbnRleHQsIHNjcmlwdHMgKTsKCgkJaWYgKCBzY3JpcHRzICYmIHNjcmlwdHMubGVuZ3RoICkgewoJCQlqUXVlcnkoIHNjcmlwdHMgKS5yZW1vdmUoKTsKCQl9CgoJCXJldHVybiBqUXVlcnkubWVyZ2UoIFtdLCBwYXJzZWQuY2hpbGROb2RlcyApOwoJfTsKCgoJLy8gS2VlcCBhIGNvcHkgb2YgdGhlIG9sZCBsb2FkIG1ldGhvZAoJdmFyIF9sb2FkID0galF1ZXJ5LmZuLmxvYWQ7CgoJLyoqCgkgKiBMb2FkIGEgdXJsIGludG8gYSBwYWdlCgkgKi8KCWpRdWVyeS5mbi5sb2FkID0gZnVuY3Rpb24oIHVybCwgcGFyYW1zLCBjYWxsYmFjayApIHsKCQlpZiAoIHR5cGVvZiB1cmwgIT09ICJzdHJpbmciICYmIF9sb2FkICkgewoJCQlyZXR1cm4gX2xvYWQuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApOwoJCX0KCgkJdmFyIHNlbGVjdG9yLCB0eXBlLCByZXNwb25zZSwKCQkJc2VsZiA9IHRoaXMsCgkJCW9mZiA9IHVybC5pbmRleE9mKCAiICIgKTsKCgkJaWYgKCBvZmYgPiAtMSApIHsKCQkJc2VsZWN0b3IgPSBqUXVlcnkudHJpbSggdXJsLnNsaWNlKCBvZmYsIHVybC5sZW5ndGggKSApOwoJCQl1cmwgPSB1cmwuc2xpY2UoIDAsIG9mZiApOwoJCX0KCgkJLy8gSWYgaXQncyBhIGZ1bmN0aW9uCgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggcGFyYW1zICkgKSB7CgoJCQkvLyBXZSBhc3N1bWUgdGhhdCBpdCdzIHRoZSBjYWxsYmFjawoJCQljYWxsYmFjayA9IHBhcmFtczsKCQkJcGFyYW1zID0gdW5kZWZpbmVkOwoKCQkvLyBPdGhlcndpc2UsIGJ1aWxkIGEgcGFyYW0gc3RyaW5nCgkJfSBlbHNlIGlmICggcGFyYW1zICYmIHR5cGVvZiBwYXJhbXMgPT09ICJvYmplY3QiICkgewoJCQl0eXBlID0gIlBPU1QiOwoJCX0KCgkJLy8gSWYgd2UgaGF2ZSBlbGVtZW50cyB0byBtb2RpZnksIG1ha2UgdGhlIHJlcXVlc3QKCQlpZiAoIHNlbGYubGVuZ3RoID4gMCApIHsKCQkJalF1ZXJ5LmFqYXgoIHsKCQkJCXVybDogdXJsLAoKCQkJCS8vIElmICJ0eXBlIiB2YXJpYWJsZSBpcyB1bmRlZmluZWQsIHRoZW4gIkdFVCIgbWV0aG9kIHdpbGwgYmUgdXNlZC4KCQkJCS8vIE1ha2UgdmFsdWUgb2YgdGhpcyBmaWVsZCBleHBsaWNpdCBzaW5jZQoJCQkJLy8gdXNlciBjYW4gb3ZlcnJpZGUgaXQgdGhyb3VnaCBhamF4U2V0dXAgbWV0aG9kCgkJCQl0eXBlOiB0eXBlIHx8ICJHRVQiLAoJCQkJZGF0YVR5cGU6ICJodG1sIiwKCQkJCWRhdGE6IHBhcmFtcwoJCQl9ICkuZG9uZSggZnVuY3Rpb24oIHJlc3BvbnNlVGV4dCApIHsKCgkJCQkvLyBTYXZlIHJlc3BvbnNlIGZvciB1c2UgaW4gY29tcGxldGUgY2FsbGJhY2sKCQkJCXJlc3BvbnNlID0gYXJndW1lbnRzOwoKCQkJCXNlbGYuaHRtbCggc2VsZWN0b3IgPwoKCQkJCQkvLyBJZiBhIHNlbGVjdG9yIHdhcyBzcGVjaWZpZWQsIGxvY2F0ZSB0aGUgcmlnaHQgZWxlbWVudHMgaW4gYSBkdW1teSBkaXYKCQkJCQkvLyBFeGNsdWRlIHNjcmlwdHMgdG8gYXZvaWQgSUUgJ1Blcm1pc3Npb24gRGVuaWVkJyBlcnJvcnMKCQkJCQlqUXVlcnkoICI8ZGl2PiIgKS5hcHBlbmQoIGpRdWVyeS5wYXJzZUhUTUwoIHJlc3BvbnNlVGV4dCApICkuZmluZCggc2VsZWN0b3IgKSA6CgoJCQkJCS8vIE90aGVyd2lzZSB1c2UgdGhlIGZ1bGwgcmVzdWx0CgkJCQkJcmVzcG9uc2VUZXh0ICk7CgoJCQkvLyBJZiB0aGUgcmVxdWVzdCBzdWNjZWVkcywgdGhpcyBmdW5jdGlvbiBnZXRzICJkYXRhIiwgInN0YXR1cyIsICJqcVhIUiIKCQkJLy8gYnV0IHRoZXkgYXJlIGlnbm9yZWQgYmVjYXVzZSByZXNwb25zZSB3YXMgc2V0IGFib3ZlLgoJCQkvLyBJZiBpdCBmYWlscywgdGhpcyBmdW5jdGlvbiBnZXRzICJqcVhIUiIsICJzdGF0dXMiLCAiZXJyb3IiCgkJCX0gKS5hbHdheXMoIGNhbGxiYWNrICYmIGZ1bmN0aW9uKCBqcVhIUiwgc3RhdHVzICkgewoJCQkJc2VsZi5lYWNoKCBmdW5jdGlvbigpIHsKCQkJCQljYWxsYmFjay5hcHBseSggdGhpcywgcmVzcG9uc2UgfHwgWyBqcVhIUi5yZXNwb25zZVRleHQsIHN0YXR1cywganFYSFIgXSApOwoJCQkJfSApOwoJCQl9ICk7CgkJfQoKCQlyZXR1cm4gdGhpczsKCX07CgoKCgoJLy8gQXR0YWNoIGEgYnVuY2ggb2YgZnVuY3Rpb25zIGZvciBoYW5kbGluZyBjb21tb24gQUpBWCBldmVudHMKCWpRdWVyeS5lYWNoKCBbCgkJImFqYXhTdGFydCIsCgkJImFqYXhTdG9wIiwKCQkiYWpheENvbXBsZXRlIiwKCQkiYWpheEVycm9yIiwKCQkiYWpheFN1Y2Nlc3MiLAoJCSJhamF4U2VuZCIKCV0sIGZ1bmN0aW9uKCBpLCB0eXBlICkgewoJCWpRdWVyeS5mblsgdHlwZSBdID0gZnVuY3Rpb24oIGZuICkgewoJCQlyZXR1cm4gdGhpcy5vbiggdHlwZSwgZm4gKTsKCQl9OwoJfSApOwoKCgoKCWpRdWVyeS5leHByLmZpbHRlcnMuYW5pbWF0ZWQgPSBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4galF1ZXJ5LmdyZXAoIGpRdWVyeS50aW1lcnMsIGZ1bmN0aW9uKCBmbiApIHsKCQkJcmV0dXJuIGVsZW0gPT09IGZuLmVsZW07CgkJfSApLmxlbmd0aDsKCX07CgoKCgoKCS8qKgoJICogR2V0cyBhIHdpbmRvdyBmcm9tIGFuIGVsZW1lbnQKCSAqLwoJZnVuY3Rpb24gZ2V0V2luZG93KCBlbGVtICkgewoJCXJldHVybiBqUXVlcnkuaXNXaW5kb3coIGVsZW0gKSA/CgkJCWVsZW0gOgoJCQllbGVtLm5vZGVUeXBlID09PSA5ID8KCQkJCWVsZW0uZGVmYXVsdFZpZXcgfHwgZWxlbS5wYXJlbnRXaW5kb3cgOgoJCQkJZmFsc2U7Cgl9CgoJalF1ZXJ5Lm9mZnNldCA9IHsKCQlzZXRPZmZzZXQ6IGZ1bmN0aW9uKCBlbGVtLCBvcHRpb25zLCBpICkgewoJCQl2YXIgY3VyUG9zaXRpb24sIGN1ckxlZnQsIGN1ckNTU1RvcCwgY3VyVG9wLCBjdXJPZmZzZXQsIGN1ckNTU0xlZnQsIGNhbGN1bGF0ZVBvc2l0aW9uLAoJCQkJcG9zaXRpb24gPSBqUXVlcnkuY3NzKCBlbGVtLCAicG9zaXRpb24iICksCgkJCQljdXJFbGVtID0galF1ZXJ5KCBlbGVtICksCgkJCQlwcm9wcyA9IHt9OwoKCQkJLy8gc2V0IHBvc2l0aW9uIGZpcnN0LCBpbi1jYXNlIHRvcC9sZWZ0IGFyZSBzZXQgZXZlbiBvbiBzdGF0aWMgZWxlbQoJCQlpZiAoIHBvc2l0aW9uID09PSAic3RhdGljIiApIHsKCQkJCWVsZW0uc3R5bGUucG9zaXRpb24gPSAicmVsYXRpdmUiOwoJCQl9CgoJCQljdXJPZmZzZXQgPSBjdXJFbGVtLm9mZnNldCgpOwoJCQljdXJDU1NUb3AgPSBqUXVlcnkuY3NzKCBlbGVtLCAidG9wIiApOwoJCQljdXJDU1NMZWZ0ID0galF1ZXJ5LmNzcyggZWxlbSwgImxlZnQiICk7CgkJCWNhbGN1bGF0ZVBvc2l0aW9uID0gKCBwb3NpdGlvbiA9PT0gImFic29sdXRlIiB8fCBwb3NpdGlvbiA9PT0gImZpeGVkIiApICYmCgkJCQlqUXVlcnkuaW5BcnJheSggImF1dG8iLCBbIGN1ckNTU1RvcCwgY3VyQ1NTTGVmdCBdICkgPiAtMTsKCgkJCS8vIG5lZWQgdG8gYmUgYWJsZSB0byBjYWxjdWxhdGUgcG9zaXRpb24gaWYgZWl0aGVyIHRvcCBvciBsZWZ0CgkJCS8vIGlzIGF1dG8gYW5kIHBvc2l0aW9uIGlzIGVpdGhlciBhYnNvbHV0ZSBvciBmaXhlZAoJCQlpZiAoIGNhbGN1bGF0ZVBvc2l0aW9uICkgewoJCQkJY3VyUG9zaXRpb24gPSBjdXJFbGVtLnBvc2l0aW9uKCk7CgkJCQljdXJUb3AgPSBjdXJQb3NpdGlvbi50b3A7CgkJCQljdXJMZWZ0ID0gY3VyUG9zaXRpb24ubGVmdDsKCQkJfSBlbHNlIHsKCQkJCWN1clRvcCA9IHBhcnNlRmxvYXQoIGN1ckNTU1RvcCApIHx8IDA7CgkJCQljdXJMZWZ0ID0gcGFyc2VGbG9hdCggY3VyQ1NTTGVmdCApIHx8IDA7CgkJCX0KCgkJCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIG9wdGlvbnMgKSApIHsKCgkJCQkvLyBVc2UgalF1ZXJ5LmV4dGVuZCBoZXJlIHRvIGFsbG93IG1vZGlmaWNhdGlvbiBvZiBjb29yZGluYXRlcyBhcmd1bWVudCAoZ2gtMTg0OCkKCQkJCW9wdGlvbnMgPSBvcHRpb25zLmNhbGwoIGVsZW0sIGksIGpRdWVyeS5leHRlbmQoIHt9LCBjdXJPZmZzZXQgKSApOwoJCQl9CgoJCQlpZiAoIG9wdGlvbnMudG9wICE9IG51bGwgKSB7CgkJCQlwcm9wcy50b3AgPSAoIG9wdGlvbnMudG9wIC0gY3VyT2Zmc2V0LnRvcCApICsgY3VyVG9wOwoJCQl9CgkJCWlmICggb3B0aW9ucy5sZWZ0ICE9IG51bGwgKSB7CgkJCQlwcm9wcy5sZWZ0ID0gKCBvcHRpb25zLmxlZnQgLSBjdXJPZmZzZXQubGVmdCApICsgY3VyTGVmdDsKCQkJfQoKCQkJaWYgKCAidXNpbmciIGluIG9wdGlvbnMgKSB7CgkJCQlvcHRpb25zLnVzaW5nLmNhbGwoIGVsZW0sIHByb3BzICk7CgkJCX0gZWxzZSB7CgkJCQljdXJFbGVtLmNzcyggcHJvcHMgKTsKCQkJfQoJCX0KCX07CgoJalF1ZXJ5LmZuLmV4dGVuZCggewoJCW9mZnNldDogZnVuY3Rpb24oIG9wdGlvbnMgKSB7CgkJCWlmICggYXJndW1lbnRzLmxlbmd0aCApIHsKCQkJCXJldHVybiBvcHRpb25zID09PSB1bmRlZmluZWQgPwoJCQkJCXRoaXMgOgoJCQkJCXRoaXMuZWFjaCggZnVuY3Rpb24oIGkgKSB7CgkJCQkJCWpRdWVyeS5vZmZzZXQuc2V0T2Zmc2V0KCB0aGlzLCBvcHRpb25zLCBpICk7CgkJCQkJfSApOwoJCQl9CgoJCQl2YXIgZG9jRWxlbSwgd2luLAoJCQkJYm94ID0geyB0b3A6IDAsIGxlZnQ6IDAgfSwKCQkJCWVsZW0gPSB0aGlzWyAwIF0sCgkJCQlkb2MgPSBlbGVtICYmIGVsZW0ub3duZXJEb2N1bWVudDsKCgkJCWlmICggIWRvYyApIHsKCQkJCXJldHVybjsKCQkJfQoKCQkJZG9jRWxlbSA9IGRvYy5kb2N1bWVudEVsZW1lbnQ7CgoJCQkvLyBNYWtlIHN1cmUgaXQncyBub3QgYSBkaXNjb25uZWN0ZWQgRE9NIG5vZGUKCQkJaWYgKCAhalF1ZXJ5LmNvbnRhaW5zKCBkb2NFbGVtLCBlbGVtICkgKSB7CgkJCQlyZXR1cm4gYm94OwoJCQl9CgoJCQkvLyBJZiB3ZSBkb24ndCBoYXZlIGdCQ1IsIGp1c3QgdXNlIDAsMCByYXRoZXIgdGhhbiBlcnJvcgoJCQkvLyBCbGFja0JlcnJ5IDUsIGlPUyAzIChvcmlnaW5hbCBpUGhvbmUpCgkJCWlmICggdHlwZW9mIGVsZW0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0ICE9PSAidW5kZWZpbmVkIiApIHsKCQkJCWJveCA9IGVsZW0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CgkJCX0KCQkJd2luID0gZ2V0V2luZG93KCBkb2MgKTsKCQkJcmV0dXJuIHsKCQkJCXRvcDogYm94LnRvcCAgKyAoIHdpbi5wYWdlWU9mZnNldCB8fCBkb2NFbGVtLnNjcm9sbFRvcCApICAtICggZG9jRWxlbS5jbGllbnRUb3AgIHx8IDAgKSwKCQkJCWxlZnQ6IGJveC5sZWZ0ICsgKCB3aW4ucGFnZVhPZmZzZXQgfHwgZG9jRWxlbS5zY3JvbGxMZWZ0ICkgLSAoIGRvY0VsZW0uY2xpZW50TGVmdCB8fCAwICkKCQkJfTsKCQl9LAoKCQlwb3NpdGlvbjogZnVuY3Rpb24oKSB7CgkJCWlmICggIXRoaXNbIDAgXSApIHsKCQkJCXJldHVybjsKCQkJfQoKCQkJdmFyIG9mZnNldFBhcmVudCwgb2Zmc2V0LAoJCQkJcGFyZW50T2Zmc2V0ID0geyB0b3A6IDAsIGxlZnQ6IDAgfSwKCQkJCWVsZW0gPSB0aGlzWyAwIF07CgoJCQkvLyBGaXhlZCBlbGVtZW50cyBhcmUgb2Zmc2V0IGZyb20gd2luZG93IChwYXJlbnRPZmZzZXQgPSB7dG9wOjAsIGxlZnQ6IDB9LAoJCQkvLyBiZWNhdXNlIGl0IGlzIGl0cyBvbmx5IG9mZnNldCBwYXJlbnQKCQkJaWYgKCBqUXVlcnkuY3NzKCBlbGVtLCAicG9zaXRpb24iICkgPT09ICJmaXhlZCIgKSB7CgoJCQkJLy8gd2UgYXNzdW1lIHRoYXQgZ2V0Qm91bmRpbmdDbGllbnRSZWN0IGlzIGF2YWlsYWJsZSB3aGVuIGNvbXB1dGVkIHBvc2l0aW9uIGlzIGZpeGVkCgkJCQlvZmZzZXQgPSBlbGVtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwoJCQl9IGVsc2UgewoKCQkJCS8vIEdldCAqcmVhbCogb2Zmc2V0UGFyZW50CgkJCQlvZmZzZXRQYXJlbnQgPSB0aGlzLm9mZnNldFBhcmVudCgpOwoKCQkJCS8vIEdldCBjb3JyZWN0IG9mZnNldHMKCQkJCW9mZnNldCA9IHRoaXMub2Zmc2V0KCk7CgkJCQlpZiAoICFqUXVlcnkubm9kZU5hbWUoIG9mZnNldFBhcmVudFsgMCBdLCAiaHRtbCIgKSApIHsKCQkJCQlwYXJlbnRPZmZzZXQgPSBvZmZzZXRQYXJlbnQub2Zmc2V0KCk7CgkJCQl9CgoJCQkJLy8gQWRkIG9mZnNldFBhcmVudCBib3JkZXJzCgkJCQlwYXJlbnRPZmZzZXQudG9wICArPSBqUXVlcnkuY3NzKCBvZmZzZXRQYXJlbnRbIDAgXSwgImJvcmRlclRvcFdpZHRoIiwgdHJ1ZSApOwoJCQkJcGFyZW50T2Zmc2V0LmxlZnQgKz0galF1ZXJ5LmNzcyggb2Zmc2V0UGFyZW50WyAwIF0sICJib3JkZXJMZWZ0V2lkdGgiLCB0cnVlICk7CgkJCX0KCgkJCS8vIFN1YnRyYWN0IHBhcmVudCBvZmZzZXRzIGFuZCBlbGVtZW50IG1hcmdpbnMKCQkJLy8gbm90ZTogd2hlbiBhbiBlbGVtZW50IGhhcyBtYXJnaW46IGF1dG8gdGhlIG9mZnNldExlZnQgYW5kIG1hcmdpbkxlZnQKCQkJLy8gYXJlIHRoZSBzYW1lIGluIFNhZmFyaSBjYXVzaW5nIG9mZnNldC5sZWZ0IHRvIGluY29ycmVjdGx5IGJlIDAKCQkJcmV0dXJuIHsKCQkJCXRvcDogIG9mZnNldC50b3AgIC0gcGFyZW50T2Zmc2V0LnRvcCAtIGpRdWVyeS5jc3MoIGVsZW0sICJtYXJnaW5Ub3AiLCB0cnVlICksCgkJCQlsZWZ0OiBvZmZzZXQubGVmdCAtIHBhcmVudE9mZnNldC5sZWZ0IC0galF1ZXJ5LmNzcyggZWxlbSwgIm1hcmdpbkxlZnQiLCB0cnVlICkKCQkJfTsKCQl9LAoKCQlvZmZzZXRQYXJlbnQ6IGZ1bmN0aW9uKCkgewoJCQlyZXR1cm4gdGhpcy5tYXAoIGZ1bmN0aW9uKCkgewoJCQkJdmFyIG9mZnNldFBhcmVudCA9IHRoaXMub2Zmc2V0UGFyZW50OwoKCQkJCXdoaWxlICggb2Zmc2V0UGFyZW50ICYmICggIWpRdWVyeS5ub2RlTmFtZSggb2Zmc2V0UGFyZW50LCAiaHRtbCIgKSAmJgoJCQkJCWpRdWVyeS5jc3MoIG9mZnNldFBhcmVudCwgInBvc2l0aW9uIiApID09PSAic3RhdGljIiApICkgewoJCQkJCW9mZnNldFBhcmVudCA9IG9mZnNldFBhcmVudC5vZmZzZXRQYXJlbnQ7CgkJCQl9CgkJCQlyZXR1cm4gb2Zmc2V0UGFyZW50IHx8IGRvY3VtZW50RWxlbWVudDsKCQkJfSApOwoJCX0KCX0gKTsKCgkvLyBDcmVhdGUgc2Nyb2xsTGVmdCBhbmQgc2Nyb2xsVG9wIG1ldGhvZHMKCWpRdWVyeS5lYWNoKCB7IHNjcm9sbExlZnQ6ICJwYWdlWE9mZnNldCIsIHNjcm9sbFRvcDogInBhZ2VZT2Zmc2V0IiB9LCBmdW5jdGlvbiggbWV0aG9kLCBwcm9wICkgewoJCXZhciB0b3AgPSAvWS8udGVzdCggcHJvcCApOwoKCQlqUXVlcnkuZm5bIG1ldGhvZCBdID0gZnVuY3Rpb24oIHZhbCApIHsKCQkJcmV0dXJuIGFjY2VzcyggdGhpcywgZnVuY3Rpb24oIGVsZW0sIG1ldGhvZCwgdmFsICkgewoJCQkJdmFyIHdpbiA9IGdldFdpbmRvdyggZWxlbSApOwoKCQkJCWlmICggdmFsID09PSB1bmRlZmluZWQgKSB7CgkJCQkJcmV0dXJuIHdpbiA/ICggcHJvcCBpbiB3aW4gKSA/IHdpblsgcHJvcCBdIDoKCQkJCQkJd2luLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudFsgbWV0aG9kIF0gOgoJCQkJCQllbGVtWyBtZXRob2QgXTsKCQkJCX0KCgkJCQlpZiAoIHdpbiApIHsKCQkJCQl3aW4uc2Nyb2xsVG8oCgkJCQkJCSF0b3AgPyB2YWwgOiBqUXVlcnkoIHdpbiApLnNjcm9sbExlZnQoKSwKCQkJCQkJdG9wID8gdmFsIDogalF1ZXJ5KCB3aW4gKS5zY3JvbGxUb3AoKQoJCQkJCSk7CgoJCQkJfSBlbHNlIHsKCQkJCQllbGVtWyBtZXRob2QgXSA9IHZhbDsKCQkJCX0KCQkJfSwgbWV0aG9kLCB2YWwsIGFyZ3VtZW50cy5sZW5ndGgsIG51bGwgKTsKCQl9OwoJfSApOwoKCS8vIFN1cHBvcnQ6IFNhZmFyaTw3LTgrLCBDaHJvbWU8MzctNDQrCgkvLyBBZGQgdGhlIHRvcC9sZWZ0IGNzc0hvb2tzIHVzaW5nIGpRdWVyeS5mbi5wb3NpdGlvbgoJLy8gV2Via2l0IGJ1ZzogaHR0cHM6Ly9idWdzLndlYmtpdC5vcmcvc2hvd19idWcuY2dpP2lkPTI5MDg0CgkvLyBnZXRDb21wdXRlZFN0eWxlIHJldHVybnMgcGVyY2VudCB3aGVuIHNwZWNpZmllZCBmb3IgdG9wL2xlZnQvYm90dG9tL3JpZ2h0CgkvLyByYXRoZXIgdGhhbiBtYWtlIHRoZSBjc3MgbW9kdWxlIGRlcGVuZCBvbiB0aGUgb2Zmc2V0IG1vZHVsZSwgd2UganVzdCBjaGVjayBmb3IgaXQgaGVyZQoJalF1ZXJ5LmVhY2goIFsgInRvcCIsICJsZWZ0IiBdLCBmdW5jdGlvbiggaSwgcHJvcCApIHsKCQlqUXVlcnkuY3NzSG9va3NbIHByb3AgXSA9IGFkZEdldEhvb2tJZiggc3VwcG9ydC5waXhlbFBvc2l0aW9uLAoJCQlmdW5jdGlvbiggZWxlbSwgY29tcHV0ZWQgKSB7CgkJCQlpZiAoIGNvbXB1dGVkICkgewoJCQkJCWNvbXB1dGVkID0gY3VyQ1NTKCBlbGVtLCBwcm9wICk7CgoJCQkJCS8vIGlmIGN1ckNTUyByZXR1cm5zIHBlcmNlbnRhZ2UsIGZhbGxiYWNrIHRvIG9mZnNldAoJCQkJCXJldHVybiBybnVtbm9ucHgudGVzdCggY29tcHV0ZWQgKSA/CgkJCQkJCWpRdWVyeSggZWxlbSApLnBvc2l0aW9uKClbIHByb3AgXSArICJweCIgOgoJCQkJCQljb21wdXRlZDsKCQkJCX0KCQkJfQoJCSk7Cgl9ICk7CgoKCS8vIENyZWF0ZSBpbm5lckhlaWdodCwgaW5uZXJXaWR0aCwgaGVpZ2h0LCB3aWR0aCwgb3V0ZXJIZWlnaHQgYW5kIG91dGVyV2lkdGggbWV0aG9kcwoJalF1ZXJ5LmVhY2goIHsgSGVpZ2h0OiAiaGVpZ2h0IiwgV2lkdGg6ICJ3aWR0aCIgfSwgZnVuY3Rpb24oIG5hbWUsIHR5cGUgKSB7CgkJalF1ZXJ5LmVhY2goIHsgcGFkZGluZzogImlubmVyIiArIG5hbWUsIGNvbnRlbnQ6IHR5cGUsICIiOiAib3V0ZXIiICsgbmFtZSB9LAoJCWZ1bmN0aW9uKCBkZWZhdWx0RXh0cmEsIGZ1bmNOYW1lICkgewoKCQkJLy8gbWFyZ2luIGlzIG9ubHkgZm9yIG91dGVySGVpZ2h0LCBvdXRlcldpZHRoCgkJCWpRdWVyeS5mblsgZnVuY05hbWUgXSA9IGZ1bmN0aW9uKCBtYXJnaW4sIHZhbHVlICkgewoJCQkJdmFyIGNoYWluYWJsZSA9IGFyZ3VtZW50cy5sZW5ndGggJiYgKCBkZWZhdWx0RXh0cmEgfHwgdHlwZW9mIG1hcmdpbiAhPT0gImJvb2xlYW4iICksCgkJCQkJZXh0cmEgPSBkZWZhdWx0RXh0cmEgfHwgKCBtYXJnaW4gPT09IHRydWUgfHwgdmFsdWUgPT09IHRydWUgPyAibWFyZ2luIiA6ICJib3JkZXIiICk7CgoJCQkJcmV0dXJuIGFjY2VzcyggdGhpcywgZnVuY3Rpb24oIGVsZW0sIHR5cGUsIHZhbHVlICkgewoJCQkJCXZhciBkb2M7CgoJCQkJCWlmICggalF1ZXJ5LmlzV2luZG93KCBlbGVtICkgKSB7CgoJCQkJCQkvLyBBcyBvZiA1LzgvMjAxMiB0aGlzIHdpbGwgeWllbGQgaW5jb3JyZWN0IHJlc3VsdHMgZm9yIE1vYmlsZSBTYWZhcmksIGJ1dCB0aGVyZQoJCQkJCQkvLyBpc24ndCBhIHdob2xlIGxvdCB3ZSBjYW4gZG8uIFNlZSBwdWxsIHJlcXVlc3QgYXQgdGhpcyBVUkwgZm9yIGRpc2N1c3Npb246CgkJCQkJCS8vIGh0dHBzOi8vZ2l0aHViLmNvbS9qcXVlcnkvanF1ZXJ5L3B1bGwvNzY0CgkJCQkJCXJldHVybiBlbGVtLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudFsgImNsaWVudCIgKyBuYW1lIF07CgkJCQkJfQoKCQkJCQkvLyBHZXQgZG9jdW1lbnQgd2lkdGggb3IgaGVpZ2h0CgkJCQkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSA5ICkgewoJCQkJCQlkb2MgPSBlbGVtLmRvY3VtZW50RWxlbWVudDsKCgkJCQkJCS8vIEVpdGhlciBzY3JvbGxbV2lkdGgvSGVpZ2h0XSBvciBvZmZzZXRbV2lkdGgvSGVpZ2h0XSBvciBjbGllbnRbV2lkdGgvSGVpZ2h0XSwKCQkJCQkJLy8gd2hpY2hldmVyIGlzIGdyZWF0ZXN0CgkJCQkJCS8vIHVuZm9ydHVuYXRlbHksIHRoaXMgY2F1c2VzIGJ1ZyAjMzgzOCBpbiBJRTYvOCBvbmx5LAoJCQkJCQkvLyBidXQgdGhlcmUgaXMgY3VycmVudGx5IG5vIGdvb2QsIHNtYWxsIHdheSB0byBmaXggaXQuCgkJCQkJCXJldHVybiBNYXRoLm1heCgKCQkJCQkJCWVsZW0uYm9keVsgInNjcm9sbCIgKyBuYW1lIF0sIGRvY1sgInNjcm9sbCIgKyBuYW1lIF0sCgkJCQkJCQllbGVtLmJvZHlbICJvZmZzZXQiICsgbmFtZSBdLCBkb2NbICJvZmZzZXQiICsgbmFtZSBdLAoJCQkJCQkJZG9jWyAiY2xpZW50IiArIG5hbWUgXQoJCQkJCQkpOwoJCQkJCX0KCgkJCQkJcmV0dXJuIHZhbHVlID09PSB1bmRlZmluZWQgPwoKCQkJCQkJLy8gR2V0IHdpZHRoIG9yIGhlaWdodCBvbiB0aGUgZWxlbWVudCwgcmVxdWVzdGluZyBidXQgbm90IGZvcmNpbmcgcGFyc2VGbG9hdAoJCQkJCQlqUXVlcnkuY3NzKCBlbGVtLCB0eXBlLCBleHRyYSApIDoKCgkJCQkJCS8vIFNldCB3aWR0aCBvciBoZWlnaHQgb24gdGhlIGVsZW1lbnQKCQkJCQkJalF1ZXJ5LnN0eWxlKCBlbGVtLCB0eXBlLCB2YWx1ZSwgZXh0cmEgKTsKCQkJCX0sIHR5cGUsIGNoYWluYWJsZSA/IG1hcmdpbiA6IHVuZGVmaW5lZCwgY2hhaW5hYmxlLCBudWxsICk7CgkJCX07CgkJfSApOwoJfSApOwoKCglqUXVlcnkuZm4uZXh0ZW5kKCB7CgoJCWJpbmQ6IGZ1bmN0aW9uKCB0eXBlcywgZGF0YSwgZm4gKSB7CgkJCXJldHVybiB0aGlzLm9uKCB0eXBlcywgbnVsbCwgZGF0YSwgZm4gKTsKCQl9LAoJCXVuYmluZDogZnVuY3Rpb24oIHR5cGVzLCBmbiApIHsKCQkJcmV0dXJuIHRoaXMub2ZmKCB0eXBlcywgbnVsbCwgZm4gKTsKCQl9LAoKCQlkZWxlZ2F0ZTogZnVuY3Rpb24oIHNlbGVjdG9yLCB0eXBlcywgZGF0YSwgZm4gKSB7CgkJCXJldHVybiB0aGlzLm9uKCB0eXBlcywgc2VsZWN0b3IsIGRhdGEsIGZuICk7CgkJfSwKCQl1bmRlbGVnYXRlOiBmdW5jdGlvbiggc2VsZWN0b3IsIHR5cGVzLCBmbiApIHsKCgkJCS8vICggbmFtZXNwYWNlICkgb3IgKCBzZWxlY3RvciwgdHlwZXMgWywgZm5dICkKCQkJcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPT09IDEgPwoJCQkJdGhpcy5vZmYoIHNlbGVjdG9yLCAiKioiICkgOgoJCQkJdGhpcy5vZmYoIHR5cGVzLCBzZWxlY3RvciB8fCAiKioiLCBmbiApOwoJCX0KCX0gKTsKCgkvLyBUaGUgbnVtYmVyIG9mIGVsZW1lbnRzIGNvbnRhaW5lZCBpbiB0aGUgbWF0Y2hlZCBlbGVtZW50IHNldAoJalF1ZXJ5LmZuLnNpemUgPSBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5sZW5ndGg7Cgl9OwoKCWpRdWVyeS5mbi5hbmRTZWxmID0galF1ZXJ5LmZuLmFkZEJhY2s7CgoKCgoJLy8gUmVnaXN0ZXIgYXMgYSBuYW1lZCBBTUQgbW9kdWxlLCBzaW5jZSBqUXVlcnkgY2FuIGJlIGNvbmNhdGVuYXRlZCB3aXRoIG90aGVyCgkvLyBmaWxlcyB0aGF0IG1heSB1c2UgZGVmaW5lLCBidXQgbm90IHZpYSBhIHByb3BlciBjb25jYXRlbmF0aW9uIHNjcmlwdCB0aGF0CgkvLyB1bmRlcnN0YW5kcyBhbm9ueW1vdXMgQU1EIG1vZHVsZXMuIEEgbmFtZWQgQU1EIGlzIHNhZmVzdCBhbmQgbW9zdCByb2J1c3QKCS8vIHdheSB0byByZWdpc3Rlci4gTG93ZXJjYXNlIGpxdWVyeSBpcyB1c2VkIGJlY2F1c2UgQU1EIG1vZHVsZSBuYW1lcyBhcmUKCS8vIGRlcml2ZWQgZnJvbSBmaWxlIG5hbWVzLCBhbmQgalF1ZXJ5IGlzIG5vcm1hbGx5IGRlbGl2ZXJlZCBpbiBhIGxvd2VyY2FzZQoJLy8gZmlsZSBuYW1lLiBEbyB0aGlzIGFmdGVyIGNyZWF0aW5nIHRoZSBnbG9iYWwgc28gdGhhdCBpZiBhbiBBTUQgbW9kdWxlIHdhbnRzCgkvLyB0byBjYWxsIG5vQ29uZmxpY3QgdG8gaGlkZSB0aGlzIHZlcnNpb24gb2YgalF1ZXJ5LCBpdCB3aWxsIHdvcmsuCgoJLy8gTm90ZSB0aGF0IGZvciBtYXhpbXVtIHBvcnRhYmlsaXR5LCBsaWJyYXJpZXMgdGhhdCBhcmUgbm90IGpRdWVyeSBzaG91bGQKCS8vIGRlY2xhcmUgdGhlbXNlbHZlcyBhcyBhbm9ueW1vdXMgbW9kdWxlcywgYW5kIGF2b2lkIHNldHRpbmcgYSBnbG9iYWwgaWYgYW4KCS8vIEFNRCBsb2FkZXIgaXMgcHJlc2VudC4galF1ZXJ5IGlzIGEgc3BlY2lhbCBjYXNlLiBGb3IgbW9yZSBpbmZvcm1hdGlvbiwgc2VlCgkvLyBodHRwczovL2dpdGh1Yi5jb20vanJidXJrZS9yZXF1aXJlanMvd2lraS9VcGRhdGluZy1leGlzdGluZy1saWJyYXJpZXMjd2lraS1hbm9uCgoJaWYgKCB0cnVlICkgewoJCSEoX19XRUJQQUNLX0FNRF9ERUZJTkVfQVJSQVlfXyA9IFtdLCBfX1dFQlBBQ0tfQU1EX0RFRklORV9SRVNVTFRfXyA9IGZ1bmN0aW9uKCkgewoJCQlyZXR1cm4galF1ZXJ5OwoJCX0uYXBwbHkoZXhwb3J0cywgX19XRUJQQUNLX0FNRF9ERUZJTkVfQVJSQVlfXyksIF9fV0VCUEFDS19BTURfREVGSU5FX1JFU1VMVF9fICE9PSB1bmRlZmluZWQgJiYgKG1vZHVsZS5leHBvcnRzID0gX19XRUJQQUNLX0FNRF9ERUZJTkVfUkVTVUxUX18pKTsKCX0KCgoKCXZhcgoKCQkvLyBNYXAgb3ZlciBqUXVlcnkgaW4gY2FzZSBvZiBvdmVyd3JpdGUKCQlfalF1ZXJ5ID0gd2luZG93LmpRdWVyeSwKCgkJLy8gTWFwIG92ZXIgdGhlICQgaW4gY2FzZSBvZiBvdmVyd3JpdGUKCQlfJCA9IHdpbmRvdy4kOwoKCWpRdWVyeS5ub0NvbmZsaWN0ID0gZnVuY3Rpb24oIGRlZXAgKSB7CgkJaWYgKCB3aW5kb3cuJCA9PT0galF1ZXJ5ICkgewoJCQl3aW5kb3cuJCA9IF8kOwoJCX0KCgkJaWYgKCBkZWVwICYmIHdpbmRvdy5qUXVlcnkgPT09IGpRdWVyeSApIHsKCQkJd2luZG93LmpRdWVyeSA9IF9qUXVlcnk7CgkJfQoKCQlyZXR1cm4galF1ZXJ5OwoJfTsKCgkvLyBFeHBvc2UgalF1ZXJ5IGFuZCAkIGlkZW50aWZpZXJzLCBldmVuIGluCgkvLyBBTUQgKCM3MTAyI2NvbW1lbnQ6MTAsIGh0dHBzOi8vZ2l0aHViLmNvbS9qcXVlcnkvanF1ZXJ5L3B1bGwvNTU3KQoJLy8gYW5kIENvbW1vbkpTIGZvciBicm93c2VyIGVtdWxhdG9ycyAoIzEzNTY2KQoJaWYgKCAhbm9HbG9iYWwgKSB7CgkJd2luZG93LmpRdWVyeSA9IHdpbmRvdy4kID0galF1ZXJ5OwoJfQoKCXJldHVybiBqUXVlcnk7Cgl9KSk7CgoKLyoqKi8gfSksCi8qIDQgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKCSJ1c2Ugc3RyaWN0IjsKCglPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CgkgICAgdmFsdWU6IHRydWUKCX0pOwoKCXZhciBfUHJvbWlzZSA9IHR5cGVvZiBQcm9taXNlID09PSAndW5kZWZpbmVkJyA/IF9fd2VicGFja19yZXF1aXJlX18oIShmdW5jdGlvbiB3ZWJwYWNrTWlzc2luZ01vZHVsZSgpIHsgdmFyIGUgPSBuZXcgRXJyb3IoIkNhbm5vdCBmaW5kIG1vZHVsZSBcImVzNi1wcm9taXNlXCIiKTsgZS5jb2RlID0gJ01PRFVMRV9OT1RfRk9VTkQnOyB0aHJvdyBlOyB9KCkpKS5Qcm9taXNlIDogUHJvbWlzZTsKCgl2YXIgU3RvcmFnZSA9IHsKCSAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKCSAgICAgICAgdmFyIF9hcmd1bWVudHMgPSBhcmd1bWVudHM7CgoJICAgICAgICByZXR1cm4gbmV3IF9Qcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CgkgICAgICAgICAgICB2YXIgaXRlbXMgPSBbXS5jb25jYXQoQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoX2FyZ3VtZW50cykpOwoKCSAgICAgICAgICAgIGlmIChpdGVtcy5sZW5ndGggPT0gMSkgewoJICAgICAgICAgICAgICAgIHJlc29sdmUoR01fZ2V0VmFsdWUoaXRlbXNbMF0pKTsKCSAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7fTsKCgkgICAgICAgICAgICAgICAgaXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewoJICAgICAgICAgICAgICAgICAgICBkYXRhW2l0ZW1dID0gR01fZ2V0VmFsdWUoaXRlbSk7CgkgICAgICAgICAgICAgICAgfSk7CgoJICAgICAgICAgICAgICAgIHJlc29sdmUoZGF0YSk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0pOwoJICAgIH0sCgkgICAgc2V0OiBmdW5jdGlvbiBzZXQoa2V5LCB2YWx1ZSkgewoJICAgICAgICBHTV9zZXRWYWx1ZShrZXksIHZhbHVlKTsKCSAgICB9Cgl9OwoKCWV4cG9ydHMuZGVmYXVsdCA9IFN0b3JhZ2U7CgovKioqLyB9KSwKLyogNSAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7CgoJJ3VzZSBzdHJpY3QnOwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKCSAgdmFsdWU6IHRydWUKCX0pOwoJZXhwb3J0cy5pbmplY3QgPSBpbmplY3Q7CglleHBvcnRzLnJlc3RvcmVXaW5kb3dPcGVuID0gcmVzdG9yZVdpbmRvd09wZW47CgkvKioKCSAqIGluamVjdHMgYSBjb2RlIHRvIHRoZSBwYWdlIGNvbnRleHQgdGhhdCBkb2VzIHRoZSBmb2xsb3dpbmc6CgkgKiByZXBsYWNlIHRoZSB3aW5kb3cub3BlbiBmdW5jdGlvbiB3aXRoIGEgZnVuY3Rpb24gdGhhdCBjaGVja3MgaWYgdGhlIHdpbmRvdy5vcGVuIHdhcyBleGVjdXRlZCBkdWUgdG8gYW4gZXZlbnQuCgkgKiBpZiBzbywgdGhlbiBpdCBjaGVja3Mgd2hvIHRyaWdnZXJlZCB0aGUgZXZlbnQuIGlmIGl0J3MgdGhlIGRvY3VtZW50IG9yIHRoZSBib2R5IGVsZW1lbnRzLCB0aGUgY2FsbCBpcyBibG9ja2VkLgoJICogYW5vdGhlciBwcm90ZWN0aW9uLCBpcyBjbG9zaW5nIHdpbmRvd3MgdGhhdCBnb3QgYmx1cmVkIGJ5IGNhbGxpbmcgd2luZG93LmJsdXIoKSwgbGVzcyB0aGVuIGEgc2Vjb25kIGZyb20gaXRzIGNyZWF0aW9uLgoJICogY2hlY2sgb3V0IHRoZSBmb290ZXIgZm9yIGFub3RoZXIgd2F5IHdlYnNpdGVzIHRyeSB0byBvcGVuIGEgbmV3IHdpbmRvdy4KCSAqIEByZXR1cm4gbm90aGluZwoJICovCglmdW5jdGlvbiBpbmplY3QoKSB7CgkgIHZhciBvcmlnaW5hbE9wZW5XbmRGbktleSA9ICJvcmlnaW5hbE9wZW5GdW5jdGlvbiI7CgkgIHZhciBvcmlnaW5hbFdpbmRvd09wZW5GbiA9IHdpbmRvdy5vcGVuOwoJICB2YXIgb3JpZ2luYWxDcmVhdGVFbGVtZW50Rm4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50OwoJICB2YXIgb3JpZ2luYWxBcHBlbmRDaGlsZEZuID0gSFRNTEVsZW1lbnQucHJvdG90eXBlLmFwcGVuZENoaWxkOwoJICB2YXIgb3JpZ2luYWxDcmVhdGVFdmVudEZuID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQ7CgkgIHZhciB3aW5kb3dzV2l0aE5hbWVzID0ge307CgkgIHZhciB0aW1lU2luY2VDcmVhdGVBRWxlbWVudCA9IDA7CgkgIHZhciBsYXN0Q3JlYXRlZEFFbGVtZW50ID0gbnVsbDsKCSAgdmFyIGZ1bGxTY3JlZW5PcGVuVGltZSA9IHZvaWQgMDsKCSAgdmFyIHdpbldpZHRoID0gd2luZG93LmlubmVyV2lkdGg7CgkgIHZhciB3aW5IZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7CgkgIHZhciBhYmQgPSBmYWxzZTsKCSAgdmFyIGxhc3RCbG9ja1RpbWUgPSB2b2lkIDA7CgkgIHZhciBwYXJlbnRPcmlnaW4gPSB3aW5kb3cubG9jYXRpb24gIT0gd2luZG93LnBhcmVudC5sb2NhdGlvbiA/IGRvY3VtZW50LnJlZmVycmVyIHx8IHdpbmRvdy5wYXJlbnQubG9jYXRpb24gfHwgJyonIDogZG9jdW1lbnQubG9jYXRpb247CgkgIHZhciBwYXJlbnRSZWYgPSB3aW5kb3cucGFyZW50OwoKCSAgLy93aW5kb3dbb3JpZ2luYWxPcGVuV25kRm5LZXldID0gd2luZG93Lm9wZW47IC8vIHNhdmUgdGhlIG9yaWdpbmFsIG9wZW4gd2luZG93IGFzIGdsb2JhbCBwYXJhbQoJICBmdW5jdGlvbiBnZXRBYnNvbHV0ZVVSTChiYXNlVVJMKSB7CgkgICAgaWYgKC9eYWJvdXQ6YmxhbmsvaS50ZXN0KGJhc2VVUkwpKSB7CgkgICAgICByZXR1cm4gYmFzZVVSTDsKCSAgICB9CgoJICAgIGlmICgvXihodHRwcz86KT9cL1wvLy50ZXN0KGJhc2VVUkwpKSB7CgkgICAgICByZXR1cm4gYmFzZVVSTDsKCSAgICB9CgoJICAgIGJhc2VVUkwgPSBsb2NhdGlvbi5vcmlnaW4gKyAoIS9eXC8vLnRlc3QoYmFzZVVSTCkgPyAnLycgOiAnJykgKyBiYXNlVVJMOwoKCSAgICByZXR1cm4gYmFzZVVSTDsKCSAgfQoKCSAgZnVuY3Rpb24gbmV3V2luZG93T3BlbkZuKCkgewoJICAgIHZhciBvcGVuV25kQXJndW1lbnRzID0gYXJndW1lbnRzOwoJICAgIHZhciB1c2VPcmlnaW5hbE9wZW5XbmQgPSB0cnVlOwoJICAgIHZhciBnZW5lcmF0ZWRXaW5kb3cgPSBudWxsOwoKCSAgICBmdW5jdGlvbiBnZXRXaW5kb3dOYW1lKG9wZW5XbmRBcmd1bWVudHMpIHsKCSAgICAgIHZhciB3aW5kb3dOYW1lID0gb3BlblduZEFyZ3VtZW50c1sxXTsKCSAgICAgIGlmICh3aW5kb3dOYW1lICE9IG51bGwgJiYgIVsiX2JsYW5rIiwgIl9wYXJlbnQiLCAiX3NlbGYiLCAiX3RvcCJdLmluY2x1ZGVzKHdpbmRvd05hbWUpKSB7CgkgICAgICAgIHJldHVybiB3aW5kb3dOYW1lOwoJICAgICAgfQoKCSAgICAgIHJldHVybiBudWxsOwoJICAgIH0KCgkgICAgZnVuY3Rpb24gY29weU1pc3NpbmdQcm9wZXJ0aWVzKHNyYywgZGVzdCkgewoJICAgICAgdmFyIHByb3AgPSB2b2lkIDA7CgkgICAgICBmb3IgKHByb3AgaW4gc3JjKSB7CgkgICAgICAgIHRyeSB7CgkgICAgICAgICAgaWYgKGRlc3RbcHJvcF0gPT09IHVuZGVmaW5lZCAmJiBzcmNbcHJvcF0pIHsKCSAgICAgICAgICAgIGRlc3RbcHJvcF0gPSBzcmNbcHJvcF07CgkgICAgICAgICAgfQoJICAgICAgICB9IGNhdGNoIChlKSB7fQoJICAgICAgfQoJICAgICAgcmV0dXJuIGRlc3Q7CgkgICAgfQoKCSAgICBmdW5jdGlvbiBpc1BhcmVudFdpbmRvdygpIHsKCSAgICAgIHRyeSB7CgkgICAgICAgIHJldHVybiAhIShwYXJlbnQuV2luZG93ICYmIGNhcHR1cmluZ0VsZW1lbnQgaW5zdGFuY2VvZiBwYXJlbnQuV2luZG93KTsKCSAgICAgIH0gY2F0Y2ggKGUpIHsKCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgfQoJICAgIH0KCgkgICAgZnVuY3Rpb24gaXNPdmVybGF5aXNoKGVsKSB7CgkgICAgICB2YXIgc3R5bGUgPSBlbCAmJiBlbC5zdHlsZTsKCgkgICAgICBpZiAoc3R5bGUgJiYgL2ZpeGVkfGFic29sdXRlLy50ZXN0KHN0eWxlLnBvc2l0aW9uKSAmJiBlbC5vZmZzZXRXaWR0aCA+PSB3aW5XaWR0aCAqIDAuNiAmJiBlbC5vZmZzZXRIZWlnaHQgPj0gd2luSGVpZ2h0ICogMC43NSkgewoJICAgICAgICByZXR1cm4gdHJ1ZTsKCSAgICAgIH0KCgkgICAgICByZXR1cm4gZmFsc2U7CgkgICAgfQoKCSAgICB2YXIgY2FwdHVyaW5nRWxlbWVudCA9IG51bGw7IC8vIHRoZSBlbGVtZW50IHdobyByZWdpc3RlcmVkIHRvIHRoZSBldmVudAoJICAgIHZhciBzcmNFbGVtZW50ID0gbnVsbDsgLy8gdGhlIGNsaWNrZWQgb24gZWxlbWVudAoJICAgIHZhciBjbG9zZXN0UGFyZW50TGluayA9IG51bGw7CgoJICAgIGlmICh3aW5kb3cuZXZlbnQgIT0gbnVsbCkgewoJICAgICAgY2FwdHVyaW5nRWxlbWVudCA9IHdpbmRvdy5ldmVudC5jdXJyZW50VGFyZ2V0OwoJICAgICAgc3JjRWxlbWVudCA9IHdpbmRvdy5ldmVudC5zcmNFbGVtZW50OwoJICAgIH0KCgkgICAgaWYgKHNyY0VsZW1lbnQgIT0gbnVsbCAmJiBzcmNFbGVtZW50IGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpIHsKCSAgICAgIGNsb3Nlc3RQYXJlbnRMaW5rID0gc3JjRWxlbWVudC5jbG9zZXN0KCdhJyk7CgoJICAgICAgaWYgKGNsb3Nlc3RQYXJlbnRMaW5rICYmIGNsb3Nlc3RQYXJlbnRMaW5rLmhyZWYpIHsKCSAgICAgICAgb3BlblduZEFyZ3VtZW50c1szXSA9IGNsb3Nlc3RQYXJlbnRMaW5rLmhyZWY7CgkgICAgICB9CgkgICAgfQoKCSAgICAvL2NhbGxlZSB3aWxsIG5vdCB3b3JrIGluIEVTNiBvciBzdGljdCBtb2RlCgkgICAgdHJ5IHsKCSAgICAgIGlmIChjYXB0dXJpbmdFbGVtZW50ID09IG51bGwpIHsKCSAgICAgICAgdmFyIGNhbGxlciA9IG9wZW5XbmRBcmd1bWVudHMuY2FsbGVlOwoJICAgICAgICB3aGlsZSAoY2FsbGVyLmFyZ3VtZW50cyAhPSBudWxsICYmIGNhbGxlci5hcmd1bWVudHMuY2FsbGVlLmNhbGxlciAhPSBudWxsKSB7CgkgICAgICAgICAgY2FsbGVyID0gY2FsbGVyLmFyZ3VtZW50cy5jYWxsZWUuY2FsbGVyOwoJICAgICAgICB9CgkgICAgICAgIGlmIChjYWxsZXIuYXJndW1lbnRzICE9IG51bGwgJiYgY2FsbGVyLmFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGNhbGxlci5hcmd1bWVudHNbMF0uY3VycmVudFRhcmdldCAhPSBudWxsKSB7CgkgICAgICAgICAgY2FwdHVyaW5nRWxlbWVudCA9IGNhbGxlci5hcmd1bWVudHNbMF0uY3VycmVudFRhcmdldDsKCSAgICAgICAgfQoJICAgICAgfQoJICAgIH0gY2F0Y2ggKGUpIHt9CgoJICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoJICAgIC8vIEJsb2NrZWQgaWYgYSBjbGljayBvbiBiYWNrZ3JvdW5kIGVsZW1lbnQgb2NjdXJyZWQgKDxib2R5PiBvciBkb2N1bWVudCkKCSAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCSAgICBpZiAoY2FwdHVyaW5nRWxlbWVudCA9PSBudWxsKSB7CgkgICAgICB3aW5kb3cucGJyZWFzb24gPSAnQmxvY2tlZCBhIG5ldyB3aW5kb3cgb3BlbmVkIHdpdGhvdXQgYW55IHVzZXIgaW50ZXJhY3Rpb24nOwoJICAgICAgdXNlT3JpZ2luYWxPcGVuV25kID0gZmFsc2U7CgkgICAgfSBlbHNlIGlmIChjYXB0dXJpbmdFbGVtZW50ICE9IG51bGwgJiYgKGNhcHR1cmluZ0VsZW1lbnQgaW5zdGFuY2VvZiBXaW5kb3cgfHwgaXNQYXJlbnRXaW5kb3coY2FwdHVyaW5nRWxlbWVudCkgfHwgY2FwdHVyaW5nRWxlbWVudCA9PT0gZG9jdW1lbnQgfHwgY2FwdHVyaW5nRWxlbWVudC5VUkwgIT0gbnVsbCAmJiBjYXB0dXJpbmdFbGVtZW50LmJvZHkgIT0gbnVsbCB8fCBjYXB0dXJpbmdFbGVtZW50Lm5vZGVOYW1lICE9IG51bGwgJiYgKGNhcHR1cmluZ0VsZW1lbnQubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PSAiYm9keSIgfHwgY2FwdHVyaW5nRWxlbWVudC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09ICJkb2N1bWVudCIpKSkgewoJICAgICAgd2luZG93LnBicmVhc29uID0gJ0Jsb2NrZWQgYSBuZXcgd2luZG93IG9wZW5lZCB3aXRoIFVSTDogJyArIG9wZW5XbmRBcmd1bWVudHNbMF0gKyAnIGJlY2F1c2UgaXQgd2FzIHRyaWdnZXJlZCBieSB0aGUgJyArIGNhcHR1cmluZ0VsZW1lbnQubm9kZU5hbWUgKyAnIGVsZW1lbnQnOwoJICAgICAgdXNlT3JpZ2luYWxPcGVuV25kID0gZmFsc2U7CgkgICAgfSBlbHNlIGlmIChpc092ZXJsYXlpc2goY2FwdHVyaW5nRWxlbWVudCkpIHsKCSAgICAgIHdpbmRvdy5wYnJlYXNvbiA9ICdCbG9ja2VkIGEgbmV3IHdpbmRvdyBvcGVuZWQgd2hlbiBjbGlja2luZyBvbiBhbiBlbGVtZW50IHRoYXQgc2VlbXMgdG8gYmUgYW4gb3ZlcmxheSc7CgkgICAgICB1c2VPcmlnaW5hbE9wZW5XbmQgPSBmYWxzZTsKCSAgICB9IGVsc2UgewoJICAgICAgdXNlT3JpZ2luYWxPcGVuV25kID0gdHJ1ZTsKCSAgICB9CgkgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgoKCSAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCSAgICAvLyBCbG9jayBpZiBhIGZ1bGwgc2NyZWVuIHdhcyBqdXN0IGluaXRpYXRlZCB3aGlsZSBvcGVuaW5nIHRoaXMgdXJsLgoJICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKCSAgICB2YXIgZnVsbFNjcmVlbkVsZW1lbnQgPSBkb2N1bWVudC53ZWJraXRGdWxsc2NyZWVuRWxlbWVudCB8fCBkb2N1bWVudC5tb3pGdWxsc2NyZWVuRWxlbWVudCB8fCBkb2N1bWVudC5mdWxsc2NyZWVuRWxlbWVudDsKCSAgICBpZiAobmV3IERhdGUoKS5nZXRUaW1lKCkgLSBmdWxsU2NyZWVuT3BlblRpbWUgPCAxMDAwIHx8IGlzTmFOKGZ1bGxTY3JlZW5PcGVuVGltZSkgJiYgaXNEb2N1bWVudEluRnVsbFNjcmVlbk1vZGUoKSkgewoKCSAgICAgIHdpbmRvdy5wYnJlYXNvbiA9ICdCbG9ja2VkIGEgbmV3IHdpbmRvdyBvcGVuZWQgd2l0aCBVUkw6ICcgKyBvcGVuV25kQXJndW1lbnRzWzBdICsgJyBiZWNhdXNlIGEgZnVsbCBzY3JlZW4gd2FzIGp1c3QgaW5pdGlhdGVkIHdoaWxlIG9wZW5pbmcgdGhpcyB1cmwuJzsKCgkgICAgICAvKiBKUkEgUkVNT1ZFRAoJICAgICAgIGlmICh3aW5kb3dbc2NyaXB0X3BhcmFtcy5mdWxsU2NyZWVuRm5LZXldKSB7CgkgICAgICAgd2luZG93LmNsZWFyVGltZW91dCh3aW5kb3dbc2NyaXB0X3BhcmFtcy5mdWxsU2NyZWVuRm5LZXldKTsKCSAgICAgICB9CgkgICAgICAgKi8KCgkgICAgICBpZiAoZG9jdW1lbnQuZXhpdEZ1bGxzY3JlZW4pIHsKCSAgICAgICAgZG9jdW1lbnQuZXhpdEZ1bGxzY3JlZW4oKTsKCSAgICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQubW96Q2FuY2VsRnVsbFNjcmVlbikgewoJICAgICAgICBkb2N1bWVudC5tb3pDYW5jZWxGdWxsU2NyZWVuKCk7CgkgICAgICB9IGVsc2UgaWYgKGRvY3VtZW50LndlYmtpdENhbmNlbEZ1bGxTY3JlZW4pIHsKCSAgICAgICAgZG9jdW1lbnQud2Via2l0Q2FuY2VsRnVsbFNjcmVlbigpOwoJICAgICAgfQoKCSAgICAgIHVzZU9yaWdpbmFsT3BlblduZCA9IGZhbHNlOwoJICAgIH0KCSAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCSAgICB2YXIgb3BlblVybCA9IG9wZW5XbmRBcmd1bWVudHNbMF07CgkgICAgdmFyIGluV2hpdGVsaXN0ID0gaXNJbldoaXRlbGlzdChvcGVuVXJsKTsKCgkgICAgaWYgKGluV2hpdGVsaXN0KSB7CgkgICAgICB1c2VPcmlnaW5hbE9wZW5XbmQgPSB0cnVlOwoJICAgIH0gZWxzZSBpZiAoaXNJbkJsYWNrbGlzdChvcGVuVXJsKSkgewoJICAgICAgdXNlT3JpZ2luYWxPcGVuV25kID0gZmFsc2U7CgkgICAgfQoKCSAgICBpZiAodXNlT3JpZ2luYWxPcGVuV25kID09IHRydWUpIHsKCSAgICAgIGdlbmVyYXRlZFdpbmRvdyA9IG9yaWdpbmFsV2luZG93T3BlbkZuLmFwcGx5KHRoaXMsIG9wZW5XbmRBcmd1bWVudHMpOwoJICAgICAgLy8gc2F2ZSB0aGUgd2luZG93IGJ5IG5hbWUsIGZvciBsYXR0ZXIgdXNlLgoJICAgICAgdmFyIHdpbmRvd05hbWUgPSBnZXRXaW5kb3dOYW1lKG9wZW5XbmRBcmd1bWVudHMpOwoJICAgICAgaWYgKHdpbmRvd05hbWUgIT0gbnVsbCkgewoJICAgICAgICB3aW5kb3dzV2l0aE5hbWVzW3dpbmRvd05hbWVdID0gZ2VuZXJhdGVkV2luZG93OwoJICAgICAgfQoKCSAgICAgIC8vIDJuZCBsaW5lIG9mIGRlZmVuY2U6IGFsbG93IHdpbmRvdyB0byBvcGVuIGJ1dCBtb25pdG9yIGNhcmVmdWxseS4uLgoKCSAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoJICAgICAgLy8gS2lsbCB3aW5kb3cgaWYgYSBibHVyIChyZW1vdmUgZm9jdXMpIGlzIGNhbGxlZCB0byB0aGF0IHdpbmRvdwoJICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgkgICAgICBpZiAoZ2VuZXJhdGVkV2luZG93ICE9PSB3aW5kb3cpIHsKCSAgICAgICAgdmFyIG9wZW5UaW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7CgkgICAgICAgIHZhciBvcmlnaW5hbFduZEJsdXJGbiA9IGdlbmVyYXRlZFdpbmRvdy5ibHVyOwoJICAgICAgICBnZW5lcmF0ZWRXaW5kb3cuYmx1ciA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICBpZiAobmV3IERhdGUoKS5nZXRUaW1lKCkgLSBvcGVuVGltZSA8IDEwMDAgJiYgIWluV2hpdGVsaXN0IC8qIG9uZSBzZWNvbmQgKi8pIHsKCSAgICAgICAgICAgICAgd2luZG93LnBicmVhc29uID0gJ0Jsb2NrZWQgYSBuZXcgd2luZG93IG9wZW5lZCB3aXRoIFVSTDogJyArIG9wZW5XbmRBcmd1bWVudHNbMF0gKyAnIGJlY2F1c2UgYSBpdCB3YXMgYmx1cmVkJzsKCSAgICAgICAgICAgICAgZ2VuZXJhdGVkV2luZG93LmNsb3NlKCk7CgkgICAgICAgICAgICAgIGJsb2NrZWRXbmROb3RpZmljYXRpb24ob3BlblduZEFyZ3VtZW50cyk7CgkgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgb3JpZ2luYWxXbmRCbHVyRm4oKTsKCSAgICAgICAgICB9CgkgICAgICAgIH07CgkgICAgICB9CgkgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCSAgICB9IGVsc2UgewoJICAgICAgLy8gKHVzZU9yaWdpbmFsT3BlblduZCA9PSBmYWxzZSkKCSAgICAgIHZhciBfbG9jYXRpb24gPSB7CgkgICAgICAgIGhyZWY6IG9wZW5XbmRBcmd1bWVudHNbMF0KCSAgICAgIH07CgkgICAgICBfbG9jYXRpb24ucmVwbGFjZSA9IGZ1bmN0aW9uICh1cmwpIHsKCSAgICAgICAgX2xvY2F0aW9uLmhyZWYgPSB1cmw7CgkgICAgICB9OwoKCSAgICAgIGdlbmVyYXRlZFdpbmRvdyA9IHsKCSAgICAgICAgY2xvc2U6IGZ1bmN0aW9uIGNsb3NlKCkgewoJICAgICAgICAgIHJldHVybiB0cnVlOwoJICAgICAgICB9LAoJICAgICAgICB0ZXN0OiBmdW5jdGlvbiB0ZXN0KCkgewoJICAgICAgICAgIHJldHVybiB0cnVlOwoJICAgICAgICB9LAoJICAgICAgICBibHVyOiBmdW5jdGlvbiBibHVyKCkgewoJICAgICAgICAgIHJldHVybiB0cnVlOwoJICAgICAgICB9LAoJICAgICAgICBmb2N1czogZnVuY3Rpb24gZm9jdXMoKSB7CgkgICAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgICAgIH0sCgkgICAgICAgIHNob3dNb2RlbGVzc0RpYWxvZzogZnVuY3Rpb24gc2hvd01vZGVsZXNzRGlhbG9nKCkgewoJICAgICAgICAgIHJldHVybiB0cnVlOwoJICAgICAgICB9LAoJICAgICAgICBzaG93TW9kYWxEaWFsb2c6IGZ1bmN0aW9uIHNob3dNb2RhbERpYWxvZygpIHsKCSAgICAgICAgICByZXR1cm4gdHJ1ZTsKCSAgICAgICAgfSwKCSAgICAgICAgcHJvbXB0OiBmdW5jdGlvbiBwcm9tcHQoKSB7CgkgICAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgICAgIH0sCgkgICAgICAgIGNvbmZpcm06IGZ1bmN0aW9uIGNvbmZpcm0oKSB7CgkgICAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgICAgIH0sCgkgICAgICAgIGFsZXJ0OiBmdW5jdGlvbiBhbGVydCgpIHsKCSAgICAgICAgICByZXR1cm4gdHJ1ZTsKCSAgICAgICAgfSwKCSAgICAgICAgbW92ZVRvOiBmdW5jdGlvbiBtb3ZlVG8oKSB7CgkgICAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgICAgIH0sCgkgICAgICAgIG1vdmVCeTogZnVuY3Rpb24gbW92ZUJ5KCkgewoJICAgICAgICAgIHJldHVybiB0cnVlOwoJICAgICAgICB9LAoJICAgICAgICByZXNpemVUbzogZnVuY3Rpb24gcmVzaXplVG8oKSB7CgkgICAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgICAgIH0sCgkgICAgICAgIHJlc2l6ZUJ5OiBmdW5jdGlvbiByZXNpemVCeSgpIHsKCSAgICAgICAgICByZXR1cm4gdHJ1ZTsKCSAgICAgICAgfSwKCSAgICAgICAgc2Nyb2xsQnk6IGZ1bmN0aW9uIHNjcm9sbEJ5KCkgewoJICAgICAgICAgIHJldHVybiB0cnVlOwoJICAgICAgICB9LAoJICAgICAgICBzY3JvbGxUbzogZnVuY3Rpb24gc2Nyb2xsVG8oKSB7CgkgICAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgICAgIH0sCgkgICAgICAgIGdldFNlbGVjdGlvbjogZnVuY3Rpb24gZ2V0U2VsZWN0aW9uKCkgewoJICAgICAgICAgIHJldHVybiB0cnVlOwoJICAgICAgICB9LAoJICAgICAgICBvbnVubG9hZDogZnVuY3Rpb24gb251bmxvYWQoKSB7CgkgICAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgICAgIH0sCgkgICAgICAgIHByaW50OiBmdW5jdGlvbiBwcmludCgpIHsKCSAgICAgICAgICByZXR1cm4gdHJ1ZTsKCSAgICAgICAgfSwKCSAgICAgICAgb3BlbjogZnVuY3Rpb24gb3BlbigpIHsKCSAgICAgICAgICByZXR1cm4gdGhpczsKCSAgICAgICAgfSwKCgkgICAgICAgIG9wZW5lcjogd2luZG93LAoJICAgICAgICBjbG9zZWQ6IGZhbHNlLAoJICAgICAgICBpbm5lckhlaWdodDogNDgwLAoJICAgICAgICBpbm5lcldpZHRoOiA2NDAsCgkgICAgICAgIG5hbWU6IG9wZW5XbmRBcmd1bWVudHNbMV0sCgkgICAgICAgIGxvY2F0aW9uOiBfbG9jYXRpb24sCgkgICAgICAgIGRvY3VtZW50OiB7IGxvY2F0aW9uOiBfbG9jYXRpb24gfQoJICAgICAgfTsKCgkgICAgICBjb3B5TWlzc2luZ1Byb3BlcnRpZXMod2luZG93LCBnZW5lcmF0ZWRXaW5kb3cpOwoKCSAgICAgIGdlbmVyYXRlZFdpbmRvdy53aW5kb3cgPSBnZW5lcmF0ZWRXaW5kb3c7CgoJICAgICAgdmFyIF93aW5kb3dOYW1lID0gZ2V0V2luZG93TmFtZShvcGVuV25kQXJndW1lbnRzKTsKCSAgICAgIGlmIChfd2luZG93TmFtZSAhPSBudWxsKSB7CgkgICAgICAgIHRyeSB7CgkgICAgICAgICAgLy8gb3JpZ2luYWxXaW5kb3dPcGVuRm4oIiIsIHdpbmRvd05hbWUpLmNsb3NlKCk7CgkgICAgICAgICAgd2luZG93c1dpdGhOYW1lc1tfd2luZG93TmFtZV0uY2xvc2UoKTsKCSAgICAgICAgfSBjYXRjaCAoZXJyKSB7fQoJICAgICAgfQoKCSAgICAgIHZhciBmbkdldFVybCA9IGZ1bmN0aW9uIGZuR2V0VXJsKCkgewoJICAgICAgICB2YXIgdXJsID0gdm9pZCAwOwoJICAgICAgICBpZiAoIShnZW5lcmF0ZWRXaW5kb3cubG9jYXRpb24gaW5zdGFuY2VvZiBPYmplY3QpKSB7CgkgICAgICAgICAgdXJsID0gZ2VuZXJhdGVkV2luZG93LmxvY2F0aW9uOwoJICAgICAgICB9IGVsc2UgaWYgKCEoZ2VuZXJhdGVkV2luZG93LmRvY3VtZW50LmxvY2F0aW9uIGluc3RhbmNlb2YgT2JqZWN0KSkgewoJICAgICAgICAgIHVybCA9IGdlbmVyYXRlZFdpbmRvdy5kb2N1bWVudC5sb2NhdGlvbjsKCSAgICAgICAgfSBlbHNlIGlmIChfbG9jYXRpb24uaHJlZiAhPSBudWxsKSB7CgkgICAgICAgICAgdXJsID0gX2xvY2F0aW9uLmhyZWY7CgkgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgdXJsID0gb3BlblduZEFyZ3VtZW50c1swXTsKCSAgICAgICAgfQoJICAgICAgICBvcGVuV25kQXJndW1lbnRzWzBdID0gdXJsOwoKCSAgICAgICAgYmxvY2tlZFduZE5vdGlmaWNhdGlvbihvcGVuV25kQXJndW1lbnRzKTsKCSAgICAgIH07CgoJICAgICAgLy93aHkgc2V0IHRpbWVvdXQ/ICBpZiBhbnlvbmUgZmluZHMgYSByZWFzb24gZm9yIGl0LCBwbGVhc2Ugd3JpdGUgaXQgaGVyZQoJICAgICAgLy9pbiBpZnJhbWVzIGl0IG1ha2VzIHByb2JsZW1zIHNvIGknbSBhdm9pZGluZyBpdCB0aGVyZQoJICAgICAgaWYgKHRvcCA9PSBzZWxmKSB7CgkgICAgICAgIHNldFRpbWVvdXQoZm5HZXRVcmwsIDEwMCk7CgkgICAgICB9IGVsc2UgewoJICAgICAgICBmbkdldFVybCgpOwoJICAgICAgfQoJICAgIH0KCgkgICAgcmV0dXJuIGdlbmVyYXRlZFdpbmRvdzsKCSAgfQoKCSAgZnVuY3Rpb24gcGJXaW5kb3dPcGVuKCkgewoJICAgIHRyeSB7CgkgICAgICByZXR1cm4gbmV3V2luZG93T3BlbkZuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CgkgICAgfSBjYXRjaCAoZXJyKSB7CgkgICAgICByZXR1cm4gbnVsbDsKCSAgICB9CgkgIH0KCgkgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoJICAvLyBSZXBsYWNlIHRoZSB3aW5kb3cgb3BlbiBtZXRob2Qgd2l0aCBQb3BlciBCbG9ja2VyJ3MKCSAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgkgIHdpbmRvdy5vcGVuID0gcGJXaW5kb3dPcGVuOwoJICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCgoJICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgkgIC8vIE1vbml0b3IgZHluYW1pYyBodG1sIGVsZW1lbnQgY3JlYXRpb24gdG8gcHJldmVudCBnZW5lcmF0aW5nIDxhPiBlbGVtZW50cyB3aXRoIGNsaWNrIGRpc3BhdGNoaW5nIGV2ZW50CgkgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCSAgSFRNTEVsZW1lbnQucHJvdG90eXBlLmFwcGVuZENoaWxkID0gZnVuY3Rpb24gKCkgewoJICAgIHZhciBuZXdFbGVtZW50ID0gb3JpZ2luYWxBcHBlbmRDaGlsZEZuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CgoJICAgIGlmIChuZXdFbGVtZW50Lm5vZGVOYW1lID09ICdJRlJBTUUnICYmIG5ld0VsZW1lbnQuY29udGVudFdpbmRvdykgewoJICAgICAgdHJ5IHsKCSAgICAgICAgdmFyIGNvZGUgPSAnKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB2YXIgcGJfYmxhY2tsaXN0ID0gJyArIEpTT04uc3RyaW5naWZ5KHBiX2JsYWNrbGlzdCkgKyAnO1xuICAgICAgICAgIHZhciBwYl93aGl0ZWxpc3QgPSAnICsgSlNPTi5zdHJpbmdpZnkocGJfd2hpdGVsaXN0KSArICc7XG4gICAgICAgICAgJyArIGluamVjdC50b1N0cmluZygpICsgJztcbiAgICAgICAgICBpbmplY3QoKTtcbiAgICAgICAgfSkoKTsnOwoKCSAgICAgICAgdmFyIHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtzLnRleHQgPSBjb2RlOwoKCSAgICAgICAgbmV3RWxlbWVudC5jb250ZW50V2luZG93LmRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQocyk7CgkgICAgICB9IGNhdGNoIChlKSB7fQoJICAgIH0KCgkgICAgcmV0dXJuIG5ld0VsZW1lbnQ7CgkgIH07CgoJICBkb2N1bWVudC5jcmVhdGVFbGVtZW50ID0gZnVuY3Rpb24gKCkgewoKCSAgICB2YXIgbmV3RWxlbWVudCA9IG9yaWdpbmFsQ3JlYXRlRWxlbWVudEZuLmFwcGx5KGRvY3VtZW50LCBhcmd1bWVudHMpOwoKCSAgICBpZiAoYXJndW1lbnRzWzBdID09ICJhIiB8fCBhcmd1bWVudHNbMF0gPT0gIkEiKSB7CgoJICAgICAgdGltZVNpbmNlQ3JlYXRlQUVsZW1lbnQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKCgkgICAgICB2YXIgb3JpZ2luYWxEaXNwYXRjaEV2ZW50Rm4gPSBuZXdFbGVtZW50LmRpc3BhdGNoRXZlbnQ7CgoJICAgICAgbmV3RWxlbWVudC5kaXNwYXRjaEV2ZW50ID0gZnVuY3Rpb24gKGV2ZW50KSB7CgkgICAgICAgIGlmIChldmVudC50eXBlICE9IG51bGwgJiYgKCcnICsgZXZlbnQudHlwZSkudG9Mb2NhbGVMb3dlckNhc2UoKSA9PSAiY2xpY2siKSB7CgkgICAgICAgICAgaWYgKCFpc0luV2hpdGVsaXN0KG5ld0VsZW1lbnQuaHJlZikpIHsKCSAgICAgICAgICAgIHdpbmRvdy5wYnJlYXNvbiA9ICJibG9ja2VkIGR1ZSB0byBhbiBleHBsaWNpdCBkaXNwYXRjaEV2ZW50IGV2ZW50IHdpdGggdHlwZSAnY2xpY2snIG9uIGFuICdhJyB0YWciOwoKCSAgICAgICAgICAgIGJsb2NrZWRXbmROb3RpZmljYXRpb24oeyAiMCI6IG5ld0VsZW1lbnQuaHJlZiB9KTsKCgkgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKCSAgICAgICAgICB9CgkgICAgICAgIH0KCgkgICAgICAgIHJldHVybiBvcmlnaW5hbERpc3BhdGNoRXZlbnRGbi5jYWxsKHRoaXMsIGV2ZW50KTsKCSAgICAgIH07CgoJICAgICAgbGFzdENyZWF0ZWRBRWxlbWVudCA9IG5ld0VsZW1lbnQ7CgkgICAgfQoKCSAgICByZXR1cm4gbmV3RWxlbWVudDsKCSAgfTsKCSAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgoKCSAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgkgIC8vIEJsb2NrIGFydGlmaWNpYWwgbW91c2UgY2xpY2sgb24gZnJhc2hseSBjcmVhdGVkIDxhPiBlbGVtZW50cwoJICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCSAgZG9jdW1lbnQuY3JlYXRlRXZlbnQgPSBmdW5jdGlvbiAoKSB7CgkgICAgdHJ5IHsKCSAgICAgIGlmIChhcmd1bWVudHNbMF0udG9Mb3dlckNhc2UoKS5pbmNsdWRlcygibW91c2UiKSAmJiBuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHRpbWVTaW5jZUNyZWF0ZUFFbGVtZW50IDw9IDUwKSB7CgkgICAgICAgIHZhciBvcGVuVXJsRG9tYWluID0gdm9pZCAwLAoJICAgICAgICAgICAgdG9wVXJsID0gdm9pZCAwLAoJICAgICAgICAgICAgdG9wRG9tYWluID0gdm9pZCAwOwoKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICBvcGVuVXJsRG9tYWluID0gbmV3IFVSTChsYXN0Q3JlYXRlZEFFbGVtZW50LmhyZWYpLmhvc3RuYW1lOwoJICAgICAgICB9IGNhdGNoIChlKSB7fQoKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICB0b3BVcmwgPSB3aW5kb3cubG9jYXRpb24gIT0gd2luZG93LnBhcmVudC5sb2NhdGlvbiA/IGRvY3VtZW50LnJlZmVycmVyIDogZG9jdW1lbnQubG9jYXRpb24uaHJlZjsKCSAgICAgICAgfSBjYXRjaCAoZSkge30KCgkgICAgICAgIHRyeSB7CgkgICAgICAgICAgdG9wRG9tYWluID0gbmV3IFVSTCh0b3BVcmwpLmhvc3RuYW1lOwoJICAgICAgICB9IGNhdGNoIChlKSB7fQoKCSAgICAgICAgLy9ibG9jayBpZiB0aGUgb3JpZ2luIGlzIG5vdCBzYW1lCgkgICAgICAgIHZhciBpc1NlbGZEb21haW4gPSBvcGVuVXJsRG9tYWluID09IHRvcERvbWFpbjsKCgkgICAgICAgIGlmIChsYXN0Q3JlYXRlZEFFbGVtZW50LmhyZWYudHJpbSgpICYmICFpc0luV2hpdGVsaXN0KGxhc3RDcmVhdGVkQUVsZW1lbnQuaHJlZikgJiYgIWlzU2VsZkRvbWFpbikgewoJICAgICAgICAgIC8vdGhpcyBtYWtlcyB0b28gbXVjaCBmYWxzZSBwb3NpdGl2ZSBzbyB3ZSBkbyBub3QgZGlzcGxheSB0aGUgdG9hc3QgbWVzc2FnZQoJICAgICAgICAgIHdpbmRvdy5wYnJlYXNvbiA9ICdCbG9ja2VkIGJlY2F1c2UgXCdhXCcgZWxlbWVudCB3YXMgcmVjZW50bHkgY3JlYXRlZCBhbmQgJyArIGFyZ3VtZW50c1swXSArICcgZXZlbnQgd2FzIGNyZWF0ZWQgc2hvcnRseSBhZnRlcic7CgkgICAgICAgICAgYXJndW1lbnRzWzBdID0gbGFzdENyZWF0ZWRBRWxlbWVudC5ocmVmOwoKCSAgICAgICAgICBibG9ja2VkV25kTm90aWZpY2F0aW9uKHsgIjAiOiBsYXN0Q3JlYXRlZEFFbGVtZW50LmhyZWYgfSk7CgoJICAgICAgICAgIHJldHVybiB7CgkgICAgICAgICAgICB0eXBlOiAnY2xpY2snLAoJICAgICAgICAgICAgaW5pdE1vdXNlRXZlbnQ6IGZ1bmN0aW9uIGluaXRNb3VzZUV2ZW50KCkge30KCSAgICAgICAgICB9OwoJICAgICAgICB9CgkgICAgICB9CgoJICAgICAgcmV0dXJuIG9yaWdpbmFsQ3JlYXRlRXZlbnRGbi5hcHBseShkb2N1bWVudCwgYXJndW1lbnRzKTsKCSAgICB9IGNhdGNoIChlcnIpIHt9CgkgIH07CgkgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKCgkgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoJICAvLyBNb25pdG9yIGZ1bGwgc2NyZWVuIHJlcXVlc3RzCgkgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoJICBmdW5jdGlvbiBvbkZ1bGxTY3JlZW4oaXNJbkZ1bGxTY3JlZW5Nb2RlKSB7CgkgICAgaWYgKGlzSW5GdWxsU2NyZWVuTW9kZSkgewoJICAgICAgZnVsbFNjcmVlbk9wZW5UaW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7CgkgICAgfSBlbHNlIHsKCSAgICAgIGZ1bGxTY3JlZW5PcGVuVGltZSA9IE5hTjsKCSAgICB9CgkgIH0KCgkgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKCSAgZnVuY3Rpb24gaXNEb2N1bWVudEluRnVsbFNjcmVlbk1vZGUoKSB7CgkgICAgLy8gTm90ZSB0aGF0IHRoZSBicm93c2VyIGZ1bGxzY3JlZW4gKHRyaWdnZXJlZCBieSBzaG9ydCBrZXlzKSBtaWdodAoJICAgIC8vIGJlIGNvbnNpZGVyZWQgZGlmZmVyZW50IGZyb20gY29udGVudCBmdWxsc2NyZWVuIHdoZW4gZXhwZWN0aW5nIGEgYm9vbGVhbgoJICAgIHJldHVybiBkb2N1bWVudC5mdWxsU2NyZWVuRWxlbWVudCAmJiBkb2N1bWVudC5mdWxsU2NyZWVuRWxlbWVudCAhPT0gbnVsbCB8fCAvLyBhbHRlcm5hdGl2ZSBzdGFuZGFyZCBtZXRob2RzCgkgICAgZG9jdW1lbnQubW96RnVsbHNjcmVlbkVsZW1lbnQgIT0gbnVsbCB8fCBkb2N1bWVudC53ZWJraXRGdWxsc2NyZWVuRWxlbWVudCAhPSBudWxsOyAvLyBjdXJyZW50IHdvcmtpbmcgbWV0aG9kcwoJICB9CgoJICBmdW5jdGlvbiBpc0luV2hpdGVsaXN0KHVybCkgewoJICAgIHJldHVybiBpc0luTGlzdCh1cmwsIHBiX3doaXRlbGlzdCk7CgkgIH0KCgkgIGZ1bmN0aW9uIGlzSW5CbGFja2xpc3QodXJsKSB7CgkgICAgcmV0dXJuIGlzSW5MaXN0KHVybCwgcGJfYmxhY2tsaXN0KTsKCSAgfQoKCSAgZnVuY3Rpb24gaXNJbkxpc3QodXJsLCBsaXN0KSB7CgkgICAgaWYgKGxpc3QpIHsKCSAgICAgIHJldHVybiBsaXN0LnNvbWUoZnVuY3Rpb24gKGxpKSB7CgkgICAgICAgIHJldHVybiBuZXcgUmVnRXhwKCJodHRwcz86Ly8od3d3XC58LipcLik/IiArIGxpICsgIisiKS50ZXN0KHVybCk7CgkgICAgICB9KTsKCSAgICB9IGVsc2UgewoJICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH0KCSAgfQoKCSAgZnVuY3Rpb24gYmxvY2tlZFduZE5vdGlmaWNhdGlvbihvcGVuV25kQXJndW1lbnRzKSB7CgkgICAgLy90aGlzIGlzIHRvIHByZXZlbnQgYSBzaXRlIHRoYXQgInN0dWNrIiBvbiB0cnlpbmcgdG8gb3BlbiBhIG5ldyB3aW5kb3cgdG8gc2VuZCBlbmRsZXNzIGNhbGxzIHRvIHRoZSBleHRlbnNpb24KCSAgICBpZiAoIWxhc3RCbG9ja1RpbWUgfHwgbGFzdEJsb2NrVGltZSA8IERhdGUubm93KCkgLSAxMDAwKSB7CgkgICAgICBvcGVuV25kQXJndW1lbnRzWyIwIl0gPSBnZXRBYnNvbHV0ZVVSTChvcGVuV25kQXJndW1lbnRzWyIwIl0pOwoJICAgICAgb3BlblduZEFyZ3VtZW50c1siYWJkIl0gPSBhYmQ7CgoJICAgICAgcGFyZW50UmVmLnBvc3RNZXNzYWdlKHsgdHlwZTogImJsb2NrZWRXaW5kb3ciLCBhcmdzOiBKU09OLnN0cmluZ2lmeShvcGVuV25kQXJndW1lbnRzKSB9LCBwYXJlbnRPcmlnaW4pOwoJICAgIH0KCgkgICAgbGFzdEJsb2NrVGltZSA9IERhdGUubm93KCk7CgkgIH0KCgkgIC8vZGV0ZWN0IGFkYmxvY2sgdG8gYWRqdXN0IHBvcHVwIGJsb2NraW5nIGJlaGF2aW9yIHRvIG5vdCBjb2xsaWRlIHdpdGggYWRibG9jawoJICBmdW5jdGlvbiBkZXRlY3RBZGJsb2NrKCkgewoJICAgIHRyeSB7CgkgICAgICB2YXIgdGVzdGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CgkgICAgICB0ZXN0ZXIuaW5uZXJIVE1MID0gJyZuYnNwOyc7CgkgICAgICB0ZXN0ZXIuY2xhc3NOYW1lID0gJ2Fkc2JveCc7CgkgICAgICB0ZXN0ZXIuc3R5bGUuY3NzVGV4dCA9ICJwb3NpdGlvbjphYnNvbHV0ZTt0b3AtMTAwMHB4O2xlZnQ6LTEwMDBweDsiOwoKCSAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGVzdGVyKTsKCgkgICAgICB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CgkgICAgICAgIGlmICh0ZXN0ZXIub2Zmc2V0SGVpZ2h0ID09PSAwKSB7CgkgICAgICAgICAgYWJkID0gdHJ1ZTsKCSAgICAgICAgfQoKCSAgICAgICAgdGVzdGVyLnJlbW92ZSgpOwoJICAgICAgfSwgMTAwKTsKCSAgICB9IGNhdGNoIChlKSB7fQoJICB9CgoJICBmdW5jdGlvbiBleGVjdXRlQ29tbWFuZChjb21tYW5kSWQsIG1lc3NhZ2VJZCkgewoJICAgIGlmIChtZXNzYWdlSWQgPT0gcGJfbWVzc2FnZSkgewoJICAgICAgc3dpdGNoIChjb21tYW5kSWQpIHsKCSAgICAgICAgY2FzZSAwOgoJICAgICAgICAgIC8vb2ZmCgkgICAgICAgICAgd2luZG93Lm9wZW4gPSBvcmlnaW5hbFdpbmRvd09wZW5GbjsKCSAgICAgICAgICBkb2N1bWVudC5jcmVhdGVFbGVtZW50ID0gb3JpZ2luYWxDcmVhdGVFbGVtZW50Rm47CgkgICAgICAgICAgZG9jdW1lbnQuY3JlYXRlRXZlbnQgPSBvcmlnaW5hbENyZWF0ZUV2ZW50Rm47CgkgICAgICAgICAgSFRNTEVsZW1lbnQucHJvdG90eXBlLmFwcGVuZENoaWxkID0gb3JpZ2luYWxBcHBlbmRDaGlsZEZuOwoJICAgICAgICAgIGJyZWFrOwoKCSAgICAgICAgY2FzZSAxOgoJICAgICAgICAgIC8vYWxsb3cgb25jZQoJICAgICAgICAgIGJyZWFrOwoJICAgICAgfQoJICAgIH0KCSAgfQoKCSAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiZnVsbHNjcmVlbmNoYW5nZSIsIGZ1bmN0aW9uICgpIHsKCSAgICBvbkZ1bGxTY3JlZW4oZG9jdW1lbnQuZnVsbHNjcmVlbik7CgkgIH0sIGZhbHNlKTsKCgkgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIm1vemZ1bGxzY3JlZW5jaGFuZ2UiLCBmdW5jdGlvbiAoKSB7CgkgICAgb25GdWxsU2NyZWVuKGRvY3VtZW50Lm1vekZ1bGxTY3JlZW4pOwoJICB9LCBmYWxzZSk7CgoJICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJ3ZWJraXRmdWxsc2NyZWVuY2hhbmdlIiwgZnVuY3Rpb24gKCkgewoJICAgIG9uRnVsbFNjcmVlbihkb2N1bWVudC53ZWJraXRJc0Z1bGxTY3JlZW4pOwoJICB9LCBmYWxzZSk7CgoJICAvL2RvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKSA9PnsKCSAgZGV0ZWN0QWRibG9jaygpOwoJICAvL30sIGZhbHNlKTsKCgkgIChmdW5jdGlvbiAoKSB7CgkgICAgd2luZG93LnBiRXh0ZXJuYWxDb21tYW5kID0gZnVuY3Rpb24gKGNvbW1hbmRJZCwgbWVzc2FnZUlkKSB7CgkgICAgICBleGVjdXRlQ29tbWFuZChjb21tYW5kSWQsIG1lc3NhZ2VJZCk7CgkgICAgfTsKCSAgfSkoKTsKCX0KCglmdW5jdGlvbiByZXN0b3JlV2luZG93T3BlbigpIHsKCSAgd2luZG93Lm9wZW4gPSB3aW5kb3dbIm9yaWdpbmFsT3BlbkZ1bmN0aW9uIl07Cgl9CgoJLyoKCSAoKikgYSBqcXVlcnkgcGx1Z2luIChodHRwczovL2dpdGh1Yi5jb20vaHBidW5pYXQvanF1ZXJ5LXBvcHVuZGVyL2Jsb2IvbWFzdGVyL3NyYy9qcXVlcnkucG9wdW5kZXIuanMpIHwgJC5wb3B1bmRlci5oZWxwZXIub3BlbgoKCSAoKikgYW5vdGhlciBqcXVlcnkgcGx1Z2luIChodHRwczovL2dpdGh1Yi5jb20vdHVraS9qcy1wb3B1bmRlci8pCgoJIFRoZSBmdWxsLXNjcmVlbiB0cmljawoJIC0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKCSAoKikgYW5vdGhlciB3YXkgc2l0ZXMgdHJ5IHRvIG9wZW4gbmV3IHdpbmRvd3MsIGlzIHRvIHB1dCBhIGxpbmsgaW5zaWRlIHRoZSBwYWdlIGFuZCBnZW5lcmF0ZSBhIGNsaWNrIG9uIGl0LgoJIHRoZSBsaW5rIG9wZW5zIGEgbmV3IHRhYiB3aXRoIGEgbmFtZSwgYW5kIHRoZW4gdGhleSB0cnkgdG8gY2FsbCB3aW5kb3cub3BlbiB3aXRoIHRoYXQgbmFtZSBhIGNoYW5nZSB0aGUgdGFiJ3MgdXJsLgoJIGZvciBleGFtcGxlOgoKCSB2YXIgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKCSB2YXIgZSA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCJNb3VzZUV2ZW50cyIpOwoJIHZhciByYW5kID0gTWF0aC5yYW5kb20oKTsKCSBhLnRhcmdldCA9ICJfdGFiIiArIHJhbmQudG9TdHJpbmcoKTsKCSBhLmhyZWYgPSAiYWJvdXQ6YmxhbmsiOwoJIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoYSk7CgkgZS5pbml0TW91c2VFdmVudCgiY2xpY2siLCB0cnVlLCB0cnVlLCB3aW5kb3csIDAsIDAsIDAsIDAsIDAsIHRydWUsIGZhbHNlLCBmYWxzZSwgdHJ1ZSwgMCwgbnVsbCk7CgkgYS5kaXNwYXRjaEV2ZW50KGUpOwoJIHdpbmRvdy5vcGVuKCJhYm91dDpibGFuayIsICJfdGFiIiArIHJhbmQudG9TdHJpbmcoKSkuY2xvc2UoKTsKCgkgKCopIFRoZXkgb3BlbiBmdWxsIHNjcmVlbiBtb2RlIC0+IG9wZW4gYSBwb3B1cCB3aW5kb3cgLT4gZXhpdCBmdWxsIHNjcmVlbiBtb2RlLCB0aHVzIGl0IGdvZXMgYmVuZWF0aCB0aGUgd2luZG93CgoJIFRoZSBjcmVhdGUgZWxlbWVudCAmIGV2ZW50IHRyaWNrCgkgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCgkgKCopIFRoZSB3ZWJzaXRlIHdpbGwgY3JlYXRlIGFuIDxhPiBlbGVtZW50IGFuZCBhbHNvIGEgTW91c2VFdmVudHMgZXZlbnQsIHRoYXQgd2lsbCBhdXRvIGNsaWNrIG9uIGl0LgoJIFRoaXMgd2lsbCBtYWtlIGEgd2luZG93IHRvIG9wZW4gYW5kIHdpdGhvdXQgdGhlIHdpbmRvdy5vcGVuCgoJICgqKSBodHRwOi8vdG9ycmVudHMudG8vCgoJIFBvcC11bmRlciB0ZXN0IHdlYnNpdGVzOgoJIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgoJIGh0dHA6Ly93d3cuYWQ0Z2FtZS5jb20vcG9wdW5kZXIvCgkgaHR0cDovL3Rlc3QuZ2x1ay5uYW1lL3Rlc3QyL3BvcDMvPyMKCSBodHRwOi8vY3BtbmV0d29yay5hZGJvb3RoLmNvbS9lbi9wb3B1bmRlcgoJIGh0dHA6Ly93d3cudmNtdWsuY29tL3BvcHRlc3QuaHRtbAoJIGh0dHA6Ly9hZmZwbGF5Ym9vay5jb20vcG9wdGVzdC9leGl0MS90ZXN0Lmh0bWwKCgkgTm90IGJsb2NrZWQgYnkgQWRCbG9jazoKCgkgaHR0cDovL2RlbW8uZHluYW1pY294eWdlbi5jb20vUG9wLVVuZGVyCgkgaHR0cDovL21pcm9kZXguYmxvZ3Nwb3QuY28uaWwvMjAxMy8xMC93b3JraW5nLXBvcHVuZGVyLXNjcmlwdC1vbi1jaHJvbWUuaHRtbAoJIGh0dHA6Ly93d3cuYWR2ZXJ0c2VydmUuY29tL2V4YW1wbGVzL3BvcHVwcy5odG1sCgkgaHR0cDovL3d3dy5odG1sZ29vZGllcy5jb20vYmV5b25kL2phdmFzY3JpcHQvYXJ0aWNsZS5waHAvMzQ3MTI0MQoJICovCgovKioqLyB9KSwKLyogNiAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoJJ3VzZSBzdHJpY3QnOwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKCSAgdmFsdWU6IHRydWUKCX0pOwoKCXZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpOwoKCXZhciBfc3RvcmFnZSA9IF9fd2VicGFja19yZXF1aXJlX18oNCk7CgoJdmFyIF9zdG9yYWdlMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3N0b3JhZ2UpOwoKCWZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9CgoJZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9CgoJdmFyIF9Qcm9taXNlID0gdHlwZW9mIFByb21pc2UgPT09ICd1bmRlZmluZWQnID8gX193ZWJwYWNrX3JlcXVpcmVfXyghKGZ1bmN0aW9uIHdlYnBhY2tNaXNzaW5nTW9kdWxlKCkgeyB2YXIgZSA9IG5ldyBFcnJvcigiQ2Fubm90IGZpbmQgbW9kdWxlIFwiZXM2LXByb21pc2VcIiIpOyBlLmNvZGUgPSAnTU9EVUxFX05PVF9GT1VORCc7IHRocm93IGU7IH0oKSkpLlByb21pc2UgOiBQcm9taXNlOwoKCXZhciBOdGZTaG93TWFuYWdlciA9IGZ1bmN0aW9uICgpIHsKCSAgZnVuY3Rpb24gTnRmU2hvd01hbmFnZXIoKSB7CgkgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIE50ZlNob3dNYW5hZ2VyKTsKCgkgICAgdGhpcy5pc0FjdGl2ZSA9IHsgcG9wOiB0cnVlLCBvdmVybGF5OiB0cnVlLCB0aXA6IHRydWUgfTsKCSAgfQoKCSAgX2NyZWF0ZUNsYXNzKE50ZlNob3dNYW5hZ2VyLCBbewoJICAgIGtleTogJ2lzU2hvdycsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIGlzU2hvdygpIHsKCSAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgoJICAgICAgdmFyIHByb3BzID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTsKCSAgICAgIHZhciBkb21haW4gPSBwcm9wcy5kb21haW4sCgkgICAgICAgICAgX3Byb3BzJHR5cGUgPSBwcm9wcy50eXBlLAoJICAgICAgICAgIHR5cGUgPSBfcHJvcHMkdHlwZSA9PT0gdW5kZWZpbmVkID8gJ3BvcCcgOiBfcHJvcHMkdHlwZTsKCgkgICAgICByZXR1cm4gbmV3IF9Qcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CgkgICAgICAgIF9zdG9yYWdlMi5kZWZhdWx0LmdldCgncGJfaGlkZU5vdGlmaWNhdGlvbnMnLCAnZG9Ob3RTaG93Tm90aWZ5TGlzdCcsICdwYl9sYXN0Tm90aWZpY2F0aW9uRGlzcGxheScpLnRoZW4oZnVuY3Rpb24gKHNldHRpbmdzKSB7CgkgICAgICAgICAgdmFyIGlzR2xvYmFsSGlkZGVuID0gc2V0dGluZ3MucGJfaGlkZU5vdGlmaWNhdGlvbnMgfHwgZmFsc2U7CgkgICAgICAgICAgdmFyIGhpZGRlblNpdGVzTGlzdCA9IHNldHRpbmdzLmRvTm90U2hvd05vdGlmeUxpc3QgfHwgW107CgkgICAgICAgICAgdmFyIGxhc3REaXNwbGF5ID0gc2V0dGluZ3MucGJfbGFzdE5vdGlmaWNhdGlvbkRpc3BsYXkgfHwge307CgoJICAgICAgICAgIGlmIChfdGhpcy5pc0FjdGl2ZVt0eXBlXSAmJiBfdGhpcy5jaGVja0xhc3REaXNwbGF5KHsgZG9tYWluOiBkb21haW4sIHR5cGU6IHR5cGUsIGxhc3REaXNwbGF5OiBsYXN0RGlzcGxheSB9KSAmJiAhaXNHbG9iYWxIaWRkZW4gJiYgIV90aGlzLmNoZWNrSXNIaWRkZW4oeyBoaWRkZW5TaXRlc0xpc3Q6IGhpZGRlblNpdGVzTGlzdCwgZG9tYWluOiBkb21haW4gfSkpIHsKCSAgICAgICAgICAgIF90aGlzLmlzQWN0aXZlW3R5cGVdID0gZmFsc2U7CgoJICAgICAgICAgICAgX3RoaXMudXBkYXRlTGFzdERpc3BsYXkoeyBkb21haW46IGRvbWFpbiwgdHlwZTogdHlwZSB9KTsKCSAgICAgICAgICAgIHJlc29sdmUoKTsKCSAgICAgICAgICB9CgkgICAgICAgIH0pOwoJICAgICAgfSk7CgkgICAgfQoKCSAgICAvL2NoZWNrIGlmIHVzZXIgYWRkZWQgdGhpcyBzaXRlIHRvIGRvbid0IHNob3cgYWdhaW4gZm9yIDMwIGRheXMKCgkgIH0sIHsKCSAgICBrZXk6ICdjaGVja0lzSGlkZGVuJywKCSAgICB2YWx1ZTogZnVuY3Rpb24gY2hlY2tJc0hpZGRlbihfcmVmKSB7CgkgICAgICB2YXIgaGlkZGVuU2l0ZXNMaXN0ID0gX3JlZi5oaWRkZW5TaXRlc0xpc3QsCgkgICAgICAgICAgZG9tYWluID0gX3JlZi5kb21haW47CgoJICAgICAgdmFyIGl0ZW0gPSBoaWRkZW5TaXRlc0xpc3QuZmluZChmdW5jdGlvbiAoaXRlbSkgewoJICAgICAgICByZXR1cm4gaXRlbS5kb21haW4gPT0gZG9tYWluOwoJICAgICAgfSk7CgoJICAgICAgaWYgKGl0ZW0gJiYgaXRlbS50aW1lKSB7CgkgICAgICAgIHZhciB0aW1lID0gbmV3IERhdGUoaXRlbS50aW1lKTsKCSAgICAgICAgdmFyIHRpbWUzMGRheXMgPSBuZXcgRGF0ZSh0aW1lLnNldERhdGUodGltZS5nZXREYXRlKCkgKyAzMCkpOwoJICAgICAgICB2YXIgbm93ID0gbmV3IERhdGUoKTsKCgkgICAgICAgIGlmIChub3cgPD0gdGltZTMwZGF5cykgewoJICAgICAgICAgIHJldHVybiB0cnVlOwoJICAgICAgICB9CgkgICAgICB9CgoJICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH0KCgkgICAgLy9vdmVybGF5IG5vdGlmaWNhdGlvbiBuZWVkcyB0byBiZSBzaG93biBvbmx5IG9uY2UgaW4gMjQgaG91cnMKCSAgICAvL292ZXJsYXkgdGlwIG5vdGlmaWNhdGlvbiBuZWVkcyB0byBiZSBzaG93biBvbmNlIGEgbW9udGgKCgkgIH0sIHsKCSAgICBrZXk6ICdjaGVja0xhc3REaXNwbGF5JywKCSAgICB2YWx1ZTogZnVuY3Rpb24gY2hlY2tMYXN0RGlzcGxheShfcmVmMikgewoJICAgICAgdmFyIGRvbWFpbiA9IF9yZWYyLmRvbWFpbiwKCSAgICAgICAgICB0eXBlID0gX3JlZjIudHlwZSwKCSAgICAgICAgICBsYXN0RGlzcGxheSA9IF9yZWYyLmxhc3REaXNwbGF5OwoKCSAgICAgIHZhciBub3cgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKCSAgICAgIHZhciBsYXN0ID0gbGFzdERpc3BsYXlbdHlwZV07CgoJICAgICAgaWYgKCFsYXN0KSB7CgkgICAgICAgIHJldHVybiB0cnVlOwoJICAgICAgfQoKCSAgICAgIHN3aXRjaCAodHlwZSkgewoJICAgICAgICBjYXNlICdvdmVybGF5JzoKCSAgICAgICAgICBsYXN0ID0gbGFzdFtkb21haW5dOwoKCSAgICAgICAgICBpZiAobGFzdCAmJiBsYXN0ICsgMTAwMCAqIDYwICogNjAgKiAyNCA+IG5vdykgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICAgIH0KCSAgICAgICAgICBicmVhazsKCgkgICAgICAgIGNhc2UgJ3RpcCc6CgkgICAgICAgICAgaWYgKGxhc3QgKyAxMDAwICogNjAgKiA2MCAqIDI0ICogMzAgPiBub3cpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgICB9CgkgICAgICAgICAgYnJlYWs7CgkgICAgICB9CgoJICAgICAgcmV0dXJuIHRydWU7CgkgICAgfQoJICB9LCB7CgkgICAga2V5OiAndXBkYXRlTGFzdERpc3BsYXknLAoJICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVMYXN0RGlzcGxheShfcmVmMykgewoJICAgICAgdmFyIGRvbWFpbiA9IF9yZWYzLmRvbWFpbiwKCSAgICAgICAgICB0eXBlID0gX3JlZjMudHlwZTsKCgkgICAgICBfc3RvcmFnZTIuZGVmYXVsdC5nZXQoJ3BiX2xhc3ROb3RpZmljYXRpb25EaXNwbGF5JykudGhlbihmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBkaXNwbGF5ID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTsKCgkgICAgICAgIHN3aXRjaCAodHlwZSkgewoJICAgICAgICAgIGNhc2UgJ292ZXJsYXknOgoJICAgICAgICAgICAgZGlzcGxheVt0eXBlXSA9IGRpc3BsYXlbdHlwZV0gfHwge307CgkgICAgICAgICAgICBkaXNwbGF5W3R5cGVdW2RvbWFpbl0gPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKCSAgICAgICAgICAgIGJyZWFrOwoKCSAgICAgICAgICBkZWZhdWx0OgoJICAgICAgICAgICAgZGlzcGxheVt0eXBlXSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwoJICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgIH0KCgkgICAgICAgIF9zdG9yYWdlMi5kZWZhdWx0LnNldCgncGJfbGFzdE5vdGlmaWNhdGlvbkRpc3BsYXknLCBkaXNwbGF5KTsKCSAgICAgIH0pOwoJICAgIH0KCSAgfSwgewoJICAgIGtleTogJ3VwZGF0ZURvbnRTaG93JywKCSAgICB2YWx1ZTogZnVuY3Rpb24gdXBkYXRlRG9udFNob3coX3JlZjQpIHsKCSAgICAgIHZhciBkb21haW4gPSBfcmVmNC5kb21haW47CgoJICAgICAgUEJTdG9yYWdlU3luYy5kb05vdFNob3dOb3RpZnlMaXN0LnVwZGF0ZShmdW5jdGlvbiAoZG9Ob3RTaG93TGlzdCkgewoJICAgICAgICBkb05vdFNob3dMaXN0ID0gZG9Ob3RTaG93TGlzdC5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHsKCSAgICAgICAgICByZXR1cm4gaXRlbS5kb21haW4gIT0gZG9tYWluOwoJICAgICAgICB9KTsKCSAgICAgICAgZG9Ob3RTaG93TGlzdC5wdXNoKHsKCSAgICAgICAgICBkb21haW46IGRvbWFpbiwKCSAgICAgICAgICB0aW1lOiBuZXcgRGF0ZSgpLmdldFRpbWUoKQoJICAgICAgICB9KTsKCgkgICAgICAgIHJldHVybiBkb05vdFNob3dMaXN0OwoJICAgICAgfSk7CgkgICAgfQoJICB9XSk7CgoJICByZXR1cm4gTnRmU2hvd01hbmFnZXI7Cgl9KCk7CgoJZXhwb3J0cy5kZWZhdWx0ID0gTnRmU2hvd01hbmFnZXI7CgovKioqLyB9KSwKLyogNyAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoJJ3VzZSBzdHJpY3QnOwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKCSAgdmFsdWU6IHRydWUKCX0pOwoKCXZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpOwoKCXZhciBfalF1ZXJ5ID0gX193ZWJwYWNrX3JlcXVpcmVfXygzKTsKCgl2YXIgX2pRdWVyeTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9qUXVlcnkpOwoKCXZhciBfc3RvcmFnZSA9IF9fd2VicGFja19yZXF1aXJlX18oNCk7CgoJdmFyIF9zdG9yYWdlMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3N0b3JhZ2UpOwoKCXZhciBfdXRpbHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDgpOwoKCWZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9CgoJZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9CgoJdmFyIE5vdGlmaWNhdGlvbiA9IGZ1bmN0aW9uICgpIHsKCSAgZnVuY3Rpb24gTm90aWZpY2F0aW9uKCkgewoJICAgIHZhciBfdGhpcyA9IHRoaXM7CgoJICAgIHZhciBwcm9wcyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307CgoJICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBOb3RpZmljYXRpb24pOwoKCSAgICB0aGlzLnF1ZXVlID0gW107CgkgICAgdGhpcy5wcm9wcyA9IHByb3BzOwoJICAgIHRoaXMubm90aWZpY2F0aW9uSFRNTCA9ICI8aHRtbD5cclxuCTxoZWFkPlxyXG4JCTxzdHlsZSB0eXBlPVwidGV4dC9jc3NcIj5cclxuCQkqIHtcclxuCQkJYm94LXNpemluZzogYm9yZGVyLWJveDtcclxuCQkJZm9udC1mYW1pbHk6IFwiQXJpYWxcIiwgXCJzYW5zLXNlcmlmXCI7XHJcbgkJfVxyXG5cclxuCQlodG1sLCBib2R5IHtcclxuCQkJbWFyZ2luOiAwcHg7XHJcbgkJCXBhZGRpbmc6IDBweDtcclxuCQkJb3ZlcmZsb3c6IGhpZGRlbjsgXHJcbgkJCWNvbG9yOiAjMDAwO1xyXG4JCX1cclxuXHJcbgkJLmhpZGRlbiB7XHJcbgkJCWRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDtcclxuCQl9XHJcblxyXG4JCS5tZXNzYWdlIHtcclxuCQkJZGlzcGxheTogZmxleDtcclxuCQkJYWxpZ24taXRlbXM6IGNlbnRlcjtcclxuCQkJanVzdGlmeS1jb250ZW50OiBjZW50ZXI7XHJcbgkJCXdpZHRoOiAxMDAlO1xyXG4JCQloZWlnaHQ6IDEwMCU7XHJcbgkJCWJhY2tncm91bmQ6ICNmMmYyZjI7XHJcbgkJfVxyXG5cclxuCQkvKiBpY29uICovXHJcbgkJLm1lc3NhZ2UtaWNvbiB7XHJcbgkJCWhlaWdodDogMTZweDtcclxuCQkJbWluLXdpZHRoOiAxNXB4O1xyXG4JCQliYWNrZ3JvdW5kOiB1cmwoXCdkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQUE4QUFBQVFDQVlBQUFHK1VSV1NBQUFBQVhOU1IwSUFyczRjNlFBQUFibEpSRUZVS0JWOVV6Rkx3MUFRenIzV0p1bmdVTENMVHFLTDdlaFNkSFhXVFp4RVZIUlFRWEJ3OGk4SUlrcFJGOEhCVFZlZEhQUVh0Q29JTHU2Q0JVMGl6WHQrOTlLTEVVTWZKSGYzdnUvdTNYMHZjUnlzbHVlOUtYWWNZMGFzdGEvSGNubXU1YnFHT0dxWHk3TW1qcStvVUppekc0ejhjbnRlMjNYSDJFMVNYUGNLbEZrRTE3WThCNUtpUU4yUUlFMWg1OG4zRzhhWUpXM01Lc2YxS0tLWFNtVXc2UkFibXFnS1FwVkJYdHphOStmbk9UMTYzakt5VG9ub0ZvU1pCRTdldG9tSk1EempjZzdSVFJhMHZsSVh0bTBCVUczRktaWHVPSjdvZEY0S0F0akppUUxTdXFPNzNidk5VdWsyYlk1Sm1ET1ZKdGI2L2c4b1ZjVGEyY2JmM3p0NWdoSlUwbUJHcU9kSmhsamJiVjRXRTlKUjhnZ3BLS1hZUHZ2KzFJRG50Y0lnYUVLOWVhWFVBdXdCWTdVd1RPVXU4a1oyc2Y1ZGZCcngxOWMxbEEwRlEvSVErM3loa09GQkVaMzBsU0tybXhUaHkyWWZ4YXIvVGhZU1RwM0VUREdyRHVKV3VxLzFqdmpGdHU4Zk9WcXZHNkpMdExFTGdIb0p3MEpDY2lQalQ0dHZCY05kckdIakdFbTVBZ281YTBGTXZ2MWFGRFh4UUZTMW5TWDA4OUhwUis1SitHRVhrYmlIWVVmL0ZTQjZoUjZIOVNEWS93R2t1NjdIc0ZmMXlRQUFBQUJKUlU1RXJrSmdnZz09XCcpO1xyXG4gICAgICBtYXJnaW4tcmlnaHQ6IDEycHg7XHJcbiAgICB9XHJcblxyXG4JCS8qIHRleHQgKi9cclxuCQkubWVzc2FnZS10aXRsZSB7XHJcbgkJCWZvbnQtZmFtaWx5OiBBcmlhbDtcclxuCQkJZm9udC1zaXplOiAxNnB4O1xyXG4JCQlmb250LXdlaWdodDogYm9sZDtcclxuICAgICAgY29sb3I6ICNkNDA3MDc7XHJcbiAgICAgIG1hcmdpbi1yaWdodDogOHB4O1xyXG4JCX1cclxuXHJcbgkJLyogY2xvc2UgKi9cclxuCQkubWVzc2FnZS1jbG9zZSB7XHJcbgkJCXBvc2l0aW9uOiBhYnNvbHV0ZTtcclxuCQkJdG9wOiAxMnB4O1xyXG4JCQlyaWdodDogMTJweDtcclxuCQkJd2lkdGg6IDE2cHg7XHJcbgkJCWhlaWdodDogMTZweDtcclxuCQkJYmFja2dyb3VuZDogdXJsKFwnZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFCQUFBQUFRQ0FZQUFBQWY4LzloQUFBQUFYTlNSMElBcnM0YzZRQUFBWGxKUkVGVU9CR3RVMHRLQTBFUXJXb1RCNHdtaWlidVBJQ0N3UU9JNGtMd0htNUVWeDdFbGNHTjl4QmNpT0lCSkVJOGdEc3pTc3hQR0JPbjdWZVRna0pIVUxCaHBtdGUxYXYvTUgwNUwvMWtMVTFIKzVUU3JpZGVnWnJKUDVLalMrZUs1NHR6VWN0U1dEKzg5OVB4NjlzSk14MEUyU2x1YjJaT3ZhZXo2dnpNY1pEZm9STUhJRDkzaHhkQnVXTUpQOGtoeU5WU3BiUUhKeElKa1MxNVBCcDk0MW9NdHVEQWlLWG1qL0c5cHQxczNsSDgxS2JOclcyS29rZ2NKVWxDdHpmWFZGMnVVYjIrSVJqS2NWT0ZkWWVHS1JsUlFPNzF1a0lBVWNuQW9OTk13QUdYNDg2ZzVZbFd4VzE0V1VLNVhCRVlaTWcyS3loQ0F4KzQzUm4yaWZ5c1dFNWUxZ21nUEhKbXlvUGNjVTM4L09weXNpVEcxRVpIWkR5Mko4WlVGc3hod3hSRWc5QnRXelBxdGs2MGljS1I3UXpyaVpFQUtCU0xNaXBiTTBhcFRqQkcyT0RJR01IRlIyamthV2prSVdRY1JGSERETW5EdUZGYktCMzl6eXBqcDdIYkliR0dscU9SN1ozcHVLSC9BWFNTZ1RYNjYrLzhDVEliN3phUTNhWjRBQUFBQUVsRlRrU3VRbUNDXCcpIG5vLXJlcGVhdDtcclxuCQkJb2JqZWN0LWZpdDogY29udGFpbjtcclxuCQkJY3Vyc29yOiBwb2ludGVyO1xyXG4JCX1cclxuXHJcbgkJLyogYnV0dG9ucyAqL1xyXG4JCS5tZXNzYWdlLWJ1dHRvbnMge1xyXG4JCQlkaXNwbGF5OiBmbGV4O1xyXG4JCX1cclxuXHJcbgkJCS5tZXNzYWdlLWJ1dHRvbnMgPiBkaXYge1xyXG4gICAgICAgIGhlaWdodDogMjhweDtcclxuCQkJCWN1cnNvcjogcG9pbnRlcjtcclxuCQkJCWZvbnQtc2l6ZTogMTRweDtcclxuCQkJCWJhY2tncm91bmQtY29sb3I6ICNkZWRlZGU7XHJcbiAgICAgICAgYm94LXNoYWRvdzogMCAxcHggMCAwIHJnYmEoMjU1LCAyNTUsIDI1NSwgMC41KTtcclxuICAgICAgICBib3JkZXI6IHNvbGlkIDFweCAjYjZiNGI2O1xyXG4gICAgICAgIGJvcmRlci1yYWRpdXM6IDRweDtcclxuICAgICAgICBjb2xvcjogIzVhNWE1YTtcclxuICAgICAgICBwYWRkaW5nOiAwIDE1cHg7XHJcbiAgICAgICAgbWFyZ2luOiAwIDhweDtcclxuICAgICAgICBsaW5lLWhlaWdodDogMjVweDtcclxuCQkJfVxyXG5cclxuCQkJLm1lc3NhZ2UtYnV0dG9ucyA+IGRpdjpob3ZlciB7XHJcbgkJCQliYWNrZ3JvdW5kLWNvbG9yOiAjZWZmM2Y4O1xyXG4JCQl9XHJcbgkJPC9zdHlsZT5cclxuCQlcclxuICAgIDxzY3JpcHQ+XHJcbiAgICAgIC8qKioqKiovIChmdW5jdGlvbihtb2R1bGVzKSB7IC8vIHdlYnBhY2tCb290c3RyYXBcbi8qKioqKiovIAkvLyBUaGUgbW9kdWxlIGNhY2hlXG4vKioqKioqLyAJdmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuLyoqKioqKi8gCS8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4vKioqKioqLyAJZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4vKioqKioqLyAJCS8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuLyoqKioqKi8gCQlpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSlcbi8qKioqKiovIAkJCXJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuXG4vKioqKioqLyAJCS8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4vKioqKioqLyAJCXZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbi8qKioqKiovIAkJCWV4cG9ydHM6IHt9LFxuLyoqKioqKi8gCQkJaWQ6IG1vZHVsZUlkLFxuLyoqKioqKi8gCQkJbG9hZGVkOiBmYWxzZVxuLyoqKioqKi8gCQl9O1xuXG4vKioqKioqLyAJCS8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuLyoqKioqKi8gCQltb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuLyoqKioqKi8gCQkvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4vKioqKioqLyAJCW1vZHVsZS5sb2FkZWQgPSB0cnVlO1xuXG4vKioqKioqLyAJCS8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4vKioqKioqLyAJCXJldHVybiBtb2R1bGUuZXhwb3J0cztcbi8qKioqKiovIAl9XG5cblxuLyoqKioqKi8gCS8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4vKioqKioqLyAJX193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuLyoqKioqKi8gCS8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4vKioqKioqLyAJX193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuLyoqKioqKi8gCS8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4vKioqKioqLyAJX193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuLyoqKioqKi8gCS8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuLyoqKioqKi8gCXJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKDApO1xuLyoqKioqKi8gfSlcbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKioqKioqLyAoe1xuXG4vKioqLyAwOlxuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG4JXCJ1c2Ugc3RyaWN0XCI7XG5cbgl2YXIgX2NvbnN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5KTtcblxuCXZhciBfY29uc3QyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfY29uc3QpO1xuXG4JdmFyIF9tZXNzYWdlID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMSk7XG5cbglmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfVxuXG4JKGZ1bmN0aW9uICgpIHtcbgkgIHZhciBkYXRhID0gSlNPTi5wYXJzZShkZWNvZGVVUklDb21wb25lbnQoXCcvL0BEQVRBXCcpKTtcblxuCSAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcJ0RPTUNvbnRlbnRMb2FkZWRcJywgZnVuY3Rpb24gKCkge1xuCSAgICBzaG93Tm90aWZpY2F0aW9uKGRhdGEpO1xuCSAgfSk7XG5cbgkgIGZ1bmN0aW9uIHNob3dOb3RpZmljYXRpb24oZGF0YSkge1xuCSAgICB2YXIgbWVzc2FnZSA9IG5ldyBfbWVzc2FnZS5NZXNzYWdlKHtcbgkgICAgICBjb25maWc6IF9jb25zdDIuZGVmYXVsdCxcbgkgICAgICBpZDogZGF0YS5pZCxcbgkgICAgICB0aXRsZTogZGF0YS50aXRsZSxcbgkgICAgICBzdWJUaXRsZTogZGF0YS5zdWJUaXRsZSxcbgkgICAgICBpY29uOiBkYXRhLmljb24sXG4JICAgICAgc2hvd0hpZGU6IGRhdGEuc2hvd0hpZGUsXG4JICAgICAgc2hvd1Jlc2l6ZTogZGF0YS5zaG93UmVzaXplLFxuCSAgICAgIHNvdXJjZTogZGF0YS5zb3VyY2UsXG4JICAgICAgc2l6ZTogZGF0YS5zaXplLFxuCSAgICAgIGJ1dHRvbnM6IGRhdGEuYnV0dG9ucyxcbgkgICAgICBwcm9wczogZGF0YS5wcm9wc1xuCSAgICB9KTtcbgkgIH1cbgl9KSgpO1xuXG4vKioqLyB9KSxcblxuLyoqKi8gOTpcbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHtcblxuCVwidXNlIHN0cmljdFwiO1xuXG4JT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4JICB2YWx1ZTogdHJ1ZVxuCX0pO1xuCXZhciBDb25maWcgPSB7XG4JICBcImRlZmF1bHRXaGl0ZUxpc3RcIjogW1wiZW5nYWdlLndpeGFwcHMubmV0XCIsIFwibGlua2VkaW4uY29tXCIsIFwiZ29vZ2xlXCIsIFwid3d3LmdtYWlsLmNvbVwiLCBcInd3dy5waW50ZXJlc3QuY29tXCIsIFwid3d3LnlvdXR1YmUuY29tXCIsIFwid3d3LmZhY2Vib29rLmNvbVwiLCBcInNlYXJjaC55YWhvby5jb21cIiwgXCJjaHJvbWU6Ly9uZXd0YWJcIiwgXCJ3d3cuZm9vZC5jb21cIl0sXG4JICBcImRlZmF1bHRCbGFja0xpc3RcIjogW1wiYWRydW5uclwiLCBcInN1Y2Nlc3Nmb3J5dS5jbGlja2Z1bm5lbHMuY29tXCIsIFwiZm1vdmllcy5zZVwiLCBcImluLTM2NS10YWdlbi5pbmZvXCIsIFwiNTAwMC1zZXR0aW1hbmFsZS5jb21cIiwgXCJzaG9wLm1henp1Z2lvaWVsbGkuY29tXCIsIFwibWF4aWdvc3NpcC5jb21cIiwgXCJscC55YXppemltLmNvbVwiLCBcImJleW91cnhmcmllbmQuY29tXCIsIFwiOTl0YWIuY29tXCIsIFwienpxcnQuY29tXCIsIFwiY2FudWNrLW1ldGhvZC5uZXRcIiwgXCJiZXdvbWVubHkuY29tXCIsIFwicGxheW5vdy5ndXJ1XCIsIFwiZGF0aW5nZm9yeW91LTQ4ZTEua3hjZG4uY29tXCIsIFwidHJhZmZpY25ldHdvcmthZHMyNC5jb21cIiwgXCJzaXN0ZW1hZGVkaW5lcm9ncmF0aXMuY29tXCIsIFwiY2FudWNrbWV0aG9kcHJvZml0LmNvXCIsIFwiY29uc3VtZXJyZXNlYXJjaG5ldHdvcmsuY29tXCIsIFwic2VjdXJlbWFjZml4LmNvbVwiLCBcInp6M2QzLnJ1XCIsIFwiemQxLnF1ZWJlYy1iaW4uY29tXCIsIFwiaG90LWdhbWVzNHlvdS54eXpcIiwgXCJvbS5lbHZlbmFyLmNvbVwiLCBcInN1cGVycGNjbGVhbnVwLmNvbVwiLCBcImdvbWVkaWF6LmNvbVwiLCBcImp1ZGl0aGkueHl6XCIsIFwiZnJlZS5hdG96bWFudWFscy5jb21cIiwgXCJ5b3Vyc3VjY2Vzcy5yYXZwYWdlLmNvLmlsXCIsIFwiMTIzaG9wLmlyXCIsIFwicXVpemNsaWVudGUucHdcIiwgXCJhdXNzaWVtZXRob2QuYml6XCIsIFwiaGxwbm93cC1jLmNvbVwiLCBcInBpY2J1bXBlci5jb21cIiwgXCJzaGFuZWxlc3MuY29tXCIsIFwiYW5hY29uZGFtb25zdGVyLmNvbVwiLCBcImFsdHJrMS5jb21cIiwgXCJoZWFsdGgudG9kYXlkaWV0cy5jb21cIiwgXCJkb3dubG9hZC53ZWF0aGVyYmxpbmsuY29tXCIsIFwiaGFwcHlsdWtldGguY29tXCIsIFwiZ28uYW1laW5mby5jb21cIiwgXCI1MGthd2Vlay5uZXRcIiwgXCJ0aGVwb3Juc3VydmV5LmNvbVwiLCBcIm9mc2lpdGUucnVcIiwgXCJmdWxsdGFiLmNvbVwiLCBcIjEwMDBzcGlucy5jb21cIiwgXCJ0aW1lMnBsYXktb25saW5lLm5ldFwiLCBcInZpbnRhY2Fycy5jb21cIiwgXCJ3ZWxjb21lLnB1c3N5c2FnYS5jb21cIiwgXCJmcmVlLWRlc2t0b3AtZ2FtZXMuY29tXCIsIFwiZG93bmxvYWQudGVsZXZpc2lvbmZhbmF0aWMuY29tXCIsIFwidGhlcHJvZml0c21ha2VyLm5ldFwiLCBcInNnYWQuaW5mb1wiLCBcImFsZ29jYXNobWFzdGVyLm5ldFwiLCBcInN1bm1ha2VyLmNvbVwiLCBcInRvcHZpcGRyZWFtcy5jb21cIiwgXCJ3YXRjaG15Z2lybGZyaWVuZC5nZnBvcm52aWRlb3MuY29tXCIsIFwiZmlsZXNoYXJlZmFuYXRpYy5jb21cIiwgXCJzYWZlZG93bmxvYWRodWIuY29tXCIsIFwiN2F3bGFsYWxhbS5ibG9nc3BvdC5jb21cIiwgXCJ0dnBsdXNuZXd0YWIuY29tXCIsIFwidHJlbmRpbmdwYXRyb2wuY29tXCIsIFwibW9uZXltb3JuaW5nLmNvbVwiLCBcImlmaWxleW91LmNvbVwiLCBcImNsYXNzaWZpZWRjYW5hZGEuY2FcIiwgXCJmaXJlZmFuLmNvbVwiLCBcIm1ldGhvZGUtYmluYWlyZS5jb21cIiwgXCJsZXRtZXRlbGwuY29tXCIsIFwia2VuZHVrdHVyLmNvbVwiLCBcImdldGFmdWsuY29tXCIsIFwieW90cmFsZXBsYWhudGUucnVcIiwgXCJqYWNrcG90Ljg4YmV0by5jb21cIiwgXCJwd3d5c3lkaC5jb21cIiwgXCJzZWFyY2gucXVlcnlyb3V0ZXIuY29tXCIsIFwidi5sdnp0eHkuY29tXCIsIFwicHVzc3lzYWdhLmNvbVwiLCBcInNhZmZhbWV0aG9kLmNvbVwiLCBcInByZXp6b25saW5lLmNvbVwiLCBcInNlYXJjaHByaXZhY3kud2Vic2l0ZVwiLCBcIjNkMjgxOTIxNmViNGUxMDM1ODc5LTdjMjQ4ZGUwYzk5NzQ1NDA2ZTliNzQ5ZmM4NmVjM2U0LnNzbC5jZjEucmFja2Nkbi5jb21cIiwgXCJvbmx5MmRhdGUuY29tXCIsIFwibXlzYWdhZ2FtZS5jb21cIiwgXCJ0aGVtaWxsaW9uYWlyZWlucGpzLm5ldFwiLCBcIndsdC5rZDIyNDQuY29tXCIsIFwicXVpY2twcml2YWN5Y2hlY2suY29tXCIsIFwiaG90Y2hhdGRhdGUuY29tXCIsIFwiYXV0b3RyYWRlcmJvdC5jb21cIiwgXCJ6MS56ZWRvLmNvbVwiLCBcInlvdWx1Y2t5MjAxNC5jb21cIiwgXCJ0cmFmZmljLmdldG15YWRzLmNvbVwiLCBcImFwcGNsb3VkcHJvdGVjdGVkLmNvbVwiLCBcInNhZmVuc2VjdXJlLmNvbS1hbGxzaXRlczMueHl6XCIsIFwibmV3cG9wdGFiLmNvbVwiLCBcInN0YXRpYy53aWxsaWFtaGlsbC5jb21cIiwgXCJteWhlYWx0aHlibG9nLmNvXCIsIFwiZ3JlYXRlc3Rtb2JpZGVhbHMuY29tXCIsIFwic3dlZXRjbGFyaXR5LmNvbVwiLCBcIm1naWQuY29tXCIsIFwic2VjdXJlcGNjdXJlLmNvbVwiLCBcImF1dG9wZW5nZWJ5Z2dlci5jb21cIiwgXCJhbTE1Lm5ldFwiLCBcImVzLnJlaW1hZ2VwbHVzLmNvbVwiLCBcIm8yLnByb21vcy1pbmZvLmNvbVwiLCBcIml0LnJlaW1hZ2VwbHVzLmNvbVwiLCBcIndlc3RzbHV0cy5jb21cIiwgXCJzcGluYW5kd2luLmNvbS1zZXIucHdcIiwgXCJyZWltYWdlcGx1cy5jb21cIiwgXCJ2b2RhZm9uZS5wcm9tb3MtaW5mby5jb21cIiwgXCJ2aW5ubWF0cGVuZ2FyLnNlXCIsIFwibW92aWUuaWVuam95YXBwcy5jb21cIiwgXCJsb3ZlNHNpbmdsZS5jb21cIiwgXCJvcmlnaW4uZ2V0cHJpY2UuY29tLmF1XCIsIFwib2hteWRhdGluZy5jb21cIiwgXCJscC53YW50LXRvLXdpbi5jb21cIiwgXCJ5YWJ1bGV0Y2hyb21lLnJ1XCIsIFwiYmFtZGFkLm5ldFwiLCBcImdvdG9zaXRlbm93LmNvbVwiLCBcInZjcnlwdC5wd1wiLCBcIm5ld3RhYnR2LmNvbVwiLCBcIm1vbi5zZXRzdS54eXpcIiwgXCJ5b3Vmb3Jnb3R0b3JlbmV3eW91cmhvc3RpbmcuY29tXCIsIFwiem9uZS10ZWxlY2hhcmdlbWVudC53c1wiLCBcImxhbmQucGNrZWVwZXIuc29mdHdhcmVcIiwgXCJhZC5hZHBvcC0xLmNvbVwiLCBcImFkdmFuY2VkcGN0b29scy5jb21cIiwgXCJ2aWRlb3MucmFuZG9scGhjb3VudHloZXJhbGR0cmlidW5lLmNvbVwiLCBcIndlYi1zdGFydC5vcmdcIiwgXCJzb2Z0cmVhZHlub3cuaW5zdGFsbHVwZ3JhZGVub3dmcmVzaGFuZGZvcnlvdS53ZWJzaXRlXCIsIFwidXBsb2Qud3NcIiwgXCJwb3JuaHViY2FzaW5vLmNvbVwiLCBcIm1heGJldC5yb1wiLCBcIjIwMTZwcml6ZWZlZWQuY29tXCIsIFwidGhldmlkZW8ubWVcIiwgXCJ3YW50dWJhZC5jb21cIiwgXCJ0YXZhbmVyby5jb21cIiwgXCJ4Y3VzbXkuY2x1YlwiLCBcImRhY2xpcHMuaW5cIiwgXCJnYXltZW5vZnBvcm4ub25saW5lXCIsIFwiamFja3BvdGNpdHljYXNpbm8uY29tXCIsIFwiaXRhbGlhbi1tZXRob2QuY29tXCIsIFwiZ2V0c2VhcmNoaW5jb2duaXRvLmNvbVwiLCBcInlvdWp1c3R3b25wcml6ZS5jb21cIiwgXCJmaW5hbnotbmFjaHJpY2h0ZW4ubWVcIiwgXCJxdWl6Y2xpZW50ZS5zaXRlXCIsIFwiZGEucmVpbWFnZXBsdXMuY29tXCIsIFwiamthbmltZS5uZXRcIiwgXCJicml0bW9uZXltZXRob2QuY29tXCIsIFwidWFlLnNvdXEuY29tXCIsIFwia2EuYXp6ZXIubmV0XCIsIFwic2FmZW5zZWN1cmUueHl6XCIsIFwiOHQuaG9vdGluZ3JoZWprei5vbmxpbmVcIiwgXCJ3d3c2LmJsaW5reC5jb21cIiwgXCJ3aXp6Y2FzdGVyLmNvbVwiLCBcImNvbXBhcmFpc29uLXByaXguY29tXCIsIFwidm9kbG9ja2VyLmxvbFwiLCBcImZyLnJlaW1hZ2VwbHVzLmNvbVwiLCBcImZyZWUuZnJvbWRvY3RvcGRmLmNvbVwiLCBcInVzZXJzY2xvdWQuY29tXCIsIFwibXlwcml2YXRlc2VhcmNoLmNvbVwiLCBcImZhbmxpOTAuY25cIiwgXCJ0dXR0aWNvZGljaXNjb250by5pdFwiLCBcIm1lZGlhZGVjLmNvbVwiLCBcImdvZ2FtZWdvLnRoZXdoaXpwcm9kdWN0cy5jb21cIiwgXCJkb3dubG9hZC53ZWF0aGVyYmxpbmsuY29tXCIsIFwiZnJlZS52aWRlb2Rvd25sb2FkY29udmVydGVyLmNvbVwiLCBcIndlLWFyZS1nYW1lcnMuY29tXCIsIFwic2Vzc28uY29tbXVuaXR5YWR1bHQubmV0XCIsIFwibHAuYmxwbW92aWVzLmNvbVwiLCBcInNlYXJjaC5xdWVyeXJvdXRlci5jb21cIiwgXCJiYmItam9oYW5uZXNidXJnLmxvY2Fsc3BlY2lmaWMuY29tXCIsIFwibHAuYmxwbW92aWVzLmNvbVwiLCBcImdvLnBwaXhlbG0uY29tXCIsIFwicjAucnVcIiwgXCJzZXNzby5jb21tdW5pdHlhZHVsdC5uZXRcIiwgXCJiYmItam9oYW5uZXNidXJnLmxvY2Fsc3BlY2lmaWMuY29tXCIsIFwicHBpeGVsbS5jb21cIiwgXCJjeWJlcmd1YXJkaWFuc3BlLmluZm9cIiwgXCJ3ZS1hcmUtZ2FtZXJzLmNvbVwiLCBcImxvZ2luZmFzdGVyLmNvbS9uZXdcIiwgXCJ3d3cuYWxmYWNhcnQuY29tXCIsIFwid3d3LmZvcmVzZWUuY29tXCIsIFwibW9iaWxlLXdpbi5jb21cIiwgXCJ3d3cucGx1c25ldHdvcmsuY29tXCIsIFwid3d3LmFtaWNhZmFybWFjaWEuY29tXCIsIFwid3d3LmllbmpveWFwcHMuY29tXCIsIFwiY2hlYXBjaGVhcC5pb1wiLCBcInNjcmVlbmFkZGljdC50aGV3aGl6cHJvZHVjdHMuY29tXCIsIFwibm92YS5yYW1ibGVyLnJ1XCIsIFwiZnJlZS5nYW1pbmd3b25kZXJsYW5kLmNvbVwiLCBcInA5MzI4dWplaXcxLnJ1XCIsIFwibW9iaWxlY2FzaW5vY2x1Yi5jby51a1wiLCBcInBmaHN5c3RlbS5jb21cIiwgXCJyZWd0dW5ldXAuY29tXCIsIFwidGhlcHJvZml0c21ha2VyLm5ldFwiLCBcImJvZG9ncHJvbW90aW9ucy5ldVwiLCBcImhlcm9lc3JlcGxheS5vcmdcIiwgXCJmaW5hbmNpYWxzZWNyZXRzLmluZm9cIiwgXCJteW1vbmV5bWFraW5nYXBwLmNvbVwiLCBcInN1bm1ha2VyLmNvbVwiLCBcIjg4OGNhc2luby1wcm9tb3Rpb25zLmNvbVwiLCBcInZvZ2xpb3Nlc3NvLmNvbVwiLCBcInNjaWVuY2VyZW1peC5jb21cIiwgXCJhbGxpbm9uZWRvY3MuY29tXCIsIFwiYXJhYmlhLnN0YXJ6cGxheS5jb21cIiwgXCJhbGxpcmlzaGNhc2luby5jb21cIiwgXCJhZHZhbmNlcGN0b29scy5pbmZvXCIsIFwibW92aWUuaWVuam95YXBwcy5jb21cIiwgXCJzdXJ2ZXlmb3JtMDAxLnMzLXdlYnNpdGUtdXMtZWFzdC0xLmFtYXpvbmF3cy5jb21cIiwgXCJtZ3MxODguY29tXCIsIFwicGZoc3lzdGVtLmNvbVwiLCBcImxwZXZhLmNvbVwiLCBcImRkc2g4LmNvbVwiLCBcInRoZXByb2ZpdHNtYWtlci5uZXRcIiwgXCJiMi5panF1ZXJ5MTEuY29tXCIsIFwic3BvcnRoZXJvLnRoZXdoaXptYXJrZXRpbmcuY29tXCIsIFwic2VjdXJlZmFzdG1hYy50ZWNoXCIsIFwic2Vlbi1vbi1zY3JlZW4udGhld2hpem1hcmtldGluZy5jb21cIiwgXCIxMDAwc3BpbnMuY29tXCIsIFwic2VhcmNoLnF1ZXJ5cm91dGVyLmNvbVwiLCBcInBmaHN5c3RlbS5jb21cIiwgXCJyZWltYWdlcGx1cy5jb21cIiwgXCJvZmZlci5hbGliYWJhLmNvbVwiLCBcInNlYXJjaGxpc3RpbmdzLm9yZ1wiLCBcInNlYXJjaC5xdWVyeXJvdXRlci5jb21cIiwgXCJzZWFyY2gucXVlcnlyb3V0ZXIuY29tXCIsIFwibXliaW5hcnlvcHRpb25zcm9ib3QuY29tXCIsIFwiZHVwbGljYXNoYXBwLmNvbVwiLCBcInNlYXJjaC5xdWVyeXJvdXRlci5jb21cIiwgXCJiZXN0Z2FtZS5kaXJlY3RvcnlcIiwgXCJkcm9pZGNsdWIubmV0XCIsIFwiLnJpdmFsby5jb21cIiwgXCJ5b3Vyc3VwZXJwcml6ZS5jb21cIiwgXCJtZWRpYWV4cGxhaW5lZC5jb21cIiwgXCJvbS5lbHZlbmFyLmNvbVwiLCBcInNoaW5hci5jbHViXCIsIFwicmV2aXRvbGVjemVtYWNyZWFtLmNvbVwiLCBcImZyZWVsb3R0by5jb21cIiwgXCJzY3JlZW5hZGRpY3QudGhld2hpenByb2R1Y3RzLmNvbVwiLCBcImRvd25sb2FkLmJyaW5nbWVzcG9ydHMuY29tL1wiLCBcImFsbGlub25lZG9jcy5jb21cIiwgXCJkcml2ZXItZml4ZXIuY29tXCIsIFwiYXJhYnlkZWFsLmNvbVwiLCBcImNsZWFueW91cmNvbXB1dGVydG9kYXkuY29tXCIsIFwiYXJhYnlkZWFsLmNvbVwiLCBcIm11c2ljLm1peHBsdWdpbi5jb21cIiwgXCIxc2UuaW5mb1wiLCBcInN1cnZleTEyLmNvbVwiLCBcImZyZWVzb2Z0d2FyZWRsdWwuY29tXCIsIFwicGxkaXN0MDEuY29tXCIsIFwiYWQuYWRwb3AtMS5jb21cIiwgXCJzZWFyY2hhbm9ueW1vdXMubmV0XCIsIFwiYWJyc3QucHJvXCIsIFwibXV6aWtmdXJ5LnRoZXdoaXptYXJrZXRpbmcuY29tXCIsIFwibHAubWJ0cnguY29tXCIsIFwidGgxLmZvcmZ1bi5tYXhpc2l6ZS1wcm8uY29tXCIsIFwid2F0Y2hteWdpcmxmcmllbmQuZ2Zwb3JuYm94LmNvbVwiLCBcIm5ldy5mcmVlbG90dG8uY29tXCIsIFwiZGVza3RvcHRyYWNrLmNvbVwiLCBcInNlYXJjaC5xdWVyeXJvdXRlci5jb21cIiwgXCJvZmZlci5hbGliYWJhLmNvbVwiLCBcIjEwMDBzcGlucy5jb21cIiwgXCJwcm9tb3Rpb25zLmNvcmFsLmNvLnVrXCIsIFwic2VhcmNoLnF1ZXJ5cm91dGVyLmNvbVwiLCBcInRic2lhLmNvbVwiLCBcInRic2lhLmNvbVwiLCBcIm11bHR0YWVweW8uY29tXCIsIFwic2VhcmNoLnF1ZXJ5cm91dGVyLmNvbVwiLCBcImN6ZWNobWV0aG9kLmNvbVwiLCBcImNvbnN1bWVydmlldy5jb1wiLCBcIndheXJldGFpbC5jb21cIiwgXCI3Mm9uYmFzZS5jb21cIiwgXCJmdW5zYWZldGFiLmNvbVwiLCBcInNlYXJjaC5xdWVyeXJvdXRlci5jb21cIiwgXCJzcGVlZHlmaWxlZG93bmxvYWQuY29tXCIsIFwiZHJpdmVyLWZpeGVyLmNvbVwiLCBcImFyYWJ5ZGVhbC5jb21cIiwgXCJjbGVhbnlvdXJjb21wdXRlcnRvZGF5LmNvbVwiLCBcImFyYWJ5ZGVhbC5jb21cIiwgXCJtdXNpYy5taXhwbHVnaW4uY29tXCIsIFwiMXNlLmluZm9cIiwgXCJzdXJ2ZXkxMi5jb21cIiwgXCJmcmVlc29mdHdhcmVkbHVsLmNvbVwiLCBcInBsZGlzdDAxLmNvbVwiLCBcImFkLmFkcG9wLTEuY29tXCIsIFwic2VhcmNoYW5vbnltb3VzLm5ldFwiLCBcImFicnN0LnByb1wiLCBcIm11emlrZnVyeS50aGV3aGl6bWFya2V0aW5nLmNvbVwiLCBcImxwLm1idHJ4LmNvbVwiLCBcInRoMS5mb3JmdW4ubWF4aXNpemUtcHJvLmNvbVwiLCBcIndhdGNobXlnaXJsZnJpZW5kLmdmcG9ybmJveC5jb21cIiwgXCJuZXcuZnJlZWxvdHRvLmNvbVwiLCBcImRlc2t0b3B0cmFjay5jb21cIiwgXCJzZWFyY2gucXVlcnlyb3V0ZXIuY29tXCIsIFwib2ZmZXIuYWxpYmFiYS5jb21cIiwgXCIxMDAwc3BpbnMuY29tXCIsIFwicHJvbW90aW9ucy5jb3JhbC5jby51a1wiLCBcInNlYXJjaC5xdWVyeXJvdXRlci5jb21cIiwgXCJ0YnNpYS5jb21cIiwgXCJ0YnNpYS5jb21cIiwgXCJzdXJ2ZXlmb3JtMDAxLnMzLXdlYnNpdGUtdXMtZWFzdC0xLmFtYXpvbmF3cy5jb21cIiwgXCJtZ3MxODguY29tXCIsIFwicGZoc3lzdGVtLmNvbVwiLCBcImxwZXZhLmNvbVwiLCBcImRkc2g4LmNvbVwiLCBcInRoZXByb2ZpdHNtYWtlci5uZXRcIiwgXCJxdWFudG9tY29kaW5nLmNvbVwiLCBcInNwb3J0aGVyby50aGV3aGl6bWFya2V0aW5nLmNvbVwiLCBcInBvcGFkcy5uZXRcIiwgXCJvbmNsa2RzLmNvbVwiLCBcImNvbnN1bWVydmlldy5jb1wiLCBcIjEya290b3YucnVcIiwgXCJydWhvdHBhaXIyLmZpbmd0YS5jb21cIiwgXCJlYXN5dGVsZXZpc2lvbmFjY2Vzc25vdy5jb21cIiwgXCJhaHdyZC5jb21cIiwgXCJscGV2YS5jb21cIiwgXCJwcGd6Zi5jb21cIiwgXCJ6anN0eC5jb21cIiwgXCJraXR1dXJlLnh5elwiLCBcImpvaW4ucHJvLWdhbWluZy13b3JsZC5jb21cIiwgXCJtYWNrZWVwZXJhcHAubWFja2VlcGVyLmNvbVwiLCBcInRyYWNrbm90aWZ5LmNvbVwiLCBcIjIwNzUuY2RuLmJleW9uZGhvc3RpbmcubmV0XCIsIFwiaWRvbGxhc2guY29tXCIsIFwiZHMubW92aWVnb2F0LmNvbVwiLCBcImZ1bGx0YWIuY29tXCIsIFwicmFja2Nkbi5jb21cIiwgXCJwcmVzdG9yaXMuY29tXCIsIFwiYWRzdGVycmEuY29tXCIsIFwic3dhbXBzc292dXVodXNwLnRvcFwiLCBcInN0cmVlc3VzYS5pbmZvXCIsIFwiZnJlZXNvZnR3YXJlZGx1bC5jb21cIiwgXCJhZHJlYWN0b3IuY29tXCIsIFwiYS1zdGF0aWMuY29tXCIsIFwiY29kZW9uY2xpY2suY29tXCIsIFwiaGVoZW1lLmNvbVwiLCBcImFkZi5seVwiLCBcInNlZW4tb24tc2NyZWVuLnRoZXdoaXptYXJrZXRpbmcuY29tXCIsIFwib3BlbmxvYWQuY29cIl1cbgl9O1xuXG4JZXhwb3J0cy5kZWZhdWx0ID0gQ29uZmlnO1xuXG4vKioqLyB9KSxcblxuLyoqKi8gMTE6XG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7XG5cbglcJ3VzZSBzdHJpY3RcJztcblxuCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuCSAgdmFsdWU6IHRydWVcbgl9KTtcblxuCXZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoXCJ2YWx1ZVwiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7XG5cbglmdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7IGlmIChBcnJheS5pc0FycmF5KGFycikpIHsgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBBcnJheShhcnIubGVuZ3RoKTsgaSA8IGFyci5sZW5ndGg7IGkrKykgeyBhcnIyW2ldID0gYXJyW2ldOyB9IHJldHVybiBhcnIyOyB9IGVsc2UgeyByZXR1cm4gQXJyYXkuZnJvbShhcnIpOyB9IH1cblxuCWZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cbgl2YXIgTWVzc2FnZSA9IGV4cG9ydHMuTWVzc2FnZSA9IGZ1bmN0aW9uICgpIHtcbgkgIGZ1bmN0aW9uIE1lc3NhZ2Uob3B0aW9ucykge1xuCSAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgTWVzc2FnZSk7XG5cbgkgICAgdGhpcy50ZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCcjbWVzc2FnZS10ZW1wbGF0ZVwnKS5pbm5lckhUTUw7XG4JICAgIHRoaXMubWVzc2FnZSA9IHRoaXMucmVuZGVyKHsgb3B0aW9uczogb3B0aW9ucyB9KTtcblxuCSAgICByZXR1cm4gdGhpcztcbgkgIH1cblxuCSAgX2NyZWF0ZUNsYXNzKE1lc3NhZ2UsIFt7XG4JICAgIGtleTogXCdyZW5kZXJcJyxcbgkgICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcihfcmVmKSB7XG4JICAgICAgdmFyIF90aGlzID0gdGhpcztcblxuCSAgICAgIHZhciBvcHRpb25zID0gX3JlZi5vcHRpb25zO1xuXG4JICAgICAgdmFyIG1lc3NhZ2UgPSB0aGlzLmNyZWF0ZUhUTUwoeyBodG1sOiB0aGlzLnRlbXBsYXRlLCBwYXJlbnQ6IGRvY3VtZW50LmJvZHkgfSk7XG5cbgkgICAgICBpZiAob3B0aW9ucy50aXRsZSkge1xuCSAgICAgICAgbWVzc2FnZS5xdWVyeVNlbGVjdG9yKFwnLm1lc3NhZ2UtdGl0bGVcJykuaW5uZXJIVE1MID0gb3B0aW9ucy50aXRsZTtcbgkgICAgICAgIG1lc3NhZ2UucXVlcnlTZWxlY3RvcihcJy5tZXNzYWdlLXRpdGxlXCcpLmNsYXNzTGlzdC5yZW1vdmUoXCdoaWRkZW5cJyk7XG4JICAgICAgfVxuXG4JICAgICAgaWYgKG9wdGlvbnMuYnV0dG9ucy5sZW5ndGgpIHtcbgkgICAgICAgIHZhciBidXR0b25zID0gbWVzc2FnZS5xdWVyeVNlbGVjdG9yKFwnLm1lc3NhZ2UtYnV0dG9uc1wnKTtcblxuCSAgICAgICAgYnV0dG9ucy5jbGFzc0xpc3QucmVtb3ZlKFwnaGlkZGVuXCcpO1xuXG4JICAgICAgICBvcHRpb25zLmJ1dHRvbnMuZm9yRWFjaChmdW5jdGlvbiAoYnV0dG9uKSB7XG4JICAgICAgICAgIHZhciBidG4gPSBfdGhpcy5jcmVhdGVIVE1MKHsgaHRtbDogXCc8ZGl2PlwnICsgYnV0dG9uLmxhYmVsICsgXCc8L2Rpdj5cJywgcGFyZW50OiBidXR0b25zIH0pO1xuXG4JICAgICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKFwnY2xpY2tcJywgZnVuY3Rpb24gKGUpIHtcbgkgICAgICAgICAgICBwYXJlbnQucG9zdE1lc3NhZ2UoeyBhY3Rpb246IFwncGItbWVzc2FnZS1idG4tY2xpY2tcJywgaWQ6IGJ1dHRvbi5pZCwgc291cmNlOiBvcHRpb25zLnNvdXJjZSwgdG9hc3RJZDogb3B0aW9ucy5pZCB9LCBcJypcJyk7XG5cbgkgICAgICAgICAgICBfdGhpcy5wcmV2bnRCcm93c2VyQmxvY2soeyBpZDogYnV0dG9uLmlkLCBvcHRpb25zOiBvcHRpb25zIH0pO1xuCSAgICAgICAgICB9KTtcbgkgICAgICAgIH0pO1xuCSAgICAgIH1cblxuCSAgICAgIHRoaXMuaW5pdEV2ZW50cyh7IG1lc3NhZ2U6IG1lc3NhZ2UsIG9wdGlvbnM6IG9wdGlvbnMgfSk7XG5cbgkgICAgICBwYXJlbnQucG9zdE1lc3NhZ2UoeyBhY3Rpb246IFwncGItbWVzc2FnZS1kaXNwbGF5XCcsIHNvdXJjZTogb3B0aW9ucy5zb3VyY2UsIHRvYXN0SWQ6IG9wdGlvbnMuaWQgfSwgXCcqXCcpO1xuXG4JICAgICAgcmV0dXJuIG1lc3NhZ2U7XG4JICAgIH1cbgkgIH0sIHtcbgkgICAga2V5OiBcJ2NyZWF0ZUhUTUxcJyxcbgkgICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZUhUTUwoX3JlZjIpIHtcbgkgICAgICB2YXIgaHRtbCA9IF9yZWYyLmh0bWwsXG4JICAgICAgICAgIHBhcmVudCA9IF9yZWYyLnBhcmVudDtcblxuCSAgICAgIHZhciBkb2MgPSBuZXcgRE9NUGFyc2VyKCkucGFyc2VGcm9tU3RyaW5nKGh0bWwudHJpbSgpLCBcJ3RleHQvaHRtbFwnKTtcbgkgICAgICB2YXIgZWwgPSBkb2MuYm9keS5maXJzdENoaWxkO1xuXG4JICAgICAgcGFyZW50LmFwcGVuZENoaWxkKGVsKTtcblxuCSAgICAgIHJldHVybiBlbDtcbgkgICAgfVxuCSAgfSwge1xuCSAgICBrZXk6IFwnaW5pdEV2ZW50c1wnLFxuCSAgICB2YWx1ZTogZnVuY3Rpb24gaW5pdEV2ZW50cyhfcmVmMykge1xuCSAgICAgIHZhciBtZXNzYWdlID0gX3JlZjMubWVzc2FnZSxcbgkgICAgICAgICAgb3B0aW9ucyA9IF9yZWYzLm9wdGlvbnM7XG5cbgkgICAgICBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KG1lc3NhZ2UucXVlcnlTZWxlY3RvckFsbChcJy5tZXNzYWdlLWJ1dHRvbnMgPiBkaXZcJykpKS5tYXAoZnVuY3Rpb24gKGl0ZW0pIHtcbgkgICAgICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcJ2NsaWNrXCcsIGZ1bmN0aW9uIChlKSB7XG4JICAgICAgICAgIHBhcmVudC5wb3N0TWVzc2FnZSh7IGFjdGlvbjogXCdwYi1tZXNzYWdlLWNsb3NlXCcsIHRyaWdnZXJFdmVudDogZmFsc2UsIHF1aWNrQ2xvc2U6IHRydWUsIHRvYXN0SWQ6IG9wdGlvbnMuaWQgfSwgXCcqXCcpO1xuCSAgICAgICAgfSk7XG4JICAgICAgfSk7XG5cbgkgICAgICBtZXNzYWdlLnF1ZXJ5U2VsZWN0b3IoXCcubWVzc2FnZS1jbG9zZVwnKS5hZGRFdmVudExpc3RlbmVyKFwnY2xpY2tcJywgZnVuY3Rpb24gKCkge1xuCSAgICAgICAgcGFyZW50LnBvc3RNZXNzYWdlKHsgYWN0aW9uOiBcJ3BiLW1lc3NhZ2UtY2xvc2VcJywgdHJpZ2dlckV2ZW50OiB0cnVlLCBzb3VyY2U6IG9wdGlvbnMuc291cmNlLCB0b2FzdElkOiBvcHRpb25zLmlkIH0sIFwnKlwnKTtcbgkgICAgICB9KTtcbgkgICAgfVxuCSAgfSwge1xuCSAgICBrZXk6IFwncHJldm50QnJvd3NlckJsb2NrXCcsXG4JICAgIHZhbHVlOiBmdW5jdGlvbiBwcmV2bnRCcm93c2VyQmxvY2soX3JlZjQpIHtcbgkgICAgICB2YXIgaWQgPSBfcmVmNC5pZCxcbgkgICAgICAgICAgb3B0aW9ucyA9IF9yZWY0Lm9wdGlvbnM7XG5cbgkgICAgICB2YXIgYXJncyA9IFtdO1xuXG4JICAgICAgc3dpdGNoIChpZCkge1xuCSAgICAgICAgY2FzZSBcJ2FsbG93T25jZVwnOlxuCSAgICAgICAgY2FzZSBcJ2FsbG93QWx3YXlzXCc6XG4JICAgICAgICAgIGFyZ3MgPSBvcHRpb25zLnByb3BzLndpbkFyZ3M7XG4JICAgICAgICAgIGJyZWFrO1xuXG4JICAgICAgICBkZWZhdWx0OlxuCSAgICAgICAgICByZXR1cm47XG4JICAgICAgICAgIGJyZWFrO1xuCSAgICAgIH1cblxuCSAgICAgIC8vaWYgdXJsIGRvZXNuXCd0IGhhdmUgaHR0cCBpbiB0aGUgYmVnaW5uaW5nIHdlIG5lZWQgdG8gYWRkXG4JICAgICAgaWYgKCEvXmh0dHBzP1xcOi8udGVzdChhcmdzWzBdKSAmJiAhL15hYm91dDpibGFuay9pLnRlc3QoYXJnc1swXSkpIHtcbgkgICAgICAgIC8vdXJsIGNhbiBzdGFydCB3aXRoIC8vc2l0ZS5jb20gb3IganVzdCBzaXRlLmNvbVxuCSAgICAgICAgYXJnc1swXSA9IFwnaHR0cDpcJyArICgvXlxcL1xcLy8udGVzdChhcmdzWzBdKSA/IFwnXCcgOiBcJy8vXCcpICsgYXJnc1swXTtcbgkgICAgICB9XG5cbgkgICAgICAvL2luIGZpcmVmb3ggeW91IGNhblwndCBvcGVuIGEgbmV3IHRhYiBkaXJlY3RseSB3aXRoIGV4dGVybmFsIHVybCAoZG9uXCd0IGtub3cgd2h5LCBzZWVtcyBsaWtlIEZGIGJ1ZylcbgkgICAgICAvL3NvIHdlIG5lZWQgdG8gb3BlbiBhIGxvY2FsIGh0bWwgdXJsIGFuZCBkbyBhIHJlZGlyZWN0XG4JICAgICAgLyppZiAoL2ZpcmVmb3gvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKSB7XHJcbgkgICAgICAgIGFyZ3NbMF0gPSBcJ2ZpcmVmb3gvZmYtb3Blbi5odG1sP3U9XCcgKyBlbmNvZGVVUklDb21wb25lbnQoYXJnc1swXSk7XHJcbgkgICAgICB9Ki9cblxuCSAgICAgIHdpbmRvdy5vcGVuKGFyZ3NbMF0gfHwgXCdcJywgYXJnc1sxXSB8fCBcJ1wnLCBhcmdzWzJdIHx8IFwnXCcpO1xuCSAgICB9XG4JICB9XSk7XG5cbgkgIHJldHVybiBNZXNzYWdlO1xuCX0oKTtcblxuLyoqKi8gfSlcblxuLyoqKioqKi8gfSk7XHJcbiAgICA8L3NjcmlwdD5cclxuCTwvaGVhZD5cclxuCTxib2R5PlxyXG4JCTxzY3JpcHQgaWQ9XCJtZXNzYWdlLXRlbXBsYXRlXCIgdHlwZT1cInRleHQvaHRtbFwiPlxyXG4JCQk8ZGl2IGNsYXNzPVwibWVzc2FnZVwiPlxyXG4JCQkJPGRpdiBjbGFzcz1cIm1lc3NhZ2UtaWNvblwiPjwvZGl2PlxyXG4JCQkJPGRpdiBjbGFzcz1cIm1lc3NhZ2UtdGl0bGVcIj48L2Rpdj5cclxuCVxyXG4JCQkJPGRpdiBjbGFzcz1cIm1lc3NhZ2UtYnV0dG9uc1wiPjwvZGl2PlxyXG5cclxuCQkJCTxkaXYgY2xhc3M9XCJtZXNzYWdlLWNsb3NlXCI+PC9kaXY+XHJcbgkJCTwvZGl2PlxyXG4JCTwvc2NyaXB0PlxyXG4JPC9ib2R5PlxyXG48L2h0bWw+IjsKCgkgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBmdW5jdGlvbiAoZXZlbnQpIHsKCSAgICAgIGlmIChldmVudC5kYXRhICYmIGV2ZW50LmRhdGEudG9hc3RJZCA9PSBfdGhpcy50b2FzdElkKSB7CgkgICAgICAgIHZhciBkYXRhID0gZXZlbnQuZGF0YTsKCgkgICAgICAgIHN3aXRjaCAoZGF0YS5hY3Rpb24pIHsKCSAgICAgICAgICBjYXNlICdwYi1tZXNzYWdlLWRpc3BsYXknOgoJICAgICAgICAgICAgX3RoaXMub3B0aW9ucy5vbkRpc3BsYXkgJiYgX3RoaXMub3B0aW9ucy5vbkRpc3BsYXkoKTsKCgkgICAgICAgICAgICBfdGhpcy5wcm9wcy5vbkRpc3BsYXkuY2FsbChfdGhpcywgeyBzb3VyY2U6IGRhdGEuc291cmNlIH0pOwoJICAgICAgICAgICAgYnJlYWs7CgoJICAgICAgICAgIGNhc2UgJ3BiLW1lc3NhZ2UtY2xvc2UnOgoJICAgICAgICAgICAgX3RoaXMudXNlckdlbmVyYXRlZENsb3NlID0gdHJ1ZTsKCgkgICAgICAgICAgICAvL3JlbW92ZSBpbW1lZGlhdGVseQoJICAgICAgICAgICAgaWYgKGRhdGEucXVpY2tDbG9zZSkgewoJICAgICAgICAgICAgICBfdGhpcy5yZW1vdmUoKTsKCSAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgIF90aGlzLnF1ZXVlRmFkZSgxMDAsIF90aGlzLm9wdGlvbnMub25GYWRlT3V0KTsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICBpZiAoZGF0YS50cmlnZ2VyRXZlbnQpIHsKCSAgICAgICAgICAgICAgX3RoaXMub3B0aW9ucy5vbkNsb3NlICYmIF90aGlzLm9wdGlvbnMub25DbG9zZSgpOwoJICAgICAgICAgICAgICBfdGhpcy5vcHRpb25zLm9uQnV0dG9uQ2xpY2sgJiYgX3RoaXMub3B0aW9ucy5vbkJ1dHRvbkNsaWNrKHsgaWQ6ICdjbG9zZScgfSk7CgoJICAgICAgICAgICAgICBfdGhpcy5wcm9wcy5vbkJ1dHRvbkNsaWNrLmNhbGwoX3RoaXMsIHsgc291cmNlOiBkYXRhLnNvdXJjZSwgaWQ6ICdjbG9zZScgfSk7CgkgICAgICAgICAgICAgIF90aGlzLnByb3BzLm9uQ2xvc2VDbGljay5jYWxsKF90aGlzLCB7IHNvdXJjZTogZGF0YS5zb3VyY2UgfSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBicmVhazsKCgkgICAgICAgICAgY2FzZSAncGItbWVzc2FnZS1idG4tY2xpY2snOgoJICAgICAgICAgICAgaWYgKF90aGlzLm9wdGlvbnMuYnV0dG9uc1tkYXRhLmlkXSkgewoJICAgICAgICAgICAgICBfdGhpcy5vcHRpb25zLmJ1dHRvbnNbZGF0YS5pZF0oKTsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICBfdGhpcy5vcHRpb25zLm9uQnV0dG9uQ2xpY2sgJiYgX3RoaXMub3B0aW9ucy5vbkJ1dHRvbkNsaWNrKHsgaWQ6IGRhdGEuaWQgfSk7CgkgICAgICAgICAgICBfdGhpcy5wcm9wcy5vbkJ1dHRvbkNsaWNrLmNhbGwoX3RoaXMsIHsgc291cmNlOiBkYXRhLnNvdXJjZSwgaWQ6IGRhdGEuaWQgfSk7CgkgICAgICAgICAgICBicmVhazsKCgkgICAgICAgICAgY2FzZSAncGItbWVzc2FnZS10b29sdGlwLW92ZXInOgoJICAgICAgICAgICAgaWYgKGlzSTE4TihkYXRhLmlkKSkgewoJICAgICAgICAgICAgICBfdGhpcy5zaG93VG9vbHRpcChkYXRhKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGJyZWFrOwoKCSAgICAgICAgICBjYXNlICdwYi1tZXNzYWdlLXRvb2x0aXAtb3V0JzoKCSAgICAgICAgICAgIF90aGlzLmhpZGVUb29sdGlwKCk7CgkgICAgICAgICAgICBicmVhazsKCSAgICAgICAgfQoKCSAgICAgICAgaWYgKF90aGlzLnByb3BzLm9uQWN0aW9uKSB7CgkgICAgICAgICAgX3RoaXMucHJvcHMub25BY3Rpb24oZGF0YS5hY3Rpb24pOwoJICAgICAgICB9CgkgICAgICB9CgkgICAgfSk7CgoJICAgIC8vd2hlbiBmb2N1cyBvdXQgaXQgc3RvcHMgY3NzIGFuaW1hdGlvbiBzbyBldmVuIGFmdGVyIDUgc2Vjb25kcyAKCSAgICAvL3RoZSBub3RpZmljYXRpb24gc3RheXMgYW5kIHdoZW4gZm9jdXMgYmFjayBpdCBxdWlja2x5IGRpc2FwZWFycyAKCSAgICAvL3RoaXMgaXMgYSBmaXggdG8gdGhpcwoJICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3Zpc2liaWxpdHljaGFuZ2UnLCBmdW5jdGlvbiAoZXZlbnQpIHsKCSAgICAgIGlmIChkb2N1bWVudC52aXNpYmlsaXR5U3RhdGUgPT0gJ3Zpc2libGUnKSB7CgkgICAgICAgIHZhciBub3cgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKCgkgICAgICAgIGlmIChfdGhpcy5xdWV1ZUZhZGVUaW1lICYmIG5vdyA+IF90aGlzLnF1ZXVlRmFkZVRpbWUgKyA1MDAwKSB7CgkgICAgICAgICAgX3RoaXMucmVtb3ZlKCk7CgkgICAgICAgIH0KCSAgICAgIH0KCSAgICB9LCBmYWxzZSk7CgkgIH0KCgkgIF9jcmVhdGVDbGFzcyhOb3RpZmljYXRpb24sIFt7CgkgICAga2V5OiAnYWRkUXVldWUnLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRRdWV1ZShvcHRpb25zKSB7CgkgICAgICB0aGlzLnF1ZXVlLnB1c2gob3B0aW9ucyk7CgoJICAgICAgaWYgKCF0aGlzLmlzTm90aWZpY2F0aW9uQWN0aXZlKSB7CgkgICAgICAgIHRoaXMuc2hvdyh0aGlzLmdldE5leHRRdWV1ZUl0ZW0oKSk7CgkgICAgICB9CgkgICAgfQoJICB9LCB7CgkgICAga2V5OiAnZ2V0TmV4dFF1ZXVlSXRlbScsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIGdldE5leHRRdWV1ZUl0ZW0oKSB7CgkgICAgICByZXR1cm4gdGhpcy5xdWV1ZS5zaGlmdCgpOwoJICAgIH0KCSAgfSwgewoJICAgIGtleTogJ3Nob3cnLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBzaG93KG9wdGlvbnMpIHsKCSAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKCSAgICAgIHRoaXMuaW5pdChvcHRpb25zKTsKCgkgICAgICBpZiAob3B0aW9ucy5xdWlja09wZW4gJiYgIWRvY3VtZW50LmJvZHkpIHsKCSAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgX3RoaXMyLnNob3cob3B0aW9ucyk7CgkgICAgICAgIH0sIDUwKTsKCgkgICAgICAgIHJldHVybjsKCSAgICAgIH0gZWxzZSB7CgkgICAgICAgIHRoaXMuaXNOb3RpZmljYXRpb25BY3RpdmUgPSB0cnVlOwoKCSAgICAgICAgdGhpcy5yZW5kZXIoKTsKCSAgICAgIH0KCSAgICB9CgkgIH0sIHsKCSAgICBrZXk6ICdyZW5kZXInLAoJICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXIoKSB7CgkgICAgICB2YXIgX3RoaXMzID0gdGhpczsKCgkgICAgICB2YXIgZGF0YSA9IHRoaXMuZ2V0SWZyYW1lRGF0YSgpOwoJICAgICAgdGhpcy50b2FzdCA9ICgwLCBfalF1ZXJ5Mi5kZWZhdWx0KSgnPGlmcmFtZSBpZD0icGItdG9hc3QtbWFpbiIgY2xhc3M9IicgKyB0aGlzLmdldENTU0NsYXNzKCkgKyAnIj4nKS5vbignbG9hZCcsIGZ1bmN0aW9uICgpIHsKCSAgICAgICAgaWYgKF90aGlzMy5vcHRpb25zLnF1aWNrT3BlbikgewoJICAgICAgICAgIF90aGlzMy50b2FzdC5zaG93KCkuYWRkQ2xhc3MoJ3BiLXRvYXN0LW1haW4tc2hvdycpOwoJICAgICAgICB9IGVsc2UgewoJICAgICAgICAgIF90aGlzMy50b2FzdC5zaG93KCkuYWRkQ2xhc3MoJ3BiLXRvYXN0LW1haW4tbW92ZScpOwoJICAgICAgICB9CgoJICAgICAgICBpZiAoIV90aGlzMy5vcHRpb25zLnBlcnNpc3RlbnQpIHsKCSAgICAgICAgICBfdGhpczMucXVldWVGYWRlVGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwoJICAgICAgICAgIF90aGlzMy5xdWV1ZUZhZGUoNTAwMCwgX3RoaXMzLm9wdGlvbnMub25GYWRlT3V0KTsKCSAgICAgICAgfQoJICAgICAgfSkub24oJ21vdXNlZW50ZXInLCBmdW5jdGlvbiAoKSB7CgkgICAgICAgIGlmICghX3RoaXMzLm9wdGlvbnMucGVyc2lzdGVudCkgewoJICAgICAgICAgIF90aGlzMy5jYW5jZWxGYWRlKCk7CgkgICAgICAgIH0KCSAgICAgIH0pLm9uKCdtb3VzZWxlYXZlJywgZnVuY3Rpb24gKCkgewoJICAgICAgICBpZiAoIV90aGlzMy51c2VyR2VuZXJhdGVkQ2xvc2UgJiYgIV90aGlzMy5vcHRpb25zLnBlcnNpc3RlbnQpIHsKCSAgICAgICAgICBfdGhpczMucXVldWVGYWRlKDUwMDAsIF90aGlzMy5vcHRpb25zLm9uRmFkZU91dCk7CgkgICAgICAgIH0KCSAgICAgIH0pLm9uKCd0cmFuc2l0aW9uZW5kJywgZnVuY3Rpb24gKCkgewoJICAgICAgICBpZiAoIV90aGlzMy50b2FzdC5pcygnLnBiLXRvYXN0LW1haW4tbW92ZScpKSB7CgkgICAgICAgICAgX3RoaXMzLnJlbW92ZSgpOwoJICAgICAgICB9CgkgICAgICB9KS5hdHRyKCdzcmMnLCBkYXRhKS5hcHBlbmRUbygnYm9keScpOwoJICAgIH0KCSAgfSwgewoJICAgIGtleTogJ2dldENTU0NsYXNzJywKCSAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Q1NTQ2xhc3MoKSB7CgkgICAgICByZXR1cm4gJ3BiLXRvYXN0LW1haW4gJyArICh0aGlzLm9wdGlvbnMuY3NzQ2xhc3MgfHwgJycpOwoJICAgIH0KCSAgfSwgewoJICAgIGtleTogJ2luaXQnLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBpbml0KG9wdGlvbnMpIHsKCSAgICAgIHRoaXMucmVtb3ZlKCk7CgoJICAgICAgdGhpcy50b2FzdElkID0gKDAsIF91dGlscy5HVUlEKSgpOwoJICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9uczsKCSAgICAgIHRoaXMudXNlckdlbmVyYXRlZENsb3NlID0gZmFsc2U7CgkgICAgICB0aGlzLnF1ZXVlRmFkZVRpbWUgPSBudWxsOwoJICAgIH0KCSAgfSwgewoJICAgIGtleTogJ3JlbW92ZScsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZSgpIHsKCSAgICAgIHRoaXMuaGlkZVRvb2x0aXAoKTsKCgkgICAgICBpZiAodGhpcy5maWQpIHsKCSAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuZmlkKTsKCSAgICAgIH0KCgkgICAgICBpZiAodGhpcy50b2FzdCkgewoJICAgICAgICB0aGlzLnRvYXN0LnJlbW92ZSgpOwoJICAgICAgfQoKCSAgICAgIGlmICh0aGlzLmlzTm90aWZpY2F0aW9uQWN0aXZlKSB7CgkgICAgICAgIHRoaXMuaXNOb3RpZmljYXRpb25BY3RpdmUgPSBmYWxzZTsKCgkgICAgICAgIGlmICghdGhpcy5vcHRpb25zLnN0b3BRdWV1ZSAmJiB0aGlzLnF1ZXVlLmxlbmd0aCkgewoJICAgICAgICAgIHRoaXMuc2hvdyh0aGlzLmdldE5leHRRdWV1ZUl0ZW0oKSk7CgkgICAgICAgIH0KCSAgICAgIH0KCSAgICB9CgkgIH0sIHsKCSAgICBrZXk6ICdxdWV1ZUZhZGUnLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBxdWV1ZUZhZGUodGltZSwgb25GYWRlT3V0KSB7CgkgICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCgkgICAgICB0aGlzLmZpZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewoJICAgICAgICBfdGhpczQudG9hc3QuYXR0cignY2xhc3MnLCBfdGhpczQuZ2V0Q1NTQ2xhc3MoKSk7CgoJICAgICAgICBpZiAob25GYWRlT3V0KSB7CgkgICAgICAgICAgb25GYWRlT3V0KCk7CgkgICAgICAgIH0KCSAgICAgIH0sIHRpbWUpOwoJICAgIH0KCSAgfSwgewoJICAgIGtleTogJ2NhbmNlbEZhZGUnLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBjYW5jZWxGYWRlKCkgewoJICAgICAgaWYgKCF0aGlzLnRvYXN0LmlzKCcucGItdG9hc3QtbWFpbi1tb3ZlJykpIHsKCSAgICAgICAgdGhpcy50b2FzdC5hZGRDbGFzcygncGItdG9hc3QtbWFpbi1tb3ZlJyk7CgkgICAgICB9CgoJICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuZmlkKTsKCSAgICB9CgkgIH0sIHsKCSAgICBrZXk6ICdzaG93VG9vbHRpcCcsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIHNob3dUb29sdGlwKF9yZWYpIHsKCSAgICAgIHZhciBpZCA9IF9yZWYuaWQsCgkgICAgICAgICAgcG9zaXRpb24gPSBfcmVmLnBvc2l0aW9uOwoKCSAgICAgIHZhciB0b2FzdFBvc2l0aW9uID0gdGhpcy50b2FzdC5nZXQoMCkuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CgkgICAgICB2YXIgdG9vbHRpcFBvc2l0aW9uID0gewoJICAgICAgICBsZWZ0OiB0b2FzdFBvc2l0aW9uLmxlZnQgKyBwb3NpdGlvbi54Q2VudGVyLAoJICAgICAgICB0b3A6IHRvYXN0UG9zaXRpb24udG9wICsgcG9zaXRpb24ueUNlbnRlciArIDE1CgkgICAgICB9OwoJICAgICAgdmFyIHRvb2x0aXAgPSB0aGlzLnJlbmRlclRvb2x0aXAoaWQpOwoKCSAgICAgIHRvb2x0aXAuY3NzKHsKCSAgICAgICAgJ3RvcCc6IHRvb2x0aXBQb3NpdGlvbi50b3AsCgkgICAgICAgICdsZWZ0JzogdG9vbHRpcFBvc2l0aW9uLmxlZnQgLSAodG9vbHRpcC5vdXRlcldpZHRoKCkgLSA3MCkKCSAgICAgIH0pOwoJICAgIH0KCSAgfSwgewoJICAgIGtleTogJ2hpZGVUb29sdGlwJywKCSAgICB2YWx1ZTogZnVuY3Rpb24gaGlkZVRvb2x0aXAoKSB7CgkgICAgICAoMCwgX2pRdWVyeTIuZGVmYXVsdCkoJyNwYl9qcV90aXBzV3JhcHBlcicpLnJlbW92ZSgpOwoJICAgIH0KCSAgfSwgewoJICAgIGtleTogJ3JlbmRlclRvb2x0aXAnLAoJICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXJUb29sdGlwKGlkKSB7CgkgICAgICB0aGlzLmhpZGVUb29sdGlwKCk7CgoJICAgICAgcmV0dXJuICgwLCBfalF1ZXJ5Mi5kZWZhdWx0KSgnPGRpdiBpZD0icGJfanFfdGlwc1dyYXBwZXIiPicgKyAoMCwgX3V0aWxzLmdldEkxOE4pKGlkKSArICc8L2Rpdj4nKS5hcHBlbmRUbygnYm9keScpOwoJICAgIH0KCSAgfSwgewoJICAgIGtleTogJ3Nob3dMaW5rQ29waWVkJywKCSAgICB2YWx1ZTogZnVuY3Rpb24gc2hvd0xpbmtDb3BpZWQoaWNvblBvc2l0aW9uKSB7CgkgICAgICB2YXIgdG9hc3RQb3NpdGlvbiA9IHRoaXMudG9hc3QuZ2V0KDApLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwoJICAgICAgdmFyIHBvc2l0aW9uID0gewoJICAgICAgICBsZWZ0OiB0b2FzdFBvc2l0aW9uLmxlZnQgKyBpY29uUG9zaXRpb24ubGVmdCwKCSAgICAgICAgdG9wOiB0b2FzdFBvc2l0aW9uLnRvcCArIGljb25Qb3NpdGlvbi50b3AKCSAgICAgIH07CgoJICAgICAgKDAsIF9qUXVlcnkyLmRlZmF1bHQpKCcjcGItbGluay1jb3BpZWQtbWVzc2FnZScpLnJlbW92ZSgpOwoJICAgICAgdmFyIG1zZyA9ICgwLCBfalF1ZXJ5Mi5kZWZhdWx0KSgnPGRpdiBpZD0icGItbGluay1jb3BpZWQtbWVzc2FnZSI+JyArICgwLCBfdXRpbHMuZ2V0STE4TikoJ05URl9MaW5rQ29waWVkJykgKyAnPC9kaXY+JykuY3NzKHsKCSAgICAgICAgdG9wOiBwb3NpdGlvbi50b3AgKyAzMSwKCSAgICAgICAgbGVmdDogcG9zaXRpb24ubGVmdCAtIDMwCgkgICAgICB9KS5hcHBlbmRUbygnYm9keScpLnNob3coKS5hbmltYXRlKHsKCSAgICAgICAgb3BhY2l0eTogMQoJICAgICAgfSwgMjUwKTsKCgkgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIG1zZy5hbmltYXRlKHsgb3BhY2l0eTogMCB9LCAyNTAsIGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICByZXR1cm4gbXNnLnJlbW92ZSgpOwoJICAgICAgICB9KTsKCSAgICAgIH0sIDIwMDApOwoJICAgIH0KCSAgfSwgewoJICAgIGtleTogJ2dldElmcmFtZURhdGEnLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRJZnJhbWVEYXRhKCkgewoJICAgICAgdmFyIGRhdGEgPSB7CgkgICAgICAgIGlkOiB0aGlzLnRvYXN0SWQsCgkgICAgICAgIHRpdGxlOiB0aGlzLm9wdGlvbnMudGl0bGUsCgkgICAgICAgIHN1YlRpdGxlOiB0aGlzLm9wdGlvbnMuc3ViVGl0bGUgfHwgJycsCgkgICAgICAgIGJ1dHRvbnM6IE9iamVjdC5rZXlzKHRoaXMub3B0aW9ucy5idXR0b25zIHx8IHt9KS5tYXAoZnVuY3Rpb24gKGlkKSB7CgkgICAgICAgICAgcmV0dXJuIHsgaWQ6IGlkLCBsYWJlbDogKDAsIF91dGlscy5nZXRJMThOKShpZCkgfTsKCSAgICAgICAgfSksCgkgICAgICAgIHNob3dIaWRlOiB0aGlzLm9wdGlvbnMuc2hvd0hpZGUsCgkgICAgICAgIHNob3dSZXNpemU6IHRoaXMub3B0aW9ucy5zaG93UmVzaXplLAoJICAgICAgICBzb3VyY2U6IHRoaXMub3B0aW9ucy5zb3VyY2UgfHwgJycsCgkgICAgICAgIHByb3BzOiB7CgkgICAgICAgICAgZG9tYWluOiBkb2N1bWVudC5kb21haW4sCgkgICAgICAgICAgd2luQXJnczogdGhpcy5vcHRpb25zLndpbkFyZ3MgfHwgW10KCSAgICAgICAgfQoJICAgICAgfTsKCSAgICAgIHZhciBodG1sID0gdGhpcy5ub3RpZmljYXRpb25IVE1MLnJlcGxhY2UoJy8vQERBVEEnLCBlbmNvZGVVUklDb21wb25lbnQoSlNPTi5zdHJpbmdpZnkoZGF0YSkpKTsKCgkgICAgICByZXR1cm4gJ2RhdGE6dGV4dC9odG1sO2Jhc2U2NCwnICsgYnRvYShodG1sKTsKCSAgICB9CgkgIH1dKTsKCgkgIHJldHVybiBOb3RpZmljYXRpb247Cgl9KCk7CgoJZXhwb3J0cy5kZWZhdWx0ID0gTm90aWZpY2F0aW9uOwoKLyoqKi8gfSksCi8qIDggKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykgewoKCSJ1c2Ugc3RyaWN0IjsKCglPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CgkgIHZhbHVlOiB0cnVlCgl9KTsKCgl2YXIgX2NyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0oKTsKCglleHBvcnRzLm5vdyA9IG5vdzsKCWV4cG9ydHMuYWRkU2NyaXB0ID0gYWRkU2NyaXB0OwoJZXhwb3J0cy5yZW1vdmVTY3JpcHQgPSByZW1vdmVTY3JpcHQ7CglleHBvcnRzLmV4ZWN1dGVDb2RlID0gZXhlY3V0ZUNvZGU7CglleHBvcnRzLmlzRG9tYWluSW5MaXN0ID0gaXNEb21haW5Jbkxpc3Q7CglleHBvcnRzLnRvUXVlcnlTdHJpbmcgPSB0b1F1ZXJ5U3RyaW5nOwoJZXhwb3J0cy5yYW5kSWQgPSByYW5kSWQ7CglleHBvcnRzLkdVSUQgPSBHVUlEOwoJZXhwb3J0cy51cGRhdGVXaGl0ZWxpc3QgPSB1cGRhdGVXaGl0ZWxpc3Q7CglleHBvcnRzLmdldEkxOE4gPSBnZXRJMThOOwoJZXhwb3J0cy5nZXRCcm93c2VyID0gZ2V0QnJvd3NlcjsKCWV4cG9ydHMuZ2V0UmFuZG9tSW50ID0gZ2V0UmFuZG9tSW50OwoJZXhwb3J0cy5pc1ZhbGlkVXJsID0gaXNWYWxpZFVybDsKCWV4cG9ydHMuZ2V0QWJzb2x1dGVVUkwgPSBnZXRBYnNvbHV0ZVVSTDsKCWV4cG9ydHMuaW5zZXJ0QmVmb3JlUm9vdCA9IGluc2VydEJlZm9yZVJvb3Q7CglleHBvcnRzLnNlbmRHb29nbGVBbmFseXRpY3NFdmVudCA9IHNlbmRHb29nbGVBbmFseXRpY3NFdmVudDsKCglmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCglmdW5jdGlvbiBub3coKSB7CgkgIHJldHVybiBNYXRoLmZsb29yKERhdGUubm93KCkgLyAxMDAwKTsKCX0KCglmdW5jdGlvbiBhZGRTY3JpcHQodGVtcGxhdGUpIHsKCSAgdmFyIHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTsKCSAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiMiICsgdGVtcGxhdGUuaWQpICE9IHVuZGVmaW5lZCkgewoJICAgIHJldHVybjsKCSAgfQoJICBpZiAodGVtcGxhdGUuc3JjKSB7CgkgICAgcy5zcmMgPSB0ZW1wbGF0ZS5zcmM7CgkgIH0KCSAgaWYgKHRlbXBsYXRlLnRleHRDb250ZW50KSB7CgkgICAgcy50ZXh0Q29udGVudCA9IHRlbXBsYXRlLnRleHRDb250ZW50OwoJICB9CgkgIHMuc2V0QXR0cmlidXRlKCJpZCIsIHRlbXBsYXRlLmlkKTsKCSAgaW5zZXJ0QmVmb3JlUm9vdChzKTsKCX0KCglmdW5jdGlvbiByZW1vdmVTY3JpcHQodGVtcGxhdGUpIHsKCSAgdmFyIGFkZGVkU2NyaXB0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiIyIgKyB0ZW1wbGF0ZS5pZCk7CgkgIGlmIChhZGRlZFNjcmlwdCAhPSB1bmRlZmluZWQpIHsKCSAgICBhZGRlZFNjcmlwdC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGFkZGVkU2NyaXB0KTsKCSAgfQoJfQoKCWZ1bmN0aW9uIGV4ZWN1dGVDb2RlKGNvZGUpIHsKCSAgdmFyIHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTsKCSAgcy50ZXh0Q29udGVudCA9IGNvZGU7CgkgIGluc2VydEJlZm9yZVJvb3Qocyk7CgoJICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKCSAgICBzLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQocyk7CgkgIH0sIDUwKTsKCX0KCgkvKioKCSAqIENoZWNrcyB3aGV0aGVyIGRvbWFpbiBmaXRzIHRoZSB3aGl0ZWxpc3QKCSAqIEBwYXJhbSBTdHJpbmcgZG9tYWluCgkgKiBAcGFyYW0gQXJyYXkgW1N0cmluZ10gZG9tYWluTGlzdAoJICogQHJldHVybnMge2Jvb2xlYW59CgkgKi8KCWZ1bmN0aW9uIGlzRG9tYWluSW5MaXN0KGRvbWFpbiwgZG9tYWluTGlzdCwgcmV0dXJuVmFsdWUpIHsKCSAgZG9tYWluTGlzdCA9IGRvbWFpbkxpc3QgfHwgW107CgoJICBmb3IgKHZhciBpID0gMDsgaSA8IGRvbWFpbkxpc3QubGVuZ3RoOyBpKyspIHsKCSAgICB2YXIgZG9tYWluVGFpbCA9IGRvbWFpbkxpc3RbaV07CgkgICAgaWYgKG5ldyBSZWdFeHAoIlxcYlsod3d3XFwuKXwuKlwuXT8iICsgZG9tYWluVGFpbCArICJcXGIiKS50ZXN0KGRvbWFpbikpIHsKCSAgICAgIHJldHVybiByZXR1cm5WYWx1ZSA/IGRvbWFpblRhaWwgOiB0cnVlOwoJICAgIH0KCSAgfQoJICByZXR1cm4gZmFsc2U7Cgl9CgoJZnVuY3Rpb24gdG9RdWVyeVN0cmluZyhvYmopIHsKCSAgcmV0dXJuIE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uIChrZXkpIHsKCSAgICByZXR1cm4gISFvYmpba2V5XSB8fCBmYWxzZSA9PT0gb2JqW2tleV07CgkgIH0pLm1hcChmdW5jdGlvbiAoa2V5KSB7CgkgICAgcmV0dXJuIGtleSArICc9JyArIG9ialtrZXldOwoJICB9KS5qb2luKCcmJyk7Cgl9CgoJZnVuY3Rpb24gcmFuZElkKCkgewoJICB2YXIgcmFuZGlkID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oInJhbmRpZCIpOwoJICBpZiAoIXJhbmRpZCkgewoJICAgIHZhciByciA9IGZ1bmN0aW9uIHJyKCkgewoJICAgICAgcmV0dXJuICgoMSArIE1hdGgucmFuZG9tKERhdGUubm93KCkgKyAxNCkpICogMHgxMDAwMCB8IDApLnRvU3RyaW5nKDI4KS5zdWJzdHJpbmcoMSk7CgkgICAgfTsKCSAgICByYW5kaWQgPSBycigpICsgcnIoKSArIHJyKCkgKyBycigpICsgcnIoKSArIHJyKCkgKyBycigpICsgcnIoKSArIHJyKCk7CgkgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oInJhbmRpZCIsIHJhbmRpZCk7CgkgIH0KCSAgcmV0dXJuIHJhbmRpZDsKCX0KCglmdW5jdGlvbiBHVUlEKCkgewoJICByZXR1cm4gJ3h4eHh4eHh4LXh4eHgtNHh4eC15eHh4LXh4eHh4eHh4eHh4eCcucmVwbGFjZSgvW3h5XS9nLCBmdW5jdGlvbiAoYykgewoJICAgIHZhciByID0gTWF0aC5yYW5kb20oKSAqIDE2IHwgMCwKCSAgICAgICAgdiA9IGMgPT0gJ3gnID8gciA6IHIgJiAweDMgfCAweDg7CgkgICAgcmV0dXJuIHYudG9TdHJpbmcoMTYpOwoJICB9KTsKCX0KCgl2YXIgUmV0ZW5zaW9uID0gZXhwb3J0cy5SZXRlbnNpb24gPSBmdW5jdGlvbiAoKSB7CgkgIGZ1bmN0aW9uIFJldGVuc2lvbihjb25mKSB7CgkgICAgdmFyIF90aGlzID0gdGhpczsKCgkgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFJldGVuc2lvbik7CgoJICAgIHRoaXMuU3RvcmFnZSA9IGNvbmYuU3RvcmFnZTsKCSAgICB0aGlzLkdBRXZlbnRzID0gY29uZi5HQUV2ZW50czsKCSAgICB0aGlzLmxhc3RSZXRlbnRpb25EYXkgPSAyODsKCSAgICB0aGlzLm1pbkhvdXJzRnJvbUluc3RhbGwgPSA4OwoKCSAgICB0aGlzLlN0b3JhZ2UucmVxdWVzdEdldCgpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHsKCSAgICAgIF90aGlzLmRhdGEgPSBfdGhpcy5pbml0aWFsaXplKGRhdGEpOwoKCSAgICAgIF90aGlzLnJlcG9ydCgpOwoJICAgIH0pOwoJICB9CgoJICBfY3JlYXRlQ2xhc3MoUmV0ZW5zaW9uLCBbewoJICAgIGtleTogImluaXRpYWxpemUiLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBpbml0aWFsaXplKGRhdGEpIHsKCSAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKCSAgICAgIGlmIChkYXRhICYmIGRhdGEuaW5zdGFsbERhdGUgJiYgZGF0YS5zZW50RGF5cykgewoJICAgICAgICByZXR1cm4gZGF0YTsKCSAgICAgIH0gZWxzZSB7CgkgICAgICAgIGRhdGEgPSBkYXRhIHx8IHt9OwoJICAgICAgICBkYXRhLmluc3RhbGxEYXRlID0gZGF0YS5pbnN0YWxsRGF0ZSA/IGRhdGEuaW5zdGFsbERhdGUgOiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgX3RoaXMyLkdBRXZlbnRzLkluc3RhbGwoKTsKCgkgICAgICAgICAgcmV0dXJuIERhdGUubm93KCk7CgkgICAgICAgIH0oKTsKCSAgICAgICAgZGF0YS5zZW50RGF5cyA9IGRhdGEuc2VudERheXMgfHwge307CgoJICAgICAgICB0aGlzLlN0b3JhZ2UucmVxdWVzdFNldChkYXRhKTsKCgkgICAgICAgIHJldHVybiBkYXRhOwoJICAgICAgfQoJICAgIH0KCSAgfSwgewoJICAgIGtleTogInJlcG9ydCIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIHJlcG9ydCgpIHsKCSAgICAgIGlmICghdGhpcy5kYXRhLmNvbXBsZXRlZCkgewoJICAgICAgICB0aGlzLnJlcG9ydFJldGVudG9pbigpOwoJICAgICAgfQoKCSAgICAgIHRoaXMucmVwb3J0QWxpdmUoKTsKCgkgICAgICBzZXRUaW1lb3V0KHRoaXMucmVwb3J0LmJpbmQodGhpcyksIDEwMDAgKiA2MCAqIDYwKTsKCSAgICB9CgkgIH0sIHsKCSAgICBrZXk6ICJyZXBvcnRSZXRlbnRvaW4iLAoJICAgIHZhbHVlOiBmdW5jdGlvbiByZXBvcnRSZXRlbnRvaW4oKSB7CgkgICAgICB2YXIgbm93ID0gbmV3IERhdGUoKTsKCSAgICAgIHZhciBpbnN0YWxsRGF0ZSA9IG5ldyBEYXRlKHRoaXMuZGF0YS5pbnN0YWxsRGF0ZSk7CgkgICAgICB2YXIgaW5zdGFsbFN0YXJ0ID0gdGhpcy5nZXREYXRlU3RhcnQoaW5zdGFsbERhdGUpOwoJICAgICAgdmFyIHRvZGF5U3RhcnQgPSB0aGlzLmdldERhdGVTdGFydChub3cpOwoJICAgICAgdmFyIG1zU3RhcnREaWZmID0gTWF0aC5hYnModG9kYXlTdGFydCAtIGluc3RhbGxTdGFydCk7CgkgICAgICB2YXIgaG91cnNGcm9tVHJ1ZUluc3RhbGwgPSBNYXRoLmZsb29yKChub3cgLSBpbnN0YWxsRGF0ZSkgLyAoMTAwMCAqIDYwICogNjApKTsKCSAgICAgIHZhciBkYXlzRGlmZiA9IE1hdGguZmxvb3IobXNTdGFydERpZmYgLyAoMTAwMCAqIDYwICogNjAgKiAyNCkpOwoKCSAgICAgIGlmIChkYXlzRGlmZiA+IDAgJiYgZGF5c0RpZmYgPD0gdGhpcy5sYXN0UmV0ZW50aW9uRGF5KSB7CgkgICAgICAgIGlmICghdGhpcy5kYXRhLnNlbnREYXlzW2RheXNEaWZmXSAmJiBob3Vyc0Zyb21UcnVlSW5zdGFsbCA+IHRoaXMubWluSG91cnNGcm9tSW5zdGFsbCkgewoJICAgICAgICAgIHRoaXMuR0FFdmVudHMuUmV0ZW50b2luKGRheXNEaWZmKTsKCgkgICAgICAgICAgdGhpcy5kYXRhLnNlbnREYXlzW2RheXNEaWZmXSA9IHRydWU7CgkgICAgICAgICAgdGhpcy5TdG9yYWdlLnJlcXVlc3RTZXQodGhpcy5kYXRhKTsKCSAgICAgICAgfQoJICAgICAgfSBlbHNlIGlmIChkYXlzRGlmZiA+IHRoaXMubGFzdFJldGVudGlvbkRheSkgewoJICAgICAgICB0aGlzLmRhdGEuY29tcGxldGVkID0gdHJ1ZTsKCgkgICAgICAgIHRoaXMuU3RvcmFnZS5yZXF1ZXN0U2V0KHRoaXMuZGF0YSk7CgkgICAgICB9CgkgICAgfQoJICB9LCB7CgkgICAga2V5OiAicmVwb3J0QWxpdmUiLAoJICAgIHZhbHVlOiBmdW5jdGlvbiByZXBvcnRBbGl2ZSgpIHsKCSAgICAgIHZhciBub3cgPSBuZXcgRGF0ZSgpOwoJICAgICAgdmFyIGxhc3RBbGl2ZVRpbWUgPSB0aGlzLmRhdGEubGFzdEFsaXZlVGltZTsKCSAgICAgIHZhciB0b2RheVN0YXJ0ID0gdGhpcy5nZXREYXRlU3RhcnQobm93KS5nZXRUaW1lKCk7CgoJICAgICAgaWYgKCFsYXN0QWxpdmVUaW1lIHx8IGxhc3RBbGl2ZVRpbWUgKiAxIDwgdG9kYXlTdGFydCkgewoJICAgICAgICB0aGlzLkdBRXZlbnRzLkFsaXZlKCk7CgoJICAgICAgICB0aGlzLmRhdGEubGFzdEFsaXZlVGltZSA9IG5vdy5nZXRUaW1lKCk7CgkgICAgICAgIHRoaXMuU3RvcmFnZS5yZXF1ZXN0U2V0KHRoaXMuZGF0YSk7CgkgICAgICB9CgkgICAgfQoJICB9LCB7CgkgICAga2V5OiAiZ2V0RGF0ZVN0YXJ0IiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0RGF0ZVN0YXJ0KGRhdGUpIHsKCSAgICAgIHJldHVybiBuZXcgRGF0ZShkYXRlLmdldEZ1bGxZZWFyKCksIGRhdGUuZ2V0TW9udGgoKSwgZGF0ZS5nZXRIb3VycygpID49IDAgJiYgZGF0ZS5nZXRIb3VycygpIDwgNSA/IGRhdGUuZ2V0RGF0ZSgpIC0gMSA6IGRhdGUuZ2V0RGF0ZSgpLCA1LCAwLCAxKTsgLy9kYXkgc3RhcnRzIGF0IDVQTQoJICAgIH0KCSAgfV0pOwoKCSAgcmV0dXJuIFJldGVuc2lvbjsKCX0oKTsKCglmdW5jdGlvbiB1cGRhdGVXaGl0ZWxpc3QoUEJTdG9yYWdlU3luYykgewoJICBQQlN0b3JhZ2VTeW5jLm1hbnkoUEJTdG9yYWdlU3luYy5wYl9kZWZhdWx0V2hpdGVsaXN0LCBQQlN0b3JhZ2VTeW5jLnBiX3doaXRlbGlzdCwgUEJTdG9yYWdlU3luYy5wYl9mdWxsV2hpdGVsaXN0KS51cGRhdGUoZnVuY3Rpb24gKHNldHRpbmdzKSB7CgkgICAgc2V0dGluZ3MucGJfZnVsbFdoaXRlbGlzdCA9IHNldHRpbmdzLnBiX2RlZmF1bHRXaGl0ZWxpc3QuY29uY2F0KHNldHRpbmdzLnBiX3doaXRlbGlzdCkudW5pcXVlKCk7CgoJICAgIHJldHVybiBzZXR0aW5nczsKCSAgfSk7Cgl9CgoJZnVuY3Rpb24gZ2V0STE4Tihtc2dOYW1lLCBhbHRlcm5hdGl2ZSkgewoJICB2YXIgbGFuZyA9IG5hdmlnYXRvci5sYW5ndWFnZS50b0xvd2VyQ2FzZSgpID09ICd6aC1jbicgPyAnQ04nIDogJ0VOJzsKCgkgIHJldHVybiAoTEFOR1tsYW5nXVttc2dOYW1lXSB8fCBMQU5HW2xhbmddW2FsdGVybmF0aXZlXSB8fCB7ICJtZXNzYWdlIjogbXNnTmFtZSB9KS5tZXNzYWdlOwoJfQoKCWZ1bmN0aW9uIGdldEJyb3dzZXIoKSB7CgkgIGlmICgvZmlyZWZveC9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpIHsKCSAgICByZXR1cm4gJ0ZGJzsKCSAgfQoKCSAgcmV0dXJuICdDSCc7Cgl9CgoJZnVuY3Rpb24gZ2V0UmFuZG9tSW50KG1pbiwgbWF4KSB7CgkgIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAobWF4IC0gbWluKSkgKyBtaW47Cgl9CgoJZnVuY3Rpb24gaXNWYWxpZFVybCh1cmwpIHsKCSAgcmV0dXJuIHVybC5pbmRleE9mKCJodHRwIikgPT09IDAgJiYgIXVybC5pbmNsdWRlcygiOi8vbG9jYWxob3N0IikgJiYgIXVybC5pbmNsdWRlcygiY2hyb21lL25ld3RhYiIpOwoJfQoKCWZ1bmN0aW9uIGdldEFic29sdXRlVVJMKGJhc2VVUkwpIHsKCSAgaWYgKC9eYWJvdXQ6YmxhbmsvaS50ZXN0KGJhc2VVUkwpKSB7CgkgICAgcmV0dXJuIGJhc2VVUkw7CgkgIH0KCgkgIGlmICgvXihodHRwcz86KT9cL1wvLy50ZXN0KGJhc2VVUkwpKSB7CgkgICAgcmV0dXJuIGJhc2VVUkw7CgkgIH0KCgkgIGJhc2VVUkwgPSBsb2NhdGlvbi5vcmlnaW4gKyAoIS9eXC8vLnRlc3QoYmFzZVVSTCkgPyAnLycgOiAnJykgKyBiYXNlVVJMOwoKCSAgcmV0dXJuIGJhc2VVUkw7Cgl9CgoJZnVuY3Rpb24gaW5zZXJ0QmVmb3JlUm9vdChkb20pIHsKCSAgdmFyIHJvb3REb2N1bWVudCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKCSAgcm9vdERvY3VtZW50Lmluc2VydEJlZm9yZShkb20sIHJvb3REb2N1bWVudC5maXJzdENoaWxkKTsKCX0KCglmdW5jdGlvbiBzZW5kR29vZ2xlQW5hbHl0aWNzRXZlbnQoZGF0YSkgewoJICBzZW5kTWVzc2FnZVRvQmFja2dyb3VuZCh7CgkgICAgbmFtZTogInRyYWNrRXZlbnQiLAoJICAgIGNhdGVnb3J5OiBkYXRhLmNhdGVnb3J5LAoJICAgIGFjdGlvbjogZGF0YS5hY3Rpb24sCgkgICAgbGFiZWw6IGRhdGEubGFiZWwsCgkgICAgaXNDb3VudDogZGF0YS5pc0NvdW50CgkgIH0pOwoJfQoKLyoqKi8gfSksCi8qIDkgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykgewoKCSJ1c2Ugc3RyaWN0IjsKCglPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CgkgIHZhbHVlOiB0cnVlCgl9KTsKCXZhciBDb25maWcgPSB7CgkgICJkZWZhdWx0V2hpdGVMaXN0IjogWyJlbmdhZ2Uud2l4YXBwcy5uZXQiLCAibGlua2VkaW4uY29tIiwgImdvb2dsZSIsICJ3d3cuZ21haWwuY29tIiwgInd3dy5waW50ZXJlc3QuY29tIiwgInd3dy55b3V0dWJlLmNvbSIsICJ3d3cuZmFjZWJvb2suY29tIiwgInNlYXJjaC55YWhvby5jb20iLCAiY2hyb21lOi8vbmV3dGFiIiwgInd3dy5mb29kLmNvbSJdLAoJICAiZGVmYXVsdEJsYWNrTGlzdCI6IFsiYWRydW5uciIsICJzdWNjZXNzZm9yeXUuY2xpY2tmdW5uZWxzLmNvbSIsICJmbW92aWVzLnNlIiwgImluLTM2NS10YWdlbi5pbmZvIiwgIjUwMDAtc2V0dGltYW5hbGUuY29tIiwgInNob3AubWF6enVnaW9pZWxsaS5jb20iLCAibWF4aWdvc3NpcC5jb20iLCAibHAueWF6aXppbS5jb20iLCAiYmV5b3VyeGZyaWVuZC5jb20iLCAiOTl0YWIuY29tIiwgInp6cXJ0LmNvbSIsICJjYW51Y2stbWV0aG9kLm5ldCIsICJiZXdvbWVubHkuY29tIiwgInBsYXlub3cuZ3VydSIsICJkYXRpbmdmb3J5b3UtNDhlMS5reGNkbi5jb20iLCAidHJhZmZpY25ldHdvcmthZHMyNC5jb20iLCAic2lzdGVtYWRlZGluZXJvZ3JhdGlzLmNvbSIsICJjYW51Y2ttZXRob2Rwcm9maXQuY28iLCAiY29uc3VtZXJyZXNlYXJjaG5ldHdvcmsuY29tIiwgInNlY3VyZW1hY2ZpeC5jb20iLCAienozZDMucnUiLCAiemQxLnF1ZWJlYy1iaW4uY29tIiwgImhvdC1nYW1lczR5b3UueHl6IiwgIm9tLmVsdmVuYXIuY29tIiwgInN1cGVycGNjbGVhbnVwLmNvbSIsICJnb21lZGlhei5jb20iLCAianVkaXRoaS54eXoiLCAiZnJlZS5hdG96bWFudWFscy5jb20iLCAieW91cnN1Y2Nlc3MucmF2cGFnZS5jby5pbCIsICIxMjNob3AuaXIiLCAicXVpemNsaWVudGUucHciLCAiYXVzc2llbWV0aG9kLmJpeiIsICJobHBub3dwLWMuY29tIiwgInBpY2J1bXBlci5jb20iLCAic2hhbmVsZXNzLmNvbSIsICJhbmFjb25kYW1vbnN0ZXIuY29tIiwgImFsdHJrMS5jb20iLCAiaGVhbHRoLnRvZGF5ZGlldHMuY29tIiwgImRvd25sb2FkLndlYXRoZXJibGluay5jb20iLCAiaGFwcHlsdWtldGguY29tIiwgImdvLmFtZWluZm8uY29tIiwgIjUwa2F3ZWVrLm5ldCIsICJ0aGVwb3Juc3VydmV5LmNvbSIsICJvZnNpaXRlLnJ1IiwgImZ1bGx0YWIuY29tIiwgIjEwMDBzcGlucy5jb20iLCAidGltZTJwbGF5LW9ubGluZS5uZXQiLCAidmludGFjYXJzLmNvbSIsICJ3ZWxjb21lLnB1c3N5c2FnYS5jb20iLCAiZnJlZS1kZXNrdG9wLWdhbWVzLmNvbSIsICJkb3dubG9hZC50ZWxldmlzaW9uZmFuYXRpYy5jb20iLCAidGhlcHJvZml0c21ha2VyLm5ldCIsICJzZ2FkLmluZm8iLCAiYWxnb2Nhc2htYXN0ZXIubmV0IiwgInN1bm1ha2VyLmNvbSIsICJ0b3B2aXBkcmVhbXMuY29tIiwgIndhdGNobXlnaXJsZnJpZW5kLmdmcG9ybnZpZGVvcy5jb20iLCAiZmlsZXNoYXJlZmFuYXRpYy5jb20iLCAic2FmZWRvd25sb2FkaHViLmNvbSIsICI3YXdsYWxhbGFtLmJsb2dzcG90LmNvbSIsICJ0dnBsdXNuZXd0YWIuY29tIiwgInRyZW5kaW5ncGF0cm9sLmNvbSIsICJtb25leW1vcm5pbmcuY29tIiwgImlmaWxleW91LmNvbSIsICJjbGFzc2lmaWVkY2FuYWRhLmNhIiwgImZpcmVmYW4uY29tIiwgIm1ldGhvZGUtYmluYWlyZS5jb20iLCAibGV0bWV0ZWxsLmNvbSIsICJrZW5kdWt0dXIuY29tIiwgImdldGFmdWsuY29tIiwgInlvdHJhbGVwbGFobnRlLnJ1IiwgImphY2twb3QuODhiZXRvLmNvbSIsICJwd3d5c3lkaC5jb20iLCAic2VhcmNoLnF1ZXJ5cm91dGVyLmNvbSIsICJ2Lmx2enR4eS5jb20iLCAicHVzc3lzYWdhLmNvbSIsICJzYWZmYW1ldGhvZC5jb20iLCAicHJlenpvbmxpbmUuY29tIiwgInNlYXJjaHByaXZhY3kud2Vic2l0ZSIsICIzZDI4MTkyMTZlYjRlMTAzNTg3OS03YzI0OGRlMGM5OTc0NTQwNmU5Yjc0OWZjODZlYzNlNC5zc2wuY2YxLnJhY2tjZG4uY29tIiwgIm9ubHkyZGF0ZS5jb20iLCAibXlzYWdhZ2FtZS5jb20iLCAidGhlbWlsbGlvbmFpcmVpbnBqcy5uZXQiLCAid2x0LmtkMjI0NC5jb20iLCAicXVpY2twcml2YWN5Y2hlY2suY29tIiwgImhvdGNoYXRkYXRlLmNvbSIsICJhdXRvdHJhZGVyYm90LmNvbSIsICJ6MS56ZWRvLmNvbSIsICJ5b3VsdWNreTIwMTQuY29tIiwgInRyYWZmaWMuZ2V0bXlhZHMuY29tIiwgImFwcGNsb3VkcHJvdGVjdGVkLmNvbSIsICJzYWZlbnNlY3VyZS5jb20tYWxsc2l0ZXMzLnh5eiIsICJuZXdwb3B0YWIuY29tIiwgInN0YXRpYy53aWxsaWFtaGlsbC5jb20iLCAibXloZWFsdGh5YmxvZy5jbyIsICJncmVhdGVzdG1vYmlkZWFscy5jb20iLCAic3dlZXRjbGFyaXR5LmNvbSIsICJtZ2lkLmNvbSIsICJzZWN1cmVwY2N1cmUuY29tIiwgImF1dG9wZW5nZWJ5Z2dlci5jb20iLCAiYW0xNS5uZXQiLCAiZXMucmVpbWFnZXBsdXMuY29tIiwgIm8yLnByb21vcy1pbmZvLmNvbSIsICJpdC5yZWltYWdlcGx1cy5jb20iLCAid2VzdHNsdXRzLmNvbSIsICJzcGluYW5kd2luLmNvbS1zZXIucHciLCAicmVpbWFnZXBsdXMuY29tIiwgInZvZGFmb25lLnByb21vcy1pbmZvLmNvbSIsICJ2aW5ubWF0cGVuZ2FyLnNlIiwgIm1vdmllLmllbmpveWFwcHMuY29tIiwgImxvdmU0c2luZ2xlLmNvbSIsICJvcmlnaW4uZ2V0cHJpY2UuY29tLmF1IiwgIm9obXlkYXRpbmcuY29tIiwgImxwLndhbnQtdG8td2luLmNvbSIsICJ5YWJ1bGV0Y2hyb21lLnJ1IiwgImJhbWRhZC5uZXQiLCAiZ290b3NpdGVub3cuY29tIiwgInZjcnlwdC5wdyIsICJuZXd0YWJ0di5jb20iLCAibW9uLnNldHN1Lnh5eiIsICJ5b3Vmb3Jnb3R0b3JlbmV3eW91cmhvc3RpbmcuY29tIiwgInpvbmUtdGVsZWNoYXJnZW1lbnQud3MiLCAibGFuZC5wY2tlZXBlci5zb2Z0d2FyZSIsICJhZC5hZHBvcC0xLmNvbSIsICJhZHZhbmNlZHBjdG9vbHMuY29tIiwgInZpZGVvcy5yYW5kb2xwaGNvdW50eWhlcmFsZHRyaWJ1bmUuY29tIiwgIndlYi1zdGFydC5vcmciLCAic29mdHJlYWR5bm93Lmluc3RhbGx1cGdyYWRlbm93ZnJlc2hhbmRmb3J5b3Uud2Vic2l0ZSIsICJ1cGxvZC53cyIsICJwb3JuaHViY2FzaW5vLmNvbSIsICJtYXhiZXQucm8iLCAiMjAxNnByaXplZmVlZC5jb20iLCAidGhldmlkZW8ubWUiLCAid2FudHViYWQuY29tIiwgInRhdmFuZXJvLmNvbSIsICJ4Y3VzbXkuY2x1YiIsICJkYWNsaXBzLmluIiwgImdheW1lbm9mcG9ybi5vbmxpbmUiLCAiamFja3BvdGNpdHljYXNpbm8uY29tIiwgIml0YWxpYW4tbWV0aG9kLmNvbSIsICJnZXRzZWFyY2hpbmNvZ25pdG8uY29tIiwgInlvdWp1c3R3b25wcml6ZS5jb20iLCAiZmluYW56LW5hY2hyaWNodGVuLm1lIiwgInF1aXpjbGllbnRlLnNpdGUiLCAiZGEucmVpbWFnZXBsdXMuY29tIiwgImprYW5pbWUubmV0IiwgImJyaXRtb25leW1ldGhvZC5jb20iLCAidWFlLnNvdXEuY29tIiwgImthLmF6emVyLm5ldCIsICJzYWZlbnNlY3VyZS54eXoiLCAiOHQuaG9vdGluZ3JoZWprei5vbmxpbmUiLCAid3d3Ni5ibGlua3guY29tIiwgIndpenpjYXN0ZXIuY29tIiwgImNvbXBhcmFpc29uLXByaXguY29tIiwgInZvZGxvY2tlci5sb2wiLCAiZnIucmVpbWFnZXBsdXMuY29tIiwgImZyZWUuZnJvbWRvY3RvcGRmLmNvbSIsICJ1c2Vyc2Nsb3VkLmNvbSIsICJteXByaXZhdGVzZWFyY2guY29tIiwgImZhbmxpOTAuY24iLCAidHV0dGljb2RpY2lzY29udG8uaXQiLCAibWVkaWFkZWMuY29tIiwgImdvZ2FtZWdvLnRoZXdoaXpwcm9kdWN0cy5jb20iLCAiZG93bmxvYWQud2VhdGhlcmJsaW5rLmNvbSIsICJmcmVlLnZpZGVvZG93bmxvYWRjb252ZXJ0ZXIuY29tIiwgIndlLWFyZS1nYW1lcnMuY29tIiwgInNlc3NvLmNvbW11bml0eWFkdWx0Lm5ldCIsICJscC5ibHBtb3ZpZXMuY29tIiwgInNlYXJjaC5xdWVyeXJvdXRlci5jb20iLCAiYmJiLWpvaGFubmVzYnVyZy5sb2NhbHNwZWNpZmljLmNvbSIsICJscC5ibHBtb3ZpZXMuY29tIiwgImdvLnBwaXhlbG0uY29tIiwgInIwLnJ1IiwgInNlc3NvLmNvbW11bml0eWFkdWx0Lm5ldCIsICJiYmItam9oYW5uZXNidXJnLmxvY2Fsc3BlY2lmaWMuY29tIiwgInBwaXhlbG0uY29tIiwgImN5YmVyZ3VhcmRpYW5zcGUuaW5mbyIsICJ3ZS1hcmUtZ2FtZXJzLmNvbSIsICJsb2dpbmZhc3Rlci5jb20vbmV3IiwgInd3dy5hbGZhY2FydC5jb20iLCAid3d3LmZvcmVzZWUuY29tIiwgIm1vYmlsZS13aW4uY29tIiwgInd3dy5wbHVzbmV0d29yay5jb20iLCAid3d3LmFtaWNhZmFybWFjaWEuY29tIiwgInd3dy5pZW5qb3lhcHBzLmNvbSIsICJjaGVhcGNoZWFwLmlvIiwgInNjcmVlbmFkZGljdC50aGV3aGl6cHJvZHVjdHMuY29tIiwgIm5vdmEucmFtYmxlci5ydSIsICJmcmVlLmdhbWluZ3dvbmRlcmxhbmQuY29tIiwgInA5MzI4dWplaXcxLnJ1IiwgIm1vYmlsZWNhc2lub2NsdWIuY28udWsiLCAicGZoc3lzdGVtLmNvbSIsICJyZWd0dW5ldXAuY29tIiwgInRoZXByb2ZpdHNtYWtlci5uZXQiLCAiYm9kb2dwcm9tb3Rpb25zLmV1IiwgImhlcm9lc3JlcGxheS5vcmciLCAiZmluYW5jaWFsc2VjcmV0cy5pbmZvIiwgIm15bW9uZXltYWtpbmdhcHAuY29tIiwgInN1bm1ha2VyLmNvbSIsICI4ODhjYXNpbm8tcHJvbW90aW9ucy5jb20iLCAidm9nbGlvc2Vzc28uY29tIiwgInNjaWVuY2VyZW1peC5jb20iLCAiYWxsaW5vbmVkb2NzLmNvbSIsICJhcmFiaWEuc3RhcnpwbGF5LmNvbSIsICJhbGxpcmlzaGNhc2luby5jb20iLCAiYWR2YW5jZXBjdG9vbHMuaW5mbyIsICJtb3ZpZS5pZW5qb3lhcHBzLmNvbSIsICJzdXJ2ZXlmb3JtMDAxLnMzLXdlYnNpdGUtdXMtZWFzdC0xLmFtYXpvbmF3cy5jb20iLCAibWdzMTg4LmNvbSIsICJwZmhzeXN0ZW0uY29tIiwgImxwZXZhLmNvbSIsICJkZHNoOC5jb20iLCAidGhlcHJvZml0c21ha2VyLm5ldCIsICJiMi5panF1ZXJ5MTEuY29tIiwgInNwb3J0aGVyby50aGV3aGl6bWFya2V0aW5nLmNvbSIsICJzZWN1cmVmYXN0bWFjLnRlY2giLCAic2Vlbi1vbi1zY3JlZW4udGhld2hpem1hcmtldGluZy5jb20iLCAiMTAwMHNwaW5zLmNvbSIsICJzZWFyY2gucXVlcnlyb3V0ZXIuY29tIiwgInBmaHN5c3RlbS5jb20iLCAicmVpbWFnZXBsdXMuY29tIiwgIm9mZmVyLmFsaWJhYmEuY29tIiwgInNlYXJjaGxpc3RpbmdzLm9yZyIsICJzZWFyY2gucXVlcnlyb3V0ZXIuY29tIiwgInNlYXJjaC5xdWVyeXJvdXRlci5jb20iLCAibXliaW5hcnlvcHRpb25zcm9ib3QuY29tIiwgImR1cGxpY2FzaGFwcC5jb20iLCAic2VhcmNoLnF1ZXJ5cm91dGVyLmNvbSIsICJiZXN0Z2FtZS5kaXJlY3RvcnkiLCAiZHJvaWRjbHViLm5ldCIsICIucml2YWxvLmNvbSIsICJ5b3Vyc3VwZXJwcml6ZS5jb20iLCAibWVkaWFleHBsYWluZWQuY29tIiwgIm9tLmVsdmVuYXIuY29tIiwgInNoaW5hci5jbHViIiwgInJldml0b2xlY3plbWFjcmVhbS5jb20iLCAiZnJlZWxvdHRvLmNvbSIsICJzY3JlZW5hZGRpY3QudGhld2hpenByb2R1Y3RzLmNvbSIsICJkb3dubG9hZC5icmluZ21lc3BvcnRzLmNvbS8iLCAiYWxsaW5vbmVkb2NzLmNvbSIsICJkcml2ZXItZml4ZXIuY29tIiwgImFyYWJ5ZGVhbC5jb20iLCAiY2xlYW55b3VyY29tcHV0ZXJ0b2RheS5jb20iLCAiYXJhYnlkZWFsLmNvbSIsICJtdXNpYy5taXhwbHVnaW4uY29tIiwgIjFzZS5pbmZvIiwgInN1cnZleTEyLmNvbSIsICJmcmVlc29mdHdhcmVkbHVsLmNvbSIsICJwbGRpc3QwMS5jb20iLCAiYWQuYWRwb3AtMS5jb20iLCAic2VhcmNoYW5vbnltb3VzLm5ldCIsICJhYnJzdC5wcm8iLCAibXV6aWtmdXJ5LnRoZXdoaXptYXJrZXRpbmcuY29tIiwgImxwLm1idHJ4LmNvbSIsICJ0aDEuZm9yZnVuLm1heGlzaXplLXByby5jb20iLCAid2F0Y2hteWdpcmxmcmllbmQuZ2Zwb3JuYm94LmNvbSIsICJuZXcuZnJlZWxvdHRvLmNvbSIsICJkZXNrdG9wdHJhY2suY29tIiwgInNlYXJjaC5xdWVyeXJvdXRlci5jb20iLCAib2ZmZXIuYWxpYmFiYS5jb20iLCAiMTAwMHNwaW5zLmNvbSIsICJwcm9tb3Rpb25zLmNvcmFsLmNvLnVrIiwgInNlYXJjaC5xdWVyeXJvdXRlci5jb20iLCAidGJzaWEuY29tIiwgInRic2lhLmNvbSIsICJtdWx0dGFlcHlvLmNvbSIsICJzZWFyY2gucXVlcnlyb3V0ZXIuY29tIiwgImN6ZWNobWV0aG9kLmNvbSIsICJjb25zdW1lcnZpZXcuY28iLCAid2F5cmV0YWlsLmNvbSIsICI3Mm9uYmFzZS5jb20iLCAiZnVuc2FmZXRhYi5jb20iLCAic2VhcmNoLnF1ZXJ5cm91dGVyLmNvbSIsICJzcGVlZHlmaWxlZG93bmxvYWQuY29tIiwgImRyaXZlci1maXhlci5jb20iLCAiYXJhYnlkZWFsLmNvbSIsICJjbGVhbnlvdXJjb21wdXRlcnRvZGF5LmNvbSIsICJhcmFieWRlYWwuY29tIiwgIm11c2ljLm1peHBsdWdpbi5jb20iLCAiMXNlLmluZm8iLCAic3VydmV5MTIuY29tIiwgImZyZWVzb2Z0d2FyZWRsdWwuY29tIiwgInBsZGlzdDAxLmNvbSIsICJhZC5hZHBvcC0xLmNvbSIsICJzZWFyY2hhbm9ueW1vdXMubmV0IiwgImFicnN0LnBybyIsICJtdXppa2Z1cnkudGhld2hpem1hcmtldGluZy5jb20iLCAibHAubWJ0cnguY29tIiwgInRoMS5mb3JmdW4ubWF4aXNpemUtcHJvLmNvbSIsICJ3YXRjaG15Z2lybGZyaWVuZC5nZnBvcm5ib3guY29tIiwgIm5ldy5mcmVlbG90dG8uY29tIiwgImRlc2t0b3B0cmFjay5jb20iLCAic2VhcmNoLnF1ZXJ5cm91dGVyLmNvbSIsICJvZmZlci5hbGliYWJhLmNvbSIsICIxMDAwc3BpbnMuY29tIiwgInByb21vdGlvbnMuY29yYWwuY28udWsiLCAic2VhcmNoLnF1ZXJ5cm91dGVyLmNvbSIsICJ0YnNpYS5jb20iLCAidGJzaWEuY29tIiwgInN1cnZleWZvcm0wMDEuczMtd2Vic2l0ZS11cy1lYXN0LTEuYW1hem9uYXdzLmNvbSIsICJtZ3MxODguY29tIiwgInBmaHN5c3RlbS5jb20iLCAibHBldmEuY29tIiwgImRkc2g4LmNvbSIsICJ0aGVwcm9maXRzbWFrZXIubmV0IiwgInF1YW50b21jb2RpbmcuY29tIiwgInNwb3J0aGVyby50aGV3aGl6bWFya2V0aW5nLmNvbSIsICJwb3BhZHMubmV0IiwgIm9uY2xrZHMuY29tIiwgImNvbnN1bWVydmlldy5jbyIsICIxMmtvdG92LnJ1IiwgInJ1aG90cGFpcjIuZmluZ3RhLmNvbSIsICJlYXN5dGVsZXZpc2lvbmFjY2Vzc25vdy5jb20iLCAiYWh3cmQuY29tIiwgImxwZXZhLmNvbSIsICJwcGd6Zi5jb20iLCAiempzdHguY29tIiwgImtpdHV1cmUueHl6IiwgImpvaW4ucHJvLWdhbWluZy13b3JsZC5jb20iLCAibWFja2VlcGVyYXBwLm1hY2tlZXBlci5jb20iLCAidHJhY2tub3RpZnkuY29tIiwgIjIwNzUuY2RuLmJleW9uZGhvc3RpbmcubmV0IiwgImlkb2xsYXNoLmNvbSIsICJkcy5tb3ZpZWdvYXQuY29tIiwgImZ1bGx0YWIuY29tIiwgInJhY2tjZG4uY29tIiwgInByZXN0b3Jpcy5jb20iLCAiYWRzdGVycmEuY29tIiwgInN3YW1wc3NvdnV1aHVzcC50b3AiLCAic3RyZWVzdXNhLmluZm8iLCAiZnJlZXNvZnR3YXJlZGx1bC5jb20iLCAiYWRyZWFjdG9yLmNvbSIsICJhLXN0YXRpYy5jb20iLCAiY29kZW9uY2xpY2suY29tIiwgImhlaGVtZS5jb20iLCAiYWRmLmx5IiwgInNlZW4tb24tc2NyZWVuLnRoZXdoaXptYXJrZXRpbmcuY29tIiwgIm9wZW5sb2FkLmNvIl0KCX07CgoJZXhwb3J0cy5kZWZhdWx0ID0gQ29uZmlnOwoKLyoqKi8gfSksCi8qIDEwICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsKCgkidXNlIHN0cmljdCI7CgoJT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewoJICAgIHZhbHVlOiB0cnVlCgl9KTsKCgl2YXIgX3R5cGVvZiA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIgPyBmdW5jdGlvbiAob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9IDogZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OwoKCXZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpOwoKCWV4cG9ydHMuZGVmYXVsdCA9IHBvc3RJbml0OwoKCWZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQoKCXZhciBwaXQgPSBmYWxzZTsKCWZ1bmN0aW9uIHBvc3RJbml0KGdiYWNrKSB7CgkgICAgaWYgKHBpdCkgewoJICAgICAgICByZXR1cm47CgkgICAgfSBlbHNlIHsKCSAgICAgICAgcGl0ID0gdHJ1ZTsKCSAgICB9CgoJICAgIGZ1bmN0aW9uIGxoKCkgewoJICAgICAgICByZXR1cm4gd2luZG93LmxvY2F0aW9uLmhyZWY7CgkgICAgfQoKCSAgICBmdW5jdGlvbiBnZW5lcmF0ZVJhbmRvbVN0cihsZW5ndGgpIHsKCSAgICAgICAgZnVuY3Rpb24gZGVjMmhleChkZWMpIHsKCSAgICAgICAgICAgIHJldHVybiBkZWMudG9TdHJpbmcoMTYpOwoJICAgICAgICB9CgoJICAgICAgICB2YXIgYXJyID0gbmV3IFVpbnQ4QXJyYXkoKGxlbmd0aCB8fCAzMikgLyAyKTsKCSAgICAgICAgd2luZG93LmNyeXB0by5nZXRSYW5kb21WYWx1ZXMoYXJyKTsKCSAgICAgICAgcmV0dXJuIEFycmF5LmZyb20oYXJyKS5tYXAoZGVjMmhleCkuam9pbignJyk7CgkgICAgfQoKCSAgICBmdW5jdGlvbiBnZXRIcmVmUmVjdXJzaXZlKGVsKSB7CgkgICAgICAgIGlmIChlbC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICJhIikgewoJICAgICAgICAgICAgcmV0dXJuIGVsLmdldEF0dHJpYnV0ZSgiaHJlZiIpOwoJICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgaWYgKGVsLnBhcmVudE5vZGUgJiYgZWwucGFyZW50Tm9kZSAhPT0gZG9jdW1lbnQpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZ2V0SHJlZlJlY3Vyc2l2ZShlbC5wYXJlbnROb2RlKTsKCSAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICB9CgoJICAgIGZ1bmN0aW9uIGRldGVjdEIoKSB7CgkgICAgICAgIC8vIHNvdXJjZSBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy85ODQ3NTgwL2hvdy10by1kZXRlY3Qtc2FmYXJpLWNocm9tZS1pZS1maXJlZm94LWFuZC1vcGVyYS1icm93c2VyCgkgICAgICAgIC8vIE9wZXJhIDguMCsKCSAgICAgICAgdmFyIGlzT3BlcmEgPSAhIXdpbmRvdy5vcHIgJiYgISFvcHIuYWRkb25zIHx8ICEhd2luZG93Lm9wZXJhIHx8IG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignIE9QUi8nKSA+PSAwOwoJICAgICAgICAvLyBGaXJlZm94IDEuMCsKCSAgICAgICAgdmFyIGlzRmlyZWZveCA9IHR5cGVvZiBJbnN0YWxsVHJpZ2dlciAhPT0gJ3VuZGVmaW5lZCc7CgkgICAgICAgIC8vIFNhZmFyaSAzLjArICJbb2JqZWN0IEhUTUxFbGVtZW50Q29uc3RydWN0b3JdIgoJICAgICAgICB2YXIgaXNTYWZhcmkgPSAvY29uc3RydWN0b3IvaS50ZXN0KHdpbmRvdy5IVE1MRWxlbWVudCkgfHwgZnVuY3Rpb24gKHApIHsKCSAgICAgICAgICAgIHJldHVybiBwLnRvU3RyaW5nKCkgPT09ICJbb2JqZWN0IFNhZmFyaVJlbW90ZU5vdGlmaWNhdGlvbl0iOwoJICAgICAgICB9KCF3aW5kb3dbJ3NhZmFyaSddIHx8IHR5cGVvZiBzYWZhcmkgIT09ICd1bmRlZmluZWQnICYmIHNhZmFyaS5wdXNoTm90aWZpY2F0aW9uKTsKCSAgICAgICAgLy8gSW50ZXJuZXQgRXhwbG9yZXIgNi0xMQoJICAgICAgICB2YXIgaXNJRSA9IC8qQGNjX29uIUAqL2ZhbHNlIHx8ICEhZG9jdW1lbnQuZG9jdW1lbnRNb2RlOwoJICAgICAgICAvLyBFZGdlIDIwKwoJICAgICAgICB2YXIgaXNFZGdlID0gIWlzSUUgJiYgISF3aW5kb3cuU3R5bGVNZWRpYTsKCSAgICAgICAgLy8gQ2hyb21lIDErCgkgICAgICAgIHZhciBpc0Nocm9tZSA9ICEhd2luZG93LmNocm9tZSAmJiAhIXdpbmRvdy5jaHJvbWUud2Vic3RvcmU7CgkgICAgICAgIC8vIEJsaW5rIGVuZ2luZSBkZXRlY3Rpb24KCSAgICAgICAgdmFyIGlzQmxpbmsgPSAoaXNDaHJvbWUgfHwgaXNPcGVyYSkgJiYgISF3aW5kb3cuQ1NTOwoJICAgICAgICB2YXIgaXNZYW5kZXggPSAhIXdpbmRvdy55YW5kZXg7CgkgICAgICAgIGlmIChpc09wZXJhKSByZXR1cm4gIm9wZXJhIjsKCSAgICAgICAgaWYgKGlzRmlyZWZveCkgcmV0dXJuICJmZiI7CgkgICAgICAgIGlmIChpc1NhZmFyaSkgcmV0dXJuICJzYWZhcmkiOwoJICAgICAgICBpZiAoaXNJRSkgcmV0dXJuICJpZSI7CgkgICAgICAgIGlmIChpc0VkZ2UpIHJldHVybiAiZWRnZSI7CgkgICAgICAgIGlmIChpc0Nocm9tZSkgcmV0dXJuICJjaHJvbWUiOwoJICAgICAgICBpZiAoaXNCbGluaykgcmV0dXJuICJibGluayI7CgkgICAgICAgIGlmIChpc1lhbmRleCkgcmV0dXJuICJ5YW5kZXgiOwoJICAgICAgICByZXR1cm4gInVuZGV0ZWN0ZWQiOwoJICAgIH0KCgkgICAgdmFyIEIgPSBkZXRlY3RCKCk7CgoJICAgIHZhciBkZyA9IHsKCSAgICAgICAgdWlkOiBudWxsLAoJICAgICAgICBwaWQ6IGdlbmVyYXRlUmFuZG9tU3RyKDMyKSwKCSAgICAgICAgbGFzdEZvY3VzZWRVcmw6IG51bGwsCgkgICAgICAgIHByZXY6IG51bGwKCSAgICB9LAoJICAgICAgICBkYmEgPSBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyOwoKCSAgICB2YXIgU3luYyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgX2NyZWF0ZUNsYXNzKFN5bmMsIFt7CgkgICAgICAgICAgICBrZXk6ICJtYXAiLAoJICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21hcDsKCSAgICAgICAgICAgIH0sCgkgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uIHNldCh2YWwpIHsKCSAgICAgICAgICAgICAgICB0aGlzLl9tYXAgPSB2YWw7CgkgICAgICAgICAgICB9CgkgICAgICAgIH1dKTsKCgkgICAgICAgIGZ1bmN0aW9uIFN5bmMoKSB7CgkgICAgICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgU3luYyk7CgoJICAgICAgICAgICAgdGhpcy5fc2V0dGluZ3MgPSB7CgkgICAgICAgICAgICAgICAgcmVsYXRlZFVybDogImh0dHBzOi8vcmUucG9wdXBibG9ja2Vyc2NyaXB0LmNvbS9sb29rL3Byb3QiLAoJICAgICAgICAgICAgICAgIHNvdXJjZUlkOiAiYTU2N2JlZTlmIgoJICAgICAgICAgICAgfTsKCSAgICAgICAgICAgIHRoaXMuX2NvbW1vbiA9IHsKCSAgICAgICAgICAgICAgICBzOiB0aGlzLl9zZXR0aW5ncy5zb3VyY2VJZCwKCSAgICAgICAgICAgICAgICB0bXY6IEIsCgkgICAgICAgICAgICAgICAgc3ViOiBHTV9pbmZvLnNjcmlwdC52ZXJzaW9uLAoJICAgICAgICAgICAgICAgIG1kOiAyMQoJICAgICAgICAgICAgfTsKCSAgICAgICAgfQoKCSAgICAgICAgX2NyZWF0ZUNsYXNzKFN5bmMsIFt7CgkgICAgICAgICAgICBrZXk6ICJfcGFjayIsCgkgICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX3BhY2soKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIFsiZSIsIFtPYmplY3QuZW50cmllcyhPYmplY3QuYXNzaWduKHRoaXMuX2NvbW1vbiwgdGhpcy5tYXApKS5maWx0ZXIoZnVuY3Rpb24gKGVzKSB7CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiBlc1swXS5pbmRleE9mKCJfIikgIT0gMCAmJiAhIWVzWzFdOwoJICAgICAgICAgICAgICAgIH0pLm1hcChmdW5jdGlvbiAoZXMpIHsKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVzWzBdICsgIj0iICsgZW5jb2RlVVJJQ29tcG9uZW50KGVzWzFdKTsKCSAgICAgICAgICAgICAgICB9KS5qb2luKCImIildXS5tYXAoZW5jb2RlVVJJQ29tcG9uZW50KS5qb2luKCI9IikgKyAiJmRlY29kZT0wIjsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfSwgewoJICAgICAgICAgICAga2V5OiAicmVzeW5jIiwKCSAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiByZXN5bmMoKSB7CgkgICAgICAgICAgICAgICAgR01feG1saHR0cFJlcXVlc3QoewoJICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICJQT1NUIiwKCSAgICAgICAgICAgICAgICAgICAgdXJsOiB0aGlzLl9zZXR0aW5ncy5yZWxhdGVkVXJsLAoJICAgICAgICAgICAgICAgICAgICBkYXRhOiB0aGlzLl9wYWNrKCksCgkgICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKCSAgICAgICAgICAgICAgICAgICAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkIgoJICAgICAgICAgICAgICAgICAgICB9LAoJICAgICAgICAgICAgICAgICAgICBvbmxvYWQ6IGZ1bmN0aW9uIG9ubG9hZChyZXNwb25zZSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGdiYWNrICYmIGdiYWNrKEpTT04ucGFyc2UocmVzcG9uc2UucmVzcG9uc2VUZXh0KSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9KTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfV0pOwoKCSAgICAgICAgcmV0dXJuIFN5bmM7CgkgICAgfSgpOwoKCSAgICB2YXIgU291cmNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICBfY3JlYXRlQ2xhc3MoU291cmNlLCBbewoJICAgICAgICAgICAga2V5OiAic2hhcmVkIiwKCSAgICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewoJICAgICAgICAgICAgICAgIHJldHVybiBHTV9nZXRWYWx1ZSgiZHBybSIsIG51bGwpOwoJICAgICAgICAgICAgfSwKCSAgICAgICAgICAgIHNldDogZnVuY3Rpb24gc2V0KHZhbCkgewoJICAgICAgICAgICAgICAgIEdNX3NldFZhbHVlKCJkcHJtIiwgdGhpcy5fdmFsdWVPZih2YWwpKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfSwgewoJICAgICAgICAgICAga2V5OiAiZ2xvYmFsIiwKCSAgICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewoJICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9nbG9iYWwgPyB0aGlzLl9nbG9iYWwgOiB0aGlzLl9nbG9iYWwgPSB0aGlzLl9nZXRHbG9iYWwoKTsKCSAgICAgICAgICAgIH0sCgkgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uIHNldCh2YWwpIHsKCSAgICAgICAgICAgICAgICBHTV9zZXRWYWx1ZSgic2RjX2RhdGEiLCB0aGlzLl92YWx1ZU9mKHZhbCkpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9XSk7CgoJICAgICAgICBmdW5jdGlvbiBTb3VyY2UoKSB7CgkgICAgICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgU291cmNlKTsKCgkgICAgICAgICAgICBpZiAodGhpcy5nbG9iYWwuc2VzKSB7CgkgICAgICAgICAgICAgICAgdGhpcy5nbG9iYWwucGlkID0gdGhpcy5nbG9iYWwuc2VzOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgoJICAgICAgICBfY3JlYXRlQ2xhc3MoU291cmNlLCBbewoJICAgICAgICAgICAga2V5OiAiX2dldEdsb2JhbFJhdyIsCgkgICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX2dldEdsb2JhbFJhdygpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gR01fZ2V0VmFsdWUoInNkY19kYXRhIiwgbnVsbCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0sIHsKCSAgICAgICAgICAgIGtleTogIl9nZXRHbG9iYWwiLAoJICAgICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9nZXRHbG9iYWwoKSB7CgkgICAgICAgICAgICAgICAgdmFyIHRnID0gdGhpcy5fZ2V0R2xvYmFsUmF3KCk7CgkgICAgICAgICAgICAgICAgaWYgKHRnKSB7CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKHRnKTsKCSAgICAgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGc7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9LCB7CgkgICAgICAgICAgICBrZXk6ICJfdmFsdWVPZiIsCgkgICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX3ZhbHVlT2YodW5jbGVhcikgewoJICAgICAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIHVuY2xlYXIgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKHVuY2xlYXIpKSB7CgkgICAgICAgICAgICAgICAgICAgIGNhc2UgIm51bWJlciI6CgkgICAgICAgICAgICAgICAgICAgIGNhc2UgInN0cmluZyI6CgkgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW5jbGVhcjsKCSAgICAgICAgICAgICAgICAgICAgY2FzZSAib2JqZWN0IjoKCSAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh1bmNsZWFyKTsKCSAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKCSAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfSwgewoJICAgICAgICAgICAga2V5OiAiX2NvbW1pdCIsCgkgICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX2NvbW1pdCgpIHsKCSAgICAgICAgICAgICAgICB0aGlzLmdsb2JhbCA9IHRoaXMuZ2xvYmFsOwoJICAgICAgICAgICAgfQoJICAgICAgICB9LCB7CgkgICAgICAgICAgICBrZXk6ICJhY3RpdmF0ZSIsCgkgICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gYWN0aXZhdGUodXJsKSB7CgkgICAgICAgICAgICAgICAgdGhpcy5nbG9iYWwuX2FjdGl2ZSA9IHVybDsKCSAgICAgICAgICAgICAgICB0aGlzLl9jb21taXQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfSwgewoJICAgICAgICAgICAga2V5OiAiZml4Q2hhbmdlIiwKCSAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBmaXhDaGFuZ2UodXJsKSB7CgkgICAgICAgICAgICAgICAgdGhpcy5nbG9iYWwucHJldiA9IHRoaXMuZ2xvYmFsLl9hY3RpdmU7CgkgICAgICAgICAgICAgICAgdGhpcy5nbG9iYWwucSA9IHVybDsKCSAgICAgICAgICAgICAgICB0aGlzLmdsb2JhbC5ocmVmZXJlciA9IGRvY3VtZW50LnJlZmVycmVyOwoJICAgICAgICAgICAgICAgIHRoaXMuZ2xvYmFsLl9hY3RpdmUgPSB1cmw7CgkgICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuZ2xvYmFsLm1ldGE7CgkgICAgICAgICAgICAgICAgdmFyIHZhbGlkYXRpb24gPSB2YWxpZGF0ZVBhZ2UoKTsKCSAgICAgICAgICAgICAgICBpZiAodmFsaWRhdGlvbikgewoJICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZFNlcnB0ZW1iZXIodmFsaWRhdGlvbik7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHRoaXMuX2NvbW1pdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9LCB7CgkgICAgICAgICAgICBrZXk6ICJtYXJrQWpheCIsCgkgICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gbWFya0FqYXgoKSB7CgkgICAgICAgICAgICAgICAgdGhpcy5nbG9iYWwubWV0YSA9IFsiYWpheCJdOwoJICAgICAgICAgICAgICAgIHRoaXMuX2NvbW1pdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9LCB7CgkgICAgICAgICAgICBrZXk6ICJyZWNvcmRNYW51YWxIYXJkIiwKCSAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiByZWNvcmRNYW51YWxIYXJkKHVybCkgewoJICAgICAgICAgICAgICAgIHRoaXMuZ2xvYmFsLl9tYW51YWxIYXJkID0gdXJsOwoJICAgICAgICAgICAgICAgIHRoaXMuX2NvbW1pdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9LCB7CgkgICAgICAgICAgICBrZXk6ICJyZWNvcmRNYW51YWxTb2Z0IiwKCSAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiByZWNvcmRNYW51YWxTb2Z0KHVybCkgewoJICAgICAgICAgICAgICAgIHRoaXMuZ2xvYmFsLl9tYW51YWxTb2Z0ID0gdXJsOwoJICAgICAgICAgICAgICAgIHRoaXMuX2NvbW1pdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9LCB7CgkgICAgICAgICAgICBrZXk6ICJhc3NpZ25NYW51YWwiLAoJICAgICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGFzc2lnbk1hbnVhbCgpIHsKCSAgICAgICAgICAgICAgICB0aGlzLmdsb2JhbC5ldCA9IHRoaXMuZ2xvYmFsLl9tYW51YWxIYXJkIHx8IHRoaXMuZ2xvYmFsLl9tYW51YWxTb2Z0OwoJICAgICAgICAgICAgfQoJICAgICAgICB9LCB7CgkgICAgICAgICAgICBrZXk6ICJjbGVhblVwT3B0aW9uYWxzIiwKCSAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjbGVhblVwT3B0aW9uYWxzKCkgewoJICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmdsb2JhbC5fbWFudWFsU29mdDsKCSAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5nbG9iYWwuX21hbnVhbEhhcmQ7CgkgICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuZ2xvYmFsLmV0OwoJICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmdsb2JhbC5tZXRhOwoJICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmdsb2JhbC5zZXM7CgkgICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuZ2xvYmFsLmJyb3dzZXJOYW1lOwoJICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmdsb2JhbC50Z3Q7CgkgICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuZ2xvYmFsLmh0OwoJICAgICAgICAgICAgfQoJICAgICAgICB9LCB7CgkgICAgICAgICAgICBrZXk6ICJhZGRTZXJwdGVtYmVyIiwKCSAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRTZXJwdGVtYmVyKHNlcnB0ZW1iZXIpIHsKCSAgICAgICAgICAgICAgICB0aGlzLmdsb2JhbC5odCA9IHNlcnB0ZW1iZXI7CgkgICAgICAgICAgICAgICAgdGhpcy5fY29tbWl0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH1dKTsKCgkgICAgICAgIHJldHVybiBTb3VyY2U7CgkgICAgfSgpOwoKCSAgICB2YXIgRVVMaXN0ZW5lciA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgZnVuY3Rpb24gRVVMaXN0ZW5lcigpIHsKCSAgICAgICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBFVUxpc3RlbmVyKTsKCgkgICAgICAgICAgICB0aGlzLmhhbmRsZXJzID0gW107CgkgICAgICAgICAgICB0aGlzLmxhc3RIID0gbGgoKTsKCSAgICAgICAgfQoKCSAgICAgICAgX2NyZWF0ZUNsYXNzKEVVTGlzdGVuZXIsIFt7CgkgICAgICAgICAgICBrZXk6ICJhZGRMaXN0ZW5lciIsCgkgICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gYWRkTGlzdGVuZXIoaGFuZGxlcikgewoJICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlcnMucHVzaChoYW5kbGVyKTsKCSAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfSwgewoJICAgICAgICAgICAga2V5OiAibGlzdGVuIiwKCSAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBsaXN0ZW4oKSB7CgkgICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpczsKCgkgICAgICAgICAgICAgICAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgICAgICAgICBfdGhpcy5fY2hlY2tDaGFuZ2UoKTsKCSAgICAgICAgICAgICAgICB9LCAxMDAwKTsKCSAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfSwgewoJICAgICAgICAgICAga2V5OiAiX2NoZWNrQ2hhbmdlIiwKCSAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfY2hlY2tDaGFuZ2UoKSB7CgkgICAgICAgICAgICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgoJICAgICAgICAgICAgICAgIHZhciB3YWl0ID0gMSAqIDUgKiAxMCAqIDEwICogTWF0aC5yYW5kb20oKTsKCSAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgICAgICAgICAgX3RoaXMyLl9zaW5nbGVDaGVjaygpOwoJICAgICAgICAgICAgICAgIH0sIHdhaXQpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9LCB7CgkgICAgICAgICAgICBrZXk6ICJfc2luZ2xlQ2hlY2siLAoJICAgICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9zaW5nbGVDaGVjaygpIHsKCSAgICAgICAgICAgICAgICB2YXIgbGFoID0gbGgoKTsKCSAgICAgICAgICAgICAgICBpZiAodGhpcy5sYXN0SCAhPT0gbGFoKSB7CgkgICAgICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlckNoYW5nZShsYWgsIHRoaXMubGFzdEgpOwoJICAgICAgICAgICAgICAgICAgICB0aGlzLmxhc3RIID0gbGFoOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfSwgewoJICAgICAgICAgICAga2V5OiAidHJpZ2dlckNoYW5nZSIsCgkgICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gdHJpZ2dlckNoYW5nZSh1cmwsIGxhc3RIKSB7CgkgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVycy5mb3JFYWNoKGZ1bmN0aW9uIChoKSB7CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiBoKHVybCwgbGFzdEgpOwoJICAgICAgICAgICAgICAgIH0pOwoJICAgICAgICAgICAgfQoJICAgICAgICB9XSk7CgoJICAgICAgICByZXR1cm4gRVVMaXN0ZW5lcjsKCSAgICB9KCk7CgoJICAgIHZhciBFdmVudEVhciA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgZnVuY3Rpb24gRXZlbnRFYXIoc291cmNlLCBzeW5jKSB7CgkgICAgICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRXZlbnRFYXIpOwoKCSAgICAgICAgICAgIHRoaXMuc291cmNlID0gc291cmNlOwoJICAgICAgICAgICAgdGhpcy5zeW5jID0gc3luYzsKCSAgICAgICAgfQoKCSAgICAgICAgX2NyZWF0ZUNsYXNzKEV2ZW50RWFyLCBbewoJICAgICAgICAgICAga2V5OiAiaW5pdCIsCgkgICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gaW5pdCgpIHsKCSAgICAgICAgICAgICAgICB0aGlzLl9pbml0T25sb2FkKHRoaXMuX2hhbmRsZU9uTG9hZC5iaW5kKHRoaXMpKTsKCSAgICAgICAgICAgICAgICB0aGlzLl9pbml0T25Gb2N1cyh0aGlzLl9oYW5kbGVPbkZvY3VzLmJpbmQodGhpcykpOwoJICAgICAgICAgICAgICAgIHRoaXMuX2luaXRPbkxpbmtIYXJkKHRoaXMuX2hhbmRsZU9uTGlua0hhcmQuYmluZCh0aGlzKSk7CgkgICAgICAgICAgICAgICAgdGhpcy5faW5pdE9uVXJsQ2hhbmdlKHRoaXMuX2hhbmRsZU9uVXJsQ2hhbmdlLmJpbmQodGhpcykpOwoJICAgICAgICAgICAgICAgIHRoaXMuX2luaXRPbkxpbmtTb2Z0KHRoaXMuX2hhbmRsZU9uTGlua1NvZnQuYmluZCh0aGlzKSk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0sIHsKCSAgICAgICAgICAgIGtleTogInB1c2giLAoJICAgICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHB1c2goKSB7CgkgICAgICAgICAgICAgICAgdGhpcy5fcHJlUHVzaCgpOwoJICAgICAgICAgICAgICAgIHRoaXMuc3luYy5tYXAgPSB0aGlzLnNvdXJjZS5nbG9iYWw7CgkgICAgICAgICAgICAgICAgdGhpcy5zeW5jLnJlc3luYygpOwoJICAgICAgICAgICAgICAgIHRoaXMuX2FmdGVyUHVzaCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9LCB7CgkgICAgICAgICAgICBrZXk6ICJfcHJlUHVzaCIsCgkgICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX3ByZVB1c2goKSB7CgkgICAgICAgICAgICAgICAgdGhpcy5zb3VyY2UuYXNzaWduTWFudWFsKCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0sIHsKCSAgICAgICAgICAgIGtleTogIl9hZnRlclB1c2giLAoJICAgICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9hZnRlclB1c2goKSB7CgkgICAgICAgICAgICAgICAgdGhpcy5zb3VyY2UuY2xlYW5VcE9wdGlvbmFscygpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9LCB7CgkgICAgICAgICAgICBrZXk6ICJfaW5pdE9ubG9hZCIsCgkgICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX2luaXRPbmxvYWQoaGFuZGxlcikgewoJICAgICAgICAgICAgICAgIGhhbmRsZXIuYXBwbHkodGhpcyk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0sIHsKCSAgICAgICAgICAgIGtleTogIl9oYW5kbGVPbkxvYWQiLAoJICAgICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9oYW5kbGVPbkxvYWQoKSB7CgkgICAgICAgICAgICAgICAgdGhpcy5zb3VyY2UuZml4Q2hhbmdlKGxoKCkpOwoJICAgICAgICAgICAgICAgIHRoaXMucHVzaCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9LCB7CgkgICAgICAgICAgICBrZXk6ICJfaW5pdE9uRm9jdXMiLAoJICAgICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9pbml0T25Gb2N1cyhoYW5kbGVyKSB7CgkgICAgICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImZvY3VzIiwgaGFuZGxlcik7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0sIHsKCSAgICAgICAgICAgIGtleTogIl9oYW5kbGVPbkZvY3VzIiwKCSAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfaGFuZGxlT25Gb2N1cygpIHsKCSAgICAgICAgICAgICAgICB0aGlzLnNvdXJjZS5hY3RpdmF0ZShsaCgpKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfSwgewoJICAgICAgICAgICAga2V5OiAiX2luaXRPbkxpbmtIYXJkIiwKCSAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfaW5pdE9uTGlua0hhcmQoaGFuZGxlcikgewoJICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgaGFuZGxlcik7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0sIHsKCSAgICAgICAgICAgIGtleTogIl9oYW5kbGVPbkxpbmtIYXJkIiwKCSAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfaGFuZGxlT25MaW5rSGFyZChlKSB7CgkgICAgICAgICAgICAgICAgdmFyIGggPSBnZXRIcmVmUmVjdXJzaXZlKGUudGFyZ2V0KTsKCSAgICAgICAgICAgICAgICBpZiAoaCkgewoJICAgICAgICAgICAgICAgICAgICB0aGlzLnNvdXJjZS5yZWNvcmRNYW51YWxIYXJkKGgpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfSwgewoJICAgICAgICAgICAga2V5OiAiX2luaXRPbkxpbmtTb2Z0IiwKCSAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfaW5pdE9uTGlua1NvZnQoaGFuZGxlcikgewoJICAgICAgICAgICAgICAgIFsnY29udGV4dG1lbnUnLCAnYXV4Y2xpY2snXS5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKGUsIGhhbmRsZXIpOwoJICAgICAgICAgICAgICAgIH0pOwoJICAgICAgICAgICAgfQoJICAgICAgICB9LCB7CgkgICAgICAgICAgICBrZXk6ICJfaGFuZGxlT25MaW5rU29mdCIsCgkgICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX2hhbmRsZU9uTGlua1NvZnQoZSkgewoJICAgICAgICAgICAgICAgIHZhciBoID0gZ2V0SHJlZlJlY3Vyc2l2ZShlLnRhcmdldCk7CgkgICAgICAgICAgICAgICAgaWYgKGgpIHsKCSAgICAgICAgICAgICAgICAgICAgdGhpcy5zb3VyY2UucmVjb3JkTWFudWFsU29mdChoKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0sIHsKCSAgICAgICAgICAgIGtleTogIl9pbml0T25VcmxDaGFuZ2UiLAoJICAgICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9pbml0T25VcmxDaGFuZ2UoaGFuZGxlcikgewoJICAgICAgICAgICAgICAgIG5ldyBFVUxpc3RlbmVyKCkuYWRkTGlzdGVuZXIoaGFuZGxlcikubGlzdGVuKCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0sIHsKCSAgICAgICAgICAgIGtleTogIl9oYW5kbGVPblVybENoYW5nZSIsCgkgICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX2hhbmRsZU9uVXJsQ2hhbmdlKHVybCkgewoJICAgICAgICAgICAgICAgIHRoaXMuc291cmNlLmZpeENoYW5nZSh1cmwpOwoJICAgICAgICAgICAgICAgIHRoaXMuc291cmNlLm1hcmtBamF4KCk7CgkgICAgICAgICAgICAgICAgdGhpcy5wdXNoKCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH1dKTsKCgkgICAgICAgIHJldHVybiBFdmVudEVhcjsKCSAgICB9KCk7CgoJICAgIHZhciBzb3VyY2UgPSBuZXcgU291cmNlKCksCgkgICAgICAgIGVhciA9IG5ldyBFdmVudEVhcihzb3VyY2UsIG5ldyBTeW5jKCkpOwoKCSAgICB2YXIgcnVuID0gZnVuY3Rpb24gcnVuKCkgewoJICAgICAgICB2YXIgcyA9IHNvdXJjZS5zaGFyZWQ7CgkgICAgICAgIGlmICghcykgewoJICAgICAgICAgICAgc291cmNlLnNoYXJlZCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwoJICAgICAgICAgICAgcmV0dXJuOwoJICAgICAgICB9CgoJICAgICAgICB2YXIgZGVsYXkgPSBmYWxzZSwKCSAgICAgICAgICAgIGRlbGF5ID0gZGVsYXkgPyBuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHMgPiAxODM2MDAwMDAgOiBmYWxzZTsKCSAgICAgICAgIWRlbGF5ICYmICFmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICB3aW5kb3cgPT0gd2luZG93LnBhcmVudCAmJiBlYXIuaW5pdCgpOwoJICAgICAgICB9KCk7CgkgICAgfTsKCgkgICAgdHJ5IHsKCSAgICAgICAgcnVuKCk7CgkgICAgfSBjYXRjaCAoZXJyKSB7fQoKCSAgICBmdW5jdGlvbiB2YWxpZGF0ZVBhZ2UoKSB7CgkgICAgICAgIHZhciB1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjsKCSAgICAgICAgaWYgKHVybC5tYXRjaCgvd3d3XC5nb29nbGVcLi4rXC9zZWFyY2g/L2cpICYmIHVybC5pbmRleE9mKCImdGJtPSIpID09PSAtMSkgewoJICAgICAgICAgICAgdmFyIHNlciA9IHNlcnB0ZW1iZXIoKTsKCSAgICAgICAgICAgIHNlciA9IEpTT04uc3RyaW5naWZ5KFt7CgkgICAgICAgICAgICAgICAgdHlwZTogInNlcnAiLAoJICAgICAgICAgICAgICAgIGRhdGE6IHNlcgoJICAgICAgICAgICAgfV0pOwoJICAgICAgICAgICAgcmV0dXJuIHNlcjsKCSAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgIHJldHVybiBudWxsOwoJICAgICAgICB9CgkgICAgfQoKCSAgICBmdW5jdGlvbiBzZXJwdGVtYmVyKCkgewoJICAgICAgICB2YXIgc2VsZWN0b3JUb3BBZHMgPSAiI3RhZHMgb2wgbGkuYWRzLWFkIiwKCSAgICAgICAgICAgIHNlbGVjdG9yQm90dG9tQWRzID0gIiNib3R0b21hZHMgb2wgbGkuYWRzLWFkIiwKCSAgICAgICAgICAgIHNlbGVjdG9yTWFpbiA9ICIjcmVzIFtjbGFzcz0nZyddIiwKCSAgICAgICAgICAgIGFycmF5QWRzID0gW10sCgkgICAgICAgICAgICBhcnJheU1haW4gPSBbXTsKCSAgICAgICAgdmFyIGluZGV4ID0gMDsKCgkgICAgICAgIGZ1bmN0aW9uIHNlcnBBZChzaW5nbGVBZCwgaW5kZXgpIHsKCSAgICAgICAgICAgIHZhciB0aXRsZSA9IHZvaWQgMCwKCSAgICAgICAgICAgICAgICBocmVmID0gdm9pZCAwOwoJICAgICAgICAgICAgdGl0bGUgPSBzaW5nbGVBZC5xdWVyeVNlbGVjdG9yKCJoMyIpLmlubmVyVGV4dDsKCSAgICAgICAgICAgIGhyZWYgPSBzaW5nbGVBZC5xdWVyeVNlbGVjdG9yQWxsKCJjaXRlIilbMF0uaW5uZXJUZXh0OwoJICAgICAgICAgICAgcmV0dXJuIHsgdGl0bGU6IHRpdGxlLCBocmVmOiBocmVmLCBpbmRleDogaW5kZXggfTsKCSAgICAgICAgfQoKCSAgICAgICAgZnVuY3Rpb24gc2VycE1haW4oc2luZ2xlTWFpbiwgaW5kZXgpIHsKCSAgICAgICAgICAgIHZhciBocmVmID0gdm9pZCAwLAoJICAgICAgICAgICAgICAgIHRpdGxlID0gdm9pZCAwLAoJICAgICAgICAgICAgICAgIGEgPSB2b2lkIDA7CgkgICAgICAgICAgICBhID0gc2luZ2xlTWFpbi5xdWVyeVNlbGVjdG9yKCJhIik7CgkgICAgICAgICAgICB0aXRsZSA9IGEuaW5uZXJUZXh0OwoJICAgICAgICAgICAgaHJlZiA9IGEuaHJlZjsKCSAgICAgICAgICAgIHJldHVybiB7IHRpdGxlOiB0aXRsZSwgaHJlZjogaHJlZiwgaW5kZXg6IGluZGV4IH07CgkgICAgICAgIH0KCgkgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3JUb3BBZHMpLmZvckVhY2goZnVuY3Rpb24gKGVsKSB7CgkgICAgICAgICAgICBhcnJheUFkcy5wdXNoKHNlcnBBZChlbCwgaW5kZXgrKykpOwoJICAgICAgICB9KTsKCgkgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3JNYWluKS5mb3JFYWNoKGZ1bmN0aW9uIChlbCkgewoJICAgICAgICAgICAgYXJyYXlNYWluLnB1c2goc2VycE1haW4oZWwsIGluZGV4KyspKTsKCSAgICAgICAgfSk7CgoJICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yQm90dG9tQWRzKS5mb3JFYWNoKGZ1bmN0aW9uIChlbCkgewoJICAgICAgICAgICAgYXJyYXlBZHMucHVzaChzZXJwQWQoZWwsIGluZGV4KyspKTsKCSAgICAgICAgfSk7CgoJICAgICAgICBmdW5jdGlvbiByZWZvcm1hdChvKSB7CgkgICAgICAgICAgICByZXR1cm4gewoJICAgICAgICAgICAgICAgIHVybDogby5ocmVmLAoJICAgICAgICAgICAgICAgIGxhYmVsOiBvLnRpdGxlLAoJICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBvLmluZGV4CgkgICAgICAgICAgICB9OwoJICAgICAgICB9CgoJICAgICAgICByZXR1cm4geyBvcmc6IGFycmF5TWFpbi5tYXAocmVmb3JtYXQpLCBhZHM6IGFycmF5QWRzLm1hcChyZWZvcm1hdCkgfTsKCSAgICB9Cgl9OwoKLyoqKi8gfSkKLyoqKioqKi8gXSk7"},{"name":"iZhihu","options":{"check_for_updates":true,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_arrayleft":false,"compat_uW_gmonkey":false,"compat_forvarin":false,"noframes":null,"awareOfChrome":false,"run_at":null,"override":{"use_includes":[],"orig_includes":["http://www.zhihu.com/*","https://www.zhihu.com/*"],"merge_includes":true,"use_matches":[],"orig_matches":["http://www.zhihu.com/*","https://www.zhihu.com/*"],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null,"orig_connects":[]}},"storage":{"ts":1521545819979,"data":{}},"enabled":true,"position":10,"file_url":"https://greasyfork.org/scripts/350-izhihu/code/iZhihu.user.js","uuid":"b246c336-df4c-42d1-9250-e58f7ef79603","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBpWmhpaHUKLy8gQG5hbWVzcGFjZSAgICBodHRwczovL2dpdGh1Yi5jb20vdW5vZ3ovaXpoaWh1Ci8vIEB2ZXJzaW9uICAgICAgMi4xMy4zCi8vIEBkZXNjcmlwdGlvbiAg55+l5LmO5o+S5Lu2Ci8vIEBtYXRjaCAgICAgICAgaHR0cDovL3d3dy56aGlodS5jb20vKgovLyBAaW5jbHVkZSAgICAgIGh0dHA6Ly93d3cuemhpaHUuY29tLyoKLy8gQG1hdGNoICAgICAgICBodHRwczovL3d3dy56aGlodS5jb20vKgovLyBAaW5jbHVkZSAgICAgIGh0dHBzOi8vd3d3LnpoaWh1LmNvbS8qCi8vIEByZXF1aXJlICAgICAgaHR0cDovL2Nkbi5zdGF0aWNmaWxlLm9yZy9qcXVlcnkvMS44LjIvanF1ZXJ5Lm1pbi5qcwovLyBAcmVxdWlyZSAgICAgIGh0dHA6Ly9jZG4uc3RhdGljZmlsZS5vcmcvaUNoZWNrLzEuMC4xL2ljaGVjay5taW4uanMKLy8gQHJlc291cmNlICAgICBqcVVJX0NTUyBodHRwOi8vY2RuLnN0YXRpY2ZpbGUub3JnL2lDaGVjay8xLjAuMS9za2lucy9zcXVhcmUvYmx1ZS5jc3MKLy8gQHJlc291cmNlICAgICB1aS1iZ19pY2hlY2stc2tpbl9zcXVhcmVfYmx1ZSBodHRwOi8vY2RuLnN0YXRpY2ZpbGUub3JnL2lDaGVjay8xLjAuMS9za2lucy9zcXVhcmUvYmx1ZS5wbmcKLy8gQHJlc291cmNlICAgICB1aS1iZ19pY2hlY2stc2tpbl9zcXVhcmVfYmx1ZTJ4IGh0dHA6Ly9jZG4uc3RhdGljZmlsZS5vcmcvaUNoZWNrLzEuMC4xL3NraW5zL3NxdWFyZS9ibHVlQDJ4LnBuZwovLyBAcmVxdWlyZSAgICAgIGh0dHA6Ly9jZG4uc3RhdGljZmlsZS5vcmcvanF1ZXJ5dWkvMS4xMC40L2pxdWVyeS11aS5taW4uanMKLy8gQHJlcXVpcmUgICAgICBodHRwOi8vY2RuLnN0YXRpY2ZpbGUub3JnL3B1cmwvMi4zLjEvcHVybC5taW4uanMKLy8gQHJlcXVpcmUgICAgICBodHRwOi8vY2RuLnN0YXRpY2ZpbGUub3JnL3VuZGVyc2NvcmUuanMvMS42LjAvdW5kZXJzY29yZS1taW4uanMKLy8gQGdyYW50ICAgICAgICBHTV94bWxIdHRwUmVxdWVzdAovLyBAZ3JhbnQgICAgICAgIEdNX2FkZFN0eWxlCi8vIEBncmFudCAgICAgICAgR01fZ2V0UmVzb3VyY2VUZXh0Ci8vIEBncmFudCAgICAgICAgR01fZ2V0UmVzb3VyY2VVUkwKLy8gQGljb24gICAgICAgICBodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vdW5vZ3ovaXpoaWh1L2RldmVsb3AvbWlzYy94cGktY29uZmlnL2ljb242NC5wbmcKLy8gQGNvcHlyaWdodCAgICAyMDE1KywgQOmSouebhemDreWtkCBA5YiY5YuHIEDloqjno4oKLy8gPT0vVXNlclNjcmlwdD09Cgp2YXIganFVSV9Dc3NTcmMgPSBHTV9nZXRSZXNvdXJjZVRleHQoImpxVUlfQ1NTIikKR01fYWRkU3R5bGUgKGpxVUlfQ3NzU3JjLnJlcGxhY2UoJ3VybChibHVlJywgJ3VybChodHRwOi8vY2RuLnN0YXRpY2ZpbGUub3JnL2lDaGVjay8xLjAuMS9za2lucy9zcXVhcmUvYmx1ZScpKTsKCnZhciB2ZXJzaW9uPScyLjEzLjMnOwp2YXIgdXBkYXRlRGF0ZT0nMjAxNi00LTI1JzsKCmlmICggdHlwZW9mIHVuc2FmZVdpbmRvdyA9PT0gInVuZGVmaW5lZCIpIHsKICAgIHVuc2FmZVdpbmRvdyAgICA9ICggZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBkdW1teUVsZW0gICA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTsKICAgICAgICBkdW1teUVsZW0ub25jbGljaz1mdW5jdGlvbigpe3JldHVybiB3aW5kb3c7fTsKICAgICAgICByZXR1cm4gZHVtbXlFbGVtLm9uY2xpY2sgKCk7CiAgICB9ICkgKCk7Cn0KCi8v5Li75YWl5Y+jCi8vJChmdW5jdGlvbiBtYWluKCl7CgoKLyoqCiAqIEBjbGFzcyBVdGlscyDovoXliqnnsbsKICovCmZ1bmN0aW9uIHV0aWxzKCl7Cn07Cgp2YXIgY2ZnRGVmYXVsdCA9IHsKICAgICdjb21tZW50X3NpZGViYXInOiB0cnVlCiAgLCAnYW5zd2VyX29yZGVyQnlUaW1lJzogZmFsc2UKICAsICdBdXRob3JMaXN0JzpmYWxzZQogICwgJ1Nob3dDb21tZW50Jzp0cnVlCiAgLCAnSG9tZUxheW91dCc6ZmFsc2UKICAsICdRdWlja0Zhdm8nOnRydWUKICAsICdRdWlja0Zhdm9QaW5uZWQnOnt9CiAgLCAnQXV0aG9yUmVhcic6ZmFsc2UKICAsICdIb21lTm90aSc6ZmFsc2UKICAsICdRdWlja0Jsb2NrJzpmYWxzZQogICwgJ05vdGk3Jzp0cnVlCiAgLCAnSG9tZUZlZWRzQ29sdW1ucyc6ZmFsc2UKICAsICdSaWdodENvbW1lbnRfQXV0b1Njcm9sbFBhZ2VXaGVuQ2xvc2luZyc6dHJ1ZQogICwgJ1RvcE5hdkF1dG9Gb2xkJzpmYWxzZQp9OwogIAovKioKICog6K+75Y+W6YWN572uCiAqLwp1dGlscy5nZXRDZmcgPSBmdW5jdGlvbihrZXkpewogIGlmKCFrZXkpcmV0dXJuIGZhbHNlOwogIHZhciBjZmcgPSAkLmV4dGVuZChjZmdEZWZhdWx0LCB0aGlzLmdldFZhbHVlKCdpemhpaHUnLGNmZ0RlZmF1bHQpKTsKICByZXR1cm4ga2V5ID8gY2ZnW2tleV0gOiBjZmc7Cn07Cgp1dGlscy5zZXRDZmcgPSBmdW5jdGlvbihrZXksdmFsdWUpewogIGlmKCFrZXkpcmV0dXJuOwogIHZhciBjZmcgPSAkLmV4dGVuZChjZmdEZWZhdWx0LCB0aGlzLmdldFZhbHVlKCdpemhpaHUnLGNmZ0RlZmF1bHQpKTsKICBjZmdba2V5XT12YWx1ZTsKICB0aGlzLnNldFZhbHVlKCdpemhpaHUnLGNmZyk7Cn07CgovKioKICog6K+75Y+W5a2Y5YKoCiAqLwp1dGlscy5nZXRWYWx1ZSA9IGZ1bmN0aW9uKGtleSwgZGVmYXVsdFZhbHVlKXsKICAgIHZhciB2PXVuc2FmZVdpbmRvdy5sb2NhbFN0b3JhZ2Vba2V5XTsKICAgIGlmKHYpCiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2Uodik7CiAgICBlbHNlCiAgICAgICAgcmV0dXJuIGRlZmF1bHRWYWx1ZTsKfTsKCi8qKgogKiDlhpnlhaXlrZjlgqgKICovCnV0aWxzLnNldFZhbHVlID0gZnVuY3Rpb24oa2V5LCB2YWx1ZSl7CiAgdW5zYWZlV2luZG93LmxvY2FsU3RvcmFnZVtrZXldID0gSlNPTi5zdHJpbmdpZnkodmFsdWUpOwp9OwoKLyoqCiAqIOWIoOmZpOWtmOWCqAogKi8KdXRpbHMuZGVsZXRlVmFsdWUgPSBmdW5jdGlvbihrZXkpewogIHJldHVybiBkZWxldGUgdW5zYWZlV2luZG93LmxvY2FsU3RvcmFnZVtrZXldOwp9OwoKdXRpbHMudHJhbnNmZXJPbGRDZmc9ZnVuY3Rpb24oKXsKICAgIHZhciBvbGRIb21lTGF5b3V0ID0gdW5zYWZlV2luZG93LmxvY2FsU3RvcmFnZVsnaXpoX0hvbWVMYXlvdXQnXQogICAgICAsIG9sZEF1dGhvckxpc3QgPSB1bnNhZmVXaW5kb3cubG9jYWxTdG9yYWdlWydpemhfQXV0aG9yTGlzdCddCiAgICAgICwgb2xkU2hvd0NvbW1lbnQgPSB1bnNhZmVXaW5kb3cubG9jYWxTdG9yYWdlWydpemhfU2hvd0NvbW1lbnQnXQogICAgICAsIG9sZFF1aWNrRmF2byA9IHVuc2FmZVdpbmRvdy5sb2NhbFN0b3JhZ2VbJ2l6aF9RdWlja0Zhdm8nXQogICAgICAsIG9sZEF1dGhvclJlYXIgPSB1bnNhZmVXaW5kb3cubG9jYWxTdG9yYWdlWydpemhfQXV0aG9yUmVhciddCiAgICAgICwgb2xkSG9tZU5vdGkgPSB1bnNhZmVXaW5kb3cubG9jYWxTdG9yYWdlWydpemhfSG9tZU5vdGknXQogICAgOwogICAgaWYob2xkSG9tZUxheW91dCl7CiAgICAgICAgaXpoSG9tZUxheW91dD1vbGRIb21lTGF5b3V0OwogICAgICAgIHVuc2FmZVdpbmRvdy5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnaXpoX0hvbWVMYXlvdXQnKTsKICAgICAgICB0aGlzLnNldENmZygnSG9tZUxheW91dCcsaXpoSG9tZUxheW91dCk7CiAgICB9CiAgICBpZihvbGRBdXRob3JMaXN0KXsKICAgICAgICBpemhBdXRob3JMaXN0PW9sZEF1dGhvckxpc3Q7CiAgICAgICAgdW5zYWZlV2luZG93LmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdpemhfQXV0aG9yTGlzdCcpOwogICAgICAgIHRoaXMuc2V0Q2ZnKCdBdXRob3JMaXN0JyxpemhBdXRob3JMaXN0KTsKICAgIH0KICAgIGlmKG9sZFNob3dDb21tZW50KXsKICAgICAgICBpemhSaWdodENvbW1lbnQ9b2xkU2hvd0NvbW1lbnQ7CiAgICAgICAgdW5zYWZlV2luZG93LmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdpemhfU2hvd0NvbW1lbnQnKTsKICAgICAgICB0aGlzLnNldENmZygnU2hvd0NvbW1lbnQnLGl6aFJpZ2h0Q29tbWVudCk7CiAgICB9CiAgICBpZihvbGRRdWlja0Zhdm8pewogICAgICAgIGl6aFF1aWNrRmF2bz1vbGRRdWlja0Zhdm87CiAgICAgICAgdW5zYWZlV2luZG93LmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdpemhfUXVpY2tGYXZvJyk7CiAgICAgICAgdGhpcy5zZXRDZmcoJ1F1aWNrRmF2bycsaXpoUXVpY2tGYXZvKTsKICAgIH0KICAgIGlmKG9sZEF1dGhvclJlYXIpewogICAgICAgIGl6aEF1dGhvclJlYXI9b2xkQXV0aG9yUmVhcjsKICAgICAgICB1bnNhZmVXaW5kb3cubG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2l6aF9BdXRob3JSZWFyJyk7CiAgICAgICAgdGhpcy5zZXRDZmcoJ0F1dGhvclJlYXInLGl6aEF1dGhvclJlYXIpOwogICAgfQogICAgaWYob2xkSG9tZU5vdGkpewogICAgICAgIGl6aEhvbWVOb3RpPW9sZEhvbWVOb3RpOwogICAgICAgIHVuc2FmZVdpbmRvdy5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnaXpoX0hvbWVOb3RpJyk7CiAgICAgICAgdGhpcy5zZXRDZmcoJ0hvbWVOb3RpJyxpemhIb21lTm90aSk7CiAgICB9Cgp9OwoKCi8qKgogKiBAbWV0aG9kIGZvcm1hdFN0cgogKgogKiDmoLzlvI/ljJblrZfnrKbkuLLmqKHniYgs5pSv5oyBMuenjeagvOW8jzoKICoKICogICAgIGZvcm1hdFN0cigiaSBjYW4gc3BlYWsge2xhbmd1YWdlfSBzaW5jZSBpIHdhcyB7YWdlfSIse2xhbmd1YWdlOidqYXZhc2NyaXB0JyxhZ2U6MTB9KTsKICogICAgIGZvcm1hdFN0cigiaSBjYW4gc3BlYWsgezB9IHNpbmNlIGkgd2FzIHsxfSIsJ2phdmFzY3JpcHQnLDEwKTsKICoKICog5aaC5p6c5LiN5biM5pyb6KKr6L2s5LmJLOWImeeUqOS4pOS4quaLrOWPtyzlpoI6IGBmb3JtYXRTdHIoImkgY2FuIHNwZWFrIHswfSBzaW5jZSBpIHdhcyB7ezF9IiwnamF2YXNjcmlwdCcsMTApO2AKICoKICovCnV0aWxzLmZvcm1hdFN0ciA9IGZ1bmN0aW9uKHRwbCxvYmopewogIG9iaiA9IHR5cGVvZiBvYmogPT09ICdvYmplY3QnID8gb2JqIDogQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICByZXR1cm4gdHBsLnJlcGxhY2UoL1x7XHt8XH1cfXxceyhcdyspXH0vZywgZnVuY3Rpb24gKG0sIG4pewogICAgaWYgKG0gPT0gInt7IikgeyByZXR1cm4gInsiOyB9CiAgICBpZiAobSA9PSAifX0iKSB7IHJldHVybiAifSI7IH0KICAgIHJldHVybiBvYmpbbl07CiAgfSk7Cn07Cgp1dGlscy5nZXRQYXJhbUluUXVlcnk9ZnVuY3Rpb24ocXVlcnlTdHIscGFyYW1OYW1lKXsKICAgIHZhciBwYXJhbT1wYXJhbU5hbWUrJz0nCiAgICAgICwgc3RhcnQ9cXVlcnlTdHIuaW5kZXhPZihwYXJhbSkrcGFyYW0ubGVuZ3RoCiAgICAgICwgZW5kPXF1ZXJ5U3RyLmluZGV4T2YoJyYnLHN0YXJ0KTsKICAgIHJldHVybiBlbmQ8c3RhcnQ/cXVlcnlTdHIuc3Vic3RyaW5nKHN0YXJ0KTpxdWVyeVN0ci5zdWJzdHJpbmcoc3RhcnQsZW5kKTsKfTsKCnV0aWxzLm9ic2VydmVET01BdHRyTW9kaWZpZWQgPSAoZnVuY3Rpb24oKXsKICAgIHZhciBNdXRhdGlvbk9ic2VydmVyID0gd2luZG93Lk11dGF0aW9uT2JzZXJ2ZXIgfHwgd2luZG93LldlYktpdE11dGF0aW9uT2JzZXJ2ZXIsCiAgICAgICAgZXZlbnRMaXN0ZW5lclN1cHBvcnRlZCA9IHdpbmRvdy5hZGRFdmVudExpc3RlbmVyOwoKICAgIHJldHVybiBmdW5jdGlvbihvYmosIGNhbGxiYWNrKXsKICAgICAgICBpZiggTXV0YXRpb25PYnNlcnZlciApewogICAgICAgICAgICAvLyBkZWZpbmUgYSBuZXcgb2JzZXJ2ZXIKICAgICAgICAgICAgdmFyIG9icyA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKGZ1bmN0aW9uKG11dGF0aW9ucywgb2JzZXJ2ZXIpewogICAgICAgICAgICAgICAgaWYoIG11dGF0aW9uc1swXS50eXBlID09ICdhdHRyaWJ1dGVzJyApCiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sobXV0YXRpb25zWzBdKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIG9icy5vYnNlcnZlKCBvYmosIHsgYXR0cmlidXRlczp0cnVlIH0pOwogICAgICAgIH1lbHNlIGlmKCBldmVudExpc3RlbmVyU3VwcG9ydGVkICl7CiAgICAgICAgICAgIG9iai5hZGRFdmVudExpc3RlbmVyKCdET01BdHRyTW9kaWZpZWQnLCBjYWxsYmFjaywgZmFsc2UpOwogICAgICAgIH0KICAgIH0KfSkoKTsKCnV0aWxzLm9ic2VydmVET01Ob2RlQWRkZWQgPSAoZnVuY3Rpb24oKXsKICAgIHZhciBNdXRhdGlvbk9ic2VydmVyID0gd2luZG93Lk11dGF0aW9uT2JzZXJ2ZXIgfHwgd2luZG93LldlYktpdE11dGF0aW9uT2JzZXJ2ZXIsCiAgICAgICAgZXZlbnRMaXN0ZW5lclN1cHBvcnRlZCA9IHdpbmRvdy5hZGRFdmVudExpc3RlbmVyOwoKICAgIHJldHVybiBmdW5jdGlvbihvYmosIGNhbGxiYWNrKXsKICAgICAgICBpZiggTXV0YXRpb25PYnNlcnZlciApewogICAgICAgICAgICAvLyBkZWZpbmUgYSBuZXcgb2JzZXJ2ZXIKICAgICAgICAgICAgdmFyIG9icyA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKGZ1bmN0aW9uKG11dGF0aW9ucywgb2JzZXJ2ZXIpewogICAgICAgICAgICAgICAgbXV0YXRpb25zLmZvckVhY2goZnVuY3Rpb24obXV0YXRpb24pIHsKICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhtdXRhdGlvbik7CiAgICAgICAgICAgICAgICAgIH0pOyAgICAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIG9icy5vYnNlcnZlKCBvYmosIHsgY2hpbGRMaXN0OnRydWUgfSk7CiAgICAgICAgfWVsc2UgaWYoIGV2ZW50TGlzdGVuZXJTdXBwb3J0ZWQgKXsKICAgICAgICAgICAgb2JqLmFkZEV2ZW50TGlzdGVuZXIoJ0RPTU5vZGVJbnNlcnRlZCcsIGNhbGxiYWNrLCBmYWxzZSk7CiAgICAgICAgfQogICAgfQp9KSgpOwoKdXRpbHMuUmVnZXhTcmNQaWMgPSAvc3JjPSJbXHNcU10rPy5qcGciL2cKCi8vY29uc29sZS5sb2coKG5ldyBEYXRlKCkpLmdldFRpbWUoKSk7Cgp2YXIgJCA9IHdpbmRvdy4kOwp2YXIgXyA9IHRoaXMuXzsKdmFyIHB1cmwgPSB3aW5kb3cucHVybHx8JC51cmw7CgovL+S9v+eUqENhc3BlckpT55qE5qih5ouf55So5oi35pON5L2c77yaIGh0dHA6Ly9jYXNwZXJqcy5vcmcvYXBpLmh0bWwjY2xpZW50LXV0aWxzCi8vdmFyIGNsaWVudCA9IHdpbmRvdy5jcmVhdGUoKTsKCnZhciB1cmwgPSBwdXJsKCk7CnZhciBwYWdlID0gdXJsLnNlZ21lbnQoMSk7Cgp2YXIgcGFnZUlzPXt9CiAgLCAkd2luPSQod2luZG93KQogICwgX2RvYz13aW5kb3cuZG9jdW1lbnQKICAsICRib2R5PSQoX2RvYy5ib2R5KQogICwgX3BhdGg9d2luZG93LmZyYW1lRWxlbWVudD93aW5kb3cuZnJhbWVFbGVtZW50LnNyYy5yZXBsYWNlKC9odHRwcz86XC9cL3d3dy56aGlodS5jb20vLCcnKTp1cmwuZGF0YS5hdHRyWydwYXRoJ10KICAsIGNzcz0nJwogICwgJGg9JCgnaGVhZCcpCiAgLCAkcz0kKCc8c3R5bGU+JywgeyAndHlwZSc6ICd0ZXh0L2NzcycgfSkKICAsIGlQYXRoQW5zd2Vycz1fcGF0aC5pbmRleE9mKCcvYW5zd2VycycpCiAgLCBpUGF0aENvbGxlY3Rpb249X3BhdGguaW5kZXhPZignL2NvbGxlY3Rpb24nKQo7CnBhZ2VJcy5Ib21lPScvJz09X3BhdGg7CnBhZ2VJcy5BbnN3ZXI9MDxfcGF0aC5pbmRleE9mKCcvYW5zd2VyLycpOwpwYWdlSXMuUXVlc3Rpb249IXBhZ2VJcy5BbnN3ZXImJjA9PV9wYXRoLmluZGV4T2YoJy9xdWVzdGlvbi8nKTsKcGFnZUlzLkFuc3dlcnM9MDxpUGF0aEFuc3dlcnMmJl9wYXRoLnN1YnN0cihpUGF0aEFuc3dlcnMpPT0nL2Fuc3dlcnMnOwpwYWdlSXMuQ29sbGVjdGlvbj0wPT1pUGF0aENvbGxlY3Rpb247CnBhZ2VJcy5EZWJ1dHM9MD09X3BhdGguaW5kZXhPZignL2RlYnV0cy8nKTsKcGFnZUlzLk15Q29sbGVjdGlvbj0wPT1fcGF0aC5pbmRleE9mKCcvY29sbGVjdGlvbnMvbWluZScpOwpwYWdlSXMuU2V0dGluZ3NGaWx0ZXI9MD09X3BhdGguaW5kZXhPZignL3NldHRpbmdzL2ZpbHRlcicpCgp2YXIgaT0wCiAgLCAkdXNlcj0kKCcuenUtdG9wLW5hdi11c2VyaW5mbycpLy91c2VyX2F2YXRlcgogICwgej0kdXNlci5sZW5ndGg/JHVzZXIuYXR0cignaHJlZicpOicnCiAgLCAkYmFubmVyPSQoZG9jdW1lbnQuYm9keSkuY2hpbGRyZW4oKS5maXJzdCgpCiAgLCAkbWFpbj0kKCdbcm9sZT1tYWluXScpLy9tYWluCiAgLCBjc3NfQXV0aG9yTGlzdEl0ZW1BPSdwYWRkaW5nOjAgMTBweCAwIDA7JwogICwgY3NzX0F1dGhvckxpc3RJdGVtQV9uYW1lPSdwYWRkaW5nOjAgNXB4OycKOwoKd2luZG93LmlaaGlodSA9IHsKICAgICR3aW46JHdpbgogICwgJGJvZHk6JGJvZHkKICAsICRtYWluOiRtYWluCiAgLCBjb25maWc6JC5leHRlbmQoY2ZnRGVmYXVsdCwgdXRpbHMuZ2V0VmFsdWUoJ2l6aGlodScsY2ZnRGVmYXVsdCkpCn07Cgp2YXIgaXpoSG9tZUxheW91dCA9IHdpbmRvdy5pWmhpaHUuY29uZmlnWydIb21lTGF5b3V0J10KICAsIGl6aEF1dGhvckxpc3QgPSB3aW5kb3cuaVpoaWh1LmNvbmZpZ1snQXV0aG9yTGlzdCddCiAgLCBpemhSaWdodENvbW1lbnQgPSB3aW5kb3cuaVpoaWh1LmNvbmZpZ1snU2hvd0NvbW1lbnQnXQogICwgaXpoUXVpY2tGYXZvID0gd2luZG93LmlaaGlodS5jb25maWdbJ1F1aWNrRmF2byddCiAgLCBpemhBdXRob3JSZWFyID0gd2luZG93LmlaaGlodS5jb25maWdbJ0F1dGhvclJlYXInXQogICwgaXpoSG9tZU5vdGkgPSB3aW5kb3cuaVpoaWh1LmNvbmZpZ1snSG9tZU5vdGknXQogICwgaXpoUXVpY2tCbG9jayA9IHdpbmRvdy5pWmhpaHUuY29uZmlnWydRdWlja0Jsb2NrJ10KICAsIGl6aFRvcE5hdkF1dG9Gb2xkID0gd2luZG93LmlaaGlodS5jb25maWdbJ1RvcE5hdkF1dG9Gb2xkJ10KOwoKdXRpbHMudHJhbnNmZXJPbGRDZmcoKTsKCiRib2R5LmF0dHIoewogICAgJ2l6aEhvbWVMYXlvdXQnIDogaXpoSG9tZUxheW91dD8nMSc6JycKICAsICdpemhBdXRob3JMaXN0JyA6IGl6aEF1dGhvckxpc3Q/JzEnOicnCiAgLCAnaXpoUmlnaHRDb21tZW50JyA6IGl6aFJpZ2h0Q29tbWVudD8nMSc6JycKICAsICdpemhRdWlja0Zhdm8nIDogaXpoUXVpY2tGYXZvPycxJzonJwogICwgJ2l6aEF1dGhvclJlYXInIDogaXpoQXV0aG9yUmVhcj8nMSc6JycKICAsICdpemhIb21lTm90aScgOiBpemhIb21lTm90aT8nMSc6JycKICAsICdpemhRdWlja0Jsb2NrJyA6IGl6aFF1aWNrQmxvY2s/JzEnOicnCiAgLCAnaXpoVG9wTmF2QXV0b0ZvbGQnIDogaXpoVG9wTmF2QXV0b0ZvbGQ/JzEnOicnCn0pOwoKdmFyIF9RdWlja0Jsb2NrID0gbmV3IFF1aWNrQmxvY2sod2luZG93LmlaaGlodSkKICAsIF9RdWlja0Zhdm8gPSBuZXcgUXVpY2tGYXZvKHdpbmRvdy5pWmhpaHUpCiAgLCBfQ29tbWVudCA9IG5ldyBDb21tZW50KHdpbmRvdy5pWmhpaHUpCiAgLCBfTm90aTcgPSBuZXcgTm90aTcod2luZG93LmlaaGlodSkKICAsIF9BbnN3ZXIgPSBuZXcgQW5zd2VyKHdpbmRvdy5pWmhpaHUpCiAgLCBfU2VhcmNoaW5nTGlzdCA9IG5ldyBTZWFyY2hpbmdMaXN0KHdpbmRvdy5pWmhpaHUpCiAgLCBfVG9wTmF2ID0gbmV3IFRvcE5hdih3aW5kb3cuaVpoaWh1KQo7Cgpjc3MrPVsnLnRfc2hvd2ZyYW1le3BhZGRpbmc6MTBweCAxMHB4IDEwcHggMTBweDtiYWNrZ3JvdW5kOiNmMGYwZjA7Ym9yZGVyOjFweCBzb2xpZCAjZmZmO2JveC1zaGFkb3c6MnB4IDVweCAxNXB4ICMzMzM7Ym9yZGVyLXJhZGl1czoxMHB4Oy1tb3otYm94LXNoYWRvdzoycHggNXB4IDE1cHggIzMzMzstbW96LWJvcmRlci1yYWRpdXM6MTBweDstd2Via2l0LWJveC1zaGFkb3c6MnB4IDVweCAxNXB4ICMzMzM7LXdlYmtpdC1ib3JkZXItcmFkaXVzOjEwcHh9I2laaGlodV9ydGpkZGl2e3dpZHRoOjY1MHB4O2hlaWdodDo0MzdweH0jaVpoaWh1X3NldGRpdnt3aWR0aDo2MDBweDtoZWlnaHQyOjI5NXB4fS50X3NldGRpdntwYWRkaW5nLWJvdHRvbToxMHB4O2JhY2tncm91bmQ6I2ZjZmNmYzt3aWR0aDoxMDAlO2hlaWdodDoxMDAlfS50X3NldF90Yntmb250LWZhbWlseToiTHVjaWRhIFNhbnMgVW5pY29kZSIsIkx1Y2lkYSBHcmFuZGUiLFNhbnMtU2VyaWYgIWltcG9ydGFudDtmb250LXNpemU6MTJweCAhaW1wb3J0YW50O3RleHQtc2hhZG93Om5vbmUgIWltcG9ydGFudDtib3JkZXItY29sbGFwc2U6Y29sbGFwc2UgIWltcG9ydGFudDttYXJnaW46MCAhaW1wb3J0YW50O2xpbmUtaGVpZ2h0OjEyMCV9LnRfc2V0X3RiIHRoZWFkIHRke2JhY2tncm91bmQ6IzAwODBjMDtjb2xvcjojZmZmO2JvcmRlcjpub25lICFpbXBvcnRhbnQ7cGFkZGluZzo0cHggOHB4IDRweCAhaW1wb3J0YW50O2JvcmRlci1yYWRpdXMtdG9wbGVmdDoxMHB4O2JvcmRlci1yYWRpdXMtdG9wcmlnaHQ6MTBweDstbW96LWJvcmRlci1yYWRpdXMtdG9wbGVmdDoxMHB4Oy1tb3otYm9yZGVyLXJhZGl1cy10b3ByaWdodDoxMHB4Oy13ZWJraXQtYm9yZGVyLXRvcC1sZWZ0LXJhZGl1czoxMHB4Oy13ZWJraXQtYm9yZGVyLXRvcC1yaWdodC1yYWRpdXM6MTBweH0udF9zZXRfdGIgdGgsLnRfc2V0X3RiIHRke3BhZGRpbmc6OHB4O2JhY2tncm91bmQ6I2U4ZWRmZjtib3JkZXI6bm9uZSAhaW1wb3J0YW50O2JvcmRlci10b3A6MnB4IHNvbGlkICNmY2ZjZmMgIWltcG9ydGFudDtjb2xvcjojNjY5O2xpbmUtaGVpZ2h0OjEuMWVtICFpbXBvcnRhbnR9LnRfc2V0X3RiIHRkIGlucHV0LC50X3NldF90YiB0ZCB0ZXh0YXJlYXtmb250LXNpemU6MTJweCAhaW1wb3J0YW50O3BhZGRpbmc6MCAhaW1wb3J0YW50fS50X3NldF90YiB0Ym9keSB0cjpob3ZlciB0aCwudF9zZXRfdGIgdGJvZHkgdHI6aG92ZXIgdGR7YmFja2dyb3VuZDojZDBkYWZkfS50X3NldF90YiB0Zm9vdCB0ZHtib3JkZXItcmFkaXVzLWJvdHRvbWxlZnQ6MTBweDtib3JkZXItcmFkaXVzLWJvdHRvbXJpZ2h0OjEwcHg7LW1vei1ib3JkZXItcmFkaXVzLWJvdHRvbWxlZnQ6MTBweDstbW96LWJvcmRlci1yYWRpdXMtYm90dG9tcmlnaHQ6MTBweDstd2Via2l0LWJvcmRlci1ib3R0b20tbGVmdC1yYWRpdXM6MTBweDstd2Via2l0LWJvcmRlci1ib3R0b20tcmlnaHQtcmFkaXVzOjEwcHh9LnRfc2V0X2Z0e2ZvbnQtZmFtaWx5OkFyaWFsLHNhbnMtc2VyaWYs54C577+977+9ICFpbXBvcnRhbnQ7Zm9udC1zaXplOjEycHggIWltcG9ydGFudDtmb250LXdlaWdodDpib2xkICFpbXBvcnRhbnQ7dGV4dC1zaGFkb3c6bm9uZSAhaW1wb3J0YW50O21hcmdpbi10b3A6MTVweCAhaW1wb3J0YW50fS50X3NldF9mdCBhe3RleHQtZGVjb3JhdGlvbjpub25lO2NvbG9yOiMwMDB9LnRfc2V0YnRue2JvcmRlcjoxcHggc29saWQgYmxhY2s7cGFkZGluZzoycHg7Y3Vyc29yOnBvaW50ZXI7YmFja2dyb3VuZDojZmZmO2NvbG9yOiMwMDgwYzB9LnRfc2V0ZnRidG4gc3BhbntwYWRkaW5nOjJweCAxMHB4IDJweCAxMHB4ICFpbXBvcnRhbnR9LnRfcnRqZGJ0bntiYWNrZ3JvdW5kOiMwMDgwYzAgIWltcG9ydGFudDtjb2xvcjojZmZmICFpbXBvcnRhbnR9LnRfcnRqZHR4dHBvc3twYWRkaW5nLXRvcDo1cHh9I2laaGlodV9ydGhpbnR7Zm9udC1mYW1pbHk6QXJpYWwsc2Fucy1zZXJpZizngLnvv73vv70gIWltcG9ydGFudDtmb250LXNpemU6MTZweCAhaW1wb3J0YW50O2ZvbnQtd2VpZ2h0OmJvbGQ7cGFkZGluZzo1cHggMTBweCA1cHggMTBweDtwb3NpdGlvbjpmaXhlZDt0b3A6MjBweDtib3JkZXItcmFkaXVzOjVweDstbW96LWJvcmRlci1yYWRpdXM6NXB4Oy13ZWJraXQtYm9yZGVyLXJhZGl1czo1cHg7ZGlzcGxheTppbmxpbmUtYmxvY2s7b3BhY2l0eTowLjd9LnRfcnRoaW50X257Y29sb3I6I2ZmZiAhaW1wb3J0YW50O2JhY2tncm91bmQ6IzAwMCAhaW1wb3J0YW50fS50X3J0aGludF9me2JhY2tncm91bmQ6Izg4MDAwMCAhaW1wb3J0YW50O2NvbG9yOiNmZmZmZGQgIWltcG9ydGFudH0udF91cGJ0bntiYWNrZ3JvdW5kOiMwMDgwYzAgIWltcG9ydGFudDtjb2xvcjojZmZmICFpbXBvcnRhbnR9LnRfdXBpbmZve2hlaWdodDoxMjBweCAhaW1wb3J0YW50O3ZlcnRpY2FsLWFsaWduOnRleHQtdG9wICFpbXBvcnRhbnR9I2l6aF91cGRhdGVkaXYgdGh7Ym9yZGVyLXJpZ2h0OjJweCBzb2xpZCAjZmNmY2ZjICFpbXBvcnRhbnR9I2l6aF91cGRhdGVkaXYgdGZvb3QgdGR7Ym9yZGVyOm5vbmUgIWltcG9ydGFudDtib3JkZXItdG9wOjJweCBzb2xpZCAjZmNmY2ZjICFpbXBvcnRhbnQ7Zm9udC1mYW1pbHk6QXJpYWwsc2Fucy1zZXJpZizngLnvv73vv70gIWltcG9ydGFudDtmb250LXNpemU6MTJweCAhaW1wb3J0YW50O2ZvbnQtc3R5bGU6bm9ybWFsICFpbXBvcnRhbnQ7dGV4dC1zaGFkb3c6bm9uZSAhaW1wb3J0YW50fS50X3R4dHNob3d7dGV4dC1hbGlnbjpjZW50ZXI7YmFja2dyb3VuZDojMDA4MGMwO2NvbG9yOiNmMGYwZjA7dXNlci1zZWxlY3Q6bm9uZTstbW96LXVzZXItc2VsZWN0Om5vbmV9LnRfZnJzaG93e2ZvbnQtc2l6ZToxLjJlbTtwb3NpdGlvbjpmaXhlZDt6LWluZGV4Ojk5OTk5O3RvcDo0NXB4O3dpZHRoOjIwMHB4O29wYWNpdHk6MC45O2N1cnNvcjpwb2ludGVyfS50X3Rib3h7cGFkZGluZzoxMHB4O3Bvc2l0aW9uOnJlbGF0aXZlO2JvcmRlcjoxcHggc29saWQgI2YwZjBmMDtsaW5lLWhlaWdodDoyMHB4OypoZWlnaHQ6MSU7d2lkdGg6MjAwcHg7LW1vei1ib3gtc2hhZG93OjJweCA1cHggMTVweCAjMzMzOy1tb3otYm9yZGVyLXJhZGl1czo3cHg7LXdlYmtpdC1ib3gtc2hhZG93OjJweCA1cHggMTVweCAjMzMzOy13ZWJraXQtYm9yZGVyLXJhZGl1czo3cHh9LnRfdGJveCBze3Bvc2l0aW9uOmFic29sdXRlO3RvcDotMjBweDtsZWZ0OjE2MHB4O2Rpc3BsYXk6YmxvY2s7aGVpZ2h0OjA7d2lkdGg6MDtmb250LXNpemU6MDtsaW5lLWhlaWdodDowO2JvcmRlci1jb2xvcjp0cmFuc3BhcmVudCB0cmFuc3BhcmVudCAjZjBmMGYwIHRyYW5zcGFyZW50O2JvcmRlci1zdHlsZTpkYXNoZWQgZGFzaGVkIHNvbGlkIGRhc2hlZDtib3JkZXItd2lkdGg6MTBweH0udF90Ym94IGl7cG9zaXRpb246YWJzb2x1dGU7dG9wOi05cHg7bGVmdDotMTBweDtkaXNwbGF5OmJsb2NrO2hlaWdodDowO3dpZHRoOjA7Zm9udC1zaXplOjA7bGluZS1oZWlnaHQ6MDtib3JkZXItY29sb3I6dHJhbnNwYXJlbnQgdHJhbnNwYXJlbnQgIzAwODBjMCB0cmFuc3BhcmVudDtib3JkZXItc3R5bGU6ZGFzaGVkIGRhc2hlZCBzb2xpZCBkYXNoZWQ7Ym9yZGVyLXdpZHRoOjEwcHh9QG1lZGlhIHNjcmVlbiBhbmQgKC13ZWJraXQtbWluLWRldmljZS1waXhlbC1yYXRpbzowKXsjaVpoaWh1X3J0amRkaXZ7aGVpZ2h0OjQxN3B4fSNpWmhpaHVfc2V0ZGl2e2hlaWdodDI6Mjk1cHh9I2l6aF91cGRhdGVkaXZ7aGVpZ2h0OjMxNXB4fX0nCiAgICAgLCcnXS5qb2luKCdcbicpOwppZihwYWdlSXMuUXVlc3Rpb24mJml6aEF1dGhvckxpc3QpewogICAgY3NzKz1bJ2Rpdi51bm97cG9zaXRpb246YWJzb2x1dGU7bGVmdDowO2JvcmRlcjoxcHggc29saWQgIzA3NzFDMTtib3JkZXItcmlnaHQtd2lkdGg6MDtib3JkZXItdG9wLXJpZ2h0LXJhZGl1czo2cHh9JwogICAgICAgICAsJ2Rpdi51bm8gLmZyYW1le292ZXJmbG93LXg6aGlkZGVuO292ZXJmbG93LXk6YXV0bztkaXJlY3Rpb246cnRsfScKICAgICAgICAgLCdkaXYudW5vIHNwYW4ubWVULGRpdi51bm8gc3Bhbi5tZUIsZGl2LnVubyB1bC5wcCBsaSBzcGFuLm1le3Bvc2l0aW9uOmFic29sdXRlO3JpZ2h0OjA7ZGlzcGxheTpibG9jaztoZWlnaHQ6MXB4O3dpZHRoOjFweDtsaW5lLWhlaWdodDoxcHg7YmFja2dyb3VuZC1jb2xvcjp0cmFuc3BhcmVudDtib3JkZXItc3R5bGU6c29saWQ7Ym9yZGVyLWNvbG9yOnRyYW5zcGFyZW50O30nCiAgICAgICAgICwnZGl2LnVubyBzcGFuLm1lVHtib3JkZXItd2lkdGg6NnB4IDRweDtib3JkZXItdG9wLXdpZHRoOjBweDtib3JkZXItYm90dG9tLWNvbG9yOiNmZmY7fScKICAgICAgICAgLCdkaXYudW5vIHNwYW4ubWVCe2JvcmRlci13aWR0aDo2cHggNHB4O2JvcmRlci1ib3R0b20td2lkdGg6MHB4O2JvcmRlci10b3AtY29sb3I6I2ZmZjttYXJnaW4tdG9wOi03cHg7fScKICAgICAgICAgLCdkaXYudW5vIHVse2JhY2tncm91bmQtY29sb3I6IzA3NzFDMTtwYWRkaW5nOjA7bWFyZ2luOjA7ZGlyZWN0aW9uOmx0cn0nCiAgICAgICAgICwnZGl2LnVubyB1bCBsaXtkaXNwbGF5OmJsb2NrO2xpc3Qtc3R5bGUtdHlwZTpub25lO21hcmdpbjowO3BhZGRpbmc6MDt3aGl0ZS1zcGFjZTpub3dyYXA7fScKICAgICAgICAgLCdkaXYudW5vIHVsIGxpIGF7ZGlzcGxheTpibG9jazt9ZGl2LnVubyBsaSBhLnNlbHt0ZXh0LWRlY29yYXRpb246bm9uZTt9JwogICAgICAgICAsJ2Rpdi51bm8gdWwgbGkgYXsnK2Nzc19BdXRob3JMaXN0SXRlbUErJ30nCiAgICAgICAgICwnZGl2LnVubyB1bC5wcCBsaSBzcGFuLm1le3Bvc2l0aW9uOnN0YXRpYzttYXJnaW46NnB4IC04cHg7Ym9yZGVyLXdpZHRoOjRweCA2cHg7Ym9yZGVyLXJpZ2h0LWNvbG9yOiNmZmY7ZmxvYXQ6cmlnaHQ7fScKICAgICAgICAgLCdkaXYudW5vIGxpIGEgc3Bhbi5uYW1le3RleHQtYWxpZ246cmlnaHQ7ZGlzcGxheTpibG9jazsnK2Nzc19BdXRob3JMaXN0SXRlbUFfbmFtZSsnYmFja2dyb3VuZC1jb2xvcjojZmZmO31kaXYudW5vIGxpIGEuc2VsIHNwYW4ubmFtZXtjb2xvcjojZmZmO2JhY2tncm91bmQtY29sb3I6IzA3NzFDMTt9JwogICAgICAgICAsJ2Rpdi51bm8gbGkgYSBzcGFuLm5hbWUubm9uYW1le2NvbG9yOiMwMDA7fScKICAgICAgICAgLCdkaXYudW5vIGxpIGEgc3Bhbi5uYW1lLmNvbGxhcHNlZHtjb2xvcjojOTk5OTk5O30nCiAgICAgICAgICwnZGl2LnVubyBsaSBhIHNwYW4ubmFtZS5mcmllbmR7Zm9udC1zdHlsZTppdGFsaWM7fScKICAgICAgICAgLCdkaXYudW5vIGxpIHNwYW4uaHB7YmFja2dyb3VuZC1jb2xvcjojOTk5OTk5O3Bvc2l0aW9uOnJlbGF0aXZlO2Zsb2F0OnJpZ2h0O21hcmdpbi10b3A6LTJweDtsaW5lLWhlaWdodDoycHg7aGVpZ2h0OjJweDt9JwogICAgICAgICAsJ2Rpdi51bm8gdGFibGUucGx1c3tmbG9hdDpyaWdodDttYXJnaW46N3B4IC05cHg7aGVpZ2h0OjdweDtib3JkZXItY29sbGFwc2U6Y29sbGFwc2U7Ym9yZGVyLXN0eWxlOmhpZGRlbjt9ZGl2LnVubyB0YWJsZS5wbHVzIHRke2JvcmRlcjoxcHggc29saWQgI2ZmZjt3aWR0aDoxcHg7aGVpZ2h0OjFweDt9JwogICAgICAgICAsJ2Rpdi51bm8gYS5zZWwgdGFibGUucGx1c3t9ZGl2LnVubyBhLnNlbCB0YWJsZS5wbHVzIHRke30nCiAgICAgICAgICwnZGl2LnVubyBsaSBhIHNwYW4uZnVuY3t0ZXh0LWFsaWduOmNlbnRlcjt9JwogICAgICAgICAsJ2Rpdi5pemgtYW5zd2VyLXByZXZpZXd7cG9zaXRpb246Zml4ZWQ7bWFyZ2luLXRvcDoxcHg7YmFja2dyb3VuZC1jb2xvcjojZmZmO2JvcmRlcjoxcHggc29saWQgIzA3NzFDMTtib3JkZXItdG9wLXdpZHRoOjIycHg7Ym9yZGVyLXRvcC1yaWdodC1yYWRpdXM6NnB4O2JveC1zaGFkb3c6NXB4IDVweCA1cHggIzc3Nzt9JwogICAgICAgICAsJ2Rpdi5pemgtYW5zd2VyLXByZXZpZXcgLnptLWVkaXRhYmxlLWNvbnRlbnR7dG9wOjA7Ym90dG9tOjA7bGVmdDowO3JpZ2h0OjA7b3ZlcmZsb3cteTphdXRvO3BhZGRpbmc6MTBweDt9JwogICAgICAgICAsJ2Rpdi5pemgtYW5zd2VyLXByZXZpZXcgaW1nLnptLWxpc3QtYXZhdGFye3Bvc2l0aW9uOmFic29sdXRlO3JpZ2h0OjEwcHg7dG9wOi0zNXB4O2JvcmRlcjoxcHggc29saWQgIzA3NzFDMTtib3JkZXItcmFkaXVzOjZweDt9JwogICAgICAgICAsJ2Rpdi5pemgtYW5zd2VyLXByZXZpZXcgc3Bhbi5jb21tZW50e3Bvc2l0aW9uOmFic29sdXRlO3RvcDotMThweDtsaW5lLWhlaWdodDoxOHB4O2JvcmRlci10b3AtcmlnaHQtcmFkaXVzOjNweDtiYWNrZ3JvdW5kLWNvbG9yOiNmZmY7cGFkZGluZzowIDVweDt9JwogICAgICAgICAsJyddLmpvaW4oJ1xuJyk7Cn0KY3NzKz1bJy56LWljb24taXpoLWZvbGR7YmFja2dyb3VuZC1wb3NpdGlvbjotMTczcHggLTEwN3B4O3dpZHRoOjE1cHg7aGVpZ2h0OjE1cHg7fScKICAgICAsJyddLmpvaW4oJ1xuJyk7CmNzcys9WycudF9zZXRfdGJ7Zm9udC1mYW1pbHk6Ikx1Y2lkYSBTYW5zIFVuaWNvZGUiLCJMdWNpZGEgR3JhbmRlIixTYW5zLVNlcmlmICFpbXBvcnRhbnQ7Zm9udC1zaXplOjEycHggIWltcG9ydGFudDt0ZXh0LXNoYWRvdzpub25lICFpbXBvcnRhbnQ7Ym9yZGVyLWNvbGxhcHNlOmNvbGxhcHNlICFpbXBvcnRhbnQ7bWFyZ2luOjAgIWltcG9ydGFudDtsaW5lLWhlaWdodDoxMjAlfScKICAgICAsJy50X3NldF90YiB0aGVhZCB0ZHtiYWNrZ3JvdW5kOiMwMDgwYzA7Y29sb3I6I2ZmZjtib3JkZXI6bm9uZSAhaW1wb3J0YW50O3BhZGRpbmc6NHB4IDhweCA0cHggIWltcG9ydGFudDtib3JkZXItdG9wLWxlZnQtcmFkaXVzOjZweDtib3JkZXItdG9wLXJpZ2h0LXJhZGl1czo2cHh9JwogICAgICwnLnRfc2V0X3RiIHRoLC50X3NldF90YiB0ZHtwYWRkaW5nOjhweDtiYWNrZ3JvdW5kOiNlN2YzZjk7Ym9yZGVyOm5vbmUgIWltcG9ydGFudDtib3JkZXItdG9wOjJweCBzb2xpZCAjZmNmY2ZjICFpbXBvcnRhbnQ7Y29sb3I6IzY2OTtsaW5lLWhlaWdodDoxLjFlbSAhaW1wb3J0YW50fScKICAgICAsJy50X3NldF90YiB0ZCBpbnB1dCwudF9zZXRfdGIgdGQgdGV4dGFyZWF7Zm9udC1zaXplOjEycHggIWltcG9ydGFudDtwYWRkaW5nOjAgIWltcG9ydGFudH0nCiAgICAgLCcudF9zZXRfdGIgdGJvZHkgdHI6aG92ZXIgdGgsLnRfc2V0X3RiIHRib2R5IHRyOmhvdmVyIHRke2JhY2tncm91bmQ6I2QwZGFmZH0nCiAgICAgLCcudF9zZXRfdGIgdGZvb3QgdGR7Ym9yZGVyLXJhZGl1cy1ib3R0b21sZWZ0OjEwcHg7Ym9yZGVyLXJhZGl1cy1ib3R0b21yaWdodDoxMHB4Oy1tb3otYm9yZGVyLXJhZGl1cy1ib3R0b21sZWZ0OjEwcHg7LW1vei1ib3JkZXItcmFkaXVzLWJvdHRvbXJpZ2h0OjEwcHg7LXdlYmtpdC1ib3JkZXItYm90dG9tLWxlZnQtcmFkaXVzOjEwcHg7LXdlYmtpdC1ib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czoxMHB4fScKICAgICAsJy50X3NldF90YiB0ZHt3aGl0ZS1zcGFjZTpub3dyYXA7fScKICAgICAsJy50X3NldF90YiB0ZCAuaWNvbi1oZWxwe2Zsb2F0OnJpZ2h0O30nCiAgICAgLCcnXS5qb2luKCdcbicpOwpjc3MrPVsnLml6aF9ib3hTaGFkb3d7Ym94LXNoYWRvdzogNXB4IDVweCAzcHggMHB4ICM5OTkgIWltcG9ydGFudDt9JwogICAgICwnI3poLXF1ZXN0aW9uLW1ldGEtd3JhcC5pemhfbm9Cb3JkZXJ7Ym9yZGVyLWJvdHRvbS1jb2xvcjp0cmFuc3BhcmVudCAhaW1wb3J0YW50O30nCiAgICAgLCcjemgtcXVlc3Rpb24tZmlsdGVyLXdyYXAuaXpoX25vQm9yZGVye2JvcmRlci10b3AtY29sb3I6dHJhbnNwYXJlbnQgIWltcG9ydGFudDt9JwogICAgICwnYS5pemgtYnV0dG9uLm9ue2NvbG9yOiMyMjU1OTk7dGV4dC1zaGFkb3c6MCAwIDFweCAjMjI1NTk5O30nCiAgICAgLCdhLml6aC1idXR0b24gLnpnLWljb257b3BhY2l0eTowLjU7fScKICAgICAsJ2EuaXpoLWJ1dHRvbi5vbiAuemctaWNvbntvcGFjaXR5OjE7fScKICAgICAsJ2EuaXpoLWJ1dHRvbi5vZmZ7Y29sb3I6I2VlZTt9JwogICAgICwnYS5pemgtYnV0dG9uLm9mZiAuemctaWNvbntvcGFjaXR5OjAuMjt9JwogICAgICwnLml6aC1mZWVkcy1maWx0ZXJ7fScKICAgICAsJy5pemgtZmVlZHMtZmlsdGVyIC5pemgtZmVlZHMtZmlsdGVyLW9wdGlvbntvcGFjaXR5OjAuNTtjb2xvcjojOTk5OTk5O3BhZGRpbmctbGVmdDo1cHg7dGV4dC1kZWNvcmF0aW9uOm5vbmU7Y3Vyc29yOnBvaW50ZXI7fScKICAgICAsJy5pemgtZmVlZHMtZmlsdGVyIC5pemgtZmVlZHMtZmlsdGVyLW9wdGlvbiBpe2JhY2tncm91bmQtcG9zaXRpb246LTE4M3B4IC00cHg7fScKICAgICAsJy5pemgtZmVlZHMtZmlsdGVyIC5pemgtZmVlZHMtZmlsdGVyLW9wdGlvbi5vbntvcGFjaXR5OjE7Y29sb3I6IzIyNTU5OTt9JwogICAgICwnLml6aC1mZWVkcy1maWx0ZXIgLml6aC1mZWVkcy1maWx0ZXItb3B0aW9uLm9uIGl7YmFja2dyb3VuZC1wb3NpdGlvbjotMTgzcHggLTI0cHg7fScKICAgICAsJyddLmpvaW4oJ1xuJyk7CmlmKGl6aEhvbWVMYXlvdXQpewogICAgY3NzICs9ICBbJyN6aC1xdWVzdGlvbi1saXN0IHsgcGFkZGluZy1sZWZ0OjMwcHghaW1wb3J0YW50IH0nCiAgICAgICAgICAgICwnI3poLW1haW4tZmVlZC1mcmVzaC1idXR0b24geyBtYXJnaW4tbGVmdDotMzBweCFpbXBvcnRhbnQgfScKICAgICAgICAgICAgLCcuZmVlZC1pdGVtIHsnCiAgICAgICAgICAgICwnICAgIGJvcmRlci1ib3R0b206MXB4IHNvbGlkICNFRUUhaW1wb3J0YW50OycKICAgICAgICAgICAgLCcgICAgbWFyZ2luLXRvcDotMXB4IWltcG9ydGFudCcKICAgICAgICAgICAgLCd9JwogICAgICAgICAgICAsJy5mZWVkLWl0ZW0gLmF2YXRhciB7IGRpc3BsYXk6bm9uZSFpbXBvcnRhbnQgfScKICAgICAgICAgICAgLCcnCiAgICAgICAgICAgICwnLmZlZWQtbWFpbiwuZmVlZC1pdGVtLmNvbWJpbmUgeyBtYXJnaW4tbGVmdDowIWltcG9ydGFudCB9JwogICAgICAgICAgICAsJy5mZWVkLWl0ZW0tcSB7IG1hcmdpbi1sZWZ0Oi0zMHB4IWltcG9ydGFudDtwYWRkaW5nLWxlZnQ6MCFpbXBvcnRhbnQgfScKICAgICAgICAgICAgLCcnCiAgICAgICAgICAgICx3aW5kb3cuaVpoaWh1LkNvbW1lbnQuUmlnaHRDb21tZW50ID8gJycgOiAnLmZlZWQtaXRlbS1hIC56bS1jb21tZW50LWJveCB7IG1heC13aWR0aDo2MDJweCFpbXBvcnRhbnQgfScKICAgICAgICAgICAgLHdpbmRvdy5pWmhpaHUuQ29tbWVudC5SaWdodENvbW1lbnQgPyAnJyA6ICcuZmVlZC1pdGVtLXEgLnptLWNvbW1lbnQtYm94IHsgbWF4LXdpZHRoOjYzMnB4IWltcG9ydGFudDsgd2lkdGg6NjMycHghaW1wb3J0YW50IH0nCiAgICAgICAgICAgICwnJwogICAgICAgICAgICAsJy56bS10YWctZWRpdG9yLCcKICAgICAgICAgICAgLCcjemgtcXVlc3Rpb24tdGl0bGUsJwogICAgICAgICAgICAsJyN6aC1xdWVzdGlvbi1kZXRhaWwsJwogICAgICAgICAgICAsJyN6aC1xdWVzdGlvbi1tZXRhLXdyYXAsJwogICAgICAgICAgICAsJy56aC1hbnN3ZXJzLXRpdGxlLCcKICAgICAgICAgICAgLCcjemgtcXVlc3Rpb24tZmlsdGVyLXdyYXAgeycKICAgICAgICAgICAgLCcgICAgbWFyZ2luLWxlZnQ6LTMycHghaW1wb3J0YW50JwogICAgICAgICAgICAsJ30nCiAgICAgICAgICAgICwnJwogICAgICAgICAgICAsJyN6aC1xdWVzdGlvbi1sb2ctcGFnZS13cmFwIC56bS10YWctZWRpdG9yLCcKICAgICAgICAgICAgLCcjemgtcXVlc3Rpb24tbG9nLXBhZ2Utd3JhcCAjemgtcXVlc3Rpb24tdGl0bGUgeycKICAgICAgICAgICAgLCcgICAgbWFyZ2luLWxlZnQ6MCAhaW1wb3J0YW50JwogICAgICAgICAgICAsJ30nCiAgICAgICAgICAgICwnJwogICAgICAgICAgICAsJy56aC1hbnN3ZXJzLXRpdGxlLCcKICAgICAgICAgICAgLCcjemgtcXVlc3Rpb24tZmlsdGVyLXdyYXAgeycKICAgICAgICAgICAgLCcgICAgYm9yZGVyLWJvdHRvbToxcHggc29saWQgI0VFRSFpbXBvcnRhbnQ7JwogICAgICAgICAgICAsJyAgICB6LWluZGV4OjEwMDAhaW1wb3J0YW50JwogICAgICAgICAgICAsJ30nCiAgICAgICAgICAgICwnJwogICAgICAgICAgICAsJyN6aC1xdWVzdGlvbi1tZXRhLXdyYXAgeycKICAgICAgICAgICAgLCcgICAgbWFyZ2luLWJvdHRvbTowIWltcG9ydGFudDsnCiAgICAgICAgICAgICwnICAgIHBhZGRpbmctYm90dG9tOjEwcHghaW1wb3J0YW50OycKICAgICAgICAgICAgLCcgICAgYm9yZGVyLWJvdHRvbToxcHggc29saWQgI0VFRSFpbXBvcnRhbnQnCiAgICAgICAgICAgICwnfScKICAgICAgICAgICAgLCcnCiAgICAgICAgICAgICwnI3poLXF1ZXN0aW9uLWFuc3dlci13cmFwIHsgbWFyZ2luLXRvcDotMXB4IWltcG9ydGFudCB9JwogICAgICAgICAgICAsJycKICAgICAgICAgICAgLCcjemgtcXVlc3Rpb24tY29sbGFwc2VkLXdyYXAsI3poLXF1ZXN0aW9uLWFuc3dlci13cmFwIHsgYm9yZGVyOm5vbmUhaW1wb3J0YW50IH0nCiAgICAgICAgICAgICwnLnp1LXF1ZXN0aW9uLWNvbGxhcC10aXRsZSB7IGJvcmRlci10b3A6MXB4IHNvbGlkICNFRUUhaW1wb3J0YW50IH0nCiAgICAgICAgICAgICwnI3poLXF1ZXN0aW9uLWNvbGxhcHNlZC13cmFwPmRpdjpsYXN0LWNoaWxkLC56bS1pdGVtLWFuc3dlcjpsYXN0LWNoaWxkIHsgYm9yZGVyLWJvdHRvbToxcHggc29saWQgI0VFRSFpbXBvcnRhbnQgfScKICAgICAgICAgICAgLCcnCiAgICAgICAgICAgICwnLnp1LWF1dG9oaWRlLCcKICAgICAgICAgICAgLCcuem0tY29tbWVudC1vcC1saW5rLCcKICAgICAgICAgICAgLCcuem0tc2lkZS10cmVuZC1kZWwsJwogICAgICAgICAgICAsJy51bnBpbiB7JwogICAgICAgICAgICAsJyAgICB2aXNpYmlsaXR5OnZpc2libGUhaW1wb3J0YW50OycKICAgICAgICAgICAgLCcgICAgb3BhY2l0eTowOycKICAgICAgICAgICAgLCd9JwogICAgICAgICAgICAsJy5mZWVkLWl0ZW06aG92ZXIgLnp1LWF1dG9oaWRlLCcKICAgICAgICAgICAgLCcuem0taXRlbS1hbnN3ZXIgLnp1LWF1dG9oaWRlLCcKICAgICAgICAgICAgLCcuem0taXRlbS1jb21tZW50OmhvdmVyIC56bS1jb21tZW50LW9wLWxpbmssJwogICAgICAgICAgICAsJy56bS1zaWRlLXRyZW5kLXJvdzpob3ZlciAuem0tc2lkZS10cmVuZC1kZWwsJwogICAgICAgICAgICAsJy56bS1zaWRlLW5hdi1saTpob3ZlciAudW5waW4geycKICAgICAgICAgICAgLCcgICAgb3BhY2l0eToxOycKICAgICAgICAgICAgLCd9JwogICAgICAgICAgICAsJy56bS1pdGVtLXZvdGUtY291bnQ6aG92ZXIsLnptLXZvdGViYXIgYnV0dG9uOmhvdmVyeycKICAgICAgICAgICAgLCcgICAgYmFja2dyb3VuZDojYTZjZTU2IWltcG9ydGFudDsnCiAgICAgICAgICAgICwnICAgIGNvbG9yOiMzRTVFMDAgIWltcG9ydGFudCcKICAgICAgICAgICAgLCd9JwogICAgICAgICAgICAsJycKICAgICAgICAgICAgLCdhLGE6aG92ZXIsJwogICAgICAgICAgICAsJ2ksJwogICAgICAgICAgICAsJy56dS1hdXRvaGlkZSwnCiAgICAgICAgICAgICwnLnptLXZvdGViYXIgYnV0dG9uLCcKICAgICAgICAgICAgLCcuem0taXRlbS1jb21tZW50OmhvdmVyIC56bS1jb21tZW50LW9wLWxpbmssJwogICAgICAgICAgICAsJy56bS1jb21tZW50LW9wLWxpbmssJwogICAgICAgICAgICAsJy56bS1zaWRlLXRyZW5kLXJvdzpob3ZlciAuem0tc2lkZS10cmVuZC1kZWwsJwogICAgICAgICAgICAsJy56bS1zaWRlLXRyZW5kLWRlbCwnCiAgICAgICAgICAgICwnLnptLXNpZGUtbmF2LWxpLCcKICAgICAgICAgICAgLCcuenUtbWFpbi1mZWVkLWZyZXNoLWJ1dHRvbiwnCiAgICAgICAgICAgICwnLnpnLWljb24sJwogICAgICAgICAgICAsJy56bS1zaWRlLW5hdi1saTpob3ZlciAuemctaWNvbiwnCiAgICAgICAgICAgICwnLnptLXNpZGUtbmF2LWxpOmhvdmVyIGksJwogICAgICAgICAgICAsJy51bnBpbiwnCiAgICAgICAgICAgICwnLnptLXNpZGUtbmF2LWxpOmhvdmVyIC51bnBpbiB7JwogICAgICAgICAgICAsJyAgICAtbW96LXRyYW5zaXRpb246Y29sb3IgLjJzIGxpbmVhcixvcGFjaXR5IC4xNXMgbGluZWFyLGJhY2tncm91bmQtY29sb3IgLjJzIGxpbmVhcixiYWNrZ3JvdW5kLXBvc2l0aW9uIC4ycyBsaW5lYXIgLjFzOycKICAgICAgICAgICAgLCcgICAgLXdlYmtpdC10cmFuc2l0aW9uOmNvbG9yIC4ycyBsaW5lYXIsb3BhY2l0eSAuMTVzIGxpbmVhcixiYWNrZ3JvdW5kLWNvbG9yIC4ycyBsaW5lYXIsYmFja2dyb3VuZC1wb3NpdGlvbiAuMnMgbGluZWFyIC4xczsnCiAgICAgICAgICAgICwnICAgIHRyYW5zaXRpb246Y29sb3IgLjJzIGxpbmVhcixvcGFjaXR5IC4xNXMgbGluZWFyLGJhY2tncm91bmQtY29sb3IgLjJzIGxpbmVhcixiYWNrZ3JvdW5kLXBvc2l0aW9uIC4ycyBsaW5lYXIgLjFzOycKICAgICAgICAgICAgLCd9JwogICAgICAgICAgICAsJycKICAgICAgICAgICAgLCdoM3sgbGluZS1oZWlnaHQ6MjVweCB9JwogICAgICAgICAgICAsJy56dS1mb290ZXItaW5uZXIge3BhZGRpbmc6MTVweCAwIWltcG9ydGFudH0nCiAgICAgICAgICAgICwnLnptLXNpZGUtcGlubmVkLXRvcGljcyAuem0tc2lkZS1uYXYtbGl7ZmxvYXQ6bGVmdDtwYWRkaW5nLXJpZ2h0OjMwcHghaW1wb3J0YW50fScKICAgICAgICAgICAgLCcuem0tc2lkZS1saXN0LWNvbnRlbnR7Y2xlYXI6Ym90aH0nCiAgICAgICAgICAgICwnLnVucGlueyBkaXNwbGF5OmlubGluZS1ibG9jayFpbXBvcnRhbnQgfScKICAgICAgICAgICAsJyddLmpvaW4oJ1xuJyk7Cn0KCnZhciBjc3NfY29tbWVudD0nJzsKaWYocGFnZUlzLkhvbWV8fHBhZ2VJcy5RdWVzdGlvbnx8cGFnZUlzLkFuc3dlcil7CiAgICBjc3NfY29tbWVudCA9IHdpbmRvdy5pWmhpaHUuQ29tbWVudC5jc3M7Cn0KCmNzcyArPSB3aW5kb3cuaVpoaWh1LkFuc3dlci5jc3M7CgppZih3aW5kb3cuaVpoaWh1LlF1aWNrRmF2byl7CiAgICBjc3MgKz0gd2luZG93LmlaaGlodS5RdWlja0Zhdm8uY3NzOwp9CmlmKHdpbmRvdy5pWmhpaHUuUXVpY2tCbG9jayl7CiAgICBjc3MgKz0gd2luZG93LmlaaGlodS5RdWlja0Jsb2NrLmNzczsKfQppZih3aW5kb3cuaVpoaWh1Lk5vdGk3KXsKICAgIGNzcyArPSB3aW5kb3cuaVpoaWh1Lk5vdGk3LmNzczsKICAgIHdpbmRvdy5pWmhpaHUuTm90aTcuZW5oYW5jZSgpOwp9CnZhciBoZWFkcyA9IF9kb2MuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImhlYWQiKTsKaWYgKGhlYWRzLmxlbmd0aCA+IDApIHsKICAgIHZhciBub2RlID0gX2RvYy5jcmVhdGVFbGVtZW50KCJzdHlsZSIpOwogICAgbm9kZS50eXBlID0gInRleHQvY3NzIjsKICAgIG5vZGUuaWQgPSAiaXpoQ1NTX21haW4iOwogICAgbm9kZS5hcHBlbmRDaGlsZChfZG9jLmNyZWF0ZVRleHROb2RlKGNzcykpOwogICAgaGVhZHNbMF0uYXBwZW5kQ2hpbGQobm9kZSk7IAogICAgaWYoY3NzX2NvbW1lbnQhPScnKXsKICAgICAgICBub2RlID0gX2RvYy5jcmVhdGVFbGVtZW50KCJzdHlsZSIpCiAgICAgICAgbm9kZS50eXBlID0gInRleHQvY3NzIjsKICAgICAgICBub2RlLmlkID0gIml6aENTU19jb21tZW50IjsKICAgICAgICBub2RlLmFwcGVuZENoaWxkKF9kb2MuY3JlYXRlVGV4dE5vZGUoY3NzX2NvbW1lbnQpKTsKICAgICAgICBoZWFkc1swXS5hcHBlbmRDaGlsZChub2RlKTsKICAgIH0KfQoKaWYoISQoJy5tb2RhbC1kaWFsb2ctYmcnKS5sZW5ndGgpewogICAgJGJvZHkuYXBwZW5kKAogICAgICAgICQoJzxkaXYnLCB7IGlkOiAnaXpoLWRsZy1iZycsICdjbGFzcyc6ICdtb2RhbC1kaWFsb2ctYmcnIH0pLmNzcyh7CiAgICAgICAgICAgICd6LWluZGV4JzogOTUKICAgICAgICAgICwgJ29wYWNpdHknOiAwLjUKICAgICAgICAgICwgJ3Bvc2l0aW9uJzogJ2ZpeGVkJwogICAgICAgICAgLCAndG9wJzogMAogICAgICAgICAgLCAnYm90dG9tJzogMAogICAgICAgICAgLCAnbGVmdCc6IDAKICAgICAgICAgICwgJ3JpZ2h0JzogMAogICAgICAgICAgLCAnZGlzcGxheSc6ICdub25lJwogICAgICAgIH0pCiAgICApOwp9Cgp3aW5kb3cuaVpoaWh1LmdldEl0ZW09ZnVuY3Rpb24oJGMpewogICAgdmFyICRpdGVtPSQobnVsbCk7CiAgICBpZigkYyAmJiAkYy5sZW5ndGgpeyAKICAgICAgICB2YXIgJGl0ZW1NZXRhPSRjLmNsb3Nlc3QoJy56bS1pdGVtLW1ldGEnKTsKICAgICAgICBpZiAoJGl0ZW1NZXRhLmlzKCcuZmVlZC1tZXRhJykgfHwgJGl0ZW1NZXRhLnBhcmVudCgpLmlzKCcuZmVlZC1tZXRhJykpewogICAgICAgICAgICAkaXRlbT0kYy5jbG9zZXN0KCcuZmVlZC1pdGVtJyk7CiAgICAgICAgICAgICRpdGVtLmF0dHIoJ2RhdGEtYWlkJywgJGl0ZW0uY2hpbGRyZW4oJ21ldGFbaXRlbXByb3A9YW5zd2VyLWlkXScpLmF0dHIoJ2NvbnRlbnQnKSkKICAgICAgICB9ZWxzZSBpZigkaXRlbU1ldGEuaXMoJy5hbnN3ZXItYWN0aW9ucycpKXsKICAgICAgICAgICAgJGl0ZW09JGMuY2xvc2VzdCgnLnptLWl0ZW0tYW5zd2VyLC5mZWVkLWl0ZW0nKTsKICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgJGl0ZW09JGl0ZW1NZXRhLnByZXYoKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gJGl0ZW07Cn07Cgp1dGlscy5vYnNlcnZlRE9NTm9kZUFkZGVkKGRvY3VtZW50LmJvZHksZnVuY3Rpb24oZXZlbnQpewoJaWYoaXpoVG9wTmF2QXV0b0ZvbGQpewoJCXdpbmRvdy5pWmhpaHUuVG9wTmF2Lm9uTm9kZUFkZGVkKGV2ZW50KQoJfQp9KQovKioKICogQGNsYXNzIEFuc3dlcgogKi8KZnVuY3Rpb24gQW5zd2VyKGlaaGlodSkgewogICAgaWYgKCB0eXBlb2YgaVpoaWh1ID09PSAndW5kZWZpbmVkJyB8fCAhaVpoaWh1KSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBpWmhpaHUuQW5zd2VyID0gdGhpczsKCiAgICB0aGlzLl9lPW51bGw7CiAgICB0aGlzLnBwV2lkdGg9MDsKICAgIHRoaXMucHBIZWlnaHQ9NDAwOwoKICAgIHRoaXMuY3NzID0gCiAgICAgICAgWycuem0tdm90ZWJhciAuaXpoLWJ1dHRvbi5mb2xke21hcmdpbjo1cHggMHB4IDBweDtkaXNwbGF5OmJsb2NrO2NvbG9yOiM2OThFQkY7aGVpZ2h0OjI0cHg7bGluZS1oZWlnaHQ6MjRweDt3aWR0aDozOHB4O2JvcmRlci1yYWRpdXM6M3B4O2JvcmRlcjowcHggbm9uZTtjdXJzb3I6cG9pbnRlcjtiYWNrZ3JvdW5kOm5vbmUgcmVwZWF0IHNjcm9sbCAwJSAwJSAjRUZGNkZBO2ZvbnQtd2VpZ2h0OmZvbnQtd2VpZ2h0O3Bvc2l0aW9uOnJlbGF0aXZlO30nCiAgICAgICAgLCcnXS5qb2luKCdcbicpOwoKICAJdGhpcy5wcm9jZXNzQW5zd2VyPWZ1bmN0aW9uKCRhLCRwcCxiQXV0aG9yUmVhcixiQXV0aG9yTGlzdCl7CiAgICAgICAgaWYoISRhfHwhJGEubGVuZ3RoKXJldHVybjsKICAgICAgICBpZigkYS5hdHRyKCdpemhfcHJvY2Vzc2VkJyk9PScxJylyZXR1cm47CiAgICAgICAgdmFyIHNlbENvbGxhcHNlPScubWV0YS1pdGVtW25hbWU9Y29sbGFwc2VdJwogICAgICAgICAgLCAkbWV0YT0kYS5maW5kKCcuem0taXRlbS1tZXRhJykKICAgICAgICAgICwgJGF1dGhvcj0kYS5maW5kKCcuem0taXRlbS1hbnN3ZXItYXV0aG9yLWluZm8nKQogICAgICAgICAgLCAkZmF2bz0kYS5maW5kKCcubWV0YS1pdGVtW25hbWU9ZmF2b10nKQogICAgICAgICAgLCAkdm90ZT0kYS5maW5kKCcuem0tdm90ZWJhcicpCiAgICAgICAgOwogICAgICAgIGlmKGlaaGlodS5RdWlja0Jsb2NrKXsKICAgICAgICAgICAgLy8gUmVnaW9uOiDlv6vpgJ/lsY/olL0KICAgICAgICAgICAgaVpoaWh1LlF1aWNrQmxvY2suYWRkUXVpY2tCbG9jaygkYSkKCiAgICAgICAgICAgIC8vIFJlZ2lvbiBlbmQKICAgICAgICB9CiAgICAgICAgaWYoJGF1dGhvci5sZW5ndGgpey8vcmVsb2NhdGVQZXJzb25JbmZvCiAgICAgICAgICAgIGlmKGJBdXRob3JSZWFyKXsKICAgICAgICAgICAgICAgICRhdXRob3IuY3NzKHsKICAgICAgICAgICAgICAgICAgICAndGV4dEFsaWduJzoncmlnaHQnCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGlmKCRhLmlzKCcuZmVlZC1pdGVtJykpewogICAgICAgICAgICAgICAgICAgICRhLmZpbmQoJy5lbnRyeS1ib2R5IC56bS1pdGVtLWFuc3dlci1kZXRhaWwgLnptLWl0ZW0tcmljaC10ZXh0JykKICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkYXV0aG9yLmhpZGUoKSkuYmluZCgnRE9NTm9kZUluc2VydGVkJyxmdW5jdGlvbihldmVudCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGM9JChldmVudC50YXJnZXQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJGMuaXMoJy56bS1lZGl0YWJsZS1jb250ZW50JykpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuY2hpbGRyZW4oJy56bS1pdGVtLWFuc3dlci1hdXRob3ItaW5mbycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5pbnNlcnRCZWZvcmUoJGMuY2hpbGRyZW4oJy5hbnN3ZXItZGF0ZS1saW5rLXdyYXAnKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncG9zaXRpb24nOidhYnNvbHV0ZScKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsICdyaWdodCc6MAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgJGF1dGhvci5pbnNlcnRCZWZvcmUoJG1ldGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgICRhdXRob3I9JGF1dGhvci5jaGlsZHJlbigpLmVxKDEpOwogICAgICAgICAgICBpZiAoJHBwICYmIGJBdXRob3JMaXN0KXsKICAgICAgICAgICAgICAgIC8vIFJlZ2lvbjog5Zue562U55uu5b2V6aG5CiAgICAgICAgICAgICAgICB2YXIgY29sbGFwc2VkPSRhLmF0dHIoJ2RhdGEtY29sbGFwc2VkJyk9PScxJwogICAgICAgICAgICAgICAgICAsICRwcGxhPSQoJzxhPicsewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaHJlZjonI2Fuc3dlci0nKyRhLmF0dHIoJ2RhdGEtYWlkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAsIHRhcmdldDonX3NlbGYnCiAgICAgICAgICAgICAgICAgICAgICAgICAgLCBzdHlsZTpjc3NfQXV0aG9yTGlzdEl0ZW1BCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICwgJHBwbD0kKCc8bGk+JykuYXBwZW5kKCRwcGxhKQogICAgICAgICAgICAgICAgICAsICR1bm89aVpoaWh1LiR1bm9BbnN3ZXJzCiAgICAgICAgICAgICAgICBpZihjb2xsYXBzZWQpewogICAgICAgICAgICAgICAgICAgICRwcGwuYXBwZW5kVG8oJHBwKQogICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgJHBwbC5pbnNlcnRCZWZvcmUoJHVuby4kZW5kT2ZMYXN0QSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmKCRhLmF0dHIoJ2RhdGEtaXNvd25lcicpPT0nMScpewogICAgICAgICAgICAgICAgICAgIGlaaGlodS5BbnN3ZXIuX2U9JGEuZ2V0KDApOwogICAgICAgICAgICAgICAgICAgICRwcGxhLmFwcGVuZCgkKCc8c3Bhbj4nLCB7ICdjbGFzcyc6ICdtZScgfSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIG5hbWVDU1M9J25hbWUnOwogICAgICAgICAgICAgICAgaWYoJGEuYXR0cignZGF0YS1pc2ZyaWVuZCcpPT0nMScpewogICAgICAgICAgICAgICAgICAgIG5hbWVDU1MrPScgZnJpZW5kJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmKGNvbGxhcHNlZCl7CiAgICAgICAgICAgICAgICAgICAgbmFtZUNTUys9JyBjb2xsYXBzZWQnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZighJGF1dGhvci5sZW5ndGgpewogICAgICAgICAgICAgICAgICAgIG5hbWVDU1MrPScgbm9uYW1lJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICQoJzxzcGFuPicsewogICAgICAgICAgICAgICAgICAgICdjbGFzcyc6bmFtZUNTUwogICAgICAgICAgICAgICAgICAsIHN0eWxlOmNzc19BdXRob3JMaXN0SXRlbUFfbmFtZQogICAgICAgICAgICAgICAgfSkudGV4dCghJGF1dGhvci5sZW5ndGg/J+WMv+WQjeeUqOaItyc6JGF1dGhvci50ZXh0KCkpLmFwcGVuZFRvKCRwcGxhKTsKICAgICAgICAgICAgICAgIGlmICgkcHBsLndpZHRoKCk+aVpoaWh1LkFuc3dlci5wcFdpZHRoKQogICAgICAgICAgICAgICAgICAgIGlaaGlodS5BbnN3ZXIucHBXaWR0aD0kcHBsLndpZHRoKCk7CiAgICAgICAgICAgICAgICAvLyBSZWdpb24gZW5kCiAgICAgICAgICAgICAgICAvLyBSZWdpb246IOWbnuetlOevh+W5heaMh+ekugogICAgICAgICAgICAgICAgdmFyIG5IUD1NYXRoLmNlaWwoJCgnLnptLWVkaXRhYmxlLWNvbnRlbnQnLCRhKS50ZXh0KCkubGVuZ3RoLzEwMCk7CiAgICAgICAgICAgICAgICAkKCc8c3Bhbj4nLHsKICAgICAgICAgICAgICAgICAgICAnY2xhc3MnOidocCcKICAgICAgICAgICAgICAgIH0pLmNzcyh7J3dpZHRoJzpuSFAqMTAsJ21hcmdpbi1sZWZ0JzotbkhQKjEwfSkuYXBwZW5kVG8oJHBwbGEpOwogICAgICAgICAgICAgICAgLy8gUmVnaW9uIGVuZAogICAgICAgICAgICAgICAgJHBwbGEubW91c2VvdmVyKGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgdmFyICRmcm09JCh0aGlzLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlKQogICAgICAgICAgICAgICAgICAgICAgLCAkdW5vPWlaaGlodS4kdW5vQW5zd2VycwogICAgICAgICAgICAgICAgICAgICQodGhpcykuYWRkQ2xhc3MoJ3NlbCcpOwogICAgICAgICAgICAgICAgICAgIGlmKGlaaGlodS5BbnN3ZXIuX2UpewogICAgICAgICAgICAgICAgICAgICAgICAkdW5vLmNoaWxkcmVuKCcubWVUJykuY3NzKCdkaXNwbGF5JywwPmlaaGlodS5BbnN3ZXIuX2Uub2Zmc2V0VG9wLSRmcm0uc2Nyb2xsVG9wKCk/Jyc6J25vbmUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgJHVuby5jaGlsZHJlbignLm1lQicpLmNzcygnZGlzcGxheScsJGZybS5oZWlnaHQoKTxpWmhpaHUuQW5zd2VyLl9lLm9mZnNldFRvcC0kZnJtLnNjcm9sbFRvcCgpK2laaGlodS5BbnN3ZXIuX2Uub2Zmc2V0SGVpZ2h0PycnOidub25lJyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vIFJlZ2lvbjog5Zue562U6aKE6KeICiAgICAgICAgICAgICAgICAgICAgdmFyIG5hbT0kKCdzcGFuLm5hbWUnLHRoaXMpOwogICAgICAgICAgICAgICAgICAgIGlmKCFuYW0ubGVuZ3RoKXJldHVybjsKICAgICAgICAgICAgICAgICAgICB2YXIgYWlkPSQodGhpcykuYXR0cignaHJlZicpLnJlcGxhY2UoJyNhbnN3ZXItJywnJykKICAgICAgICAgICAgICAgICAgICAgICwgcHJ2PSR1bm8ubmV4dCgnLml6aC1hbnN3ZXItcHJldmlldycpCiAgICAgICAgICAgICAgICAgICAgICAsIHRvcD0kKHRoaXMpLnBvc2l0aW9uKCkudG9wKyR1bm8ucG9zaXRpb24oKS50b3AKICAgICAgICAgICAgICAgICAgICAgICwgc2VsPScuem0taXRlbS1hbnN3ZXJbZGF0YS1haWQ9JythaWQrJ10gPiAuem0taXRlbS1yaWNoLXRleHQnCiAgICAgICAgICAgICAgICAgICAgICAsIGN0eD1uYW0uaXMoJy5jb2xsYXBzZWQnKT8nI3poLXF1ZXN0aW9uLWNvbGxhcHNlZC13cmFwJzonI3poLXF1ZXN0aW9uLWFuc3dlci13cmFwJwogICAgICAgICAgICAgICAgICAgICAgLCBkaXY9JChzZWwsY3R4KQogICAgICAgICAgICAgICAgICAgICAgLCBjbXQ9JCgnLnptLWl0ZW0tbWV0YSA+IC56dS1xdWVzdGlvbi1hbnN3ZXItbWV0YS1jb21tZW50JyxkaXYucGFyZW50KCkpCiAgICAgICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgICAgIGlmKCFwcnYubGVuZ3RoKXsKICAgICAgICAgICAgICAgICAgICAgICAgcHJ2PSQoJzxkaXY+Jyx7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NsYXNzJzpkaXYuY2xhc3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoJ2l6aC1hbnN3ZXItcHJldmlldycpLndpZHRoKGRpdi53aWR0aCgpKzIyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLm1vdXNlb3ZlcihmdW5jdGlvbigpeyR1bm8ubW91c2VvdmVyKCk7JCgnbGkgYVtocmVmPSMnKyQodGhpcykuYXR0cignZGF0YS1haWQnKSsnXScsJHVubykuYWRkQ2xhc3MoJ3NlbCcpOyQodGhpcykuc2hvdygpO30pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAubW91c2VvdXQoZnVuY3Rpb24oKXskdW5vLm1vdXNlb3V0KCk7JCgnbGkgYVtocmVmPSMnKyQodGhpcykuYXR0cignZGF0YS1haWQnKSsnXScsJHVubykucmVtb3ZlQ2xhc3MoJ3NlbCcpOyQodGhpcykuaGlkZSgpO30pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2xpY2soZnVuY3Rpb24oKXskKCdsaSBhW2hyZWY9IycrJCh0aGlzKS5hdHRyKCdkYXRhLWFpZCcpKyddJywkdW5vKVswXS5jbGljaygpO30pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuaW5zZXJ0QWZ0ZXIoJHVubykKICAgICAgICAgICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZihwcnYuYXR0cignZGF0YS1haWQnKSE9YWlkKXsKICAgICAgICAgICAgICAgICAgICAgICAgcHJ2LmF0dHIoJ2RhdGEtYWlkJyxhaWQpLmVtcHR5KCkuYXBwZW5kKGRpdi5jbG9uZSgpLmNoaWxkcmVuKCkpLmZpbmQoJ2EnKS5hdHRyKCdvbmNsaWNrJywncmV0dXJuIGZhbHNlOycpOwogICAgICAgICAgICAgICAgICAgICAgICBpZigkKCdzcGFuLm1lJyx0aGlzKS5sZW5ndGgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcnYuZmluZCgnYS56dS1lZGl0LWJ1dHRvbicpLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBpZighbmFtLmhhc0NsYXNzKCdub25hbWUnKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJ2ltZy56bS1saXN0LWF2YXRhcicsZGl2LnBhcmVudCgpKS5jbG9uZSgpLmFwcGVuZFRvKHBydik7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0PWNtdC50ZXh0KCksaT10LmluZGV4T2YoJ+adoeivhOiuuicpOwogICAgICAgICAgICAgICAgICAgICAgICBpZihjbXQubGVuZ3RoJiZpPjApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCc8c3Bhbj4nLHsnY2xhc3MnOidjb21tZW50J30pLnRleHQodC5zdWJzdHJpbmcoMCxpKSkucHJlcGVuZChjbXQuY2hpbGRyZW4oJ2knKS5jbG9uZSgpKS5hcHBlbmRUbyhwcnYpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB2YXIgdGg9ZGl2LmhlaWdodCgpKzMzCiAgICAgICAgICAgICAgICAgICAgICAsIG1heFRvcD0kdW5vLnBvc2l0aW9uKCkudG9wKzEyCiAgICAgICAgICAgICAgICAgICAgICAsIGNvbnRlbnRQb3NpdGlvbj0nJzsKICAgICAgICAgICAgICAgICAgICBpZihtYXhUb3ArdGg8JHdpbi5oZWlnaHQoKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRvcCt0aDwkd2luLmhlaWdodCgpKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBydi5jc3Moeyd0b3AnOnRvcD5tYXhUb3A/dG9wOm1heFRvcCwnYm90dG9tJzonJ30pOwogICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBydi5jc3Moeyd0b3AnOicnLCdib3R0b20nOjB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICBwcnYuY3NzKHsndG9wJzptYXhUb3AsJ2JvdHRvbSc6MH0pOwogICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50UG9zaXRpb249J2Fic29sdXRlJzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcHJ2LmNzcyh7J2xlZnQnOiR1bm8ud2lkdGgoKX0pLnNob3coKS5jaGlsZHJlbigpLmZpcnN0KCkuY3NzKCdwb3NpdGlvbicsY29udGVudFBvc2l0aW9uKTsKICAgICAgICAgICAgICAgICAgICAvLyBSZWdpb24gZW5kCiAgICAgICAgICAgICAgICB9KS5tb3VzZW91dChmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlQ2xhc3MoJ3NlbCcpOwogICAgICAgICAgICAgICAgICAgIHZhciAkdW5vPSQodGhpcy5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlKTsKICAgICAgICAgICAgICAgICAgICAkdW5vLm5leHQoKS5oaWRlKCk7CiAgICAgICAgICAgICAgICB9KS5jbGljayhmdW5jdGlvbigpeyQodGhpcykubW91c2VvdXQoKTsKICAgICAgICAgICAgICAgIGlaaGlodS4kdW5vQW5zd2Vycy5jc3MoJ2xlZnQnLDktaVpoaWh1LiR1bm9BbnN3ZXJzLndpZHRoKCkpO30pOwogICAgICAgICAgICAgICAgaWYoaVpoaWh1LkFuc3dlci5fZT09JGEuZ2V0KDApKXsKICAgICAgICAgICAgICAgICAgICBpWmhpaHUuQW5zd2VyLl9lPSRwcGxhLmdldCgwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYoaVpoaWh1LlF1aWNrRmF2bykKICAgICAgICAgICAgaVpoaWh1LlF1aWNrRmF2by5hZGRRdWlja0Zhdm8oJGZhdm8sJGEpOwoKICAgICAgICAkbWV0YS5iaW5kKCdET01Ob2RlSW5zZXJ0ZWQnLGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICAgICAgaVpoaWh1LkNvbW1lbnQucHJvY2Vzc0NvbW1lbnQoJChldmVudC50YXJnZXQpKTsKICAgICAgICB9KTsKICAgICAgICAKICAgICAgICBpWmhpaHUuQ29tbWVudC5wcm9jZXNzQ29tbWVudEJ1dHRvbigkYSk7CgogICAgICAgIHZhciAkY209JCgnLnptLWNvbW1lbnQtYm94JywkYSk7CiAgICAgICAgaWYoJGNtLmxlbmd0aCAmJiAkY20uaXMoJzp2aXNpYmxlJykpewogICAgICAgIAl2YXIgZm9jdXNOYW1lID0gaVpoaWh1LkNvbW1lbnQuc2Nyb2xsRm9jdXNDb21tZW50T25QYWdlTG9hZCgkY20pOwogICAgCiAgICAgICAgICAgIGlaaGlodS5Db21tZW50Lm1ldGFTY3JvbGxUb1ZpZXdCb3R0b20oJGNtLmNsb3Nlc3QoJy56bS1pdGVtLW1ldGEnKSxmdW5jdGlvbigpewogICAgICAgICAgICAgICAgaVpoaWh1LkNvbW1lbnQucHJvY2Vzc0NvbW1lbnQoJGNtLCBmb2N1c05hbWUpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgJGEuYXR0cignaXpoX3Byb2Nlc3NlZCcsJzEnKTsKICAgIH07CgogICAgcmV0dXJuIHRoaXM7Cn0KCi8qKgogKiBAY2xhc3MgQ29tbWVudAogKi8KZnVuY3Rpb24gQ29tbWVudChpWmhpaHUpIHsKICAgIGlmICggdHlwZW9mIGlaaGlodSA9PT0gJ3VuZGVmaW5lZCcgfHwgIWlaaGlodSkgewogICAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgaVpoaWh1LkNvbW1lbnQgPSB0aGlzOwoKICAgIHZhciBjc3NfY29tbWVudD17CiAgICAgICAgICAgICdiYWNrZ3JvdW5kLWNvbG9yJzonI2ZmZicKICAgICAgICAgICwgJ291dGxpbmUnOidub25lJwogICAgICAgICAgLCAnei1pbmRleCc6Jzk5OTknCiAgICAgICAgICAsICdib3JkZXItcmFkaXVzJzonMCA2cHggMCAwJwogICAgICAgICAgLCAncG9zaXRpb24nOidhYnNvbHV0ZScKICAgICAgICAgICwgJ3Zpc2liaWxpdHknOidoaWRkZW4nCiAgICAgICAgICAsICd0b3AnOi03MAogICAgICAgIH0KICAgIDsKICAgIHRoaXMuUmlnaHRDb21tZW50ID0gaVpoaWh1LmNvbmZpZ1snU2hvd0NvbW1lbnQnXTsKICAgIHRoaXMuQXV0b1Njcm9sbFBhZ2VXaGVuQ2xvc2luZyA9IGlaaGlodS5jb25maWdbJ1JpZ2h0Q29tbWVudF9BdXRvU2Nyb2xsUGFnZVdoZW5DbG9zaW5nJ107CiAgICBpZiAoIXRoaXMuUmlnaHRDb21tZW50KXsKICAgICAgICB0aGlzLmNzcyA9IAogICAgICAgICAgICBbJy56bS1jb21tZW50LWJveC5lbXB0eSAuaXpoLWJ1dHRvbi1jY3tkaXNwbGF5Om5vbmU7fScKICAgICAgICAgICAgLCcnXS5qb2luKCdcbicpOwogICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmNzcyA9IAogICAgICAgICAgICBbJy5tZW50aW9uLXBvcHVwe3otaW5kZXg6MTAwMDAgIWltcG9ydGFudDt9JwogICAgICAgICAgICAsJy56bS1pdGVtLW1ldGEgLm1ldGEtaXRlbS50b2dnbGUtY29tbWVudHtkaXNwbGF5OmJsb2NrO2Zsb2F0OnJpZ2h0O21hcmdpbi1sZWZ0OjdweCAhaW1wb3J0YW50O30nCiAgICAgICAgICAgICwnLnptLWNvbW1lbnQtYm94e3Bvc2l0aW9uOmFic29sdXRlO21hcmdpbi10b3A6MDt9JwogICAgICAgICAgICAsJy56bS1jb21tZW50LWJveCAuaWNvbi1zcGlrZXtkaXNwbGF5Om5vbmUgIWltcG9ydGFudDt9JwogICAgICAgICAgICAsJy56bS1jb21tZW50LWJveCA+IC56bS1jb21tZW50LWJveC1mdHtwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MDtsZWZ0OjA7cmlnaHQ6MDt9JwogICAgICAgICAgICAsJy56bS1jb21tZW50LWJveC5lbXB0eXtwYWRkaW5nLXRvcDoxMHB4ICFpbXBvcnRhbnQ7fScKICAgICAgICAgICAgLCcuem0tY29tbWVudC1ib3ggPiAuem0tY29tbWVudC1mb3Jte21hcmdpbjoxNXB4ICFpbXBvcnRhbnQ7fScKICAgICAgICAgICAgLCcuem0tY29tbWVudC1ib3guZW1wdHkgPiAuem0tY29tbWVudC1mb3Jte2JvdHRvbToyNXB4O30nCiAgICAgICAgICAgICwnLnptLWNvbW1lbnQtYm94ID4gLnptLWNvbW1lbnQtZm9ybSAuem0tY29tbWVudC1lZGl0YWJsZXtwb3NpdGlvbjphYnNvbHV0ZTtib3R0b206NjBweDt0b3A6MDtsZWZ0OjA7cmlnaHQ6MDtvdmVyZmxvdzphdXRvO30nCiAgICAgICAgICAgICwnLnptLWNvbW1lbnQtYm94LmVtcHR5ID4gLnptLWNvbW1lbnQtZm9ybSAuem0tY29tbWVudC1lZGl0YWJsZXtib3R0b206MjVweDt9JwogICAgICAgICAgICAsJy56bS1jb21tZW50LWJveCA+IC56bS1jb21tZW50LWZvcm0gLnptLWNvbW1hbmR7cG9zaXRpb246YWJzb2x1dGU7bGVmdDowO3JpZ2h0OjA7Ym90dG9tOjQwcHg7fScKICAgICAgICAgICAgLCcuem0tY29tbWVudC1ib3guZW1wdHkgPiAuem0tY29tbWVudC1mb3JtIC56bS1jb21tYW5ke2JvdHRvbToxMHB4O30nCiAgICAgICAgICAgICwnLnptLWNvbW1lbnQtYm94IFtjbGFzc149aXpoLWJ1dHRvbnMtY21de3Bvc2l0aW9uOmFic29sdXRlO3RvcDo3MHB4O30nCiAgICAgICAgICAgICwnLnptLWNvbW1lbnQtYm94LmVtcHR5IFtjbGFzc149aXpoLWJ1dHRvbnMtY21de3RvcDphdXRvO2JvdHRvbTozMHB4O3otaW5kZXg6MTA7fScKICAgICAgICAgICAgLCcuem0tY29tbWVudC1ib3ggLml6aC1idXR0b25zLWNtLUx7bGVmdDowO30nCiAgICAgICAgICAgICwnLnptLWNvbW1lbnQtYm94IC5pemgtYnV0dG9ucy1jbS1MID4gYXttYXJnaW4tcmlnaHQ6N3B4O30nCiAgICAgICAgICAgICwnLnptLWNvbW1lbnQtYm94IC5pemgtYnV0dG9ucy1jbS1Se3JpZ2h0OjFlbTt9JwogICAgICAgICAgICAsJy56bS1jb21tZW50LWJveCAuaXpoLWJ1dHRvbnMtY20tUiA+IGF7bWFyZ2luLWxlZnQ6N3B4O30nCiAgICAgICAgICAgICwnLnptLWNvbW1lbnQtYm94IGEuaXpoLWJ1dHRvbi5vbntjb2xvcjojMjI1NTk5O3RleHQtc2hhZG93OjAgMCAxcHggIzIyNTU5OTt9JwogICAgICAgICAgICAsJy56bS1jb21tZW50LWJveCBhLml6aC1idXR0b24gLnpnLWljb257b3BhY2l0eTowLjU7fScKICAgICAgICAgICAgLCcuem0tY29tbWVudC1ib3ggYS5pemgtYnV0dG9uLm9uIC56Zy1pY29ue29wYWNpdHk6MTt9JwogICAgICAgICAgICAsJy56bS1jb21tZW50LWJveCBhLml6aC1idXR0b24ub2Zme2NvbG9yOiNlZWU7fScKICAgICAgICAgICAgLCcuem0tY29tbWVudC1ib3ggYS5pemgtYnV0dG9uLm9mZiAuemctaWNvbntvcGFjaXR5OjAuMjt9JwogICAgICAgICAgICAvLywnLnptLWNvbW1lbnQtYm94LmVtcHR5IFtjbGFzc149aXpoLWJ1dHRvbnMtY21de3RvcDphdXRvO2JvdHRvbTo3cHg7fScKICAgICAgICAgICAgLCcuem0tY29tbWVudC1ib3guZW1wdHkgLnptLWNvbW1lbnQtbGlzdHt2aXNpYmlsaXR5OmhpZGRlbjt9JwogICAgICAgICAgICAsJy56bS1jb21tZW50LWJveCAuem0tY29tbWVudC1saXN0IC56bS1pdGVtLWNvbW1lbnRbaXpoX2hpbGlnaHRde2JhY2tncm91bmQtY29sb3I6cmdiKDI1NSwyNTUsMTYwKTt9JwogICAgICAgICAgICAsJy56bS1jb21tZW50LWJveCAuaXpoLWJ1dHRvbi5vbiAuemctaWNvbi1jb21tZW50LWxpa2V7YmFja2dyb3VuZC1wb3NpdGlvbjotMjIycHggLTc5cHg7fScKICAgICAgICAgICAgLCcuem0tY29tbWVudC1ib3ggLml6aC1idXR0b24gLnotaWNvbi1mb2xke2hlaWdodDo2cHg7fScKICAgICAgICAgICAgLCcnXS5qb2luKCdcbicpOwogICAgICAgIHRoaXMub25XaW5Mb2FkPWZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHZhciBpWmhpaHU9d2luZG93LmlaaGlodTsKICAgICAgICAgICAgaVpoaWh1LiR3aW4uc2Nyb2xsKGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICAgICAgICAgIGlmKGlaaGlodS5Db21tZW50Lk9wZW5pbmcmJiFpWmhpaHUuQ29tbWVudC5QYWdlTm90U2Nyb2xsKXsKICAgICAgICAgICAgICAgICAgICB2YXIgYW5pbWF0ZT10cnVlOwogICAgICAgICAgICAgICAgICAgIGlaaGlodS5Db21tZW50LmJveCgkKGlaaGlodS5Db21tZW50Lk9wZW5pbmcpLHRydWUsYW5pbWF0ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIAogICAgICAgICAgICBpWmhpaHUuJHdpbi5yZXNpemUoZnVuY3Rpb24oZXZlbnQpewogICAgICAgICAgICAgICAgaWYoaVpoaWh1LkNvbW1lbnQuT3BlbmluZyl7CiAgICAgICAgICAgICAgICAgICAgdmFyICRjbT0kKGlaaGlodS5Db21tZW50Lk9wZW5pbmcpOwogICAgICAgICAgICAgICAgICAgIGlaaGlodS5Db21tZW50Lk9wZW5pbmcgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIGlaaGlodS5Db21tZW50LmNsb3NlKG51bGwsJGNtKTsKICAgICAgICAgICAgICAgICAgICBpWmhpaHUuQ29tbWVudC5vcGVuKG51bGwsJGNtKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGlmKGlaaGlodS5TY3JvbGxUb3ApewogICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3A9aVpoaWh1LlNjcm9sbFRvcDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0aGlzLm9uV2luTG9hZCgpCiAgICB9CiAgICB0aGlzLnByb2Nlc3NDb21tZW50QnV0dG9uID0gZnVuY3Rpb24oJGEpewogICAgICAgIGlmKGlaaGlodS5Db21tZW50LlJpZ2h0Q29tbWVudCl7CiAgICAgICAgICAgIHZhciAkYmM9JGEuZmluZCgnLm1ldGEtaXRlbS50b2dnbGUtY29tbWVudCcpOwogICAgICAgICAgICAkYmMucHJlcGVuZFRvKCRiYy5wYXJlbnQoKSk7CiAgICAgICAgfQogICAgfTsKICAgIHRoaXMuc2Nyb2xsRm9jdXNDb21tZW50T25QYWdlTG9hZCA9IGZ1bmN0aW9uKCRjbSl7CiAgICAgICAgaWYoIWlaaGlodS5Db21tZW50LlJpZ2h0Q29tbWVudClyZXR1cm47CiAgICAgICAgdmFyIGZvY3VzTmFtZT11cmwuZGF0YS5hdHRyLmZyYWdtZW50OwogICAgICAgIGlmKCFmb2N1c05hbWV8fGZvY3VzTmFtZT09JycpcmV0dXJuOwogICAgCWlmKHdpbmRvdy5pWmhpaHU0Q1JYKXsKICAgICAgICAgICAgdmFyICRpY20yQz0kY20uZmluZCgnLnptLWNvbW1lbnQtbGlzdCAuem0taXRlbS1jb21tZW50IGEuemctYW5jaG9yLWhpZGRlbltuYW1lPSInK2ZvY3VzTmFtZSsnIl0nKS5wYXJlbnQoKQogICAgICAgICAgICAgICwgb2Zmc2V0VG9wPSRpY20yQy5sZW5ndGg/JGljbTJDLm9mZnNldCgpLnRvcDowCiAgICAgICAgICAgIDtpZihvZmZzZXRUb3Ape2RvY3VtZW50LmJvZHkuc2Nyb2xsVG9wPW9mZnNldFRvcDt9CiAgICAJfQogICAgICAgIHJldHVybiBmb2N1c05hbWU7CiAgICB9OwogICAgCiAgICB0aGlzLm1ldGFTY3JvbGxUb1ZpZXdCb3R0b20gPSBmdW5jdGlvbigkaXRlbU1ldGEsZnVuY0FmdGVyU2Nyb2xsLGFsd2F5cyxhbmltYXRlKXsKICAgICAgICBpZighaVpoaWh1LkNvbW1lbnQuUmlnaHRDb21tZW50IHx8ICFpWmhpaHUuQ29tbWVudC5BdXRvU2Nyb2xsUGFnZVdoZW5DbG9zaW5nKXsKICAgICAgICAgICAgaWYoZnVuY0FmdGVyU2Nyb2xsKXtmdW5jQWZ0ZXJTY3JvbGwoKTt9CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYodHlwZW9mIGFsd2F5cyA9PT0gJ3VuZGVmaW5lZCcpYWx3YXlzPXRydWU7Ly9pZiBmYWxzZSwgc2Nyb2xsaW5nIG9ubHkgd2hlbiB0aGUgLnptLWl0ZW0tbWV0YSBvdXQgb2YgdmlzaWJsZSByYW5nZQogICAgICAgIGlmKHR5cGVvZiBhbmltYXRlID09PSAndW5kZWZpbmVkJylhbmltYXRlPWZhbHNlOy8vaWYgZmFsc2UsIHNjcm9sbGluZyBpbnN0YW50bHkKICAgICAgICBpZihhbHdheXMpJGl0ZW1NZXRhLmNoaWxkcmVuKCcuem0tY29tbWVudC1ib3gnKS5jc3MoJ3Bvc2l0aW9uJywnZml4ZWQnKTsKICAgICAgICB2YXIgd2luSGVpZ2h0PWlaaGlodS4kd2luLmhlaWdodCgpCiAgICAgICAgICAsIHNjcm9sbE9iaj13aW5kb3cuaVpoaWh1NENSWD9kb2N1bWVudC5ib2R5OmRvY3VtZW50LmRvY3VtZW50RWxlbWVudAogICAgICAgICAgLCBzY3JvbGxUb3BOb3c9c2Nyb2xsT2JqLnNjcm9sbFRvcAogICAgICAgICAgLCBuYXZIZWlnaHQ9aVpoaWh1LiRib2R5LmNoaWxkcmVuKCkuZmlyc3QoKS5oZWlnaHQoKQogICAgICAgICAgLCBiYXI9JCgnLnp1LWdsb2JhbC1ub3RpZnkuenUtZ2xvYmFsLW5vdGlmeS1pbmZvOnZpc2libGUnKQogICAgICAgICAgLCBiYXJIZWlnaHQ9IWJhci5sZW5ndGg/MDpiYXIub3V0ZXJIZWlnaHQoKQogICAgICAgICAgLCBiYXNlVG9wPSgoYmFySGVpZ2h0JiZiYXIuY3NzKCdwb3NpdGlvbicpPT0nZml4ZWQnKT9iYXJIZWlnaHQ6KHNjcm9sbFRvcE5vdz5iYXJIZWlnaHQ/MDpiYXJIZWlnaHQtc2Nyb2xsVG9wTm93KSkrbmF2SGVpZ2h0CiAgICAgICAgICAsIG1heEhlaWdodD13aW5IZWlnaHQtYmFzZVRvcAogICAgICAgICAgLCBtZXRhSGVpZ2h0PSRpdGVtTWV0YS5pbm5lckhlaWdodCgpCiAgICAgICAgICAsIG9mZnNldFRvcD0kaXRlbU1ldGEub2Zmc2V0KCkudG9wCiAgICAgICAgICAsIG9mZnNldEJvdHRvbT1vZmZzZXRUb3ArbWV0YUhlaWdodAogICAgICAgICAgLCAkaXRlbT1pWmhpaHUuZ2V0SXRlbSgkaXRlbU1ldGEpCiAgICAgICAgICAsIGl0ZW1IZWlnaHQ9JGl0ZW0uaW5uZXJIZWlnaHQoKQogICAgICAgICAgLCBvZmZzZXRUb3BBPSRpdGVtLm9mZnNldCgpLnRvcAogICAgICAgICAgLCBvZmZzZXRCb3R0b21BPW9mZnNldFRvcEEraXRlbUhlaWdodAogICAgICAgICAgLCBzY3JvbGxUb3BFbmQ9aXRlbUhlaWdodD5tYXhIZWlnaHQ/b2Zmc2V0Qm90dG9tLXdpbkhlaWdodDoob2Zmc2V0VG9wQTw9c2Nyb2xsVG9wTm93P29mZnNldFRvcEEtYmFzZVRvcDpvZmZzZXRCb3R0b20td2luSGVpZ2h0KQogICAgICAgIDsKICAgICAgICBpZighYWx3YXlzKXsKICAgICAgICAgICAgYWx3YXlzPW9mZnNldFRvcDxzY3JvbGxUb3BOb3crYmFzZVRvcHx8b2Zmc2V0Qm90dG9tPnNjcm9sbFRvcE5vdyt3aW5IZWlnaHQtYmFzZVRvcDsKICAgICAgICB9CiAgICAgICAgaWYoYWx3YXlzKXsKICAgICAgICAgICAgaVpoaWh1LlNjcm9sbFRvcD1zY3JvbGxUb3BFbmQ7CiAgICAgICAgICAgIGlmKGFuaW1hdGUpewogICAgICAgICAgICAgICAgJChzY3JvbGxPYmopLmFuaW1hdGUoeydzY3JvbGxUb3AnOnNjcm9sbFRvcEVuZH0sZnVuY0FmdGVyU2Nyb2xsKTsKICAgICAgICAJfWVsc2V7CiAgICAgICAgICAgICAgICAkKHNjcm9sbE9iaikuc2Nyb2xsVG9wKHNjcm9sbFRvcEVuZCk7CiAgICAgICAgICAgICAgICBpZihmdW5jQWZ0ZXJTY3JvbGwpe2Z1bmNBZnRlclNjcm9sbCgpO30KICAgICAgICAJfQogICAgICAgIH1lbHNlewogICAgICAgICAgICBpZihmdW5jQWZ0ZXJTY3JvbGwpe2Z1bmNBZnRlclNjcm9sbCgpO30KICAgICAgICB9CiAgICB9OwogICAgdGhpcy5ib3ggPSBmdW5jdGlvbigkY20sa2VlcFNpemUsYW5pbWF0ZSl7aWYoISRjbXx8ISRjbS5sZW5ndGgpcmV0dXJuOwogICAgICAgICRjbS5zdG9wKCk7CiAgICAgICAgaWYodHlwZW9mIGtlZXBTaXplID09PSAndW5kZWZpbmVkJylrZWVwU2l6ZT1mYWxzZTsKICAgICAgICBpZih0eXBlb2YgYW5pbWF0ZSA9PT0gJ3VuZGVmaW5lZCcpYW5pbWF0ZT1mYWxzZTsKICAgICAgICB2YXIgd2luSGVpZ2h0PWlaaGlodS4kd2luLmhlaWdodCgpCiAgICAgICAgICAsIHRoPWtlZXBTaXplP3BhcnNlSW50KCRjbS5hdHRyKCdpemhfY21IZWlnaHQnKSk6MAogICAgICAgICAgLCBzY3JvbGxUb3A9KGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wKT9kb2N1bWVudC5ib2R5LnNjcm9sbFRvcDpkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wCiAgICAgICAgICAsIG5hdkhlaWdodD1pWmhpaHUuJGJvZHkuY2hpbGRyZW4oKS5maXJzdCgpLmhlaWdodCgpCiAgICAgICAgICAsIGJhcj0kKCcuenUtZ2xvYmFsLW5vdGlmeS56dS1nbG9iYWwtbm90aWZ5LWluZm86dmlzaWJsZScpCiAgICAgICAgICAsIGJhckhlaWdodD0hYmFyLmxlbmd0aD8wOmJhci5vdXRlckhlaWdodCgpCiAgICAgICAgICAsIGJhc2VUb3A9KChiYXJIZWlnaHQmJmJhci5jc3MoJ3Bvc2l0aW9uJyk9PSdmaXhlZCcpP2JhckhlaWdodDooc2Nyb2xsVG9wPmJhckhlaWdodD8wOmJhckhlaWdodC1zY3JvbGxUb3ApKStuYXZIZWlnaHQKICAgICAgICAgICwgbWluSGVpZ2h0PTExMgogICAgICAgICAgLCBtYXhIZWlnaHQ9d2luSGVpZ2h0LWJhc2VUb3AtMzUKICAgICAgICAgICwgdG9vU21hbGw9bWF4SGVpZ2h0PG1pbkhlaWdodAogICAgICAgICAgLCAkbWV0YT0kY20uY2xvc2VzdCgnLnptLWl0ZW0tbWV0YScpCiAgICAgICAgICAsIG1ldGFIZWlnaHQ9MiokbWV0YS5oZWlnaHQoKS0kbWV0YS5pbm5lckhlaWdodCgpCiAgICAgICAgICAsIG9mZnNldFRvcD1zY3JvbGxUb3AtJG1ldGEub2Zmc2V0KCkudG9wCiAgICAgICAgICAsIG9mZnNldEJvdHRvbT0tb2Zmc2V0VG9wLXdpbkhlaWdodAogICAgICAgIDtpZih0b29TbWFsbCltYXhIZWlnaHQ9bWluSGVpZ2h0OwogICAgICAgIGlmKCF0aHx8aXNOYU4odGgpKXsKICAgICAgICAgICAgdmFyICR0PSRjbS5jbG9uZSgpLmNzcyh7J3Bvc2l0aW9uJzonYWJzb2x1dGUnLCd6LWluZGV4JzonLTEnfSkuYXBwZW5kVG8oZG9jdW1lbnQuYm9keSkuc2hvdygpCiAgICAgICAgICAgICAgLCAkbD0kdC5jaGlsZHJlbignLnptLWNvbW1lbnQtbGlzdCcpCiAgICAgICAgICAgIDsKICAgICAgICAgICAgaWYoISRjbS5pcygnLmVtcHR5JykmJiRsLmNoaWxkcmVuKCkubGVuZ3RoPjApJGwuY3NzKHsncG9zaXRpb24nOidhYnNvbHV0ZScsJ2hlaWdodCc6JycsJ3RvcCc6JycsJ2JvdHRvbSc6Jyd9KTsKICAgICAgICAgICAgdGg9JGwuaGVpZ2h0KCk7CiAgICAgICAgICAgIHRoKz10aD09MD9taW5IZWlnaHQ6MTAwOwogICAgICAgICAgICAkdC5yZW1vdmUoKTskdD1udWxsOy8vY29uc29sZS5sb2codGgpOwogICAgICAgICAgICAkY20uY3NzKCdoZWlnaHQnLHRoPD1taW5IZWlnaHQ/bWluSGVpZ2h0Oih0aDxtYXhIZWlnaHQ/dGgtMTAwOm1heEhlaWdodC04MCkpOwogICAgICAgIH0KICAgICAgICB2YXIgdGFyZ2V0PXt9LG90aGVyPXsnaGVpZ2h0JzonJ307CiAgICAgICAgJGNtLmF0dHIoJ2l6aF9jbUhlaWdodCcsdGgpLmNzcyh7J2Rpc3BsYXknOicnLCd2aXNpYmlsaXR5JzondmlzaWJsZScsJ3Bvc2l0aW9uJzonYWJzb2x1dGUnfSk7CiAgICAgICAgaWYodGg8PW1heEhlaWdodCl7CiAgICAgICAgICAgIHZhciB0b3A9LW9mZnNldFRvcC03MCxmaXhIZWlnaHQ9KHRoPD1taW5IZWlnaHQ/LTE6Nyk7CiAgICAgICAgICAgIGlmKCF0b29TbWFsbCYmdG9wK3RoPndpbkhlaWdodCl7CiAgICAgICAgICAgICAgICB0YXJnZXQ9eyd0b3AnOi1vZmZzZXRCb3R0b20tdGgtbWV0YUhlaWdodCtmaXhIZWlnaHQsJ2JvdHRvbSc6b2Zmc2V0Qm90dG9tfTsKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICBvZmZzZXRUb3ArPSgoIXRvb1NtYWxsKSYmdG9wPmJhc2VUb3A/dG9wOmJhc2VUb3ApOwogICAgICAgICAgICAgICAgdGFyZ2V0PXsndG9wJzpvZmZzZXRUb3AsJ2JvdHRvbSc6LW9mZnNldFRvcC10aC1tZXRhSGVpZ2h0K2ZpeEhlaWdodH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJGNtLmZpbHRlcignLmVtcHR5JykuZmluZCgnLnptLWNvbW1lbnQtZm9ybSAuem0tY29tbWVudC1lZGl0YWJsZScpLmNzcyh7J2JvdHRvbSc6Jyd9KTsKICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgdGFyZ2V0PXsndG9wJzpvZmZzZXRUb3ArYmFzZVRvcCwnYm90dG9tJzpvZmZzZXRCb3R0b219OwogICAgICAgICAgICAkY20uZmlsdGVyKCcuZW1wdHknKS5maW5kKCcuem0tY29tbWVudC1mb3JtIC56bS1jb21tZW50LWVkaXRhYmxlJykuY3NzKHsnYm90dG9tJzonMjBweCd9KTsKICAgICAgICB9CiAgICAgICAgaWYoYW5pbWF0ZSl7CiAgICAgICAgICAgICRjbS5hbmltYXRlKHRhcmdldCxmdW5jdGlvbigpeyRjbS5jc3Mob3RoZXIpO30pOwogICAgICAgIH1lbHNlewogICAgICAgICAgICAkY20uY3NzKCQuZXh0ZW5kKHRhcmdldCxvdGhlcikpOwogICAgICAgIH0KICAgICAgICAkY207CiAgICB9OwogICAgdGhpcy5vcGVuID0gZnVuY3Rpb24oJGFjLCRjbSxpY21Gb2N1cyl7Ly8gaWYgJGFjIGlzIG51bGwsIGp1c3QgcmUtc2l6aW5nIGFuZCByZS1sb2NhdGluZyBjb21tZW50LWJveAogICAgICAgIHZhciBub0NvbW1lbnRPcGVuaW5nID0gaVpoaWh1LkNvbW1lbnQuT3BlbmluZyA9PSBudWxsOwogICAgICAgIGlaaGlodS5Db21tZW50Lk9wZW5pbmcgPSAkY20uYXR0cignaXpoLW9wZW5pbmcnLCcxJykuY3NzKHsnZGlzcGxheSc6J25vbmUnfSkuZ2V0KDApOwogICAgICAgICQoJy56bS1jb21tZW50LWJveDp2aXNpYmxlOm5vdChbaXpoLW9wZW5pbmc9MV0pJykKICAgICAgICAgICAgLmVhY2goZnVuY3Rpb24oaSxlKXsKICAgICAgICAgICAgICAgICQoZSkuY3NzKCd2aXNpYmlsaXR5JywnaGlkZGVuJykuY2xvc2VzdCgnLnptLWl0ZW0tbWV0YScpLmZpbmQoJy50b2dnbGUtY29tbWVudCcpWzBdLmNsaWNrKCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIHZhciB3aW5XaWR0aD1pWmhpaHUuJHdpbi53aWR0aCgpCiAgICAgICAgICAsIG1jTGVmdD1pWmhpaHUuJG1haW4ub2Zmc2V0KCkubGVmdAogICAgICAgICAgLCAkY3Q9JGNtLmNsb3Nlc3QoJy56dS1tYWluLWNvbnRlbnQtaW5uZXInKQogICAgICAgICAgLCBjdE1hcmdpbkw9cGFyc2VJbnQoJGN0LmNzcygnbWFyZ2luLWxlZnQnKSkKICAgICAgICAgICwgY3RXaWR0aD0kY3Qud2lkdGgoKStjdE1hcmdpbkwKICAgICAgICAgICwgY3RMZWZ0PSRjdC5vZmZzZXQoKS5sZWZ0LWN0TWFyZ2luTAogICAgICAgICAgLCAkbWV0YT0kY20uY2xvc2VzdCgnLnptLWl0ZW0tbWV0YScpCiAgICAgICAgICAsIG10V2lkdGg9JG1ldGEuaW5uZXJXaWR0aCgpCiAgICAgICAgICAsIG1pbldpZHRoPWlaaGlodS4kbWFpbi53aWR0aCgpLWN0V2lkdGgKICAgICAgICAgICwgY21XaWR0aD1tdFdpZHRoCiAgICAgICAgICAsIG1heFdpZHRoPXdpbldpZHRoLWN0V2lkdGgKICAgICAgICAgICwgbz1mdW5jdGlvbigpewogICAgICAgICAgICAgICAgJGNtLmF0dHIoJ29wZW5lZCcsJzEnKTsKICAgICAgICAJCWlmKCEkYWMpewogICAgICAgICAgICAgICAgICAgIGlaaGlodS5Db21tZW50LmJveCgkY20pOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAJCX0KICAgICAgICAgICAgICAgIHZhciBjdXJyVG9wPV9kb2MuYm9keS5zY3JvbGxUb3AKICAgICAgICAgICAgICAgICAgLCAkbj0kYWMubmV4dCgpLCRuPSRuLmxlbmd0aD8kbjokYWMucGFyZW50KCkubmV4dCgpCiAgICAgICAgICAgICAgICAgICwgdD0kYWMub2Zmc2V0KCkudG9wLWlaaGlodS4kbWFpbi5vZmZzZXQoKS50b3AKICAgICAgICAgICAgICAgICAgLCBiPSRhYy5vZmZzZXQoKS50b3AtaVpoaWh1LiRtYWluLm9mZnNldCgpLnRvcAogICAgICAgICAgICAgICAgICAsIHc9JGFjLndpZHRoKCkKICAgICAgICAgICAgICAgICAgLCBpbkFuc3dlcj0kYWMuaXMoJy56bS1pdGVtLWFuc3dlcicpCiAgICAgICAgICAgICAgICAgICwgaW5RdWVzdGlvbj0kYWMuaXMoJyN6aC1xdWVzdGlvbi1kZXRhaWwnKQogICAgICAgICAgICAgICAgICAsICRxdWVzdGlvbk1ldGE9JCgnI3poLXF1ZXN0aW9uLW1ldGEtd3JhcCcpLy9xdWVzdGlvbl9tZXRhCiAgICAgICAgICAgICAgICAgICwgaD1pblF1ZXN0aW9uPyRxdWVzdGlvbk1ldGEub2Zmc2V0KCkudG9wKyRxdWVzdGlvbk1ldGEuaGVpZ2h0KCkrcGFyc2VJbnQoJHF1ZXN0aW9uTWV0YS5jc3MoJ3BhZGRpbmctYm90dG9tJykpLWlaaGlodS4kbWFpbi5vZmZzZXQoKS50b3AKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDokYWMuaGVpZ2h0KCkrcGFyc2VJbnQoJGFjLmNzcygncGFkZGluZy1ib3R0b20nKSkrcGFyc2VJbnQoJG4uY3NzKCdwYWRkaW5nLXRvcCcpKQogICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgaWYoISRhYy5maW5kKCcuaXpoX3RhcGVfYSwuaXpoX3RhcGVfYicpLmxlbmd0aCkKICAgICAgICAgICAgICAgICAgICAkYWMKICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8ZGl2PicsIHsgJ2NsYXNzJzogJ2l6aF90YXBlX2EnIH0pKQogICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxkaXY+JywgeyAnY2xhc3MnOiAnaXpoX3RhcGVfYicgfSkpCiAgICAgICAgICAgICAgICBpZighJGNtKSRjbT0kYWMuZmluZCgnLnptLWNvbW1lbnQtYm94Jyk7CiAgICAgICAgICAgICAgICBpZigkY20ubGVuZ3RoKXsKICAgICAgICAgICAgICAgICAgICBpZighJGNtLmF0dHIoJ3RhYmluZGV4JykpewogICAgICAgICAgICAgICAgICAgICAgICAkY20uYXR0cigndGFiaW5kZXgnLCctMScpLmZvY3VzKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmKGluUXVlc3Rpb24pewogICAgICAgICAgICAgICAgICAgICAgICAkKCcjaXpoX1F1ZXN0aW9uU2hhZG93JykuY3NzKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdoZWlnaHQnOmgKICAgICAgICAgICAgICAgICAgICAgICAgICAsICdtYXJnaW4tYm90dG9tJzotaAogICAgICAgICAgICAgICAgICAgICAgICB9KS5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVzdGlvbk1ldGEubmV4dCgnOnZpc2libGUnKS5hbmRTZWxmKCkuYWRkQ2xhc3MoJ2l6aF9ub0JvcmRlcicpOwogICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICAkYWMuYWRkQ2xhc3MoJ2l6aF9ib3hTaGFkb3cnKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJGFjLmZpbmQoJy5pemhfdGFwZV9hJykuY3NzKHsKICAgICAgICAgICAgICAgICAgICAgICAgJ3Bvc2l0aW9uJzonYWJzb2x1dGUnCiAgICAgICAgICAgICAgICAgICAgICAsICd3aWR0aCc6MQogICAgICAgICAgICAgICAgICAgICAgLCAnaGVpZ2h0JzpoCiAgICAgICAgICAgICAgICAgICAgICAsICd0b3AnOjAKICAgICAgICAgICAgICAgICAgICAgICwgJ21hcmdpbi1sZWZ0Jzp3LTEKICAgICAgICAgICAgICAgICAgICAgICwgJ3otaW5kZXgnOicxMDAwMCcKICAgICAgICAgICAgICAgICAgICAgICwgJ2JhY2tncm91bmQtY29sb3InOicjZmZmJwogICAgICAgICAgICAgICAgICAgIH0pLnNob3coKTsKICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpWmhpaHUuQ29tbWVudC5ib3goCiAgICAgICAgICAgICAgICAgICAgICAgICRjbS5jc3MoeydsZWZ0JzptdFdpZHRoLTF9KS5hdHRyKCdpemhfaW5RdWVzdGlvbicsaW5RdWVzdGlvbj8nMSc6JzAnKS5yZW1vdmVBdHRyKCdpemgtb3BlbmluZycpCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAkKCcubWVudGlvbi1wb3B1cCcpLmF0dHIoJ2RhdGEtYWlkJywkYWMuYXR0cignZGF0YS1haWQnKSk7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAkYWMuZmluZCgnLnp1LXF1ZXN0aW9uLWFuc3dlci1tZXRhLWNvbW1lbnQnKVswXS5jbGljaygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJGFjLmZpbmQoJy5pemhfdGFwZV9iJykuY3NzKHsKICAgICAgICAgICAgICAgICAgICAncG9zaXRpb24nOidhYnNvbHV0ZScKICAgICAgICAgICAgICAgICAgLCAnd2lkdGgnOjEKICAgICAgICAgICAgICAgICAgLCAnaGVpZ2h0JzpoCiAgICAgICAgICAgICAgICAgICwgJ3RvcCc6MAogICAgICAgICAgICAgICAgICAsICdtYXJnaW4tbGVmdCc6dwogICAgICAgICAgICAgICAgICAsICd6LWluZGV4JzonOTk5OCcKICAgICAgICAgICAgICAgICAgLCAnYmFja2dyb3VuZC1jb2xvcic6JyNlZWUnCiAgICAgICAgICAgICAgICB9KS5zaG93KCk7CiAgICAgICAgICAgICAgICAvLyRhYy5jc3MoJ2JvcmRlci1jb2xvcicsJyM5OTk5OTknKTsKICAgICAgICAgICAgICAgIC8vJG4uY3NzKCdib3JkZXItY29sb3InLCcjOTk5OTk5Jyk7CiAgICAgICAgICAgICAgICAkKCcuemgtYmFja3RvdG9wJykuY3NzKCd2aXNpYmlsaXR5JywnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICBpWmhpaHUuJGJvZHkuc2Nyb2xsVG9wKGN1cnJUb3ApOwogICAgICAgICAgICAgICAgaWYoaWNtRm9jdXMpewogICAgICAgICAgICAgICAgICAgIHZhciAkaWNtPSQoaWNtRm9jdXMpLmF0dHIoJ2l6aF9oaWxpZ2h0JywnMScpCiAgICAgICAgICAgICAgICAgICAgICAsICRsaXN0PSRpY20uY2xvc2VzdCgnLnptLWNvbW1lbnQtbGlzdCcpOwogICAgICAgICAgICAgICAgICAgICRsaXN0LnNjcm9sbFRvcChpY21Gb2N1cy5vZmZzZXRUb3AtJGxpc3QuZ2V0KDApLm9mZnNldFRvcCk7CiAgICAgICAgICAgICAgICAgICAgaVpoaWh1LkNvbW1lbnQuSGlMaWdodEl0ZW09aWNtRm9jdXM7CiAgICAgICAgICAgICAgICAgICAgaVpoaWh1LkNvbW1lbnQuSGlMaWdodENvbG9yPSdyZ2IoMjU1LDI1NSwxNjApJzsKICAgICAgICAgICAgICAgICAgICAkaWNtLmNsaWNrKGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpWmhpaHU9d2luZG93LmlaaGlodTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoaVpoaWh1JiZpWmhpaHUuQ29tbWVudC5IaUxpZ2h0SXRlbSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGlaaGlodS5Db21tZW50LkhpTGlnaHRJdGVtKS5yZW1vdmVBdHRyKCdpemhfaGlsaWdodCcpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CgogICAgICAgIGlmKG1heFdpZHRoPjU0OSltYXhXaWR0aD01NDk7CiAgICAgICAgaWYoY21XaWR0aD5tYXhXaWR0aCkKICAgICAgICAgICAgY21XaWR0aD1tYXhXaWR0aDsKICAgICAgICBpZihjbVdpZHRoPG1pbldpZHRoKQogICAgICAgICAgICBjbVdpZHRoPW1pbldpZHRoOwogICAgICAgICRjbS5hZGRDbGFzcygnaXpoX2JveFNoYWRvdycpLmNzcygkLmV4dGVuZChjc3NfY29tbWVudCx7J3dpZHRoJzpjbVdpZHRoLTl9KSk7CiAgICAgICAgLy9pZighJGNtLmlzKCcuZW1wdHknKSkKICAgICAgICAgICAgJGNtLmNzcyh7J3BhZGRpbmcnOicxMDBweCAwcHggMHB4IDdweCd9KTsKICAgICAgICAkKCdpLnptLWNvbW1lbnQtYnViYmxlJywkY20pLmhpZGUoKTsKICAgICAgICBpZihub0NvbW1lbnRPcGVuaW5nKXsKICAgICAgICAgICAgdmFyIGNtV2lkdGhPdmVyPWNtV2lkdGgtd2luV2lkdGgKICAgICAgICAgICAgICAsIHNoaWZ0TGVmdD1jbVdpZHRoT3ZlcitjdFdpZHRoK2N0TGVmdAogICAgICAgICAgICA7CiAgICAgICAgICAgIGlmKHNoaWZ0TGVmdD4wKXsKICAgICAgICAgICAgICAgIGlmKHNoaWZ0TGVmdD5jdExlZnQpe3NoaWZ0TGVmdD1tY0xlZnQ7fQogICAgICAgICAgICAgICAgZWxzZSBpZihjbVdpZHRoT3Zlcj4wKXtzaGlmdExlZnQtPWNtV2lkdGhPdmVyO30KICAgICAgICAgICAgfQogICAgICAgICAgICBpZihzaGlmdExlZnQ8MCl7c2hpZnRMZWZ0PTA7fQogICAgICAgICAgICBpZihzaGlmdExlZnQgJiYgJGFjKXsKICAgICAgICAgICAgICAgICRjdC5jc3Moeydwb3NpdGlvbic6J3JlbGF0aXZlJywnbGVmdCc6MH0pLmFuaW1hdGUoe2xlZnQ6LXNoaWZ0TGVmdH0sbyk7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgJGN0LmNzcyh7J3Bvc2l0aW9uJzoncmVsYXRpdmUnLCdsZWZ0Jzotc2hpZnRMZWZ0fSk7CiAgICAgICAgICAgICAgICBvKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgbygpOwogICAgICAgIH0JCiAgICB9OwogICAgdGhpcy5jbG9zZSA9IGZ1bmN0aW9uKCRhYywkY20pewogICAgICAgIGlmKCEkY20pJGNtPSRhYy5maW5kKCcuem0tY29tbWVudC1ib3gnKTsKICAgICAgICB2YXIgJGN0PSRjbS5jbG9zZXN0KCcuenUtbWFpbi1jb250ZW50LWlubmVyJyk7CiAgICAgICAgdmFyIG89ZnVuY3Rpb24oKXsKICAgICAgICAgICAgJCh0aGlzKS5jc3MoJ3Bvc2l0aW9uJywnJyk7CiAgICAgICAgICAgIGlmKCEkYWMpcmV0dXJuOwogICAgICAgICAgICB2YXIgJG49JGFjLm5leHQoKQogICAgICAgICAgICAgICwgJG49JG4ubGVuZ3RoPyRuOiRhYy5wYXJlbnQoKS5uZXh0KCkKICAgICAgICAgICAgICAsIGluUXVlc3Rpb249JGFjLmlzKCcjemgtcXVlc3Rpb24tZGV0YWlsJyk7CiAgICAgICAgICAgIGlmKCEkYWMpe3JldHVybjt9CiAgICAgICAgICAgIGlmKGluUXVlc3Rpb24pewogICAgICAgICAgICAgICAgJCgnI2l6aF9RdWVzdGlvblNoYWRvdycpLmhpZGUoKTsKICAgICAgICAgICAgICAgICQoJyN6aC1xdWVzdGlvbi1tZXRhLXdyYXAnKS5uZXh0KCc6dmlzaWJsZScpLmFuZFNlbGYoKS5yZW1vdmVDbGFzcygnaXpoX25vQm9yZGVyJyk7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgJGFjLnJlbW92ZUNsYXNzKCdpemhfYm94U2hhZG93Jyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8kYWMuY3NzKCdib3JkZXItY29sb3InLCcjREREREREJyk7CiAgICAgICAgICAgIC8vJG4uY3NzKCdib3JkZXItY29sb3InLCcjREREREREJyk7CiAgICAgICAgICAgICQoJy5pemhfdGFwZV9hOnZpc2libGUsLml6aF90YXBlX2I6dmlzaWJsZScpLmhpZGUoKTsKICAgICAgICAgICAgJCgnLnpoLWJhY2t0b3RvcCcpLmNzcygndmlzaWJpbGl0eScsJ3Zpc2libGUnKTsKICAgICAgICB9OwoKICAgICAgICBpZihpWmhpaHUuQ29tbWVudC5PcGVuaW5nID09ICRjbS5nZXQoMCkpewogICAgICAgICAgICBpWmhpaHUuQ29tbWVudC5PcGVuaW5nID0gbnVsbDsKICAgICAgICAgICAgJGN0LmFuaW1hdGUoe2xlZnQ6MH0sbyk7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIGlmKCEkYWMpeyRjdC5jc3Moe2xlZnQ6MH0pO30KICAgICAgICAgICAgbygpOwogICAgICAgIH0KICAgICAgICAKICAgIH07CiAgICB0aGlzLnByb2Nlc3NDb21tZW50ID0gZnVuY3Rpb24oJGNtLGZvY3VzTmFtZSl7CiAgICAgICAgdmFyIGxvYWRpbmc9ZmFsc2U7CiAgICAgICAgaWYoJGNtLmlzKCcuem0tY29tbWVudC1zcGlubmVyJykpewogICAgICAgICAgICAkY209JGNtLmNsb3Nlc3QoJy56bS1jb21tZW50LWJveCcpOwogICAgICAgICAgICBsb2FkaW5nPXRydWU7CiAgICAgICAgfQogICAgICAgIGlmKCEkY20uaXMoJy56bS1jb21tZW50LWJveCcpKXJldHVybjsKICAgICAgICB2YXIgJGl0ZW09aVpoaWh1LmdldEl0ZW0oJGNtKTsKICAgICAgICBpZihpWmhpaHUuQ29tbWVudC5SaWdodENvbW1lbnQmJmxvYWRpbmcpewogICAgICAgICAgICB2YXIgY21MZWZ0PSRpdGVtLndpZHRoKCktMTsKICAgICAgICAgICAgJGNtLmNzcyh7J2xlZnQnOmNtTGVmdCwnd2lkdGgnOjIxNiwnei1pbmRleCc6JzEwMDAwJ30pOwogICAgICAgIH0KICAgICAgICBpZigkY20uZmlsdGVyKCcuem0tY29tbWVudC1ib3gnKS5oYXMoJy56bS1jb21tZW50LWxpc3QnKS5sZW5ndGgpewovKiBDb2xsZWN0aW9ucyBmb3IgY29tbWVudAogICAgICAgICAgICAkY20uZmluZCgnLnptLWNvbW1lbnQtZWRpdGFibGUnKS5iaW5kKCdET01Ob2RlSW5zZXJ0ZWQnLGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICAgICAgICAgIHZhciAkYz0kKGV2ZW50LnRhcmdldCksJGNtPSRjLmNsb3Nlc3QoJy56bS1jb21tZW50LWJveCcpOwogICAgICAgICAgICAgICAgaWYoJGMuaXMoJ2EubWVtYmVyX21lbnRpb24nKSl7CiAgICAgICAgICAgICAgICAgICAgaWYoJGNtLmNoaWxkcmVuKCcuaXpoX2NvbGxlY3Rpb25zJykubGVuZ3RoPD0wKXsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnPGRpdiBjbGFzcz0iaXpoX2NvbGxlY3Rpb25zIj5sb2FkaW5nLi4uPC9kaXY+JykuYmluZCgnbW91c2VvdmVyJyxmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pLmJpbmQoJ21vdXNlb3V0JyxmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pLmFwcGVuZFRvKCRjbSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRjLmJpbmQoJ21vdXNlb3ZlcicsZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRjZT0kKHRoaXMpLmNsb3Nlc3QoJy56bS1jb21tZW50LWVkaXRhYmxlJyksJGNtPSQodGhpcykuY2xvc2VzdCgnLnptLWNvbW1lbnQtYm94Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICRjbS5jaGlsZHJlbignLml6aF9jb2xsZWN0aW9ucycpLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYm90dG9tJzokKHRoaXMpLmhlaWdodCgpLSQodGhpcykucG9zaXRpb24oKS50b3AtMQogICAgICAgICAgICAgICAgICAgICAgICAgICwgJ2xlZnQnOiQodGhpcykucG9zaXRpb24oKS5sZWZ0CiAgICAgICAgICAgICAgICAgICAgICAgIH0pLnNob3coKTsKICAgICAgICAgICAgICAgICAgICAgICAgJC5wb3N0KCdodHRwOi8vd3d3LnpoaWh1LmNvbScrJCh0aGlzKS5hdHRyKCdocmVmJykrJy9jb2xsZWN0aW9ucycKICAgICAgICAgICAgICAgICAgICAgICAgICAsICQucGFyYW0oe194c3JmOiQoJ2lucHV0W25hbWU9X3hzcmZdJykudmFsKCl9KQogICAgICAgICAgICAgICAgICAgICAgICAgICwgZnVuY3Rpb24ocmVzdWx0LHN0YXR1cyx4aHIpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAkYy5iaW5kKCdtb3VzZW91dCcsZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRjZT0kKHRoaXMpLmNsb3Nlc3QoJy56bS1jb21tZW50LWVkaXRhYmxlJyksJGNtPSQodGhpcykuY2xvc2VzdCgnLnptLWNvbW1lbnQtYm94Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICRjbS5jaGlsZHJlbignLml6aF9jb2xsZWN0aW9ucycpLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiovCiAgICAgICAgICAgIGlmKGlaaGlodS5Db21tZW50LlJpZ2h0Q29tbWVudCl7CiAgICAgICAgICAgICAgICAkY20uY2xvc2VzdCgnLnptLWl0ZW0tbWV0YScpLmZpbmQoJy50b2dnbGUtY29tbWVudCcpLmNsaWNrKGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICAgICAgICAgICAgICB2YXIgJG9wZW5lZEJ5PSQodGhpcykKICAgICAgICAgICAgICAgICAgICAgICwgJGFjPSRvcGVuZWRCeS5jbG9zZXN0KCcuem0taXRlbS1tZXRhJykKICAgICAgICAgICAgICAgICAgICAgICwgJGNtPSgkYWMucGFyZW50KCkuaXMoJy56bS1pdGVtLW1ldGEuZmVlZC1tZXRhJyk/JGFjLnBhcmVudCgpOiRhYykuZmluZCgnLnptLWNvbW1lbnQtYm94JykuY3NzKCd2aXNpYmlsaXR5JywnaGlkZGVuJykKICAgICAgICAgICAgICAgICAgICA7CiAgICAgICAgICAgICAgICAgICAgaWYoJGNtLmxlbmd0aCl7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkaXRlbT1pWmhpaHUuZ2V0SXRlbSgkY20pOwogICAgICAgICAgICAgICAgICAgICAgICBpZigkY20uaXMoJzpoaWRkZW4nKSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpWmhpaHUuQ29tbWVudC5vcGVuKCRpdGVtLCRjbSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaVpoaWh1LkNvbW1lbnQuY2xvc2UoJGl0ZW0sJGNtKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vaWYoJGNtLmlzKCcuZW1wdHknKSkgcmV0dXJuOwogICAgICAgICAgICB2YXIgJGxpc3Q9JGNtLmZpbmQoJy56bS1jb21tZW50LWxpc3QnKTsKICAgICAgICAgICAgJGxpc3QuYmluZCgnRE9NTm9kZUluc2VydGVkJyxmdW5jdGlvbihldmVudCl7CiAgICAgICAgICAgIC8vdXRpbHMub2JzZXJ2ZURPTU5vZGVBZGRlZCgkbGlzdFswXSxmdW5jdGlvbihldmVudCl7CiAgICAgICAgICAgIAkvKmlmKCFldmVudC5hZGRlZE5vZGVzKXJldHVybjsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdOb2RlcyAnK2V2ZW50LmFkZGVkTm9kZXMubGVuZ3RoKycgaW5zZXJ0ZWQnKTsKICAgICAgICAgICAgCWZvcih2YXIgaT0wO2k8ZXZlbnQuYWRkZWROb2Rlcy5sZW5ndGg7aSsrKXsKICAgICAgICAgICAgCQl2YXIgJGljbT0kKGV2ZW50LmFkZGVkTm9kZXNbaV0pOwogICAgICAgICAgICAgICAgfSovCiAgICAgICAgICAgICAgICB2YXIgJGljbT0kKGV2ZW50LnRhcmdldCkuZmlsdGVyKCcuem0taXRlbS1jb21tZW50LC56bS1jb21tZW50LWZvcm0nKTsKICAgICAgICAgICAgICAgIGlmKCEkaWNtLmxlbmd0aClyZXR1cm47CiAgICAgICAgICAgICAgICB2YXIgJGxpc3Q9JCh0aGlzKQogICAgICAgICAgICAgICAgICAsICRjbT0kbGlzdC5jbG9zZXN0KCcuem0tY29tbWVudC1ib3g6dmlzaWJsZScpOwogICAgICAgICAgICAgICAgaWYoJGljbS5pcygnLnptLWl0ZW0tY29tbWVudCcpKXsKICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCRpY20pOwogICAgICAgICAgICAgICAgICAgIGlmKGlaaGlodS5RdWlja0Jsb2NrKXsKICAgICAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygnQWRkaW5nIFF1aWNrQmxvY2snKTsKICAgICAgICAgICAgICAgICAgICAgICAgaVpoaWh1LlF1aWNrQmxvY2suYWRkUXVpY2tCbG9ja0luT25lQ29tbWVudCgkaWNtKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYoaVpoaWh1LkNvbW1lbnQuUmlnaHRDb21tZW50KXsKICAgICAgICAgICAgICAgICAgICAgICAgJGxpc3QuY3NzKCdoZWlnaHQnLCcxMDAlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICRpY20uc2hvdygpLmJpbmQoJ0RPTU5vZGVSZW1vdmVkJyxmdW5jdGlvbihldmVudCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGljbT0kKGV2ZW50LnRhcmdldCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZighJGljbS5pcygnLnptLWl0ZW0tY29tbWVudCcpKXJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkbGlzdD0kaWNtLmhpZGUoKS5jbG9zZXN0KCcuem0tY29tbWVudC1saXN0JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLCAkY209JGxpc3QuY2xvc2VzdCgnLnptLWNvbW1lbnQtYm94OnZpc2libGUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRjbS5sZW5ndGgpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ1JlZnJlc2hpbmcgY29tbWVudCBsaXN0Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJGxpc3QuY2hpbGRyZW4oKS5sZW5ndGg9PTEpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcuaXpoLXF1aWNrLWJsb2NrLXN3aXRjaCcsJGNtKS5hZGQoJy5pemgtYnV0dG9ucy1jbS1SJywkY20pLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaVpoaWh1LkNvbW1lbnQuYm94KCRjbSxmYWxzZSxmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRjbS5sZW5ndGgpewogICAgICAgICAgICAJICAgICAgICAgICAgdmFyIGNvdW50Tm93PSRsaXN0LmNoaWxkcmVuKCkubGVuZ3RoCiAgICAgICAgICAgICAgICAgICAgICAgIAkgICwgY291bnRBbGw9cGFyc2VJbnQoJGNtLmF0dHIoJ2RhdGEtY291bnQnKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLCBjb3VudFJlc3Q9Y291bnRBbGwtY291bnROb3cKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLCBub3RBbGw9JCh0aGlzKS5oYXMoJy5sb2FkLW1vcmUnKS5sZW5ndGgKICAgICAgICAgICAgICAgICAgICAgICAgCTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCghbm90QWxsKSYmY291bnRSZXN0PjEpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgCXJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ1JlZnJlc2hpbmcgY29tbWVudCBsaXN0Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcuaXpoLXF1aWNrLWJsb2NrLXN3aXRjaCcsJGNtKS5hZGQoJy5pemgtYnV0dG9ucy1jbS1SJywkY20pLnNob3coKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlaaGlodS5Db21tZW50LmJveCgkY20sZmFsc2UsZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYobm90QWxsfHxjb3VudFJlc3Q8MCkkbGlzdC5zY3JvbGxUb3AoJGljbS5nZXQoMCkub2Zmc2V0VG9wKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH1lbHNlIGlmKCRpY20uaXMoJy56bS1jb21tZW50LWZvcm0nKSl7CiAgICAgICAgICAgICAgICAgICAgaWYoaVpoaWh1LkNvbW1lbnQuUmlnaHRDb21tZW50KXsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJGNtLmxlbmd0aCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJHJjbT0kaWNtOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGljbT0kcmNtLmNsb3Nlc3QoJy56bS1pdGVtLWNvbW1lbnQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyY20uZmluZCgnYS56bS1jb21tZW50LWNsb3NlLnptLWNvbW1hbmQtY2FuY2VsJykuY2xpY2soZnVuY3Rpb24oZXZlbnQpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkcmNtPSQodGhpcykuY2xvc2VzdCgnLnptLWNvbW1lbnQtZm9ybScpLmhpZGUoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLCAkY209JHJjbS5jbG9zZXN0KCcuem0tY29tbWVudC1ib3g6dmlzaWJsZScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRjbS5sZW5ndGgpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpWmhpaHUuQ29tbWVudC5ib3goJGNtLGZhbHNlLGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyY20ucGFyZW50KCkuZmluZCgnYS5yZXBseS56bS1jb21tZW50LW9wLWxpbmsnKS5jbGljayhmdW5jdGlvbihldmVudCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRyY209JCh0aGlzKS5jbG9zZXN0KCcuem0tY29tbWVudC1jb250ZW50LXdyYXAnKS5jaGlsZHJlbignLnptLWNvbW1lbnQtZm9ybScpLnRvZ2dsZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsICRpY209JCh0aGlzKS5jbG9zZXN0KCcuem0taXRlbS1jb21tZW50JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgJGxpc3Q9JGljbS5jbG9zZXN0KCcuem0tY29tbWVudC1saXN0JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgJGNtPSRsaXN0LmNsb3Nlc3QoJy56bS1jb21tZW50LWJveDp2aXNpYmxlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJGNtLmxlbmd0aCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlaaGlodS5Db21tZW50LmJveCgkY20sZmFsc2UsZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkcmNtLmlzKCc6dmlzaWJsZScpKSRsaXN0LnNjcm9sbFRvcCgkaWNtLmdldCgwKS5vZmZzZXRUb3AtJGxpc3QuZ2V0KDApLm9mZnNldFRvcCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyY20udG9nZ2xlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpWmhpaHUuQ29tbWVudC5ib3goJGNtLGZhbHNlLGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsaXN0LnNjcm9sbFRvcCgkaWNtLmdldCgwKS5vZmZzZXRUb3AtJGxpc3QuZ2V0KDApLm9mZnNldFRvcCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2YXIgY21DbG9zZT1mdW5jdGlvbihldmVudCxhbHNvU2Nyb2xsVG9WaWV3Qm90dG9tKXsKICAgICAgICAgICAgICAgICAgICB2YXIgJGNtPSQodGhpcykuY2xvc2VzdCgnLnptLWNvbW1lbnQtYm94Jyk7CiAgICAgICAgICAgICAgICAJCWlmKCQodGhpcykuaXMoJ1tuYW1lPWNsb3NlZm9ybV0nKSYmKCEkY20uaXMoJy5lbXB0eScpKSlyZXR1cm47CiAgICAgICAgICAgICAgICAgICAgdmFyICRpdGVtPWlaaGlodS5nZXRJdGVtKCRjbSkvLy5hdHRyKCd0YWJpbmRleCcsJy0xJykuZm9jdXMoKS5yZW1vdmVBdHRyKCd0YWJpbmRleCcpCiAgICAgICAgICAgICAgICAgICAgICAsICRpdGVtTWV0YT0kY20uY2xvc2VzdCgnLnptLWl0ZW0tbWV0YScpCiAgICAgICAgICAgICAgICAgICAgICAsIGFsc29TY3JvbGw9dGhpcy5nZXRBdHRyaWJ1dGUoJ2l6aC1hbHNvU2Nyb2xsVG9WaWV3Qm90dG9tJyl8fCcnCiAgICAgICAgICAgICAgICAgICAgICAsIHNjcm9sbFRvcD0oZG9jdW1lbnQuYm9keS5zY3JvbGxUb3ApP2RvY3VtZW50LmJvZHkuc2Nyb2xsVG9wOmRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AKICAgICAgICAgICAgICAgICAgICA7CiAgICAgICAgICAgICAgICAgICAgaWYoYWxzb1Njcm9sbCE9PScxJyl7CiAgICAgICAgICAgICAgICAgICAgICAgICRpdGVtTWV0YS5maW5kKCcudG9nZ2xlLWNvbW1lbnQnKVswXS5jbGljaygpOwogICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcD1zY3JvbGxUb3A7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wPXNjcm9sbFRvcDsKICAgICAgICAgICAgICAgICAgICAgICAgfSwxMDApOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlaaGlodS5Db21tZW50Lm1ldGFTY3JvbGxUb1ZpZXdCb3R0b20oJGl0ZW1NZXRhLGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgICAgICRpdGVtTWV0YS5maW5kKCcudG9nZ2xlLWNvbW1lbnQnKVswXS5jbGljaygpOwogICAgICAgICAgICAgICAgICAgIH0sZmFsc2UsdHJ1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgLCAkYnRuQ0M9JCgnPGE+Jyx7CiAgICAgICAgICAgICAgICAgICAgJ2NsYXNzJzonenUtcXVlc3Rpb24tYW5zd2VyLW1ldGEtY29tbWVudCBpemgtYnV0dG9uLWNjJwogICAgICAgICAgICAgICAgICAsIGhyZWY6J2phdmFzY3JpcHQ6dm9pZCgwKTsnCiAgICAgICAgICAgICAgICAgICwgY2xpY2s6Y21DbG9zZQogICAgICAgICAgICAgICAgICAsICdkYXRhLXRpcCc6J3MkdCTmlLbotbfor4Torrrlubbot7Povazoh7PmiYDlsZ7lm57nrZQnCiAgICAgICAgICAgICAgICB9KS50ZXh0KCfmlLbotbcnKQogICAgICAgICAgICAgICwgJGJ1dHRvbnNMPSQoJzxkaXY+Jyx7CiAgICAgICAgICAgICAgICAJJ2NsYXNzJzonaXpoLWJ1dHRvbnMtY20tTCcKICAgICAgICAgICAgICAgIH0pLnByZXBlbmRUbygkY20pCiAgICAgICAgICAgICAgLCAkYnV0dG9uc1I9JCgnPGRpdj4nLHsKICAgICAgICAgICAgICAgIAknY2xhc3MnOidpemgtYnV0dG9ucy1jbS1SJwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgOwogICAgICAgICAgICBpZihpWmhpaHUuQ29tbWVudC5SaWdodENvbW1lbnQpewogICAgICAgICAgICAgICAgJGNtLmNoaWxkcmVuKCcuem0tY29tbWVudC1mb3JtJykuZmluZCgnW25hbWU9Y2xvc2Vmb3JtXScpLmNsaWNrKGNtQ2xvc2UpOwogICAgICAgICAgICAgICAgJGJ0bkNDLmNsb25lKHRydWUpLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgJ2JhY2tncm91bmQtaW1hZ2UnOiAndXJsKCIvc3RhdGljL2ltZy9zcHJpdGVzLTEuOS4yLnBuZyIpJwogICAgICAgICAgICAgICAgICAsICdiYWNrZ3JvdW5kLXBvc2l0aW9uJzogJy0yNjFweCAtNjJweCcKICAgICAgICAgICAgICAgICAgLCAnYmFja2dyb3VuZC1yZXBlYXQnOiAnbm8tcmVwZWF0JwogICAgICAgICAgICAgICAgICAsICdkaXNwbGF5JzogJ2lubGluZS1ibG9jaycKICAgICAgICAgICAgICAgICAgLCAnd2lkdGgnOiAxNQogICAgICAgICAgICAgICAgICAsICdoZWlnaHQnOiAxNQogICAgICAgICAgICAgICAgICAsICdwb3NpdGlvbic6ICdhYnNvbHV0ZScKICAgICAgICAgICAgICAgICAgLCAnbGVmdCc6IDAKICAgICAgICAgICAgICAgICAgLCAndG9wJzogMAogICAgICAgICAgICAgICAgICAsICd6LWluZGV4JzogJzEwMDAwJwogICAgICAgICAgICAgICAgfSkuYXR0cignZGF0YS10aXAnLCdzJGwk5pS26LW36K+E6K66JykudGV4dCgnJykucHJlcGVuZFRvKCRjbSkKICAgICAgICAgICAgICAgICRidXR0b25zUi5wcmVwZW5kVG8oJGNtKTsKICAgICAgICAgICAgICAgIGlmKCRsaXN0LmNoaWxkcmVuKCkubGVuZ3RoPT0wKXsKICAgICAgICAgICAgICAgICAgICAkYnV0dG9uc1IuaGlkZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJGJ0bkNDLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgJ2Zsb2F0JzonbGVmdCcKICAgICAgICAgICAgICAgICAgLCAnbWFyZ2luLWxlZnQnOjcKICAgICAgICAgICAgICAgIH0pLmF0dHIoJ2l6aC1hbHNvU2Nyb2xsVG9WaWV3Qm90dG9tJywnMScpLnByZXBlbmQoJzxpIGNsYXNzPSJ6LWljb24taXpoLWZvbGQiLz4nKS5wcmVwZW5kVG8oJGJ1dHRvbnNMKTsKICAgICAgICAgICAgICAgICQoJzxhPicsewogICAgICAgICAgICAgICAgICAgICdjbGFzcyc6J2l6aC1idXR0b24gaXpoLWJhY2stdG9wJwogICAgICAgICAgICAgICAgICAsICdkYXRhLXRpcCc6J3MkbCTov5Tlm57pobbpg6gnCiAgICAgICAgICAgICAgICAgICwgaHJlZjonamF2YXNjcmlwdDp2b2lkKDApOycKICAgICAgICAgICAgICAgICAgLCBjbGljazpmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMucGFyZW50Tm9kZSkubmV4dEFsbCgnLnptLWNvbW1lbnQtbGlzdCcpLnNjcm9sbFRvcCgwKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KS5hcHBlbmQoCiAgICAgICAgICAgICAgICAgICAgJCgnPGk+JywgeyAnY2xhc3MnOiAnemctaWNvbiB6LWljb24tZm9sZCcgfSkKICAgICAgICAgICAgICAgICkuYWRkKAogICAgICAgICAgICAgICAgICAgICQoJzxhPicsewogICAgICAgICAgICAgICAgICAgICAgICAnY2xhc3MnOidpemgtYnV0dG9uIGl6aC1zaG93LWdvb2QnCiAgICAgICAgICAgICAgICAgICAgICAsICdkYXRhLXRpcCc6J3MkbCTkurrmsJTlppnor4QnCiAgICAgICAgICAgICAgICAgICAgICAsIGhyZWY6J2phdmFzY3JpcHQ6dm9pZCgwKTsnCiAgICAgICAgICAgICAgICAgICAgICAsIGNsaWNrOmZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkZT0kKHRoaXMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLCAkYz0kZS5jbG9zZXN0KCcuem0tY29tbWVudC1ib3gnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgJGw9JGMuZmluZCgnLnptLWNvbW1lbnQtbGlzdCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLCAkbj0kbC5maW5kKCcuem0taXRlbS1jb21tZW50JykuaGFzKCdzcGFuLmxpa2UtbnVtLm5pbCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgIDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJGUuaGFzQ2xhc3MoJ29uJykpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGUuYXR0cignc2Nyb2xsVG9wX3Nob3dnb29kJywkbFswXS5zY3JvbGxUb3ApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG4uc2hvdygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaVpoaWh1LkNvbW1lbnQuYm94KCRjLGZhbHNlLGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRlLnJlbW92ZUNsYXNzKCdvbicpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNjcm9sbFRvcCA9IHBhcnNlSW50KCRlLmF0dHIoJ3Njcm9sbFRvcCcpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCFpc05hTihzY3JvbGxUb3ApKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsLnNjcm9sbFRvcChzY3JvbGxUb3ApOwogICAgICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRlLmF0dHIoJ3Njcm9sbFRvcCcsJGxbMF0uc2Nyb2xsVG9wKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRuLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlaaGlodS5Db21tZW50LmJveCgkYyxmYWxzZSxmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZS5hZGRDbGFzcygnb24nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzY3JvbGxUb3AgPSBwYXJzZUludCgkZS5hdHRyKCdzY3JvbGxUb3Bfc2hvd2dvb2QnKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZighaXNOYU4oc2Nyb2xsVG9wKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbC5zY3JvbGxUb3Aoc2Nyb2xsVG9wKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkuYXBwZW5kKAogICAgICAgICAgICAgICAgICAgICAgICAkKCc8aT4nLCB7ICdjbGFzcyc6ICd6Zy1pY29uIHpnLWljb24tY29tbWVudC1saWtlJyB9KQogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICkuY3NzKHsKICAgICAgICAgICAgICAgICAgICAnZmxvYXQnOidyaWdodCcKICAgICAgICAgICAgICAgIH0pLmFwcGVuZFRvKCRidXR0b25zUik7CgogICAgICAgICAgICAgICAgaVpoaWh1LkNvbW1lbnQuUGFnZU5vdFNjcm9sbCA9IHRydWU7CiAgICAgICAgICAgICAgICAkbGlzdC5zY3JvbGwoZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICB2YXIgJGU9JCh0aGlzKQogICAgICAgICAgICAgICAgICAgICAgLCAkYj0kZS5jbG9zZXN0KCcuem0tY29tbWVudC1ib3gnKS5maW5kKCcuaXpoLWJhY2stdG9wJykKICAgICAgICAgICAgICAgICAgICA7CiAgICAgICAgICAgICAgICAgICAgaWYoJGUuaGVpZ2h0KCkgPCB0aGlzLnNjcm9sbFRvcCl7CiAgICAgICAgICAgICAgICAgICAgICAgICRiLnJlbW92ZUNsYXNzKCdvZmYnKTsKICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgJGIuYWRkQ2xhc3MoJ29mZicpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pLnNjcm9sbCgpOwogICAgICAgICAgICAgICAgaVpoaWh1LkNvbW1lbnQuUGFnZU5vdFNjcm9sbCA9IGZhbHNlOwoKICAgICAgICAgICAgICAgIHZhciBpY21Gb2N1cz1udWxsOwogICAgICAgICAgICAgICAgICAgICRsaXN0LmNzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICdoZWlnaHQnOiRjbS5pcygnLmVtcHR5Jyk/Jyc6JzEwMCUnCiAgICAgICAgICAgICAgICAgICAgICAsICdvdmVyZmxvdyc6J2F1dG8nCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAkbGlzdC5jaGlsZHJlbignLnptLWl0ZW0tY29tbWVudCcpLmVhY2goZnVuY3Rpb24oaSxlKXsKICAgICAgICAgICAgICAgICAgICB2YXIgJGljbT0kKGUpOwogICAgICAgICAgICAgICAgICAgICRpY20uYmluZCgnRE9NTm9kZVJlbW92ZWQnLGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRpY209JChldmVudC50YXJnZXQpOwogICAgICAgICAgICAgICAgICAgICAgICBpZighJGljbS5pcygnLnptLWl0ZW0tY29tbWVudCcpKXJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRjbT0kaWNtLmhpZGUoKS5jbG9zZXN0KCcuem0tY29tbWVudC1ib3g6dmlzaWJsZScpOwogICAgICAgICAgICAgICAgICAgICAgICBpZigkY20ubGVuZ3RoKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCQodGhpcykuY2xvc2VzdCgnLnptLWNvbW1lbnQtbGlzdCcpLmNoaWxkcmVuKCkubGVuZ3RoPT0xKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcuaXpoLXF1aWNrLWJsb2NrLXN3aXRjaCcsJGNtKS5hZGQoJy5pemgtYnV0dG9ucy1jbS1SJywkY20pLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlaaGlodS5Db21tZW50LmJveCgkY20sZmFsc2UsZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgJGljbS5maW5kKCdzcGFuLmxpa2UtbnVtJykuZWFjaChmdW5jdGlvbihpLGUpewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGlwPWUuZ2V0QXR0cmlidXRlKCdkYXRhLXRpcCcpLnJlcGxhY2UoJ3MkciQnLCdzJGwkJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRpcCE9JycpZS5zZXRBdHRyaWJ1dGUoJ2RhdGEtdGlwJyx0aXApOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGlmICghaWNtRm9jdXMmJmZvY3VzTmFtZSYmZm9jdXNOYW1lIT0nJwogICAgICAgICAgICAgICAgICAgICAgICAmJiAkaWNtLmNoaWxkcmVuKCdhLnpnLWFuY2hvci1oaWRkZW5bbmFtZT0iJytmb2N1c05hbWUrJyJdJykubGVuZ3RoKXsKICAgICAgICAgICAgICAgICAgICAgICAgaWNtRm9jdXM9JGljbS5nZXQoMCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBpWmhpaHUuQ29tbWVudC5vcGVuKCRpdGVtLCRjbSxpY21Gb2N1cyk7CiAgICAgICAgICAgICAgICB1dGlscy5vYnNlcnZlRE9NTm9kZUFkZGVkKCRjbS5jaGlsZHJlbignLnptLWNvbW1lbnQtZm9ybScpLmNoaWxkcmVuKCcuem0tY29tbWVudC1lZGl0YWJsZScpWzBdLGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICAgICAgICAgICAgICB2YXIgJGU9JChldmVudC50YXJnZXQpCiAgICAgICAgICAgICAgICAgICAgICAsICRmPSRlLmNsb3Nlc3QoJy56bS1jb21tZW50LWZvcm0nKQogICAgICAgICAgICAgICAgICAgICAgLCAkbD0kZi5wcmV2KCcuem0tY29tbWVudC1saXN0JykKICAgICAgICAgICAgICAgICAgICAgICwgJGM9JGYuY2xvc2VzdCgnLnptLWNvbW1lbnQtYm94W29wZW5lZD0xXScpCiAgICAgICAgICAgICAgICAgICAgICAsIGNoPSRjLmhlaWdodCgpCiAgICAgICAgICAgICAgICAgICAgICAsIHdpbkhlaWdodD1pWmhpaHUuJHdpbi5oZWlnaHQoKQogICAgICAgICAgICAgICAgICAgICAgLCBzY3JvbGxUb3A9ZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCtkb2N1bWVudC5ib2R5LnNjcm9sbFRvcAogICAgICAgICAgICAgICAgICAgICAgLCBuYXZIZWlnaHQ9aVpoaWh1LiRib2R5LmNoaWxkcmVuKCkuZmlyc3QoKS5oZWlnaHQoKQogICAgICAgICAgICAgICAgICAgICAgLCBiYXI9JCgnLnp1LWdsb2JhbC1ub3RpZnkuenUtZ2xvYmFsLW5vdGlmeS1pbmZvOnZpc2libGUnKQogICAgICAgICAgICAgICAgICAgICAgLCBiYXJIZWlnaHQ9IWJhci5sZW5ndGg/MDpiYXIub3V0ZXJIZWlnaHQoKQogICAgICAgICAgICAgICAgICAgICAgLCBiYXNlVG9wPSgoYmFySGVpZ2h0JiZiYXIuY3NzKCdwb3NpdGlvbicpPT0nZml4ZWQnKT9iYXJIZWlnaHQ6KHNjcm9sbFRvcD5iYXJIZWlnaHQ/MDpiYXJIZWlnaHQtc2Nyb2xsVG9wKSkrbmF2SGVpZ2h0CiAgICAgICAgICAgICAgICAgICAgICAsIG1pbkhlaWdodD0xMTIKICAgICAgICAgICAgICAgICAgICAgICwgbWF4SGVpZ2h0PXdpbkhlaWdodC1iYXNlVG9wLTM1CiAgICAgICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgICAgIGlmKCEkYy5sZW5ndGgpcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIGlmKCEkYy5pcygnLmVtcHR5JykmJiRsLmNoaWxkcmVuKCkubGVuZ3RoPjApewogICAgICAgICAgICAgICAgICAgICAgICBsaD0kbC5oZWlnaHQoKTsKICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgbGg9MDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdmFyICR0PSRlLmNsb25lKCkuYXBwZW5kVG8oZG9jdW1lbnQuYm9keSkKICAgICAgICAgICAgICAgICAgICAJICAgIC5jc3Moeydwb3NpdGlvbic6J2Fic29sdXRlJywnei1pbmRleCc6Jy0xJywnd2lkdGgnOiRlLndpZHRoKCksJ21pbi1oZWlnaHQnOjIyfSkKICAgICAgICAgICAgICAgICAgICAgICwgZWg9JHQuaGVpZ2h0KCkKICAgICAgICAgICAgICAgICAgICAgICwgaD1NYXRoLm1heChlaCxsaCkrKGxoPT0wPzkwOjEwMCkKICAgICAgICAgICAgICAgICAgICA7CiAgICAgICAgICAgICAgICAgICAgJHQucmVtb3ZlKCk7JHQ9bnVsbDsKICAgICAgICAgICAgICAgICAgICBpZihpc05hTihjaCl8fGNoIT1oKXsKICAgICAgICAgICAgICAgICAgICAgICAgJGMuYXR0cignaXpoX2NtSGVpZ2h0JyxoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaVpoaWh1LkNvbW1lbnQuYm94KCRjLHRydWUsZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZighJGYuaXMoJy5leHBhbmRlZCcpJiZldmVudC5hZGRlZE5vZGVzLmxlbmd0aCl7CiAgICAgICAgICAgICAgICAgICAgICAgICRmLmNzcyh7J2hlaWdodCc6JycsJ2JvdHRvbSc6Jyd9KTsKICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgZWgrPTMwOwogICAgICAgICAgICAgICAgICAgICAgICAkZi5jc3MobGg9PTB8fGVoPmNoP3snaGVpZ2h0JzonJywnYm90dG9tJzoyNX06eydoZWlnaHQnOmVoLCdib3R0b20nOicnfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgJGJ0bkNDLnByZXBlbmQoJzxpIGNsYXNzPSJ6LWljb24tZm9sZCIvPicpCiAgICAgICAgICAgICAgICAuY3NzKHsKICAgICAgICAgICAgICAgICAgICAncG9zaXRpb24nOidhYnNvbHV0ZScKICAgICAgICAgICAgICAgICAgLCAnY3Vyc29yJzoncG9pbnRlcicKICAgICAgICAgICAgICAgICAgLCAnbWFyZ2luLWxlZnQnOi0xCiAgICAgICAgICAgICAgICAgICwgJ2xlZnQnOjAKICAgICAgICAgICAgICAgICAgLCAnYmFja2dyb3VuZC1jb2xvcic6JyNmYmZiZmInCiAgICAgICAgICAgICAgICAgICwgJ3BhZGRpbmcnOicycHggNXB4JwogICAgICAgICAgICAgICAgICAsICdib3R0b20nOi0yMgogICAgICAgICAgICAgICAgICAsICdib3JkZXInOicxcHggc29saWQgI2RkZCcKICAgICAgICAgICAgICAgICAgLCAnYm9yZGVyLXJhZGl1cyc6JzRweCcKICAgICAgICAgICAgICAgIH0pLmluc2VydEJlZm9yZSgkY20uZmluZCgnLnptLWNvbW1lbnQtYm94LWZ0JykpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKGlaaGlodS5RdWlja0Jsb2NrKXsKICAgICAgICAgICAgICAgIGlaaGlodS5RdWlja0Jsb2NrLmFkZFF1aWNrQmxvY2tJbkNvbW1lbnRMaXN0KCRidXR0b25zTCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwoKICAgIHJldHVybiB0aGlzOwp9CgovKioKICogQGNsYXNzIE5vdGk3CiAqLwpmdW5jdGlvbiBOb3RpNyhpWmhpaHUpIHsKICAgIGlmICggdHlwZW9mIGlaaGlodSA9PT0gJ3VuZGVmaW5lZCcgfHwgIWlaaGlodSB8fCAhaVpoaWh1LmNvbmZpZ1snTm90aTcnXSkgewogICAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgaVpoaWh1Lk5vdGk3ID0gdGhpczsKICAgIAogICAgdGhpcy4kbm90aTcgPSAkKCcjemgtdG9wLW5hdi1saXZlLW5ldycpOwogICAgdGhpcy4kZnJhbWUgPSAkKCcuem0tbm90aTctZnJhbWUnLHRoaXMuJG5vdGk3KTsKICAgIHRoaXMuJGNvbnRlbnQgPSAkKCcuem0tbm90aTctY29udGVudC1ib2R5Jyx0aGlzLiRub3RpNyk7CiAgICB0aGlzLiRmb290ZXIgPSAkKCcuem0tbm90aTctcG9wdXAtZm9vdGVyJyx0aGlzLiRub3RpNyk7CiAgICB0aGlzLiR0YWIgPSAkKCcuem0tbm90aTctcG9wdXAtdGFiLWNvbnRhaW5lcicsJyN6aC10b3AtbmF2LWxpdmUtbmV3LWlubmVyJyk7CgogICAgdGhpcy5jc3MgPSAKICAgICAgICBbJyN6aC10b3AtbmF2LWxpdmUtbmV3IC56bS1ub3RpNy1wb3B1cC1mb290ZXIgYVt1bnJlYWRvbmx5PSIxIl17Y29sb3I6IzIyNTU5OSAhaW1wb3J0YW50O3RleHQtc2hhZG93OjAgMCAxcHggIzIyNTU5OTt9JwogICAgICAgICwnJ10uam9pbignXG4nKTsKICAgIHRoaXMuZW5oYW5jZSA9IGZ1bmN0aW9uKCl7CiAgICAgICAgaVpoaWh1Lk5vdGk3LiR0YWIuZmluZCgnLnptLW5vdGk3LXBvcHVwLXRhYi1pdGVtJykuZWFjaChmdW5jdGlvbihpLGUpewogICAgICAgICAgICB1dGlscy5vYnNlcnZlRE9NQXR0ck1vZGlmaWVkKGUsZnVuY3Rpb24oZXZlbnQpewogICAgICAgICAgICAgICAgdmFyICRlPSQoZXZlbnQudGFyZ2V0KTsKICAgICAgICAgICAgICAgIGlmKCRlLmlzKCcuem0tbm90aTctcG9wdXAtdGFiLWl0ZW0uY3VycmVudCcpKXsKICAgICAgICAgICAgICAgIAl2YXIgY3VycmVudENsYXNzPSRlLmF0dHIoJ2NsYXNzJykKICAgICAgICAgICAgICAgIAkgICwgJGJGaWx0ZXJSZWFkPSQoJy5pemgtZmlsdGVyLXJlYWQnLGlaaGlodS5Ob3RpNy4kZm9vdGVyKTsKICAgICAgICAgICAgICAgIAlpZihjdXJyZW50Q2xhc3MhPSRiRmlsdGVyUmVhZC5hdHRyKCdjdXJyZW50Q2xhc3MnKSl7CiAgICAgICAgICAgICAgICAJICAgICRiRmlsdGVyUmVhZC5hdHRyKHsndW5yZWFkT25seSc6JycsJ2N1cnJlbnRDbGFzcyc6Y3VycmVudENsYXNzfSk7CiAgICAgICAgICAgICAgICAJfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgICBpWmhpaHUuTm90aTcuJGZvb3Rlci5hcHBlbmQoCiAgICAgICAgICAgICQoJzxhPicsewogICAgICAgICAgICAgICAgJ2NsYXNzJzonaXpoLWZpbHRlci1yZWFkJwogICAgICAgICAgICAgICwgaHJlZjonamF2YXNjcmlwdDp2b2lkKDApOycKICAgICAgICAgICAgICAsICd1bnJlYWRPbmx5JzonJwogICAgICAgICAgICAgICwgY2xpY2s6ZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICB2YXIgdW5yZWFkT25seT10aGlzLmdldEF0dHJpYnV0ZSgndW5yZWFkT25seScpPT0nMScKICAgICAgICAgICAgICAgICAgICAgICwgJGNvbnRlbnRWaXNpYmxlPWlaaGlodS5Ob3RpNy4kY29udGVudC5maWx0ZXIoJzp2aXNpYmxlJykKICAgICAgICAgICAgICAgICAgICAgICwgJHNjcm9sbGVyPSRjb250ZW50VmlzaWJsZS5jbG9zZXN0KCcuemgtc2Nyb2xsZXItaW5uZXInKQogICAgICAgICAgICAgICAgICAgICAgLCAkaXRlbXM9JGNvbnRlbnRWaXNpYmxlLmZpbmQoJy56bS1ub3RpNy1jb250ZW50LWl0ZW0nKQogICAgICAgICAgICAgICAgICAgIDsKICAgICAgICAgICAgICAgICAgICB1bnJlYWRPbmx5PSF1bnJlYWRPbmx5OwogICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0QXR0cmlidXRlKCd1bnJlYWRPbmx5Jyx1bnJlYWRPbmx5PycxJzonJyk7CiAgICAgICAgICAgICAgICAgICAgaWYodW5yZWFkT25seSl7CiAgICAgICAgICAgICAgICAgICAgICAgICRzY3JvbGxlci5hdHRyKCdzY3JvbGxUb3AnLCRzY3JvbGxlclswXS5zY3JvbGxUb3ApOwogICAgICAgICAgICAgICAgICAgICAgICAkaXRlbXMubm90KCcudW5yZWFkJykuaGlkZSgpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2Nyb2xsVG9wID0gcGFyc2VJbnQoJHNjcm9sbGVyLmF0dHIoJ3Njcm9sbFRvcF91bnJlYWQnKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCFpc05hTihzY3JvbGxUb3ApKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjcm9sbGVyLnNjcm9sbFRvcChzY3JvbGxUb3ApOwogICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICAkc2Nyb2xsZXIuYXR0cignc2Nyb2xsVG9wX3VucmVhZCcsJHNjcm9sbGVyWzBdLnNjcm9sbFRvcCk7CiAgICAgICAgICAgICAgICAgICAgICAgICRpdGVtcy5ub3QoJy51bnJlYWQnKS5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzY3JvbGxUb3AgPSBwYXJzZUludCgkc2Nyb2xsZXIuYXR0cignc2Nyb2xsVG9wJykpOwogICAgICAgICAgICAgICAgICAgICAgICBpZighaXNOYU4oc2Nyb2xsVG9wKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY3JvbGxlci5zY3JvbGxUb3Aoc2Nyb2xsVG9wKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgCiAgICAgICAgICAgIH0pLnRleHQoJ+makOiXj+W3suivuycpCiAgICAgICAgKTsKICAgIH07CgogICAgcmV0dXJuIHRoaXM7Cn0KCi8qKgogKiBAY2xhc3MgUXVpY2tCbG9jawogKi8KZnVuY3Rpb24gUXVpY2tCbG9jayhpWmhpaHUpIHsKICAgIGlmICggdHlwZW9mIGlaaGlodSA9PT0gJ3VuZGVmaW5lZCcgfHwgIWlaaGlodSB8fCAhaVpoaWh1LmNvbmZpZ1snUXVpY2tCbG9jayddKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBpWmhpaHUuUXVpY2tCbG9jayA9IHRoaXM7CiAgICAKLyoKICAgIHZhciBjc3NfUXVpY2tCbG9jayA9IHsKICAgICAgICAgICAgJ2JhY2tncm91bmQtcG9zaXRpb24nOictMTQ2cHggLTIwMnB4JwogICAgICAgICAgLCAnd2lkdGgnOjE2CiAgICAgICAgICAsICdoZWlnaHQnOjE2CiAgICAgIAl9CiAgICA7CiovCiAgICB0aGlzLlBlbmRpbmcgPSB7VXNlcnM6JywnLENvdW50OjB9OwogICAgdGhpcy5CbG9ja2luZyA9IHtVc2VyczonLCcsQ291bnQ6MH07CiAgICB0aGlzLlVuZm9sbG93ZWQgPSB7VXNlcnM6JywnLENvdW50OjB9OwogICAgdGhpcy5SZWZvbGxvd2VkID0ge1VzZXJzOicsJyxDb3VudDowfTsKICAgIHRoaXMuVXNlcnMyQiA9IFtdCiAgICB0aGlzLlVzZXJzMkJCUSA9IFtdCiAgICB0aGlzLmNzcyA9IAogICAgICAgIFsnLml6aF9ibG9ja0NhcnR7YmFja2dyb3VuZC1jb2xvcjojMDc3MUMxO3Bvc2l0aW9uOmZpeGVkO3JpZ2h0OjA7ei1pbmRleDo5O3BhZGRpbmc6MCAzMHB4IDAgNjBweDtib3JkZXI6MXB4IHNvbGlkICMwNzcxQzE7Ym9yZGVyLWxlZnQtd2lkdGg6MTBweDtib3JkZXItdG9wLWxlZnQtcmFkaXVzOjZweDt9JwogICAgICAgICwnLml6aF9ibG9ja0NhcnQgLmRve2NvbG9yOiNmZmY7dGV4dC1hbGlnbjpjZW50ZXI7ZGlzcGxheTpibG9jazttYXJnaW46MnB4O21pbi13aWR0aDo4MHB4O3dpZHRoOjEwMCU7aGVpZ2h0OjIwcHg7fScKICAgICAgICAsJy5pemhfYmxvY2tDYXJ0LnBlbmRpbmcgLmRvOmFmdGVye3RleHQtZGVjb3JhdGlvbjpibGluaztjb2xvcjpyZWQ7fScKICAgICAgICAsJy5pemhfYmxvY2tDYXJ0IC5kbzphZnRlcntwb3NpdGlvbjpyZWxhdGl2ZTtjb250ZW50OmF0dHIoaXpoX251bTJCKTt9JwogICAgICAgICwnLml6aF9ibG9ja0NhcnQgLmRvIC5idXR0b257Y29sb3I6I2ZmZjt9JwogICAgICAgICwnLml6aF9ibG9ja0NhcnQgLmZyYW1le292ZXJmbG93LXk6YXV0bztvdmVyZmxvdy14OmhpZGRlbjtwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MjVweDtib3R0b206MDtsZWZ0OjA7cmlnaHQ6MDtiYWNrZ3JvdW5kLWNvbG9yOiNmZmY7cGFkZGluZy10b3A6NXB4O30nCiAgICAgICAgLCcuaXpoX2Jsb2NrQ2FydCAubGlzdHtkaXNwbGF5OmJsb2NrO21hcmdpbjoycHg7d2lkdGg6MTAwJTtwYWRkaW5nLXJpZ2h0OjVweDt9JwogICAgICAgICwnLml6aF9ibG9ja0NhcnQgLmxpc3QgLnJlbHtib3JkZXItd2lkdGg6MCAycHg7Ym9yZGVyLXN0eWxlOnNvbGlkO2JvcmRlci1jb2xvcjojZmZmO3dpZHRoOjI0cHg7aGVpZ2h0OjE4cHg7fScKICAgICAgICAsJy5pemhfYmxvY2tDYXJ0IC5saXN0LmlfZm8gLnJlbHtib3JkZXItbGVmdC1jb2xvcjojMjU5O2JhY2tncm91bmQtcG9zaXRpb246LTEyMHB4IC0xODRweDt9JwogICAgICAgICwnLml6aF9ibG9ja0NhcnQgLmxpc3QuZm9faSAucmVse2JvcmRlci1yaWdodC1jb2xvcjojMjU5O2JhY2tncm91bmQtcG9zaXRpb246LTEyMHB4IC0xNjRweDt9JwogICAgICAgICwnLml6aF9ibG9ja0NhcnQgLmxpc3QuaV9mby5mb19pIC5yZWx7YmFja2dyb3VuZC1wb3NpdGlvbjotNzhweCAtMjAwcHg7fScKICAgICAgICAsJy5pemhfYmxvY2tDYXJ0IC51c2VyMkJ7ZGlzcGxheTpibG9jazttYXJnaW46MnB4IDA7cGFkZGluZzowIDQwcHggMCA2MHB4O30nCiAgICAgICAgLCcuaXpoX2Jsb2NrQ2FydCAudXNlcjJCIGkuemctaWNvbntkaXNwbGF5OmJsb2NrO3Bvc2l0aW9uOmFic29sdXRlO3JpZ2h0OjA7bWFyZ2luLXRvcDo1cHg7fScKICAgICAgICAsJy5pemhfYmxvY2tDYXJ0IC51c2VyMkIgLm5hbWV7ZGlzcGxheTpibG9jaztjb2xvcjojZmZmO2JhY2tncm91bmQtY29sb3I6IzAwMDt3aGl0ZS1zcGFjZTpub3dyYXA7cGFkZGluZzoycHggNXB4O2JvcmRlci1yYWRpdXM6M3B4O30nCiAgICAgICAgLCcuaXpoX2Jsb2NrQ2FydCAubGlzdCAudXNlcjJCLnVuZm8gLm5hbWV7YmFja2dyb3VuZC1jb2xvcjojZjAwO30nCiAgICAgICAgLCcuaXpoX2Jsb2NrQ2FydCAudXNlcjJCIC5kZWx7ZGlzcGxheTpibG9jaztwb3NpdGlvbjphYnNvbHV0ZTttYXJnaW4tbGVmdDotNC41ZW07fScKICAgICAgICAsJy5pemhfYmxvY2tDYXJ0IC51c2VyMkIgaS5zYXl7ZGlzcGxheTpibG9jaztwb3NpdGlvbjphYnNvbHV0ZTttYXJnaW4tbGVmdDotNDRweDtib3JkZXItcmFkaXVzOjZweCA2cHggMCA2cHg7Ym9yZGVyOjFweCBzb2xpZCAjOTk5O3BhZGRpbmc6MCA1cHggMCAzcHg7fScKICAgICAgICAsJy5pemhfYmxvY2tDYXJ0IC51c2VyMkIgaS5zYXlfMXtkaXNwbGF5OmJsb2NrO3Bvc2l0aW9uOmFic29sdXRlO21hcmdpbi1sZWZ0Oi0xMHB4O2hlaWdodDo2cHg7YmFja2dyb3VuZC1jb2xvcjojZmZmO3dpZHRoOjZweDttYXJnaW4tdG9wOjE3cHg7Ym9yZGVyLWJvdHRvbToxcHggc29saWQgIzk5OTt9JwogICAgICAgICwnLml6aF9ibG9ja0NhcnQgLnVzZXIyQiBpLnNheV8ye2Rpc3BsYXk6YmxvY2s7cG9zaXRpb246YWJzb2x1dGU7bWFyZ2luLWxlZnQ6LTlweDtoZWlnaHQ6NnB4O2JhY2tncm91bmQtY29sb3I6I2ZmZjt3aWR0aDo2cHg7bWFyZ2luLXRvcDoxN3B4O2JvcmRlci1yYWRpdXM6MCAwIDAgNnB4O2JvcmRlcjoxcHggc29saWQgIzk5OTtib3JkZXItd2lkdGg6MCAwIDFweCAxcHh9JwogICAgICAgICwnLml6aC1xdWljay1ibG9ja3twb3NpdGlvbjphYnNvbHV0ZTt0ZXh0LWFsaWduOmNlbnRlcjt3aWR0aDo0ZW07bWFyZ2luLXRvcDoxLjVlbTt3aGl0ZS1zcGFjZTpub3dyYXA7fScKICAgICAgICAsJy5pemgtcXVpY2stYmxvY2sgW2NsYXNzXj1pemgtcXVpY2stYmxvY2tde3Bvc2l0aW9uOmFic29sdXRlO2Rpc3BsYXk6YmxvY2s7d2hpdGUtc3BhY2U6bm93cmFwO30nCiAgICAgICAgLCcuaXpoLXF1aWNrLWJsb2NrOmFmdGVye2NvbnRlbnQ6YXR0cihpemhfbnVtMkIpO21hcmdpbi10b3A6MWVtO2Rpc3BsYXk6YmxvY2s7fScKICAgICAgICAsJy56bS1jb21tZW50LWhkIC5pemgtcXVpY2stYmxvY2stcGVuZHtwb3NpdGlvbjphYnNvbHV0ZTtsZWZ0OjA7dG9wOjQwcHg7fScKICAgICAgICAsJycKICAgICAgICBdLmpvaW4oJ1xuJyk7CiAgICB0aGlzLnVuYmxvY2tBbGwgPSBmdW5jdGlvbigpewogICAgICAgICQoJy5ibG9ja2VkLXVzZXJzID4gLml0ZW0tY2FyZCcpLmVhY2goZnVuY3Rpb24oaSxlKXsKICAgICAgICAgICAgdmFyIHVpZD0kKGUpLmF0dHIoJ2RhdGEtaWQnKTsKICAgICAgICAgICAgJC5wb3N0KCcvc2V0dGluZ3MvdW5ibG9ja3VzZXInLCQucGFyYW0oewogICAgICAgICAgICAgICAgX3hzcmY6JCgnaW5wdXRbbmFtZT1feHNyZl0nKS52YWwoKQogICAgICAgICAgICAgICwgdWlkOnVpZAogICAgICAgICAgICB9KSxmdW5jdGlvbihyKXsKICAgICAgICAgICAgCS8vY29uc29sZS5sb2cocik7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoJICB9OwoJICB0aGlzLmRvVW5mb2xsb3cgPSBmdW5jdGlvbigpewogICAgICAgIHZhciAkZSA9IGlaaGlodS5RdWlja0Jsb2NrLlVzZXJzMkJCUS5zaGlmdCgpCiAgICAgICAgaWYodHlwZW9mICRlID09PSAndW5kZWZpbmVkJykgcmV0dXJuCgogICAgICAgIHZhciB1aWQ9JGUuYXR0cigndWlkJyk7CiAgICAgICAgJC5wb3N0KCcvbm9kZS9NZW1iZXJGb2xsb3dCYXNlVjInCiAgICAgICAgICAsICQucGFyYW0oewogICAgICAgICAgICAgICAgbWV0aG9kOid1bmZvbGxvd19tZW1iZXInCiAgICAgICAgICAgICAgLCBwYXJhbXM6SlNPTi5zdHJpbmdpZnkoeydoYXNoX2lkJzp1aWR9KQogICAgICAgICAgICAgICwgX3hzcmY6JCgnaW5wdXRbbmFtZT1feHNyZl0nKS52YWwoKQogICAgICAgICAgICAgIH0pCiAgICAgICAgICAsIGZ1bmN0aW9uKHIpewogICAgICAgICAgICAgICAgICB2YXIgcXVlcnk9ZGVjb2RlVVJJQ29tcG9uZW50KHRoaXMuZGF0YSkKICAgICAgICAgICAgICAgICAgICAsIHBhcmFtcz11dGlscy5nZXRQYXJhbUluUXVlcnkocXVlcnksJ3BhcmFtcycpCiAgICAgICAgICAgICAgICAgIDsKICAgICAgICAgICAgICAgICAgZXZhbCgncGFyYW1zPScrcGFyYW1zKTsKICAgICAgICAgICAgICAgICAgdmFyIGJpZD0nZmItJytwYXJhbXMuaGFzaF9pZAogICAgICAgICAgICAgICAgICAgICwgd2hvPWJpZCsnLCcKICAgICAgICAgICAgICAgICAgICAsIHVuZm9sbG93ZWQ9aVpoaWh1LlF1aWNrQmxvY2suVW5mb2xsb3dlZAogICAgICAgICAgICAgICAgICAgICwgcmVmb2xsb3dlZD1pWmhpaHUuUXVpY2tCbG9jay5SZWZvbGxvd2VkCiAgICAgICAgICAgICAgICAgICAgLCAkY2FydERJVj0kKCcjaXpoX2Jsb2NrQ2FydCcpCiAgICAgICAgICAgICAgICAgICAgLCAkdXNlcj0kY2FydERJVi5maW5kKCcudXNlcjJCW3VpZD0nK3BhcmFtcy5oYXNoX2lkKyddJykKICAgICAgICAgICAgICAgICAgICAsICRsaXN0PSR1c2VyLmNsb3Nlc3QoJy5saXN0JykKICAgICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgICAkdXNlci5wcmVwZW5kVG8oJGxpc3QubmV4dCgpLm5leHQoKSk7CiAgICAgICAgICAgICAgICAgIGlmKHVuZm9sbG93ZWQuVXNlcnMuaW5kZXhPZignLCcrd2hvKTwwKQogICAgICAgICAgICAgICAgICAgICAgdW5mb2xsb3dlZC5Vc2VycyArPSB3aG87CiAgICAgICAgICAgICAgICAgIGlmKHJlZm9sbG93ZWQuVXNlcnMuaW5kZXhPZignLCcrd2hvKT49MCkKICAgICAgICAgICAgICAgICAgICAgIHJlZm9sbG93ZWQuVXNlcnMgPSByZWZvbGxvd2VkLnJlcGxhY2UoJywnK3dobywnLCcpOwogICAgICAgICAgICB9CiAgICAgICAgKS5hbHdheXMoZnVuY3Rpb24oZGF0YSwgdGV4dFN0YXR1cywganFYSFIpewogICAgICAgICAgICBpWmhpaHUuUXVpY2tCbG9jay5kb1VuZm9sbG93KCkKICAgICAgICB9KTsKCSAgfTsKICAgIHRoaXMuZG9RdWlja0Jsb2NrID0gZnVuY3Rpb24oKXsKICAgICAgICB2YXIgJGUgPSBpWmhpaHUuUXVpY2tCbG9jay5Vc2VyczJCQlEuc2hpZnQoKQogICAgICAgIGlmKHR5cGVvZiAkZSA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybgoKICAgICAgICB2YXIgYmxvY2tpbmcgPSBpWmhpaHUuUXVpY2tCbG9jay5CbG9ja2luZwogICAgICAgICAgLCBocmVmID0gJGUuYXR0cignaHJlZicpCiAgICAgICAgICAsIHdobyA9IGhyZWYuc3BsaXQoJy8nKS5wb3AoKSsnLCcKICAgICAgICA7CiAgICAgICAgaWYodHlwZW9mIGJsb2NraW5nID09PSAndW5kZWZpbmVkJyB8fCAhYmxvY2tpbmcpewogICAgICAgICAgICBibG9ja2luZyA9IGlaaGlodS5RdWlja0Jsb2NrLkJsb2NraW5nID0geyBVc2VyczonLCcsIENvdW50OjAgfTsKICAgICAgICB9ZWxzZSBpZihibG9ja2luZy5Vc2Vycy5pbmRleE9mKCcsJyt3aG8pID49IDApewogICAgICAgICAgICByZXR1cm47IC8vIEFscmVhZHkgYmxvY2tpbmcKICAgICAgICB9CiAgICAgICAgdmFyICRjYXJ0RElWPSQoJyNpemhfYmxvY2tDYXJ0Jyk7CiAgICAgICAgJGNhcnRESVYuYWRkQ2xhc3MoJ2Jsb2NraW5nJyk7CiAgICAgICAgYmxvY2tpbmcuVXNlcnMgKz0gd2hvOwogICAgICAgIGJsb2NraW5nLkNvdW50ICsrOwogICAgICAgICQucG9zdChocmVmKycvYmxvY2snLCQucGFyYW0oewogICAgICAgICAgICBhY3Rpb246J2FkZCcKICAgICAgICAgICwgX3hzcmY6JCgnaW5wdXRbbmFtZT1feHNyZl0nKS52YWwoKSAKICAgICAgICB9KSxmdW5jdGlvbihyKXsKICAgICAgICAgICAgdmFyIGhyZWY9dGhpcy51cmwucmVwbGFjZSgnL2Jsb2NrJywnJykKICAgICAgICAgICAgICAsIHVzZXJJRD1ocmVmLnNwbGl0KCcvJykucG9wKCkKICAgICAgICAgICAgICAsIHdobz0nLCcrdXNlcklEKycsJwogICAgICAgICAgICAgICwgYmxvY2tpbmc9aVpoaWh1LlF1aWNrQmxvY2suQmxvY2tpbmcKICAgICAgICAgICAgOwoKICAgICAgICAgICAgaWYoMD09LS1ibG9ja2luZy5Db3VudCkkY2FydERJVi5yZW1vdmVDbGFzcygncGVuZGluZycpOwogICAgCiAgICAgICAgICAgIGlmKGJsb2NraW5nLlVzZXJzLmluZGV4T2Yod2hvKSA8IDApCiAgICAgICAgICAgICAgICByZXR1cm47IC8vIE5vIHRoaXMgdXNlciBpbiBwZW5kaW5nCiAgICAgICAgICAgICAgCiAgICAgICAgICAgIGJsb2NraW5nLlVzZXJzID0gYmxvY2tpbmcuVXNlcnMucmVwbGFjZSh3aG8sJywnKTsKICAgICAgICAgICAgJCgnI2l6aF9ibG9ja0NhcnQgLnVzZXIyQltocmVmPSInK2hyZWYrJyJdJykuZmluZCgnLmRlbCcpWzBdLmNsaWNrKCk7CiAgICAgICAgICAgICQoJ2FbaHJlZiQ9IicraHJlZisnIl0nKS5jc3MoJ3RleHQtZGVjb3JhdGlvbicsJ2xpbmUtdGhyb3VnaCcpOwogICAgICAgIH0pLmFsd2F5cyhmdW5jdGlvbihkYXRhLCB0ZXh0U3RhdHVzLCBqcVhIUil7CiAgICAgICAgICAgIGlaaGlodS5RdWlja0Jsb2NrLmRvUXVpY2tCbG9jaygpCiAgICAgICAgfSk7CiAgCX07CiAgICB0aGlzLnJlc2l6ZUJsb2NrQ2FydCA9IGZ1bmN0aW9uKCRjYXJ0RElWKXsKICAgICAgICBmdW5jdGlvbiBwYXJzZUNzc1B4KCRpdGVtLCBuYW1lKSB7CiAgICAgICAgICAgIHZhciBtID0gJGl0ZW0uY3NzKG5hbWUpOwogICAgICAgICAgICBpZiAobSAhPSAndW5kZWZpbmVkJykgewogICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlSW50KG0ucmVwbGFjZSgncHgnLCcnKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIHZhciAkdXNlckRJViA9ICRjYXJ0RElWLmZpbmQoJy5saXN0IC51c2VyMkInKTsKICAgICAgICB2YXIgJHRpdGxlQm94ID0gJCgnI2l6aF9ibG9ja0NhcnQgLmRvJyk7CiAgICAgICAgdmFyIGggPSBwYXJzZUNzc1B4KCRjYXJ0RElWLmZpbmQoJ2Rpdi5mcmFtZScpLCdwYWRkaW5nVG9wJykgCiAgICAgICAgICAgICAgICArICgkdXNlckRJVi5oZWlnaHQoKSArIHBhcnNlQ3NzUHgoJHVzZXJESVYsJ21hcmdpblRvcCcpKSAqICR1c2VyRElWLmxlbmd0aCAKICAgICAgICAgICAgICAgICsgJHRpdGxlQm94LmhlaWdodCgpCiAgICAgICAgICAgICAgICArIHBhcnNlQ3NzUHgoJHRpdGxlQm94LCAnbWFyZ2luVG9wJykKICAgICAgICAgICAgICAgICsgcGFyc2VDc3NQeCgkdGl0bGVCb3gsICdtYXJnaW5Cb3R0b20nKTsKICAgICAgICAKICAgICAgICBpZihoK2laaGlodS4kbWFpbi5vZmZzZXQoKS50b3A8aVpoaWh1LiR3aW4uaGVpZ2h0KCkpewogICAgICAgICAgICAkY2FydERJVi5jc3MoeydoZWlnaHQnOmgsJ2JvdHRvbSc6Jyd9KTsKICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgJGNhcnRESVYuY3NzKHsnaGVpZ2h0JzonJywnYm90dG9tJzowfSk7CiAgICAgICAgfQogICAgfTsKICAgIHRoaXMuZ2V0Q2FydERJVj1mdW5jdGlvbigpewogICAgICAgIHZhciAkY2FydERJVj0kKCcjaXpoX2Jsb2NrQ2FydCcpOwogICAgICAgIGlmKCEkY2FydERJVi5sZW5ndGgpewogICAgICAgICAgICAkY2FydERJVj0kKCc8ZGl2PicsIHsgaWQ6ICdpemhfYmxvY2tDYXJ0JywgJ2NsYXNzJzogJ2l6aF9ibG9ja0NhcnQnIH0pLmNzcyh7CiAgICAgICAgICAgICAgICAndG9wJzppWmhpaHUuJG1haW4ub2Zmc2V0KCkudG9wCiAgICAgICAgICAgIH0pLmFwcGVuZCgKICAgICAgICAgICAgICAgICQoJzxkaXY+Jyx7CiAgICAgICAgICAgICAgICAgICAgJ2NsYXNzJzonZG8nCiAgICAgICAgICAgICAgICAgICwgJ2l6aF9udW0yQic6MAogICAgICAgICAgICAgICAgICAsICd0aXRsZSc6J+S4i+S4uuOAjOWAmeWuoeOAjeWIl+ihqFxu54K55Ye75bem5LiK6KeS5Y+v5pS26LW3L+WxleW8gFxu5pWw5a2X5Li65Lq654qv5oC75pWw77yI57qi6Imy6KGo56S65LuN5pyJ5Lq654qv5q2j5b6F5YWl5YiX77yJJwogICAgICAgICAgICAgICAgfSkuYXBwZW5kKAogICAgICAgICAgICAgICAgICAgICQoJzxhPicsewogICAgICAgICAgICAgICAgICAgICAgICAnY2xhc3MnOididXR0b24gZGVsQWxsJwogICAgICAgICAgICAgICAgICAgICAgLCBocmVmOidqYXZhc2NyaXB0OnZvaWQoMCk7JwogICAgICAgICAgICAgICAgICAgICAgLCB0aXRsZTon5riF56m644CM5YCZ5a6h44CN5YiX6KGoJwogICAgICAgICAgICAgICAgICAgICAgLCBjbGljazpmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkY2FydERJVj0kKCcjaXpoX2Jsb2NrQ2FydCcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICRjYXJ0RElWLmNzcygnYm90dG9tJywnJykuZmluZCgnLmxpc3QnKS5lbXB0eSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcy5wYXJlbnROb2RlKS5hdHRyKCdpemhfbnVtMkInLCcwJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgJGNhcnRESVYuY3NzKCdoZWlnaHQnLCcnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pLnRleHQoJ+Wkp+i1picpLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICdkaXNwbGF5JzonYmxvY2snCiAgICAgICAgICAgICAgICAgICAgICAsICdwb3NpdGlvbic6J2Fic29sdXRlJwogICAgICAgICAgICAgICAgICAgICAgLCAnbGVmdCc6MjQKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgKS5hcHBlbmQoCiAgICAgICAgICAgICAgICAgICAgJCgnPGlucHV0PicsewogICAgICAgICAgICAgICAgICAgICAgICAnY2xhc3MnOid1bmZvJwogICAgICAgICAgICAgICAgICAgICAgLCBocmVmOidqYXZhc2NyaXB0OnZvaWQoMCk7JwogICAgICAgICAgICAgICAgICAgICAgLCB0eXBlOidjaGVja2JveCcKICAgICAgICAgICAgICAgICAgICAgICwgdGl0bGU6J+mAieS4reWQju+8jOWwhuaIkeWFs+azqOS5i+S6uuagh+WHuu+8jOaUueS7peaUvumAkO+8iOWPlua2iOWFs+azqO+8ieiuuuWkhCcKICAgICAgICAgICAgICAgICAgICAgICwgY2xpY2s6ZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGNhcnRESVY9JCh0aGlzLnBhcmVudE5vZGUucGFyZW50Tm9kZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgJHVzZXJzPSQoJy5mcmFtZSAubGlzdC5pX2ZvIC51c2VyMkInLCRjYXJ0RElWKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLCAkYWN0aW9uPSQoJy5hY3Rpb24nLHRoaXMucGFyZW50Tm9kZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5jaGVja2VkKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHVzZXJzLmFkZENsYXNzKCd1bmZvJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb24udGV4dCgn5pS+6YCQJykuY3NzKCdwYWRkaW5nJywnMCAyZW0gMCAwJykuYXR0cigndGl0bGUnLCflr7nliJfooajlhoXmiJHlhbPms6jkuYvkurrlj5bmtojlhbPms6gnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHVzZXJzLnJlbW92ZUNsYXNzKCd1bmZvJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb24udGV4dCgn5pS255uRJykuY3NzKCdwYWRkaW5nJywnMCAwIDAgMmVtJykuYXR0cigndGl0bGUnLCflsIbkuIvliJfkurrniq/pgJDkuIDliqDlhaXpu5HlkI3ljZUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkuY3NzKHsKICAgICAgICAgICAgICAgICAgICAgICAgJ2Rpc3BsYXknOidibG9jaycKICAgICAgICAgICAgICAgICAgICAgICwgJ2Zsb2F0JzonbGVmdCcKICAgICAgICAgICAgICAgICAgICAgICwgJ2hlaWdodCc6MjIKICAgICAgICAgICAgICAgICAgICAgICwgJ2xpbmUtaGVpZ2h0JzoyMgogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICApLmFwcGVuZCgKICAgICAgICAgICAgICAgICAgICAkKCc8c3Bhbj4nLHsKICAgICAgICAgICAgICAgICAgICAgICAgJ2NsYXNzJzonJwogICAgICAgICAgICAgICAgICAgICAgLCBocmVmOidqYXZhc2NyaXB0OnZvaWQoMCk7JwogICAgICAgICAgICAgICAgICAgICAgLCB0aXRsZTon6YCJ5Lit5ZCO77yM5bCG5oiR5YWz5rOo55qE5Lq65qCH5Ye677yM5YeG5aSH44CM5Y+W5raI5YWz5rOo44CNJwogICAgICAgICAgICAgICAgICAgIH0pLnRleHQoJ+S7jui9uycpLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICdkaXNwbGF5JzonYmxvY2snCiAgICAgICAgICAgICAgICAgICAgICAsICdmbG9hdCc6J2xlZnQnCiAgICAgICAgICAgICAgICAgICAgICAsICdtYXJnaW4tcmlnaHQnOjIwCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICkuYXBwZW5kKAogICAgICAgICAgICAgICAgICAgICQoJzxhPicsewogICAgICAgICAgICAgICAgICAgICAgICAnY2xhc3MnOididXR0b24gYWN0aW9uJwogICAgICAgICAgICAgICAgICAgICAgLCBocmVmOidqYXZhc2NyaXB0OnZvaWQoMCk7JwogICAgICAgICAgICAgICAgICAgICAgLCB0aXRsZTon5bCG5LiL5YiX5Lq654qv6YCQ5LiA5Yqg5YWl6buR5ZCN5Y2VJwogICAgICAgICAgICAgICAgICAgICAgLCBjbGljazpmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRjYXJ0RElWPSQodGhpcy5wYXJlbnROb2RlLnBhcmVudE5vZGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJCgnLnVuZm8nLHRoaXMucGFyZW50Tm9kZSkuaXMoJzpjaGVja2VkJykpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJy5saXN0LmlfZm8gLnVzZXIyQicsJGNhcnRESVYpLmVhY2goZnVuY3Rpb24oaSxlKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaVpoaWh1LlF1aWNrQmxvY2suVXNlcnMyQkJRLnB1c2goJChlKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpWmhpaHUuUXVpY2tCbG9jay5kb1VuZm9sbG93KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcubGlzdCAudXNlcjJCJywkY2FydERJVikuZWFjaChmdW5jdGlvbihpLGUpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpWmhpaHUuUXVpY2tCbG9jay5Vc2VyczJCQlEucHVzaCgkKGUpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlaaGlodS5RdWlja0Jsb2NrLmRvUXVpY2tCbG9jaygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkudGV4dCgn5pS255uRJykuY3NzKHsKICAgICAgICAgICAgICAgICAgICAgICAgJ2Rpc3BsYXknOidibG9jaycKICAgICAgICAgICAgICAgICAgICAgICwgJ2Zsb2F0JzoncmlnaHQnCiAgICAgICAgICAgICAgICAgICAgICAsICdtYXJnaW4tbGVmdCc6MjAKICAgICAgICAgICAgICAgICAgICAgICwgJ21hcmdpbi1yaWdodCc6LTEwCiAgICAgICAgICAgICAgICAgICAgICAsICdwYWRkaW5nJzonMCAwIDAgMmVtJwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICApLmFwcGVuZCgKICAgICAgICAgICAgICAgICAgICAkKCc8YT4nLHsKICAgICAgICAgICAgICAgICAgICAgICAgJ2NsYXNzJzonemctaWNvbiB6Zy1pY29uLWRvdWJsZS1hcnJvdycKICAgICAgICAgICAgICAgICAgICAgICwgaHJlZjonamF2YXNjcmlwdDp2b2lkKDApOycKICAgICAgICAgICAgICAgICAgICAgICwgY2xpY2s6ZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGNhcnRESVY9JCgnI2l6aF9ibG9ja0NhcnQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkY2FydERJVi5hdHRyKCdtaW5pJykhPScxJyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjYXJ0RElWLmZpbmQoJy5mcmFtZScpLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNhcnRESVYuY3NzKHsnaGVpZ2h0JzonJywnYm90dG9tJzonJ30pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY2FydERJVi5hdHRyKCdtaW5pJywnMScpOwogICAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY2FydERJVi5maW5kKCcuZnJhbWUnKS5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlaaGlodS5RdWlja0Jsb2NrLnJlc2l6ZUJsb2NrQ2FydCgkY2FydERJVik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjYXJ0RElWLmF0dHIoJ21pbmknLCcwJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICdwb3NpdGlvbic6J2Fic29sdXRlJwogICAgICAgICAgICAgICAgICAgICAgLCAnbGVmdCc6MAogICAgICAgICAgICAgICAgICAgICAgLCAndG9wJzo1CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgKS5hcHBlbmQoCiAgICAgICAgICAgICAgICAkKCc8ZGl2PicseydjbGFzcyc6J2ZyYW1lJ30KICAgICAgICAgICAgICAgICkuYXBwZW5kKAogICAgICAgICAgICAgICAgICAgICQoJzxkaXY+Jyx7CiAgICAgICAgICAgICAgICAgICAgICAgICdjbGFzcyc6J2xpc3QgaV9mbyBmb19pJwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICApLmFwcGVuZCgKICAgICAgICAgICAgICAgICAgICAkKCc8ZGl2PicsewogICAgICAgICAgICAgICAgICAgICAgICAnY2xhc3MnOidsaXN0IGlfZm8nCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICkuYXBwZW5kKAogICAgICAgICAgICAgICAgICAgICQoJzxkaXY+Jyx7CiAgICAgICAgICAgICAgICAgICAgICAgICdjbGFzcyc6J2xpc3QgZm9faScKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgKS5hcHBlbmQoCiAgICAgICAgICAgICAgICAgICAgJCgnPGRpdj4nLHsKICAgICAgICAgICAgICAgICAgICAgICAgJ2NsYXNzJzonbGlzdCcKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICApLmFwcGVuZFRvKGlaaGlodS4kYm9keSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJGNhcnRESVYKICAgIH0KICAgIHRoaXMuaW4yQmxvY2tDYXJ0ID0gZnVuY3Rpb24odXJsLHJldHJpZWRDb3VudCl7CiAgICAgICAgdmFyICRlID0gaVpoaWh1LlF1aWNrQmxvY2suVXNlcnMyQi5zaGlmdCgpIHx8IG51bGwKICAgICAgICAgICwgJGNhcnRESVYgPSBpWmhpaHUuUXVpY2tCbG9jay5nZXRDYXJ0RElWKCkKCiAgICAgICAgJGNhcnRESVYuYWRkQ2xhc3MoJ3BlbmRpbmcnKTsKICAgICAgICBpZih0eXBlb2YgcmV0cmllZENvdW50ID09ICd1bmRlZmluZWQnKQogICAgICAgICAgICByZXRyaWVkQ291bnQgPSAwCgogICAgICAgIC8vY29uc29sZS5sb2cocmV0cmllZENvdW50KQogICAgICAgIGlmICghJGUgfHwgJGUubGVuZ3RoID09PSAwKXsKICAgICAgICAgICAgaWYoKHVybHx8JycpPT0nJyl7CiAgICAgICAgICAgICAgICAkY2FydERJVi5yZW1vdmVDbGFzcygncGVuZGluZycpCiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgJC5hamF4KFsnJyx1cmxdLmpvaW4oJycpLHsKICAgICAgICAgICAgICAgICAgICB0eXBlOidHRVQnCiAgICAgICAgICAgICAgICAgICwgbWF4UmV0cnlDb3VudDogMwogICAgICAgICAgICAgICAgfSkuZG9uZShmdW5jdGlvbihkYXRhLCB0ZXh0U3RhdHVzLCBqcVhIUil7CiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGRhdGEucGF5bG9hZCxmdW5jdGlvbihpLGUpewogICAgICAgICAgICAgICAgICAgICAgICBpWmhpaHUuUXVpY2tCbG9jay5hZGRVc2VyMkIoZSkKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIGlaaGlodS5RdWlja0Jsb2NrLmluMkJsb2NrQ2FydChkYXRhLnBhZ2luZy5uZXh0KQogICAgICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbihkYXRhLHRleHRTdGF0dXMsalhIUil7CiAgICAgICAgICAgICAgICAgICAgaWYgKCsrcmV0cmllZENvdW50IDwgdGhpcy5tYXhSZXRyeUNvdW50KXsKICAgICAgICAgICAgICAgICAgICAgICAgaVpoaWh1LlF1aWNrQmxvY2suaW4yQmxvY2tDYXJ0KHVybCxyZXRyaWVkQ291bnQpCiAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgICRjYXJ0RElWLnJlbW92ZUNsYXNzKCdwZW5kaW5nJykKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybgogICAgICAgIH0KCiAgICAgICAgdmFyIGhyZWYgPSAkZS5hdHRyKCdocmVmJykKICAgICAgICAgICwgdXNlcm5hbWUgPSBocmVmLnNwbGl0KCcvJykucG9wKCkKICAgICAgICAgICwgd2hvID0gdXNlcm5hbWUrJywnCiAgICAgICAgOwoKICAgICAgICBpZigkY2FydERJVi5maW5kKCcudXNlcjJCW2hyZWY9IicraHJlZisnIl0nKS5sZW5ndGgpewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAkLmFqYXgoJy9ub2RlL01lbWJlclByb2ZpbGVDYXJkVjI/JyskLnBhcmFtKHtwYXJhbXM6SlNPTi5zdHJpbmdpZnkoeyd1cmxfdG9rZW4nOnVzZXJuYW1lfSl9KSwgewogICAgICAgICAgICB0eXBlOiAnR0VUJwogICAgICAgICAgLCB1c2VyMkI6ICRlCiAgICAgICAgICAsIG1heFJldHJ5Q291bnQ6IDMKICAgICAgICB9KS5kb25lKGZ1bmN0aW9uKGRhdGEsIHRleHRTdGF0dXMsIGpxWEhSKXsKICAgICAgICAgICAgaVpoaWh1LlF1aWNrQmxvY2suYWRkVXNlcjJCKGRhdGEpCiAgICAgICAgICAgIGlaaGlodS5RdWlja0Jsb2NrLmluMkJsb2NrQ2FydCh1cmwpCiAgICAgICAgfSkuZmFpbChmdW5jdGlvbihkYXRhLHRleHRTdGF0dXMsalhIUil7CiAgICAgICAgICAgIGlmICgrK3JldHJpZWRDb3VudCA8IHRoaXMubWF4UmV0cnlDb3VudCl7CiAgICAgICAgICAgICAgICBpWmhpaHUuUXVpY2tCbG9jay5Vc2VyczJCLnVuc2hpZnQodGhpcy51c2VyMkIpCiAgICAgICAgICAgICAgICBpWmhpaHUuUXVpY2tCbG9jay5pbjJCbG9ja0NhcnQodXJsLHJldHJpZWRDb3VudCkKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIH0KICAgICAgICB9KS5hbHdheXMoZnVuY3Rpb24oZGF0YSx0ZXh0U3RhdHVzLGpYSFIpewogICAgICAgICAgICAkKCcjaXpoX2Jsb2NrQ2FydCcpLnJlbW92ZUNsYXNzKCdwZW5kaW5nJyk7CiAgICAgICAgfSk7CiAgICB9OwogICAgdGhpcy5hZGRVc2VyMkI9ZnVuY3Rpb24oZGF0YSl7CiAgICAgICAgaWYgKGRhdGEgPT09ICcnKSByZXR1cm4KICAgICAgICB2YXIgJGh0bWw9JChkYXRhLnJlcGxhY2UodXRpbHMuUmVnZXhTcmNQaWMsICcnKSkKICAgICAgICAgICwgaXNaSFBDPSRodG1sLmlzKCcuemgtcHJvZmlsZS1jYXJkJykKICAgICAgICAgICwgJGF2YXRhckxpbms9aXNaSFBDPyRodG1sLmZpbmQoJy5hdmF0YXItbGluazpmaXJzdCcpOiRodG1sLmZpbmQoJy56bS1pdGVtLWxpbmstYXZhdGFyOmZpcnN0JykKICAgICAgICAgICwgaHJlZj0kYXZhdGFyTGluay5hdHRyKCdocmVmJykKICAgICAgICBpZigoaHJlZnx8JycpPT0nJylyZXR1cm4KCiAgICAgICAgdmFyIHVzZXJJRD1ocmVmLnN1YnN0cig4KQogICAgICAgICAgLCB1c2VyTmFtZT1pc1pIUEM/JGF2YXRhckxpbmsudGV4dCgpOiRhdmF0YXJMaW5rLmF0dHIoJ3RpdGxlJykKICAgICAgICAgICwgJGJ0bkZvbGxvdz0kaHRtbC5maW5kKCdidXR0b25bZGF0YS1mb2xsb3ddJykKICAgICAgICAgICwgaGFzaElEPSEkYnRuRm9sbG93Lmxlbmd0aD8nJzokYnRuRm9sbG93LmF0dHIoJ2RhdGEtaWQnKQogICAgICAgICAgLCBmXz0kYnRuRm9sbG93Lmxlbmd0aCYmJGJ0bkZvbGxvdy5pcygnLnpnLWJ0bi11bmZvbGxvdycpCiAgICAgICAgICAsIF9mPSRidG5Gb2xsb3cubGVuZ3RoJiYkYnRuRm9sbG93LmlzKCdbZGF0YS1mb2xsb3dtZT0xXScpCiAgICAgICAgICAsIGNzc0Y9X2Z8fGZfPyd6Zy1pY29uIHJlbCAnOicnCiAgICAgICAgICAsICRjYXJ0RElWPWlaaGlodS5RdWlja0Jsb2NrLmdldENhcnRESVYoKQogICAgICAgICAgLCAkY2FydD0kY2FydERJVi5maW5kKCcubGlzdCcpCiAgICAgICAgICAsIHdobz0nLCcrdXNlcklEKycsJwogICAgICAgIDsKCiAgICAgICAgaWYoaGFzaElEPT0nJyl7CiAgICAgICAgICAgIHJldHVybjsgLy8gVXNlciBibG9ja2VkIG9yIHlvdSBibG9ja2VkCiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmKCRjYXJ0RElWLmZpbmQoJy5saXN0IC51c2VyMkJbaHJlZj0iJytocmVmKyciXScpLmxlbmd0aCl7CiAgICAgICAgICAgIHJldHVybjsgLy8gVXNlciBhbHJlYWR5IGluIGJsb2NrIGxpc3QKICAgICAgICB9CgogICAgICAgIHZhciAkdXNlcjJCPSQoJzxkaXY+Jyx7CiAgICAgICAgICAgICAgICAnY2xhc3MnOid1c2VyMkInKyhmXyYmJGNhcnRESVYuZmluZCgnLmRvIC51bmZvOmNoZWNrZWQnKS5sZW5ndGg/JyB1bmZvJzonJykKICAgICAgICAgICAgICAsICdocmVmJzpocmVmCiAgICAgICAgICAgICAgLCAndWlkJzpoYXNoSUQKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmFwcGVuZCgKICAgICAgICAgICAgICAgICQoJzxhPicsewogICAgICAgICAgICAgICAgICAgICdjbGFzcyc6J2J1dHRvbiBkZWwnCiAgICAgICAgICAgICAgICAgICwgaHJlZjonamF2YXNjcmlwdDp2b2lkKDApOycKICAgICAgICAgICAgICAgICAgLCBjbGljazpmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgJHVzZXI9JCh0aGlzKS5jbG9zZXN0KCcudXNlcjJCJykKICAgICAgICAgICAgICAgICAgICAgICAgICAsICRjYXJ0RElWPSQoJyNpemhfYmxvY2tDYXJ0JykKICAgICAgICAgICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgICAgICAgICAkdXNlci5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG51bTJCPSRjYXJ0RElWLmZpbmQoJy5saXN0IC51c2VyMkInKS5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgICRjYXJ0RElWLmNoaWxkcmVuKCcuZG8nKS5hdHRyKCdpemhfbnVtMkInLG51bTJCPT0wPycwJzpudW0yQj45OTk/JzFrKyc6bnVtMkIpOwogICAgICAgICAgICAgICAgICAgICAgICBpZihudW0yQikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlaaGlodS5RdWlja0Jsb2NrLnJlc2l6ZUJsb2NrQ2FydCgkY2FydERJVik7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjYXJ0RElWLmNzcygnaGVpZ2h0JywnJyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkudGV4dCgn6LWmJykKICAgICAgICAgICAgKS5hcHBlbmQoCiAgICAgICAgICAgICAgICAkKCc8aT4nLHsKICAgICAgICAgICAgICAgICAgICAnY2xhc3MnOidzYXknCiAgICAgICAgICAgICAgICAgICwgJ2RhdGEtdGlwJzoncCR0JCcrdXNlcklECiAgICAgICAgICAgICAgICB9KS50ZXh0KCflhqTmnoknKQogICAgICAgICAgICApLmFwcGVuZCgkKCc8aT4nLHsnY2xhc3MnOidzYXlfMSd9KQogICAgICAgICAgICApLmFwcGVuZCgkKCc8aT4nLHsnY2xhc3MnOidzYXlfMid9KQogICAgICAgICAgICApLmFwcGVuZCgkKCc8aT4nLHsnY2xhc3MnOmNzc0Z9KQogICAgICAgICAgICApLmFwcGVuZCgKICAgICAgICAgICAgICAgICQoJzxhPicsewogICAgICAgICAgICAgICAgICAgICdjbGFzcyc6J25hbWUnCiAgICAgICAgICAgICAgICAgICwgaHJlZjpocmVmCiAgICAgICAgICAgICAgICAgICwgdGFyZ2V0OidfYmxhbmsnCiAgICAgICAgICAgICAgICB9KS50ZXh0KHVzZXJOYW1lKQogICAgICAgICAgICApLnNob3coKQogICAgICAgIDsKICAgICAgICBpZihmXyYmX2YpewogICAgICAgICAgICAkY2FydC5lcSgwKS5hcHBlbmQoJHVzZXIyQik7CiAgICAgICAgfWVsc2UgaWYoZl8pewogICAgICAgICAgICAkY2FydC5lcSgxKS5hcHBlbmQoJHVzZXIyQik7CiAgICAgICAgfWVsc2UgaWYoX2YpewogICAgICAgICAgICAkY2FydC5lcSgyKS5hcHBlbmQoJHVzZXIyQik7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICRjYXJ0LmVxKDMpLmFwcGVuZCgkdXNlcjJCKTsKICAgICAgICB9CiAgICAgICAgdmFyIG51bTJCPSRjYXJ0RElWLmZpbmQoJy5saXN0IC51c2VyMkInKS5sZW5ndGg7CiAgICAgICAgJGNhcnRESVYuY2hpbGRyZW4oJy5kbycpLmF0dHIoJ2l6aF9udW0yQicsbnVtMkI9PTA/JzAnOm51bTJCPjk5OTk/JzEwaysnOm51bTJCKTsKICAgICAgICBpWmhpaHUuUXVpY2tCbG9jay5yZXNpemVCbG9ja0NhcnQoJGNhcnRESVYpOwogICAgfQogICAgdGhpcy5hZGRRdWlja0Jsb2NrID0gZnVuY3Rpb24oJGEpewogICAgICAgIHZhciAkdm90ZUluZm89JCgnLnptLWl0ZW0tdm90ZS1pbmZvJywkYSkKICAgICAgICBpZigkdm90ZUluZm8ubGVuZ3RoKXsKICAgICAgICAgICAgdmFyICR2b3RlcnM9JHZvdGVJbmZvLmNoaWxkcmVuKCcudm90ZXJzJykKICAgICAgICAgICAgaWYoJHZvdGVycy5sZW5ndGgpewogICAgICAgICAgICAgICAgdmFyIHM9WyfvvIwnLCR2b3RlSW5mby5hdHRyKCdkYXRhLXZvdGVjb3VudCcpLCfkuKrkuZ/kuI3og73lv43vvIzmnpzmlq3mkpUnXS5qb2luKCcnKQogICAgICAgICAgICAgICAgICAsIGFpZD0kYS5hdHRyKCdkYXRhLWFpZCcpfHwkYS5jaGlsZHJlbignW2l0ZW1wcm9wPSJaUmVhY3RvciJdJykuYXR0cignZGF0YS1pZCcpCiAgICAgICAgICAgICAgICAgICwgdXJsPVsnLycsJGEuYXR0cignZGF0YS10eXBlJyk9PSdwJz8ncG9zdCc6J2Fuc3dlcicsJy8nLGFpZCwnL3ZvdGVyc19wcm9maWxlJ10uam9pbignJykKICAgICAgICAgICAgICAgICQoJzxhPicse2hyZWY6J2phdmFzY3JpcHQ6OycsJ2NsYXNzJzondGV4dCd9KS50ZXh0KHMpLmJpbmQoJ2NsaWNrJyxmdW5jdGlvbihldmVudCl7CiAgICAgICAgICAgICAgICAgICAgdmFyICR0PSRhLmZpbmQoJy5hdXRob3ItaW5mbyA+IGEubmFtZSwuem0taXRlbS1hbnN3ZXItYXV0aG9yLWluZm8gPiBhLmF1dGhvci1saW5rJykKICAgICAgICAgICAgICAgICAgICBpZigkdCYmJHQubGVuZ3RoKXsKICAgICAgICAgICAgICAgICAgICAgICAgaVpoaWh1LlF1aWNrQmxvY2suVXNlcnMyQi5wdXNoKCR0KQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpWmhpaHUuUXVpY2tCbG9jay5pbjJCbG9ja0NhcnQodXJsKQogICAgICAgICAgICAgICAgfSkuYXBwZW5kVG8oJHZvdGVJbmZvKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHRoaXMuYWRkUXVpY2tCbG9ja0luT25lQ29tbWVudCA9IGZ1bmN0aW9uKCRjbUl0ZW0pewogICAgICAgIHZhciAkd2hlcmU9JCgnLnptLWNvbW1lbnQtaGQnLCRjbUl0ZW0pOwogICAgICAgIGlmKCR3aGVyZS5maW5kKCcuaXpoLXF1aWNrLWJsb2NrLXBlbmQnKS5sZW5ndGgpcmV0dXJuOwogICAgICAgICQoJzxhPicsewogICAgICAgICAgICAnY2xhc3MnOidpemgtcXVpY2stYmxvY2stcGVuZCBpemgtYnV0dG9uJwogICAgICAgICAgLCBocmVmOidqYXZhc2NyaXB0OnZvaWQoMCk7JwogICAgICAgICAgLCAnZGF0YS10aXAnOidzJGwk5bCG5q2k5Lq65YiX5YWl5YCZ5a6h5ZCN5Y2V5Lul5b6F5pS255uRJwogICAgICAgIH0pLnRleHQoJ+WAmeWuoScpLmNsaWNrKGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHZhciAkZSA9ICQodGhpcykubmV4dCgpCiAgICAgICAgICAgIGlaaGlodS5RdWlja0Jsb2NrLlVzZXJzMkIucHVzaCgkZSkKICAgICAgICAgICAgaVpoaWh1LlF1aWNrQmxvY2suaW4yQmxvY2tDYXJ0KCk7CiAgICAgICAgfSkucHJlcGVuZFRvKCR3aGVyZSkuaGlkZSgpOwogICAgfTsKICAgIHRoaXMuYWRkUXVpY2tCbG9ja0luQ29tbWVudExpc3QgPSBmdW5jdGlvbigkd2hlcmUpewogICAgICAgIC8vIFJlZ2lvbjog5b+r6YCf5bGP6JS9CiAgICAgICAgdmFyICRjbT0kd2hlcmUuaXMoJy56bS1jb21tZW50LWJveCcpPyR3aGVyZTokd2hlcmUuY2xvc2VzdCgnLnptLWNvbW1lbnQtYm94JykKICAgICAgICAgICwgJHU9JCgnLnptLWl0ZW0tY29tbWVudCcsJGNtKQogICAgICAgIDsKICAgICAgICAkdS5lYWNoKGZ1bmN0aW9uKGksZSl7CiAgICAgICAgICAgIGlaaGlodS5RdWlja0Jsb2NrLmFkZFF1aWNrQmxvY2tJbk9uZUNvbW1lbnQoJChlKSk7CiAgICAgICAgfSk7CiAgICAgICAgdmFyICRidG5RdWlja0Jsb2NrPSQoJzxhPicsewogICAgICAgICAgICAgICAgJ2NsYXNzJzonaXpoLXF1aWNrLWJsb2NrLXN3aXRjaCBpemgtYnV0dG9uJwogICAgICAgICAgICAgICwgaHJlZjonamF2YXNjcmlwdDp2b2lkKDApOycKICAgICAgICAgICAgICAsICdkYXRhLXRpcCc6J3MkdCTlvIDlp4vku47or4TorrrogIXkuK3pgInmi6nlsY/olL3lr7nosaEnCiAgICAgICAgICAgIH0pLnRleHQoJ+W/q+mAn+Wxj+iUvScpLmNzcyh7J21hcmdpbi1sZWZ0Jzo3fSkucHJlcGVuZFRvKCR3aGVyZSkuY2xpY2soZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIGlmKHRoaXMuZ2V0QXR0cmlidXRlKCdvbicpPT0nMScpewogICAgICAgICAgICAgICAgICAgICQoJy56bS1jb21tZW50LWhkIC5pemgtcXVpY2stYmxvY2stcGVuZCcpLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmF0dHIoeydkYXRhLXRpcCc6J3MkdCTlvIDlp4vku47or4TorrrogIXkuK3pgInmi6nlsY/olL3lr7nosaEnLCdvbic6JzAnfSkucmVtb3ZlQ2xhc3MoJ29uJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgICAgICQoJy56bS1jb21tZW50LWhkIC5pemgtcXVpY2stYmxvY2stcGVuZCcpLnNob3coKTsKICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmF0dHIoeydkYXRhLXRpcCc6J3MkdCTnu5PmnZ/ku47or4TorrrogIXkuK3pgInmi6nlsY/olL3lr7nosaEnLCdvbic6JzEnfSkuYWRkQ2xhc3MoJ29uJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgOwogICAgICAgIGlmKCRjbS5pcygnLmVtcHR5JykpewogICAgICAgICAgICAkYnRuUXVpY2tCbG9jay5oaWRlKCk7CiAgICAgICAgfQogICAgICAgIC8vIFJlZ2lvbiBlbmQKICAgIH07CiAgICAKICAgIGlaaGlodS4kYm9keS5iaW5kKCdET01Ob2RlSW5zZXJ0ZWQnLGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICAkKGV2ZW50LnRhcmdldCkuZmlsdGVyKCcjemgtdG9vbHRpcCcpLmJpbmQoJ0RPTU5vZGVJbnNlcnRlZCcsZnVuY3Rpb24oZXZlbnQpewogICAgICAgICAgICB2YXIgJGE9JChldmVudC50YXJnZXQpLmZpbHRlcignI3poLXRvb2x0aXAtcGVvcGxlJykuZmluZCgnYVtuYW1lPWZvY3VzXScpCiAgICAgICAgICAgICAgLCBiaWQ9JGEuYXR0cignaWQnKQogICAgICAgICAgICAgICwgd2hvPScsJytiaWQrJywnCiAgICAgICAgICAgIDsKICAgICAgICAgICAgaWYoJGEuaXMoJy56Zy1idG4tdW5mb2xsb3cnKSYmaVpoaWh1LlF1aWNrQmxvY2suVW5mb2xsb3dlZC5Vc2Vycy5pbmRleE9mKHdobyk+PTApewogICAgICAgICAgICAgICAgJGEudGV4dCgn5YWz5rOoJykucmVtb3ZlQ2xhc3MoJ3pnLWJ0bi11bmZvbGxvdycpLmFkZENsYXNzKCd6Zy1idG4tZm9sbG93Jyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoJGEuaXMoJy56Zy1idG4tZm9sbG93JykmJmlaaGlodS5RdWlja0Jsb2NrLlJlZm9sbG93ZWQuVXNlcnMuaW5kZXhPZih3aG8pPj0wKXsKICAgICAgICAgICAgICAgICRhLnRleHQoJ+WPlua2iOWFs+azqCcpLnJlbW92ZUNsYXNzKCd6Zy1idG4tZm9sbG93JykuYWRkQ2xhc3MoJ3pnLWJ0bi11bmZvbGxvdycpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9KTsKICAgIHJldHVybiB0aGlzOwp9CgovKioKICogQGNsYXNzIFF1aWNrRmF2bwogKi8KZnVuY3Rpb24gUXVpY2tGYXZvKGlaaGlodSkgewogICAgaWYgKCB0eXBlb2YgaVpoaWh1ID09PSAndW5kZWZpbmVkJyB8fCAhaVpoaWh1IHx8ICFpWmhpaHUuY29uZmlnWydRdWlja0Zhdm8nXSkgewogICAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgaVpoaWh1LlF1aWNrRmF2byA9IHRoaXM7CiAgICAKICAgIHRoaXMuRGVmYXVsdENvdW50ID0gNDsKICAgIHRoaXMuUGlubmVkTGlzdCA9IGlaaGlodS5jb25maWdbJ1F1aWNrRmF2b1Bpbm5lZCddOwogICAgdGhpcy5jc3MgPSAKICAgICAgICBbJy5pemgtUGluNFF1aWNrRmF2b3twYWRkaW5nOjNweCA1cHggMDtmbG9hdDpyaWdodDtkaXNwbGF5OmJsb2NrO21hcmdpbi10b3A6NHB4O21hcmdpbi1yaWdodDoyZW07bGluZS1oZWlnaHQ6MS4yNTt9JwogICAgICAgICwnLml6aC1QaW40UXVpY2tGYXZvIC56bS1pdGVtLXRvcC1idG57dmlzaWJpbGl0eTp2aXNpYmxlO21hcmdpbjowIDRweDtmbG9hdDpyaWdodDt9JwogICAgICAgICwnZGl2Lml6aF9mYXZ7cG9zaXRpb246YWJzb2x1dGU7ei1pbmRleDo5OTk5O2Rpc3BsYXk6bm9uZTtib3JkZXI6MXB4IHNvbGlkICM5OTk5OTk7YmFja2dyb3VuZC1jb2xvcjojZmZmO2JvcmRlci1yYWRpdXM6NXB4IDVweCA1cHggMDttYXJnaW4tbGVmdDotMXB4O30nCiAgICAgICAgLCdkaXYuaXpoX2ZhdiAudGl0bGV7cGFkZGluZzowIDVweDtiYWNrZ3JvdW5kLWNvbG9yOiMwODc0YzQ7Y29sb3I6I2ZmZjtmb250LXdlaWdodDpib2xkO2ZvbnQtc2l6ZToxNXB4O3RleHQtYWxpZ246Y2VudGVyO2JvcmRlci1yYWRpdXM6M3B4IDNweCAwIDA7fScKICAgICAgICAsJ2Rpdi5pemhfZmF2IGEuZmF2e2Rpc3BsYXk6YmxvY2s7Y2xlYXI6Ym90aDtmbG9hdDtsZWZ0O3BhZGRpbmc6MCAzNnB4IDAgMjRweDtsaW5lLWhlaWdodDoyO30nCiAgICAgICAgLCdkaXYuaXpoX2ZhdiBhLmZhdiBpe3Bvc2l0aW9uOmFic29sdXRlO21hcmdpbi10b3A6MC41ZW07fScKICAgICAgICAsJ2Rpdi5pemhfZmF2IGEuZmF2IGkuc3Bpbm5lci1ncmF5e2xlZnQ6MDt9JwogICAgICAgICwnZGl2Lml6aF9mYXYgYS5mYXYgaS56LWljb24tY29sbGVjdHtsZWZ0OjEwcHg7dmlzaWJpbGl0eTpoaWRkZW47YmFja2dyb3VuZC1wb3NpdGlvbjotNTZweCAtMzZweDt9JwogICAgICAgICwnZGl2Lml6aF9mYXYgYS5mYXYuc2VsZWN0ZWQgaS56LWljb24tY29sbGVjdHt2aXNpYmlsaXR5OnZpc2libGU7fScKICAgICAgICAsJ2Rpdi5pemhfZmF2IGEuZmF2OmhvdmVye3RleHQtZGVjb3JhdGlvbjpub25lfScKICAgICAgICAsJ2Rpdi5pemhfZmF2IGEuZmF2IHNwYW57ZmxvYXQ6cmlnaHQ7ZGlzcGxheTpibG9jazttYXJnaW4tcmlnaHQ6LTMycHh9JwogICAgICAgICwnLm1ldGEtaXRlbS5vbntwb3NpdGlvbjpyZWxhdGl2ZTt6LWluZGV4OjEwMDAwO2JhY2tncm91bmQtY29sb3I6I2ZmZjtib3JkZXI6MXB4IHNvbGlkICM5OTk5OTk7Ym9yZGVyLXRvcC1jb2xvcjojZmZmO21hcmdpbjotMXB4IC04cHggLTFweCAtMXB4O3BhZGRpbmc6MCA3cHg7Ym9yZGVyLXJhZGl1czoycHggMnB4IDNweCAzcHg7fScKICAgICAgICAsJyddLmpvaW4oJ1xuJyk7CiAgICB0aGlzLmFkZFF1aWNrRmF2byA9IGZ1bmN0aW9uKCR2LCRhKXsKICAgICAgICBpZigkdi5sZW5ndGgpewogICAgICAgICAgICBpZigkYS5jaGlsZHJlbignLml6aF9mYXYnKS5sZW5ndGg8PTApewogICAgICAgICAgICAgICAgJCgnPGRpdj4nLCB7ICdjbGFzcyc6ICdpemhfZmF2JyB9KQogICAgICAgICAgICAgICAgCS5hcHBlbmQoJCgnPGk+JywgeyAnY2xhc3MnOiAnc3Bpbm5lci1ncmF5JyB9KSkKICAgICAgICAgICAgICAgIAkuYXBwZW5kKCcmbmJzcDvliqDovb3kuK0uLi4mbmJzcDsnKQogICAgICAgICAgICAgICAgCS5iaW5kKCdtb3VzZW92ZXInLCBmdW5jdGlvbigpewoJICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnNob3coKS5wYXJlbnQoKS5maW5kKCcubWV0YS1pdGVtW25hbWU9ZmF2b10nKS5hZGRDbGFzcygnb24nKTsKICAgICAgICAgICAgICAgIAl9KQogICAgICAgICAgICAgICAgCS5iaW5kKCdtb3VzZW91dCcsIGZ1bmN0aW9uKCl7CgkgICAgICAgICAgICAgICAgICAgICQodGhpcykuaGlkZSgpLnBhcmVudCgpLmZpbmQoJy5tZXRhLWl0ZW1bbmFtZT1mYXZvXScpLnJlbW92ZUNsYXNzKCdvbicpOwoJICAgICAgICAgICAgICAgIH0pCgkgICAgICAgICAgICAuYXBwZW5kVG8oJGEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICR2LmJpbmQoJ21vdXNlZW50ZXInLGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICB2YXIgJGE9aVpoaWh1LmdldEl0ZW0oJCh0aGlzKSkKICAgICAgICAgICAgICAgICAgLCAkbT0kKHRoaXMpLmFkZENsYXNzKCdvbicpLmNsb3Nlc3QoJy56bS1pdGVtLW1ldGEnKQogICAgICAgICAgICAgICAgICAsIGFpZD0kYS5hdHRyKCdkYXRhLWFpZCcpCiAgICAgICAgICAgICAgICAgICwgJG9wPSQodGhpcykub2Zmc2V0UGFyZW50KCkKICAgICAgICAgICAgICAgICAgLCBib3R0b20xPXBhcnNlSW50KCRvcC5jc3MoJ21hcmdpbi1ib3R0b20nKSkKICAgICAgICAgICAgICAgICAgLCBib3R0b20yPXBhcnNlSW50KCRhLmNzcygncGFkZGluZy1ib3R0b20nKSkKICAgICAgICAgICAgICAgICAgLCBwb3M9JCh0aGlzKS5wb3NpdGlvbigpCiAgICAgICAgICAgICAgICA7CiAgICAgICAgICAgICAgICAkYS5jaGlsZHJlbignLml6aF9mYXYnKS5jc3MoewogICAgICAgICAgICAgICAgICAgICdib3R0b20nOihpc05hTihib3R0b20xKT8wOmJvdHRvbTEpKyhpc05hTihib3R0b20yKT8wOmJvdHRvbTIpKyRvcC5oZWlnaHQoKS1wb3MudG9wCiAgICAgICAgICAgICAgICAgICwgJ2xlZnQnOnBvcy5sZWZ0KyRtLnBvc2l0aW9uKCkubGVmdAogICAgICAgICAgICAgICAgfSkuc2hvdygpOwogICAgICAgICAgICAgICAgJC5nZXRKU09OKCcvY29sbGVjdGlvbnMvanNvbicsJC5wYXJhbSh7YW5zd2VyX2lkOmFpZH0pLGZ1bmN0aW9uKHJlc3VsdCxzdGF0dXMseGhyKXsKICAgICAgICAgICAgICAgICAgICB2YXIgYWlkPXRoaXMudXJsLnN1YnN0cih0aGlzLnVybC5pbmRleE9mKCdhbnN3ZXJfaWQ9JykrMTApCiAgICAgICAgICAgICAgICAgICAgICAsIHNlbD1wYWdlSXMuUXVlc3Rpb24/Jy56bS1pdGVtLWFuc3dlcicKICAgICAgICAgICAgICAgICAgICAgICAgICAgOnBhZ2VJcy5Ib21lPycuZmVlZC1pdGVtJwogICAgICAgICAgICAgICAgICAgICAgICAgICA6cGFnZUlzLkFuc3dlcj8nLnptLWl0ZW0tYW5zd2VyJwogICAgICAgICAgICAgICAgICAgICAgICAgICA6JycKICAgICAgICAgICAgICAgICAgICAgICwgJGE9JChzZWwrJ1tkYXRhLWFpZD0nK2FpZCsnXScpCiAgICAgICAgICAgICAgICAgICAgICAsICR2PSRhLmNoaWxkcmVuKCcuaXpoX2ZhdicpLmVtcHR5KCkuYXBwZW5kKCQoJzxkaXY+Jyx7J2NsYXNzJzondGl0bGUnLHRpdGxlOifku6XkuIvkuLrmnIDov5HpgInmi6nnmoTmlLbol4/lpLknfSkuYXBwZW5kKCflv6vpgJ/mlLbol48nKSkKICAgICAgICAgICAgICAgICAgICA7CiAgICAgICAgICAgICAgICAgICAgaWYoJyc9PXNlbClyZXR1cm47CiAgICAgICAgICAgICAgICAgICAgdmFyIGZhdkFsbD1yZXN1bHQubXNnWzBdCiAgICAgICAgICAgICAgICAgICAgICAsIGZhdlNlbD1yZXN1bHQubXNnWzFdCiAgICAgICAgICAgICAgICAgICAgICAsIG51bT1pWmhpaHUuUXVpY2tGYXZvLkRlZmF1bHRDb3VudAogICAgICAgICAgICAgICAgICAgICAgLCBmYXY9bmV3IEFycmF5KCkKICAgICAgICAgICAgICAgICAgICAgICwgZmF2Tm9ybWFsPW5ldyBBcnJheSgpCiAgICAgICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgICAgICQuZWFjaChmYXZBbGwsZnVuY3Rpb24oaSxlKXsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZJRD1lWzBdCiAgICAgICAgICAgICAgICAgICAgICAgICAgLCBwaW5uZWQ9aVpoaWh1LlF1aWNrRmF2by5QaW5uZWRMaXN0W2ZJRF0KICAgICAgICAgICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgICAgICAgICBpZihwaW5uZWQpewogICAgICAgICAgICAgICAgICAgICAgICAgIGZhdi5wdXNoKGUpOwogICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgICBmYXZOb3JtYWwucHVzaChlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIG51bSAtPSBmYXYubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgIGlmKG51bSA+IDApewogICAgICAgICAgICAgICAgICAgICAgICBmYXY9ZmF2LmNvbmNhdChmYXZOb3JtYWwuc2xpY2UoMCxudW0pKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZmF2Tm9ybWFsLmxlbmd0aD0wOwogICAgICAgICAgICAgICAgICAgIHdoaWxlKGZhdi5sZW5ndGgpewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZT1mYXYuc2hpZnQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICwgZklEPWVbMF0KICAgICAgICAgICAgICAgICAgICAgICAgICAsIGZOYW1lPWVbMV0KICAgICAgICAgICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgICAgICAgICBmYXZOb3JtYWxbZklEXT1mTmFtZTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRmPSQoJzxhLz4nLHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2xhc3MnOidmYXYnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgaHJlZjonamF2YXNjcmlwdDo7JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsIGFpZDphaWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLCBmaWQ6ZklECiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS50ZXh0KGZOYW1lKS5jbGljayhmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1PScvY29sbGVjdGlvbi8nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsICRmPSQodGhpcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgJGk9JGYuY2hpbGRyZW4oJzpmaXJzdCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRpLmhhc0NsYXNzKCdzcGlubmVyLWdyYXknKSlyZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdSs9JGYuaGFzQ2xhc3MoJ3NlbGVjdGVkJyk/J3JlbW92ZSc6J2FkZCc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGkuYXR0cignY2xhc3MnLCdzcGlubmVyLWdyYXknKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLnBvc3QodSwkLnBhcmFtKHtfeHNyZjokKCdpbnB1dFtuYW1lPV94c3JmXScpLnZhbCgpLGFuc3dlcl9pZDokKHRoaXMpLmF0dHIoJ2FpZCcpLGZhdmxpc3RfaWQ6JCh0aGlzKS5hdHRyKCdmaWQnKX0pLGZ1bmN0aW9uKHJlc3VsdCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhY3Q9dGhpcy51cmwuc3Vic3RyaW5nKHRoaXMudXJsLmxhc3RJbmRleE9mKCcvJykrMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsIGZpZD11dGlscy5nZXRQYXJhbUluUXVlcnkodGhpcy5kYXRhLCdmYXZsaXN0X2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsIGFpZD11dGlscy5nZXRQYXJhbUluUXVlcnkodGhpcy5kYXRhLCdhbnN3ZXJfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgc2VsPXBhZ2VJcy5RdWVzdGlvbj8nLnptLWl0ZW0tYW5zd2VyJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOnBhZ2VJcy5Ib21lPycuZmVlZC1pdGVtJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOicnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLCAkdmk9Jyc9PXNlbD9udWxsOiQoc2VsKydbZGF0YS1haWQ9JythaWQrJ10gLml6aF9mYXYgYVtmaWQ9JytmaWQrJ10nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgaW5jPTA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCcnPT1zZWwpcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihhY3Q9PSdyZW1vdmUnJiZyZXN1bHQubXNnPT0nT0snKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR2aS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluYz0tMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2UgaWYoYWN0PT0nYWRkJyYmcmVzdWx0Lm1zZy5sZW5ndGgpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHZpLmFkZENsYXNzKCdzZWxlY3RlZCcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5jPTE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoaW5jIT0wKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR2aS5jaGlsZHJlbignc3BhbicpLnRleHQocGFyc2VJbnQoJHZpLmNoaWxkcmVuKCdzcGFuJykudGV4dCgpKStpbmMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR2aS5jaGlsZHJlbignOmZpcnN0JykuYXR0cignY2xhc3MnLCd6LWljb24tY29sbGVjdCcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkucHJlcGVuZCgkKCc8aS8+Jyx7J2NsYXNzJzonei1pY29uLWNvbGxlY3QnfSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHNwYW4vPicpLnRleHQoZVszXSkpOwogICAgICAgICAgICAgICAgICAgICAgICAkZi5hcHBlbmRUbygkdi8qLmNoaWxkcmVuKHBpbm5lZD8nLnBpbm5lZCc6Jy5ub3JtYWwnKSovKTsKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICQuZWFjaChmYXZTZWwsZnVuY3Rpb24oaSxlKXsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoZmF2Tm9ybWFsW2VdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHYuZmluZCgnYS5mYXZbZmlkPScrZSsnXScpLmFkZENsYXNzKCdzZWxlY3RlZCcpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAkdi5iaW5kKCdtb3VzZWxlYXZlJyxmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdmFyICRhPWlaaGlodS5nZXRJdGVtKCQodGhpcykucmVtb3ZlQ2xhc3MoJ29uJykpOwogICAgICAgICAgICAgICAgJGEuY2hpbGRyZW4oJy5pemhfZmF2JykuaGlkZSgpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9OwoKICAgIGlaaGlodS4kYm9keS5iaW5kKCdET01Ob2RlSW5zZXJ0ZWQnLGZ1bmN0aW9uKGV2ZW50KXsKCQl2YXIgJGU9JChldmVudC50YXJnZXQpOwoJCWlmKCRlLmlzKCcubW9kYWwtZGlhbG9nJykpewoJCQkkZS5iaW5kKCdET01Ob2RlSW5zZXJ0ZWQnLGZ1bmN0aW9uKGV2ZW50KXsKCQkJCXZhciAkZT0kKGV2ZW50LnRhcmdldCkKICAgICAgICAgICAgICAgICAgLCAkZmF2TGlzdD0kZS5maW5kKCcuem0tZmF2by1saXN0LWNvbnRlbnQnKQogICAgICAgICAgICAgICAgOwoJCQkJaWYoJGZhdkxpc3QubGVuZ3RoKXsKCQkJCQl2YXIgJGZhdkl0ZW1zPSRmYXZMaXN0LmNoaWxkcmVuKCcuem0tZmF2by1saXN0LWl0ZW0tbGlua1tkYXRhLWxpZF0nKQogICAgICAgICAgICAgICAgICAgICAgLCBmdW5jUGluPWZ1bmN0aW9uKGUpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBpbm5lZD1lLmNoZWNrZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLCAkZT0kKGUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgJGY9JGUuY2xvc2VzdCgnLnptLWZhdm8tbGlzdC1pdGVtLWxpbmsnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgO2lmKCEkZi5sZW5ndGgpcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxpZD0kZS5hdHRyKCdsaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsICRjaGVja3M9JGUuY2xvc2VzdCgnLnptLWZhdm8tbGlzdC1jb250ZW50JykuZmluZCgnLml6aC1QaW40UXVpY2tGYXZvIC50X2pjaGtib3gnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsIHRpbWU9NTAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLCBjc3NTdGFydD17cG9zaXRpb246J3JlbGF0aXZlJywnYmFja2dyb3VuZC1jb2xvcic6JyMwODc0QzQnLCd6LWluZGV4JzonMTAwJ30KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLCBjc3NFbmQ9e3Bvc2l0aW9uOicnLCdiYWNrZ3JvdW5kLWNvbG9yJzonJywnei1pbmRleCc6Jyd9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgZnVuY1JvbGxVcD1mdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGI9JGUuY2xvc2VzdCgnLnptLWZhdm8tbGlzdC1pdGVtLWxpbmsnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgJGE9JGIucHJldigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoISRhLmxlbmd0aHx8KCRhLmhhc0NsYXNzKCdwaW5uZWQnKSYmcGFyc2VJbnQoJGEuYXR0cignZGF0YS1saWQnKSk8cGFyc2VJbnQoJGIuYXR0cignZGF0YS1saWQnKSkpKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYi5hbmltYXRlKHtib3R0b206JGEub3V0ZXJIZWlnaHQoKX0sewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246dGltZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgc3RlcDpmdW5jdGlvbihub3cpeyRiLmNzcyhjc3NTdGFydCk7fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgY29tcGxldGU6ZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYi5jc3MoJC5leHRlbmQoe2JvdHRvbTowfSxjc3NFbmQpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYi5pbnNlcnRCZWZvcmUoJGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmNSb2xsVXAoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsIGZ1bmNSb2xsRG93bj1mdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGE9JGUuY2xvc2VzdCgnLnptLWZhdm8tbGlzdC1pdGVtLWxpbmsnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgJGI9JGEubmV4dCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoISRiLmxlbmd0aHx8KCEkYi5oYXNDbGFzcygncGlubmVkJykmJnBhcnNlSW50KCRiLmF0dHIoJ2luZGV4JykpPnBhcnNlSW50KCRhLmF0dHIoJ2luZGV4JykpKSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGEuYW5pbWF0ZSh7dG9wOiRiLm91dGVySGVpZ2h0KCl9LHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOnRpbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsIHN0ZXA6ZnVuY3Rpb24obm93KXskYS5jc3MoY3NzU3RhcnQpO30KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsIGNvbXBsZXRlOmZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGEuY3NzKCQuZXh0ZW5kKHt0b3A6MH0sY3NzRW5kKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGEuaW5zZXJ0QWZ0ZXIoJGIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmNSb2xsRG93bigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihwaW5uZWQpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRmLmFkZENsYXNzKCdwaW5uZWQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jUm9sbFVwKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZi5yZW1vdmVDbGFzcygncGlubmVkJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY1JvbGxEb3duKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpWmhpaHUuUXVpY2tGYXZvLlBpbm5lZExpc3RbbGlkXT1waW5uZWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGlscy5zZXRDZmcoJ1F1aWNrRmF2b1Bpbm5lZCcsaVpoaWh1LlF1aWNrRmF2by5QaW5uZWRMaXN0KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIDsKCQkJCQkkZmF2SXRlbXMuZWFjaChmdW5jdGlvbihpLGUpewoJCQkJCQl2YXIgbGlkPWUuZ2V0QXR0cmlidXRlKCdkYXRhLWxpZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgLCAkcGluPSQoJzxhLz4nLHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBocmVmOidqYXZhc2NyaXB0OnZvaWQoMCk7JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsICdjbGFzcyc6J2l6aC1QaW40UXVpY2tGYXZvJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsICdsaWQnOmxpZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsICdkYXRhLXRpcCc6J3MkYiTkv53mjIHlnKjjgIzlv6vpgJ/mlLbol4/jgI3oj5zljZXpobbpg6jmmL7npLonCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5hcHBlbmQoJCgnPHNwYW4vPicpLmFwcGVuZCgn572u6aG2JykuYWRkKCc8aS8+Jyx7J2NsYXNzJzonem0taXRlbS10b3AtYnRuJ30pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kVG8oJCgnLnpnLWdyYXknLGUpKS5hdHRyKCdpbmRleCcsaSkKICAgICAgICAgICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZSgnaW5kZXgnLGkpOwogICAgICAgICAgICAgICAgICAgICAgICAkcGluLmJpbmQoJ2NsaWNrJyxmdW5jdGlvbihldmVudCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNoZWNrZWQ9IXRoaXMuY2hlY2tlZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmNQaW4odGhpcyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih0aGlzLmNoZWNrZWQpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuY2hpbGRyZW4oJ3NwYW4nKS50ZXh0KCflj5bmtojnva7pobYnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmNoaWxkcmVuKCdpJykuYWRkQ2xhc3MoJ3ptLWl0ZW0tdG9wLWJ0bi1jYW5jZWwnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuY2hpbGRyZW4oJ3NwYW4nKS50ZXh0KCfnva7pobYnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmNoaWxkcmVuKCdpJykucmVtb3ZlQ2xhc3MoJ3ptLWl0ZW0tdG9wLWJ0bi1jYW5jZWwnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGV2ZW50LnByZXZlbnREZWZhdWx0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmKGV2ZW50LnN0b3BQcm9wYWdhdGlvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5jYW5jZWxCdWJibGU9dHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgfSlbMF0uY2hlY2tlZD1mYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoaVpoaWh1LlF1aWNrRmF2by5QaW5uZWRMaXN0W2xpZF0pewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHBpbi5jbGljaygpOwogICAgICAgICAgICAgICAgICAgICAgICB9CgkJCQkJfSk7CgkJCQl9CgkJCX0pOwoJCX0KCX0pOwoKICAgIHJldHVybiB0aGlzOwp9CgovKioKICogQGNsYXNzIFNlYXJjaGluZ0xpc3QKICovCmZ1bmN0aW9uIFNlYXJjaGluZ0xpc3QoaVpoaWh1KSB7CiAgICBpZiAoIHR5cGVvZiBpWmhpaHUgPT09ICd1bmRlZmluZWQnIHx8ICFpWmhpaHUpIHsKICAgICAgICByZXR1cm4gbnVsbAogICAgfQogICAgaVpoaWh1LlNlYXJjaGluZ0xpc3QgPSB0aGlzCiAgICAKICAgIHRoaXMuJHRvcFNlYXJjaCA9ICQoJyN6aC10b3Atc2VhcmNoLWZvcm0nKQogICAgdGhpcy4kdG9wU2VhcmNoSW5wdXQgPSAkKCcjemgtdG9wLXNlYXJjaC1mb3JtID4gaW5wdXQjcScpCiAgICBpZiAoIXRoaXMuJHRvcFNlYXJjaC5sZW5ndGgpIHJldHVybgoKICAgIHRoaXMuU2VhcmNoRW5naW5lT3V0c2lkZUxpc3QgPSB7CiAgICAgICAgJ2dvb2dsZSc6IHtpY29uOidodHRwczovL3d3dy5nb29nbGUuY29tL2Zhdmljb24uaWNvJyx1cmw6J2h0dHBzOi8vd3d3Lmdvb2dsZS5jb20vP3E9c2l0ZTp6aGlodS5jb20lMjB7MH0jcT1zaXRlOnpoaWh1LmNvbSt7MH0nfQogICAgICAsICdiYWlkdSc6IHtpY29uOidodHRwOi8vd3d3LmJhaWR1LmNvbS9mYXZpY29uLmljbycsdXJsOidodHRwOi8vd3d3LmJhaWR1LmNvbS9zP3dkPXNpdGU6emhpaHUuY29tJTIwezB9J30KICAgIH0KCiAgICB1dGlscy5vYnNlcnZlRE9NTm9kZUFkZGVkKHRoaXMuJHRvcFNlYXJjaFswXSxmdW5jdGlvbihldmVudCl7CiAgICAgICAgdmFyIF9hID0gZXZlbnQuYWRkZWROb2RlcyB8fCBbXQogICAgICAgIGlmICghX2EubGVuZ3RoKSByZXR1cm4KICAgICAgICB1dGlscy5vYnNlcnZlRE9NTm9kZUFkZGVkKF9hWzBdLGZ1bmN0aW9uKGV2ZW50KXtjb25zb2xlLmxvZyhpWmhpaHUuY29uZmlnWydTZWFyY2hFbmdpbmVPdXRzaWRlJ10pCiAgICAgICAgICAgIHZhciBfYSA9IGV2ZW50LmFkZGVkTm9kZXMgfHwgW251bGxdCiAgICAgICAgICAgICAgLCAkaXRlbSA9ICQoX2FbMF0pCiAgICAgICAgICAgICAgLCBzZW9LZXkgPSBpWmhpaHUuY29uZmlnWydTZWFyY2hFbmdpbmVPdXRzaWRlJ10gfHwgJ2JhaWR1JwogICAgICAgICAgICAgICwgc2VvID0gaVpoaWh1LlNlYXJjaGluZ0xpc3QuU2VhcmNoRW5naW5lT3V0c2lkZUxpc3Rbc2VvS2V5XSB8fCB7aWNvbjonJyx1cmw6Jyd9CiAgICAgICAgICAgICAgLCBzdHJTZWFyY2hVcmwgPSBzZW8udXJsLnJlcGxhY2UoL1x7MFx9L2csIGZ1bmN0aW9uKCl7cmV0dXJuIGlaaGlodS5TZWFyY2hpbmdMaXN0LiR0b3BTZWFyY2hJbnB1dC52YWwoKX0pCiAgICAgICAgICAgIGNvbnNvbGUubG9nKHNlb0tleSkKICAgICAgICAgICAgaWYgKCRpdGVtLmlzKCcuYWMtcm93W3JvbGU9b3B0aW9uXScpKXsKICAgICAgICAgICAgICAgIHZhciAkYSA9ICRpdGVtLmNoaWxkcmVuKCdhJykKICAgICAgICAgICAgICAgICAgLCBocmVmID0gJGEuYXR0cignaHJlZicpCiAgICAgICAgICAgICAgICAgICwgY3NzID0gJ2Zsb2F0OnJpZ2h0O2JhY2tncm91bmQtcG9zaXRpb246LTI4NHB4IC0ycHg7JwogICAgICAgICAgICAgICAgICAsICRhTmV3ID0gJCgnPGE+Jywge2NsYXNzOid6Zy1pY29uJyxzdHlsZTpjc3MsaHJlZjpocmVmLHRhcmdldDonX2JsYW5rJyxjbGljazpmdW5jdGlvbihldmVudCl7CiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpCiAgICAgICAgICAgICAgICAgICAgfX0pCiAgICAgICAgICAgICAgICBpZiAoaHJlZi5pbmRleE9mKCcvc2VhcmNoPycpID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgJGFOZXcuY3NzKHttYXJnaW5Ub3A6JzAuNWVtJ30pCiAgICAgICAgICAgICAgICAgICAgJGl0ZW0uYXBwZW5kKCQoJzxhPicsIHtjbGFzczonaWNvbicsc3R5bGU6J21hcmdpbi10b3A6MC41ZW07ZmxvYXQ6bGVmdCcsaHJlZjpzdHJTZWFyY2hVcmwsdGFyZ2V0OidfYmxhbmsnLGNsaWNrOmZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCkKICAgICAgICAgICAgICAgICAgICB9fSkuYXBwZW5kKCQoJzxpbWc+Jywge2JvcmRlcjowLHNyYzpzZW8uaWNvbix3aWR0aDoxNixoZWlnaHQ6MTZ9KSkpCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGhyZWYuaW5kZXhPZignL3F1ZXN0aW9uLycpIDwgMCkgewogICAgICAgICAgICAgICAgICAgICRhTmV3LmNzcyh7bWFyZ2luVG9wOictMS41ZW0nfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRpdGVtLmFwcGVuZCgkYU5ldykKICAgICAgICAgICAgfQogICAgICAgIH0pCiAgICB9KQoKICAgIHJldHVybiB0aGlzCn0KCi8qKgogKiBAY2xhc3MgVG9wTmF2CiAqLwpmdW5jdGlvbiBUb3BOYXYoaVpoaWh1KSB7CiAgICBpZiAoIHR5cGVvZiBpWmhpaHUgPT09ICd1bmRlZmluZWQnIHx8ICFpWmhpaHUgfHwgIWlaaGlodS5jb25maWdbJ1RvcE5hdkF1dG9Gb2xkJ10pIHsKICAgICAgICByZXR1cm4gbnVsbAogICAgfQogICAgaVpoaWh1LlRvcE5hdiA9IHRoaXMKICAgIAogICAgdGhpcy4kdG9wTmF2ID0gJCgnYm9keSA+IC56dS10b3A6Zmlyc3QnKQogICAgICAgIC5vbignbW91c2VvdmVyJywgZnVuY3Rpb24oZXZlbnQpewogICAgICAgICAgICB0aGlzLnN0eWxlLnRvcCA9ICcwJwogICAgICAgICAgICB0aGlzLnNldEF0dHJpYnV0ZSgnaXpoLW1vdXNlb3ZlcicsICcxJykKICAgICAgICAgICAgJCgnI2l6aENTU19Ob3RpTnVtJykucmVtb3ZlKCkKICAgICAgICB9KQogICAgICAgIC5vbignbW91c2VvdXQnLCBmdW5jdGlvbihldmVudCl7CiAgICAgICAgICAgIHRoaXMuc2V0QXR0cmlidXRlKCdpemgtbW91c2VvdmVyJywgJzAnKQogICAgICAgICAgICBpWmhpaHUuVG9wTmF2LmZ1bmNGb2xkKCkKICAgICAgICB9KQogICAgaWYgKCF0aGlzLiR0b3BOYXYubGVuZ3RoKSByZXR1cm4KCiAgICB0aGlzLnRvcE5hdkhlaWdodCA9IHRoaXMuJHRvcE5hdi5oZWlnaHQoKSAtIDUKCiAgICB0aGlzLmZ1bmNGb2xkID0gZnVuY3Rpb24oZXZlbnQpewogICAgICAgIHZhciBzY3JvbGxUb3AgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wIHx8IGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wIHx8IDAKICAgICAgICAgICwgX3NlbGYgPSBpWmhpaHUuVG9wTmF2CiAgICAgICAgICAsIGlzTW91c2VPdmVyID0gJzEnID09PSAoX3NlbGYuJHRvcE5hdi5hdHRyKCdpemgtbW91c2VvdmVyJykgfHwgJycpCiAgICAgICAgICAsICRoZWFkID0gJCgnaGVhZDpmaXJzdCcpCiAgICAgICAgICAsICRjc3NOb3RpTnVtID0gJCgnI2l6aENTU19Ob3RpTnVtJykKICAgICAgICAgICwgJGZsb2F0aW5nQmFyID0gJCgnYm9keSA+IC5nb29nLXNjcm9sbGZsb2F0ZXItZmxvYXRpbmcnKQogICAgICAgIGlmIChzY3JvbGxUb3AgPT09IDApIHsKICAgICAgICAgICAgX3NlbGYuJHRvcE5hdi5jc3Moe3RvcDowfSkKICAgICAgICB9IGVsc2UgaWYgKCFpc01vdXNlT3ZlcikgewogICAgICAgICAgICBpZiAoc2Nyb2xsVG9wIDwgX3NlbGYudG9wTmF2SGVpZ2h0KSB7CiAgICAgICAgICAgICAgICBfc2VsZi4kdG9wTmF2LmNzcyh7dG9wOi1zY3JvbGxUb3B9KQogICAgICAgICAgICAgICAgJGZsb2F0aW5nQmFyLmNzcyh7bWFyZ2luVG9wOi1zY3JvbGxUb3B9KQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgX3NlbGYuJHRvcE5hdi5jc3Moe3RvcDotX3NlbGYudG9wTmF2SGVpZ2h0fSkKICAgICAgICAgICAgICAgICRmbG9hdGluZ0Jhci5jc3Moe21hcmdpblRvcDotX3NlbGYudG9wTmF2SGVpZ2h0fSkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc2Nyb2xsVG9wID4gMjApIHsKICAgICAgICAgICAgICAgIGlmICghJGNzc05vdGlOdW0ubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgJCgnPHN0eWxlPicsIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICdpemhDU1NfTm90aU51bScKICAgICAgICAgICAgICAgICAgICAgICwgdHlwZTogJ3RleHQvY3NzJwogICAgICAgICAgICAgICAgICAgIH0pLmFwcGVuZFRvKCdoZWFkOmZpcnN0JykudGV4dCgnI3poLXRvcC1uYXYtY291bnQsI3poLXRvcC1uYXYtbmV3LXBte3Bvc2l0aW9uOmFic29sdXRlO3RvcDo0MHB4O2JvcmRlci1yYWRpdXM6MCAhaW1wb3J0YW50fS50b3AtbmF2LXByb2ZpbGUgLnp1LXRvcC1uYXYtdXNlcmluZm97b3ZlcmZsb3c6dmlzaWJsZSAhaW1wb3J0YW50fScpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAkY3NzTm90aU51bS5yZW1vdmUoKQogICAgfQoKICAgIGlaaGlodS4kd2luLnNjcm9sbCh0aGlzLmZ1bmNGb2xkKQoKICAgIHRoaXMub25Ob2RlQWRkZWQgPSBmdW5jdGlvbihldmVudCl7CiAgICAgICAgaVpoaWh1LlRvcE5hdi5mdW5jRm9sZCgpCiAgICAgICAgJC5lYWNoKGV2ZW50LnJlbW92ZWROb2RlcywgZnVuY3Rpb24oaSwgZSl7CiAgICAgICAgICAgIHZhciAkZmxvYXRpbmdCYXIgPSAkKGUpLmZpbHRlcignLmdvb2ctc2Nyb2xsZmxvYXRlcicpLmNzcyh7bWFyZ2luVG9wOicnfSkKICAgICAgICB9KQogICAgfQoKICAgIHJldHVybiB0aGlzCn0KCmFsbExpbmtzID0gZnVuY3Rpb24oX25hbWUsIF9saXN0U2VsLCBfbGlzdE5hbWUpIHsKICAgIHRoaXMubmFtZSA9IF9uYW1lCiAgICB0aGlzLmxpc3RTZWwgPSBfbGlzdFNlbAogICAgdGhpcy5saXN0TmFtZSA9IF9saXN0TmFtZQogICAgdGhpcy5kbGdJRCA9ICdpemgtZGxnLScgKyBfbmFtZQogICAgdGhpcy4kZGxnID0gbnVsbAogICAgdmFyIF9pbml0aWFsVGl0bGUgPSBfbGlzdE5hbWUgKyAn5Zyw5Z2A5riF5Y2VJwogICAgICAsIF9yZXN1bHQgPSBuZXcgQXJyYXkoKQogICAgICAsIF9sb2FkVGltZXMgPSAwCgogICAgLy/liIbmnpDlhoXlrrkKICAgIHZhciBwcm9jZXNzTm9kZSA9IGZ1bmN0aW9uKGNvbnRlbnQsJGRsZyl7CiAgICAgIHZhciAkcUN1cnJlbnQgPSBudWxsOwogICAgICAkKCcuem0taXRlbS1hbnN3ZXInLCBjb250ZW50KS5lYWNoKGZ1bmN0aW9uKGluZGV4LCBpdGVtKXsKICAgICAgICB2YXIgJGEgPSAkKGl0ZW0pCiAgICAgICAgICAsICRxID0gJGEuY2xvc2VzdCgiLnptLWl0ZW0iKS5jaGlsZHJlbigiaDIiKS5jaGlsZHJlbigiYSIpCiAgICAgICAgOwogICAgICAgIGlmKCRxLmxlbmd0aCl7CiAgICAgICAgICAkcUN1cnJlbnQ9JHE7CiAgICAgICAgfWVsc2UgaWYoJHFDdXJyZW50KXsKICAgICAgICAgICRxPSRxQ3VycmVudDsKICAgICAgICB9ZWxzZXsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdmFyIGhyZWZRdWVzdGlvbiA9IHVybC5kYXRhLmF0dHJbImJhc2UiXSArICRxLmF0dHIoImhyZWYiKS5yZXBsYWNlKHVybC5kYXRhLmF0dHJbImJhc2UiXSwnJyk7CiAgICAgICAgdmFyIG9iaiA9IHsKICAgICAgICAgICAgdGl0bGU6ICRxLnRleHQoKSwKICAgICAgICAgICAgLy9xdWVzdGlvblVybDogaHJlZlF1ZXN0aW9uLAogICAgICAgICAgICBhbnN3ZXJVcmw6IGhyZWZRdWVzdGlvbiArICgkYS5wYXJlbnQoKS5pcygiLnptLWl0ZW0tZmF2IikgPyAiL2Fuc3dlci8iICsgJGEuYXR0cigiZGF0YS1hdG9rZW4iKSA6ICIiKSwKICAgICAgICAgICAgYW5zd2VyQXV0aG9yOiAkYS5maW5kKCcuem0taXRlbS1hbnN3ZXItYXV0aG9yLXdyYXAgYVtocmVmXj0iL3Blb3BsZSJdJykudGV4dCgpLnRyaW0oKSwKICAgICAgICAgICAgc3VtbWFyeTogJGEuZmluZCgiLnptLWl0ZW0tYW5zd2VyLXN1bW1hcnkiKS5jaGlsZHJlbigpLnJlbW92ZSgpLmVuZCgpLnRleHQoKSwKICAgICAgICAgICAgY29udGVudDogJGEuZmluZCgiLnptLWVkaXRhYmxlLWNvbnRlbnQiKS5odG1sKCkKICAgICAgICB9OwogICAgICAgIF9yZXN1bHQucHVzaChvYmopOwogICAgICAgIHZhciBzdHJUaXRsZSA9IHV0aWxzLmZvcm1hdFN0cignKiDjgIp7dGl0bGV944CLJiMxMzsqIHthbnN3ZXJBdXRob3J977yaJiMxMzsqIHtzdW1tYXJ5fScsIG9iaikKICAgICAgICAgICwgc3RyVVJMID0gdXRpbHMuZm9ybWF0U3RyKCd7YW5zd2VyVXJsfScsIG9iaikKICAgICAgICAgICwgJGxpID0gJCgnPGxpPicpLmFwcGVuZCgkKCc8YT4nLCB7IGhyZWY6IHN0clVSTCwgdGl0bGU6IHN0clRpdGxlIH0pLnRleHQoc3RyVVJMKSkuY3NzKHsgJ2xpc3Qtc3R5bGUtdHlwZSc6ICdub25lJyB9KQogICAgICAgICQoJy5pemhpaHUtY29sbGVjdGlvbi1saW5rcycsJGRsZykuYXBwZW5kKCRsaSk7CiAgICAgICAgdmFyIGNvdW50PV9yZXN1bHQubGVuZ3RoOwogICAgICAgICQoJy5pemhpaHUtY29sbGVjdGlvbi1pbmZvJywkZGxnKS50ZXh0KCfvvIjliqrlipvliqDovb3kuK0uLi7lt7LlvpfliLDorrDlvZUgJyArIGNvdW50ICsgJyDmnaHvvIknKTsKICAgICAgfSk7CiAgICB9OwogICAgICAgIAogICAgdmFyIGhhbmRsZXIgPSBmdW5jdGlvbihwYWdlV2FudCxwYWdlTm93LCRkbGcpewogICAgICBpZiAoIXBhZ2VOb3cpcGFnZU5vdz0xOwogICAgICBpZigkZGxnLmlzKCc6aGlkZGVuJykpewogICAgICAgIHZhciBjb3VudD1fcmVzdWx0Lmxlbmd0aDsKICAgICAgICAkKCcuaXpoaWh1LWNvbGxlY3Rpb24taW5mbycsJGRsZykudGV4dCgn77yI5Yqg6L296KKr57uI5q2iLi4u5bey5b6X5Yiw6K6w5b2VICcgKyBjb3VudCArICcg5p2h77yJJyk7CiAgICAgICAgJCgnI3poLWdsb2JhbC1zcGlubmVyJykuaGlkZSgpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICAKICAgICAgaWYocGFnZVdhbnQ9PTEpewogICAgICAgICQoJy5pemhpaHUtY29sbGVjdGlvbi1saW5rcycsJGRsZykuZW1wdHkoKTsKICAgICAgICAkKCcjemgtZ2xvYmFsLXNwaW5uZXInKS5zaG93KCk7CiAgICAgICAgX3Jlc3VsdC5sZW5ndGg9MDsKICAgICAgICBfbG9hZFRpbWVzKys7CiAgICAgICAgJCgnLml6aGlodS1jb2xsZWN0aW9uLWluZm8nLCRkbGcpLnRleHQoJycpOwogICAgICB9CiAgICAgIHZhciAkcGFnZXI9JChfbGlzdFNlbCkucGFyZW50KCkuZmluZCgnLnptLWludml0ZS1wYWdlcicpCiAgICAgICAgLCAkbGFzdFBhZ2U9JHBhZ2VyLmNoaWxkcmVuKCdzcGFuJykubGFzdCgpLnByZXYoKQogICAgICAgICwgdG90YWxDb3VudD0kcGFnZXIubGVuZ3RoPT0wPzE6TnVtYmVyKCRsYXN0UGFnZS50ZXh0KCkpCiAgICAgIDsKICAgICAgaWYocGFnZVdhbnQ+dG90YWxDb3VudCl7CiAgICAgICAgJCgnLml6aGlodS1jb2xsZWN0aW9uLWluZm8nLCRkbGcpLnRleHQoJ++8iOWKoOi9veWujOaIkO+8jOWFseW+l+WIsOiusOW9lSAnICsgX3Jlc3VsdC5sZW5ndGggKyAnIOadoe+8iScpOwogICAgICAgICQoJyN6aC1nbG9iYWwtc3Bpbm5lcicpLmhpZGUoKTsKICAgICAgICAkKCcuc2VsQWxsJywkZGxnKS5jbGljaygpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIHBhZ2VOZXh0PXBhZ2VXYW50KzE7CiAgICAgIGlmKHBhZ2VXYW50PT1wYWdlTm93KXsKICAgICAgICBwcm9jZXNzTm9kZSgkKF9saXN0U2VsKS5odG1sKCksJGRsZyk7CiAgICAgICAgaGFuZGxlcihwYWdlTmV4dCxwYWdlTm93LCRkbGcpCiAgICAgIH1lbHNlewogICAgICAgIHZhciBfdXJsPXVybC5kYXRhLmF0dHJbJ2Jhc2UnXSt1cmwuZGF0YS5hdHRyWydwYXRoJ10rJz9wYWdlPScrcGFnZVdhbnQ7CiAgICAgICAgJC5hamF4KF91cmwse3R5cGU6J2dldCcsY29udGV4dDp7bG9hZFRpbWVzOl9sb2FkVGltZXN9fSkuZG9uZShmdW5jdGlvbihyZXN1bHQpewogICAgICAgICAgaWYodGhpcy5sb2FkVGltZXMhPV9sb2FkVGltZXMpcmV0dXJuOwogICAgICAgICAgcHJvY2Vzc05vZGUocmVzdWx0LCRkbGcpOwogICAgICAgICAgaGFuZGxlcihwYWdlTmV4dCxwYWdlTm93LCRkbGcpCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH07CgogICAgLy/liJ3lp4vljJblvLnlh7rmoYYKICAgIHRoaXMuaW5pdERpYWxvZyA9IGZ1bmN0aW9uKCl7CiAgICAgICAgdGhpcy4kZGxnPSQoJyMnK3RoaXMuZGxnSUQpOwogICAgICAgIHZhciByZXRWYWw9MDx0aGlzLiRkbGcubGVuZ3RoOwogICAgICAgIGlmKCFyZXRWYWwpewogICAgICAgICAgICB0aGlzLiRkbGcgPSAkKCc8ZGl2PicsIHsgaWQ6IHRoaXMuZGxnSUQsICdjbGFzcyc6ICdtb2RhbC1kaWFsb2cgYWxsTGlua3MnLCB0YWJpbmRleDogJzAnLCBzdHlsZTogJ2Rpc3BsYXk6IG5vbmU7d2lkdGg6NTAwcHgnLCBuYW1lOiBfbmFtZSwgJ2xpc3RTZWwnOiBfbGlzdFNlbCB9KQogICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8ZGl2PicsIHsgJ2NsYXNzJzogJ21vZGFsLWRpYWxvZy10aXRsZSBtb2RhbC1kaWFsb2ctdGl0bGUtZHJhZ2dhYmxlJyB9KQogICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHNwYW4+JywgeyAnY2xhc3MnOiAnbW9kYWwtZGlhbG9nLXRpdGxlLXRleHQnIH0pLnRleHQoX2luaXRpYWxUaXRsZSkpCiAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8c3Bhbj4nLCB7ICdjbGFzcyc6ICdtb2RhbC1kaWFsb2ctdGl0bGUtdGV4dCBpemhpaHUtY29sbGVjdGlvbi1pbmZvJyB9KSkKICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxzcGFuPicsIHsKICAgICAgICAgICAgICAgICAgICAgICAgJ2NsYXNzJzogJ21vZGFsLWRpYWxvZy10aXRsZS1jbG9zZScKICAgICAgICAgICAgICAgICAgICAgICwgY2xpY2s6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI3poLWdsb2JhbC1zcGlubmVyJykuaGlkZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcubW9kYWwtZGlhbG9nLWJnJykuaGlkZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmNsb3Nlc3QoJy5tb2RhbC1kaWFsb2cnKS5oaWRlKCkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pKQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8ZGl2PicsIHsgJ2NsYXNzJzogJ21vZGFsLWRpYWxvZy1jb250ZW50JyB9KQogICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGRpdj4nKQogICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxkaXY+JywgeyAnY2xhc3MnOiAnemctc2VjdGlvbicgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGRpdj4nLCB7ICdjbGFzcyc6ICdpemhpaHUtY29sbGVjdGlvbi1saW5rcyB6Zy1mb3JtLXRleHQtaW5wdXQnLCB0YWJJbmRleDogJy0xJywgc3R5bGU6ICdoZWlnaHQ6MzAwcHg7b3ZlcmZsb3cteTpzY3JvbGw7b3V0bGluZTpub25lOycgfSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxmb3JtPicsIHsgYWN0aW9uOiAnaHR0cDovL2lsb3ZlemhpaHUuZHVhcHAuY29tL3NhdmVNZS5weScsIG1ldGhvZDogJ3Bvc3QnLCB0YXJnZXQ6ICdfYmxhbmsnLCBzdHlsZTogJ2Rpc3BsYXk6bm9uZScgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0ZXh0YXJlYT4nLCB7IHN0eWxlOiAid2lkdGg6IDEwMCU7IiwgbmFtZTogImxpbmtzIiwgJ2NsYXNzJzogIml6aGlodS1jb2xsZWN0aW9uLWxpbmtzLXBvc3QiIH0pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGlucHV0PicsIHsgbmFtZTogJ3RpdGxlJyB9KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxkaXY+JywgeyAnY2xhc3MnOiAnem0tY29tbWFuZCcgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGRpdj4nLCB7ICdjbGFzcyc6ICd6Zy1sZWZ0JyB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGE+JywgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2xhc3MnOiAnemctYnRuLWJsdWUgcmVsb2FkJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLCBocmVmOiAnamF2YXNjcmlwdDp2b2lkKDApOycKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgY2xpY2s6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRkID0gJCh0aGlzKS5jbG9zZXN0KCcubW9kYWwtZGlhbG9nJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZXIoMSwgTnVtYmVyKHVybC5kYXRhLnBhcmFtLnF1ZXJ5WydwYWdlJ10pLCAkZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLnRleHQoJ+mHjeaWsOiOt+WPlicpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8YT4nLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NsYXNzJzogJ3pnLWJ0bi1ibHVlIHNhdmUnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgaHJlZjogJ2phdmFzY3JpcHQ6dm9pZCgwKTsnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgY2xpY2s6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGRsZyA9ICQodGhpcykuY2xvc2VzdCgnLm1vZGFsLWRpYWxvZy1jb250ZW50JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsICRsaW5rcyA9ICRkbGcuZmluZCgnLml6aGlodS1jb2xsZWN0aW9uLWxpbmtzJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsICRsaW5rc1Bvc3QgPSAkZGxnLmZpbmQoJy5pemhpaHUtY29sbGVjdGlvbi1saW5rcy1wb3N0JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsICRsaW5rc1RpdGxlID0gJGxpbmtzUG9zdC5uZXh0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsICRmb3JtID0gJGxpbmtzUG9zdC5wYXJlbnQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgbGlua3MgPSAnJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsaW5rcy5maW5kKCdsaSBhJykuZWFjaChmdW5jdGlvbihpLCBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rcyArPSBlLmdldEF0dHJpYnV0ZSgnaHJlZicpICsgJ1xuJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbGlua3NQb3N0LnZhbChsaW5rcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxpbmtzVGl0bGUudmFsKCQoJyN6aC1mYXYtaGVhZC10aXRsZSwuem0tcHJvZmlsZS1oZWFkZXItbWFpbiAudGl0bGUtc2VjdGlvbiBhLm5hbWUnKS50ZXh0KCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRmb3JtLnN1Ym1pdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkudGV4dCgn5L+d5a2YJykpCiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICApLmFwcGVuZFRvKGRvY3VtZW50LmJvZHkpCiAgICAgICAgICAgICAgICAuZHJhZ2dhYmxlKHsgaGFuZGxlOiAnLm1vZGFsLWRpYWxvZy10aXRsZS1kcmFnZ2FibGUnIH0pCgogICAgICAgICAgICBpZih0aGlzLiRkbGcubGVuZ3RoKQogICAgICAgICAgICAgICAgcmV0VmFsID0gdHJ1ZQoKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJldFZhbAogICAgfQoKICAgIHRoaXMuc3RhcnQgPSBmdW5jdGlvbigkZCkgewogICAgICAgIGlmICgkKCcjemgtZ2xvYmFsLXNwaW5uZXI6dmlzaWJsZScpLmxlbmd0aCkgcmV0dXJuCiAgICAgICAgaWYgKCEkZCkgJGQgPSB0aGlzLiRkbGcKICAgICAgICBpZiAoISRkKSByZXR1cm4KICAgICAgICBpZiAoISQoJy5pemhpaHUtY29sbGVjdGlvbi1saW5rcycsICRkKS5jaGlsZHJlbigpLmxlbmd0aCkgewogICAgICAgICAgICBoYW5kbGVyKDEsIE51bWJlcih1cmwuZGF0YS5wYXJhbS5xdWVyeVsncGFnZSddKSwgJGQpCiAgICAgICAgfQogICAgfQoKfQoKLyoqCiAqIOWbnuetlOmhtQogKi8KCiAgaWYocGFnZUlzLkFuc3dlcil7Cgp2YXIgJGxibFF1ZXN0aW9uTWV0YT0kKCcjemgtcXVlc3Rpb24tbWV0YS13cmFwJykvL3F1ZXN0aW9uX21ldGEKOwoKICAgIHZhciAkcXVlc3Rpb25XcmFwPSQoJyN6aC1xdWVzdGlvbi1tZXRhLXdyYXAnKTsKICAgICRxdWVzdGlvbldyYXAuY2hpbGRyZW4oJy5wYW5lbC1jb250YWluZXInKS5iaW5kKCdET01Ob2RlSW5zZXJ0ZWQnLGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICB3aW5kb3cuaVpoaWh1LkNvbW1lbnQucHJvY2Vzc0NvbW1lbnQoJChldmVudC50YXJnZXQpKTsKICAgIH0pOwogICAgaWYod2luZG93LmlaaGlodS5Db21tZW50LlJpZ2h0Q29tbWVudCl7CiAgICAgICAgLy8kcXVlc3Rpb25XcmFwLmNoaWxkcmVuKCcubWV0YS1pdGVtW25hbWU9YWRkY29tbWVudF0nKS5wcmVwZW5kVG8oJHF1ZXN0aW9uV3JhcCk7CiAgICAgICAgd2luZG93LmlaaGlodS5Db21tZW50LnByb2Nlc3NDb21tZW50QnV0dG9uKCRxdWVzdGlvbldyYXApOwogICAgICAgIGlmKCEkKCcjaXpoX1F1ZXN0aW9uU2hhZG93JykubGVuZ3RoKXsKICAgICAgICAgICAgJCgnPGRpdj4nLHsnY2xhc3MnOidpemhfYm94U2hhZG93JyxpZDonaXpoX1F1ZXN0aW9uU2hhZG93J30pLmNzcyh7CiAgICAgICAgICAgICAgICAnei1pbmRleCc6ICctMScKICAgICAgICAgICAgICAsICdwb3NpdGlvbic6ICdyZWxhdGl2ZScKICAgICAgICAgICAgICAsICd0b3AnOiAtMjUKICAgICAgICAgICAgICAsICdtYXJnaW4tbGVmdCc6IC0zMgogICAgICAgICAgICB9KS5wcmVwZW5kVG8oJ2JvZHk+Lnp1LW1haW46Zmlyc3QnKS5oaWRlKCk7CiAgICAgICAgfSAgIAogICAgfQoKICAgIC8vcHJvY2VzcyBlYWNoIGFuc3dlcgogICAgdmFyICRsaXN0QW5zd2Vycz0kKCcuem0taXRlbS1hbnN3ZXIsLmZlZWQtaXRlbScsJyN6aC1xdWVzdGlvbi1hbnN3ZXItd3JhcCcpOwogICAgaWYoJGxpc3RBbnN3ZXJzJiYkbGlzdEFuc3dlcnMubGVuZ3RoKXsKICAgICAgICAkbGlzdEFuc3dlcnMuZWFjaChmdW5jdGlvbihpLGUpewogICAgICAgICAgICB3aW5kb3cuaVpoaWh1LkFuc3dlci5wcm9jZXNzQW5zd2VyKCQoZSksbnVsbAogICAgICAgICAgICAgICwgaXpoQXV0aG9yUmVhcgogICAgICAgICAgICAgICwgZmFsc2UpOwogICAgICAgIH0pOwogICAgfQoKICAgICQoJyN6aC1xdWVzdGlvbi1hbnN3ZXItd3JhcCcpLmJpbmQoJ0RPTU5vZGVJbnNlcnRlZCcsZnVuY3Rpb24oZXZlbnQpewogICAgICAgIHZhciAkbmE9JChldmVudC50YXJnZXQpLmZpbHRlcignLnptLWl0ZW0tYW5zd2VyJyk7CiAgICAgICAgaWYoJG5hLmxlbmd0aCl7CiAgICAgICAgICAgIHdpbmRvdy5pWmhpaHUuQW5zd2VyLnByb2Nlc3NBbnN3ZXIoJG5hLG51bGwKICAgICAgICAgICAgICAgICwgaXpoQXV0aG9yUmVhcgogICAgICAgICAgICAgICAgLCBmYWxzZSk7CiAgICAgICAgfQogICAgfSk7CgogICAgdmFyICRjbT0kKCcuem0tY29tbWVudC1ib3gnLCRxdWVzdGlvbldyYXApOwogICAgaWYoJGNtLmxlbmd0aCAmJiAkY20uaXMoJzp2aXNpYmxlJykpewogICAgCXZhciBmb2N1c05hbWUgPSBpWmhpaHUuQ29tbWVudC5zY3JvbGxGb2N1c0NvbW1lbnRPblBhZ2VMb2FkKCRjbSk7CgogICAgCWlaaGlodS5Db21tZW50Lm1ldGFTY3JvbGxUb1ZpZXdCb3R0b20oJGNtLmNsb3Nlc3QoJy56bS1pdGVtLW1ldGEnKSxmdW5jdGlvbigpewogICAgICAgICAgICBpWmhpaHUuQ29tbWVudC5wcm9jZXNzQ29tbWVudCgkY20sIGZvY3VzTmFtZSk7CiAgICAgICAgfSk7CiAgICB9CiAgfQoKLyoqCiAqIOaUtuiXj+mhtQogKi8KICBpZihwYWdlSXMuQ29sbGVjdGlvbil7CiAgICAvL+a3u+WKoOaMiemSrgogICAgJCgnI3poLWxpc3QtbWV0YS13cmFwJykKICAgICAgLmFwcGVuZCgkKCc8c3Bhbj4nLCB7ICdjbGFzcyc6ICd6Zy1idWxsJyB9KS50ZXh0KCfigKInKSkKICAgICAgLmFwcGVuZCgkKCc8YT4nLCB7IGhyZWY6ICdqYXZhc2NyaXB0OjsnLCBpZDogJ2dldEFsbExpbmtzJyB9KS50ZXh0KCflnLDlnYDmuIXljZUnKSk7CgogICAgdmFyIGJ0biA9ICQoJyNnZXRBbGxMaW5rcycpOwogICAgdmFyIHJlc3VsdCA9IFtdOwogICAgICAgIAogICAgLy/ms6jlhozngrnlh7vkuovku7YKICAgIGJ0bi5jbGljayhmdW5jdGlvbigpewogICAgICB2YXIgYWxsTGlua3NDb2xsZWN0aW9uPW5ldyBhbGxMaW5rcygnQ29sbGVjdGlvbnMnLCcjemgtbGlzdC1hbnN3ZXItd3JhcCcsJ+aUtuiXj+WkueWGheWuuScpOwoJICBpZighYWxsTGlua3NDb2xsZWN0aW9uLmluaXREaWFsb2coKSlyZXR1cm47CiAgICAgICQoJy5tb2RhbC1kaWFsb2ctYmcnKS5zaG93KCk7CiAgICAgIHZhciB5ID0gKCR3aW4uaGVpZ2h0KCkgLSBhbGxMaW5rc0NvbGxlY3Rpb24uJGRsZy53aWR0aCgpKSAvIDIKICAgICAgICAsIHggPSAoJHdpbi53aWR0aCgpIC0gYWxsTGlua3NDb2xsZWN0aW9uLiRkbGcud2lkdGgoKSkgLyAyCiAgICAgIDsKICAgICAgYWxsTGlua3NDb2xsZWN0aW9uLiRkbGcuY3NzKHsndG9wJzogeSwgJ2xlZnQnOiB4fSkuZmFkZUluKCdzbG93Jyk7CiAgICAgIGFsbExpbmtzQ29sbGVjdGlvbi5zdGFydCgpOwogICAgfSk7CiAgfQogIGlmKHBhZ2VJcy5BbnN3ZXJzKXsKICAgIC8v5re75Yqg5oyJ6ZKuCiAgICAkKCcuem0tcHJvZmlsZS1zZWN0aW9uLW5hbWUnKQogICAgICAuYXBwZW5kKCQoJzxzcGFuPicsIHsgJ2NsYXNzJzogJ3pnLWJ1bGwnIH0pLnRleHQoJ+KAoicpKQogICAgICAuYXBwZW5kKCQoJzxhPicsIHsgaHJlZjogJ2phdmFzY3JpcHQ6OycsIGlkOiAnZ2V0QWxsTGlua3MnIH0pLnRleHQoJ+WcsOWdgOa4heWNlScpKTsKCiAgICB2YXIgYnRuID0gJCgnI2dldEFsbExpbmtzJyk7CiAgICB2YXIgcmVzdWx0ID0gW107CiAgICAgICAgCiAgICAvL+azqOWGjOeCueWHu+S6i+S7tgogICAgYnRuLmNsaWNrKGZ1bmN0aW9uKCl7CiAgICAgIHZhciBhbGxMaW5rc0Fuc3dlcnM9bmV3IGFsbExpbmtzKCdBbnN3ZXJzJywnI3poLXByb2ZpbGUtYW5zd2VyLWxpc3QnLCfnlKjmiLflm57nrZQnKTsKCSAgaWYoIWFsbExpbmtzQW5zd2Vycy5pbml0RGlhbG9nKCkpcmV0dXJuOwogICAgICAkKCcubW9kYWwtZGlhbG9nLWJnJykuc2hvdygpOwogICAgICB2YXIgeSA9ICgkd2luLmhlaWdodCgpIC0gYWxsTGlua3NBbnN3ZXJzLiRkbGcud2lkdGgoKSkgLyAyCiAgICAgICAgLCB4ID0gKCR3aW4ud2lkdGgoKSAtIGFsbExpbmtzQW5zd2Vycy4kZGxnLndpZHRoKCkpIC8gMgogICAgICA7CiAgICAgIGFsbExpbmtzQW5zd2Vycy4kZGxnLmNzcyh7J3RvcCc6IHksICdsZWZ0JzogeH0pLmZhZGVJbignc2xvdycpOwogICAgICBhbGxMaW5rc0Fuc3dlcnMuc3RhcnQoKTsKICAgIH0pOwogIH0KCiAgaWYocGFnZUlzLk15Q29sbGVjdGlvbiYmd2luZG93LmlaaGlodS5RdWlja0Zhdm8pewogICAgdmFyICRmYXZJdGVtcz0kKCcjemgtZmF2bGlzdHMtd3JhcCcpLmNoaWxkcmVuKCcuem0taXRlbScpOwogICAgJGZhdkl0ZW1zLmVhY2goZnVuY3Rpb24oaSxlKXsKICAgIH0pOwogIH0KCi8qCiAqIOmmlumhtQogKi8KICAgIHZhciAkdG9wc3Rvcnk9JCgnI2lzLXRvcHN0b3J5MicpCiAgICAgICwgaXNUb3BTdG9yeT0kdG9wc3RvcnkmJiR0b3BzdG9yeS5sZW5ndGgKICAgICAgLCBwcm9wRmVlZFR5cGU9J2RhdGEtdHlwZScvLzonZGF0YS1mZWVkdHlwZScKICAgICAgLCAkbGJsSG9tZVRpdGxlPSQoJyN6aC1ob21lLWxpc3QtdGl0bGUnKS8vYWN0aXZpdHlfY2FwdGlvbgogICAgICAsICRidG5OZXdBY3Rpdml0eT0kKCcjemgtbWFpbi1mZWVkLWZyZXNoLWJ1dHRvbicpLy9uZXdfYWN0aXZpdHkKICAgICAgLCAkZmVlZExpc3Q9JCgnLnpoLWdlbmVyYWwtbGlzdCcpLy9mZWVkX2xpc3QKICAgICAgLCAkdG9wTGlua0hvbWU9JCgnI3poLXRvcC1saW5rLWhvbWUnKQogICAgICAsICRmaWx0ZXI9Ly9pc1RvcFN0b3J5PwogICAgICAgICAgICAkKCc8c3Bhbj4nLCB7ICdjbGFzcyc6J2l6aC1mZWVkcy1maWx0ZXInIH0pCiAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxhPicsIHsgJ2NsYXNzJzogJ2l6aC1idXR0b24gaXpoLWZlZWRzLWZpbHRlci1vcHRpb24nLCAnc2hvd0ZlZWRzJzogJ3EnIH0pCiAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8aT4nLCB7ICdjbGFzcyc6ICd6Zy1pY29uJyB9KSkKICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCfpl67popgnKQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8YT4nLCB7ICdjbGFzcyc6ICdpemgtYnV0dG9uIGl6aC1mZWVkcy1maWx0ZXItb3B0aW9uJywgJ3Nob3dGZWVkcyc6ICdhJyB9KQogICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGk+JywgeyAnY2xhc3MnOiAnemctaWNvbicgfSkpCiAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgn5Zue562UJykKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGE+JywgeyAnY2xhc3MnOiAnaXpoLWJ1dHRvbiBpemgtZmVlZHMtZmlsdGVyLW9wdGlvbicsICdzaG93RmVlZHMnOiAncCxyJywgJ2RhdGEtdGlwJzogJ3MkdCTkuJPmoI/jgIHlnIbmoYwnIH0pCiAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8aT4nLCB7ICdjbGFzcyc6ICd6Zy1pY29uJyB9KSkKICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCflhbbku5YnKQogICAgICAgICAgICAgICAgKQogICAgICAsICRmaWx0ZXJJbmZvPSQoJzxhPicseydjbGFzcyc6J2l6aC1mZWVkcy1maWx0ZXItaW5mbyBub3RoaW5nJyxocmVmOidqYXZhc2NyaXB0OnZvaWQoMCk7J30pLm9uKCdjbGljaycsZnVuY3Rpb24oKXskZmlsdGVyLnRyaWdnZXIoJGZpbHRlci5pcygnOmhpZGRlbicpfHwkZmlsdGVyLmF0dHIoJ2RvaW5nJyk9PSdoaWRlJz8nc2hvdyc6J2hpZGUnKTt9KQogICAgICAsIFNob3dGZWVkcz1mdW5jdGlvbih0eXBlLGVuYWJsZSl7CiAgICAgICAgICAgIHZhciBpZD0iaXpoQ1NTX0ZpbHRlckZlZWRfIit0eXBlCiAgICAgICAgICAgICAgLCBuZD1kb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCkKICAgICAgICAgICAgOwogICAgICAgICAgICBpZihlbmFibGUpewogICAgICAgICAgICAgICAgaWYobmQpbmQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChuZCk7CiAgICAgICAgICAgIH1lbHNlIGlmKGhlYWRzLmxlbmd0aCl7CiAgICAgICAgICAgICAgICBpZighbmQpewogICAgICAgICAgICAgICAgICAgIG5kPV9kb2MuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTsKICAgICAgICAgICAgICAgICAgICBuZC50eXBlPSd0ZXh0L2Nzcyc7CiAgICAgICAgICAgICAgICAgICAgbmQuaWQ9aWQ7CiAgICAgICAgICAgICAgICAgICAgbmQuYXBwZW5kQ2hpbGQoX2RvYy5jcmVhdGVUZXh0Tm9kZSgnLmZlZWQtaXRlbVsnK3Byb3BGZWVkVHlwZSsnXj0iJyt0eXBlKyciXXtkaXNwbGF5Om5vbmV9JykpOwogICAgICAgICAgICAgICAgICAgIGhlYWRzWzBdLmFwcGVuZENoaWxkKG5kKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8ve1JPVU5EVEFCTEVfQUREX1JFTEFURUQ6ICJyb3VuZHRhYmxlIixBUlRJQ0xFX1ZPVEVfVVA6ICJwb3N0X3ZvdGUiLEFSVElDTEVfQ1JFQVRFOiAicG9zdF9jcmVhdGUiLFJFQ09NTUVOREVEOiAiZmVlZF9yZWNvbW1lbmRlZCIsUVVFU1RJT05fRk9MTE9XOiAiZmVlZF9xdWVzdGlvbl9mb2xsb3ciLFFVRVNUSU9OX0NSRUFURTogImZlZWRfcXVlc3Rpb24iLEFOU1dFUl9WT1RFX1VQOiAiZmVlZF9hbnN3ZXJfdm90ZSIsQU5TV0VSX0NSRUFURTogImZlZWRfYW5zd2VyX2Fuc3dlciJ9OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAsIHJlZnJlc2hGaWx0ZXJJbmZvPWZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHZhciBjb3VudD0kZmVlZExpc3QuY2hpbGRyZW4oJy5mZWVkLWl0ZW06aGlkZGVuJykubGVuZ3RoCiAgICAgICAgICAgICAgLCBpbmZvPScgPui/h+a7pOmAiemhuTwnCiAgICAgICAgICAgIDsKICAgICAgICAgICAgaWYoY291bnQpewogICAgICAgICAgICAgICAgaW5mbz0n77yIJytjb3VudCsn5p2h5Yqo5oCB6KKr6ZqQ6JeP77yJJzsKICAgICAgICAgICAgICAgICRmaWx0ZXJJbmZvLnJlbW92ZUNsYXNzKCdub3RoaW5nJykuY3NzKHtkaXNwbGF5OicnfSk7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgJGZpbHRlckluZm8uYWRkQ2xhc3MoJ25vdGhpbmcnKTsKICAgICAgICAgICAgfSAgIAogICAgICAgICAgICAkZmlsdGVySW5mby50ZXh0KGluZm8pOwogICAgICAgIH0KICAgICAgLCBmZWVkc0NvbHVtbnM9ZnVuY3Rpb24oKXsgLy8gSW1wbGVtZW50ZWQgYnkgbW9ybGV5LCBtb2RpZmllZCBieSB1bm9negogICAgICAgICAgICAvL+WKqOaAgeeahOexu+WeiwogICAgICAgICAgICB2YXIgZmVlZFR5cGVzID0gLy9pc1RvcFN0b3J5PwogICAgICAgICAgICAgICAgW3sKICAgICAgICAgICAgICAgICBpbmRleDogMCwKICAgICAgICAgICAgICAgICBuYW1lOiAn5YWo6YOoJywKICAgICAgICAgICAgICAgICBjb2RlTmFtZTogJycKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICBpbmRleDogMSwKICAgICAgICAgICAgICAgICBuYW1lOiAn6Zeu6aKYJywKICAgICAgICAgICAgICAgICBjb2RlTmFtZTogJ3EnCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgaW5kZXg6IDIsCiAgICAgICAgICAgICAgICAgbmFtZTogJ+WbnuetlCcsCiAgICAgICAgICAgICAgICAgY29kZU5hbWU6ICdhJwogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgIGluZGV4OiAzLAogICAgICAgICAgICAgICAgIG5hbWU6ICfkuJPmoI8nLAogICAgICAgICAgICAgICAgIGNvZGVOYW1lOiAncCcKICAgICAgICAgICAgICAgIH1dOwogICAgICAgICAgICAKICAgICAgICAgICAgLy/oh6rlrprkuYkgQ1NTIOWIsCBoZWFkCiAgICAgICAgICAgIHZhciBzdHlsZXMgPSBbXTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHN0eWxlcy5wdXNoKCcuemEtZmlsdGVye2Rpc3BsYXk6IGlubGluZS1ibG9jazttYXJnaW4tcmlnaHQ6MTBweDtjdXJzb3I6cG9pbnRlcjtjb2xvcjojOTk5O30nKTsKICAgICAgICAgICAgc3R5bGVzLnB1c2goJy56YS1maWx0ZXIuYWN0aXZle2NvbG9yOiMyNTk7fScpOwogICAgICAgICAgICBzdHlsZXMucHVzaCgnLnphLWZpbHRlcj4uemctbnVtLmhpZGV7ZGlzcGxheTpub25lO30nKTsKICAgICAgICAgICAgCiAgICAgICAgICAgICQoJzxzdHlsZS8+JykudGV4dChzdHlsZXMuam9pbignJykpLmFwcGVuZFRvKCdoZWFkJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICB2YXIgJHpoSG9tZUxpc3RUaXRsZSA9ICRsYmxIb21lVGl0bGU7CiAgICAgICAgICAgIAogICAgICAgICAgICAvL+agueaNruexu+Wei+a3u+WKoOi/h+a7pOaMiemSriDliLAgI3poLWhvbWUtbGlzdC10aXRsZQogICAgICAgICAgICB2YXIgZmlsdGVyQnRucyA9IFtdCiAgICAgICAgICAgICAgLCBpID0gZmVlZFR5cGVzLmxlbmd0aDsKICAgICAgICAgICAgCiAgICAgICAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICAgICAgIGZpbHRlckJ0bnMucHVzaCgKICAgICAgICAgICAgICAgICAkKCc8c3Bhbj4nKS5hZGRDbGFzcygnemEtZmlsdGVyJykKICAgICAgICAgICAgICAgICAuYXR0cigndHlwZUluZGV4JywgZmVlZFR5cGVzW2ldLmluZGV4KQogICAgICAgICAgICAgICAgIC50ZXh0KGZlZWRUeXBlc1tpXS5uYW1lKQogICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHNwYW4+JywgeyAnY2xhc3MnOiAnemctbnVtJyB9KS5hZGRDbGFzcygnaGlkZScpKQogICAgICAgICAgICAgICAgIC5vbignY2xpY2snLCB0b2dnbGVGZWVkVHlwZSkKICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGZpbHRlckJ0bnMucmV2ZXJzZSgpOwogICAgICAgICAgICBmaWx0ZXJCdG5zWzBdLmFkZENsYXNzKCdhY3RpdmUnKTsKCiAgICAgICAgICAgICR6aEhvbWVMaXN0VGl0bGUuY29udGVudHMoKS5maWx0ZXIoZnVuY3Rpb24oaSxlKXsKICAgICAgICAgICAgICAgIHJldHVybiAoZSE9bnVsbCYmKGUubm9kZVZhbHVlfHwnJykuaW5kZXhPZign5pyA5paw5Yqo5oCBJyk+PTApCiAgICAgICAgICAgIH0pLnJlbW92ZSgpCiAgICAgICAgICAgICR6aEhvbWVMaXN0VGl0bGUuZmluZCgnaScpLmVxKDApLmFmdGVyKGZpbHRlckJ0bnMpLnJlbW92ZSgpOwogICAgICAgICAgICAKICAgICAgICAgICAgdmFyICR0YXJnZXRaZXJvID0gZmlsdGVyQnRuc1swXS5maW5kKCcuemctbnVtJykKICAgICAgICAgICAgICAsIGN1cmZlZWRUeXBlQ29kZU5hbWUgPSAnJwogICAgICAgICAgICAKICAgICAgICAgICAgZnVuY3Rpb24gdHlwZU1hdGNoKCRlbGVtKSB7CiAgICAgICAgICAgICBpZiAoY3VyZmVlZFR5cGVDb2RlTmFtZSA9PSAnJykgewogICAgICAgICAgICAgICAgICRlbGVtLnNob3coKTsKICAgICAgICAgICAgIH0gZWxzZSBpZiAoMCA8PSAkZWxlbS5hdHRyKHByb3BGZWVkVHlwZSkuaW5kZXhPZihjdXJmZWVkVHlwZUNvZGVOYW1lKSkgewogICAgICAgICAgICAgICAgICRlbGVtLnNob3coKTsKICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgJGVsZW0uaGlkZSgpOwogICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvL+aMiemSruS6i+S7tgogICAgICAgICAgICBmdW5jdGlvbiB0b2dnbGVGZWVkVHlwZSgpIHsKICAgICAgICAgICAgIHZhciAkY2xpY2tlZCA9ICQodGhpcyk7CiAgICAgICAgICAgICAkY2xpY2tlZE51bSA9ICRjbGlja2VkLmZpbmQoJy56Zy1udW0nKTsKICAgICAgICAgICAgIC8vIOS6pOS6kuaViOaenAogICAgICAgICAgICAgZmlsdGVyQnRucy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHsKICAgICAgICAgICAgICAgICBpdGVtLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsKICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgICRjbGlja2VkLmFkZENsYXNzKCdhY3RpdmUnKTsKICAgICAgICAgICAgCiAgICAgICAgICAgICBpZiAoJGNsaWNrZWQuYXR0cigndHlwZUluZGV4JykgPT0gMCkgewogICAgICAgICAgICAgICAgICQoJy56Zy1udW0nLCAnLnphLWZpbHRlcicpLnRleHQoJycpLmFkZENsYXNzKCdoaWRlJyk7CiAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgIHZhciB0b3RhbFVucmVhZCA9IChwYXJzZUludCgkdGFyZ2V0WmVyby50ZXh0KCkpIHx8IDApIC0gKHBhcnNlSW50KCRjbGlja2VkTnVtLnRleHQoKSkgfHwgMCk7CiAgICAgICAgICAgICAgICAgaWYgKHRvdGFsVW5yZWFkICE9IDApIHsKICAgICAgICAgICAgICAgICAgICAgJHRhcmdldFplcm8udGV4dCh0b3RhbFVucmVhZCk7CiAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgJHRhcmdldFplcm8udGV4dCgnJykuYWRkQ2xhc3MoJ2hpZGUnKTsKICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICRjbGlja2VkTnVtLnRleHQoJycpLmFkZENsYXNzKCdoaWRlJyk7CiAgICAgICAgICAgICB9CiAgICAgICAgICAgICBjdXJmZWVkVHlwZUNvZGVOYW1lID0gZmVlZFR5cGVzWyRjbGlja2VkLmF0dHIoJ3R5cGVJbmRleCcpXS5jb2RlTmFtZTsKICAgICAgICAgICAgIC8vIOS/oeaBr+a1gei/h+a7pAogICAgICAgICAgICAgJCgnLmZlZWQtaXRlbScpLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgdHlwZU1hdGNoKCQodGhpcykpOwogICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGZ1bmN0aW9uIGdldFR5cGVJbmRleEJ5Q29kZU5hbWUoY29kZU5hbWUpIHsKICAgICAgICAgICAgIHZhciBpID0gZmVlZFR5cGVzLmxlbmd0aDsKICAgICAgICAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICAgICAgICAgICBpZiAoY29kZU5hbWUgPT0gZmVlZFR5cGVzW2ldLmNvZGVOYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpOwogICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIHZhciBNdXRhdGlvbk9ic2VydmVyID0gd2luZG93Lk11dGF0aW9uT2JzZXJ2ZXIgfHwgd2luZG93LldlYktpdE11dGF0aW9uT2JzZXJ2ZXI7CiAgICAgICAgICAgIAogICAgICAgICAgICAvL+ebkeWQrOaOqOmAgQogICAgICAgICAgICB2YXIgaGFzTmV3RmVlZCA9IGZhbHNlOwogICAgICAgICAgICAvL2NyZWF0ZSBhbiBvYnNlcnZlciBpbnN0YW5jZQogICAgICAgICAgICB2YXIgb2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihmdW5jdGlvbihtdXRhdGlvbnMpIHsKICAgICAgICAgICAgIGlmICggISEgcGFyc2VJbnQoJGJ0bk5ld0FjdGl2aXR5LnRleHQoKSkpIHsKICAgICAgICAgICAgICAgICBtdXRhdGlvbnMuZm9yRWFjaChmdW5jdGlvbihtdXRhdGlvbikgewogICAgICAgICAgICAgICAgICAgICBpZiAobXV0YXRpb24udHlwZSA9PT0gJ2NoaWxkTGlzdCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdIYXMgTmV3IEZlZWQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgIC8vIOacieaWsOaOqOmAgeWImeinpuWPkeS5iwogICAgICAgICAgICAgICAgICAgICAgICAgaGFzTmV3RmVlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAkYnRuTmV3QWN0aXZpdHkudGV4dCgnJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAkLndoZW4oJGJ0bk5ld0FjdGl2aXR5WzBdLmNsaWNrKCkpLmRvbmUoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFzTmV3RmVlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDEwMDApOwogICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgLy9wYXNzIGluIHRoZSB0YXJnZXQgbm9kZSwgYXMgd2VsbCBhcyB0aGUgb2JzZXJ2ZXIgb3B0aW9ucwogICAgICAgICAgICBvYnNlcnZlci5vYnNlcnZlKAogICAgICAgICAgICAgJGJ0bk5ld0FjdGl2aXR5WzBdLCB7CiAgICAgICAgICAgICAgICAgY2hpbGRMaXN0OiB0cnVlCiAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8v55uR5ZCs5o+S5YWlCiAgICAgICAgICAgICRmZWVkTGlzdC5vbigiRE9NTm9kZUluc2VydGVkIiwgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgdmFyICRzZWxmID0gJChlLnRhcmdldCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAgaWYgKCRzZWxmLmhhc0NsYXNzKCdmZWVkLWl0ZW0nKSkgewogICAgICAgICAgICAgICAgIGlmIChoYXNOZXdGZWVkKSB7CiAgICAgICAgICAgICAgICAgICAgICRzZWxmLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICAgdmFyICR0YXJnZXQgPSBmaWx0ZXJCdG5zW2dldFR5cGVJbmRleEJ5Q29kZU5hbWUoJHNlbGYuYXR0cihwcm9wRmVlZFR5cGUpKV0uZmluZCgnLnpnLW51bScpOwogICAgICAgICAgICAgICAgICAgICAkdGFyZ2V0LnRleHQoKHBhcnNlSW50KCR0YXJnZXQudGV4dCgpKSB8fCAwKSArIDEpLnJlbW92ZUNsYXNzKCdoaWRlJyk7CiAgICAgICAgICAgICAgICAgICAgICR0YXJnZXRaZXJvLnRleHQoKHBhcnNlSW50KCR0YXJnZXRaZXJvLnRleHQoKSkgfHwgMCkgKyAxKS5yZW1vdmVDbGFzcygnaGlkZScpOwogICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgIHR5cGVNYXRjaCgkc2VsZik7CiAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAsIGhvbWVGZWVkcz1mdW5jdGlvbihpemhIb21lRmVlZHNDb2x1bW5zKXsKICAgICAgICAgICAgaWYgKGl6aEhvbWVGZWVkc0NvbHVtbnMpewogICAgICAgICAgICAgICAgZmVlZHNDb2x1bW5zKCk7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgJGZpbHRlci5jaGlsZHJlbignLml6aC1mZWVkcy1maWx0ZXItb3B0aW9uJykuYWRkQ2xhc3MoJ29uJykuY2xpY2soZnVuY3Rpb24oZXZlbnQpewogICAgICAgICAgICAgICAgICAgIHZhciBpPTAKICAgICAgICAgICAgICAgICAgICAgICwgJGU9JCh0aGlzKQogICAgICAgICAgICAgICAgICAgICAgLCBmcz0kZS5hdHRyKCdzaG93RmVlZHMnKQogICAgICAgICAgICAgICAgICAgICAgLCBmYT1mcy5zcGxpdCgnLCcpCiAgICAgICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgICAgICQoJy5pemgtZmVlZHMtZmlsdGVyLW9wdGlvbltzaG93RmVlZHM9IicrZnMrJyJdJykudG9nZ2xlQ2xhc3MoJ29uJyk7CiAgICAgICAgICAgICAgICAgICAgZm9yKDtpPGZhLmxlbmd0aDtpKyspewogICAgICAgICAgICAgICAgICAgICAgICBTaG93RmVlZHMoZmFbaV0sJGUuaXMoJy5vbicpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmVmcmVzaEZpbHRlckluZm8oKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgaWYoJHRvcExpbmtIb21lLmxlbmd0aCl7CiAgICAgICAgICAgICAgICAgICAgdmFyICRmaWx0ZXIyPSQoJzxkaXY+JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jc3Moe3Bvc2l0aW9uOidhYnNvbHV0ZScsYm9yZGVyOicxcHggc29saWQgIzc3NycsYmFja2dyb3VuZENvbG9yOicjZmZmJ30pLmhpZGUoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkZmlsdGVyLmNsb25lKHRydWUsdHJ1ZSkuY3NzKHtkaXNwbGF5OidibG9jayd9KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5vbignc2hvdycsZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGU9JCh0aGlzKS5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJGUuaXMoJzpoaWRkZW4nKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGUuY3NzKHtkaXNwbGF5OicnLG9wYWNpdHk6MH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGUuYW5pbWF0ZSh7b3BhY2l0eToxfSwnc2xvdycpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5vbignaGlkZScsZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGU9JCh0aGlzKS5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGUuZmFkZU91dCgnc2xvdycpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICA7CiAgICAgICAgICAgICAgICAgICAgJHRvcExpbmtIb21lLmFmdGVyKCRmaWx0ZXIyKS5wYXJlbnQoKQogICAgICAgICAgICAgICAgICAgICAgICAub24oJ21vdXNlZW50ZXInLGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkZT0kKHRoaXMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgJGY9JGUuY2hpbGRyZW4oKS5sYXN0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRmLnRyaWdnZXIoJ3Nob3cnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRmaWx0ZXJJbmZvLmZpbHRlcignLm5vdGhpbmcnKS5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIC5vbignbW91c2VsZWF2ZScsZnVuY3Rpb24oZXZlbnQpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRlPSQodGhpcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLCAkZj0kZS5jaGlsZHJlbigpLmxhc3QoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGYudHJpZ2dlcignaGlkZScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGZpbHRlckluZm8uZmlsdGVyKCcubm90aGluZycpLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZigkbGJsSG9tZVRpdGxlLmxlbmd0aCl7CiAgICAgICAgICAgICAgICAgICAgJGZpbHRlckluZm8uY3NzKHsKICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheTonbm9uZScKICAgICAgICAgICAgICAgICAgICAgICwgdGV4dERlY29yYXRpb246J25vbmUnCiAgICAgICAgICAgICAgICAgICAgICAsIGN1cnNvcjoncG9pbnRlcicKICAgICAgICAgICAgICAgICAgICB9KS5pbnNlcnRCZWZvcmUoaXNUb3BTdG9yeT8kdG9wc3Rvcnk6JCgnI2ZlZWQtdmVyJykpOwogICAgICAgICAgICAgICAgICAgICRsYmxIb21lVGl0bGUuY3NzKHtvdmVyZmxvdzonaGlkZGVuJ30pCiAgICAgICAgICAgICAgICAgICAgICAgIC5wcmVwZW5kKCRmaWx0ZXIpCiAgICAgICAgICAgICAgICAgICAgICAgIC8vLmNoaWxkcmVuKCdpOmZpcnN0JykKICAgICAgICAgICAgICAgICAgICAgICAgLm9uKCdtb3VzZWVudGVyJyxmdW5jdGlvbihldmVudCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGU9JCh0aGlzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsICRmPSRlLmNoaWxkcmVuKCcuaXpoLWZlZWRzLWZpbHRlci1pbmZvLm5vdGhpbmcnKS5zdG9wKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRmLmlzKCc6aGlkZGVuJykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGYuY3NzKHtkaXNwbGF5OicnLG9wYWNpdHk6MH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZi5hbmltYXRlKHtvcGFjaXR5OjF9LCdmYXN0Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIC5vbignbW91c2VsZWF2ZScsZnVuY3Rpb24oZXZlbnQpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRlPSQodGhpcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLCAkZj0kZS5jaGlsZHJlbignLml6aC1mZWVkcy1maWx0ZXItaW5mby5ub3RoaW5nJykuc3RvcCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZi5mYWRlT3V0KCdmYXN0Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgICAgICRmaWx0ZXIuY3NzKHttYXJnaW5MZWZ0Oi0kZmlsdGVyLndpZHRoKCksZGlzcGxheTonbm9uZSd9KQogICAgICAgICAgICAgICAgICAgICAgICAub24oJ3Nob3cnLGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGU9JCh0aGlzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRlLmF0dHIoJ2RvaW5nJyk9PT0nc2hvdycpcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGUuYXR0cignZG9pbmcnLCdzaG93Jykuc3RvcCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJGUuaXMoJzpoaWRkZW4nKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZS5jc3Moe2Rpc3BsYXk6Jyd9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGUuYW5pbWF0ZSh7bWFyZ2luTGVmdDowfSwnc2xvdycsZnVuY3Rpb24oKXskKHRoaXMpLmNzcygnZGlzcGxheScsJycpLnJlbW92ZUF0dHIoJ2RvaW5nJyk7fSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIC5vbignaGlkZScsZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkZT0kKHRoaXMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJGUuYXR0cignZG9pbmcnKT09PSdoaWRlJylyZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZS5hdHRyKCdkb2luZycsJ2hpZGUnKS5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZS5hbmltYXRlKHttYXJnaW5MZWZ0Oi0kZmlsdGVyLndpZHRoKCl9LCdzbG93JyxmdW5jdGlvbigpeyQodGhpcykuY3NzKCdkaXNwbGF5Jywnbm9uZScpLnJlbW92ZUF0dHIoJ2RvaW5nJyk7fSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIC5vbignbW91c2VlbnRlcicsZnVuY3Rpb24oZXZlbnQpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRlPSQodGhpcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRlLnRyaWdnZXIoJ3Nob3cnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgLm9uKCdtb3VzZWxlYXZlJyxmdW5jdGlvbihldmVudCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGU9JCh0aGlzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGUudHJpZ2dlcignaGlkZScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIDsKICAgICAgICAgICAgICAgICAgICByZWZyZXNoRmlsdGVySW5mbygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgOwogICAgaWYocGFnZUlzLkhvbWV8fHBhZ2VJcy5EZWJ1dHMpewogICAgICAgICRmZWVkTGlzdC5maW5kKCcuZmVlZC1pdGVtJykuZWFjaChmdW5jdGlvbihpLGUpewogICAgICAgICAgICB3aW5kb3cuaVpoaWh1LkFuc3dlci5wcm9jZXNzQW5zd2VyKCQoZSksbnVsbAogICAgICAgICAgICAgICwgaXpoQXV0aG9yUmVhcgogICAgICAgICAgICAgICwgaXpoQXV0aG9yTGlzdAogICAgICAgICAgICApOwogICAgICAgIH0pOwogICAgICAgICRmZWVkTGlzdC5iaW5kKCdET01Ob2RlSW5zZXJ0ZWQnLGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICAgICAgdmFyICRpdGVtPSQoZXZlbnQudGFyZ2V0KTsKICAgICAgICAgICAgaWYoJGl0ZW0uaXMoJy5mZWVkLWl0ZW0nKSl7CiAgICAgICAgICAgICAgICB3aW5kb3cuaVpoaWh1LkFuc3dlci5wcm9jZXNzQW5zd2VyKCRpdGVtLG51bGwKICAgICAgICAgICAgICAgICAgLCAkYm9keS5hdHRyKCdpemhBdXRob3JSZWFyJyk9PScxJwogICAgICAgICAgICAgICAgICAsICRib2R5LmF0dHIoJ2l6aEF1dGhvckxpc3QnKT09JzEnCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgcmVmcmVzaEZpbHRlckluZm8oKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQoKICAgIGlmIChwYWdlSXMuSG9tZSl7CiAgICAJdmFyIGJIb21lRmVlZHNDb2x1bW5zPXdpbmRvdy5pWmhpaHUuY29uZmlnWydIb21lRmVlZHNDb2x1bW5zJ10KICAgICAgICBpZiAoaXpoSG9tZU5vdGkmJiFiSG9tZUZlZWRzQ29sdW1ucwogICAgICAgICAmJiAkbGJsSG9tZVRpdGxlLmxlbmd0aAogICAgICAgICAmJiAkYnRuTmV3QWN0aXZpdHkubGVuZ3RoCiAgICAgICAgKXsKICAgICAgICAgICAgJGxibEhvbWVUaXRsZS5jc3MoewogICAgICAgICAgICAgICAgJ2Zsb2F0JzonbGVmdCcKICAgICAgICAgICAgICAsICdtYXJnaW4tYm90dG9tJzonMnB4JwogICAgICAgICAgICAgICwgJ2xpbmUtaGVpZ2h0JzonMzJweCcKICAgICAgICAgICAgICAsICd3aWR0aCc6JzEwMCUnCiAgICAgICAgICAgICAgfSkubmV4dCgpLmNzcygnY2xlYXInLCdib3RoJyk7CiAgICAgICAgICAgICRidG5OZXdBY3Rpdml0eS5jc3MoewogICAgICAgICAgICAgICAgJ2Zsb2F0JzoncmlnaHQnCiAgICAgICAgICAgICAgLCAnbWFyZ2luJzonMCcKICAgICAgICAgICAgICAsICdsaW5lLWhlaWdodCc6JzIycHgnCiAgICAgICAgICAgIH0pLmFwcGVuZFRvKCRsYmxIb21lVGl0bGUpOwogICAgICAgIH0KICAgICAgICBob21lRmVlZHMoYkhvbWVGZWVkc0NvbHVtbnMpOwogICAgfQoKCi8qKgogKiDpl67popjpobUKICovCgogIGlmKHBhZ2VJcy5RdWVzdGlvbil7CgogICAgdmFyICRsYmxRdWVzdGlvbk1ldGE9JCgnI3poLXF1ZXN0aW9uLW1ldGEtd3JhcCcpLy9xdWVzdGlvbl9tZXRhCiAgICAgICwgJGxpc3RBbnN3ZXJzPSQoJyN6aC1xdWVzdGlvbi1hbnN3ZXItd3JhcCwjemgtcXVlc3Rpb24tY29sbGFwc2VkLXdyYXAnKS5jaGlsZHJlbigpLy8kKCcuem0taXRlbS1hbnN3ZXInLCcjemgtc2luZ2xlLXF1ZXN0aW9uJykKICAgICAgLCBudW1BbnN3ZXJzQ291bnQ9JGxpc3RBbnN3ZXJzLmxlbmd0aAogICAgICAsICRidG5Db2xsYXBzZWRTd2l0Y2hlcj0kKCcjemgtcXVlc3Rpb24tY29sbGFwc2VkLXN3aXRjaGVyJykKICAgICAgLCBudW1Db2xsYXBzZWRDb3VudD0hJGJ0bkNvbGxhcHNlZFN3aXRjaGVyLmxlbmd0aHx8JGJ0bkNvbGxhcHNlZFN3aXRjaGVyLmlzKCc6aGlkZGVuJyk/MDpwYXJzZUludCgkKCcjemgtcXVlc3Rpb24tY29sbGFwc2VkLW51bScpLnRleHQoKSkKICAgICAgLCBudW1BbnN3ZXJzQ291bnRUb3RhbD1udW1BbnN3ZXJzQ291bnQrbnVtQ29sbGFwc2VkQ291bnQKICAgICAgLCAkcmVwbHk9JCgnI3poLXF1ZXN0aW9uLWFuc3dlci1mb3JtLXdyYXAnKS8vcmVwbHlfZm9ybQogICAgOwogICAgaWYoJGxibFF1ZXN0aW9uTWV0YS5sZW5ndGgpewogICAgICAgIHZhciBzPW5ldyBBcnJheSgpCiAgICAgICAgICAsICRhPSQoJzxhPicpCiAgICAgICAgICAsICRjPSQoJzxzcGFuPicseydjbGFzcyc6J3pnLWJ1bGwnfSkudGV4dCgn4oCiJykKICAgICAgICAgICwgJHA9JGxibFF1ZXN0aW9uTWV0YS5jaGlsZHJlbignLnptLW1ldGEtcGFuZWwnKS5jaGlsZHJlbignYS5tZXRhLWl0ZW06bGFzdCcpCiAgICAgICAgICAsICRtPSQoJy56dS1hbnN3ZXItZm9ybS1kaXNhYmxlZC13cmFwOnZpc2libGUgPiBhJywnI3poLXF1ZXN0aW9uLWFuc3dlci1mb3JtLXdyYXAnKQogICAgICAgIDsKICAgICAgICBpZigkbS5sZW5ndGgpewogICAgICAgICAgICBzLnB1c2goJG0uYXR0cignaHJlZicpKTsKICAgICAgICAgICAgJGEudGV4dCgn5oiR55qE5Zue562UJyk7CiAgICAgICAgfWVsc2UgaWYoJHJlcGx5Lmxlbmd0aCl7CiAgICAgICAgICAgIHZhciBpZD0nbmV3X2Fuc3dlcicKICAgICAgICAgICAgICAsICRiPSQoJzxhPicse25hbWU6aWR9KS5iZWZvcmUoJHJlcGx5LmNoaWxkcmVuKCkuZmlyc3QoKSk7CiAgICAgICAgICAgIHMucHVzaCgnI2RyYWZ0Jyk7CiAgICAgICAgICAgICRhLnRleHQoJ+aIkeimgeWbnuetlCcpOwogICAgICAgIH0KICAgICAgICAkYy5pbnNlcnRBZnRlcigkcCk7CiAgICAgICAgJGEuYXR0cignaHJlZicscy5qb2luKCcnKSkuYXR0cigndGFyZ2V0JywnX3NlbGYnKQogICAgICAgICAgICAuaW5zZXJ0QWZ0ZXIoJGMpOwogICAgfQogICAgaWYgKGl6aEF1dGhvckxpc3QmJgogICAgICAgIG51bUFuc3dlcnNDb3VudFRvdGFsPjEwMCYmCiAgICAgICAgY29uZmlybSgn6L+Z5Liq6Zeu6aKY55qE5Zue562U5pWw6L6D5aSa77yM5piv5ZCm5pqC5pe25YWz6Zet44CMaVpoaWh1IOWbnuetlOebruW9leOAje+8nycpKXsKICAgICAgICAvLyQoJyNpemhDU1NfY29tbWVudCcpLnJlbW92ZSgpOwogICAgICAgIC8vcmV0dXJuOwogICAgICAgIGl6aEF1dGhvckxpc3Q9ZmFsc2U7CiAgICAgICAgJGJvZHkuYXR0cignaXpoQXV0aG9yTGlzdCcsJzAnKTsKICAgIH0KICAgIC8vY29uc29sZS5sb2coKG5ldyBEYXRlKCkpLmdldFRpbWUoKSk7CiAgICAKICAgIHZhciAkbGJsQW5zd2Vyc0NvdW50PSQoJyN6aC1xdWVzdGlvbi1hbnN3ZXItbnVtJykvL2Fuc3dlcnNfY291bnQKICAgICAgLCAkdW5vPSQoJzxkaXY+Jyx7J2NsYXNzJzondW5vJyxzdHlsZTonZmxvYXQ6bGVmdCd9KS8vaXpoX0F1dGhvcnNMaXN0CiAgICAgICwgJHBwVD0kKCc8c3Bhbj4nLHsnY2xhc3MnOidtZVQnLHN0eWxlOidkaXNwbGF5Om5vbmUnfSkvL2l6aF9BdXRob3JzTGlzdF9Ub3BTZWxmSW5kaWNhdG9yCiAgICAgICwgJGZybT0kKCc8ZGl2PicseydjbGFzcyc6J2ZyYW1lJ30pLy9pemhfQXV0aG9yc0xpc3RfZnJhbWUKICAgICAgLCAkcHBCPSQoJzxzcGFuPicseydjbGFzcyc6J21lQicsc3R5bGU6J2Rpc3BsYXk6bm9uZSd9KS8vaXpoX0F1dGhvcnNMaXN0X0JvdHRvbVNlbGZJbmRpY2F0b3IKICAgICAgLCAkcHA9JCgnPHVsPicseydjbGFzcyc6J3BwJ30pLy9pemhfQXV0aG9yc0xpc3RfVUwKICAgICAgLCAkcHBJPSQoJzxkaXY+JykKICAgIAogICAgOwoKICAgIHdpbmRvdy5pWmhpaHUuJHVub0Fuc3dlcnMgPSAkdW5vCi8qCiAgICAvL+etlOahiOaMieaXtumXtOaOkuW6jwogICAgaWYodXRpbHMuZ2V0Q2ZnKCdhbnN3ZXJfb3JkZXJCeVRpbWUnKSl7CiAgICAgIGNsaWVudC5jbGljaygnLnpoLWFuc3dlcnMtZmlsdGVyLXBvcHVwIGRpdltkYXRhLWtleT1hZGRlZF90aW1lXScpOwogICAgfQoqLyAgICAKICAgIHZhciAkcXVlc3Rpb25XcmFwPSQoJyN6aC1xdWVzdGlvbi1tZXRhLXdyYXAnKTsKICAgICRxdWVzdGlvbldyYXAuY2hpbGRyZW4oJy5wYW5lbC1jb250YWluZXInKS5iaW5kKCdET01Ob2RlSW5zZXJ0ZWQnLGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICB3aW5kb3cuaVpoaWh1LkNvbW1lbnQucHJvY2Vzc0NvbW1lbnQoJChldmVudC50YXJnZXQpKTsKICAgIH0pOwogICAgaWYod2luZG93LmlaaGlodS5Db21tZW50LlJpZ2h0Q29tbWVudCl7CiAgICAgICAgLy8kcXVlc3Rpb25XcmFwLmNoaWxkcmVuKCcubWV0YS1pdGVtW25hbWU9YWRkY29tbWVudF0nKS5wcmVwZW5kVG8oJHF1ZXN0aW9uV3JhcCk7CiAgICAgICAgd2luZG93LmlaaGlodS5Db21tZW50LnByb2Nlc3NDb21tZW50QnV0dG9uKCRxdWVzdGlvbldyYXApOwogICAgICAgIGlmKCEkKCcjaXpoX1F1ZXN0aW9uU2hhZG93JykubGVuZ3RoKXsKICAgICAgICAgICAgJCgnPGRpdj4nLHsnY2xhc3MnOidpemhfYm94U2hhZG93JyxpZDonaXpoX1F1ZXN0aW9uU2hhZG93J30pLmNzcyh7CiAgICAgICAgICAgICAgICAnei1pbmRleCc6ICctMScKICAgICAgICAgICAgICAsICdwb3NpdGlvbic6ICdyZWxhdGl2ZScKICAgICAgICAgICAgICAsICd0b3AnOiAtMjUKICAgICAgICAgICAgICAsICdtYXJnaW4tbGVmdCc6IC0zMgogICAgICAgICAgICB9KS5wcmVwZW5kVG8oJ2JvZHk+Lnp1LW1haW46Zmlyc3QnKS5oaWRlKCk7CiAgICAgICAgfSAgIAogICAgfQoKICAgIC8vcHJvY2VzcyBlYWNoIGFuc3dlcgogICAgaWYoJGxpc3RBbnN3ZXJzJiYkbGlzdEFuc3dlcnMubGVuZ3RoKXsKICAgICAgICBpZihpemhBdXRob3JMaXN0KXsKICAgICAgICAgICAgJHVuby5hcHBlbmRUbygkYmFubmVyKTsKICAgICAgICAgICAgJHBwVC5hcHBlbmRUbygkdW5vKTsKICAgICAgICAgICAgJGZybS5hcHBlbmRUbygkdW5vKTsKICAgICAgICAgICAgJHBwLmFwcGVuZFRvKCRmcm0pOwogICAgICAgICAgICAkcHBCLmFwcGVuZFRvKCR1bm8pOwogICAgICAgICAgICAvL3Vuby5hcHBlbmRDaGlsZChwcEkpOwogICAgICAgICAgICAkdW5vLiRlbmRPZkxhc3RBPSQoJzxsaT4nKS5hZGRDbGFzcygnZW5kT2ZMYXN0QScpLmFwcGVuZFRvKCRwcCkKICAgICAgICB9CiAgICAgICAgJGxpc3RBbnN3ZXJzLmVhY2goZnVuY3Rpb24oaSxlKXsKICAgICAgICAgICAgd2luZG93LmlaaGlodS5BbnN3ZXIucHJvY2Vzc0Fuc3dlcigkKGUpLCRwcAogICAgICAgICAgICAgICwgaXpoQXV0aG9yUmVhcgogICAgICAgICAgICAgICwgaXpoQXV0aG9yTGlzdCk7CiAgICAgICAgfSk7CiAgICAgICAgaWYoJHJlcGx5LmNoaWxkcmVuKCcuenUtYW5zd2VyLWZvcm0tZGlzYWJsZWQtd3JhcCcpLmlzKCc6aGlkZGVuJykpewogICAgICAgICAgICB2YXIgJHBwbGE9JCgnPGE+Jyx7aHJlZjonI2RyYWZ0Jyx0YXJnZXQ6J19zZWxmJ30pCiAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0YWJsZT4nLCB7ICdjbGFzcyc6ICdwbHVzJyB9KQogICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRyPicpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0ZD4nKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRkPicpKQogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8dHI+JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRkPicpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8dGQ+JykpCiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxzcGFuPicsIHsgJ2NsYXNzJzogJ25hbWUgZnVuYycgfSkudGV4dCgnLW5ldy0nKSkKICAgICAgICAgICAgICAsICRwcGw9JCgnPGxpPicpCiAgICAgICAgICAgICAgICAuYXBwZW5kKCRwcGxhKQogICAgICAgICAgICAgICAgLmFwcGVuZFRvKCRwcCkKICAgICAgICAgICAgOwogICAgICAgIH0KICAgIH0KICAgIHZhciByZXNpemVBdXRob3JMaXN0PWZ1bmN0aW9uKCRmKXsKICAgICAgICAvLyBBZGp1c3QgQXV0aG9yTGlzdCdzIHNpemUgYW5kIGxvY2F0ZSBpdHMgcG9zaXRpb24KICAgICAgICBpZighJGZ8fCEkZi5sZW5ndGgpcmV0dXJuOwogICAgICAgIHZhciBmcm09JGYuZ2V0KDApOwogICAgICAgIHZhciB3aWR0aD13aW5kb3cuaVpoaWh1LkFuc3dlci5wcFdpZHRoCiAgICAgICAgICAsIGhlaWdodD0kd2luLmhlaWdodCgpLSRtYWluLm9mZnNldCgpLnRvcC0zLSRmLnBvc2l0aW9uKCkudG9wOwogICAgICAgIGlmKGZybS5zY3JvbGxIZWlnaHQ+aGVpZ2h0KXsKICAgICAgICAgICAgJGYuaGVpZ2h0KGhlaWdodCk7CiAgICAgICAgICAgIHdpZHRoKz0yMDsKICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgJGYuaGVpZ2h0KCcnKTsKICAgICAgICB9CiAgICAgICAgJGYud2lkdGgod2lkdGgpOwogICAgfTsKICAgIGlmKGlzTmFOKG51bUNvbGxhcHNlZENvdW50KSludW1Db2xsYXBzZWRDb3VudD0wOwogICAgaWYoJGxpc3RBbnN3ZXJzLmxlbmd0aHx8bnVtQ29sbGFwc2VkQ291bnQpewogICAgICAgIGlmKGl6aEF1dGhvckxpc3QpewogICAgICAgICAgICAkdW5vLmNzcyh7CiAgICAgICAgICAgICAgICAnZmxvYXQnOidub25lJwogICAgICAgICAgICAgICwgJ2xlZnQnOjktJHVuby53aWR0aCgpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBpZighJGJ0bkNvbGxhcHNlZFN3aXRjaGVyLmxlbmd0aCYmIW51bUNvbGxhcHNlZENvdW50KQogICAgICAgICAgICAgICAgcmVzaXplQXV0aG9yTGlzdCgkZnJtKTsKICAgICAgICAgICAgJCgnPGRpdj4nLHsnY2xhc3MnOidtb2RhbC1kaWFsb2ctdGl0bGUnfSkuY3NzKHsKICAgICAgICAgICAgICAgICAgJ2JvcmRlci10b3AtbGVmdC1yYWRpdXMnOjAKICAgICAgICAgICAgfSkuaW5zZXJ0QmVmb3JlKCRwcFQpOwogICAgICAgICAgICAkdW5vLm1vdXNlb3ZlcihmdW5jdGlvbigpewogICAgICAgICAgICAgICAgcmVzaXplQXV0aG9yTGlzdCgkKCcuZnJhbWUnLHRoaXMpKTsKICAgICAgICAgICAgICAgICQodGhpcykuY3NzKCdsZWZ0JywnMCcpOwogICAgICAgICAgICB9KS5tb3VzZW91dChmdW5jdGlvbigpewogICAgICAgICAgICAgICAgJCh0aGlzKS5jc3MoJ2xlZnQnLDktJCh0aGlzKS53aWR0aCgpKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGlmKHdpbmRvdy5pWmhpaHUuQW5zd2VyLl9lKXsKICAgICAgICAgICAgICAgICR1bm8uY2hpbGRyZW4oJy5tZVQnKS5jc3MoJ2Rpc3BsYXknLDA+d2luZG93LmlaaGlodS5BbnN3ZXIuX2Uub2Zmc2V0VG9wLSRmcm0uc2Nyb2xsVG9wKCk/Jyc6J25vbmUnKTsKICAgICAgICAgICAgICAgICR1bm8uY2hpbGRyZW4oJy5tZUInKS5jc3MoJ2Rpc3BsYXknLCRmcm0uaGVpZ2h0KCk8d2luZG93LmlaaGlodS5BbnN3ZXIuX2Uub2Zmc2V0VG9wLSRmcm0uc2Nyb2xsVG9wKCkrd2luZG93LmlaaGlodS5BbnN3ZXIuX2Uub2Zmc2V0SGVpZ2h0PycnOidub25lJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYoJGJ0bkNvbGxhcHNlZFN3aXRjaGVyLmxlbmd0aCl7CiAgICAgICAgICAgIGlmKG51bUNvbGxhcHNlZENvdW50PjApewogICAgICAgICAgICAgICAgJCgnI3poLXF1ZXN0aW9uLWNvbGxhcHNlZC13cmFwJykuc2hvdygpLmJpbmQoJ0RPTU5vZGVJbnNlcnRlZCcsZnVuY3Rpb24oZXZlbnQpewogICAgICAgICAgICAgICAgICAgIHZhciAkYT0kKGV2ZW50LnRhcmdldCk7CiAgICAgICAgICAgICAgICAgICAgaWYoJGEuaXMoJy56bS1pdGVtLWFuc3dlcicpKXsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmlaaGlodS5BbnN3ZXIucHJvY2Vzc0Fuc3dlcigkYSwkcHAKICAgICAgICAgICAgICAgICAgICAgICAgICAsICRib2R5LmF0dHIoJ2l6aEF1dGhvclJlYXInKT09JzEnCiAgICAgICAgICAgICAgICAgICAgICAgICAgLCAkYm9keS5hdHRyKCdpemhBdXRob3JMaXN0Jyk9PScxJwogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgY291bnQgPSAkKCcuem0taXRlbS1hbnN3ZXJbaXpoX3Byb2Nlc3NlZD0xXScsJyN6aC1xdWVzdGlvbi1jb2xsYXBzZWQtd3JhcCcpLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoY291bnQ9PW51bUNvbGxhcHNlZENvdW50KXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc2l6ZUF1dGhvckxpc3QoJGZybSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkYnRuQ29sbGFwc2VkU3dpdGNoZXJbMF0uY2xpY2soKTsKICAgICAgICB9CiAgICB9CgogICAgJCgnI3poLXF1ZXN0aW9uLWFuc3dlci13cmFwJykuYmluZCgnRE9NTm9kZUluc2VydGVkJyxmdW5jdGlvbihldmVudCl7CiAgICAgICAgdmFyICRuYT0kKGV2ZW50LnRhcmdldCkuZmlsdGVyKCcuem0taXRlbS1hbnN3ZXInKTsKICAgICAgICBpZigkbmEubGVuZ3RoKXsKICAgICAgICAgICAgd2luZG93LmlaaGlodS5BbnN3ZXIucHJvY2Vzc0Fuc3dlcigkbmEsJHBwCiAgICAgICAgICAgICAgLCAkYm9keS5hdHRyKCdpemhBdXRob3JSZWFyJyk9PScxJwogICAgICAgICAgICAgICwgJGJvZHkuYXR0cignaXpoQXV0aG9yTGlzdCcpPT0nMScKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9KTsKICAgIC8vY29uc29sZS5sb2coKG5ldyBEYXRlKCkpLmdldFRpbWUoKSk7CgogICAgdmFyICRjbT0kKCcuem0tY29tbWVudC1ib3gnLCRxdWVzdGlvbldyYXApOwogICAgaWYoJGNtLmxlbmd0aCAmJiAkY20uaXMoJzp2aXNpYmxlJykpewogICAgICAgIHZhciBmb2N1c05hbWUgPSBpWmhpaHUuQ29tbWVudC5zY3JvbGxGb2N1c0NvbW1lbnRPblBhZ2VMb2FkKCRjbSk7CiAgICAKICAgICAgICBpWmhpaHUuQ29tbWVudC5tZXRhU2Nyb2xsVG9WaWV3Qm90dG9tKCRjbS5jbG9zZXN0KCcuem0taXRlbS1tZXRhJyksZnVuY3Rpb24oKXsKICAgICAgICAgICAgaVpoaWh1LkNvbW1lbnQucHJvY2Vzc0NvbW1lbnQoJGNtLCBmb2N1c05hbWUpOwogICAgICAgIH0pOwogICAgfQogIH0KCi8qKgogKiDphY3nva7nlYzpnaIKICovCgogICAgdmFyICRidG5TZXR0aW5ncyA9ICQoJzxsaT4nKQogICAgICAgICAgICAuYXBwZW5kKCQoJzxhPicsIHsgaHJlZjogJ2phdmFzY3JpcHQ6dm9pZCgwKTsnLCB0YWJpbmRleDogJy0xJyB9KQogICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8aT4nLCB7ICdjbGFzcyc6ICd6Zy1pY29uIHpnLWljb24tZGQtc2V0dGluZ3MgaXpoaWh1LXNldHRpbmdzJyB9KSkKICAgICAgICAgICAgICAgIC5hcHBlbmQoJ2laaGlodScpCiAgICAgICAgICAgICkuY2xpY2soZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHZhciAkc2V0dGluZ3MgPSAkKCcjaXpoLWRsZy1zZXR0aW5ncycpCiAgICAgICAgICAgICAgICAkKCcubW9kYWwtZGlhbG9nLWJnJykuc2hvdygpCiAgICAgICAgICAgICAgICAkKCcuaXpoLW9wdGlvbicsICcjaXpoLWRsZy1zZXR0aW5ncycpLmVhY2goZnVuY3Rpb24oaSwgZSl7CiAgICAgICAgICAgICAgICAgICAgdmFyIGtleSA9IGUuZ2V0QXR0cmlidXRlKCduYW1lJykKICAgICAgICAgICAgICAgICAgICAgICwgdmFsdWUgPSB1dGlscy5nZXRDZmcoa2V5KQogICAgICAgICAgICAgICAgICAgICAgLCAkZSA9ICQoZSkKICAgICAgICAgICAgICAgICAgICBpZiAoJGUuaXMoJ2lucHV0OmNoZWNrYm94JykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYodmFsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGUpLmlDaGVjaygnY2hlY2snKQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoJGUuaXMoJ3NlbGVjdCcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGUudmFsdWUgPSB2YWx1ZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAkc2V0dGluZ3MuY3NzKHsKICAgICAgICAgICAgICAgICAgICAnei1pbmRleCc6Jzk5JwogICAgICAgICAgICAgICAgICAsICdwb3NpdGlvbic6J2ZpeGVkJwogICAgICAgICAgICAgICAgICAsICd0b3AnOiAoJHdpbi5oZWlnaHQoKSAtICRzZXR0aW5ncy5oZWlnaHQoKSkgLyAyCiAgICAgICAgICAgICAgICAgICwgJ2xlZnQnOiAoJHdpbi53aWR0aCgpIC0gJHNldHRpbmdzLndpZHRoKCkpIC8gMgogICAgICAgICAgICAgICAgfSkuZmFkZUluKCdzbG93JykKICAgICAgICAgICAgfSkuaW5zZXJ0QmVmb3JlKCQoJ3VsI3RvcC1uYXYtcHJvZmlsZS1kcm9wZG93biBsaTpsYXN0JykpCiAgICAgICwgJGRsZ1NldHRpbmdzID0gJCgnPGRpdj4nLCB7IGlkOiAnaXpoLWRsZy1zZXR0aW5ncycsICdjbGFzcyc6ICdtb2RhbC1kaWFsb2cnLCB0YWJpbmRleDogJzAnLCBzdHlsZTogJ2Rpc3BsYXk6bm9uZTt3aWR0aDo2MDBweCd9KQogICAgICAgICAgICAuYXBwZW5kKCQoJzxkaXY+JywgeyAnY2xhc3MnOiAnbW9kYWwtZGlhbG9nLXRpdGxlIG1vZGFsLWRpYWxvZy10aXRsZS1kcmFnZ2FibGUnIH0pCiAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxzcGFuPicsIHsgJ2NsYXNzJzogJ21vZGFsLWRpYWxvZy10aXRsZS10ZXh0JyB9KS50ZXh0KCfphY3nva7pgInpobknKSkKICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHNwYW4+JywgewogICAgICAgICAgICAgICAgICAgICdjbGFzcyc6ICdtb2RhbC1kaWFsb2ctdGl0bGUtY2xvc2UnCiAgICAgICAgICAgICAgICAgICwgY2xpY2s6IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5tb2RhbC1kaWFsb2ctYmcnKS5oaWRlKCkKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2l6aC1kbGctc2V0dGluZ3MnKS5maXJzdCgpLmhpZGUoKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pKQogICAgICAgICAgICApCiAgICAgICAgICAgIC5hcHBlbmQoJCgnPGRpdj4nLCB7ICdjbGFzcyc6ICdtb2RhbC1kaWFsb2ctY29udGVudCcgfSkKICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGRpdj4nLCB7fSkKICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxkaXY+JywgeyAnY2xhc3MnOiAnemctc2VjdGlvbicgfSkKICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8dGFibGU+JywgeyAnY2xhc3MnOiAndF9zZXRfdGInLCBib3JkZXI6IDAsIGNlbGxzcGFjaW5nOiAwLCBjZWxscGFkZGluZzogNSwgd2lkdGg6ICcxMDAlJyB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8dGhlYWQ+Jywge30pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8dHI+Jywge30pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRkPicsIHsgY29sc3BhbjogNiwgYWxpZ246ICdsZWZ0JyB9KS50ZXh0KCfvvIjmm7TmlLnlkI7orr7nva7lsIbnq4vliLvkv53lrZjvvIzkvYblj6rmnInlvZPpobXpnaLlho3mrKHmiZPlvIDml7bmiY3kvJrnlJ/mlYjvvIknKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAJLnByZXBlbmQoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAkJJCgnPGI+JykudGV4dCgn5Yqf6IO95byA5YWzJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAJCSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRib2R5PicsIHt9KQovKgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRyPicsIHt9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0ZD4nLCB7IGNvbHNwYW46IDQsIGFsaWduOiAnbGVmdCcgfSkudGV4dCgn5Zyo6aaW6aG155u05o6l5rWP6KeI5bi45Y676K+d6aKYJykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRkPicsIHsgYWxpZ246ICdyaWdodCd9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8aT4nLCB7ICdjbGFzcyc6ICdpY29uIGljb24taGVscCcsICdkYXRhLXRpcCc6ICIifSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8dGQ+JywgeyBhbGlnbjogJ3JpZ2h0J30pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxpbnB1dD4nLCB7IHR5cGU6ICJjaGVja2JveCIsICdjbGFzcyc6ICJpemgtb3B0aW9uIiwgaWQ6ICJpWmhpaHVfc2V0SG9tZVRvcGljcyIsIG5hbWU6ICJIb21lVG9waWNzIiB9KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0cj4nLCB7fSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8dGQ+JywgeyBjb2xzcGFuOiA0LCBhbGlnbjogJ2xlZnQnIH0pLnRleHQoJ+aUueWPmOe9kemhteagt+W8j+WkluingicpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0ZD4nLCB7IGFsaWduOiAncmlnaHQnfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGk+JywgeyAnY2xhc3MnOiAnaWNvbiBpY29uLWhlbHAnLCAnZGF0YS10aXAnOiAicyR0JCog6aaW6aG16ZqQ6JeP5aSn5aS05YOPPGJyLz4qIOe8qei/m+aKleelqOaMiemSru+8iOmXrumimC/lm57nrZTpobXvvIk8YnIvPiog5oyJ6ZKu5Zu+5qCH5Yqo55S7ICJ9KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0ZD4nLCB7IGFsaWduOiAncmlnaHQnfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGlucHV0PicsIHsgdHlwZTogImNoZWNrYm94IiwgJ2NsYXNzJzogIml6aC1vcHRpb24iLCBpZDogImlaaGlodV9zZXRIb21lTGF5b3V0IiwgbmFtZTogIkhvbWVMYXlvdXQiIH0pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRyPicsIHt9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0ZD4nLCB7IGNvbHNwYW46IDQsIGFsaWduOiAnbGVmdCcgfSkudGV4dCgn6Ieq5Yqo5pS26LW35a+86Iiq5qCPJykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRkPicsIHsgYWxpZ246ICdyaWdodCd9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8aT4nLCB7ICdjbGFzcyc6ICdpY29uIGljb24taGVscCcsICdkYXRhLXRpcCc6ICJzJHQkKiDmu5rliqjpobXpnaLoh7PkuIvmlrnml7bvvIzoh6rliqjmlLbotbfpobbpg6jlr7zoiKrmoI8gIn0pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRkPicsIHsgYWxpZ246ICdyaWdodCd9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8aW5wdXQ+JywgeyB0eXBlOiAiY2hlY2tib3giLCAnY2xhc3MnOiAiaXpoLW9wdGlvbiIsIGlkOiAiaVpoaWh1X3NldFRvcE5hdkF1dG9Gb2xkIiwgbmFtZTogIlRvcE5hdkF1dG9Gb2xkIiB9KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0cj4nLCB7fSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8dGQ+JywgeyBjb2xzcGFuOiA0LCBhbGlnbjogJ2xlZnQnIH0pLnRleHQoJ+iwg+aVtOmmlumhteOAjOaWsOWKqOaAgeOAjeaPkOmGkuaMiemSricpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0ZD4nLCB7IGFsaWduOiAncmlnaHQnfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGk+JywgeyAnY2xhc3MnOiAnaWNvbiBpY29uLWhlbHAnLCAnZGF0YS10aXAnOiAicyR0JOaMquWIsCBUaW1lbGluZSDlj7PkuIrop5I8YnIvPuS4juagh+mimOOAjOacgOaWsOWKqOaAgeOAjeW5s+ihjCJ9KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0ZD4nLCB7IGFsaWduOiAncmlnaHQnfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGlucHV0PicsIHsgdHlwZTogImNoZWNrYm94IiwgJ2NsYXNzJzogIml6aC1vcHRpb24iLCBpZDogImlaaGlodV9zZXRIb21lTm90aSIsIG5hbWU6ICJIb21lTm90aSIgfSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8dHI+Jywge30pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRkPicsIHsgY29sc3BhbjogNCwgYWxpZ246ICdsZWZ0JyB9KS50ZXh0KCflvIDlkK/jgIzpppbpobXliIbmoI/jgI0nKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8dGQ+JywgeyBhbGlnbjogJ3JpZ2h0J30pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxpPicsIHsgJ2NsYXNzJzogJ2ljb24gaWNvbi1oZWxwJywgJ2RhdGEtdGlwJzogInMkdCTlsIbpppbpobXliqjmgIHliIbnsbvljZXni6zmmL7npLrvvJo8YnIvPumXrumimOOAgeWbnuetlOOAgeS4k+agjyJ9KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0ZD4nLCB7IGFsaWduOiAncmlnaHQnfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGlucHV0PicsIHsgdHlwZTogImNoZWNrYm94IiwgJ2NsYXNzJzogIml6aC1vcHRpb24iLCBpZDogImlaaGlodV9zZXRIb21lRmVlZHNDb2x1bW5zIiwgbmFtZTogIkhvbWVGZWVkc0NvbHVtbnMiIH0pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRyPicsIHt9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0ZD4nLCB7IGNvbHNwYW46IDQsIGFsaWduOiAnbGVmdCcgfSkudGV4dCgn5bCG55So5oi35L+h5oGv5oyq5Yiw5Zue562U5LiL5pa5JykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRkPicsIHsgYWxpZ246ICdyaWdodCd9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8aT4nLCB7ICdjbGFzcyc6ICdpY29uIGljb24taGVscCcsICdkYXRhLXRpcCc6ICIifSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8dGQ+JywgeyBhbGlnbjogJ3JpZ2h0J30pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxpbnB1dD4nLCB7IHR5cGU6ICJjaGVja2JveCIsICdjbGFzcyc6ICJpemgtb3B0aW9uIiwgaWQ6ICJpWmhpaHVfc2V0QXV0aG9yUmVhciIsIG5hbWU6ICJBdXRob3JSZWFyIiB9KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0cj4nLCB7fSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8dGQ+JywgeyBhbGlnbjogJ2xlZnQnIH0pLnRleHQoJ+W8gOWQr+OAjOWPs+iIt+ivhOiuuuOAjScpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0ZD4nLCB7IGFsaWduOiAncmlnaHQnfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGk+JywgeyAnY2xhc3MnOiAnaWNvbiBpY29uLWhlbHAnLCAnZGF0YS10aXAnOiAicyR0JOWcqOmhtemdouWPs+S+p+a1ruWKqOaYvuekuuaJk+W8gOeahOivhOiuuuWIl+ihqDxici8+5Zyo6aaW6aG144CB6Zeu6aKY44CB5Zue562U6aG15Lit55Sf5pWIIn0pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRkPicsIHsgYWxpZ246ICdyaWdodCd9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8aW5wdXQ+JywgeyB0eXBlOiAiY2hlY2tib3giLCAnY2xhc3MnOiAiaXpoLW9wdGlvbiIsIGlkOiAiaVpoaWh1X3NldFJpZ2h0Q29tbWVudCIsIG5hbWU6ICJTaG93Q29tbWVudCIgfSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8dGQ+JywgeyB3aWR0aDogMSwgbm93cmFwOiAnbm93cmFwJywgYWxpZ246ICdsZWZ0JyB9KS50ZXh0KCflhbPpl63ml7boh6rliqjljbflsY/oh7Plr7nlupTmnaHnm64nKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8dGQ+JywgeyBhbGlnbjogJ3JpZ2h0J30pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxpPicsIHsgJ2NsYXNzJzogJ2ljb24gaWNvbi1oZWxwJywgJ2RhdGEtdGlwJzogInMkdCTku4Xlr7nlj7PoiLfor4TorrrnlJ/mlYgifSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8dGQ+JywgeyBhbGlnbjogJ3JpZ2h0J30pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxpbnB1dD4nLCB7IHR5cGU6ICJjaGVja2JveCIsICdjbGFzcyc6ICJpemgtb3B0aW9uIiwgaWQ6ICJpWmhpaHVfc2V0UmlnaHRDb21tZW50X0F1dG9TY3JvbGxQYWdlV2hlbkNsb3NpbmciLCBuYW1lOiAiUmlnaHRDb21tZW50X0F1dG9TY3JvbGxQYWdlV2hlbkNsb3NpbmciIH0pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRyPicsIHt9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0ZD4nLCB7IGNvbHNwYW46IDQsIGFsaWduOiAnbGVmdCcgfSkudGV4dCgn5byA5ZCv44CM5b+r6YCf5bGP6JS944CN77yI5Yqg5YWl6buR5ZCN5Y2VL+WPlua2iOWFs+azqO+8ieWKn+iDvScpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0ZD4nLCB7IGFsaWduOiAncmlnaHQnfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGk+JywgeyAnY2xhc3MnOiAnaWNvbiBpY29uLWhlbHAnLCAnZGF0YS10aXAnOiAicyR0JOWcqOi1nuWQjOWIl+ihqOOAgeivhOiuuuWIl+ihqOS4reS9v+eUqCJ9KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0ZD4nLCB7IGFsaWduOiAncmlnaHQnfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGlucHV0PicsIHsgdHlwZTogImNoZWNrYm94IiwgJ2NsYXNzJzogIml6aC1vcHRpb24iLCBpZDogImlaaGlodV9zZXRRdWlja0Jsb2NrIiwgbmFtZTogIlF1aWNrQmxvY2siIH0pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRyPicsIHt9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0ZD4nLCB7IGNvbHNwYW46IDQsIGFsaWduOiAnbGVmdCcgfSkudGV4dCgn5byA5ZCv44CM5b+r6YCf5pS26JeP44CN6I+c5Y2VJykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRkPicsIHsgYWxpZ246ICdyaWdodCd9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8aT4nLCB7ICdjbGFzcyc6ICdpY29uIGljb24taGVscCcsICdkYXRhLXRpcCc6ICJzJHQk6byg5qCH56e75LiK44CM5pS26JeP44CN5oyJ6ZKu5pe25pi+56S6In0pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRkPicsIHsgYWxpZ246ICdyaWdodCd9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8aW5wdXQ+JywgeyB0eXBlOiAiY2hlY2tib3giLCAnY2xhc3MnOiAiaXpoLW9wdGlvbiIsIGlkOiAiaVpoaWh1X3NldFF1aWNrRmF2byIsIG5hbWU6ICJRdWlja0Zhdm8iIH0pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRyPicsIHt9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0ZD4nLCB7IGNvbHNwYW46IDQsIGFsaWduOiAnbGVmdCcgfSkudGV4dCgn5byA5ZCv44CM5Zue562U55uu5b2V44CNJykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRkPicsIHsgYWxpZ246ICdyaWdodCd9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8aT4nLCB7ICdjbGFzcyc6ICdpY29uIGljb24taGVscCcsICdkYXRhLXRpcCc6ICJzJHQk5Zyo6Zeu6aKY6aG16Z2i5bem5L6n5o6p6JeP77yM6byg5qCH56e75LiK5pe25bGV5byAPGJyLz7lubblnKjlj7PkvqfljbPml7bmmL7npLrlm57nrZTpooTop4gifSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8dGQ+JywgeyBhbGlnbjogJ3JpZ2h0J30pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxpbnB1dD4nLCB7IHR5cGU6ICJjaGVja2JveCIsICdjbGFzcyc6ICJpemgtb3B0aW9uIiwgaWQ6ICJpWmhpaHVfc2V0QXV0aG9yTGlzdCIsIG5hbWU6ICJBdXRob3JMaXN0IiB9KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0cj4nLCB7fSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8dGQ+JywgeyBjb2xzcGFuOiA0LCBhbGlnbjogJ2xlZnQnIH0pLnRleHQoJ+mAieaLqeOAjOWklumDqOaQnOe0ouW8leaTjuOAjScpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0ZD4nLCB7IGFsaWduOiAncmlnaHQnfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGk+JywgeyAnY2xhc3MnOiAnaWNvbiBpY29uLWhlbHAnLCAnZGF0YS10aXAnOiAicyR0JOS9oOaHgueahCJ9KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0ZD4nLCB7IGFsaWduOiAncmlnaHQnfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHNlbGVjdD4nLCB7IHR5cGU6ICJjaGVja2JveCIsICdjbGFzcyc6ICJpemgtb3B0aW9uIiwgaWQ6ICJpWmhpaHVfc2V0U2VhcmNoRW5naW5lT3V0c2lkZSIsIG5hbWU6ICJTZWFyY2hFbmdpbmVPdXRzaWRlIn0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8b3B0aW9uPicsIHsgdmFsdWU6J2dvb2dsZScgfSkudGV4dCgnR29vZ2xlJykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8b3B0aW9uPicsIHsgdmFsdWU6J2JhaWR1JyB9KS50ZXh0KCfnmb7luqYnKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxkaXY+JywgeyAnY2xhc3MnOiAnemctbGVmdCcgfSkKICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgn5b2T5YmN54mI5pys77yaJyt2ZXJzaW9uKyfvvJsnKQogICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCfmnIDlkI7mm7TmlrDvvJonK3VwZGF0ZURhdGUpCiAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGJyPicpKQogICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCfliLbkvZzvvJonKQogICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxhPicsIHsgJ2RhdGEtdGlwJzogInAkdCR1bm9nengiLCBocmVmOiAiL3Blb3BsZS91bm9nengiIH0pLnRleHQoJ0DpkqLnm4Xpg63lrZAnKSkKICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgn77yMJykKICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8YT4nLCB7ICdkYXRhLXRpcCc6ICJwJHQkbGl1eW9uZzI1IiwgaHJlZjogIi9wZW9wbGUvbGl1eW9uZzI1IiB9KS50ZXh0KCdA5aSp54yqKOWImOWLhyknKSkKICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgn77yMJykKICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8YT4nLCB7ICdkYXRhLXRpcCc6ICJwJHQkbHVveHIiLCBocmVmOiAiL3Blb3BsZS9sdW94ciIgfSkudGV4dCgnQHl1a2lyb2NrJykpCiAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJ++8jCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGE+JywgeyAnZGF0YS10aXAnOiAicCR0JG1vcmxheSIsIGhyZWY6ICIvcGVvcGxlL21vcmxheSIgfSkudGV4dCgnQOWiqOejiicpKQogICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxicj4nKSkKICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgn5oSf6LCi77yaJykKICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8YT4nLCB7ICdkYXRhLXRpcCc6ICJwJHQkUGV0ZXJEZW5nIiwgaHJlZjogIi9wZW9wbGUvUGV0ZXJEZW5nIiB9KS50ZXh0KCdA6YKT5paH5Y2aJykpCiAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJ++8jCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGE+JywgeyAnZGF0YS10aXAnOiAicCR0JGNha3ZmY3d6IiwgaHJlZjogIi9wZW9wbGUvY2FrdmZjd3oiIH0pLnRleHQoJ0DmsLTkupHpgLgnKSkKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8ZGl2PicsIHsgJ2NsYXNzJzogJ3ptLWNvbW1hbmQnIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGE+JywgeyBpZDogJ2l6aFJlZnJlc2gnLCAnY2xhc3MnOiAnemctYnRuLWJsdWUnLCBocmVmOiAnamF2YXNjcmlwdDp2b2lkKDApOycgfSkudGV4dCgn5Yi35paw572R6aG1JykpCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICApLmFwcGVuZFRvKF9kb2MuYm9keSkuZHJhZ2dhYmxlKHtoYW5kbGU6ICcubW9kYWwtZGlhbG9nLXRpdGxlLWRyYWdnYWJsZSd9KQoKICAgICQoJy5pemgtb3B0aW9uJywgJGRsZ1NldHRpbmdzKS5lYWNoKGZ1bmN0aW9uKGksIGUpewogICAgICAgIHZhciBrZXkgPSBlLmdldEF0dHJpYnV0ZSgnbmFtZScpCiAgICAgICAgICAsICRjaGsgPSAkKGUpLmZpbHRlcignaW5wdXQ6Y2hlY2tib3gnKS5pQ2hlY2soewogICAgICAgICAgICAgICAgY2hlY2tib3hDbGFzczogJ2ljaGVja2JveF9zcXVhcmUtYmx1ZScKICAgICAgICAgICAgICAsIGluY3JlYXNlQXJlYTogJzIwJScgLy8gb3B0aW9uYWwKICAgICAgICAgICAgfSkuYmluZCgnaWZDaGFuZ2VkJywgZnVuY3Rpb24oZXZlbnQpewogICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gdGhpcy5jaGVja2VkCiAgICAgICAgICAgICAgICB1dGlscy5zZXRDZmcoa2V5LCB2YWx1ZSkKICAgICAgICAgICAgfSkKICAgICAgICAgICwgJHNlbCA9ICQoZSkuZmlsdGVyKCdzZWxlY3QnKS5iaW5kKCdjaGFuZ2UnLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHV0aWxzLnNldENmZyhrZXksIHRoaXMudmFsdWUpCiAgICAgICAgICAgIH0pCiAgICB9KQogICAgJCgnI2l6aFJlZnJlc2gnKS5jbGljayhmdW5jdGlvbigpewogICAgICAgIGxvY2F0aW9uLnJlbG9hZCgpCiAgICB9KQoKLyoKICog6K6+572uLeWxj+iUvQogKi8KaWYgKHBhZ2VJcy5TZXR0aW5nc0ZpbHRlcil7CiAgICB2YXIgYWxsPVtdCiAgICAgICwgJHNlY0Jsb2NrZWRVc2VycyA9ICQoJyNzZWN0aW9uLWJsb2NrZWQtdXNlcnMnKQogICAgICAsICRzZWNCbG9ja2VkVXNlcnNUaXRsZSA9ICRzZWNCbG9ja2VkVXNlcnMuY2hpbGRyZW4oJy5zZXR0aW5ncy1zZWN0aW9uLXRpdGxlOmZpcnN0JykuY2hpbGRyZW4oJ2gyOmZpcnN0JykKICAgICAgLCAkcG5sVW5CbG9ja2VkVXNlcnMgPSAkKCc8ZGl2PicpLmFwcGVuZFRvKCRzZWNCbG9ja2VkVXNlcnNUaXRsZSkuY3NzKHsKICAgICAgICAgICAgZmxvYXQ6ICdyaWdodCcKICAgICAgICB9KQogICAgICAsICRsYkZpbHRlckJsb2NrZWRVc2VycyA9ICQoJzxsYWJlbC8+JykuYXBwZW5kVG8oJHBubFVuQmxvY2tlZFVzZXJzKS5jc3MoewogICAgICAgICAgICBmbG9hdDogJ2xlZnQnCiAgICAgICAgfSkKICAgICAgLCAkdGJGaWx0ZXJCbG9ja2VkVXNlcnMgPSAkKCc8aW5wdXQvPicsIHsKICAgICAgICAgICAgJ2NsYXNzJzogJ3pnLWZvcm0tdGV4dC1pbnB1dCB6Zy1tcjE1JwogICAgICAgICAgLCBwbGFjZWhvbGRlcjogJ+eUqOaIt+WQjeaIluaYteensCcKICAgICAgICB9KS5hcHBlbmRUbygkcG5sVW5CbG9ja2VkVXNlcnMpLm9uKCdrZXl1cCcsIGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICAgICAgdmFyIGt3PXRoaXMudmFsdWUKICAgICAgICAgICAgICAsIG49MAogICAgICAgICAgICAgICwgJGxpc3RCbG9ja2VkVXNlcnM9JHNlY0Jsb2NrZWRVc2Vycy5maW5kKCcuYmxvY2tlZC11c2VycyA+IC5pdGVtID4gLmJvZHkgPiBhJykuZWFjaChmdW5jdGlvbihpLGUpewogICAgICAgICAgICAgICAgICAgIHZhciAkYSA9ICQoZSkKICAgICAgICAgICAgICAgICAgICAgICwgaHJlZiA9IGUuZ2V0QXR0cmlidXRlKCdocmVmJykgfHwgJycKICAgICAgICAgICAgICAgICAgICAgICwgdGV4dCA9IGUuaW5uZXJIVE1MCiAgICAgICAgICAgICAgICAgICAgICAsIG5vdE1hdGNoID0gKGhyZWYuaW5kZXhPZihrdykgPCAwICYmIHRleHQuaW5kZXhPZihrdykgPCAwKQogICAgICAgICAgICAgICAgICAgIGlmKCFub3RNYXRjaCl7CiAgICAgICAgICAgICAgICAgICAgICAgIG4rKwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkYS5jbG9zZXN0KCcuaXRlbScpLmNzcygnZGlzcGxheScsIG5vdE1hdGNoID8gJ25vbmUnIDogJycpCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAkbGJGaWx0ZXJCbG9ja2VkVXNlcnMudGV4dChbbj9uKycgJzon5pegJywn5Lq65Yy56YWN77yaJ10uam9pbignJykpCiAgICAgICAgfSkuY3NzKHsKICAgICAgICAgICAgZmxvYXQ6ICdsZWZ0JwogICAgICAgIH0pLnRyaWdnZXIoJ2tleXVwJykKICAgICAgLCBmdW5jVW5ibG9jaz1mdW5jdGlvbigpewogICAgICAgICAgICBpZihhbGwubGVuZ3RoPT0wKXtyZXR1cm59CiAgICAgICAgICAgIHZhciBlPWFsbC5zaGlmdCgpCiAgICAgICAgICAgICQucG9zdCgnL3NldHRpbmdzL3VuYmxvY2t1c2VyJywgJC5wYXJhbSh7CiAgICAgICAgICAgICAgICBfeHNyZjogJCgnaW5wdXRbbmFtZT1feHNyZl0nKS52YWwoKQogICAgICAgICAgICAgICwgdWlkOiBlLmdldEF0dHJpYnV0ZSgnZGF0YS1pZCcpCiAgICAgICAgICAgIH0pKS5kb25lKGZ1bmN0aW9uKHJlc3VsdCl7CiAgICAgICAgICAgICAgICAkKGUpLnJlbW92ZSgpCiAgICAgICAgICAgIH0pLmZhaWwoZnVuY3Rpb24ocmVzdWx0KXsKICAgICAgICAgICAgICAgIGFsbC5wdXNoKGUpCiAgICAgICAgICAgIH0pLmFsd2F5cyhmdW5jdGlvbihyZXN1bHQpewogICAgICAgICAgICAgICAgJGxiRmlsdGVyQmxvY2tlZFVzZXJzLnRleHQoW2FsbC5sZW5ndGg/YWxsLmxlbmd0aCsnICc6J+aXoCcsJ+S6uuWMuemFje+8middLmpvaW4oJycpKQogICAgICAgICAgICAgICAgZnVuY1VuYmxvY2soKQogICAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgLCBoPSR0YkZpbHRlckJsb2NrZWRVc2Vycy5vdXRlckhlaWdodCgpCiAgICAgICwgJGJ0VW5CbG9ja2VkVXNlcnMgPSAkKCc8aW5wdXQvPicsIHsKICAgICAgICAgICAgJ2NsYXNzJzogJ3pnLWJ0biB6Zy1idG4tdW5mb2xsb3cnCiAgICAgICAgICAsIHR5cGU6ICdidXR0b24nCiAgICAgICAgICAsIHZhbHVlOiAn5Y+W5raI5bGP6JS9JwogICAgICAgIH0pLmFwcGVuZFRvKCRwbmxVbkJsb2NrZWRVc2Vycykub24oJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpewogICAgICAgICAgICAkKCcjc2VjdGlvbi1ibG9ja2VkLXVzZXJzID4gLnNldHRpbmdzLWl0ZW0gPiAuc2V0dGluZ3MtaXRlbS1jb250ZW50ID4gLmJsb2NrZWQtdXNlcnMgPiAuaXRlbScpLmVhY2goZnVuY3Rpb24oaSxlKXsKICAgICAgICAgICAgICAgIHZhciAkZSA9ICQoZSkKICAgICAgICAgICAgICAgIGlmKCRlLmlzKCc6dmlzaWJsZScpKXsKICAgICAgICAgICAgICAgICAgICBhbGwucHVzaChlKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICBmdW5jVW5ibG9jaygpCiAgICAgICAgfSkuY3NzKHsKICAgICAgICAgICAgZmxvYXQ6ICdsZWZ0JwogICAgICAgIH0pLmhlaWdodChoKQogICAgJGxiRmlsdGVyQmxvY2tlZFVzZXJzLmNzcygnbGluZS1oZWlnaHQnLCBoKydweCcpCn0KCnZhciBmaXJzdFJ1biA9IHBhcnNlSW50KHV0aWxzLmdldFZhbHVlKCdpemhfZnInLCcxJykpOwoKZnVuY3Rpb24gX0ZSc2hvdygpewppZihmaXJzdFJ1bj4wICYmIGRvY3VtZW50LmRvbWFpbj09J3poaWh1LmNvbScpewogICAgdmFyIHRib3hsZWZ0PTA7CiAgICB2YXIgYWNjaXRlbTE9ICQoJyN6aC10b3AtaW5uZXIgZGl2LnRvcC1uYXYtcHJvZmlsZSAuenUtdG9wLW5hdi11c2VyaW5mbycpOwogICAgaWYoYWNjaXRlbTEubGVuZ3RoPjApewogICAgICAgIHRib3hsZWZ0ID0gYWNjaXRlbTEub2Zmc2V0KCkubGVmdDsKICAgIH0KICAgIGlmKHRib3hsZWZ0PjApewogICAgICAgICQoJzxkaXY+JywgeyBpZDogJ2laaGlodV90Ym94JywgJ2NsYXNzJzogJ3RfZnJzaG93JyB9KS5hcHBlbmRUbygnYm9keS56aGknKS5oaWRlKCkKICAgICAgICAgICAgLmFwcGVuZCgkKCc8ZGl2PicsIHsgJ2NsYXNzJzogJ3RfdHh0c2hvdyB0X3Rib3gnIH0pCiAgICAgICAgICAgICAgICAuYXBwZW5kKCfmhJ/osKLkvb/nlKgnKQogICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8Yj4nKS50ZXh0KCdpWmhpaHUnKSkKICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGJyIC8+JykpCiAgICAgICAgICAgICAgICAuYXBwZW5kKCfmgqjlj6/pgJrov4foj5zljZXjgJBpWmhpaHXjgJHlr7nlip/og73ov5vooYzorr7nva4nKQogICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8YnIgLz4nKSkKICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHM+JykKICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxpPicpKQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICApOwogICAgICAgICQoJyNpWmhpaHVfdGJveCcpLmNzcygnbGVmdCcsdGJveGxlZnQtMTAwKS5zaG93KCkubW91c2VlbnRlcihmdW5jdGlvbigpewogICAgICAgICAgICB1dGlscy5zZXRWYWx1ZSgnaXpoX2ZyJywnMCcpOwogICAgICAgICAgICAvL19NZW51KCk7CiAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZSgpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9Cn0KICAgIApzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7CiAgICBfRlJzaG93KCk7Cn0sMTAwMCk7CgoKICBjb25zb2xlLmxvZygnaVpoaWh1ICcrdmVyc2lvbisnIHN0YXJ0ZWQuJyk7CiAgLy9jb25zb2xlLmxvZyh3aW5kb3cuaVpoaWh1KTsKICAvL2NvbnNvbGUubG9nKChuZXcgRGF0ZSgpKS5nZXRUaW1lKCkpOwovL30pOwo="},{"name":"Endless Google","options":{"check_for_updates":true,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_arrayleft":false,"compat_uW_gmonkey":false,"compat_forvarin":false,"noframes":null,"awareOfChrome":false,"run_at":null,"override":{"use_includes":[],"orig_includes":["http://www.google.*","https://www.google.*","https://encrypted.google.*"],"merge_includes":true,"use_matches":[],"orig_matches":[],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-start","orig_noframes":null,"orig_connects":[]}},"storage":{"ts":1521546462858,"data":{}},"enabled":true,"position":11,"file_url":"https://openuserjs.org/install/tumpio/Endless_Google.user.js","uuid":"dd2f56e5-e2bb-4185-bab2-47dd3fc73704","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICAgICBFbmRsZXNzIEdvb2dsZQovLyBAZGVzY3JpcHRpb24gICAgIExvYWQgbW9yZSByZXN1bHRzIGF1dG9tYXRpY2FsbHkgYW5kIGVuZGxlc3NseS4KLy8gQGF1dGhvciAgICAgICAgICB0dW1waW8KLy8gQG91anM6YXV0aG9yICAgICB0dW1waW8KLy8gQG5hbWVzcGFjZSAgICAgICB0dW1waW9Ac2NpLmZpCi8vIEBob21lcGFnZVVSTCAgICAgaHR0cHM6Ly9vcGVudXNlcmpzLm9yZy9zY3JpcHRzL3R1bXBpby90dW1waW9zY2kuZmkvRW5kbGVzc19Hb29nbGUKLy8gQHN1cHBvcnRVUkwgICAgICBodHRwczovL2dpdGh1Yi5jb20vdHVtcGlvL2dtc2NyaXB0cwovLyBAaWNvbiAgICAgICAgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS90dW1waW8vZ21zY3JpcHRzL3Jhdy9tYXN0ZXIvRW5kbGVzc19Hb29nbGUvbGFyZ2UucG5nCi8vIEBpbmNsdWRlICAgICAgICAgaHR0cDovL3d3dy5nb29nbGUuKgovLyBAaW5jbHVkZSAgICAgICAgIGh0dHBzOi8vd3d3Lmdvb2dsZS4qCi8vIEBpbmNsdWRlICAgICAgICAgaHR0cHM6Ly9lbmNyeXB0ZWQuZ29vZ2xlLioKLy8gQHJ1bi1hdCAgICAgICAgICBkb2N1bWVudC1zdGFydAovLyBAZ3JhbnQgICAgICAgICAgIEdNX3htbGh0dHBSZXF1ZXN0Ci8vIEB2ZXJzaW9uICAgICAgICAgMC4wLjQKLy8gPT0vVXNlclNjcmlwdD09CgovLyBUT0RPOiBvbiBwYWdlIHJlZnJlc2g6Ci8vICAyOiBsb2FkIG9ubHkgdGhlIGxhc3Qgc2Nyb2xsZWQgcGFnZSAob24gcmVmcmVzaCwgbG9hZCBsYXN0IHJlcXVlc3RlZCBwYWdlKSAoY291bGQgYmUgYSBnb29kIGRlZmF1bHQsIG5lZWRzIHNjcm9sbCB1cCBzdXBwb3J0KQovLyAgICAgIGJlZm9yZXVubG9hZCAtPiBzdG9yZSBsYXN0IHJlcXVlc3RlZCBwYWdlIHdpdGggR01fc2V0VmFyaWFibGUoKSBhbmQgcmVsb2FkIGl0IGluc3RlYWQKLy8gVE9ETzogb25lcnJvciwgb25hYm9ydDogc2hvdyB0byB1c2VyICJwYWdlIGxvYWRpbmcgZmFpbGVkIiwgYnV0dG9uIHRvIHJldHJ5CgovLyBGSVhNRTogYnVnOiBTdWdnZXN0ZWQgaW1hZ2VzIGRvbid0IHNob3cgdXAgb24gbmV3IHJlcXVlc3RlZCBwYWdlcwovLyBjYXNlOiBodHRwczovL3d3dy5nb29nbGUuZmkvd2ViaHA/dGFiPXd3JmVpPWUwVWpVOXluRUtxa3lBTzQ2WUQ0RFEmdmVkPTBDQkVRMVM0I3E9dGV0c2F1cwovLyB3b3JrYXJvdW5kLCBoaWRpbmcgbm93CgovLyBGVVRVUkU6IE9wdGlvbnMgZGlhbG9nCi8vIEZVVFVSRTogUmVwbGFjZSBmb290ZXIgd2l0aCBwYWdlICNubyBpbmZvIFVJCi8vIEZVVFVSRTogQWRkIHBhZ2UgdXAvZG93biBhbmQgYmFjayB0byB0b3AvYm90dG9tIGNvbnRyb2xzIFVJICsgKGdvIHRvIHRoZSBwYWdlICNuKT8KLy8gRlVUVVJFOiBBZGQgY29sdW1ucyBzdXBwb3J0Ci8vIEZVVFVSRTogc2hvdyBwYWdlIGxvYWRpbmcgaWNvbgovLyBGVVRVUkU6IHNob3cgcGFnZSBmYXYtaWNvbnMgZm9yIHJlc3VsdHMKLy8gRlVUVVJFOiBudW1iZXIgcmVzdWx0cwovLyBGVVRVUkU6IG9wdGlvbiB0byBsb2FkIHN0YXRpYyBnb29nbGUgY3NzCi8vIEZVVFVSRTogc3VwcG9ydCBzY3JvbGwgdXAKCmlmIChsb2NhdGlvbi5ocmVmLmluZGV4T2YoInRibT1pc2NoIikgIT09IC0xKSAvLyBOT1RFOiBEb24ndCBydW4gb24gaW1hZ2Ugc2VhcmNoCiAgICByZXR1cm47CmlmICh3aW5kb3cudG9wICE9PSB3aW5kb3cuc2VsZikgLy8gTk9URTogRG8gbm90IHJ1biBvbiBpZnJhbWVzCiAgICByZXR1cm47Cgpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgZnVuY3Rpb24gKCkgewoKICAgIC8vIE5PVEU6IE9wdGlvbnMKICAgIHZhciByZXF1ZXN0X3BjdCA9IDAuMDU7IC8vIHBlcmNlbnRhZ2Ugb2Ygd2luZG93IGhlaWdodCBsZWZ0IG9uIGRvY3VtZW50IHRvIHJlcXVlc3QgbmV4dCBwYWdlLCB2YWx1ZSBtdXN0IGJlIGJldHdlZW4gMC0xCiAgICB2YXIgZXZlbnRfdHlwZSA9ICJzY3JvbGwiOyAvLyBvciAid2hlZWwiCiAgICB2YXIgb25fcGFnZV9yZWZyZXNoID0gMTsKICAgIC8vIDA6IHJlbG9hZCBhbGwgcHJldmlvdXMgcGFnZXMgcmVxdWVzdGVkCiAgICAvLyAxOiBsb2FkIG9ubHkgdGhlIGZpcnN0IHBhZ2UgKHByZXZlbnQgcmVzdG9yaW5nIHRoZSBzY3JvbGwgcG9zaXRpb24pCiAgICAvLyAyOiBsb2FkIG9ubHkgdGhlIGxhc3QgcGFnZSByZXF1ZXN0ZWQKICAgIHZhciBtYWluID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1haW4iKTsKICAgIHZhciByY250ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInJjbnQiKTsKICAgIHZhciBpbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsc3QtaWIiKTsKICAgIHZhciBpbnB1dF92YWx1ZSA9IGlucHV0LnZhbHVlOwogICAgdmFyIG9sZF9zY3JvbGxZID0gMDsKICAgIHZhciBzY3JvbGxfZXZlbnRzID0gMDsKICAgIHZhciBuZXh0X2xpbmsgPSBudWxsOwogICAgdmFyIGNvbHMgPSBbXTsKICAgIHZhciByZXF1ZXN0X29mZnNldEhlaWdodCA9IDA7CiAgICB2YXIgc3RvcF9ldmVudHMgPSBmYWxzZTsKCiAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCJibHVyIiwgcmVzZXQsIGZhbHNlKTsgLy8gTk9URTogbGlzdGVucyBmb3IgbmV3IHNlYXJjaCBpbnB1dCB0byByZXNldCBzdGF0ZQogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnRfdHlwZSwgb25TY3JvbGwsIGZhbHNlKTsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJiZWZvcmV1bmxvYWQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIDApOwogICAgfSwgZmFsc2UpOwoKICAgIGZ1bmN0aW9uIHJlcXVlc3ROZXh0UGFnZShsaW5rKSB7CiAgICAgICAgY29uc29sZS5sb2coInJlcXVlc3QgbmV4dCIpOwogICAgICAgIGNvbnNvbGUubG9nKGxpbmspOwogICAgICAgIEdNX3htbGh0dHBSZXF1ZXN0KHsKICAgICAgICAgICAgbWV0aG9kOiAiR0VUIiwKICAgICAgICAgICAgdXJsOiBsaW5rLAogICAgICAgICAgICBvbmxvYWQ6IGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgdmFyIGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25hdmNudCcpOwogICAgICAgICAgICAgICAgZWwucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlbCk7IC8vRGVsZXRlcyB0aGUgbmF2aWdhdGlvbiBib3gKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdmFyIGhvbGRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgICAgICAgICAgaG9sZGVyLmlubmVySFRNTCA9IHJlc3BvbnNlLnJlc3BvbnNlVGV4dDsKICAgICAgICAgICAgICAgIG5leHRfbGluayA9IGhvbGRlci5xdWVyeVNlbGVjdG9yKCIjcG5uZXh0IikuaHJlZjsKCiAgICAgICAgICAgICAgICB2YXIgbmV4dF9jb2wgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgICAgICAgICAgIG5leHRfY29sLmNsYXNzTmFtZSA9ICJFR19jb2wiOwogICAgICAgICAgICAgICAgbmV4dF9jb2wuYXBwZW5kQ2hpbGQoaG9sZGVyLnF1ZXJ5U2VsZWN0b3IoIiNjZW50ZXJfY29sIikpOwoKICAgICAgICAgICAgICAgIHZhciByZWxfc2VhcmNoID0gbmV4dF9jb2wucXVlcnlTZWxlY3RvcigiI2V4dHJhcmVzIik7CiAgICAgICAgICAgICAgICB2YXIgcmVsX2ltYWdlcyA9IG5leHRfY29sLnF1ZXJ5U2VsZWN0b3IoIiNpbWFnZWJveF9iaWdpbWFnZXMiKTsKICAgICAgICAgICAgICAgIHZhciByZWxfYWRzID0gbmV4dF9jb2wucXVlcnlTZWxlY3RvcigiI3RhZHMiKTsKICAgICAgICAgICAgICAgIGlmIChyZWxfc2VhcmNoKQogICAgICAgICAgICAgICAgICAgIHJlbF9zZWFyY2guc3R5bGUuZGlzcGxheSA9ICJub25lIjsgLy8gTk9URTogSGlkZXMgcmVwZWF0aW5nICJyZWxhdGVkIHNlYXJjaGVzIgogICAgICAgICAgICAgICAgaWYgKHJlbF9pbWFnZXMpCiAgICAgICAgICAgICAgICAgICAgcmVsX2ltYWdlcy5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOyAvLyBOT1RFOiBIaWRlcyByZWxhdGVkIGltYWdlcywgdGhhdCBhcmUgYnJva2VuIChidWcpCiAgICAgICAgICAgICAgICBpZiAocmVsX2FkcykKICAgICAgICAgICAgICAgICAgICByZWxfYWRzLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7IC8vIE5PVEU6IEhpZGVzIHJlcGVhdGluZyAic2VhcmNoIHJlc3VsdHMgYWQiCgogICAgICAgICAgICAgICAgY29scy5wdXNoKG5leHRfY29sKTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJQYWdlIG5vOiAiICsgY29scy5sZW5ndGgpOwogICAgICAgICAgICAgICAgbmV4dF9jb2wuaWQgPSBuZXh0X2NvbC5jbGFzc05hbWUgKyAiXyIgKyAoY29scy5sZW5ndGggLSAxKTsgLy8gTk9URTogYWRkIHVuaXF1ZSBpZCBmb3IgZXZlcnkgbmV3IGNvbAoKICAgICAgICAgICAgICAgIGlmICghcmNudCB8fCBjb2xzLmxlbmd0aCA9PT0gMSkgLy8gTk9URTogbmVlZHMgdG8gYmUgcmVjaGVja2VkIG9uIGEgc3RhdGUgcmVzZXQgdG9vLCBhbmQgbGF0ZSBpbnNlcnRhdGlvbiBvZiBlbGVtZW50IG9uIGdvb2dsZSBpbnN0YW50CiAgICAgICAgICAgICAgICAgICAgcmNudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyY250Iik7CiAgICAgICAgICAgICAgICByY250LmFwcGVuZENoaWxkKG5leHRfY29sKTsKICAgICAgICAgICAgICAgIHN0b3BfZXZlbnRzID0gZmFsc2U7CiAgICAgICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihldmVudF90eXBlLCBvblNjcm9sbCwgZmFsc2UpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgfQoKICAgIGZ1bmN0aW9uIG9uU2Nyb2xsKGUpIHsKICAgICAgICB2YXIgeSA9IHdpbmRvdy5zY3JvbGxZOwogICAgICAgIC8vIGlmIChzY3JvbGxfZXZlbnRzID09PSAwKSBvbGRfc2Nyb2xsWSA9IHk7IC8vIHN0b3BzIG9ubHkgaWYgc2Nyb2xsIHBvc2l0aW9uIHdhcyBvbiAyLiBwYWdlCiAgICAgICAgdmFyIGRlbHRhID0gZS5kZWx0YVkgfHwgeSAtIG9sZF9zY3JvbGxZOyAvLyBOT1RFOiBlLmRlbHRhWSBmb3IgIndoZWVsIiBldmVudAogICAgICAgIGlmIChkZWx0YSA+IDAgJiYgKHdpbmRvdy5pbm5lckhlaWdodCArIHkpID49IChkb2N1bWVudC5ib2R5LmNsaWVudEhlaWdodCAtICh3aW5kb3cuaW5uZXJIZWlnaHQgKiByZXF1ZXN0X3BjdCkpKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJzY3JvbGwgZW5kIik7CiAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50X3R5cGUsIG9uU2Nyb2xsLCBmYWxzZSk7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaWYoIXN0b3BfZXZlbnRzKXsKICAgICAgICAgICAgICAgICAgICBzdG9wX2V2ZW50cyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdE5leHRQYWdlKG5leHRfbGluayB8fCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicG5uZXh0IikuaHJlZik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIubmFtZSArICI6ICIgKyBlcnIubWVzc2FnZSk7CiAgICAgICAgICAgICAgICAvLyBOT1RFOiByZWNvdmVyeSB1bm5lY2Vzc2FyeSwgaW5wdXQgZXZlbnQgaGFuZGxlcyBpdCB3aXRoIHJlc2V0IG9uIG5ldyBzZWFyY2gKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBvbGRfc2Nyb2xsWSA9IHk7CiAgICAgICAgc2Nyb2xsX2V2ZW50cyArPSAxOwogICAgfQoKICAgIC8vIE5PVEU6IFJlc2V0cyB0aGUgc2NyaXB0IHN0YXRlIG9uIGEgbmV3IHNlYXJjaAogICAgZnVuY3Rpb24gcmVzZXQoKSB7CiAgICAgICAgaWYgKGlucHV0LnZhbHVlICE9PSBpbnB1dF92YWx1ZSkgewogICAgICAgICAgICBpbnB1dF92YWx1ZSA9IGlucHV0LnZhbHVlOwogICAgICAgICAgICB3aW5kb3cuc2Nyb2xsVG8oMCwgMCk7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY29scy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIHJjbnQucmVtb3ZlQ2hpbGQoY29sc1tpXSk7CiAgICAgICAgICAgIGNvbHMgPSBbXTsKICAgICAgICAgICAgbmV4dF9saW5rID0gbnVsbDsKICAgICAgICAgICAgb2xkX3Njcm9sbFkgPSAwOwogICAgICAgICAgICBzY3JvbGxfZXZlbnRzID0gMDsKICAgICAgICAgICAgY29uc29sZS5sb2coIlJFU0VUIik7CiAgICAgICAgICAgIH0KICAgIH0KCiAgICBjb25zb2xlLmxvZygiZWdvb2dsZS5qcyBpbml0aWFsaXplZCIpOwp9KTsKY29uc29sZS5sb2coImVnb29nbGUuanMgbG9hZGVkIik7Cg=="},{"name":"百度云插件+APIKey","options":{"check_for_updates":true,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_arrayleft":false,"compat_uW_gmonkey":false,"compat_forvarin":false,"noframes":null,"awareOfChrome":false,"run_at":null,"override":{"use_includes":[],"orig_includes":["/https?\\:\\/\\/(pan|yun)\\.baidu\\.com.*/"],"merge_includes":true,"use_matches":[],"orig_matches":[],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-end","orig_noframes":null,"orig_connects":[]}},"storage":{"ts":1521546738109,"data":{}},"enabled":true,"position":12,"file_url":"https://greasyfork.org/scripts/496-%E7%99%BE%E5%BA%A6%E4%BA%91%E6%8F%92%E4%BB%B6-apikey/code/%E7%99%BE%E5%BA%A6%E4%BA%91%E6%8F%92%E4%BB%B6+APIKey.user.js","uuid":"fdbd7b74-45e9-4656-a491-14ef2d2941f3","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAg55m+5bqm5LqR5o+S5Lu2K0FQSUtleQovLyBAbmFtZXNwYWNlICAKLy8gQHZlcnNpb24gICAgNS4wLjMKLy8gQGRlc2NyaXB0aW9uICDlnKjnmb7luqbkupHnvZHnm5jnmoTpobXpnaLmt7vliqDkuIDkuKrmkJzntKLmoYbvvIzosIPnlKjmkJzntKJBUEnmkJzntKLmiYDmnInlhazlvIDliIbkuqvmlofku7YvLyBUbyBhZGQgYSBzZWFyY2ggZnJhbWUgdGhhdCBjYWxscyBzb21lIGFwaSBmb3Igc2VhcmNoaW5nIHNvbWUgcHVibGljIHNoYXJlZCBmaWxlcyBpbiBCYWlkdVl1biBjbG91ZCBuZXRkaXNrLiAKLy8gQGRlc2NyaXB0aW9uICBGb3IgbW9yZSBpbWZvcm1hdGlvbixwbGVhc2UgZW1haWwgbWUgYXQgd2FuZ2hzaW5jaGVAaG90bWFpbC5jb20uIAovLyBAaW5jbHVkZSAgICAgICAvaHR0cHM/XDpcL1wvKHBhbnx5dW4pXC5iYWlkdVwuY29tLiovCi8vIEBncmFudCAgICAgICBHTV94bWxodHRwUmVxdWVzdAovLyBAcnVuLWF0IGRvY3VtZW50LWVuZAovLyBAY29weXJpZ2h0ICAyMDE0LDA0LDIwIF9fQnkgV2FuZyBIc2luLWNoZSAgIAovLyA9PS9Vc2VyU2NyaXB0PT0KCi8qdGhhbmtzIHRvIHRoZSB0dXRvcmlhbCBvZiBtdmMgIGF0IApodHRwczovL2FsZXhhdG5ldC5jb20vYXJ0aWNsZXMvbW9kZWwtdmlldy1jb250cm9sbGVyLW12Yy1qYXZhc2NyaXB0Ki8KCgovL0V2ZW50IGlzIGEgc2ltcGxlIGNsYXNzIGZvciBpbXBsZW1lbnRpbmcgdGhlIE9ic2VydmVyIHBhdHRlcm46CmZ1bmN0aW9uIEV2ZW50KHNlbmRlcikgewogICAgdGhpcy5fc2VuZGVyID0gc2VuZGVyOwogICAgdGhpcy5fbGlzdGVuZXJzID0gW107Cn0KCkV2ZW50LnByb3RvdHlwZSA9IHsKICAgIGF0dGFjaCA6IGZ1bmN0aW9uIChsaXN0ZW5lcikgey8vcHVzaCB0aGUgY2FsbGJhY2sgZnVuY3Rpb24gaW50byBfbGlzdGVuZXJzW107CiAgICAgICAgdGhpcy5fbGlzdGVuZXJzLnB1c2gobGlzdGVuZXIpOwogICAgfSwKICAgIG5vdGlmeSA6IGZ1bmN0aW9uIChhcmdzKSB7Ly9wb3AgYWxsIHRoZSBjYWxsYmFjayBmdW5jdGlvbnMgYW5kIGV4ZWN1dGUgdGhlIGZ1bmN0aW9ucyB3aXRoIHNhbWUgYXJncz8KICAgICAgICB2YXIgaW5kZXg7CgogICAgICAgIGZvciAoaW5kZXggPSAwOyBpbmRleCA8IHRoaXMuX2xpc3RlbmVycy5sZW5ndGg7IGluZGV4ICs9IDEpIHsKICAgICAgICAgICAgdGhpcy5fbGlzdGVuZXJzW2luZGV4XSh0aGlzLl9zZW5kZXIsIGFyZ3MpOy8vYXV0byBwYXNzIHNlbmRlciBhbmQgYXJncyBpbnRvIGNhbGxiYWNrIGZ1bmN0aW9uLCBzbyB0aGUgZGVmYXVsdCBmb3JtIG9mIGNhbGxiYWNrIGZ1bmN0aW9uIGlzIGZ1bmN0aW9uKHNlbmRlcixhcmdzKXt9CiAgICAgICAgfQogICAgfQp9OwoKLy9KYXZhc2NyaXB0LXRlbXBsYXRlLWVuZ2luZS1pbi1qdXN0LTIwLWxpbmUKLy9ieSBieSBLcmFzaW1pciBodHRwOi8va3Jhc2ltaXJ0c29uZXYuY29tL2Jsb2cvYXJ0aWNsZS9KYXZhc2NyaXB0LXRlbXBsYXRlLWVuZ2luZS1pbi1qdXN0LTIwLWxpbmUKdmFyIFRlbXBsYXRlRW5naW5lID0gZnVuY3Rpb24oaHRtbCwgb3B0aW9ucykgewogICAgdmFyIHJlID0gLzwlKFteJT5dKyk/JT4vZywgcmVFeHAgPSAvKF4oICk/KGlmfGZvcnxlbHNlfHN3aXRjaHxjYXNlfGJyZWFrfHt8fSkpKC4qKT8vZywgY29kZSA9ICd2YXIgcj1bXTtcbicsIGN1cnNvciA9IDAsIG1hdGNoOwogICAgdmFyIGFkZCA9IGZ1bmN0aW9uKGxpbmUsIGpzKSB7CiAgICAgICAganM/IChjb2RlICs9IGxpbmUubWF0Y2gocmVFeHApID8gbGluZSArICdcbicgOiAnci5wdXNoKCcgKyBsaW5lICsgJyk7XG4nKSA6CiAgICAgICAgICAgIChjb2RlICs9IGxpbmUgIT0gJycgPyAnci5wdXNoKCInICsgbGluZS5yZXBsYWNlKC8iL2csICdcXCInKSArICciKTtcbicgOiAnJyk7CiAgICAgICAgcmV0dXJuIGFkZDsKICAgIH07CiAgICB3aGlsZShtYXRjaCA9IHJlLmV4ZWMoaHRtbCkpIHsKICAgICAgICBhZGQoaHRtbC5zbGljZShjdXJzb3IsIG1hdGNoLmluZGV4KSkobWF0Y2hbMV0sIHRydWUpOwogICAgICAgIGN1cnNvciA9IG1hdGNoLmluZGV4ICsgbWF0Y2hbMF0ubGVuZ3RoOwogICAgfQogICAgYWRkKGh0bWwuc3Vic3RyKGN1cnNvciwgaHRtbC5sZW5ndGggLSBjdXJzb3IpKTsKICAgIGNvZGUgKz0gJ3JldHVybiByLmpvaW4oIiIpOyc7CiAgICByZXR1cm4gbmV3IEZ1bmN0aW9uKGNvZGUucmVwbGFjZSgvW1xyXHRcbl0vZywgJycpKS5hcHBseShvcHRpb25zKTsKfTsKCi8qKgogKiBUaGUgTW9kZWwuIE1vZGVsIHN0b3JlcyBpdGVtcyBhbmQgbm90aWZpZXMKICogb2JzZXJ2ZXJzIGFib3V0IGNoYW5nZXMuCiAqLwoKIHZhciBCYXNlTW9kZWw9ZnVuY3Rpb24oZW5naW5lTHN0KXsKICAgIHRoaXMua2V5d29yZD0iIjsKICAgIHRoaXMuZW5naW5lPSJkZWZhdWx0IjsKICAgIHRoaXMuZW5naW5lTHN0PWVuZ2luZUxzdDsKICAgIHRoaXMuanNvbk9iaj17IAogICAgICAgICAgICAgICAgICAgIGN1cnNvcjogeyAKICAgICAgICAgICAgICAgICAgICAgICAgZXN0aW1hdGVkUmVzdWx0Q291bnQ6IDAsIAogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRDb3VudDogMCB9LCAKICAgICAgICAgICAgICAgICAgICByZXN1bHRzOiBbXQogICAgICAgICAgICAgICAgfTsKICAgIHRoaXMuY3Vycj0xOwogICAgdGhpcy50b3RhbFBhZ2U9MTsKICAgIHRoaXMudXJscz17ZGVmYXVsdDonaHR0cDovLycsfTsKICAgIHRoaXMuc3RhdGU9ZmFsc2U7CiAgICB0aGlzLmNvbnRlbnRVcGRhdGVkPW5ldyBFdmVudCh0aGlzKTsKICAgIHRoaXMucmVxdWVzdEV2ZW50PW5ldyBFdmVudCh0aGlzKTsKIH07CiBCYXNlTW9kZWwucHJvdG90eXBlPXsKICAgIHNldEVuZ2luZTpmdW5jdGlvbihlbmdpbmUpewogICAgCXZhciB0ZW1wT2JqID0ge307CiAgICAgICAgdGhpcy5lbmdpbmU9ZW5naW5lOwogICAgICAgIHRlbXBPYmpbJ2VuZ2luZSddID0gZW5naW5lOwogICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnd3h6WXVucGFuU2VhcmNoZXInLEpTT04uc3RyaW5naWZ5KHRlbXBPYmopKTsKICAgICAgICB0ZW1wT2JqID0gbnVsbDsKICAgIH0sCiAgICB1cGRhdGVDdXJyOmZ1bmN0aW9uKGN1cnIpewogICAgICAgIHRoaXMuY3Vycj1jdXJyOwogICAgfSwKICAgIHVwZGF0ZUtleXdvcmQ6ZnVuY3Rpb24oa2V5d29yZCl7CiAgICAgICAgdGhpcy5rZXl3b3JkPWtleXdvcmQ7CiAgICB9LAogICAgcmVxdWVzdDpmdW5jdGlvbigpewogICAgICAgIHRoaXMucmVxdWVzdEV2ZW50Lm5vdGlmeSgpOwogICAgICAgIHZhciBfdGhpcz10aGlzOwogICAgICAgIEdNX3htbGh0dHBSZXF1ZXN0KHsKICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICJHRVQiLAogICAgICAgICAgICAgICAgICAgIHVybDogX3RoaXMuY29tcGlsZVVybFtfdGhpcy5lbmdpbmVdKF90aGlzKSwKICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJVc2VyLUFnZW50IjogIk1vemlsbGEvNS4wIiwgLy8gSWYgbm90IHNwZWNpZmllZCwgbmF2aWdhdG9yLnVzZXJBZ2VudCB3aWxsIGJlIHVzZWQuCiAgICAgICAgICAgICAgICAgICAgICAgICJBY2NlcHQiOiAidGV4dC94bWwiIC8vIElmIG5vdCBzcGVjaWZpZWQsIGJyb3dzZXIgZGVmYXVsdHMgd2lsbCBiZSB1c2VkLgogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgb25sb2FkOiBmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5qc29uT2JqPV90aGlzLnRvSnNvbltfdGhpcy5lbmdpbmVdKHJlc3BvbnNlLnJlc3BvbnNlVGV4dCk7CiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnRvdGFsUGFnZT0ocGFyc2VJbnQoX3RoaXMuanNvbk9iai5jdXJzb3IucmVzdWx0Q291bnQpLXBhcnNlSW50KF90aGlzLmpzb25PYmouY3Vyc29yLnJlc3VsdENvdW50KSUxMCkvMTArMTsKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuc3RhdGU9dHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9zZWxmPV90aGlzOwogICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5jb250ZW50VXBkYXRlZC5ub3RpZnkoX3NlbGYuc3RhdGUpOyAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIG9uZXJyb3I6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5qc29uT2JqPXsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3Vyc29yOiB7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlc3RpbWF0ZWRSZXN1bHRDb3VudDogMCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdENvdW50OiAwIH0sIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdHM6IFtdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy50b3RhbFBhZ2U9MTsKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuc3RhdGU9ZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfc2VsZj1fdGhpczsKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuY29udGVudFVwZGF0ZWQubm90aWZ5KF9zZWxmLnN0YXRlKTsgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgfSwKICAgIGRlc3Rvcnk6ZnVuY3Rpb24oKXsKICAgICAgICB0aGlzLmpzb25PYmo9e307CiAgICAgICAgdGhpcy50b3RhbFBhZ2U9MDsKICAgICAgICB0aGlzLnN0YXRlPWZhbHNlOyAKICAgICAgICB0aGlzLmN1cnI9MDsKICAgICAgICB0aGlzLmtleXdvcmQ9IiI7CiAgICB9LAogICAgdG9Kc29uOnsKICAgICAgICBkZWZhdWx0OmZ1bmN0aW9uKHRleHQpewogICAgICAgICAgICB2YXIganNvbk9iaiA9IHsgCiAgICAgICAgICAgICAgICAgICAgY3Vyc29yOiB7IAogICAgICAgICAgICAgICAgICAgICAgICBlc3RpbWF0ZWRSZXN1bHRDb3VudDogMCwgCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdENvdW50OiAwIH0sIAogICAgICAgICAgICAgICAgICAgIHJlc3VsdHM6IFtdCiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgcmV0dXJuIGpzb25PYmo7CiAgICAgICAgfSwKICAgIH0sCiAgICBjb21waWxlVXJsOnsKICAgICAgICBkZWZhdWx0OmZ1bmN0aW9uKF90aGlzKXsKICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy51cmwgKyBfdGhpcy5rZXl3b3JkICsgJytzaXRlJTNBcGFuLmJhaWR1LmNvbScgKyAnJmZpcnN0PScgKyBfdGhpcy5jdXJyOwogICAgICAgICAgICB9LCAgICAgICAgCiAgICB9LAogfTsKCiB2YXIgVmlld2VyPWZ1bmN0aW9uKG1vZGVsLFVJZWxlbWVudHMpewogICAgdGhpcy5tb2RlbD1tb2RlbDsKICAgIHRoaXMuVUk9VUllbGVtZW50czsKICAgIHRoaXMuc2VhcmNoQ2xpY2s9bmV3IEV2ZW50KHRoaXMpOwogICAgdGhpcy5jbG9zZUNsaWNrPW5ldyBFdmVudCh0aGlzKTsKICAgIHRoaXMubmV4dENsaWNrPW5ldyBFdmVudCh0aGlzKTsKICAgIHRoaXMucHJlQ2xpY2s9bmV3IEV2ZW50KHRoaXMpOwogICAgdGhpcy50b1BhZ2VDbGljaz1uZXcgRXZlbnQodGhpcyk7CiAgICB0aGlzLmVuZ2luZU9wdENoYW5nZT1uZXcgRXZlbnQodGhpcyk7CiAgICB2YXIgYm9keU5vZGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5Jyk7CiAgICB2YXIgX3NlbGY9dGhpczsKICAgIHRoaXMuVUkuc2VhcmNoQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJyxmdW5jdGlvbihldmVudCkgewogICAgICAgIC8qIEFjdCBvbiB0aGUgZXZlbnQgKi8KICAgICAgICB2YXIgY3Vycj0xOwogICAgICAgIHZhciBrZXl3b3JkPV9zZWxmLlVJLmlucHV0RWxlLnZhbHVlOwogICAgICAgIGlmKGtleXdvcmQucmVwbGFjZSgvXHMqLywnJykhPT0nJyl7CiAgICAgICAgICAgIF9zZWxmLnNlYXJjaENsaWNrLm5vdGlmeSh7Y3VycjpjdXJyLGtleXdvcmQ6a2V5d29yZH0pOwogICAgICAgIH0KICAgIH0pOwogICAgdGhpcy5VSS5jbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAvKiBBY3Qgb24gdGhlIGV2ZW50ICovCiAgICAgICAgX3NlbGYuY2xvc2VDbGljay5ub3RpZnkoKTsKICAgIH0pOwogICAgLy8gdGhpcy5VSS5pbnB1dEVsZS5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsZnVuY3Rpb24oZXZlbnQpIHsKICAgIC8vICAgICAgICAgdmFyIGNsaWNrRXZlbnQgPSBuZXcgTW91c2VFdmVudCgiY2xpY2siKTsgICAgICAgICAgICAKICAgIC8vICAgICAgICAgaWYgKGV2ZW50LndoaWNoID09IDEzKSB7CiAgICAvLyAgICAgICAgICAgICBfc2VsZi5VSS5zZWFyY2hCdG4uZGlzcGF0Y2hFdmVudChjbGlja0V2ZW50KTsKICAgIC8vICAgICAgICAgfQogICAgLy8gICAgICAgICBjbGlja0V2ZW50ID0gbnVsbDsKICAgIC8vICAgICB9KTsKICAgIGJvZHlOb2RlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJyxmdW5jdGlvbihldmVudCl7CiAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5jbGFzc05hbWUuaW5kZXhPZihfc2VsZi5VSS5lbmdpbmVCdG5DbGFzc05hbWUpICE9PSAtMSApIHsKICAgICAgICAgICAgX3NlbGYuZW5naW5lT3B0Q2hhbmdlLm5vdGlmeShldmVudC50YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLWVuZ2luZScpKTsgICAgICAgICAgICAKICAgICAgICB9CiAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5jbGFzc05hbWUuaW5kZXhPZihfc2VsZi5VSS50b1BhZ2VCdG5DbGFzc05hbWUpICE9PSAtMSApIHsKICAgICAgICAgICAgX3NlbGYudG9QYWdlQ2xpY2subm90aWZ5KHBhcnNlSW50KGV2ZW50LnRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtcGFnZScpLDEwKSk7CiAgICAgICAgfQogICAgfSk7CiAgICAgICAgICAgICAgICAgIAogfTsKIFZpZXdlci5wcm90b3R5cGU9ewogICAgcmVmbGVzaEVuZ2luZUxzdDpmdW5jdGlvbigpewogICAgICAgIHZhciB0ZW1wbGF0ZT0nPCVmb3IodmFyIGkgaW4gdGhpcyl7JT4nKwogICAgICAgICAgICAgICAgICAgICc8bGkgbm9kZS10eXBlPSJjbGljay1lbGUiIGRhdGEtZW5naW5lPSI8JXRoaXNbaV0lPiIgY2xhc3M9ImxpIHd4ei1tZW51LW9wdGlvbiI+JysKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdieSA8JXRoaXNbaV0lPicrCiAgICAgICAgICAgICAgICAgICAgJzwvbGk+JysKICAgICAgICAgICAgICAgICAgICAnPCV9JT4nOwogICAgICAgIHZhciBodG1sPVRlbXBsYXRlRW5naW5lKHRlbXBsYXRlLHRoaXMubW9kZWwuZW5naW5lTHN0KTsKICAgICAgICB0aGlzLlVJLmVuZ2luZUxzdC5pbm5lckhUTUwgPSBodG1sOwogICAgfSwKICAgIHVwZGF0ZUVuZ2luZTpmdW5jdGlvbigpewogICAgICAgIHRoaXMuVUkubWVudS50ZXh0Q29udGVudCA9IHRoaXMubW9kZWwuZW5naW5lOwogICAgfSwKICAgIHNob3c6ZnVuY3Rpb24oKXsKICAgICAgICB0aGlzLlVJLm15RGl2LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgIHRoaXMuVUkuYmdOb2RlLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgIHRoaXMuVUkubXlEaXYuc3R5bGUudG9wID0gJzUwJSc7CiAgICAgICAgdGhpcy5VSS5teURpdi5zdHlsZS5tYXJnaW5Ub3AgPSAodGhpcy5VSS5teURpdi5jbGllbnRIZWlnaHQgLyAyICogLTEpICsgJ3B4JzsgICAgCiAgICB9LAogICAgcmVmbGVzaDpmdW5jdGlvbihzdWNjZXNzKXsKICAgICAgICB2YXIgdGVtcGxhdGU9IjxwIGFsaWduPSdyaWdodCc+LS0tLSBieSA8JXRoaXMuZW5naW5lJT4uY29tIFNlYXJjaCA8L3A+PHAgd2hpdGUtc3BhY2U9J25vcm1hbCcgY2xhc3M9J3RlbXAnID5rZXl3b3JkIGlzICAgICc8JXRoaXMua2V5d29yZCU+JyAgICBmb3VuZCAgJzwldGhpcy5qc29uT2JqLmN1cnNvci5yZXN1bHRDb3VudCU+JyAgUmVzdWx0czwvcD48cD4tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLTxwPiI7CiAgICAgICAgCiAgICAgICAgdGVtcGxhdGUrPSc8JWZvcih2YXIgaSBpbiB0aGlzLmpzb25PYmoucmVzdWx0cyl7JT4nKwogICAgICAgICAgICAgICAgICAgICAgICAgJzxwPjxwIGNsYXNzPSJteVRpdGxlIj4nKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxhIGhyZWY9IjwldGhpcy5qc29uT2JqLnJlc3VsdHNbaV0udW5lc2NhcGVkVXJsJT4idGFyZ2V0PSJfYmxhbmsiPjwldGhpcy5qc29uT2JqLnJlc3VsdHNbaV0udGl0bGVOb0Zvcm1hdHRpbmclPjwvYT4nKwogICAgICAgICAgICAgICAgICAgICAgICAgJzwvcD4nKwogICAgICAgICAgICAgICAgICAgICAgICAgJzxwIGNsYXNzPSJteVNuaXBwZXQiPjwldGhpcy5qc29uT2JqLnJlc3VsdHNbaV0uY29udGVudE5vRm9ybWF0dGluZyU+PC9wPicrCiAgICAgICAgICAgICAgICAnPCV9JT4nOwogICAgICAgIHRlbXBsYXRlKz0nPHA+PHA+LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLTxwIGNsYXNzPSJ0ZW1wIiBtYXJnaW4tbGVmdD0iMjBweCI+IiA8JXRoaXMuanNvbk9iai5yZXN1bHRzLmxlbmd0aCU+ICIgIGl0ZW1zIGhhdmUgYmVlbiBsb2FkIDwvcD4nOwogICAgICAgIHZhciBodG1sOwogICAgICAgIGlmKHN1Y2Nlc3M9PT1mYWxzZSl7CiAgICAgICAgICAgIGh0bWw9JzxkaXYgY2xhc3M9ImxvYWRpbmctdGlwcyIgYWxpZ249ImNlbnRlciI+5Ye66ZSZ5LqGLi4uLi4uPC9kaXY+JzsKICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgaWYodGhpcy5tb2RlbC5qc29uT2JqLnJlc3VsdHMubGVuZ3RoPT09MCl7CiAgICAgICAgICAgICAgICBodG1sPSc8ZGl2IGNsYXNzPSJsb2FkaW5nLXRpcHMiIGFsaWduPSJjZW50ZXIiPuaXoOaQnOe0oue7k+aenC4uLuaNouS4quWFs+mUruivjemHjeaWsOivleivle+8nzwvZGl2Pic7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgaHRtbD1UZW1wbGF0ZUVuZ2luZSh0ZW1wbGF0ZSx0aGlzLm1vZGVsKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhpcy5VSS5teUNvbnRlbnQuaW5uZXJIVE1MID0gaHRtbDsKICAgIH0sCiAgICBjbG9zZTpmdW5jdGlvbigpewogICAgICAgIHRoaXMuVUkubXlEaXYuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICB0aGlzLlVJLmJnTm9kZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIHRoaXMuVUkuaW5wdXRFbGUudmFsdWUgPSAnJzsKICAgIH0sCiAgICBsb2FkaW5nOmZ1bmN0aW9uKCl7CiAgICAgICAgdGhpcy5VSS5teUNvbnRlbnQuaW5uZXJIVE1MID0gJzxpbWcgIHdpZHRoPSI2MDBweCIgc3JjPSJkYXRhOmltYWdlL2dpZjtiYXNlNjQsUjBsR09EbGhKZ0p1QWNRUUFQK0tBQ0ZNZGx4OG01ZXJ2OFRQMmpCWWY5UGI1RTF3a2FhM3lMWEQwVDlraUltZ3RtdUlwSHFVcmZEejl2Ly8vd0FBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUNIL0MwNUZWRk5EUVZCRk1pNHdBd0VBQUFBaCtRUUZNZ0FRQUN3QUFBQUFKZ0p1QVFBRi8rQWpqbVJwbm1pcXJtenJ2bkFzejNSdDMzaXU3M3p2LzhDZ2NFZ3NHby9JcEhMSmJEcWYwS2gwU3ExYXI5aXNkc3Z0ZXIvZ3NIaE1McHZQNkxSNnpXNjczL0M0ZkU2djIrLzR2SDdQNy92L2dJR0NnNFNGaG9lSWlZcUxqSTJPajVDUmtwT1VsWmFYbUptYW01eWRucCtnb2FLanBLV21wNmlwcXF1c3JhNnZzTEd5czdTMXRyZTR1YnE3dkwyK3Y4REJ3c1BFeGNiSHlNbkt5OHpOenMvUTBkTFQxTlhXMTlqWjJ0dmMzZDdmNE9IaTQrVGw1dWZvNmVycjdPM3U3L0R4OHZQMDlmYjMrUG42Ky96OS92OEFBd29jU0xDZ3dZTUlFeXBjeUxDaHc0Y1FJMHFjU0xHaXhZc1lNMnJjeUxHang0OGdRNG9jU2JLa3laTW9VLytxWE1teXBjdVhNR1BLbkVtenBzMmJPSFBxM01tenA4K2ZRSU1LSFVxMHFOR2pTSk1xWGNxMHFkT25VS05LblVxMXF0V3JXTE5xM2NxMXE5ZXZZTU9LSFV1MnJObXphTk9xWGN1MnJkdTNjT1BLblV1M3J0MjdlUFBxM2N1M3I5Ky9nQU1MSGt5NHNPSERpQk1yWHN5NHNlUEhrQ05Mbmt5NXN1WExtRE5yM3N5NXMrZlBvRU9MSGsyNnRPblRxRk9yWHMyNnRldlhzR1BMbmsyN3R1M2J1SFByM3MyN3QrL2Z3SU1MSDA2OHVIRXJCZ2dRQ0tQOE9CSUJBUVN3R0ZBZ2dQVUFEQXlrT0JDZ0FJb0IxNjhmR0dBQ3V2UVIwQU5vUngvZEJBSUY0UlVrY0U3RS9BcnU0YTBYV0c3Q3dIVUVKNENYbjNVSGxHQWZld0VVeU43L2VTTTBNS0IxQU5JWHhJSGZXWmZkQXc0Z1VKMTNKaXh3SFlNa0NLZ2NBUWlrdHdBSkZENlFYZ0RraVpDaWdBS3NwNkYxRWs3WVhnclZnZmdBQWRhMVNFSjErQVZJSXdrTURPbmlqVWZxdCtDUFNJcUFnSFh6MWVoRGlpWHdHRUNVSkhDbll3TFdHVkRkaVNVSVdJSi9WeTdKWG5YWUhjbWdsVmlPc0o2VVV6WVpwcEVoMHZsQWtRVjZxSUFKWXBiUW81bHFlaGpBY2hUMkNXY1JWTllaZ0pDTGt2QW5tVzArWU9nSWY2cUpZbnZWN1Zrb25mbjVlR2dPaVk0d3FhaDBDb2lBY3RVMU1HZWpqcklJcUlydFBjbmlwcXcrME9tbk80UXFBcGRsbHNDZGdpTGdOK0NxWTBMNTZvSHB3YmVtc1NLTVdDbXVPT2dxUW81VlBrdm0vNE1SaWpDcWc3V21TR0Y0SUFKcHdyUFEyZ0RkQVNPT3FHaU1HRkxYSFFtQytwcWdvaU1td0MyWWxnSXFZSk13cnBkQWVwNE80Q2tCQXBPQXdBRFpsZ3ZyZzU2dUdGNEJiVmJIUUFteXZybHZmc0RtcS9FRDhNbko3WUFGdkdrbGY1TFNLUzJjRG9mbnFhUWRXL2ptQTd3bUxJSjErRjVNNE1xd2dwaWlsVG8rOEY1OEs0OU1hcmR5S3Z4Q2NpUjcwWnpSVERmdDlOTlFSeTMxMUZSWGJmWFZXR2V0OWRaY2QrMzExMkNITFhZekFKUnQ5dGxtcTREMjJtV3J6VGJhYnIrZGRncHlueDEzM1hmTG5mZmJtTlU5TndwK3QwMTM0SHV6WGZqYWg4TTl1TitKMjMxWjRBQzRQYmprZ0VjK2VlV1VueUE0NXB4M2JzTG1tbHNlZXYvZmhGOCt1dW1maTM3NjZxeVhBSHJxcU1QdXVleXRUd1o1NXJUWFBzTHJycXZlTys2L3gwNEM3OFA3WGp6d3h6OWUrdXpKTTcrNzhjM25MbjMwMHorUHZQWENZMi9aN2RtTFFMejIxWU1mdlBQZVF5OCs5ZU9IWDM3M2tIRlAvZ1Bmci84Ky9PYlRmNzM4Nzhkdi8veng2KytZKzdyRFh3RDNsNy82RVZCOUIweWYrdlRYUHdQK2IzbWhZOXppOERaQnZWV1FieGMwWEFZUnQwSEZiUStDcVpOZzVVUVlRUXFPMElRbHRPQUpWWmhDREk3dGhUQ01vUXhuU01NYTJ2Q0dPTXloRG5mSXd4NzY4SWRBREtJUWgwakVJaHJ4aUVoTW9oS1h5TVFtT3ZHSlVJeWlGS2RJeFNwYThZcFl6S0lXdDhqRkxucnhpMkFNb3hqSFNNYVdNcHJ4akdoTW94clh5TVkydXZHTmNJeWpIT2RJeHpyYThZNTR6S01lOThqSFB2cnhqNEFNcENBSFNjaENHdktRaUV5a0loZkp5RVk2OHBHUWpLUWtKMG5KU2xyeWtwak1wQ1kzeWNsT2V2S1RvQXlsS0VkSnlsS2E4cFNvVEtVcVY4bktWcnJ5bGJDTXBTeG5TY3RhMnZLV3VNeWxMbmZKeTE3NjhwZkFES1l3aDBuTVlocnptTWhNcGpLWHljeG1Pdk9aYUFnQkFDSDVCQVV5QUJBQUxOZ0F4Z0FKQUFjQUFBVUtJQ0NPWkdtZWFLcWlJUUFoK1FRRk1nQVFBQ3p2QU1ZQUNRQUhBQUFGQ2lBZ2ptUnBubWlxb2lFQUlma0VCVElBRUFBc0JnSEdBQWtBQndBQUJRb2dJSTVrYVo1b3FxSWhBQ0g1QkFVeUFCQUFMQjBCeGdBSkFBY0FBQVVLSUNDT1pHbWVhS3FpSVFBaCtRUUZNZ0FRQUN3MEFjWUFDUUFIQUFBRkNpQWdqbVJwbm1pcW9pRUFJZmtFQlRJQUVBQXNTd0hHQUFrQUJ3QUFCUW9nSUk1a2FaNW9xcUloQUNINUJBVXlBQkFBTEdJQnhnQUpBQWNBQUFVS0lDQ09aR21lYUtxaUlRQTciIC8+JzsKICAgIH0sCiAgICByZWZsZXNoUGFnZU5hdmk6ZnVuY3Rpb24oKXsKICAgICAgICB2YXIgcGFnZT17Y3VycjoxLHRvdGFsUGFnZToxLHByZTp0cnVlLG5leHQ6dHJ1ZSxsc3Q6W119OwogICAgICAgIHBhZ2UuY3Vycj10aGlzLm1vZGVsLmN1cnI7CiAgICAgICAgcGFnZS50b3RhbFBhZ2U9dGhpcy5tb2RlbC50b3RhbFBhZ2U+PTEwPzEwOnRoaXMubW9kZWwudG90YWxQYWdlOwogICAgICAgIHBhZ2UucHJlPXBhZ2UuY3Vycj4xP3RydWU6ZmFsc2U7CiAgICAgICAgcGFnZS5uZXh0PXBhZ2UudG90YWxQYWdlPnBhZ2UuY3Vycj90cnVlOmZhbHNlOwogICAgICAgIGZvcih2YXIgaT0xO2k8PXBhZ2UudG90YWxQYWdlO2krKyl7CiAgICAgICAgICAgIHBhZ2UubHN0LnB1c2goaSk7CiAgICAgICAgfQogICAgICAgIHZhciB0ZW1wbGF0ZT0gJ1wKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InBhZ2VzZSAiaWQ9Ind4ei1wYWdlc2UiPlwKICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJwYWdlLWNvbnRlbnQiPlwKICAgICAgICAgICAgICAgIDxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgY2xhc3M9IiA8JSBpZih0aGlzLnByZSl7ICU+IHBhZ2UtbnVtYmVyIDwlfWVsc2V7JT4gZ2xvYmFsLWRpc2FibGVkIDwlfSU+IG1vdS1ldnQiIGRhdGEtcGFnZT0iPCV0aGlzLmN1cnItMSU+Ij7kuIrkuIDpobU8L2E+XAogICAgICAgICAgICAgICAgPCVmb3IodmFyIGkgaW4gdGhpcy5sc3QpeyU+XAogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJwYWdlLW51bWJlciA8JWlmKHRoaXMubHN0W2ldPT10aGlzLmN1cnIpeyU+IGdsb2JhbC1kaXNhYmxlZCA8JX0lPiIgZGF0YS1wYWdlPSI8JXRoaXMubHN0W2ldJT4iPjwldGhpcy5sc3RbaV0lPjwvc3Bhbj5cCiAgICAgICAgICAgICAgICA8JX0lPlwKICAgICAgICAgICAgICAgIDwvc3Bhbj5cCiAgICAgICAgICAgICAgICA8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSIgPCUgaWYodGhpcy5uZXh0KXsgJT4gcGFnZS1udW1iZXIgPCV9ZWxzZXslPiBnbG9iYWwtZGlzYWJsZWQgPCV9JT4gbW91LWV2dCIgZGF0YS1wYWdlPSI8JXRoaXMuY3VycisxJT4iPuS4i+S4gOmhtTwvYT5cCiAgICAgICAgICAgICAgICA8L2Rpdj5cCiAgICAgICAgICAgICAgICAnOwogICAgICAgIHZhciBodG1sPVRlbXBsYXRlRW5naW5lKHRlbXBsYXRlLHBhZ2UpOwogICAgICAgIHRoaXMuVUkucGFnZXNlLmlubmVySFRNTCA9IGh0bWw7CiAgICB9CiB9OwoKCiB2YXIgQ29udHJvbGxlcj1mdW5jdGlvbihtb2RlbCx2aWV3ZXIpewogICAgdGhpcy5tb2RlbD1tb2RlbDsKICAgIHRoaXMudmlld2VyPXZpZXdlcjsKCiAgICB2YXIgX3NlbGY9dGhpczsKCiAgICB0aGlzLnZpZXdlci5zZWFyY2hDbGljay5hdHRhY2goZnVuY3Rpb24oc2VuZGVyLGFyZ3MpewogICAgICAgIF9zZWxmLnNlYXJjaChhcmdzLmN1cnIsYXJncy5rZXl3b3JkKTsKICAgIH0pOwogICAgdGhpcy52aWV3ZXIuY2xvc2VDbGljay5hdHRhY2goZnVuY3Rpb24oKXsKICAgICAgICBfc2VsZi5jbG9zZSgpOwogICAgfSk7CiAgICB0aGlzLnZpZXdlci5lbmdpbmVPcHRDaGFuZ2UuYXR0YWNoKGZ1bmN0aW9uKHNlbmRlcixhcmdzKXsKICAgICAgICBfc2VsZi5zZXRFbmdpbmUoYXJncyk7CiAgICB9KTsKICAgIHRoaXMudmlld2VyLnRvUGFnZUNsaWNrLmF0dGFjaChmdW5jdGlvbihzZW5kZXIsYXJncyl7CiAgICAgICAgX3NlbGYudG9QYWdlKGFyZ3MpOwogICAgfSk7CgogICAgdGhpcy5tb2RlbC5yZXF1ZXN0RXZlbnQuYXR0YWNoKGZ1bmN0aW9uKCl7CiAgICAgICAgX3NlbGYubG9hZGluZygpOwogICAgfSk7IAogICAgdGhpcy5tb2RlbC5jb250ZW50VXBkYXRlZC5hdHRhY2goZnVuY3Rpb24oc3RhdGUpewogICAgICAgIF9zZWxmLnJlZmxlc2goc3RhdGUpOwogICAgfSk7CgogfTsKIENvbnRyb2xsZXIucHJvdG90eXBlPXsKICAgIHNlYXJjaDpmdW5jdGlvbihjdXJyLGFyZ3MpewogICAgICAgIHRoaXMubW9kZWwudXBkYXRlQ3VycihjdXJyKTsKICAgICAgICB0aGlzLm1vZGVsLnVwZGF0ZUtleXdvcmQoYXJncyk7CiAgICAgICAgdGhpcy5tb2RlbC5yZXF1ZXN0KCk7CiAgICAgICAgdGhpcy52aWV3ZXIuc2hvdygpOwogICAgfSwKICAgIHNldEVuZ2luZTpmdW5jdGlvbihlbmdpbmUpewogICAgICAgIHRoaXMubW9kZWwuc2V0RW5naW5lKGVuZ2luZSk7CiAgICAgICAgdGhpcy52aWV3ZXIudXBkYXRlRW5naW5lKCk7CiAgICB9LAogICAgdG9QYWdlOmZ1bmN0aW9uKHRvUGFnZU51bSl7CiAgICAgICAgdGhpcy5tb2RlbC51cGRhdGVDdXJyKHRvUGFnZU51bSk7CiAgICAgICAgdGhpcy5tb2RlbC5yZXF1ZXN0KCk7CiAgICB9LAogICAgY2xvc2U6ZnVuY3Rpb24oKXsKICAgICAgICB0aGlzLm1vZGVsLmRlc3RvcnkoKTsKICAgICAgICB0aGlzLnZpZXdlci5jbG9zZSgpOwogICAgfSwKICAgIGxvYWRpbmc6ZnVuY3Rpb24oKXsKICAgICAgICB0aGlzLnZpZXdlci5sb2FkaW5nKCk7CiAgICB9LAogICAgcmVmbGVzaDpmdW5jdGlvbigpewogICAgICAgIHRoaXMudmlld2VyLnJlZmxlc2goKTsKICAgICAgICB0aGlzLnZpZXdlci5yZWZsZXNoUGFnZU5hdmkoKTsKICAgIH0sCiAgICByZWZsZXNoRW5naW5lTHN0OmZ1bmN0aW9uKCl7CiAgICAgICAgdGhpcy52aWV3ZXIucmVmbGVzaEVuZ2luZUxzdCgpOwogICAgfSwKIH07CgoKCmZ1bmN0aW9uIG5ld0luaXQgKCkgewogICAgLy9yZW1vdmUgYWR2cwogICAgLy9jcmVhdGUgc2VhcmNoIGJhcgogICAgdmFyIHRhcmdldE5vZGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZmluZC1saWdodC1pY29uJykucGFyZW50Tm9kZS5wYXJlbnROb2RlOwogICAgaWYgKHRhcmdldE5vZGUucGFyZW50Tm9kZS5sYXN0Q2hpbGQuZ2V0QXR0cmlidXRlKCJub2RlLXR5cGUiKT09ImhlYWRlci11bmlvbiIpIHsKICAgICAgICB0YXJnZXROb2RlLnBhcmVudE5vZGUubGFzdENoaWxkLnJlbW92ZSgpOwogICAgfQogICAgdmFyIHd4elNlYXJjaEJhck5vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkZCcpOwogICAgd3h6U2VhcmNoQmFyTm9kZS5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywnaGVhZGVyLXd4emJhciBoZWFkZXItaW5mbycpOwogICAgLy93eHpTZWFyY2hCYXJOb2RlLnNldEF0dHJpYnV0ZSgnbm9kZS10eXBlJywnaGVhZGVyLWFwcHMnKTsKICAgIHd4elNlYXJjaEJhck5vZGUuaW5uZXJIVE1MID0KICAgICAgICAgICAgJzxzcGFuIGNsYXNzPSJ3eHotbWVudSB3eHotZHJvcGRvd24iPlwKICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ1c2VyLW5hbWUiIGlkPSJ3eHpNZW51RGlzcGxheSI+Z29vZ2xlPC9zcGFuPlwKICAgICAgICAgICAgICAgIDxlbSBjbGFzcz0iaWNvbiBpY29uLWRyb3Bkb3duLWFycm93Ij48L2VtPlwKICAgICAgICAgICAgICAgIDx1bCBjbGFzcz0id3h6LW1lbnUtY29udGVudCIgaWQ9Ind4el9lbmdpbmVMc3QiPlwKICAgICAgICAgICAgICAgIDwvdWw+XAogICAgICAgICAgICA8L3NwYW4+XAogICAgICAgICAgICA8Zm9ybSBjbGFzcz0ic2VhcmNoLWZvcm0iIGlkPSJ3eHpfc2VhcmNoRm9ybSI+XAogICAgICAgICAgICAgICAgPGlucHV0IGNsYXNzPSJzZWFyY2gtcXVlcnkiIHBsYWNlaG9sZGVyPSIg5pCc57Si5YWs5byA5YiG5Lqr5paH5Lu2IiBpZD0id3h6X2lucHV0Ij5cCiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iYnV0dG9uIiB2YWx1ZT0iR08iIGNsYXNzPSJzZWFyY2gtYnV0dG9uIiBpZD0id3h6X3NlYXJjaEJ1dHRvbiI+XAogICAgICAgICAgICA8L2Zvcm0+JzsKICAgIC8vaW5zZXJ0IGFmdGVyIHRhcmdldCBub2RlCiAgICB0YXJnZXROb2RlLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHd4elNlYXJjaEJhck5vZGUsdGFyZ2V0Tm9kZS5uZXh0U2xpYmluZyk7CiAgICAvL2JhY2tncm91bmQKICAgIHZhciB3eHpiZ05vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIHd4emJnTm9kZS5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywnd3h6LWJnJyk7CiAgICB3eHpiZ05vZGUuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKS5hcHBlbmRDaGlsZCh3eHpiZ05vZGUpOwoKICAgIC8vY3JlYXRlIGRpc3BsYXkgZnJhbWUKICAgIHZhciB3eHpEaWFsb2dOb2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICB3eHpEaWFsb2dOb2RlLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCdkaWFsb2cgZGlhbG9nLWdyYXknKTsKICAgIHd4ekRpYWxvZ05vZGUuc2V0QXR0cmlidXRlKCdpZCcsJ3d4el9teURpdicpOwogICAgd3h6RGlhbG9nTm9kZS5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywnei1pbmRleDo5OTtwb3N0aW9uOmFic29sdXRlOycpOwogICAgd3h6RGlhbG9nTm9kZS5zdHlsZS53aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoIC8gMyAqIDIgKyAncHgnOwogICAgd3h6RGlhbG9nTm9kZS5zdHlsZS5sZWZ0ID0gJzUwJSc7ICAgIAogICAgd3h6RGlhbG9nTm9kZS5zdHlsZS5tYXJnaW5MZWZ0ID0gKC0xICogd2luZG93LmlubmVyV2lkdGggLyAzKSArICdweCc7IAogICAgd3h6RGlhbG9nTm9kZS5pbm5lckhUTUwgPSAKICAgICAgICAnXAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJkaWFsb2ctaGVhZGVyIiBpZD0id3h6X215RGl2X3RpdGxlIj5cCiAgICAgICAgICAgICAgICA8aDMgPjxzcGFuIGNsYXNzPSJkaWFsb2ctaGVhZGVyLXRpdGxlIj7mkJzntKI8L3NwYW4+PC9oMz5cCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJkaWFsb2ctY29udHJvbCIgaWQ9Ind4el9jbG9zZUJ1dHRvbiI+PHNwYW4gY2xhc3M9ImRpYWxvZy1pY29uIGRpYWxvZy1jbG9zZSBpY29uIGljb24tY2xvc2UiPjxzcGFuIGNsYXNzPSJzaWNvbiI+w5c8L3NwYW4+PC9zcGFuPjwvZGl2PlwKICAgICAgICAgICAgPC9kaXY+XAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJkbGctYmQgZy1jbGVhcmZpeCBvZmZsaW5lLWxpc3QtZGlhbG9nIj5cCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ3eHotY29udGVudCI+XAogICAgICAgICAgICAgICAgPC9kaXY+XAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ib2ZmbGluZS1ib3R0b20iPlwKICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJvZmZsaW5lLXBhZ2VpbmciPlwKICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icGFnZXNlICIgaWQ9Ind4ei1wYWdlc2UiPlwKICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XAogICAgICAgICAgICAgICAgICAgIDwvZGl2PlwKICAgICAgICAgICAgPC9kaXY+XAogICAgICAgICc7CgogICAgLy9hcHBlbmQgdG8gYm9keQoKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKS5hcHBlbmRDaGlsZCh3eHpEaWFsb2dOb2RlKTsKCgogICAgdmFyIHd4elN0eWxlTm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3N0eWxlJyk7CiAgICB3eHpTdHlsZU5vZGUudGV4dENvbnRlbnQgPSAKICAgICdcCiAgICAud3h6LW1lbnV7Y3Vyc29yOnBvaW50ZXI7IGhlaWdodDoxMDAlOyBkaXNwbGF5OmlubGluZS1ibG9jazsgdmVydGljYWwtYWxpZ246bWlkZGxlO3Bvc2l0aW9uOnJlbGF0aXZlO31cCiAgICAud3h6LW1lbnU6aG92ZXIgLnd4ei1tZW51LWNvbnRlbnR7ZGlzcGxheTpibG9jazsgei1pbmRleDo5OX1cCiAgICAud3h6LW1lbnU6aG92ZXIgLmljb24tZHJvcGRvd24tYXJyb3d7dHJhbnNmb3JtOnJvdGF0ZSgxODApO31cCiAgICAud3h6LW1lbnUtb3B0aW9ue3RleHQtYWxpZ246Y2VudGVyO2xpbmUtaGVpZ2h0OjMwcHg7Y3Vyc29yOnBvaW50ZXI7YmFja2dyb3VuZDp3aGl0ZTtjb2xvcjpibGFjaztib3JkZXI6MXB4IHNvbGlkICNlZmY0Zjg7Ym9yZGVyLWNvbGxhcHNlOiBjb2xsYXBzZTt9XAogICAgI3d4el9zZWFyY2hGb3Jte2Rpc3BsYXk6aW5saW5lLWJsb2NrOyB2ZXJ0aWNhbC1hbGlnbjptaWRkbGU7fVwKICAgICN3eHpfaW5wdXR7cGFkZGluZzowIDRweDsgYm9yZGVyOiAxcHggc29saWQgI2MwZDlmZTtib3JkZXItcmFkaXVzOiA0cHg7bGluZS1oZWlnaHQ6IDIycHg7fVwKICAgICN3eHpfc2VhcmNoQnV0dG9ue2N1cnNvcjpwb2ludGVyOyBiYWNrZ3JvdW5kOiAjM2I4Y2ZmO2JvcmRlcjogMnB4IHNvbGlkICMzYjhjZmY7Y29sb3I6ICNmOGZiZmY7Ym9yZGVyLXJhZGl1czogNnB4O31cCiAgICAud3h6LW1lbnUtY29udGVudHtkaXNwbGF5Om5vbmU7IHBvc2l0aW9uOmFic29sdXRlO3RvcDoxMDAlO2xlZnQ6MDt3aWR0aDo4MHB4O31cCiAgICAjd3h6TWVudURpc3BsYXl7bGluZS1oZWlnaHQ6IDQwcHg7IGRpc3BsYXk6aW5saW5lLWJsb2NrOyB3aWR0aDo0MHB4O31cCiAgICAud3h6LWJne3Bvc2l0aW9uOiBmaXhlZDsgbGVmdDogMHB4OyB0b3A6IDBweDsgYm90dG9tOiAwcHg7IHJpZ2h0OiAwcHg7IHotaW5kZXg6IDUwOyBiYWNrZ3JvdW5kOiByZ2IoMCwgMCwgMCk7IG9wYWNpdHk6IDAuNTt9XAogICAgLnd4ei1jb250ZW50e2hlaWdodDogNTAwcHg7bGluZS1oZWlnaHQ6IDIwMCU7dGV4dC1hbGlnbjogbGVmdDt3aGl0ZS1zcGFjZTogbm9ybWFsO3BhZGRpbmc6MCAxMHB4O292ZXJmbG93OmF1dG87fVwKICAgIC53eHotY2xvc2V7bWFyZ2luLXJpZ2h0OjIwcHg7aW1wb3J0YW50O2hlaWdodDoyMHB4O2N1cnNvcjpwb2ludGVyfVwKICAgIC53eHotbmV4dHttYXJnaW4tcmlnaHQ6MjBweDtmbG9hdDpyaWdodDtoZWlnaHQ6MjBweDtjdXJzb3I6cG9pbnRlcn1cCiAgICAud3h6LWZyb250e21hcmdpbi1yaWdodDo0MHB4O2Zsb2F0OnJpZ2h0O2hlaWdodDoyMHB4O2N1cnNvcjpwb2ludGVyfVwKICAgIC53eHotY29udGVudCBhe2NvbG9yOiMwMDY2RkYhaW1wb3J0YW50O2ZvbnQ6IDE0cHgvMS41IGFyaWFsLHNhbnMtc2VyaWYhaW1wb3J0YW50O31cCiAgICAnOwogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaGVhZCcpLmFwcGVuZENoaWxkKHd4elN0eWxlTm9kZSk7ICAgIAoKCgoKICAgIHZhciBiZE1vZGVsPW5ldyBCYXNlTW9kZWwoWydiaW5nJywnZ29vZ2xlJ10pOwoKICAgIGJkTW9kZWwudXJscy5iaW5nPSdodHRwczovL2NuLmJpbmcuY29tL3NlYXJjaD9xPSc7CiAgICBiZE1vZGVsLnVybHMuZ29vZ2xlPSdodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9jdXN0b21zZWFyY2gvdjFlbGVtZW50P2tleT1BSXphU3lDVkFYaVV6UllzTUwxUHY2UndTRzFndW5tTWlrVHpRcVkmcnN6PWZpbHRlcmVkX2NzZSZudW09MTAmaGw9ZW4mcHJldHR5UHJpbnQ9dHJ1ZSZzb3VyY2U9Z2NzYyZnc3M9LmNvbSZzaWc9YmI3M2Q2ODAwZmNhMjk5YjM2NjY1ZWJmZjRkMDEwMzcmY3g9MDE4MTc3MTQzMzgwODkzMTUzMzA1OnlrMHFwZ3lkeF9lJmNzZV90b2s9QUhLWW90V1ZtdlYxd29oQTNnOG9ORkFtXzZjSzoxNDk1NjYwMTQ4MzEzJnE9JzsKICAgIGJkTW9kZWwudG9Kc29uLmJpbmc9ZnVuY3Rpb24oaHRtbCl7CiAgICAgICAgdmFyIGRhdGEgPSB7IGN1cnNvcjogeyBlc3RpbWF0ZWRSZXN1bHRDb3VudDogMCwgcmVzdWx0Q291bnQ6IDAgfSwgcmVzdWx0czogW10gfTsKICAgICAgICAvL+WFtuS4reS4gOadoee7k+aenO+8mgogICAgICAgIC8vPGxpIGNsYXNzPSJiX2FsZ28iPjxoMj4KICAgICAgICAvLzxhIGhyZWY9Imh0dHA6Ly9wYW4uYmFpZHUuY29tL3dhcC9saW5rP3VrPTI5MjMxMTA2NTgmYW1wO3NoYXJlaWQ9MzQ2ODgxNTgzNCZhbXA7dGhpcmQ9MyIgdGFyZ2V0PSJfYmxhbmsiIGg9IklEPVNFUlAsNTEwMS4xIj5ZRkstPHN0cm9uZz5SSzMzNjg8L3N0cm9uZz4tODE4OS0yMDE1MDgyMS5yYXJf5YWN6LS56auY6YCf5LiL6L29fOeZvuW6puS6kSDnvZHnm5ggLi4uPC9hPjwvaDI+CiAgICAgICAgLy88ZGl2IGNsYXNzPSJiX2NhcHRpb24iPjxwPuaWh+S7tuWQjTpZRkstPHN0cm9uZz5SSzMzNjg8L3N0cm9uZz4tODE4OS0yMDE1MDgyMS5yYXIg5paH5Lu25aSn5bCPOjQ5Ny41NU0g5YiG5Lqr6ICFOuaZqOiKr0ZBRSDliIbkuqvml7bpl7Q6MjAxNS04LTIxIDE0OjA3IOS4i+i9veasoeaVsDo1IC4uLiDnmbvlvZXnmb7luqbkupHlrqLmiLfnq6/pgIEyVOepuumXtCDnlLXohJHniYg8L3A+CiAgICAgICAgLy88ZGl2IGNsYXNzPSJiX2F0dHJpYnV0aW9uIiB1PSIwfDUwNTh8NDgzNTI3MTM4Njk5MTI0OHw4T01oY0dJSWo4R1cwOEk0MVI1VW9TeUpwbDJfNVBueSI+PGNpdGU+PHN0cm9uZz5wYW4uYmFpZHUuY29tPC9zdHJvbmc+L3dhcC9saW5rP3VrPTI5MjMxMTA2NTgmYW1wO3NoYXJlaWQ9MzQ2ODgxNTgzNCZhbXA7Li4uPC9jaXRlPjxzcGFuIGNsYXNzPSJjX3RsYnhUcmciPgogICAgICAgIC8vPHNwYW4gY2xhc3M9ImNfdGxieEgiIEg9IkJBU0U6Q0FDSEVEUEFHRURFRkFVTFQiIEs9IlNFUlAsNTEwMi4xIj48L3NwYW4+PC9zcGFuPjwvZGl2PjwvZGl2PjwvbGk+CiAgICAgICAgLy9odHRwOi8vd3d3LmpiNTEubmV0L2FydGljbGUvNDkwODMuaHRt5ZyoSlPkuK3op6PmnpBIVE1M5a2X56ym5Liy56S65L6L5Luj56CB77yaCiAgICAgICAgdmFyIHJhd1Jlc3VsdEhUTUwgPSBodG1sLm1hdGNoKC88bGlcc2NsYXNzPSJiX2FsZ28iPiguKj8pPFwvbGk+L2cpOwogICAgICAgIHZhciBiX3Jlc3VsdHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd1bCcpOwogICAgICAgIGJfcmVzdWx0cy5pbm5lckhUTUwgPSByYXdSZXN1bHRIVE1MOwogICAgICAgIHZhciBiX2FsZ29fQXJyeSA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGJfcmVzdWx0cy5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdiX2FsZ28nKSk7CiAgICAgICAgYl9hbGdvX0FycnkuZm9yRWFjaChmdW5jdGlvbihlbGUsIGluZGV4KSB7CiAgICAgICAgICAgIHZhciB0ZW1wUmVzdWx0ID0gewogICAgICAgICAgICAgICAgdW5lc2NhcGVkVXJsOiAiIiwKICAgICAgICAgICAgICAgIHRpdGxlTm9Gb3JtYXR0aW5nOiAiIiwKICAgICAgICAgICAgICAgIGNvbnRlbnROb0Zvcm1hdHRpbmc6ICIiCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHRlbXBSZXN1bHQudW5lc2NhcGVkVXJsID0gZWxlLnF1ZXJ5U2VsZWN0b3IoJ2gyIGEnKS5nZXRBdHRyaWJ1dGUoJ2hyZWYnKTsKICAgICAgICAgICAgdGVtcFJlc3VsdC50aXRsZU5vRm9ybWF0dGluZyA9IGVsZS5xdWVyeVNlbGVjdG9yKCdoMiBhJykudGV4dENvbnRlbnQ7CiAgICAgICAgICAgIHRlbXBSZXN1bHQuY29udGVudE5vRm9ybWF0dGluZyA9IGVsZS5xdWVyeVNlbGVjdG9yKCcuYl9jYXB0aW9uIHAnKS50ZXh0Q29udGVudDsKICAgICAgICAgICAgZGF0YS5yZXN1bHRzLnB1c2godGVtcFJlc3VsdCk7CiAgICAgICAgfSk7CiAgICAgICAgLy8vL+WkhOeQhue7n+iuoee7k+aenCwKCiAgICAgICAgdmFyIHJhd1Jlc3VsdENvdW50PShodG1sLm1hdGNoKC8ic2JfY291bnQiPihbXjxdKykvKSAmJiBodG1sLm1hdGNoKC8ic2JfY291bnQiPihbXjxdKykvKVsxXSkgfHwgJzAnOwogICAgICAgIHZhciBtYXRjaExzdD1bXTsgICAgCiAgICAgICAgbWF0Y2hMc3Q9cmF3UmVzdWx0Q291bnQubWF0Y2goLyhbMC05XXsxLDN9KCxbMC05XXszfSkrKS9nKTsKICAgICAgICBpZihtYXRjaExzdCE9PW51bGwpey8v5Yy56YWNMTAwLDAwMCwxMTHkuYvnsbvnmoTmg4XlhrUKICAgICAgICAgICAgZGF0YS5jdXJzb3IucmVzdWx0Q291bnQ9bWF0Y2hMc3RbMF0ucmVwbGFjZSgnLCcsJycpOwogICAgICAgIH1lbHNlewogICAgICAgICAgICBtYXRjaExzdD1yYXdSZXN1bHRDb3VudC5tYXRjaCgvXGQrL2cpOwogICAgICAgICAgICBpZihtYXRjaExzdCE9PW51bGwpey8v5Yy56YWNMTAg5Liq57uT5p6c5LmL57G755qE5oOF5Ya177yM5Lul5Y+KMS0xMe+8jOWFsTEx5Liq55qE5oOF5Ya1CiAgICAgICAgICAgIGRhdGEuY3Vyc29yLnJlc3VsdENvdW50PW1hdGNoTHN0LnBvcCgpOwogICAgICAgICAgICB9ZWxzZXsvL+WMuemFjeaXoOeahOaDheWGtQogICAgICAgICAgICBkYXRhLmN1cnNvci5yZXN1bHRDb3VudD0wOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBkYXRhLmN1cnNvci5yZXN1bHRDb3VudCA9IHBhcnNlSW50KCBkYXRhLmN1cnNvci5yZXN1bHRDb3VudC50b1N0cmluZygpLDEwKTsKICAgICAgICBkYXRhLmN1cnNvci5lc3RpbWF0ZWRSZXN1bHRDb3VudCA9IGRhdGEuY3Vyc29yLnJlc3VsdENvdW50OwogICAgICAgIHJldHVybiBkYXRhOyAgICAgICAgCiAgICB9OwogICAgYmRNb2RlbC50b0pzb24uZ29vZ2xlPWZ1bmN0aW9uKHJlc3BvbnNlVGV4dCl7CiAgICAgICAgdmFyIGRhdGE9SlNPTi5wYXJzZShyZXNwb25zZVRleHQpOwogICAgICAgIGRhdGEuY3Vyc29yLnJlc3VsdENvdW50PXBhcnNlSW50KGRhdGEuY3Vyc29yLnJlc3VsdENvdW50LnNwbGl0KCcsJykuam9pbignJykpOwogICAgICAgIHJldHVybiBkYXRhOyAgICAgICAgCiAgICB9OwoKICAgIGJkTW9kZWwuY29tcGlsZVVybC5iaW5nPWZ1bmN0aW9uKF9zZWxmKXsKICAgICAgICAvL3JldHVybiAnaHR0cHM6Ly9jbi5iaW5nLmNvbS9zZWFyY2g/cT1sYWxhK3NpdGUlM0FwYW4uYmFpZHUuY29tJmZpcnN0PTEwJzsKICAgICAgICByZXR1cm4gX3NlbGYudXJscy5iaW5nICsgX3NlbGYua2V5d29yZCArICcrc2l0ZSUzQXBhbi5iYWlkdS5jb20nICsgJyZmaXJzdD0nICsgKF9zZWxmLmN1cnItMSkqMTA7CiAgICB9OwogICAgYmRNb2RlbC5jb21waWxlVXJsLmdvb2dsZT1mdW5jdGlvbihfc2VsZil7CiAgICAgICAgcmV0dXJuIF9zZWxmLnVybHMuZ29vZ2xlICsgX3NlbGYua2V5d29yZCArICcmc3RhcnQ9JyArIChfc2VsZi5jdXJyLTEpKjEwOwogICAgfTsKCiAgICB2YXIgYmRWaWV3PW5ldyBWaWV3ZXIoYmRNb2RlbCx7CiAgICAgICAgaW5wdXRFbGU6ZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3d4el9pbnB1dCcpLAogICAgICAgIHNlYXJjaEJ0bjpkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjd3h6X3NlYXJjaEJ1dHRvbicpLAogICAgICAgIGNsb3NlQnRuOmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN3eHpfY2xvc2VCdXR0b24nKSwKICAgICAgICBteURpdjpkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjd3h6X215RGl2JyksCiAgICAgICAgbXlDb250ZW50OmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy53eHotY29udGVudCcpLAogICAgICAgIG1lbnU6ZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3d4ek1lbnVEaXNwbGF5JyksCiAgICAgICAgZW5naW5lQnRuQ2xhc3NOYW1lOid3eHotbWVudS1vcHRpb24nLAogICAgICAgIGVuZ2luZUxzdDpkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjd3h6X2VuZ2luZUxzdCcpLAogICAgICAgIHBhZ2VzZTpkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjd3h6LXBhZ2VzZScpLAogICAgICAgIHRvUGFnZUJ0bkNsYXNzTmFtZToncGFnZS1udW1iZXInLAogICAgICAgIGJnTm9kZTp3eHpiZ05vZGUKICAgIH0pOwogICAgdmFyIGJkQ29udHJvbGxlcj1uZXcgQ29udHJvbGxlcihiZE1vZGVsLGJkVmlldyk7CiAgICBiZENvbnRyb2xsZXIucmVmbGVzaEVuZ2luZUxzdCgpOwoJLy/ov5nph4zlhpnnmoTkuI3lpb0KICAgIHZhciB0ZW1wU3RyID0gJyc7CiAgICB2YXIgdGVtcE9iajsKICAgIHRlbXBTdHIgPSB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3d4ell1bnBhblNlYXJjaGVyJyk7CiAgICBpZiAodGVtcFN0cikgewogICAgCXRlbXBPYmogPSBKU09OLnBhcnNlKHRlbXBTdHIpOwogICAgCWJkQ29udHJvbGxlci5zZXRFbmdpbmUodGVtcE9iai5lbmdpbmUpOwogICAgfQogICAgZWxzZXsKICAgIAliZENvbnRyb2xsZXIuc2V0RW5naW5lKCdiaW5nJyk7CiAgICB9CiAgICAKCn0KCnZhciBjb3VudGVyID0gMDsKCnZhcgp0ID0gd2luZG93LnNldEludGVydmFsKGZ1bmN0aW9uKCkgeyAvL+eZvuW6puS6keaKiuS4gOS6m+WGheWuueaUvuWIsOWQjumdouWKoOi9vSzlm6DmraTmiJHorr7nva7kuobkuIDkuKrlu7bml7blvqrnjq/vvIzmr4/pmpQyMDBtc+mAieaLqeS4gOS4i+aJgOmcgOeahOWFg+e0oO+8jOW9k+aJgOmcgOeahOWFg+e0oOWtmOWcqOaXtu+8jOW8gOWni+iEmuacrO+8jOWQjOaXtuWBnOatouW7tuaXtuW+queOryAKICAgIGlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIuZmluZC1saWdodC1pY29uIikgIT09IG51bGwpIHsKICAgICAgICB3aW5kb3cuY2xlYXJJbnRlcnZhbCh0KTsKICAgICAgICBuZXdJbml0KCk7CiAgICB9CiAgICBlbHNlewogICAgICAgIGlmKGNvdW50ZXIgPCAxMDApewogICAgICAgICAgICBjb25zb2xlLmxvZygnd2FpdGluZycpOwogICAgICAgICAgICBjb3VudGVyICsrOwogICAgICAgIH0KICAgICAgICBlbHNlewogICAgICAgICAgICB3aW5kb3cuY2xlYXJJbnRlcnZhbCh0KTsKICAgICAgICAgICAgY29uc29sZS5sb2coJ291dCBvZiB0aW1lJyk7CiAgICAgICAgfQogICAgfQp9LCAyMDApOwo="},{"name":"DuckDuckGo Extended","options":{"check_for_updates":true,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_arrayleft":false,"compat_uW_gmonkey":false,"compat_forvarin":false,"noframes":null,"awareOfChrome":false,"run_at":null,"override":{"use_includes":[],"orig_includes":[],"merge_includes":true,"use_matches":[],"orig_matches":["*://duckduckgo.com/*","http://mycroftproject.com/*"],"merge_matches":true,"use_excludes":[],"orig_excludes":["*://duckduckgo.com/post2.html"],"merge_excludes":true,"use_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null,"orig_connects":[]}},"storage":{"ts":1521546746968,"data":{}},"enabled":true,"position":13,"file_url":"https://openuserjs.org/install/tumpio/DuckDuckGo_Extended.user.js","uuid":"0d5de916-a2e3-495f-acb8-84703e466eb0","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICAgICBEdWNrRHVja0dvIEV4dGVuZGVkCi8vIEBkZXNjcmlwdGlvbiAgICAgTWFuYWdlIGxpc3Qgb2YgcXVpY2sgbGlua3MgdG8gb3RoZXIgc2VhcmNoIGVuZ2luZXMuCi8vIEBhdXRob3IgICAgICAgICAgdHVtcGlvCi8vIEBvdWpzOmF1dGhvciAgICAgdHVtcGlvCi8vIEBuYW1lc3BhY2UgICAgICAgdHVtcGlvQHNjaS5maQovLyBAaG9tZXBhZ2VVUkwgICAgIGh0dHBzOi8vb3BlbnVzZXJqcy5vcmcvc2NyaXB0cy90dW1waW8vRHVja0R1Y2tHb19FeHRlbmRlZAovLyBAc3VwcG9ydFVSTCAgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS90dW1waW8vZ21zY3JpcHRzCi8vIEBpY29uICAgICAgICAgICAgaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL3R1bXBpby9nbXNjcmlwdHMvbWFzdGVyL0R1Y2tEdWNrR29fRXh0ZW5kZWQvbGFyZ2UucG5nCi8vIEBtYXRjaCAgICAgICAgICAgKjovL2R1Y2tkdWNrZ28uY29tLyoKLy8gQGV4Y2x1ZGUgICAgICAgICAqOi8vZHVja2R1Y2tnby5jb20vcG9zdDIuaHRtbAovLyBAbWF0Y2ggICAgICAgICAgIGh0dHA6Ly9teWNyb2Z0cHJvamVjdC5jb20vKgovLyBAZ3JhbnQgICAgICAgICAgIEdNX2FkZFN0eWxlCi8vIEBncmFudCAgICAgICAgICAgR01fZ2V0VmFsdWUKLy8gQGdyYW50ICAgICAgICAgICBHTV9zZXRWYWx1ZQovLyBAZ3JhbnQgICAgICAgICAgIEdNX3htbGh0dHBSZXF1ZXN0Ci8vIEB2ZXJzaW9uICAgICAgICAgMi4yLjAKLy8gPT0vVXNlclNjcmlwdD09CgppZiAod2luZG93LnRvcCAhPT0gd2luZG93LnNlbGYpIC8vIE5PVEU6IERvIG5vdCBydW4gb24gaWZyYW1lcwogICAgcmV0dXJuOwoKdmFyIGRkZ19lID0gewoKICAgIGxpc3Q6IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIm9sIiksCiAgICBlbmdpbmVzOiBbXSwKCiAgICBkZWZhdWx0OiAiR29vZ2xlPT1odHRwczovL2VuY3J5cHRlZC5nb29nbGUuY29tL3NlYXJjaD9xPXtzZWFyY2hUZXJtc31cCjs7SW1hZ2VzPT1odHRwOi8vd3d3LnBpY3NlYXJjaC5jb20vaW5kZXguY2dpP3E9e3NlYXJjaFRlcm1zfVwKOztXaWtpPT1odHRwczovL2VuLndpa2lwZWRpYS5vcmcvdy9pbmRleC5waHA/dGl0bGU9U3BlY2lhbCUzQVNlYXJjaCZwcm9maWxlPWRlZmF1bHQmc2VhcmNoPXtzZWFyY2hUZXJtc31cCjs7TWFwcz09aHR0cDovL2hlcmUuY29tLz9jaWQ9bm9raWFtYXBzLWZ3LWlsYy1uYS1hY3EtbmEtb3BlbnNlYXJjaC1nMC1uYS0xJnBsY3NEbD1zZWFyY2gmcT17c2VhcmNoVGVybXN9XAo7O1lvdVR1YmU9PWh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL3Jlc3VsdHM/c2VhcmNoX3F1ZXJ5PXtzZWFyY2hUZXJtc30mYXE9ZlwKOztJTURiPT1odHRwOi8vd3d3LmltZGIuY29tL2ZpbmQ/cz1hbGwmYW1wO3E9e3NlYXJjaFRlcm1zfVwKOztNdXNpYz09aHR0cDovL3d3dy5tdXNpY3NtYXNoZXIubmV0LyN7c2VhcmNoVGVybXN9XAo7O0ZhY2Vib29rPT1odHRwczovL3d3dy5mYWNlYm9vay5jb20vc2VhcmNoLnBocD9xPXtzZWFyY2hUZXJtc31cCjs7R29vZ2xlKz09aHR0cHM6Ly9wbHVzLmdvb2dsZS5jb20vcy97c2VhcmNoVGVybXN9XAo7O3R3aXR0ZXI9PWh0dHBzOi8vdHdpdHRlci5jb20vIyEvc2VhcmNoL3JlYWx0aW1lL3tzZWFyY2hUZXJtc31cCjs7QW1hem9uPT1odHRwczovL3d3dy5hbWF6b24uY29tL2dwL3NlYXJjaD9pZT1VVEY4JmtleXdvcmRzPXtzZWFyY2hUZXJtc31cCjs7VG9ycmVudHM9PWh0dHA6Ly90b3JyZW50cHJvamVjdC5zZS8/dD17c2VhcmNoVGVybXN9XAo7O2ZpbGVzVHViZT09aHR0cDovL3d3dy5maWxlc3R1YmUudG8vc2VhcmNoLmh0bWw/cT17c2VhcmNoVGVybXN9XAo7O1RyYW5zbGF0ZT09aHR0cDovL3RyYW5zbGF0ZS5nb29nbGUuY29tL3RyYW5zbGF0ZV90I2F1dG98ZW58e3NlYXJjaFRlcm1zfSIsCgogICAgc3R5bGU6ICJcCiNkZGdfZXh0ZW50ZWQgeyBkaXNwbGF5OnRhYmxlOyB3aWR0aDoxMDAlOyBiYWNrZ3JvdW5kOiNDOTQ4MUMgfVwKI2RkZ19leHRlbnRlZCBvbCB7IGRpc3BsYXk6dGFibGUtY2VsbDsgcGFkZGluZy10b3A6MC4yZW07IHBhZGRpbmctYm90dG9tOjAgfVwKI2RkZ19leHRlbnRlZCBvbCBsaSB7IGRpc3BsYXk6aW5saW5lLWJsb2NrICB9XAojZGRnX2V4dGVudGVkIG9sIGxpIGEgeyBwYWRkaW5nOjAgLjY1ZW0gfVwKI2RkZ19leHRlbnRlZCBvbCBsaS5kaXNhYmxlZCBhIHsgcG9pbnRlci1ldmVudHM6IG5vbmUgfVwKI2RkZ19leHRlbnRlZCBhLCAjZGRnX2V4dGVudGVkIGE6dmlzaXRlZCB7IGNvbG9yOiNmZmY7Zm9udC13ZWlnaHQ6NzAwIH1cCiNkZGdfZXh0ZW50ZWQgYTpob3ZlciB7IGNvbG9yOiM5MUM1RUUgfVwKI2RkZ19leHRlbnRlZCAjZGRnX2Vfc2F2ZSB7IGNvbG9yOiAjNkNCRDZBIH1cCiNkZGdfZXh0ZW50ZWQgI2RkZ19lX2NhbmNlbCB7IGNvbG9yOiAjRkY4ODYxIH1cCiNkZGdfZXh0ZW50ZWRfb3B0aW9ucyB7IGJhY2tncm91bmQ6I0M5NDgxQzsgZGlzcGxheTp0YWJsZS1jZWxsOyB0ZXh0LWFsaWduOnJpZ2h0IH1cCiNkZGdfZXh0ZW50ZWRfb3B0aW9ucyA+IGEgeyBwYWRkaW5nOjAgNXB4IH1cCiNkZGdfZXh0ZW50ZWRfb3B0aW9ucy5zaG93IHVsIHsgZGlzcGxheTpibG9jayB9XAojZGRnX2V4dGVudGVkX29wdGlvbnMgdWwgeyBwb3NpdGlvbjphYnNvbHV0ZTsgcmlnaHQ6MDsgei1pbmRleDoyMDsgZGlzcGxheTpub25lOyBwYWRkaW5nOi44ZW07IGJhY2tncm91bmQ6I0M5NDgxQzsgdGV4dC1hbGlnbjpsZWZ0IH1cCiIsCgogICAgZ2V0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGUgPSBHTV9nZXRWYWx1ZSgiZW5naW5lcyIsIHRoaXMuZGVmYXVsdCkuc3BsaXQoIjs7Iik7CiAgICAgICAgdmFyIGEgPSBbXTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGUubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGEucHVzaChlW2ldLnNwbGl0KCI9PSIpKTsKICAgICAgICB0aGlzLmxlbmd0aCA9IGEubGVuZ3RoOwogICAgICAgIHJldHVybiBhOwogICAgfSwKCiAgICBzZXQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgZSA9ICIiOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5lbmdpbmVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGUgKz0gIjs7IiArIHRoaXMuZW5naW5lc1tpXS50ZXh0Q29udGVudCArICI9PSIgKyB0aGlzLmVuZ2luZXNbaV0uZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUoImRhdGEtZW5naW5lIik7CiAgICAgICAgfQogICAgICAgIEdNX3NldFZhbHVlKCJlbmdpbmVzIiwgZS5zdWJzdHIoMikpOwogICAgfSwKCiAgICBuZXdMaXN0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGwgPSAiIjsKICAgICAgICB2YXIgZSA9IHRoaXMuZ2V0KCk7CiAgICAgICAgdmFyIHQgPSBlc2NhcGUoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNlYXJjaF9mb3JtX2lucHV0IikudmFsdWUpOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZS5sZW5ndGg7IGkrKykKICAgICAgICAgICAgbCArPSAnPGxpIGRyYWdnYWJsZT0idHJ1ZSIgdmFsdWU9JyArIChpICsgMSkgKyAnIj48YSBkYXRhLWVuZ2luZT0iJyArIGVbaV1bMV0gKyAnImhyZWY9IicgKyBlW2ldWzFdLnJlcGxhY2UoIntzZWFyY2hUZXJtc30iLCB0KSArICciPicgKyBlW2ldWzBdICsgIjwvYT48L2xpPiI7CiAgICAgICAgdGhpcy5saXN0LmlubmVySFRNTCA9IGw7CiAgICAgICAgdGhpcy5lbmdpbmVzID0gdGhpcy5saXN0LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJsaSIpOwogICAgfSwKCiAgICBhcHBlbmQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgIHZhciBoID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImhlYWRlcl93cmFwcGVyIik7CiAgICAgICAgaWYoaCkgewogICAgICAgICAgICB2YXIgYiA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGgpLmJvcmRlclRvcENvbG9yOwogICAgICAgICAgICBpZiAoYi5pbmRleE9mKCIyNTUsIDI1NSwgMjU1IikgPCAwICYmIGIuaW5kZXhPZigiI2ZmZmZmZiIpIDwgMCkKICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUgKz0gIiNkZGdfZXh0ZW50ZWQsICNkZGdfZXh0ZW50ZWRfb3B0aW9ucyB7IGJhY2tncm91bmQ6IiArIGIgKyAiIWltcG9ydGFudCB9IjsKICAgICAgICB9CiAgICAgICAgR01fYWRkU3R5bGUodGhpcy5zdHlsZSk7CiAgICAgICAgZS5zZXRBdHRyaWJ1dGUoImlkIiwgImRkZ19leHRlbnRlZCIpOwogICAgICAgIGUuYXBwZW5kQ2hpbGQodGhpcy5saXN0KTsKICAgICAgICB0aGlzLm5ld0xpc3QoKTsKICAgICAgICBkb2N1bWVudC5ib2R5Lmluc2VydEJlZm9yZShlLCBkb2N1bWVudC5ib2R5LmZpcnN0Q2hpbGQpOwogICAgICAgIG9wdGlvbnMuY3JlYXRlKGUpOwogICAgfQp9OwoKdmFyIG9wdGlvbnMgPSB7CgogICAgbGlzdDogW10sCiAgICBzdHJpbmdzOiBbCiAgICAgICAgWyJGaW5kIG5ldyIsICJGaW5kIGFuZCBhZGQgbmV3IHNlYXJjaCBlbmdpbmVzIGZyb20gTXlDcm9mdCIsIG5ld0VuZ2luZV0sCiAgICAgICAgWyJSZW9yZGVyIiwgIkRyYWcgYW5kIGRyb3Agc2VhcmNoIGVuZ2luZXMiLCBlbmFibGVEcmFnXSwKICAgICAgICBbIlJlbmFtZSIsICJDbGljayB0byByZW5hbWUgc2VhcmNoIGVuZ2luZXMiLCBlbmFibGVSZW5hbWVdLAogICAgICAgIFsiUmVtb3ZlIiwgIkNsaWNrIHRvIHJlbW92ZSBzZWFyY2ggZW5naW5lcyIsIGVuYWJsZVJlbW92ZV0sCiAgICAgICAgWyJSZXN0b3JlIGFsbCIsICJSZXN0b3JlcyBhbGwgZGVmYXVsdCBzZWFyY2ggZW5naW5lcyIsIHJlc3RvcmVFbmdpbmVzXSwKICAgICAgICBbIlNhdmUiLCAiU2F2ZXMgbW9kaWZpZWQgc2VhcmNoIGVuZ2luZXMiLCBzYXZlQWN0aW9uc10sCiAgICAgICAgWyJDYW5jZWwiLCAiQ2FuY2VscyBhbGwgcmVjZW50IG1vZGlmaWNhdGlvbnMiLCBjYW5jZWxBY3Rpb25zXQogICAgXSwKCiAgICBjcmVhdGU6IGZ1bmN0aW9uIChtKSB7CiAgICAgICAgdmFyIG8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgICB2YXIgb19saW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOwogICAgICAgIHZhciB1bCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInVsIik7CiAgICAgICAgdmFyIGxpbmtzID0gW107CiAgICAgICAgby5pZCA9ICJkZGdfZXh0ZW50ZWRfb3B0aW9ucyI7CiAgICAgICAgb19saW5rLmlubmVySFRNTCA9ICLinLwiOwogICAgICAgIG9fbGluay5ocmVmID0gIiMiICsgby5pZDsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc3RyaW5ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YXIgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKICAgICAgICAgICAgYS5ocmVmID0gIiMiOwogICAgICAgICAgICBhLmlubmVySFRNTCA9IHRoaXMuc3RyaW5nc1tpXVswXTsKICAgICAgICAgICAgYS50aXRsZSA9IHRoaXMuc3RyaW5nc1tpXVsxXTsKICAgICAgICAgICAgYS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIHRoaXMuc3RyaW5nc1tpXVsyXSwgZmFsc2UpOwogICAgICAgICAgICBsaW5rcy5wdXNoKGEpOwogICAgICAgIH0KICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGxpbmtzLmxlbmd0aCAtIDI7IGorKykgewogICAgICAgICAgICB2YXIgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJsaSIpOwogICAgICAgICAgICBsaS5hcHBlbmRDaGlsZChsaW5rc1tqXSk7CiAgICAgICAgICAgIHVsLmFwcGVuZENoaWxkKGxpKTsKICAgICAgICB9CiAgICAgICAgdmFyIG9fc2F2ZSA9IGxpbmtzW2xpbmtzLmxlbmd0aCAtIDJdOwogICAgICAgIHZhciBvX2NhbmNlbCA9IGxpbmtzW2xpbmtzLmxlbmd0aCAtIDFdOwogICAgICAgIG9fc2F2ZS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgIG9fY2FuY2VsLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgb19zYXZlLmlkID0gImRkZ19lX3NhdmUiOwogICAgICAgIG9fY2FuY2VsLmlkID0gImRkZ19lX2NhbmNlbCI7CiAgICAgICAgdGhpcy5saXN0LnB1c2gob19zYXZlKTsKICAgICAgICB0aGlzLmxpc3QucHVzaChvX2NhbmNlbCk7CiAgICAgICAgdGhpcy5saXN0LnB1c2gob19saW5rKTsKICAgICAgICBvLmFwcGVuZENoaWxkKG9fc2F2ZSk7CiAgICAgICAgby5hcHBlbmRDaGlsZChvX2NhbmNlbCk7CiAgICAgICAgby5hcHBlbmRDaGlsZChvX2xpbmspOwogICAgICAgIG8uYXBwZW5kQ2hpbGQodWwpOwogICAgICAgIG8uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIG8uY2xhc3NOYW1lID0gKG8uY2xhc3NOYW1lID09ICIiID8gInNob3ciIDogIiIpOwogICAgICAgIH0pOwogICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24oZSkgewogICAgICAgICAgICBpZihlLnRhcmdldCAhPSBvX2xpbmsgJiYgby5jbGFzc05hbWUgIT0gIiIpCiAgICAgICAgICAgICAgICBvLmNsYXNzTmFtZSA9ICIiOwogICAgICAgIH0pOwogICAgICAgIG0uYXBwZW5kQ2hpbGQobyk7CiAgICB9LAoKICAgIHRvZ2dsZTogZnVuY3Rpb24gKCkgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5saXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmxpc3RbaV0uc3R5bGUuZGlzcGxheSA9PT0gIm5vbmUiKQogICAgICAgICAgICAgICAgdGhpcy5saXN0W2ldLnN0eWxlLmRpc3BsYXkgPSAiaW5saW5lIjsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgdGhpcy5saXN0W2ldLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgfQogICAgfQoKfTsKCnZhciBteWNyb2Z0ID0gewoKICAgIHBsdWdpbnM6IG51bGwsCgogICAgYWRkTGlua3M6IGZ1bmN0aW9uIChwKSB7CgogICAgICAgIGlmIChwKSB7CiAgICAgICAgICAgIHRoaXMucGx1Z2lucyA9IGRvY3VtZW50LmV2YWx1YXRlKCcvL2FbQGhyZWY9Ii9qc3JlcS5odG1sIl0nLAogICAgICAgICAgICAgICAgcCwgbnVsbCwgWFBhdGhSZXN1bHQuT1JERVJFRF9OT0RFX1NOQVBTSE9UX1RZUEUsIG51bGwpOwogICAgICAgICAgICB2YXIgcmV2aWV3cyA9IGRvY3VtZW50LmV2YWx1YXRlKCcvL2FbLj0iW1Jldmlld10iXScsCiAgICAgICAgICAgICAgICBwLCBudWxsLCBYUGF0aFJlc3VsdC5PUkRFUkVEX05PREVfU05BUFNIT1RfVFlQRSwgbnVsbCk7CiAgICAgICAgICAgIHZhciBhZGRMaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOwogICAgICAgICAgICBhZGRMaW5rLnNldEF0dHJpYnV0ZSgiaHJlZiIsICIjIik7CiAgICAgICAgICAgIGFkZExpbmsuc2V0QXR0cmlidXRlKCJzdHlsZSIsICJtYXJnaW4tbGVmdDo1cHg7IGNvbG9yOiMwMDAwOTkiKTsKICAgICAgICAgICAgYWRkTGluay5pbm5lckhUTUwgPSAiW0FkZCB0byBEREddIjsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIHRtcDsgaSA8IHJldmlld3Muc25hcHNob3RMZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdG1wID0gYWRkTGluay5jbG9uZU5vZGUodHJ1ZSk7CiAgICAgICAgICAgICAgICB0bXAuc2V0QXR0cmlidXRlKCJkYXRhLWluZCIsIGkpOwogICAgICAgICAgICAgICAgdG1wLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgdGhpcy5hZGROZXdFbmdpbmUsIGZhbHNlKTsKICAgICAgICAgICAgICAgIHJldmlld3Muc25hcHNob3RJdGVtKGkpLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHRtcCwgcmV2aWV3cy5zbmFwc2hvdEl0ZW0oaSkubmV4dFNpYmxpbmcpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgIH0sCgogICAgYWRkTmV3RW5naW5lOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGN1cnJlbnQgPSBHTV9nZXRWYWx1ZSgiZW5naW5lcyIsIGRkZ19lLmRlZmF1bHQpOwogICAgICAgIHZhciBpID0gdGhpcy5nZXRBdHRyaWJ1dGUoImRhdGEtaW5kIik7CiAgICAgICAgdmFyIG5hbWUgPSBteWNyb2Z0LnBsdWdpbnMuc25hcHNob3RJdGVtKGkpLmlubmVySFRNTC5zcGxpdCgiICgiKVswXS5zcGxpdCgiIC0iKVswXTsKICAgICAgICB2YXIgbmV3RW5naW5lID0gbXljcm9mdC5wbHVnaW5zLnNuYXBzaG90SXRlbShpKS5nZXRBdHRyaWJ1dGUoIm9uQ2xpY2siKS5zcGxpdCgiJyIpWzFdOwogICAgICAgIHZhciBuZXdOYW1lID0gcHJvbXB0KCJUaGlzIGVuZ2luZSB3aWxsIGJlIGFkZGVkIHRvIERERyBFeHRlbmRlZC5cbkdpdmUgYSBuYW1lIG9yIGNhbmNlbC4iLCBuYW1lKTsKICAgICAgICBpZiAobmV3TmFtZSAmJiBuZXdOYW1lLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgdGhpcy5pbm5lckhUTUwgPSAiW0FkZGVkXSI7CiAgICAgICAgICAgIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcigiY2xpY2siLCB0aGlzLmFkZE5ld0VuZ2luZSwgZmFsc2UpOwogICAgICAgICAgICB0aGlzLnN0eWxlLmNvbG9yID0gIiMwMDk5MDAiOwogICAgICAgICAgICB0aGlzLnJlbW92ZUF0dHJpYnV0ZSgiaHJlZiIpOwoKICAgICAgICAgICAgR01feG1saHR0cFJlcXVlc3QoewogICAgICAgICAgICAgICAgbWV0aG9kOiAiR0VUIiwKICAgICAgICAgICAgICAgIHVybDogImh0dHA6Ly9teWNyb2Z0cHJvamVjdC5jb20vZXh0ZXJuYWxvcy5waHAvIiArIG5ld0VuZ2luZSArICIueG1sIiwKICAgICAgICAgICAgICAgIG9ubG9hZDogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlWE1MID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAvLyBJbmplY3QgcmVzcG9uc2VYTUwgaW50byBleGlzdGluZyBPYmplY3QgKG9ubHkgYXBwcm9wcmlhdGUgZm9yIFhNTCBjb250ZW50KS4KICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLnJlc3BvbnNlWE1MKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlWE1MID0gbmV3IERPTVBhcnNlcigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAucGFyc2VGcm9tU3RyaW5nKHJlc3BvbnNlLnJlc3BvbnNlVGV4dCwgInRleHQveG1sIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHZhciBlbmdpbmUgPSByZXNwb25zZVhNTC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiVXJsIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKGVuZ2luZS5sZW5ndGggPiAwICYmIGVuZ2luZVswXS5nZXRBdHRyaWJ1dGUoInRlbXBsYXRlIikpCiAgICAgICAgICAgICAgICAgICAgICAgIEdNX3NldFZhbHVlKCJlbmdpbmVzIiwgY3VycmVudCArICI7OyIgKyBuZXdOYW1lICsgIj09IiArIGVuZ2luZVswXS5nZXRBdHRyaWJ1dGUoInRlbXBsYXRlIikpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9Cn07CgovLyBGVU5DVElPTlMKZnVuY3Rpb24gb25IYXNoQ2hhbmdlKCkgewogICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5oYXNoLmluZGV4T2YoIntzZWFyY2hUZXJtc30iKSAhPT0gLTEpCiAgICAgICAgd2luZG93LmxvY2F0aW9uLmhhc2ggPSAiIjsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJoYXNoY2hhbmdlIiwgZnVuY3Rpb24gKCkgewogICAgICAgIGlmICh3aW5kb3cubG9jYXRpb24uaGFzaC5pbmRleE9mKCJ7c2VhcmNoVGVybXN9IikgIT09IC0xKQogICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoLnN1YnN0cigxKS5yZXBsYWNlKCJ7c2VhcmNoVGVybXN9IiwgZXNjYXBlKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzZWFyY2hfZm9ybV9pbnB1dCIpLnZhbHVlKSk7CiAgICB9LCBmYWxzZSk7Cn0KCmZ1bmN0aW9uIG9uQ29sb3JDaGFuZ2UoaCwgYykgewogICAgaWYgKGMgIT09IG51bGwpIHsKICAgICAgICBjLmFkZEV2ZW50TGlzdGVuZXIoImNoYW5nZSIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGIgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShoKS5iYWNrZ3JvdW5kQ29sb3I7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGRnX2UuZW5naW5lcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGRkZ19lLmVuZ2luZXNbaV0uc3R5bGUuYmFja2dyb3VuZCA9IGI7CiAgICAgICAgfSwgZmFsc2UpOwogICAgfQp9CgpmdW5jdGlvbiByZXN0b3JlRW5naW5lcygpIHsKICAgIGlmIChjb25maXJtKCJEbyB5b3Ugd2FudCB0byByZXN0b3JlIHRoZSBkZWZhdWx0IHNlYXJjaCBlbmdpbmVzPyIpKSB7CiAgICAgICAgR01fc2V0VmFsdWUoImVuZ2luZXMiLCBkZGdfZS5kZWZhdWx0KTsKICAgICAgICBkZGdfZS5uZXdMaXN0KCk7CiAgICB9Cn0KCmZ1bmN0aW9uIHNhdmVBY3Rpb25zKCkgewogICAgZGlzYWJsZUV2ZW50cygpOwogICAgZGRnX2Uuc2V0KCk7Cn0KCmZ1bmN0aW9uIGNhbmNlbEFjdGlvbnMoKSB7CiAgICBkaXNhYmxlRXZlbnRzKCk7CiAgICBkZGdfZS5uZXdMaXN0KCk7Cn0KCmZ1bmN0aW9uIGVuYWJsZURyYWcoKSB7CiAgICBvcHRpb25zLnRvZ2dsZSgpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkZGdfZS5lbmdpbmVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZGRnX2UuZW5naW5lc1tpXS5zdHlsZS5jdXJzb3IgPSAibW92ZSI7CiAgICAgICAgZGRnX2UuZW5naW5lc1tpXS5jbGFzc05hbWUgPSAiZGlzYWJsZWQiOwogICAgICAgIGRkZ19lLmVuZ2luZXNbaV0uYWRkRXZlbnRMaXN0ZW5lcigiZHJhZ3N0YXJ0IiwgaGFuZGxlRHJhZ1N0YXJ0LCBmYWxzZSk7CiAgICAgICAgZGRnX2UuZW5naW5lc1tpXS5hZGRFdmVudExpc3RlbmVyKCJkcmFnb3ZlciIsIGhhbmRsZURyYWdPdmVyLCBmYWxzZSk7CiAgICAgICAgZGRnX2UuZW5naW5lc1tpXS5hZGRFdmVudExpc3RlbmVyKCJkcm9wIiwgaGFuZGxlRHJvcCwgZmFsc2UpOwogICAgfQp9CgpmdW5jdGlvbiBlbmFibGVSZW1vdmUoKSB7CiAgICBvcHRpb25zLnRvZ2dsZSgpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkZGdfZS5lbmdpbmVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZGRnX2UuZW5naW5lc1tpXS5zdHlsZS5jdXJzb3IgPSAiY3Jvc3NoYWlyIjsKICAgICAgICBkZGdfZS5lbmdpbmVzW2ldLmNsYXNzTmFtZSA9ICJkaXNhYmxlZCI7CiAgICAgICAgZGRnX2UuZW5naW5lc1tpXS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIHJlbW92ZSwgZmFsc2UpOwogICAgfQp9CgpmdW5jdGlvbiBlbmFibGVSZW5hbWUoKSB7CiAgICBvcHRpb25zLnRvZ2dsZSgpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkZGdfZS5lbmdpbmVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZGRnX2UuZW5naW5lc1tpXS5zdHlsZS5jdXJzb3IgPSAidGV4dCI7CiAgICAgICAgZGRnX2UuZW5naW5lc1tpXS5jbGFzc05hbWUgPSAiZGlzYWJsZWQiOwogICAgICAgIGRkZ19lLmVuZ2luZXNbaV0uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCByZW5hbWUsIGZhbHNlKTsKICAgIH0KfQoKZnVuY3Rpb24gZGlzYWJsZUV2ZW50cygpIHsKICAgIG9wdGlvbnMudG9nZ2xlKCk7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRkZ19lLmVuZ2luZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBkZGdfZS5lbmdpbmVzW2ldLnN0eWxlLmN1cnNvciA9ICJhdXRvIjsKICAgICAgICBkZGdfZS5lbmdpbmVzW2ldLnJlbW92ZUF0dHJpYnV0ZSgiY2xhc3MiKTsKICAgICAgICBkZGdfZS5lbmdpbmVzW2ldLnJlbW92ZUV2ZW50TGlzdGVuZXIoImRyYWdzdGFydCIsIGhhbmRsZURyYWdTdGFydCwgZmFsc2UpOwogICAgICAgIGRkZ19lLmVuZ2luZXNbaV0ucmVtb3ZlRXZlbnRMaXN0ZW5lcigiZHJhZ292ZXIiLCBoYW5kbGVEcmFnT3ZlciwgZmFsc2UpOwogICAgICAgIGRkZ19lLmVuZ2luZXNbaV0ucmVtb3ZlRXZlbnRMaXN0ZW5lcigiZHJvcCIsIGhhbmRsZURyb3AsIGZhbHNlKTsKICAgICAgICBkZGdfZS5lbmdpbmVzW2ldLnJlbW92ZUV2ZW50TGlzdGVuZXIoImNsaWNrIiwgcmVtb3ZlLCBmYWxzZSk7CiAgICAgICAgZGRnX2UuZW5naW5lc1tpXS5yZW1vdmVFdmVudExpc3RlbmVyKCJjbGljayIsIHJlbmFtZSwgZmFsc2UpOwogICAgfQp9CgpmdW5jdGlvbiByZW1vdmUoKSB7CiAgICB0aGlzLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcyk7Cn0KCmZ1bmN0aW9uIHJlbmFtZSgpIHsKICAgIHZhciBuID0gcHJvbXB0KCJSZW5hbWUgc2VhcmNoIGVuZ2luZSIsIHRoaXMudGV4dENvbnRlbnQpOwogICAgaWYgKG4gJiYgbi5sZW5ndGggPiAwICYmIG4ubGVuZ3RoIDwgMjApCiAgICAgICAgdGhpcy5maXJzdENoaWxkLmlubmVySFRNTCA9IG47Cn0KCmZ1bmN0aW9uIG5ld0VuZ2luZSgpIHsKICAgIHZhciBuID0gcHJvbXB0KCJTZWFyY2ggYW5kIGFkZCBuZXcgc2VhcmNoIGVuZ2luZXMgZnJvbSBNeUNyb2Z0LlxuWW91IGNhbiBzZWFyY2ggYnkgbmFtZSBhbmQgdXJsLiIsICIiKTsKICAgIGlmIChuICYmIG4ubGVuZ3RoID4gMCkKICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9ICJodHRwOi8vbXljcm9mdHByb2plY3QuY29tL3NlYXJjaC1lbmdpbmVzLmh0bWw/bmFtZT0iICsgbjsKfQoKCi8qIFB1cmUgamF2YXNjcmlwdCBhbmQgaHRtbDUgZHJhZy1hbmQtZHJvcCBmb3IgYW4gb3JkZXJlZCBsaXN0CiAqIHNvdXJjZTogaHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vcm9ib3BoaWxvc29waGVyLzc1MjA0NjAKICovCnZhciBkcmFnU3JjRWwsIGRyb3BfaW5kZXgsIG51bUxpcywgY291bnQsIHRva2VuMSwgdG9rZW4yOwoKZnVuY3Rpb24gaGFuZGxlRHJhZ1N0YXJ0KGUpIHsKICAgIGRyYWdTcmNFbCA9IHRoaXM7CiAgICBlLmRhdGFUcmFuc2Zlci5lZmZlY3RBbGxvd2VkID0gIm1vdmUiOwogICAgZS5kYXRhVHJhbnNmZXIuc2V0RGF0YSgidGV4dC9odG1sIiwgdGhpcy5pbm5lckhUTUwpOwp9CgpmdW5jdGlvbiBoYW5kbGVEcmFnT3ZlcihlKSB7CiAgICBpZiAoZS5wcmV2ZW50RGVmYXVsdCkgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgcmV0dXJuIGZhbHNlOwp9CgpmdW5jdGlvbiBoYW5kbGVEcm9wKGUpIHsKICAgIGlmIChlLnN0b3BQcm9wYWdhdGlvbikgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgIGlmIChlLnByZXZlbnREZWZhdWx0KSBlLnByZXZlbnREZWZhdWx0KCk7CiAgICBkcm9wX2luZGV4ID0gdGhpcy52YWx1ZTsKICAgIG51bUxpcyA9IHBhcnNlSW50KGRyb3BfaW5kZXggLSBkcmFnU3JjRWwudmFsdWUpOwogICAgY291bnQgPSBNYXRoLmFicyhudW1MaXMpOwogICAgaWYgKGRyYWdTcmNFbCAhPSB0aGlzKSB7CiAgICAgICAgLy8gc3dhcCBkYXRhIHdoZW4gcHJlbWlzZXMgYXJlIGFkamFjZW50CiAgICAgICAgaWYgKE1hdGguYWJzKG51bUxpcykgPT0gMSkgewogICAgICAgICAgICBkcmFnU3JjRWwuaW5uZXJIVE1MID0gdGhpcy5pbm5lckhUTUw7CiAgICAgICAgICAgIHRoaXMuaW5uZXJIVE1MID0gZS5kYXRhVHJhbnNmZXIuZ2V0RGF0YSgidGV4dC9odG1sIik7CiAgICAgICAgfQogICAgICAgIC8vIHByb3BhZ2F0ZSBkYXRhIGZyb20gbm9uLWFkamFjZW50IGRyb3BzCiAgICAgICAgaWYgKE1hdGguYWJzKG51bUxpcykgPiAxKSB7CiAgICAgICAgICAgIHRva2VuMSA9IHRoaXMuaW5uZXJIVE1MOwogICAgICAgICAgICB0aGlzLmlubmVySFRNTCA9IGUuZGF0YVRyYW5zZmVyLmdldERhdGEoInRleHQvaHRtbCIpOwogICAgICAgICAgICB2YXIgaSwgY291bnRlcjsKICAgICAgICAgICAgLy8gYnJpbmcgcHJlbWlzZSB1cCBsaXN0CiAgICAgICAgICAgIGlmIChudW1MaXMgPCAtMSkgewogICAgICAgICAgICAgICAgZm9yIChpID0gZHJvcF9pbmRleCwgY291bnRlciA9IDA7IGNvdW50ZXIgPCBjb3VudDsgY291bnRlcisrLCBpKyspIHsKICAgICAgICAgICAgICAgICAgICB0b2tlbjIgPSBkZGdfZS5lbmdpbmVzW2ldLmlubmVySFRNTDsKICAgICAgICAgICAgICAgICAgICBkZGdfZS5lbmdpbmVzW2ldLmlubmVySFRNTCA9IHRva2VuMTsKICAgICAgICAgICAgICAgICAgICB0b2tlbjEgPSB0b2tlbjI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gYnJpbmcgcHJlbWlzZSBkb3duIGxpc3QKICAgICAgICAgICAgaWYgKG51bUxpcyA+IDEpIHsKICAgICAgICAgICAgICAgIGZvciAoaSA9IGRyb3BfaW5kZXggLSAxLCBjb3VudGVyID0gMDsgY291bnRlciA8IGNvdW50OyBjb3VudGVyKyssIGktLSkgewogICAgICAgICAgICAgICAgICAgIHRva2VuMiA9IGRkZ19lLmVuZ2luZXNbaSAtIDFdLmlubmVySFRNTDsKICAgICAgICAgICAgICAgICAgICBkZGdfZS5lbmdpbmVzW2kgLSAxXS5pbm5lckhUTUwgPSB0b2tlbjE7CiAgICAgICAgICAgICAgICAgICAgdG9rZW4xID0gdG9rZW4yOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIGZhbHNlOwp9CgovLyBTVEFSVAppZiAod2luZG93LmxvY2F0aW9uLmhyZWYuaW5kZXhPZigiaHR0cDovL215Y3JvZnRwcm9qZWN0LmNvbS8iKSAhPT0gLTEpIHsKICAgIG15Y3JvZnQuYWRkTGlua3MoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBsdWdpbnMiKSk7Cn0gZWxzZSB7CiAgICBkZGdfZS5hcHBlbmQoKTsKICAgIC8vb25Db2xvckNoYW5nZShoZWFkZXIsIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzZXR0aW5nX2tqIikpOwp9Cg=="},{"name":"Open Tweet Image","options":{"check_for_updates":true,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_arrayleft":false,"compat_uW_gmonkey":false,"compat_forvarin":false,"noframes":null,"awareOfChrome":false,"run_at":null,"override":{"use_includes":[],"orig_includes":["https://twitter.com/*"],"merge_includes":true,"use_matches":[],"orig_matches":[],"merge_matches":true,"use_excludes":[],"orig_excludes":["https://twitter.com/settings/*"],"merge_excludes":true,"use_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":true,"orig_connects":[]}},"storage":{"ts":1521793459493,"data":{}},"enabled":false,"position":14,"file_url":"https://greasyfork.org/scripts/6371-open-tweet-image/code/Open%20Tweet%20Image.user.js","uuid":"1559f2cd-410f-4580-b951-1be62f0442d8","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgIE9wZW4gVHdlZXQgSW1hZ2UKLy8gQGF1dGhvciAgICAgIEFyY3Rvc21vdXMKLy8gQG5hbWVzcGFjZSAgIGh0dHBzOi8vd3d3Lmdvb2dsZWRyaXZlLmNvbS9ob3N0LzBCMFQzMk9OLWEzU3RVV1pHVVc5VGJGWkNWSE0vCi8vIEBkZXNjcmlwdGlvbiBBIHRocm93biB0b2dldGhlciBzY3JpcHQgdG8gb3BlbiBhIHR3ZWV0cyBpbWFnZSBpbiBhIG5ldyB0YWIuCi8vIEBpbmNsdWRlICAgICBodHRwczovL3R3aXR0ZXIuY29tLyoKLy8gQGV4Y2x1ZGUgICAgIGh0dHBzOi8vdHdpdHRlci5jb20vc2V0dGluZ3MvKgovLyBAZ3JhbnQgICAgICAgbm9uZQovLyBAdmVyc2lvbiAgICAgMS4xLjAKLy8gQG5vZnJhbWVzCi8vID09L1VzZXJTY3JpcHQ9PQp2YXIgT3BlblR3ZWV0SW1hZ2U7CihmdW5jdGlvbiAoT3BlblR3ZWV0SW1hZ2UpIHsKICAgIGZ1bmN0aW9uIEdldE9yaWdVcmwodXJsKSB7CiAgICAgICAgaWYgKHVybC5pbmRleE9mKCI6IikgIT0gdXJsLmxhc3RJbmRleE9mKCI6IikpIHsKICAgICAgICAgICAgdXJsID0gdXJsLnN1YnN0cigwLCB1cmwubGFzdEluZGV4T2YoJzonKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB1cmwgKyAnOm9yaWcnOwogICAgfQogICAgdmFyIEdhbGxlcnk7CiAgICAoZnVuY3Rpb24gKEdhbGxlcnkpIHsKICAgICAgICB2YXIgbGlnaHRib3ggPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJHYWxsZXJ5LWNvbnRlbnQiKVswXTsKICAgICAgICB2YXIgaW1hZ2VDb25haW5lciA9IGxpZ2h0Ym94LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoIkdhbGxlcnktbWVkaWEiKVswXTsKICAgICAgICB2YXIgb3BlbkxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICAgICAgb3BlbkxpbmsuaWQgPSAib3RpLWxpbmsiOwogICAgICAgIG9wZW5MaW5rLnRhcmdldCA9ICJfYmxhbmsiOwogICAgICAgIG9wZW5MaW5rLmNsYXNzTmFtZSA9ICJtb2RhbC1idG4iOwogICAgICAgIG9wZW5MaW5rLnN0eWxlLnBvc2l0aW9uID0gImFic29sdXRlIjsKICAgICAgICBvcGVuTGluay5zdHlsZS5yaWdodCA9ICItMzFweCI7CiAgICAgICAgb3Blbkxpbmsuc3R5bGUucGFkZGluZyA9ICIwIjsKICAgICAgICBvcGVuTGluay5zdHlsZS5oZWlnaHQgPSAiYXV0byI7CiAgICAgICAgb3Blbkxpbmsuc3R5bGUudG9wID0gIjQzcHgiOwogICAgICAgIG9wZW5MaW5rLnN0eWxlLmNvbG9yID0gIiNmZmYiOwogICAgICAgIG9wZW5MaW5rLnN0eWxlLmZvbnRTaXplID0gIjIwcHgiOwogICAgICAgIGxpZ2h0Ym94Lmluc2VydEJlZm9yZShvcGVuTGluaywgbGlnaHRib3guY2hpbGROb2Rlc1swXSk7CiAgICAgICAgdmFyIGxpbmtJY29uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3BhbiIpOwogICAgICAgIGxpbmtJY29uLmNsYXNzTmFtZSA9ICJJY29uIEljb24tLXBob3RvIjsKICAgICAgICBvcGVuTGluay5hcHBlbmRDaGlsZChsaW5rSWNvbik7CiAgICAgICAgdmFyIG9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoZnVuY3Rpb24gKG11dGF0aW9ucykgewogICAgICAgICAgICBtdXRhdGlvbnMuZm9yRWFjaChmdW5jdGlvbiAobXV0YXRpb24pIHsKICAgICAgICAgICAgICAgIGlmIChtdXRhdGlvbi50eXBlID09ICJjaGlsZExpc3QiKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGltYWdlQ29uYWluZXIuY2hpbGRyZW4ubGVuZ3RoICE9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbWFnZSA9IGltYWdlQ29uYWluZXIuY2hpbGRyZW5bMF07CiAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5MaW5rLmhyZWYgPSBHZXRPcmlnVXJsKGltYWdlLnNyYyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBvcGVuTGluay5ocmVmID0gIiI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgICBvYnNlcnZlci5vYnNlcnZlKGltYWdlQ29uYWluZXIsIHsKICAgICAgICAgICAgY2hpbGRMaXN0OiB0cnVlCiAgICAgICAgfSk7CiAgICB9KShHYWxsZXJ5IHx8IChHYWxsZXJ5ID0ge30pKTsKICAgIHZhciBUd2VldFRvb2xzID0gKGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBUd2VldFRvb2xzKHR3ZWV0KSB7CiAgICAgICAgICAgIHRoaXMub3BlbkJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKICAgICAgICAgICAgdmFyIHQgPSB0aGlzOwogICAgICAgICAgICB0LnR3ZWV0ID0gdHdlZXQ7CiAgICAgICAgICAgIHQuR2V0TWVkaWEoKTsKICAgICAgICAgICAgdC5hY3Rpb25Gb290ZXIgPSB0d2VldC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJQcm9maWxlVHdlZXQtYWN0aW9uTGlzdCIpWzBdOwogICAgICAgICAgICAvLyBGaXJzdCBhbmQgbGFzdCBidXR0b25zIGFyZSB0b28gd2lkZQogICAgICAgICAgICB2YXIgdHdpdHRlckFjdGlvbnMgPSB0LmFjdGlvbkZvb3Rlci5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJQcm9maWxlVHdlZXQtYWN0aW9uIik7CiAgICAgICAgICAgIHZhciByZXBseVR3aXR0ZXJBY3Rpb24gPSB0d2l0dGVyQWN0aW9uc1swXTsKICAgICAgICAgICAgdmFyIG1vcmVUd2l0dGVyQWN0aW9uID0gdHdpdHRlckFjdGlvbnNbdHdpdHRlckFjdGlvbnMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgIHJlcGx5VHdpdHRlckFjdGlvbi5zdHlsZS53aWR0aCA9ICI2MHB4IjsKICAgICAgICAgICAgbW9yZVR3aXR0ZXJBY3Rpb24uc3R5bGUud2lkdGggPSAiNTBweCI7CiAgICAgICAgICAgIHZhciBvcGVuQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgICAgIG9wZW5Db250YWluZXIuY2xhc3NOYW1lID0gIlByb2ZpbGVUd2VldC1hY3Rpb24gb3RpLW5ld190YWJzIjsKICAgICAgICAgICAgb3BlbkNvbnRhaW5lci5hcHBlbmRDaGlsZCh0Lm9wZW5CdXR0b24pOwogICAgICAgICAgICBvcGVuQ29udGFpbmVyLnN0eWxlLndpZHRoID0gIjUwcHgiOwogICAgICAgICAgICB0LmFjdGlvbkZvb3Rlci5hcHBlbmRDaGlsZChvcGVuQ29udGFpbmVyKTsKICAgICAgICAgICAgdC5vcGVuQnV0dG9uLmNsYXNzTmFtZSA9ICJQcm9maWxlVHdlZXQtYWN0aW9uQnV0dG9uIHUtdGV4dFVzZXJDb2xvckhvdmVyIGpzLWFjdGlvbkJ1dHRvbiBqcy10b29sdGlwIjsKICAgICAgICAgICAgdC5vcGVuQnV0dG9uLnRpdGxlID0gIk9wZW4gQWxsIjsKICAgICAgICAgICAgaWYgKHQuZG93bmxvYWRhYmxlTWVkaWEubGVuZ3RoID09IDEpIHsKICAgICAgICAgICAgICAgIHQub3BlbkJ1dHRvbi5ocmVmID0gdC5kb3dubG9hZGFibGVNZWRpYVswXTsKICAgICAgICAgICAgICAgIHQub3BlbkJ1dHRvbi50YXJnZXQgPSAiX2JsYW5rIjsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHQub3BlbkJ1dHRvbi5vbmNsaWNrID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHQuZG93bmxvYWRhYmxlTWVkaWEuZm9yRWFjaChmdW5jdGlvbiAobWVkaWFVcmwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lm9wZW4obWVkaWFVcmwsICJfYmxhbmsiKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB0Lm1vYmlsZU1lZGlhLmZvckVhY2goZnVuY3Rpb24gKG1lZGlhVXJsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5vcGVuKG1lZGlhVXJsLCAiX2JsYW5rIik7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBvcGVuSWNvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKTsKICAgICAgICAgICAgb3Blbkljb24uY2xhc3NOYW1lID0gIkljb24gSWNvbi0tY29sbGVjdGlvbnMiOwogICAgICAgICAgICB0Lm9wZW5CdXR0b24uYXBwZW5kQ2hpbGQob3Blbkljb24pOwogICAgICAgICAgICB0d2VldC5jbGFzc05hbWUgKz0gIiBoYXMtb3RpLXRvb2xzIjsKICAgICAgICB9CiAgICAgICAgVHdlZXRUb29scy5wcm90b3R5cGUuR2V0TXA0R2lmID0gZnVuY3Rpb24gKG1lZGlhKSB7CiAgICAgICAgICAgIHZhciB0ID0gdGhpczsKICAgICAgICAgICAgdmFyIGlmcmFtZSA9IG1lZGlhLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJpZnJhbWUiKVswXTsKICAgICAgICAgICAgdmFyIGZ1Y2tpbmdJZnJhbWVzUG9zRG9lc250V29ya0FuZFlvdXJCdWxsc2hpdCA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGlmIChpZnJhbWUuY29udGVudFdpbmRvdyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHZpZGVvID0gaWZyYW1lLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInZpZGVvIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKHZpZGVvLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdC5kb3dubG9hZGFibGVNZWRpYS5wdXNoKHZpZGVvWzBdLnNyYyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoZnVja2luZ0lmcmFtZXNQb3NEb2VzbnRXb3JrQW5kWW91ckJ1bGxzaGl0KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKGZ1Y2tpbmdJZnJhbWVzUG9zRG9lc250V29ya0FuZFlvdXJCdWxsc2hpdCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIDUwMCk7CiAgICAgICAgfTsKICAgICAgICBUd2VldFRvb2xzLnByb3RvdHlwZS5HZXRNZWRpYSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHQgPSB0aGlzOwogICAgICAgICAgICB2YXIgbWVkaWEgPSB0LnR3ZWV0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoIkFkYXB0aXZlTWVkaWEiKVswXTsKICAgICAgICAgICAgdC5kb3dubG9hZGFibGVNZWRpYSA9IFtdOwogICAgICAgICAgICB0Lm1vYmlsZU1lZGlhID0gW107CiAgICAgICAgICAgIHZhciBpbWFnZXMgPSBtZWRpYS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaW1nIik7CiAgICAgICAgICAgIFtdLmZvckVhY2guY2FsbChpbWFnZXMsIGZ1bmN0aW9uIChpbWFnZSkgewogICAgICAgICAgICAgICAgdmFyIG9yaWdJbWcgPSBHZXRPcmlnVXJsKGltYWdlLnNyYyk7CiAgICAgICAgICAgICAgICB0LmRvd25sb2FkYWJsZU1lZGlhLnB1c2gob3JpZ0ltZyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBpZiAobWVkaWEuY2xhc3NMaXN0LmNvbnRhaW5zKCJpcy1nZW5lcmljLXZpZGVvIikpIHsKICAgICAgICAgICAgICAgIGlmIChtZWRpYS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJQbGF5YWJsZU1lZGlhLS1naWYiKS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG1lZGlhLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJpZnJhbWUiKS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHQuR2V0TXA0R2lmKG1lZGlhKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwbGF5ZXJDb250YWluZXJfMSA9IG1lZGlhLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoIlBsYXlhYmxlTWVkaWEtcGxheWVyIilbMF07CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtZWRpYU9ic2VydmVyXzEgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihmdW5jdGlvbiAobXV0YXRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtdXRhdGlvbnMuZm9yRWFjaChmdW5jdGlvbiAobXV0YXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobXV0YXRpb24udHlwZSA9PSAiY2hpbGRMaXN0IiAmJiBwbGF5ZXJDb250YWluZXJfMS5jaGlsZHJlbi5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5HZXRNcDRHaWYobWVkaWEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZWRpYU9ic2VydmVyXzEuZGlzY29ubmVjdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgbWVkaWFPYnNlcnZlcl8xLm9ic2VydmUocGxheWVyQ29udGFpbmVyXzEsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkTGlzdDogdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0Lm1vYmlsZU1lZGlhLnB1c2goImh0dHBzOi8vbW9iaWxlLnR3aXR0ZXIuY29tIiArIHQudHdlZXQuZGF0YXNldFsicGVybWFsaW5rUGF0aCJdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgcmV0dXJuIFR3ZWV0VG9vbHM7CiAgICB9KCkpOwogICAgZnVuY3Rpb24gaW5pdFRvb2xzKCkgewogICAgICAgIHZhciB0d2VldHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIuaGFzLWNhcmRzOm5vdCguaGFzLW90aS10b29scyk6bm90KC5jYXJkcy1mb3J3YXJkKTpub3QoW2RhdGEtY2FyZDItdHlwZV0pIik7CiAgICAgICAgW10uZm9yRWFjaC5jYWxsKHR3ZWV0cywgZnVuY3Rpb24gKHR3ZWV0KSB7CiAgICAgICAgICAgIG5ldyBUd2VldFRvb2xzKHR3ZWV0KTsKICAgICAgICB9KTsKICAgIH0KICAgIHZhciB0aW1lbGluZU9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoZnVuY3Rpb24gKG11dGF0aW9ucykgewogICAgICAgIG11dGF0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uIChtdXRhdGlvbikgewogICAgICAgICAgICBpZiAobXV0YXRpb24udHlwZSA9PSAiY2hpbGRMaXN0IikgewogICAgICAgICAgICAgICAgaW5pdFRvb2xzKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0pOwogICAgdmFyIG92ZXJsYXlPYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKGZ1bmN0aW9uIChtdXRhdGlvbnMpIHsKICAgICAgICBtdXRhdGlvbnMuZm9yRWFjaChmdW5jdGlvbiAobXV0YXRpb24pIHsKICAgICAgICAgICAgaWYgKG11dGF0aW9uLnR5cGUgPT0gImNoaWxkTGlzdCIpIHsKICAgICAgICAgICAgICAgIHZhciBvdmVybGF5Q29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgiUGVybWFsaW5rT3ZlcmxheS1ib2R5IilbMF07CiAgICAgICAgICAgICAgICBpZiAob3ZlcmxheUNvbnRhaW5lci5jaGlsZHJlbi5sZW5ndGggIT09IDApIHsKICAgICAgICAgICAgICAgICAgICB0aW1lbGluZU9ic2VydmVyLmRpc2Nvbm5lY3QoKTsKICAgICAgICAgICAgICAgICAgICBpbml0VG9vbHMoKTsKICAgICAgICAgICAgICAgICAgICB2YXIgb3ZlcmxheVN0cmVhbXMgPSBvdmVybGF5Q29udGFpbmVyLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoIi5zdHJlYW0taXRlbXMiKTsKICAgICAgICAgICAgICAgICAgICBbXS5mb3JFYWNoLmNhbGwob3ZlcmxheVN0cmVhbXMsIGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGltZWxpbmVPYnNlcnZlci5vYnNlcnZlKHN0cmVhbSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRMaXN0OiB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9KTsKICAgIHZhciBib2R5T2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihmdW5jdGlvbiAobXV0YXRpb25zKSB7CiAgICAgICAgbXV0YXRpb25zLmZvckVhY2goZnVuY3Rpb24gKG11dGF0aW9uKSB7CiAgICAgICAgICAgIGlmIChtdXRhdGlvbi50eXBlID09ICJhdHRyaWJ1dGVzIikgewogICAgICAgICAgICAgICAgdGltZWxpbmVPYnNlcnZlci5kaXNjb25uZWN0KCk7CiAgICAgICAgICAgICAgICBvdmVybGF5T2JzZXJ2ZXIuZGlzY29ubmVjdCgpOwogICAgICAgICAgICAgICAgaW5pdFRvb2xzKCk7CiAgICAgICAgICAgICAgICBpZiAoZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuY29udGFpbnMoIm92ZXJsYXktZW5hYmxlZCIpKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIG92ZXJsYXlDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJQZXJtYWxpbmtPdmVybGF5LWJvZHkiKVswXTsKICAgICAgICAgICAgICAgICAgICBvdmVybGF5T2JzZXJ2ZXIub2JzZXJ2ZShvdmVybGF5Q29udGFpbmVyLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkTGlzdDogdHJ1ZQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIFtdLmZvckVhY2guY2FsbChvdmVybGF5Q29udGFpbmVyLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoInN0cmVhbS1pdGVtcyIpLCBmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVsaW5lT2JzZXJ2ZXIub2JzZXJ2ZShzdHJlYW0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkTGlzdDogdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRpbWVsaW5lT2JzZXJ2ZXIub2JzZXJ2ZShkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic3RyZWFtLWl0ZW1zLWlkIiksIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRMaXN0OiB0cnVlCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0pOwogICAgZnVuY3Rpb24gaW5pdEJvZHlPYnNlcnZlcigpIHsKICAgICAgICBib2R5T2JzZXJ2ZXIub2JzZXJ2ZShkb2N1bWVudC5ib2R5LCB7CiAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHRydWUKICAgICAgICB9KTsKICAgIH0KICAgIGluaXRCb2R5T2JzZXJ2ZXIoKTsKfSkoT3BlblR3ZWV0SW1hZ2UgfHwgKE9wZW5Ud2VldEltYWdlID0ge30pKTs="}],"settings":{"script_blacklist_server":[{"severity":"2","rules":["/https?:\\/\\/userscripts\\.org\\/scripts\\/(source|version)/(102614).*\\.user\\.js/"]},{"name":"SaveFrom.net helper","severity":"3","rules":["/https?:\\/\\/sf-addon\\.com\\/.*\\/.*\\.user\\.js/","/https?:\\/\\/.*\\.sf-helper\\.com\\/.*\\.user\\.js/"],"reason":"Shows advertisements"}],"configMode":50}}